
!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="a074ac05-2feb-5137-b5d5-df3fdc3d86aa")}catch(e){}}();
(()=>{var wT=Object.create;var Nd=Object.defineProperty;var xT=Object.getOwnPropertyDescriptor;var PT=Object.getOwnPropertyNames;var FT=Object.getPrototypeOf,DT=Object.prototype.hasOwnProperty;var bo=(i,e)=>()=>(i&&(e=i(i=0)),e);var vh=(i,e)=>()=>(e||i((e={exports:{}}).exports,e),e.exports),di=(i,e)=>{for(var t in e)Nd(i,t,{get:e[t],enumerable:!0})},Of=(i,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of PT(e))!DT.call(i,r)&&r!==t&&Nd(i,r,{get:()=>e[r],enumerable:!(n=xT(e,r))||n.enumerable});return i};var Wa=(i,e,t)=>(t=i!=null?wT(FT(i)):{},Of(e||!i||!i.__esModule?Nd(t,"default",{value:i,enumerable:!0}):t,i)),ui=i=>Of(Nd({},"__esModule",{value:!0}),i);var xf={};di(xf,{ByteBuffer:()=>pi});var Ih,wf,pi,Od=bo(()=>{Ih=new Int32Array(1),wf=new Float32Array(Ih.buffer),pi=class i{constructor(e){if(e&&!(e instanceof Uint8Array))throw new Error("Must initialize a ByteBuffer with a Uint8Array");this._data=e||new Uint8Array(256),this._index=0,this._start=0,this.length=e?e.length:0}extendWindowTo(e){this._index=e._index}getNewWindowFromRight(){let e=new i(this._data);return e._index=this._index,e._start=this._index,e}windowToUint8Array(){return this._data.subarray(this._start,this._index)}toUint8Array(){return this._data.subarray(0,this.length)}readByte(){if(this._index+1>this._data.length)throw new Error("Index out of bounds");return this._data[this._index++]}readByteArray(){let e=this.readVarUint(),t=this._index,n=t+e;if(n>this._data.length)throw new Error("Read array out of bounds");this._index=n;let r=new Uint8Array(e);return r.set(this._data.subarray(t,n)),r}readVarFloat(){let e=this._index,t=this._data,n=t.length;if(e+1>n)throw new Error("Index out of bounds");let r=t[e];if(r===0)return this._index=e+1,0;if(e+4>n)throw new Error("Index out of bounds");let o=r|t[e+1]<<8|t[e+2]<<16|t[e+3]<<24;return this._index=e+4,o=o<<23|o>>>9,Ih[0]=o,wf[0]}readVarUint(){let e=0,t=0;do{var n=this.readByte();e|=(n&127)<<t,t+=7}while(n&128&&t<35);return e>>>0}readVarInt(){let e=this.readVarUint()|0;return e&1?~(e>>>1):e>>>1}readVarUint64Bin(){let e=0,t="";do{var n=this.readByte();if(e<8){let r=((n&127)>>>0).toString(2);t=(n&128?r.padStart(7,"0"):r)+t}else{t=n.toString(2)+t;break}e+=1}while(n&128);return t}readVarUint64(){return this.convertBase(this.readVarUint64Bin(),2,10)}readVarInt64(){let e=this.readVarUint64Bin();if(e.slice(-1)=="1"){let t=this.parseToDigitsArray(e.slice(0,-1),2);return t=this.add(t,[1],2),"-"+this.convertBase(this.parseFromDigitsArray(t,2),2,10)}else return this.convertBase(e.slice(0,-1),2,10)}readString(){let e="";for(;;){let t,n=this.readByte();if(n<192)t=n;else{let r=this.readByte();if(n<224)t=(n&31)<<6|r&63;else{let o=this.readByte();if(n<240)t=(n&15)<<12|(r&63)<<6|o&63;else{let a=this.readByte();t=(n&7)<<18|(r&63)<<12|(o&63)<<6|a&63}}}if(t===0)break;t<65536?e+=String.fromCharCode(t):(t-=65536,e+=String.fromCharCode((t>>10)+55296,(t&1024-1)+56320))}return e}_growBy(e){if(this.length+e>this._data.length){let t=new Uint8Array(this.length+e<<1);t.set(this._data),this._data=t}this.length+=e}writeByte(e){let t=this.length;this._growBy(1),this._data[t]=e}writeByteArray(e){this.writeVarUint(e.length);let t=this.length;this._growBy(e.length),this._data.set(e,t)}writeVarFloat(e){let t=this.length;wf[0]=e;let n=Ih[0];if(n=n>>>23|n<<9,!(n&255)){this.writeByte(0);return}this._growBy(4);let r=this._data;r[t]=n,r[t+1]=n>>8,r[t+2]=n>>16,r[t+3]=n>>24}writeVarUint(e){do{let t=e&127;e>>>=7,this.writeByte(e?t|128:t)}while(e)}writeVarInt(e){this.writeVarUint(e<<1^e>>31)}writeVarUint64Helper(e){if(e){var t=0;do{if(t<8){var n=parseInt(e.slice(-7),2);e=e.slice(0,-7)}else{var n=parseInt(e.slice(-8),2);e=e.slice(0,-8),this.writeByte(n);break}this.writeByte(e?n|128:n),t+=1}while(e)}}writeVarUint64(e){e=this.cleanNumericString(e);let t=this.convertBase(e,10,2);this.writeVarUint64Helper(t)}subtractOne(e){let t=1,n=e.split("").map(Number);for(let r=n.length-1;r>=0;r--)if(n[r]<t)n[r]=1;else{n[r]--,t=0;break}return n.join("").replace(/^0+/,"")}cleanNumericString(e){let t="";for(let n=0;n<e.length;n++){let r=e.charAt(n);(r>="0"&&r<="9"||n===0&&r==="-")&&(t+=r)}return t}writeVarInt64(e){if(e=this.cleanNumericString(e),e!=""){if(e[0]!="-")var t=this.convertBase(e,10,2)+"0";else{var t=this.convertBase(e.slice(1),10,2);if(t=="0"||t==""){this.writeVarUint64("0");return}t=this.subtractOne(t)+"1"}this.writeVarUint64Helper(t)}}add(e,t,n){let r=[],o=Math.max(e.length,t.length),a=0,s=0;for(;s<o||a;){let l=s<e.length?e[s]:0,d=s<t.length?t[s]:0,c=a+l+d;r.push(c%n),a=Math.floor(c/n),s++}return r}multiplyByNumber(e,t,n){if(e<0)return[];if(e===0)return[];let r=[],o=t;for(;e&1&&(r=this.add(r,o,n)),e=e>>1,e!==0;)o=this.add(o,o,n);return r}parseToDigitsArray(e,t){let n=e.toString().split(""),r=[];for(let o=n.length-1;o>=0;o--){let a=parseInt(n[o],t);if(isNaN(a))return[];r.push(a)}return r}parseFromDigitsArray(e,t){let n="";for(let r=e.length-1;r>=0;r--)n+=e[r].toString(t);return n}convertBase(e,t,n){let r=this.parseToDigitsArray(e,t);if(r===null)return"";let o=[0],a=[1];for(let s=0;s<r.length;s++)r[s]&&(o=this.add(o,this.multiplyByNumber(r[s],a,n),n)),a=this.multiplyByNumber(t,a,n);return this.parseFromDigitsArray(o,n)}writeString(e){let t;for(let n=0;n<e.length;n++){let r=e.charCodeAt(n);if(n+1===e.length||r<55296||r>=56320)t=r;else{let o=e.charCodeAt(++n);t=(r<<10)+o+(65536-56623104-56320)}if(t===0)throw new Error("Cannot encode a string containing the null character");t<128?this.writeByte(t):(t<2048?this.writeByte(t>>6&31|192):(t<65536?this.writeByte(t>>12&15|224):(this.writeByte(t>>18&7|240),this.writeByte(t>>12&63|128)),this.writeByte(t>>6&63|128)),this.writeByte(t&63|128))}this.writeByte(0)}}});var Eh,wd,Pf=bo(()=>{Eh=class{constructor(){this._float=new Float32Array(1),this._int=new Int32Array(this._float.buffer),this._value=0}reset(){this._value=0}value(){return this._value}hashStr(e){for(var t=0;t<e.length;++t)this.hashI(e.codePointAt(t)||0)}hashBool(e){this.hashI(e?1:0)}hashBytes(e){for(var t=0;t<e.length;++t)this.hashI(e[t])}hashF(e){this._float[0]=e,this._value=this._combine(this._value,this._int[0])}hashI(e){this._value=this._combine(this._value,e)}_combine(e,t){return t+2654435769+(e<<6)+(e>>2)}},wd=class{constructor(e){this._helper=new Eh,this._bb=e}bb(){return this._bb}windowToUint8Array(){return this._bb.windowToUint8Array()}value(){return this._helper.value()}readByte(){let e=this._bb.readByte();return this._helper.hashI(e),e}readByteArray(){let e=this._bb.readByteArray();return this._helper.hashBytes(e),e}readVarFloat(){let e=this._bb.readVarFloat();return this._helper.hashF(e),e}readVarUint(){let e=this._bb.readVarUint();return this._helper.hashI(e),e}readVarInt(){let e=this._bb.readVarInt();return this._helper.hashI(e),e}readVarUint64(){let e=this._bb.readVarUint64();return this._helper.hashStr(e),e}readVarInt64(){let e=this._bb.readVarInt64();return this._helper.hashStr(e),e}readString(){let e=this._bb.readString();return this._helper.hashStr(e),e}}});var Vl,Ff=bo(()=>{Vl=class{constructor(e,t){this._buckets=new Map,this._hash=e,this._equals=t}get(e,t){let n=this._hash(e),r=this._buckets.get(n);if(r!==void 0)for(let o=0;o<r.length;++o){let a=r[o];if(this._equals(e,a.key))return a.value}return t}set(e,t){let n=this._hash(e),r=this._buckets.get(n);r===void 0&&(r=[],this._buckets.set(n,r));for(let o=0;o<r.length;++o){let a=r[o];if(this._equals(e,a.key))return a.value=t,t}return r.push({key:e,value:t}),t}remove(e){let t=this._hash(e),n=this._buckets.get(t);if(n!==void 0){for(let r=0;r<n.length;++r)if(this._equals(e,n[r].key)){n.splice(r,1),n.length===0&&this._buckets.delete(t);break}}}}});function Xe(i){return JSON.stringify(i)}function rn(i,e,t){var n=new Error(i);throw n.line=e,n.column=t,n}var Qa=bo(()=>{});var Bf={};di(Bf,{nativeTypes:()=>Lf,parseSchema:()=>Ch,reservedNames:()=>Mf});function YT(i){let e=i.split(LT),t=[],n=0,r=0;for(let o=0;o<e.length;o++){let a=e[o];o&1?MT.test(a)||t.push({text:a,line:r+1,column:n+1}):a!==""&&rn("Syntax error "+Xe(a),r+1,n+1);let s=a.split(`
`);s.length>1&&(n=0),r+=s.length-1,n+=s[s.length-1].length}return t.push({text:"",line:r,column:n}),t}function XT(i){function e(){return i[s]}function t(l){return l.test(e().text)?(s++,!0):!1}function n(l,d){if(!t(l)){let c=e();rn("Expected "+d+" but found "+Xe(c.text),c.line,c.column)}}function r(){let l=e();rn("Unexpected token "+Xe(l.text),l.line,l.column)}let o=[],a=null,s=0;for(t(KT)&&(a=e().text,n(xd,"identifier"),n(Df,'";"'));s<i.length&&!t(VT);){let l=[],d;t(zT)?d="ENUM":t(WT)?d="STRUCT":t(QT)?d="MESSAGE":r();let c=e();for(n(xd,"identifier"),n(UT,'"{"');!t(GT);){let p=null,u=!1,h=!1;d!=="ENUM"&&(p=e().text,n(xd,"identifier"),u=t(HT));let f=e();n(xd,"identifier");let y=null;d!=="STRUCT"&&(n(BT,'"="'),y=e(),n(kT,"integer"),(+y.text|0)+""!==y.text&&rn("Invalid integer "+Xe(y.text),y.line,y.column));let g=e();t(qT)&&(d!=="MESSAGE"&&rn("Cannot deprecate this field",g.line,g.column),h=!0),n(Df,'";"'),l.push({name:f.text,line:f.line,column:f.column,type:p,isArray:u,isDeprecated:h,value:y!==null?+y.text|0:l.length+1})}o.push({name:c.text,line:c.line,column:c.column,kind:d,fields:l})}return{package:a,definitions:o}}function JT(i){let e=Lf.slice(),t={};for(let o=0;o<i.definitions.length;o++){let a=i.definitions[o];e.indexOf(a.name)!==-1&&rn("The type "+Xe(a.name)+" is defined twice",a.line,a.column),Mf.indexOf(a.name)!==-1&&rn("The type name "+Xe(a.name)+" is reserved",a.line,a.column),e.push(a.name),t[a.name]=a}for(let o=0;o<i.definitions.length;o++){let a=i.definitions[o],s=a.fields;if(a.kind==="ENUM"||s.length===0)continue;for(let d=0;d<s.length;d++){let c=s[d];e.indexOf(c.type)===-1&&rn("The type "+Xe(c.type)+" is not defined for field "+Xe(c.name),c.line,c.column)}let l=[];for(let d=0;d<s.length;d++){let c=s[d];l.indexOf(c.value)!==-1&&rn("The id for field "+Xe(c.name)+" is used twice",c.line,c.column),c.value<=0&&rn("The id for field "+Xe(c.name)+" must be positive",c.line,c.column),c.value>s.length&&rn("The id for field "+Xe(c.name)+" cannot be larger than "+s.length,c.line,c.column),l.push(c.value)}}let n={},r=o=>{let a=t[o];if(a&&a.kind==="STRUCT"&&(n[o]===1&&rn("Recursive nesting of "+Xe(o)+" is not allowed",a.line,a.column),n[o]!==2&&a)){n[o]=1;let s=a.fields;for(let l=0;l<s.length;l++){let d=s[l];d.isArray||r(d.type)}n[o]=2}return!0};for(let o=0;o<i.definitions.length;o++)r(i.definitions[o].name)}function Ch(i){let e=XT(YT(i));return JT(e),e}var Lf,Mf,LT,xd,MT,BT,VT,Df,kT,UT,GT,HT,zT,WT,QT,KT,qT,Rh=bo(()=>{Qa();Lf=["bool","byte","float","int","string","uint","int64","uint64"],Mf=["ByteBuffer","package"],LT=/((?:-|\b)\d+\b|[=;{}]|\[\]|\[deprecated\]|\b[A-Za-z_][A-Za-z0-9_]*\b|\/\/.*|\s+)/g,xd=/^[A-Za-z_][A-Za-z0-9_]*$/,MT=/^\/\/.*|\s+$/,BT=/^=$/,VT=/^$/,Df=/^;$/,kT=/^-?\d+$/,UT=/^\{$/,GT=/^\}$/,HT=/^\[\]$/,zT=/^enum$/,WT=/^struct$/,QT=/^message$/,KT=/^package$/,qT=/^\[deprecated\]$/});var Vf={};di(Vf,{decodeBinarySchema:()=>wh,encodeBinarySchema:()=>jT});function wh(i){let e=i instanceof pi?i:new pi(i),t=e.readVarUint(),n=[];for(let r=0;r<t;r++){let o=e.readString(),a=e.readByte(),s=e.readVarUint(),l=[];for(let d=0;d<s;d++){let c=e.readString(),p=e.readVarInt(),u=!!(e.readByte()&1),h=e.readVarUint();l.push({name:c,line:0,column:0,type:Oh[a]==="ENUM"?null:p,isArray:u,isDeprecated:!1,value:h})}n.push({name:o,line:0,column:0,kind:Oh[a],fields:l})}for(let r=0;r<t;r++){let o=n[r].fields;for(let a=0;a<o.length;a++){let s=o[a],l=s.type;if(l!==null&&l<0){if(~l>=Nh.length)throw new Error("Invalid type "+l);s.type=Nh[~l]}else{if(l!==null&&l>=n.length)throw new Error("Invalid type "+l);s.type=l===null?null:n[l].name}}}return{package:null,definitions:n}}function jT(i){let e=new pi,t=i.definitions,n={};e.writeVarUint(t.length);for(let r=0;r<t.length;r++)n[t[r].name]=r;for(let r=0;r<t.length;r++){let o=t[r];e.writeString(o.name),e.writeByte(Oh.indexOf(o.kind)),e.writeVarUint(o.fields.length);for(let a=0;a<o.fields.length;a++){let s=o.fields[a],l=Nh.indexOf(s.type);e.writeString(s.name),e.writeVarInt(l===-1?n[s.type]:~l),e.writeByte(s.isArray?1:0),e.writeVarUint(s.value)}}return e.toUint8Array()}var Nh,Oh,xh=bo(()=>{Od();Nh=["bool","byte","int","uint","float","string","int64","uint64"],Oh=["ENUM","STRUCT","MESSAGE"]});var Uf={};di(Uf,{compileSchema:()=>rv,compileSchemaJS:()=>kf});function ZT(i,e,t,n){let r=[],o="  ";r.push("function(bb, optDedupCache) {"),r.push("  var dedupKey = null;"),t.includes(i.name)&&(r.push("  if (!!optDedupCache) {"),r.push("    if (!(optDedupCache instanceof this.HashTable)) {"),r.push('      throw new Error("optDedupCache must be instance of HashTable");'),r.push("    }"),r.push("    // lookahead with hasher then reference result with dedup cache"),r.push("    var hasher = new this.Hasher(bb.getNewWindowFromRight());"),r.push(`    this[${Xe("hash"+i.name)}](hasher);`),r.push(`    dedupKey = { hash: hasher.value(), data: hasher.windowToUint8Array(), defName: ${Xe(i.name)} };`),r.push("    var cachedResult = optDedupCache.get(dedupKey, null);"),r.push("    if (cachedResult !== null) {"),r.push("      bb.extendWindowTo(hasher.bb());"),r.push("      return cachedResult;"),r.push("    }"),r.push("  }")),r.push("  var result = {};"),r.push("  if (!(bb instanceof this.ByteBuffer)) {"),r.push("    bb = new this.ByteBuffer(bb);"),r.push("  }"),r.push(""),i.kind==="MESSAGE"&&(r.push("  while (true) {"),r.push("  var x = bb.readVarUint();"),r.push("    switch (x) {"),r.push("    case 0:"),r.push("      return dedupKey !== null ? optDedupCache.set(dedupKey, result) : result;"),r.push(""),o="      ");for(let a=0;a<i.fields.length;a++){let s=i.fields[a],l,d;switch(s.type){case"bool":{l="!!bb.readByte()",d="!!hasher.readByte()";break}case"byte":{l="bb.readByte()",d="hasher.readByte()";break}case"int":{l="bb.readVarInt()",d="hasher.readVarInt()";break}case"uint":{l="bb.readVarUint()",d="hasher.readVarUint()";break}case"int64":{l="bb.readVarInt64()",d="hasher.readVarInt64()";break}case"uint64":{l="bb.readVarUint64()",d="hasher.readVarUint64()";break}case"float":{l="bb.readVarFloat()",d="hasher.readVarFloat()";break}case"string":{l="bb.readString()",d="hasher.readString()";break}default:{let c=e[s.type];c?c.kind==="ENUM"?(l=`this[${Xe(c.name)}][bb.readVarUint()]`,d=`this[${Xe(c.name)}][hasher.readVarUint()]`):(l=`this[${Xe("decode"+c.name)}](bb, optDedupCache || null)`,d=`this[${Xe("hash"+c.name)}](hasher)`):rn(`Invalid type ${Xe(s.type)} for field ${Xe(s.name)}`,s.line,s.column)}}i.kind==="MESSAGE"&&r.push(`    case ${s.value}:`),s.isArray?s.isDeprecated?s.type==="byte"?r.push(o+"bb.readByteArray();"):(r.push(o+"var length = bb.readVarUint();"),r.push(o+`while (length-- > 0) ${l};`)):s.type==="byte"?r.push(o+`result[${Xe(s.name)}] = bb.readByteArray();`):(r.push(o+"var arrayDedupKey = null;"),r.push(o+"var values = null;"),n.includes(s.type)&&(r.push(o+"if (!!optDedupCache) {"),r.push(o+"  // lookahead with hasher then reference result with dedup cache"),r.push(o+"  var hasher = new this.Hasher(bb.getNewWindowFromRight());"),r.push(o+"  var length = hasher.readVarUint();"),r.push(o+`  for (var i = 0; i < length; i++) ${d};`),r.push(o+`  arrayDedupKey = { hash: hasher.value(), data: hasher.windowToUint8Array(), defName: ${Xe(s.type+"[]")} };`),r.push(o+"  var cachedResult = optDedupCache.get(arrayDedupKey, null);"),r.push(o+"  if (cachedResult !== null) {"),r.push(o+"    bb.extendWindowTo(hasher.bb());"),r.push(o+"    values = cachedResult;"),r.push(o+"  }"),r.push(o+"}")),r.push(o+"if (values === null) {"),r.push(o+"  var length = bb.readVarUint();"),r.push(o+"  var values = Array(length);"),r.push(o+`  for (var i = 0; i < length; i++) values[i] = ${l};`),r.push(o+"  if (arrayDedupKey !== null) { optDedupCache.set(arrayDedupKey, values); }"),r.push(o+"}"),r.push(o+`result[${Xe(s.name)}] = values;`)):s.isDeprecated?r.push(o+`${l};`):r.push(o+`result[${Xe(s.name)}] = ${l};`),i.kind==="MESSAGE"&&(r.push("      break;"),r.push(""))}return i.kind==="MESSAGE"?(r.push("    default:"),r.push('      throw new Error("Attempted to parse invalid message");'),r.push("    }"),r.push("  }")):r.push("  return dedupKey !== null ? optDedupCache.set(dedupKey, result) : result;"),r.push("}"),r.join(`
`)}function $T(i,e){let t=[],n="  ";t.push("function(hasher) {"),t.push("  var result = {};"),t.push("  if (!(hasher instanceof this.Hasher)) {"),t.push('    throw new Error("Expected Hasher");'),t.push("  }"),t.push(""),i.kind==="MESSAGE"&&(t.push("  while (true) {"),t.push("    switch (hasher.readVarUint()) {"),t.push("    case 0:"),t.push("      return;"),t.push(""),n="      ");for(let r=0;r<i.fields.length;r++){let o=i.fields[r],a;switch(o.type){case"bool":{a="hasher.readByte()";break}case"byte":{a="hasher.readByte()";break}case"int":{a="hasher.readVarInt()";break}case"uint":{a="hasher.readVarUint()";break}case"int64":{a="hasher.readVarInt64()";break}case"uint64":{a="hasher.readVarUint64()";break}case"float":{a="hasher.readVarFloat()";break}case"string":{a="hasher.readString()";break}default:{let s=e[o.type];s?s.kind==="ENUM"?a="hasher.readVarUint()":a=`this[${Xe("hash"+s.name)}](hasher)`:rn(`Invalid type ${Xe(o.type)} for field ${Xe(o.name)}`,o.line,o.column)}}i.kind==="MESSAGE"&&t.push(`    case ${o.value}:`),o.isArray?o.type==="byte"?t.push(n+"hasher.readByteArray();"):(t.push(n+"var length = hasher.readVarUint();"),t.push(n+`while (length-- > 0) ${a};`)):t.push(n+`${a};`),i.kind==="MESSAGE"&&(t.push("      break;"),t.push(""))}return i.kind==="MESSAGE"?(t.push("    default:"),t.push('      throw new Error("Attempted to parse invalid message");'),t.push("    }"),t.push("  }")):t.push("  return;"),t.push("}"),t.join(`
`)}function ev(i,e){let t=[];t.push("function(message, bb) {"),t.push("  var isTopLevel = !bb;"),t.push("  if (isTopLevel) bb = new this.ByteBuffer();");for(let n=0;n<i.fields.length;n++){let r=i.fields[n],o;if(!r.isDeprecated){switch(r.type){case"bool":{o="bb.writeByte(value);";break}case"byte":{o="bb.writeByte(value);";break}case"int":{o="bb.writeVarInt(value);";break}case"uint":{o="bb.writeVarUint(value);";break}case"int64":{o="bb.writeVarInt64(value);";break}case"uint64":{o="bb.writeVarUint64(value);";break}case"float":{o="bb.writeVarFloat(value);";break}case"string":{o="bb.writeString(value);";break}default:{let a=e[r.type];if(a)a.kind==="ENUM"?o=`var encoded = this[${Xe(a.name)}][value]; if (encoded === void 0) throw new Error("Invalid value " + JSON.stringify(value) + ${Xe(" for enum "+Xe(a.name))}); bb.writeVarUint(encoded);`:o=`this[${Xe("encode"+a.name)}](value, bb);`;else throw new Error(`Invalid type ${Xe(r.type)} for field ${Xe(r.name)}`)}}t.push(""),t.push(`  var value = message[${Xe(r.name)}];`),t.push("  if (value != null) {"),i.kind==="MESSAGE"&&t.push(`    bb.writeVarUint(${r.value});`),r.isArray?r.type==="byte"?t.push("    bb.writeByteArray(value);"):(t.push("    var values = value, n = values.length;"),t.push("    bb.writeVarUint(n);"),t.push("    for (var i = 0; i < n; i++) {"),t.push("      value = values[i];"),t.push(`      ${o}`),t.push("    }")):t.push(`    ${o}`),i.kind==="STRUCT"&&(t.push("  } else {"),t.push(`    throw new Error(${Xe("Missing required field "+Xe(r.name))});`)),t.push("  }")}}return i.kind==="MESSAGE"&&t.push("  bb.writeVarUint(0);"),t.push(""),t.push("  if (isTopLevel) return bb.toUint8Array();"),t.push("}"),t.join(`
`)}function tv(i){return typeof i=="string"?Ch(i):i instanceof Uint8Array||i instanceof pi?wh(i):i}function kf(i,e,t){i=tv(i);let n={},r=i.package,o=[];r!==null?o.push(`var ${r} = exports || ${r} || {}, exports;`):(o.push("var exports = exports || {};"),r="exports"),o.push(`${r}.ByteBuffer = ${r}.ByteBuffer || require("kiwi-schema").ByteBuffer;`);for(let a=0;a<i.definitions.length;a++){let s=i.definitions[a];n[s.name]=s}for(let a=0;a<i.definitions.length;a++){let s=i.definitions[a];switch(s.kind){case"ENUM":{let l={};for(let d=0;d<s.fields.length;d++){let c=s.fields[d];l[c.name]=c.value,l[c.value]=c.name}o.push(`${r}[${Xe(s.name)}] = ${JSON.stringify(l,null,2)};`);break}case"STRUCT":case"MESSAGE":{o.push(""),o.push(`${r}[${Xe("decode"+s.name)}] = ${ZT(s,n,e,t)};`),o.push(""),o.push(`${r}[${Xe("encode"+s.name)}] = ${ev(s,n)};`),o.push(""),o.push(`${r}[${Xe("hash"+s.name)}] = ${$T(s,n)};`);break}default:rn("Invalid definition kind "+Xe(s.kind),s.line,s.column)}}return o.push(""),o.join(`
`)}function nv(i,e){if(i.length!==e.length)return!1;for(let t=0;t<i.length;t++)if(i[t]!==e[t])return!1;return!0}function rv(i,e){let t={ByteBuffer:pi,Hasher:wd,HashTable:Vl,makeDedupCache:()=>new Vl(o=>o.hash,(o,a)=>o.defName===a.defName&&nv(o.data,a.data))},n=[],r=[];return e&&(n=e.filter(o=>!!o.match(/^[A-Za-z_][A-Za-z0-9_]*$/)),r=e.filter(o=>!!o.match(/^[A-Za-z_][A-Za-z0-9_]*\[\]$/)).map(o=>o.slice(0,o.length-2)),r.length+n.length!==e.length&&console.warn("Some definitions to dedup are invalid identifiers, skipping...")),new Function("exports",kf(i,n,r))(t),t}var Gf=bo(()=>{Od();Pf();Ff();Qa();Rh();xh()});var Kf={};di(Kf,{compileSchemaCallbackCPP:()=>iv});function ov(i,e,t){switch(e){case"bool":return{type:"bool ",name:t};case"byte":return{type:"uint8_t ",name:t};case"int":return{type:"int32_t ",name:t};case"uint":return{type:"uint32_t ",name:t};case"int64":return{type:"int64_t ",name:t};case"uint64":return{type:"uint64_t ",name:t};case"float":return{type:"float ",name:t};case"string":return{type:"const char *",name:t};default:{let n=i[e];return n.kind==="ENUM"?{type:n.name+" ",name:t}:null}}}function Ka(i,e,t,n){let r=[];for(let o=0;o<t.length;o++){let a=t[o],s=e+a.name;if(a.isArray&&!n)return null;let l=ov(i,a.type,s);if(l!==null){r.push(l);continue}let d=i[a.type];if(d.kind!=="STRUCT")return null;let c=Ka(i,s+"_",d.fields,!1);if(c===null)return null;r.push.apply(r,c)}return r}function ws(i){return i.type+i.name}function Wf(i){return i.name}function Qf(i){switch(i.type){case"bool ":return`!bb.readBool(${i.name})`;case"uint8_t ":return`!bb.readByte(${i.name})`;case"int32_t ":return`!bb.readVarInt(${i.name})`;case"uint32_t ":return`!bb.readVarUint(${i.name})`;case"int64_t ":return`!bb.readVarInt64(${i.name})`;case"uint64_t ":return`!bb.readVarUint64(${i.name})`;case"float ":return`!bb.readVarFloat(${i.name})`;case"const char *":return`!bb.readString(${i.name})`;default:return`!bb.readVarUint(reinterpret_cast<uint32_t &>(${i.name}))`}}function Hf(i){switch(i.type){case"bool ":return`_wb.writeBool(${i.name})`;case"uint8_t ":return`_wb.writeByte(${i.name})`;case"int32_t ":return`_wb.writeVarInt(${i.name})`;case"uint32_t ":return`_wb.writeVarUint(${i.name})`;case"int64_t ":return`_wb.writeVarInt64(${i.name})`;case"uint64_t ":return`_wb.writeVarUint64(${i.name})`;case"float ":return`_wb.writeVarFloat(${i.name})`;case"const char *":return`_wb.writeString(${i.name})`;default:return`_wb.writeVarUint(static_cast<uint32_t>(${i.name}))`}}function zf(i,e,t,n,r){let o=n.name;if(n.isArray){let s=`_${o}_count`;i.push(r+`uint32_t ${s};`),i.push(r+`if (!bb.readVarUint(${s})) return false;`),n.isDeprecated||i.push(r+`visitor.visit${t.name}_${n.name}_count(${s});`),i.push(r+`while (${s}-- > 0) {`),r+="  ",o+="_element"}let a=Ka(e,"",[n],!0);if(a!==null){for(let s=0;s<a.length;s++)i.push(r+`${ws(a[s])};`);i.push(r+`if (${a.map(Qf).join(" || ")}) return false;`),n.isDeprecated||i.push(r+`visitor.visit${t.name}_${o}(${a.map(Wf).join(", ")});`)}else{n.isDeprecated||i.push(r+`visitor.visit${t.name}_${o}();`);let s=e[n.type];i.push(r+`if (!parse${s.name}(bb, visitor)) return false;`)}n.isArray&&i.push(r.slice(2)+"}")}function iv(i){let e={},t=[];for(let n=0;n<i.definitions.length;n++){let r=i.definitions[n];e[r.name]=r}i.package!==null&&(t.push(`#ifndef INCLUDE_${i.package.toUpperCase()}_H`),t.push(`#define INCLUDE_${i.package.toUpperCase()}_H`),t.push("")),t.push('#include "kiwi.h"'),t.push(""),i.package!==null&&(t.push(`namespace ${i.package} {`),t.push(""));for(let n=0;n<i.definitions.length;n++){let r=i.definitions[n];if(r.kind==="ENUM"){t.push(`enum class ${r.name} : uint32_t {`);for(let o=0;o<r.fields.length;o++){let a=r.fields[o];a.isDeprecated||t.push(`  ${a.name} = ${a.value},`)}t.push("};"),t.push("")}}for(let n=0;n<2;n++){let r=") = 0;";n===0?(t.push("class Visitor {"),t.push("public:")):(t.push("class Writer : public Visitor {"),t.push("private:"),t.push("  kiwi::WriteBuffer &_wb;"),t.push("public:"),t.push("  Writer(kiwi::WriteBuffer &wb) : _wb(wb) {}"),r=") override;");for(let o=0;o<i.definitions.length;o++){let a=i.definitions[o];if(a.kind==="STRUCT"){let s=Ka(e,"",a.fields,!1);if(s!==null){t.push(`  virtual void visit${a.name}(${s.map(ws).join(", ")}${r}`);continue}}if(a.kind==="STRUCT"||a.kind==="MESSAGE"){t.push(`  virtual void begin${a.name}(${r}`);for(let s=0;s<a.fields.length;s++){let l=a.fields[s];if(l.isDeprecated)continue;let d=l.name;l.isArray&&(t.push(`  virtual void visit${a.name}_${l.name}_count(uint32_t size${r}`),d+="_element");let c=Ka(e,"",[l],!0);c!==null?t.push(`  virtual void visit${a.name}_${d}(${c.map(ws).join(", ")}${r}`):t.push(`  virtual void visit${a.name}_${d}(${r}`)}t.push(`  virtual void end${a.name}(${r}`)}}t.push("};"),t.push("")}for(let n=0;n<i.definitions.length;n++){let r=i.definitions[n];(r.kind==="STRUCT"||r.kind==="MESSAGE")&&t.push(`bool parse${r.name}(kiwi::ByteBuffer &bb, Visitor &visitor);`)}t.push(""),t.push("#ifdef IMPLEMENT_SCHEMA_H"),t.push("");for(let n=0;n<i.definitions.length;n++){let r=i.definitions[n];if(r.kind==="STRUCT"){let o=Ka(e,"",r.fields,!1);if(o!==null){t.push(`bool parse${r.name}(kiwi::ByteBuffer &bb, Visitor &visitor) {`);for(let a=0;a<o.length;a++)t.push(`  ${ws(o[a])};`);t.push(`  if (${o.map(Qf).join(" || ")}) return false;`),t.push(`  visitor.visit${r.name}(${o.map(Wf).join(", ")});`),t.push("  return true;"),t.push("}"),t.push("")}else{t.push(`bool parse${r.name}(kiwi::ByteBuffer &bb, Visitor &visitor) {`),t.push(`  visitor.begin${r.name}();`);for(let a=0;a<r.fields.length;a++){let s=r.fields[a];zf(t,e,r,s,"  ")}t.push(`  visitor.end${r.name}();`),t.push("  return true;"),t.push("}"),t.push("")}}else if(r.kind==="MESSAGE"){t.push(`bool parse${r.name}(kiwi::ByteBuffer &bb, Visitor &visitor) {`),t.push(`  visitor.begin${r.name}();`),t.push("  while (true) {"),t.push("    uint32_t _type;"),t.push("    if (!bb.readVarUint(_type)) return false;"),t.push("    switch (_type) {"),t.push("      case 0: {"),t.push(`        visitor.end${r.name}();`),t.push("        return true;"),t.push("      }");for(let o=0;o<r.fields.length;o++){let a=r.fields[o];t.push(`      case ${a.value}: {`),zf(t,e,r,a,"        "),t.push("        break;"),t.push("      }")}t.push("      default: return false;"),t.push("    }"),t.push("  }"),t.push("}"),t.push("")}}for(let n=0;n<i.definitions.length;n++){let r=i.definitions[n];if(r.kind==="STRUCT"){let o=Ka(e,"",r.fields,!1);if(o!==null){t.push(`void Writer::visit${r.name}(${o.map(ws).join(", ")}) {`);for(let a=0;a<o.length;a++)t.push(`  ${Hf(o[a])};`);t.push("}"),t.push("");continue}}if(r.kind==="STRUCT"||r.kind==="MESSAGE"){t.push(`void Writer::begin${r.name}() {`),t.push("}"),t.push("");for(let o=0;o<r.fields.length;o++){let a=r.fields[o];if(a.isDeprecated)continue;let s=a.name;a.isArray&&(t.push(`void Writer::visit${r.name}_${a.name}_count(uint32_t size) {`),r.kind==="MESSAGE"&&t.push(`  _wb.writeVarUint(${a.value});`),t.push("  _wb.writeVarUint(size);"),t.push("}"),t.push(""),s+="_element");let l=Ka(e,"",[a],!0);if(l!==null){t.push(`void Writer::visit${r.name}_${s}(${l.map(ws).join(", ")}) {`),r.kind==="MESSAGE"&&!a.isArray&&t.push(`  _wb.writeVarUint(${a.value});`);for(let d=0;d<l.length;d++)t.push(`  ${Hf(l[d])};`);t.push("}"),t.push("")}else t.push(`void Writer::visit${r.name}_${s}() {`),r.kind==="MESSAGE"&&!a.isArray&&t.push(`  _wb.writeVarUint(${a.value});`),t.push("}"),t.push("")}t.push(`void Writer::end${r.name}() {`),r.kind==="MESSAGE"&&t.push("  _wb.writeVarUint(0);"),t.push("}"),t.push("")}}return t.push("#endif"),t.push(""),i.package!==null&&(t.push("}"),t.push(""),t.push("#endif"),t.push("")),t.join(`
`)}var qf=bo(()=>{});var jf={};di(jf,{compileSchemaCPP:()=>mv,compileSchemaEnumsCPP:()=>gv});function mr(i,e,t){let n;switch(e.type){case"bool":n="bool";break;case"byte":n="uint8_t";break;case"int":n="int32_t";break;case"uint":n="uint32_t";break;case"int64":n="int64_t";break;case"uint64":n="uint64_t";break;case"float":n="float";break;case"string":n="kiwi::String";break;default:{let r=i[e.type];r||rn(`Invalid type ${Xe(e.type)} for field ${Xe(e.name)}`,e.line,e.column),n=r.name;break}}return t&&(n=`kiwi::Array<${n}>`),n}function Mi(i){return"_data_"+i.name}function Fh(i){return i>>5}function Dh(i){return`(1 << ${i%32})`}function to(i,e){return!e.isArray&&e.type in i&&i[e.type].kind!=="ENUM"}function Ph(i,e,t){switch(e.type){case"bool":return`_wb.writeBool(${t});`;case"byte":return`_wb.writeByte(${t});`;case"int":return`_wb.writeVarInt(${t});`;case"uint":return`_wb.writeVarUint(${t});`;case"int64":return`_wb.writeVarInt64(${t});`;case"uint64":return`_wb.writeVarUint64(${t});`;case"float":return`_wb.writeVarFloat(${t});`;case"string":return`_wb.writeString(${t}.c_str());`;default:{let n=i[e.type];if(!n)rn(`Invalid type ${Xe(e.type)} for field ${Xe(e.name)}`,e.line,e.column);else return n.kind==="ENUM"?`_wb.writeVarUint(static_cast<uint32_t>(${t}));`:`if (!${t}${to(i,e)?"->":"."}encode(_wb)) return false;`}}}function Yf(i,e,t){let n=to(i,e);switch(e.type){case"bool":return`_bb.readBool(${t})`;case"byte":return`_bb.readByte(${t})`;case"int":return`_bb.readVarInt(${t})`;case"uint":return`_bb.readVarUint(${t})`;case"int64":return`_bb.readVarInt64(${t})`;case"uint64":return`_bb.readVarUint64(${t})`;case"float":return`_bb.readVarFloat(${t})`;case"string":return`_bb.readString(${t}, _pool)`;default:{let r=i[e.type];if(!r)rn(`Invalid type ${Xe(e.type)} for field ${Xe(e.name)}`,e.line,e.column);else return r.kind==="ENUM"?`_bb.readVarUint(reinterpret_cast<uint32_t &>(${t}))`:`${t+(n?"->":".")}decode(_bb, _pool, _schema)`}}}function Xf(i){let e={bool:1,byte:1,int:4,uint:4,float:4};return i.slice().sort(function(t,n){let r=!t.isArray&&e[t.type]||8,o=!n.isArray&&e[n.type]||8;return r!==o?o-r:i.indexOf(t)-i.indexOf(n)})}function av(i,e,t){let n=i.fields,r=[];r.push(`class ${i.name} {`),r.push("public:"),r.push(`  ${i.name}() { (void)_flags; }`),t||(r.push(`  ${i.name}(const ${i.name}&) = delete;`),r.push(`  ${i.name}& operator=(const ${i.name}&) = delete;`)),r.push(`  ${i.name}(${i.name}&&) = default;`),r.push(`  ${i.name}& operator=(${i.name}&&) = default;`),r.push(""),t&&(r.push(`  ${i.name} copy() const;`),r.push(""));for(let s=0;s<n.length;s++){let l=n[s];if(l.isDeprecated)continue;let d=mr(e,l,l.isArray);r.push(`  ${d} *${l.name}();`),r.push(`  const ${d} *${l.name}() const;`),to(e,l)?r.push(`  void set_${l.name}(${d} *value);`):l.isArray?r.push(`  ${d} &set_${l.name}(kiwi::MemoryPool &pool, uint32_t count);`):r.push(`  void set_${l.name}(const ${d} &value);`),r.push("")}r.push("  bool encode(kiwi::WriteBuffer &wb) const;"),r.push("  bool decode(kiwi::ByteBuffer &bb, kiwi::MemoryPool &pool, const BinarySchema *schema = nullptr);"),r.push(""),r.push("private:"),t&&(r.push(`  ${i.name}(const ${i.name}&) = default;`),r.push(`  ${i.name}& operator=(const ${i.name}&) = default;`)),r.push(`  uint32_t _flags[${n.length+31>>5}] = {};`);let o=Xf(n),a="  ";for(let s=0;s<o.length;s++){let l=o[s];if(l.isDeprecated)continue;let d=Mi(l),c=mr(e,l,l.isArray);to(e,l)?r.push(a+`${c} *${d} = {};`):r.push(a+`${c} ${d} = {};`)}return r.push("};"),r.push(""),r}function sv(i,e,t){let n=i.fields,r=[];r.push(`class ${i.name} {`),r.push("public:"),r.push(`  ${i.name}() { (void)_flags; }`),r.push(`  ${i.name}(const ${i.name}&) = delete;`),r.push(`  ${i.name}& operator=(const ${i.name}&) = delete;`),r.push(`  ${i.name}(${i.name}&&) = default;`),r.push(`  ${i.name}& operator=(${i.name}&&) = default;`),r.push(""),t&&(r.push(`  ${i.name} copy(kiwi::MemoryPool& pool) const;`),r.push(""));for(let s=0;s<n.length;s++){let l=n[s];if(l.isDeprecated)continue;let d=mr(e,l,l.isArray);to(e,l)?(r.push(`  ${d} *${l.name}();`),r.push(`  const ${d} *${l.name}() const;`)):r.push(`  kiwi::Optional<${d}> ${l.name}() const;`),to(e,l)?r.push(`  void set_${l.name}(kiwi::MemoryPool &pool, ${d} *value);`):l.isArray?r.push(`  ${d} &set_${l.name}(kiwi::MemoryPool &pool, uint32_t count);`):r.push(`  void set_${l.name}(kiwi::MemoryPool &pool, const ${d} &value);`),r.push("")}r.push("  bool encode(kiwi::WriteBuffer &wb) const;"),r.push("  bool encode2(kiwi::WriteBuffer &wb) const;"),r.push("  bool decode(kiwi::ByteBuffer &bb, kiwi::MemoryPool &pool, const BinarySchema *schema = nullptr);"),r.push(""),r.push("private:"),r.push(`  uint32_t _flags[${n.length+31>>5}] = {};`);let o=Xf(n);r.push("  union Field {"),r.push("  public:"),r.push("    bool operator==(const Field&) const { return false; }");let a="    ";for(let s=0;s<o.length;s++){let l=o[s];if(l.isDeprecated)continue;let d=Mi(l),c=mr(e,l,l.isArray);to(e,l)?r.push(a+`${c} *${d};`):r.push(a+`${c} ${d};`)}return r.push("  };"),r.push("  kiwi::SparseFields<Field> _fields;"),r.push("  friend std::hash<Field>;"),r.push("};"),r.push(""),r}function lv(i,e,t){let n=i.fields,r=[];t&&(r.push(`inline ${i.name} ${i.name}::copy() const {`),r.push(`  ${i.name} clone = *this;`),r.push("  return clone;"),r.push("}"),r.push(""));for(let o=0;o<n.length;o++){let a=n[o],s=Mi(a),l=mr(e,a,a.isArray),d=Fh(o),c=Dh(o);if(a.isDeprecated)continue;let p=`_flags[${d}] |= ${c}`,u=`_flags[${d}] & ${c}`;to(e,a)?(r.push(`inline ${l} *${i.name}::${a.name}() {`),r.push(`  return ${s};`),r.push("}"),r.push(""),r.push(`inline const ${l} *${i.name}::${a.name}() const {`),r.push(`  return ${s};`),r.push("}"),r.push(""),r.push(`inline void ${i.name}::set_${a.name}(${l} *value) {`),r.push(`  ${s} = value;`),r.push("}"),r.push("")):a.isArray?(r.push(`inline ${l} *${i.name}::${a.name}() {`),r.push(`  return ${u} ? &${s} : nullptr;`),r.push("}"),r.push(""),r.push(`inline const ${l} *${i.name}::${a.name}() const {`),r.push(`  return ${u} ? &${s} : nullptr;`),r.push("}"),r.push(""),r.push(`inline ${l} &${i.name}::set_${a.name}(kiwi::MemoryPool &pool, uint32_t count) {`),r.push(`  ${p}; return ${s} = pool.array<${mr(e,a,!1)}>(count);`),r.push("}"),r.push("")):(r.push(`inline ${l} *${i.name}::${a.name}() {`),r.push(`  return ${u} ? &${s} : nullptr;`),r.push("}"),r.push(""),r.push(`inline const ${l} *${i.name}::${a.name}() const {`),r.push(`  return ${u} ? &${s} : nullptr;`),r.push("}"),r.push(""),r.push(`inline void ${i.name}::set_${a.name}(const ${l} &value) {`),r.push(`  ${p}; ${s} = value;`),r.push("}"),r.push(""))}return r}function cv(i,e){let t=i.fields,n=[];n.push(`bool ${i.name}::encode(kiwi::WriteBuffer &_wb) const {`);for(let r=0;r<t.length;r++){let o=t[r];if(o.isDeprecated)continue;let a="  ";i.kind==="STRUCT"?n.push(`  if (${o.name}() == nullptr) return false;`):(n.push(`  if (${o.name}() != nullptr) {`),a="    ");let s=Mi(o),l=o.isArray?"_it":s,d=Ph(e,o,l);i.kind==="MESSAGE"&&n.push(a+`_wb.writeVarUint(${o.value});`),o.isArray?(n.push(a+`_wb.writeVarUint(${s}.size());`),n.push(a+`for (const ${mr(e,o,!1)} &_it : ${s}) ${d}`)):n.push(a+d),i.kind!=="STRUCT"&&n.push("  }")}return i.kind==="MESSAGE"&&n.push("  _wb.writeVarUint(0);"),n.push("  return true;"),n.push("}"),n.push(""),n}function dv(i,e){let t=i.fields,n=[];n.push(`bool ${i.name}::decode(kiwi::ByteBuffer &_bb, kiwi::MemoryPool &_pool, const BinarySchema *_schema) {`);for(let r=0;r<t.length;r++)if(t[r].isArray){n.push("  uint32_t count;");break}i.kind==="MESSAGE"&&(n.push("  while (true) {"),n.push("    uint32_t type;"),n.push("    if (!_bb.readVarUint(type)) return false;"),n.push("    switch (type) {"),n.push("      case 0:"),n.push("        return true;"));for(let r=0;r<t.length;r++){let o=t[r],a=Mi(o),s=o.isArray?"_it":a,l=to(e,o),d=Yf(e,o,s),c=mr(e,o,!1),p="  ";i.kind==="MESSAGE"&&(n.push(`      case ${o.value}: {`),p="        "),o.isArray?(n.push(p+"if (!_bb.readVarUint(count)) return false;"),o.isDeprecated?o.type==="byte"?n.push(p+"if (!_bb.skipCount(count)) return false;"):n.push(p+`for (${c} &_it : _pool.array<${c}>(count)) if (!${d}) return false;`):o.type==="byte"?n.push(p+`if (!_bb.readByteArray(set_${o.name}(_pool, count).data(), count)) return false;`):n.push(p+`for (${c} &_it : set_${o.name}(_pool, count)) if (!${d}) return false;`)):o.isDeprecated?(l?n.push(p+`${c} *${a} = _pool.allocate<${c}>();`):n.push(p+`${c} ${a} = {};`),n.push(p+`if (!${d}) return false;`)):(l&&n.push(p+`${a} = _pool.allocate<${c}>();`),n.push(p+`if (!${d}) return false;`),l||n.push(p+`set_${o.name}(${a});`)),i.kind==="MESSAGE"&&(n.push("        break;"),n.push("      }"))}return i.kind==="MESSAGE"?(n.push("      default: {"),n.push(`        if (!_schema || !_schema->skip${i.name}Field(_bb, type)) return false;`),n.push("        break;"),n.push("      }"),n.push("    }"),n.push("  }")):n.push("  return true;"),n.push("}"),n.push(""),n}function uv(i,e,t){let n=i.fields,r=[];t&&(r.push(`inline ${i.name} ${i.name}::copy(kiwi::MemoryPool& pool) const {`),r.push(`  ${i.name} clone;`),r.push("  clone._fields = _fields.copy(pool);"),r.push("  memcpy(clone._flags, _flags, sizeof(_flags));"),r.push("  return clone;"),r.push("}"),r.push(""));for(let o=0;o<n.length;o++){let a=n[o],s=Mi(a),l=mr(e,a,a.isArray),d=Fh(o),c=Dh(o);if(a.isDeprecated)continue;let p=`_flags[${d}] |= ${c}`,u=`_flags[${d}] & ${c}`,h=to(e,a);h?(r.push(`inline ${l} *${i.name}::${a.name}() {`),r.push(`  if (!(${u})) return nullptr;`),r.push(`  Field* field = _fields.getField(${a.value});`),r.push(`  return field ? ${h?"":"&"}field->${s} : nullptr;`),r.push("}"),r.push(""),r.push(`inline const ${l} *${i.name}::${a.name}() const {`),r.push(`  if (!(${u})) return nullptr;`),r.push(`  const Field* field = _fields.getField(${a.value});`),r.push(`  return field ? ${h?"":"&"}field->${s} : nullptr;`),r.push("}"),r.push("")):(r.push(`inline kiwi::Optional<${l}> ${i.name}::${a.name}() const {`),r.push(`  if (!(${u})) return std::nullopt;`),r.push(`  const Field* field = _fields.getField(${a.value});`),r.push(`  return field ? kiwi::Optional<${l}>(field->${s}) : std::nullopt;`),r.push("}"),r.push("")),to(e,a)?r.push(`inline void ${i.name}::set_${a.name}(kiwi::MemoryPool &pool, ${l} *value) {`):a.isArray?(r.push(`inline ${l} &${i.name}::set_${a.name}(kiwi::MemoryPool &pool, uint32_t count) {`),r.push(`  ${l} value = pool.array<${mr(e,a,!1)}>(count);`)):r.push(`inline void ${i.name}::set_${a.name}(kiwi::MemoryPool &pool, const ${l} &value) {`),r.push(`  if (${u}) {`),r.push(`    Field* field = _fields.getField(${a.value});`),r.push(`    field->${s} = value;`),a.isArray&&r.push(`    return field->${s};`),r.push("  } else {"),r.push(`    ${p};`),a.isArray?r.push(`    return _fields.addField({${a.value}, Field{.${s} = value}}, pool)->field.${s};`):r.push(`    _fields.addField({${a.value}, Field{.${s} = value}}, pool);`),r.push("  }"),r.push("}"),r.push("")}return r}function pv(i,e){let t=i.fields,n=[];n.push(`bool ${i.name}::encode(kiwi::WriteBuffer &_wb) const {`);for(let o=0;o<t.length;o++){let a=t[o];if(a.isDeprecated)continue;let s=mr(e,a,a.isArray),l=to(e,a),d;l?d=`${s}*`:d=`kiwi::Optional<${s}>`;let c=Mi(a);n.push(`  const ${d} ${c} = ${a.name}();`),n.push(`  if (${c}) {`),l?n.push(`    const ${mr(e,a,a.isArray)}* _data = ${c};`):n.push(`    const ${mr(e,a,a.isArray)}& _data = *${c};`);let p="    ";c="_data";let u=a.isArray?"_it":c,h=Ph(e,a,u);n.push(p+`_wb.writeVarUint(${a.value});`),a.isArray?(n.push(p+`_wb.writeVarUint(${c}.size());`),n.push(p+`for (const ${mr(e,a,!1)} &_it : ${c}) ${h}`)):n.push(p+h),n.push("  }")}n.push("  _wb.writeVarUint(0);"),n.push("  return true;"),n.push("}"),n.push(""),n.push(`bool ${i.name}::encode2(kiwi::WriteBuffer &_wb) const {`),n.push("  for (auto* it = _fields.begin(); it != _fields.end(); it++) {"),n.push("    uint32_t index = it->index;"),n.push("    const Field& field = it->field;"),n.push("    _wb.writeVarUint(index);"),n.push("    switch (index) {");let r="      ";for(let o=0;o<t.length;o++){let a=t[o];if(a.isDeprecated)continue;let s=mr(e,a,a.isArray),l=to(e,a),d=Mi(a),c=a.isArray?"_it":d,p=Ph(e,a,c);n.push(r+`case ${a.value}: {`),n.push(r+`  const ${s}${l?"*":"&"} ${d} = field.${d};`),a.isArray?(n.push(r+`  _wb.writeVarUint(${d}.size());`),n.push(r+`  for (const ${mr(e,a,!1)} &_it : ${d}) ${p}`)):n.push(r+"  "+p),n.push(r+"  break;"),n.push(r+"}")}return n.push("      default: {"),n.push("        continue;"),n.push("      }"),n.push("    }"),n.push("  }"),n.push("  _wb.writeVarUint(0);"),n.push("  return true;"),n.push("}"),n.push(""),n}function hv(i,e){let t=i.fields,n=[];n.push(`bool ${i.name}::decode(kiwi::ByteBuffer &_bb, kiwi::MemoryPool &_pool, const BinarySchema *_schema) {`);for(let r=0;r<t.length;r++)if(t[r].isArray){n.push("  uint32_t count;");break}n.push("  std::vector<kiwi::SparseFields<Field>::Element> tempFields;"),n.push("  while (true) {"),n.push("    uint32_t type;"),n.push("    if (!_bb.readVarUint(type)) return false;"),n.push("    switch (type) {"),n.push("      case 0: {"),n.push("        _fields = kiwi::SparseFields<Field>(tempFields.data(), tempFields.size(), _pool);"),n.push("        return true;"),n.push("      }");for(let r=0;r<t.length;r++){let o=t[r],a=Mi(o),s=o.isArray?"_it":a,l=to(e,o),d=Yf(e,o,s),c=mr(e,o,!1),p=Fh(r),u=Dh(r),h=`_flags[${p}] |= ${u}`;n.push(`      case ${o.value}: {`);let f="        ";o.isArray?(n.push(f+"if (!_bb.readVarUint(count)) return false;"),o.isDeprecated?o.type==="byte"?n.push(f+"if (!_bb.skipCount(count)) return false;"):n.push(f+`for (${c} &_it : _pool.array<${c}>(count)) if (!${d}) return false;`):(n.push(f+`${h};`),n.push(f+`${mr(e,o,!0)} ${a} = _pool.array<${c}>(count);`),o.type==="byte"?n.push(f+`if (!_bb.readByteArray(${a}.data(), count)) return false;`):n.push(f+`for (${c} &_it : ${a}) if (!${d}) return false;`),n.push(f+`tempFields.push_back({${o.value}, Field{.${a} = ${a}}});`))):(l?n.push(f+`${c}* ${a} = _pool.allocate<${c}>();`):n.push(f+`${c} ${a} = {};`),n.push(f+`if (!${d}) return false;`),o.isDeprecated||(n.push(f+`${h};`),n.push(f+`tempFields.push_back({${o.value}, Field{.${a} = ${a}}});`))),n.push("        break;"),n.push("      }")}return n.push("      default: {"),n.push(`        if (!_schema || !_schema->skip${i.name}Field(_bb, type)) return false;`),n.push("        break;"),n.push("      }"),n.push("    }"),n.push("  }"),n.push("}"),n.push(""),n}function mv(i,e={}){let t={};for(let s of i.definitions)t[s.name]=s;let{sparseMessages:n=[],copyableMessages:r=[],separateEnumFile:o}=e;for(let s of n)s in t||rn(`Requesting sparse implementation for ${Xe(s)} which is not defined in the schema`,0,0);let a=[];a.push('#include "kiwi.h"'),o&&a.push(`#include "${o}"`),a.push(""),i.package!==null&&(a.push(`namespace ${i.package} {`),a.push(""),a.push(`#ifndef INCLUDE_${i.package.toUpperCase()}_H`),a.push(`#define INCLUDE_${i.package.toUpperCase()}_H`),a.push("")),a.push("class BinarySchema {"),a.push("public:"),a.push("  bool parse(kiwi::ByteBuffer &bb);"),a.push("  const kiwi::BinarySchema &underlyingSchema() const { return _schema; }");for(let s=0;s<i.definitions.length;s++){let l=i.definitions[s];l.kind==="MESSAGE"&&a.push(`  bool skip${l.name}Field(kiwi::ByteBuffer &bb, uint32_t id) const;`)}a.push(""),a.push("private:"),a.push("  kiwi::BinarySchema _schema;");for(let s=0;s<i.definitions.length;s++){let l=i.definitions[s];l.kind==="MESSAGE"&&a.push(`  uint32_t _index${l.name} = 0;`)}a.push("};"),a.push(""),o||Jf(i,a);for(let s of[0,1,2,3]){let l=!1;if(s===3){if(i.package!==null){if(n.length>0){a.push(`}  // namespace ${i.package}`);for(let d of n)a.push("template<>"),a.push(`struct std::hash<${i.package}::${d}::Field> {`),a.push(`  size_t operator()(const ${i.package}::${d}::Field& msg) const {`),a.push("    return 0;"),a.push("  }"),a.push("};");a.push(`namespace ${i.package} {`)}a.push(`#endif  // INCLUDE_${i.package.toUpperCase()}_H`)}a.push("#ifdef IMPLEMENT_SCHEMA_H"),a.push(""),a.push("bool BinarySchema::parse(kiwi::ByteBuffer &bb) {"),a.push("  if (!_schema.parse(bb)) return false;");for(let d=0;d<i.definitions.length;d++){let c=i.definitions[d];c.kind==="MESSAGE"&&a.push(`  _schema.findDefinition("${c.name}", _index${c.name});`)}a.push("  return true;"),a.push("}"),a.push("");for(let d=0;d<i.definitions.length;d++){let c=i.definitions[d];c.kind==="MESSAGE"&&(a.push(`bool BinarySchema::skip${c.name}Field(kiwi::ByteBuffer &bb, uint32_t id) const {`),a.push(`  return _schema.skipField(bb, _index${c.name}, id);`),a.push("}"),a.push(""))}}for(let d=0;d<i.definitions.length;d++){let c=i.definitions[d];if(c.kind==="ENUM")continue;let p=n.includes(c.name);if(p&&c.kind!=="MESSAGE"){let u=`Type ${Xe(c.name)} cannot be declared as sparse. `;u+=`${Xe(c.name)} is type ${Xe(c.kind)}, but needs to be a MESSAGE.`,rn(u,c.line,c.column)}s===0?(a.push(`class ${c.name};`),l=!0):s===1?p?a=a.concat(sv(c,t,r.includes(c.name))):a=a.concat(av(c,t,r.includes(c.name))):s===2?p?a=a.concat(uv(c,t,r.includes(c.name))):a=a.concat(lv(c,t,r.includes(c.name))):p?(a=a.concat(pv(c,t)),a=a.concat(hv(c,t))):(a=a.concat(cv(c,t)),a=a.concat(dv(c,t)))}s===3?(a.push("#endif  // IMPLEMENT_SCHEMA_H"),a.push("")):l&&a.push("")}return i.package!==null&&(a.push(`}  // namespace ${i.package}`),a.push("")),a.join(`
`)}function gv(i){let e=["#pragma once",""];return i.package&&(e.push(`namespace ${i.package} {`),e.push("")),Jf(i,e),i.package&&(e.push(""),e.push(`}  // namespace ${i.package}`),e.push("")),e.join(`
`)}function Jf(i,e){for(let t of i.definitions)if(t.kind==="ENUM"){e.push(`enum class ${t.name} : uint32_t {`);for(let n=0;n<t.fields.length;n++){let r=t.fields[n];e.push(`  ${r.name} = ${r.value},`)}e.push("};"),e.push("")}}var Zf=bo(()=>{Qa()});var t_={};di(t_,{compileSchemaSkew:()=>_v});function $f(i){i[i.length-1]===""&&i.pop()}function fv(i,e){if(e.isArray)return"null";switch(e.type){case"bool":return"false";case"byte":case"int":case"uint":return"0";case"int64":case"uint64":return'"0"';case"float":return"0.0";case"string":return"null"}let t=i[e.type];return t.kind==="ENUM"?t.fields.length>0?"."+t.fields[0].name:"0 as "+e.type:"null"}function e_(i){let e;switch(i.type){case"bool":e="bool";break;case"byte":case"int":case"uint":e="int";break;case"int64":case"uint64":e="string";break;case"float":e="double";break;case"string":default:e=i.type;break}return i.isArray&&(e="List<"+e+">"),e}function _v(i){let e={},t="",n=[];i.package!==null&&(n.push("namespace "+i.package+" {"),t+="  ");for(let r=0;r<i.definitions.length;r++){let o=i.definitions[r];e[o.name]=o}n.push(t+"class BinarySchema {"),n.push(t+"  var _schema = Kiwi.BinarySchema.new");for(let r=0;r<i.definitions.length;r++){let o=i.definitions[r];o.kind==="MESSAGE"&&n.push(t+"  var _index"+o.name+" = 0")}n.push(""),n.push(t+"  def parse(bytes Uint8Array) {"),n.push(t+"    _schema.parse(Kiwi.ByteBuffer.new(bytes))");for(let r=0;r<i.definitions.length;r++){let o=i.definitions[r];o.kind==="MESSAGE"&&n.push(t+"    _index"+o.name+' = _schema.findDefinition("'+o.name+'")')}n.push(t+"  }");for(let r=0;r<i.definitions.length;r++){let o=i.definitions[r];o.kind==="MESSAGE"&&(n.push(""),n.push(t+"  def skip"+o.name+"Field(bb Kiwi.ByteBuffer, id int) {"),n.push(t+"    _schema.skipField(bb, _index"+o.name+", id)"),n.push(t+"  }"))}n.push(t+"}"),n.push("");for(let r=0;r<i.definitions.length;r++){let o=i.definitions[r];switch(o.kind){case"ENUM":{let a={},s={};n.push(t+"enum "+o.name+" {");for(let l=0;l<o.fields.length;l++){let d=o.fields[l];a[d.name]=d.value,s[d.value]=d.name,n.push(t+"  "+d.name)}n.push(t+"}"),n.push(""),n.push(t+"namespace "+o.name+" {"),n.push(t+"  const _encode = "+JSON.stringify(a,null,2).replace(/"/g,"").replace(/\n/g,`
  `+t)),n.push(""),n.push(t+"  const _decode = "+JSON.stringify(s,null,2).replace(/"/g,"").replace(/\n/g,`
  `+t)),n.push(""),n.push(t+"  def encode(value "+o.name+") int {"),n.push(t+"    return _encode[value]"),n.push(t+"  }"),n.push(""),n.push(t+"  def decode(value int) "+o.name+" {"),n.push(t+"    if !(value in _decode) {"),n.push(t+"      Kiwi.DecodeError.throwInvalidEnumValue("+Xe(o.name)+")"),n.push(t+"    }"),n.push(t+"    return _decode[value]"),n.push(t+"  }"),n.push(t+"}"),n.push("");break}case"STRUCT":case"MESSAGE":{n.push(t+"class "+o.name+" {");for(let s=0;s<o.fields.length;s+=32)n.push(t+"  var _flags"+(s>>5)+" = 0");for(let s=0;s<o.fields.length;s++){let l=o.fields[s];l.isDeprecated||n.push(t+"  var _"+l.name+" "+e_(l)+" = "+fv(e,l))}n.push("");for(let s=0;s<o.fields.length;s++){let l=o.fields[s];if(l.isDeprecated)continue;let d=e_(l),c="_flags"+(s>>5),p=""+(1<<s%32>>>0);n.push(t+"  def has_"+l.name+" bool {"),n.push(t+"    return ("+c+" & "+p+") != 0"),n.push(t+"  }"),n.push(""),n.push(t+"  def "+l.name+" "+d+" {"),n.push(t+"    assert(has_"+l.name+")"),n.push(t+"    return _"+l.name),n.push(t+"  }"),n.push(""),n.push(t+"  def "+l.name+"=(value "+d+") {"),n.push(t+"    _"+l.name+" = value"),n.push(t+"    "+c+" |= "+p),n.push(t+"  }"),n.push("")}n.push(t+"  def encode(bb Kiwi.ByteBuffer) {");for(let s=0;s<o.fields.length;s++){let l=o.fields[s];if(l.isDeprecated)continue;let d="_"+l.name,c;switch(l.isArray&&(d="value"),l.type){case"bool":{c="bb.writeByte("+d+" as int)";break}case"byte":{c="bb.writeByte("+d+")";break}case"int":{c="bb.writeVarInt("+d+")";break}case"uint":{c="bb.writeVarUint("+d+")";break}case"int64":{c="bb.writeVarInt64("+d+")";break}case"uint64":{c="bb.writeVarUint64("+d+")";break}case"float":{c="bb.writeVarFloat("+d+")";break}case"string":{c="bb.writeString("+d+")";break}default:{let u=e[l.type];u?u.kind==="ENUM"?c="bb.writeVarUint("+u.name+".encode("+d+"))":c=d+".encode(bb)":rn("Invalid type "+Xe(l.type)+" for field "+Xe(l.name),l.line,l.column)}}let p=t+"    ";o.kind==="STRUCT"?n.push(p+"assert(has_"+l.name+")"):(n.push(p+"if has_"+l.name+" {"),p+="  "),o.kind==="MESSAGE"&&n.push(p+"bb.writeVarUint("+l.value+")"),l.isArray?(n.push(p+"bb.writeVarUint(_"+l.name+".count)"),n.push(p+"for value in _"+l.name+" {"),n.push(p+"  "+c),n.push(p+"}")):n.push(p+c),o.kind!=="STRUCT"&&n.push(t+"    }"),n.push("")}o.kind==="MESSAGE"?n.push(t+"    bb.writeVarUint(0)"):$f(n),n.push(t+"  }"),n.push(""),n.push(t+"  def encode Uint8Array {"),n.push(t+"    var bb = Kiwi.ByteBuffer.new"),n.push(t+"    encode(bb)"),n.push(t+"    return bb.toUint8Array"),n.push(t+"  }"),n.push(t+"}"),n.push(""),n.push(t+"namespace "+o.name+" {"),n.push(t+"  def decode(bytes Uint8Array) "+o.name+" {"),n.push(t+"    return decode(Kiwi.ByteBuffer.new(bytes), null)"),n.push(t+"  }"),n.push(""),n.push(t+"  def decode(bytes Uint8Array, schema BinarySchema) "+o.name+" {"),n.push(t+"    return decode(Kiwi.ByteBuffer.new(bytes), schema)"),n.push(t+"  }"),n.push(""),n.push(t+"  def decode(bb Kiwi.ByteBuffer, schema BinarySchema) "+o.name+" {"),n.push(t+"    var self = new");for(let s=0;s<o.fields.length;s++)if(o.fields[s].isArray){n.push(t+"    var count = 0");break}let a=t+"  ";o.kind==="MESSAGE"&&(n.push(t+"    while true {"),n.push(t+"      var type = bb.readVarUint"),n.push(t+"      switch type {"),n.push(t+"        case 0 {"),n.push(t+"          break"),n.push(t+"        }"),n.push(""),a+="      ");for(let s=0;s<o.fields.length;s++){let l=o.fields[s],d;switch(l.type){case"bool":{d=l.isDeprecated?"bb.readByte":"bb.readByte as bool";break}case"byte":{d="bb.readByte";break}case"int":{d="bb.readVarInt";break}case"uint":{d="bb.readVarUint";break}case"int64":{d="bb.readVarInt64";break}case"uint64":{d="bb.readVarUint64";break}case"float":{d="bb.readVarFloat";break}case"string":{d="bb.readString";break}default:{let c=e[l.type];c?c.kind==="ENUM"?d=c.name+".decode(bb.readVarUint)":d=c.name+".decode(bb, schema)":rn("Invalid type "+Xe(l.type)+" for field "+Xe(l.name),l.line,l.column)}}o.kind==="MESSAGE"&&n.push(a+"case "+l.value+" {"),l.isArray?l.isDeprecated?(n.push(a+"  for i in 0..bb.readVarUint {"),n.push(a+"    "+d),n.push(a+"  }")):(n.push(a+"  count = bb.readVarUint"),n.push(a+"  self."+l.name+" = []"),n.push(a+"  for array = self._"+l.name+"; count != 0; count-- {"),n.push(a+"    array.append("+d+")"),n.push(a+"  }")):l.isDeprecated?n.push(a+"  "+d):n.push(a+"  self."+l.name+" = "+d),o.kind==="MESSAGE"&&(n.push(a+"}"),n.push(""))}o.kind==="MESSAGE"&&(n.push(t+"        default {"),n.push(t+"          if schema == null { Kiwi.DecodeError.throwInvalidMessage }"),n.push(t+"          else { schema.skip"+o.name+"Field(bb, type) }"),n.push(t+"        }"),n.push(t+"      }"),n.push(t+"    }")),n.push(t+"    return self"),n.push(t+"  }"),n.push(t+"}"),n.push("");break}default:rn("Invalid definition kind "+Xe(o.kind),o.line,o.column)}}return i.package!==null&&($f(n),n.push("}")),n.push(""),n.join(`
`)}var n_=bo(()=>{Qa()});var r_={};di(r_,{compileSchemaSkewTypes:()=>Av});function Av(i){var e="",t=[];i.package!==null&&(t.push("namespace "+i.package+" {"),e+="  ");for(var n=0;n<i.definitions.length;n++){var r=i.definitions[n];if(r.kind==="ENUM"){if(t.push(e+"type "+r.name+" : string {"),t.push(e+"  @alwaysinline"),t.push(e+"  def toString string { return self as string }"),t.push(e+"}"),r.fields.length>0){t.push(e+"namespace "+r.name+" {");for(var o=0;o<r.fields.length;o++)t.push(e+"  @alwaysinline"),t.push(e+"  def "+r.fields[o].name+" "+r.name+" { return "+JSON.stringify(r.fields[o].name)+" as "+r.name+" }");t.push(e+"}")}t.push("")}}for(var n=0;n<i.definitions.length;n++){var r=i.definitions[n];if(r.kind==="STRUCT"||r.kind==="MESSAGE"){t.push(e+"@import"),t.push(e+"class "+r.name+" {");for(var o=0;o<r.fields.length;o++){var a=r.fields[o],s;if(!a.isDeprecated){switch(a.type){case"byte":case"uint":s="int";break;case"uint64":case"int64":s="string";break;case"float":s="double";break;default:s=a.type;break}a.type==="byte"&&a.isArray?s="Uint8Array":a.isArray&&(s="List<"+s+">"),t.push(e+"  var "+a.name+" "+s),t.push(e+"  @alwaysinline"),t.push(e+"  def has_"+a.name+" bool { return self."+a.name+" != dynamic.void(0) }")}}t.push(e+"}"),t.push(""),t.push(e+"namespace "+r.name+" {"),t.push(e+"  @alwaysinline"),t.push(e+"  def new "+r.name+" { return {} as dynamic }"),t.push(e+"}"),t.push("")}else r.kind!=="ENUM"&&rn("Invalid definition kind "+Xe(r.kind),r.line,r.column)}t.push(e+"type DedupCache = dynamic"),t.push(""),t.push(e+"@import"),t.push(e+"class Schema {"),t.push(e+"  const makeDedupCache fn() DedupCache");for(var n=0;n<i.definitions.length;n++){var r=i.definitions[n];r.kind==="ENUM"?t.push(e+"  const "+r.name+" dynamic"):(r.kind==="STRUCT"||r.kind==="MESSAGE")&&(t.push(e+"  def encode"+r.name+"(message "+r.name+") Uint8Array"),t.push(e+"  def decode"+r.name+"(buffer Uint8Array) "+r.name),t.push(e+"  def decode"+r.name+"(buffer Uint8Array, optionalDedupCache DedupCache) "+r.name))}return t.push(e+"}"),i.package!==null&&t.push("}"),t.push(""),t.join(`
`)}var o_=bo(()=>{Qa()});var i_={};di(i_,{compileSchemaTypeScript:()=>Sv});function Sv(i){var e="",t=[];i.package!==null&&(t.push("export namespace "+i.package+" {"),e+="  ");for(var n=0;n<i.definitions.length;n++){var r=i.definitions[n];if(r.kind==="ENUM"){t.push(e+"export type "+r.name+" =");for(var o=0;o<r.fields.length;o++)t.push(e+"  "+JSON.stringify(r.fields[o].name)+(o+1<r.fields.length?" |":";"));r.fields.length||t.push(e+"  any;"),t.push("")}}for(var n=0;n<i.definitions.length;n++){var r=i.definitions[n];if(r.kind==="STRUCT"||r.kind==="MESSAGE"){t.push(e+"export interface "+r.name+" {");for(var o=0;o<r.fields.length;o++){var a=r.fields[o],s;if(!a.isDeprecated){switch(a.type){case"bool":s="boolean";break;case"byte":case"int":case"uint":case"float":s="number";break;case"int64":case"uint64":s="string";break;default:s=a.type;break}a.type==="byte"&&a.isArray?s="Uint8Array":a.isArray&&(s+="[]"),t.push(e+"  "+a.name+(r.kind==="MESSAGE"?"?":"")+": "+s+";")}}t.push(e+"}"),t.push("")}else r.kind!=="ENUM"&&rn("Invalid definition kind "+Xe(r.kind),r.line,r.column)}t.push(e+"export type DedupCache = any;"),t.push(""),t.push(e+"export interface Schema {"),t.push(e+"  makeDedupCache(): DedupCache;");for(var n=0;n<i.definitions.length;n++){var r=i.definitions[n];r.kind==="ENUM"?t.push(e+"  "+r.name+": any;"):(r.kind==="STRUCT"||r.kind==="MESSAGE")&&(t.push(e+"  encode"+r.name+"(message: "+r.name+"): Uint8Array;"),t.push(e+"  decode"+r.name+"(buffer: Uint8Array, optionalDedupCache?: DedupCache): "+r.name+";"))}return t.push(e+"}"),i.package!==null&&t.push("}"),t.push(""),t.join(`
`)}var a_=bo(()=>{Qa()});var s_={};di(s_,{prettyPrintSchema:()=>yv});function yv(i){let e=i.definitions,t="";i.package!==null&&(t+="package "+i.package+`;
`);for(let n=0;n<e.length;n++){let r=e[n];(n>0||i.package!==null)&&(t+=`
`),t+=r.kind.toLowerCase()+" "+r.name+` {
`;for(let o=0;o<r.fields.length;o++){let a=r.fields[o];t+="  ",r.kind!=="ENUM"&&(t+=a.type,a.isArray&&(t+="[]"),t+=" "),t+=a.name,r.kind!=="STRUCT"&&(t+=" = "+a.value),a.isDeprecated&&(t+=" [deprecated]"),t+=`;
`}t+=`}
`}return t}var l_=bo(()=>{});var xs=vh(An=>{"use strict";Object.defineProperty(An,"__esModule",{value:!0});An.prettyPrintSchema=An.parseSchema=An.encodeBinarySchema=An.decodeBinarySchema=An.compileSchemaTypeScript=An.compileSchemaSkewTypes=An.compileSchemaSkew=An.compileSchemaCPP=An.compileSchemaCallbackCPP=An.compileSchemaJS=An.compileSchema=An.ByteBuffer=void 0;var bv=(Od(),ui(xf));Object.defineProperty(An,"ByteBuffer",{enumerable:!0,get:function(){return bv.ByteBuffer}});var c_=(Gf(),ui(Uf));Object.defineProperty(An,"compileSchema",{enumerable:!0,get:function(){return c_.compileSchema}});Object.defineProperty(An,"compileSchemaJS",{enumerable:!0,get:function(){return c_.compileSchemaJS}});var Tv=(qf(),ui(Kf));Object.defineProperty(An,"compileSchemaCallbackCPP",{enumerable:!0,get:function(){return Tv.compileSchemaCallbackCPP}});var vv=(Zf(),ui(jf));Object.defineProperty(An,"compileSchemaCPP",{enumerable:!0,get:function(){return vv.compileSchemaCPP}});var Iv=(n_(),ui(t_));Object.defineProperty(An,"compileSchemaSkew",{enumerable:!0,get:function(){return Iv.compileSchemaSkew}});var Ev=(o_(),ui(r_));Object.defineProperty(An,"compileSchemaSkewTypes",{enumerable:!0,get:function(){return Ev.compileSchemaSkewTypes}});var Cv=(a_(),ui(i_));Object.defineProperty(An,"compileSchemaTypeScript",{enumerable:!0,get:function(){return Cv.compileSchemaTypeScript}});var d_=(xh(),ui(Vf));Object.defineProperty(An,"decodeBinarySchema",{enumerable:!0,get:function(){return d_.decodeBinarySchema}});Object.defineProperty(An,"encodeBinarySchema",{enumerable:!0,get:function(){return d_.encodeBinarySchema}});var Rv=(Rh(),ui(Bf));Object.defineProperty(An,"parseSchema",{enumerable:!0,get:function(){return Rv.parseSchema}});var Nv=(l_(),ui(s_));Object.defineProperty(An,"prettyPrintSchema",{enumerable:!0,get:function(){return Nv.prettyPrintSchema}})});var rS=vh((hc,Rm)=>{(function(e,t){typeof hc=="object"&&typeof Rm=="object"?Rm.exports=t():typeof define=="function"&&define.amd?define([],t):typeof hc=="object"?hc.JsDiff=t():e.JsDiff=t()})(hc,function(){return function(i){var e={};function t(n){if(e[n])return e[n].exports;var r=e[n]={exports:{},id:n,loaded:!1};return i[n].call(r.exports,r,r.exports,t),r.loaded=!0,r.exports}return t.m=i,t.c=e,t.p="",t(0)}([function(i,e,t){"use strict";e.__esModule=!0,e.canonicalize=e.convertChangesToXML=e.convertChangesToDMP=e.merge=e.parsePatch=e.applyPatches=e.applyPatch=e.createPatch=e.createTwoFilesPatch=e.structuredPatch=e.diffArrays=e.diffJson=e.diffCss=e.diffSentences=e.diffTrimmedLines=e.diffLines=e.diffWordsWithSpace=e.diffWords=e.diffChars=e.Diff=void 0;var n=t(1),r=T(n),o=t(2),a=t(3),s=t(5),l=t(6),d=t(7),c=t(8),p=t(9),u=t(10),h=t(11),f=t(13),y=t(14),g=t(16),A=t(17);function T(b){return b&&b.__esModule?b:{default:b}}e.Diff=r.default,e.diffChars=o.diffChars,e.diffWords=a.diffWords,e.diffWordsWithSpace=a.diffWordsWithSpace,e.diffLines=s.diffLines,e.diffTrimmedLines=s.diffTrimmedLines,e.diffSentences=l.diffSentences,e.diffCss=d.diffCss,e.diffJson=c.diffJson,e.diffArrays=p.diffArrays,e.structuredPatch=y.structuredPatch,e.createTwoFilesPatch=y.createTwoFilesPatch,e.createPatch=y.createPatch,e.applyPatch=u.applyPatch,e.applyPatches=u.applyPatches,e.parsePatch=h.parsePatch,e.merge=f.merge,e.convertChangesToDMP=g.convertChangesToDMP,e.convertChangesToXML=A.convertChangesToXML,e.canonicalize=c.canonicalize},function(i,e){"use strict";e.__esModule=!0,e.default=t;function t(){}t.prototype={diff:function(a,s){var l=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},d=l.callback;typeof l=="function"&&(d=l,l={}),this.options=l;var c=this;function p(_){return d?(setTimeout(function(){d(void 0,_)},0),!0):_}a=this.castInput(a),s=this.castInput(s),a=this.removeEmpty(this.tokenize(a)),s=this.removeEmpty(this.tokenize(s));var u=s.length,h=a.length,f=1,y=u+h,g=[{newPos:-1,components:[]}],A=this.extractCommon(g[0],s,a,0);if(g[0].newPos+1>=u&&A+1>=h)return p([{value:this.join(s),count:s.length}]);function T(){for(var _=-1*f;_<=f;_+=2){var m=void 0,S=g[_-1],v=g[_+1],C=(v?v.newPos:0)-_;S&&(g[_-1]=void 0);var N=S&&S.newPos+1<u,x=v&&0<=C&&C<h;if(!N&&!x){g[_]=void 0;continue}if(!N||x&&S.newPos<v.newPos?(m=r(v),c.pushComponent(m.components,void 0,!0)):(m=S,m.newPos++,c.pushComponent(m.components,!0,void 0)),C=c.extractCommon(m,s,a,_),m.newPos+1>=u&&C+1>=h)return p(n(c,m.components,s,a,c.useLongestToken));g[_]=m}f++}if(d)(function _(){setTimeout(function(){if(f>y)return d();T()||_()},0)})();else for(;f<=y;){var b=T();if(b)return b}},pushComponent:function(a,s,l){var d=a[a.length-1];d&&d.added===s&&d.removed===l?a[a.length-1]={count:d.count+1,added:s,removed:l}:a.push({count:1,added:s,removed:l})},extractCommon:function(a,s,l,d){for(var c=s.length,p=l.length,u=a.newPos,h=u-d,f=0;u+1<c&&h+1<p&&this.equals(s[u+1],l[h+1]);)u++,h++,f++;return f&&a.components.push({count:f}),a.newPos=u,h},equals:function(a,s){return this.options.comparator?this.options.comparator(a,s):a===s||this.options.ignoreCase&&a.toLowerCase()===s.toLowerCase()},removeEmpty:function(a){for(var s=[],l=0;l<a.length;l++)a[l]&&s.push(a[l]);return s},castInput:function(a){return a},tokenize:function(a){return a.split("")},join:function(a){return a.join("")}};function n(o,a,s,l,d){for(var c=0,p=a.length,u=0,h=0;c<p;c++){var f=a[c];if(f.removed){if(f.value=o.join(l.slice(h,h+f.count)),h+=f.count,c&&a[c-1].added){var g=a[c-1];a[c-1]=a[c],a[c]=g}}else{if(!f.added&&d){var y=s.slice(u,u+f.count);y=y.map(function(T,b){var _=l[h+b];return _.length>T.length?_:T}),f.value=o.join(y)}else f.value=o.join(s.slice(u,u+f.count));u+=f.count,f.added||(h+=f.count)}}var A=a[p-1];return p>1&&typeof A.value=="string"&&(A.added||A.removed)&&o.equals("",A.value)&&(a[p-2].value+=A.value,a.pop()),a}function r(o){return{newPos:o.newPos,components:o.components.slice(0)}}},function(i,e,t){"use strict";e.__esModule=!0,e.characterDiff=void 0,e.diffChars=s;var n=t(1),r=o(n);function o(l){return l&&l.__esModule?l:{default:l}}var a=e.characterDiff=new r.default;function s(l,d,c){return a.diff(l,d,c)}},function(i,e,t){"use strict";e.__esModule=!0,e.wordDiff=void 0,e.diffWords=c,e.diffWordsWithSpace=p;var n=t(1),r=a(n),o=t(4);function a(u){return u&&u.__esModule?u:{default:u}}var s=/^[A-Za-z\xC0-\u02C6\u02C8-\u02D7\u02DE-\u02FF\u1E00-\u1EFF]+$/,l=/\S/,d=e.wordDiff=new r.default;d.equals=function(u,h){return this.options.ignoreCase&&(u=u.toLowerCase(),h=h.toLowerCase()),u===h||this.options.ignoreWhitespace&&!l.test(u)&&!l.test(h)},d.tokenize=function(u){for(var h=u.split(/(\s+|\b)/),f=0;f<h.length-1;f++)!h[f+1]&&h[f+2]&&s.test(h[f])&&s.test(h[f+2])&&(h[f]+=h[f+2],h.splice(f+1,2),f--);return h};function c(u,h,f){return f=(0,o.generateOptions)(f,{ignoreWhitespace:!0}),d.diff(u,h,f)}function p(u,h,f){return d.diff(u,h,f)}},function(i,e){"use strict";e.__esModule=!0,e.generateOptions=t;function t(n,r){if(typeof n=="function")r.callback=n;else if(n)for(var o in n)n.hasOwnProperty(o)&&(r[o]=n[o]);return r}},function(i,e,t){"use strict";e.__esModule=!0,e.lineDiff=void 0,e.diffLines=l,e.diffTrimmedLines=d;var n=t(1),r=a(n),o=t(4);function a(c){return c&&c.__esModule?c:{default:c}}var s=e.lineDiff=new r.default;s.tokenize=function(c){var p=[],u=c.split(/(\n|\r\n)/);u[u.length-1]||u.pop();for(var h=0;h<u.length;h++){var f=u[h];h%2&&!this.options.newlineIsToken?p[p.length-1]+=f:(this.options.ignoreWhitespace&&(f=f.trim()),p.push(f))}return p};function l(c,p,u){return s.diff(c,p,u)}function d(c,p,u){var h=(0,o.generateOptions)(u,{ignoreWhitespace:!0});return s.diff(c,p,h)}},function(i,e,t){"use strict";e.__esModule=!0,e.sentenceDiff=void 0,e.diffSentences=s;var n=t(1),r=o(n);function o(l){return l&&l.__esModule?l:{default:l}}var a=e.sentenceDiff=new r.default;a.tokenize=function(l){return l.split(/(\S.+?[.!?])(?=\s+|$)/)};function s(l,d,c){return a.diff(l,d,c)}},function(i,e,t){"use strict";e.__esModule=!0,e.cssDiff=void 0,e.diffCss=s;var n=t(1),r=o(n);function o(l){return l&&l.__esModule?l:{default:l}}var a=e.cssDiff=new r.default;a.tokenize=function(l){return l.split(/([{}:;,]|\s+)/)};function s(l,d,c){return a.diff(l,d,c)}},function(i,e,t){"use strict";e.__esModule=!0,e.jsonDiff=void 0;var n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(u){return typeof u}:function(u){return u&&typeof Symbol=="function"&&u.constructor===Symbol&&u!==Symbol.prototype?"symbol":typeof u};e.diffJson=c,e.canonicalize=p;var r=t(1),o=s(r),a=t(5);function s(u){return u&&u.__esModule?u:{default:u}}var l=Object.prototype.toString,d=e.jsonDiff=new o.default;d.useLongestToken=!0,d.tokenize=a.lineDiff.tokenize,d.castInput=function(u){var h=this.options,f=h.undefinedReplacement,y=h.stringifyReplacer,g=y===void 0?function(A,T){return typeof T>"u"?f:T}:y;return typeof u=="string"?u:JSON.stringify(p(u,null,null,g),g,"  ")},d.equals=function(u,h){return o.default.prototype.equals.call(d,u.replace(/,([\r\n])/g,"$1"),h.replace(/,([\r\n])/g,"$1"))};function c(u,h,f){return d.diff(u,h,f)}function p(u,h,f,y,g){h=h||[],f=f||[],y&&(u=y(g,u));var A=void 0;for(A=0;A<h.length;A+=1)if(h[A]===u)return f[A];var T=void 0;if(l.call(u)==="[object Array]"){for(h.push(u),T=new Array(u.length),f.push(T),A=0;A<u.length;A+=1)T[A]=p(u[A],h,f,y,g);return h.pop(),f.pop(),T}if(u&&u.toJSON&&(u=u.toJSON()),(typeof u>"u"?"undefined":n(u))==="object"&&u!==null){h.push(u),T={},f.push(T);var b=[],_=void 0;for(_ in u)u.hasOwnProperty(_)&&b.push(_);for(b.sort(),A=0;A<b.length;A+=1)_=b[A],T[_]=p(u[_],h,f,y,_);h.pop(),f.pop()}else T=u;return T}},function(i,e,t){"use strict";e.__esModule=!0,e.arrayDiff=void 0,e.diffArrays=s;var n=t(1),r=o(n);function o(l){return l&&l.__esModule?l:{default:l}}var a=e.arrayDiff=new r.default;a.tokenize=function(l){return l.slice()},a.join=a.removeEmpty=function(l){return l};function s(l,d,c){return a.diff(l,d,c)}},function(i,e,t){"use strict";e.__esModule=!0,e.applyPatch=s,e.applyPatches=l;var n=t(11),r=t(12),o=a(r);function a(d){return d&&d.__esModule?d:{default:d}}function s(d,c){var p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(typeof c=="string"&&(c=(0,n.parsePatch)(c)),Array.isArray(c)){if(c.length>1)throw new Error("applyPatch only works with a single input.");c=c[0]}var u=d.split(/\r\n|[\n\v\f\r\x85]/),h=d.match(/\r\n|[\n\v\f\r\x85]/g)||[],f=c.hunks,y=p.compareLine||function(J,oe,le,tt){return oe===tt},g=0,A=p.fuzzFactor||0,T=0,b=0,_=void 0,m=void 0;function S(J,oe){for(var le=0;le<J.lines.length;le++){var tt=J.lines[le],nt=tt.length>0?tt[0]:" ",At=tt.length>0?tt.substr(1):tt;if(nt===" "||nt==="-"){if(!y(oe+1,u[oe],nt,At)&&(g++,g>A))return!1;oe++}}return!0}for(var v=0;v<f.length;v++){for(var C=f[v],N=u.length-C.oldLines,x=0,z=b+C.oldStart-1,$=(0,o.default)(z,T,N);x!==void 0;x=$())if(S(C,z+x)){C.offset=b+=x;break}if(x===void 0)return!1;T=C.offset+C.oldStart+C.oldLines}for(var q=0,K=0;K<f.length;K++){var F=f[K],P=F.oldStart+F.offset+q-1;q+=F.newLines-F.oldLines,P<0&&(P=0);for(var k=0;k<F.lines.length;k++){var H=F.lines[k],L=H.length>0?H[0]:" ",Q=H.length>0?H.substr(1):H,X=F.linedelimiters[k];if(L===" ")P++;else if(L==="-")u.splice(P,1),h.splice(P,1);else if(L==="+")u.splice(P,0,Q),h.splice(P,0,X),P++;else if(L==="\\"){var M=F.lines[k-1]?F.lines[k-1][0]:null;M==="+"?_=!0:M==="-"&&(m=!0)}}}if(_)for(;!u[u.length-1];)u.pop(),h.pop();else m&&(u.push(""),h.push(`
`));for(var te=0;te<u.length-1;te++)u[te]=u[te]+h[te];return u.join("")}function l(d,c){typeof d=="string"&&(d=(0,n.parsePatch)(d));var p=0;function u(){var h=d[p++];if(!h)return c.complete();c.loadFile(h,function(f,y){if(f)return c.complete(f);var g=s(y,h,c);c.patched(h,g,function(A){if(A)return c.complete(A);u()})})}u()}},function(i,e){"use strict";e.__esModule=!0,e.parsePatch=t;function t(n){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=n.split(/\r\n|[\n\v\f\r\x85]/),a=n.match(/\r\n|[\n\v\f\r\x85]/g)||[],s=[],l=0;function d(){var u={};for(s.push(u);l<o.length;){var h=o[l];if(/^(\-\-\-|\+\+\+|@@)\s/.test(h))break;var f=/^(?:Index:|diff(?: -r \w+)+)\s+(.+?)\s*$/.exec(h);f&&(u.index=f[1]),l++}for(c(u),c(u),u.hunks=[];l<o.length;){var y=o[l];if(/^(Index:|diff|\-\-\-|\+\+\+)\s/.test(y))break;if(/^@@/.test(y))u.hunks.push(p());else{if(y&&r.strict)throw new Error("Unknown line "+(l+1)+" "+JSON.stringify(y));l++}}}function c(u){var h=/^(---|\+\+\+)\s+(.*)$/.exec(o[l]);if(h){var f=h[1]==="---"?"old":"new",y=h[2].split("	",2),g=y[0].replace(/\\\\/g,"\\");/^".*"$/.test(g)&&(g=g.substr(1,g.length-2)),u[f+"FileName"]=g,u[f+"Header"]=(y[1]||"").trim(),l++}}function p(){for(var u=l,h=o[l++],f=h.split(/@@ -(\d+)(?:,(\d+))? \+(\d+)(?:,(\d+))? @@/),y={oldStart:+f[1],oldLines:+f[2]||1,newStart:+f[3],newLines:+f[4]||1,lines:[],linedelimiters:[]},g=0,A=0;l<o.length&&!(o[l].indexOf("--- ")===0&&l+2<o.length&&o[l+1].indexOf("+++ ")===0&&o[l+2].indexOf("@@")===0);l++){var T=o[l].length==0&&l!=o.length-1?" ":o[l][0];if(T==="+"||T==="-"||T===" "||T==="\\")y.lines.push(o[l]),y.linedelimiters.push(a[l]||`
`),T==="+"?g++:T==="-"?A++:T===" "&&(g++,A++);else break}if(!g&&y.newLines===1&&(y.newLines=0),!A&&y.oldLines===1&&(y.oldLines=0),r.strict){if(g!==y.newLines)throw new Error("Added line count did not match for hunk at line "+(u+1));if(A!==y.oldLines)throw new Error("Removed line count did not match for hunk at line "+(u+1))}return y}for(;l<o.length;)d();return s}},function(i,e){"use strict";e.__esModule=!0,e.default=function(t,n,r){var o=!0,a=!1,s=!1,l=1;return function d(){if(o&&!s){if(a?l++:o=!1,t+l<=r)return l;s=!0}if(!a)return s||(o=!0),n<=t-l?-l++:(a=!0,d())}}},function(i,e,t){"use strict";e.__esModule=!0,e.calcLineCount=s,e.merge=l;var n=t(14),r=t(11),o=t(15);function a(N){if(Array.isArray(N)){for(var x=0,z=Array(N.length);x<N.length;x++)z[x]=N[x];return z}else return Array.from(N)}function s(N){var x=C(N.lines),z=x.oldLines,$=x.newLines;z!==void 0?N.oldLines=z:delete N.oldLines,$!==void 0?N.newLines=$:delete N.newLines}function l(N,x,z){N=d(N,z),x=d(x,z);var $={};(N.index||x.index)&&($.index=N.index||x.index),(N.newFileName||x.newFileName)&&(c(N)?c(x)?($.oldFileName=p($,N.oldFileName,x.oldFileName),$.newFileName=p($,N.newFileName,x.newFileName),$.oldHeader=p($,N.oldHeader,x.oldHeader),$.newHeader=p($,N.newHeader,x.newHeader)):($.oldFileName=N.oldFileName,$.newFileName=N.newFileName,$.oldHeader=N.oldHeader,$.newHeader=N.newHeader):($.oldFileName=x.oldFileName||N.oldFileName,$.newFileName=x.newFileName||N.newFileName,$.oldHeader=x.oldHeader||N.oldHeader,$.newHeader=x.newHeader||N.newHeader)),$.hunks=[];for(var q=0,K=0,F=0,P=0;q<N.hunks.length||K<x.hunks.length;){var k=N.hunks[q]||{oldStart:1/0},H=x.hunks[K]||{oldStart:1/0};if(u(k,H))$.hunks.push(h(k,F)),q++,P+=k.newLines-k.oldLines;else if(u(H,k))$.hunks.push(h(H,P)),K++,F+=H.newLines-H.oldLines;else{var L={oldStart:Math.min(k.oldStart,H.oldStart),oldLines:0,newStart:Math.min(k.newStart+F,H.oldStart+P),newLines:0,lines:[]};f(L,k.oldStart,k.lines,H.oldStart,H.lines),K++,q++,$.hunks.push(L)}}return $}function d(N,x){if(typeof N=="string"){if(/^@@/m.test(N)||/^Index:/m.test(N))return(0,r.parsePatch)(N)[0];if(!x)throw new Error("Must provide a base reference or pass in a patch");return(0,n.structuredPatch)(void 0,void 0,x,N)}return N}function c(N){return N.newFileName&&N.newFileName!==N.oldFileName}function p(N,x,z){return x===z?x:(N.conflict=!0,{mine:x,theirs:z})}function u(N,x){return N.oldStart<x.oldStart&&N.oldStart+N.oldLines<x.oldStart}function h(N,x){return{oldStart:N.oldStart,oldLines:N.oldLines,newStart:N.newStart+x,newLines:N.newLines,lines:N.lines}}function f(N,x,z,$,q){var K={offset:x,lines:z,index:0},F={offset:$,lines:q,index:0};for(T(N,K,F),T(N,F,K);K.index<K.lines.length&&F.index<F.lines.length;){var P=K.lines[K.index],k=F.lines[F.index];if((P[0]==="-"||P[0]==="+")&&(k[0]==="-"||k[0]==="+"))y(N,K,F);else if(P[0]==="+"&&k[0]===" "){var H;(H=N.lines).push.apply(H,a(_(K)))}else if(k[0]==="+"&&P[0]===" "){var L;(L=N.lines).push.apply(L,a(_(F)))}else P[0]==="-"&&k[0]===" "?g(N,K,F):k[0]==="-"&&P[0]===" "?g(N,F,K,!0):P===k?(N.lines.push(P),K.index++,F.index++):A(N,_(K),_(F))}b(N,K),b(N,F),s(N)}function y(N,x,z){var $=_(x),q=_(z);if(S($)&&S(q)){if((0,o.arrayStartsWith)($,q)&&v(z,$,$.length-q.length)){var K;(K=N.lines).push.apply(K,a($));return}else if((0,o.arrayStartsWith)(q,$)&&v(x,q,q.length-$.length)){var F;(F=N.lines).push.apply(F,a(q));return}}else if((0,o.arrayEqual)($,q)){var P;(P=N.lines).push.apply(P,a($));return}A(N,$,q)}function g(N,x,z,$){var q=_(x),K=m(z,q);if(K.merged){var F;(F=N.lines).push.apply(F,a(K.merged))}else A(N,$?K:q,$?q:K)}function A(N,x,z){N.conflict=!0,N.lines.push({conflict:!0,mine:x,theirs:z})}function T(N,x,z){for(;x.offset<z.offset&&x.index<x.lines.length;){var $=x.lines[x.index++];N.lines.push($),x.offset++}}function b(N,x){for(;x.index<x.lines.length;){var z=x.lines[x.index++];N.lines.push(z)}}function _(N){for(var x=[],z=N.lines[N.index][0];N.index<N.lines.length;){var $=N.lines[N.index];if(z==="-"&&$[0]==="+"&&(z="+"),z===$[0])x.push($),N.index++;else break}return x}function m(N,x){for(var z=[],$=[],q=0,K=!1,F=!1;q<x.length&&N.index<N.lines.length;){var P=N.lines[N.index],k=x[q];if(k[0]==="+")break;if(K=K||P[0]!==" ",$.push(k),q++,P[0]==="+")for(F=!0;P[0]==="+";)z.push(P),P=N.lines[++N.index];k.substr(1)===P.substr(1)?(z.push(P),N.index++):F=!0}if((x[q]||"")[0]==="+"&&K&&(F=!0),F)return z;for(;q<x.length;)$.push(x[q++]);return{merged:$,changes:z}}function S(N){return N.reduce(function(x,z){return x&&z[0]==="-"},!0)}function v(N,x,z){for(var $=0;$<z;$++){var q=x[x.length-z+$].substr(1);if(N.lines[N.index+$]!==" "+q)return!1}return N.index+=z,!0}function C(N){var x=0,z=0;return N.forEach(function($){if(typeof $!="string"){var q=C($.mine),K=C($.theirs);x!==void 0&&(q.oldLines===K.oldLines?x+=q.oldLines:x=void 0),z!==void 0&&(q.newLines===K.newLines?z+=q.newLines:z=void 0)}else z!==void 0&&($[0]==="+"||$[0]===" ")&&z++,x!==void 0&&($[0]==="-"||$[0]===" ")&&x++}),{oldLines:x,newLines:z}}},function(i,e,t){"use strict";e.__esModule=!0,e.structuredPatch=o,e.createTwoFilesPatch=a,e.createPatch=s;var n=t(5);function r(l){if(Array.isArray(l)){for(var d=0,c=Array(l.length);d<l.length;d++)c[d]=l[d];return c}else return Array.from(l)}function o(l,d,c,p,u,h,f){f||(f={}),typeof f.context>"u"&&(f.context=4);var y=(0,n.diffLines)(c,p,f);y.push({value:"",lines:[]});function g(N){return N.map(function(x){return" "+x})}for(var A=[],T=0,b=0,_=[],m=1,S=1,v=function(x){var z=y[x],$=z.lines||z.value.replace(/\n$/,"").split(`
`);if(z.lines=$,z.added||z.removed){var q;if(!T){var K=y[x-1];T=m,b=S,K&&(_=f.context>0?g(K.lines.slice(-f.context)):[],T-=_.length,b-=_.length)}(q=_).push.apply(q,r($.map(function(X){return(z.added?"+":"-")+X}))),z.added?S+=$.length:m+=$.length}else{if(T)if($.length<=f.context*2&&x<y.length-2){var F;(F=_).push.apply(F,r(g($)))}else{var P,k=Math.min($.length,f.context);(P=_).push.apply(P,r(g($.slice(0,k))));var H={oldStart:T,oldLines:m-T+k,newStart:b,newLines:S-b+k,lines:_};if(x>=y.length-2&&$.length<=f.context){var L=/\n$/.test(c),Q=/\n$/.test(p);$.length==0&&!L?_.splice(H.oldLines,0,"\\ No newline at end of file"):(!L||!Q)&&_.push("\\ No newline at end of file")}A.push(H),T=0,b=0,_=[]}m+=$.length,S+=$.length}},C=0;C<y.length;C++)v(C);return{oldFileName:l,newFileName:d,oldHeader:u,newHeader:h,hunks:A}}function a(l,d,c,p,u,h,f){var y=o(l,d,c,p,u,h,f),g=[];l==d&&g.push("Index: "+l),g.push("==================================================================="),g.push("--- "+y.oldFileName+(typeof y.oldHeader>"u"?"":"	"+y.oldHeader)),g.push("+++ "+y.newFileName+(typeof y.newHeader>"u"?"":"	"+y.newHeader));for(var A=0;A<y.hunks.length;A++){var T=y.hunks[A];g.push("@@ -"+T.oldStart+","+T.oldLines+" +"+T.newStart+","+T.newLines+" @@"),g.push.apply(g,T.lines)}return g.join(`
`)+`
`}function s(l,d,c,p,u,h){return a(l,l,d,c,p,u,h)}},function(i,e){"use strict";e.__esModule=!0,e.arrayEqual=t,e.arrayStartsWith=n;function t(r,o){return r.length!==o.length?!1:n(r,o)}function n(r,o){if(o.length>r.length)return!1;for(var a=0;a<o.length;a++)if(o[a]!==r[a])return!1;return!0}},function(i,e){"use strict";e.__esModule=!0,e.convertChangesToDMP=t;function t(n){for(var r=[],o=void 0,a=void 0,s=0;s<n.length;s++)o=n[s],o.added?a=1:o.removed?a=-1:a=0,r.push([a,o.value]);return r}},function(i,e){"use strict";e.__esModule=!0,e.convertChangesToXML=t;function t(r){for(var o=[],a=0;a<r.length;a++){var s=r[a];s.added?o.push("<ins>"):s.removed&&o.push("<del>"),o.push(n(s.value)),s.added?o.push("</ins>"):s.removed&&o.push("</del>")}return o.join("")}function n(r){var o=r;return o=o.replace(/&/g,"&amp;"),o=o.replace(/</g,"&lt;"),o=o.replace(/>/g,"&gt;"),o=o.replace(/"/g,"&quot;"),o}}])})});var sb=vh((Bg,Vg)=>{(function(i,e){typeof Bg=="object"&&typeof Vg<"u"?Vg.exports=e():typeof define=="function"&&define.amd?define(e):(i=i||self).RBush=e()})(Bg,function(){"use strict";function i(g,A,T,b,_){(function m(S,v,C,N,x){for(;N>C;){if(N-C>600){var z=N-C+1,$=v-C+1,q=Math.log(z),K=.5*Math.exp(2*q/3),F=.5*Math.sqrt(q*K*(z-K)/z)*($-z/2<0?-1:1),P=Math.max(C,Math.floor(v-$*K/z+F)),k=Math.min(N,Math.floor(v+(z-$)*K/z+F));m(S,v,P,k,x)}var H=S[v],L=C,Q=N;for(e(S,C,v),x(S[N],H)>0&&e(S,C,N);L<Q;){for(e(S,L,Q),L++,Q--;x(S[L],H)<0;)L++;for(;x(S[Q],H)>0;)Q--}x(S[C],H)===0?e(S,C,Q):e(S,++Q,N),Q<=v&&(C=Q+1),v<=Q&&(N=Q-1)}})(g,A,T||0,b||g.length-1,_||t)}function e(g,A,T){var b=g[A];g[A]=g[T],g[T]=b}function t(g,A){return g<A?-1:g>A?1:0}var n=function(g){g===void 0&&(g=9),this._maxEntries=Math.max(4,g),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function r(g,A,T){if(!T)return A.indexOf(g);for(var b=0;b<A.length;b++)if(T(g,A[b]))return b;return-1}function o(g,A){a(g,0,g.children.length,A,g)}function a(g,A,T,b,_){_||(_=f(null)),_.minX=1/0,_.minY=1/0,_.maxX=-1/0,_.maxY=-1/0;for(var m=A;m<T;m++){var S=g.children[m];s(_,g.leaf?b(S):S)}return _}function s(g,A){return g.minX=Math.min(g.minX,A.minX),g.minY=Math.min(g.minY,A.minY),g.maxX=Math.max(g.maxX,A.maxX),g.maxY=Math.max(g.maxY,A.maxY),g}function l(g,A){return g.minX-A.minX}function d(g,A){return g.minY-A.minY}function c(g){return(g.maxX-g.minX)*(g.maxY-g.minY)}function p(g){return g.maxX-g.minX+(g.maxY-g.minY)}function u(g,A){return g.minX<=A.minX&&g.minY<=A.minY&&A.maxX<=g.maxX&&A.maxY<=g.maxY}function h(g,A){return A.minX<=g.maxX&&A.minY<=g.maxY&&A.maxX>=g.minX&&A.maxY>=g.minY}function f(g){return{children:g,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function y(g,A,T,b,_){for(var m=[A,T];m.length;)if(!((T=m.pop())-(A=m.pop())<=b)){var S=A+Math.ceil((T-A)/b/2)*b;i(g,S,A,T,_),m.push(A,S,S,T)}}return n.prototype.all=function(){return this._all(this.data,[])},n.prototype.search=function(g){var A=this.data,T=[];if(!h(g,A))return T;for(var b=this.toBBox,_=[];A;){for(var m=0;m<A.children.length;m++){var S=A.children[m],v=A.leaf?b(S):S;h(g,v)&&(A.leaf?T.push(S):u(g,v)?this._all(S,T):_.push(S))}A=_.pop()}return T},n.prototype.collides=function(g){var A=this.data;if(!h(g,A))return!1;for(var T=[];A;){for(var b=0;b<A.children.length;b++){var _=A.children[b],m=A.leaf?this.toBBox(_):_;if(h(g,m)){if(A.leaf||u(g,m))return!0;T.push(_)}}A=T.pop()}return!1},n.prototype.load=function(g){if(!g||!g.length)return this;if(g.length<this._minEntries){for(var A=0;A<g.length;A++)this.insert(g[A]);return this}var T=this._build(g.slice(),0,g.length-1,0);if(this.data.children.length)if(this.data.height===T.height)this._splitRoot(this.data,T);else{if(this.data.height<T.height){var b=this.data;this.data=T,T=b}this._insert(T,this.data.height-T.height-1,!0)}else this.data=T;return this},n.prototype.insert=function(g){return g&&this._insert(g,this.data.height-1),this},n.prototype.clear=function(){return this.data=f([]),this},n.prototype.remove=function(g,A){if(!g)return this;for(var T,b,_,m=this.data,S=this.toBBox(g),v=[],C=[];m||v.length;){if(m||(m=v.pop(),b=v[v.length-1],T=C.pop(),_=!0),m.leaf){var N=r(g,m.children,A);if(N!==-1)return m.children.splice(N,1),v.push(m),this._condense(v),this}_||m.leaf||!u(m,S)?b?(T++,m=b.children[T],_=!1):m=null:(v.push(m),C.push(T),T=0,b=m,m=m.children[0])}return this},n.prototype.toBBox=function(g){return g},n.prototype.compareMinX=function(g,A){return g.minX-A.minX},n.prototype.compareMinY=function(g,A){return g.minY-A.minY},n.prototype.toJSON=function(){return this.data},n.prototype.fromJSON=function(g){return this.data=g,this},n.prototype._all=function(g,A){for(var T=[];g;)g.leaf?A.push.apply(A,g.children):T.push.apply(T,g.children),g=T.pop();return A},n.prototype._build=function(g,A,T,b){var _,m=T-A+1,S=this._maxEntries;if(m<=S)return o(_=f(g.slice(A,T+1)),this.toBBox),_;b||(b=Math.ceil(Math.log(m)/Math.log(S)),S=Math.ceil(m/Math.pow(S,b-1))),(_=f([])).leaf=!1,_.height=b;var v=Math.ceil(m/S),C=v*Math.ceil(Math.sqrt(S));y(g,A,T,C,this.compareMinX);for(var N=A;N<=T;N+=C){var x=Math.min(N+C-1,T);y(g,N,x,v,this.compareMinY);for(var z=N;z<=x;z+=v){var $=Math.min(z+v-1,x);_.children.push(this._build(g,z,$,b-1))}}return o(_,this.toBBox),_},n.prototype._chooseSubtree=function(g,A,T,b){for(;b.push(A),!A.leaf&&b.length-1!==T;){for(var _=1/0,m=1/0,S=void 0,v=0;v<A.children.length;v++){var C=A.children[v],N=c(C),x=(z=g,$=C,(Math.max($.maxX,z.maxX)-Math.min($.minX,z.minX))*(Math.max($.maxY,z.maxY)-Math.min($.minY,z.minY))-N);x<m?(m=x,_=N<_?N:_,S=C):x===m&&N<_&&(_=N,S=C)}A=S||A.children[0]}var z,$;return A},n.prototype._insert=function(g,A,T){var b=T?g:this.toBBox(g),_=[],m=this._chooseSubtree(b,this.data,A,_);for(m.children.push(g),s(m,b);A>=0&&_[A].children.length>this._maxEntries;)this._split(_,A),A--;this._adjustParentBBoxes(b,_,A)},n.prototype._split=function(g,A){var T=g[A],b=T.children.length,_=this._minEntries;this._chooseSplitAxis(T,_,b);var m=this._chooseSplitIndex(T,_,b),S=f(T.children.splice(m,T.children.length-m));S.height=T.height,S.leaf=T.leaf,o(T,this.toBBox),o(S,this.toBBox),A?g[A-1].children.push(S):this._splitRoot(T,S)},n.prototype._splitRoot=function(g,A){this.data=f([g,A]),this.data.height=g.height+1,this.data.leaf=!1,o(this.data,this.toBBox)},n.prototype._chooseSplitIndex=function(g,A,T){for(var b,_,m,S,v,C,N,x=1/0,z=1/0,$=A;$<=T-A;$++){var q=a(g,0,$,this.toBBox),K=a(g,$,T,this.toBBox),F=(_=q,m=K,S=void 0,v=void 0,C=void 0,N=void 0,S=Math.max(_.minX,m.minX),v=Math.max(_.minY,m.minY),C=Math.min(_.maxX,m.maxX),N=Math.min(_.maxY,m.maxY),Math.max(0,C-S)*Math.max(0,N-v)),P=c(q)+c(K);F<x?(x=F,b=$,z=P<z?P:z):F===x&&P<z&&(z=P,b=$)}return b||T-A},n.prototype._chooseSplitAxis=function(g,A,T){var b=g.leaf?this.compareMinX:l,_=g.leaf?this.compareMinY:d;this._allDistMargin(g,A,T,b)<this._allDistMargin(g,A,T,_)&&g.children.sort(b)},n.prototype._allDistMargin=function(g,A,T,b){g.children.sort(b);for(var _=this.toBBox,m=a(g,0,A,_),S=a(g,T-A,T,_),v=p(m)+p(S),C=A;C<T-A;C++){var N=g.children[C];s(m,g.leaf?_(N):N),v+=p(m)}for(var x=T-A-1;x>=A;x--){var z=g.children[x];s(S,g.leaf?_(z):z),v+=p(S)}return v},n.prototype._adjustParentBBoxes=function(g,A,T){for(var b=T;b>=0;b--)s(A[b],g)},n.prototype._condense=function(g){for(var A=g.length-1,T=void 0;A>=0;A--)g[A].children.length===0?A>0?(T=g[A-1].children).splice(T.indexOf(g[A]),1):this.clear():o(g[A],this.toBBox)},n})});var vT=Wa(xs());var Pd=class{constructor(){this.buffer=""}},un;(t=>{function i(n,r,o){return n<r?r:n>o?o:n}t.Math_clamp1=i;function e(n,r,o){return n<r?r:n>o?o:n}t.Math_clamp2=e})(un||(un={}));var Ps=i=>i===(i|0);var Fd=class{constructor(e){this._context=null,this._ext=null,this._activeQuery=null,this._isRunning=!1,this._eventsPendingTimestamps=[],this._resolvedEvents=[],this._context=e,this._ext=e.getExtension("EXT_disjoint_timer_query")}start(){if(this._ext==null)throw new Error("EXT_disjoint_timer_query WebGL extension is not available. Cannot start profiler.");if(this._isRunning)throw new Error("Profiler is already running");let e=this._context.getExtension("WEBGL_debug_renderer_info");if(e!==null){let t=this._context.getParameter(e.UNMASKED_RENDERER_WEBGL);if(t.indexOf("NVIDIA GeForce GT 750M")!=-1)throw new Error(`${t} cards seem to have a buggy implementation of EXT_disjoint_timer_query. Refusing to profile to avoid confusing results.`)}this._isRunning=!0,this._eventsPendingTimestamps.length=0,this._resolvedEvents.length=0,this._activeQuery=this._ext.createQueryEXT(),this._ext.beginQueryEXT(this._ext.TIME_ELAPSED_EXT,this._activeQuery)}stop(){if(this._ext!=null){if(!this._isRunning)throw new Error("Profiler is already stopped");this._isRunning=!1,this._activeQuery=null,this._ext.endQueryEXT(this._ext.TIME_ELAPSED_EXT)}}isRunning(){return this._isRunning}_markAction(e){if(this._ext==null)return;if(this._activeQuery==null)throw new Error("Cannot mark actions while no profile is active");let t=this._activeQuery;this._activeQuery=this._ext.createQueryEXT(),this._ext.endQueryEXT(this._ext.TIME_ELAPSED_EXT),this._ext.beginQueryEXT(this._ext.TIME_ELAPSED_EXT,this._activeQuery),this._eventsPendingTimestamps.push(new Lh(e,t))}pushFrame(e){this._markAction(new Dd(0,e))}popFrame(e){this._markAction(new Dd(1,e))}resolveEventsIfPossible(){if(this._ext==null)return;let e=0;for(;e<this._eventsPendingTimestamps.length;){let t=this._eventsPendingTimestamps[e],n=t.query;if(!this._ext.getQueryObjectEXT(n,this._ext.QUERY_RESULT_AVAILABLE_EXT))break;if(this._context.getParameter(this._ext.GPU_DISJOINT_EXT))throw new Error("GPU_DISJOINT_EXT");let r=this._ext.getQueryObjectEXT(n,this._ext.QUERY_RESULT_EXT);this._ext.deleteQueryEXT(n);let a=(this._resolvedEvents.length==0?0:ue.List_last(this._resolvedEvents).timestamp)+r;this._resolvedEvents.push(new Mh(t.action,a)),e=e+1}e>0&&(this._eventsPendingTimestamps=this._eventsPendingTimestamps.slice(e))}hasPendingResults(){return this._eventsPendingTimestamps.length!=0}resolvedEvents(){return this._resolvedEvents}exportSpeedscopeProfile(){let e=[],t=[];if(this._resolvedEvents.length==0)throw new Error("Profile is empty");let n={type:"evented",name:"GPU Profile",unit:"nanoseconds",startValue:0,endValue:ue.List_last(this._resolvedEvents).timestamp,events:t},r={$schema:"https://www.speedscope.app/file-format-schema.json",shared:{frames:e},profiles:[n]},o=new Map,a=d=>(o.has(d)||(o.set(d,e.length),e.push({name:d})),o.get(d)),s="O",l="C";for(let d of this._resolvedEvents)t.push({type:d.action.type==0?s:l,frame:a(d.action.name),at:d.timestamp});return JSON.stringify(r)}},p_=(t=>(t[t.OPEN_FRAME=0]="OPEN_FRAME",t[t.CLOSE_FRAME=1]="CLOSE_FRAME",t))(p_||{}),Dd=class{constructor(e,t){this.type=e,this.name=t}},Lh=class{constructor(e,t){this.action=e,this.query=t}},Mh=class{constructor(e,t){this.action=e,this.timestamp=t}},u_;(e=>{function i(t){return p_[t]}e.GPUProfilerActionType_toString=i})(u_||(u_={}));var kl;(r=>{function i(o,a,s){Fs?o.annotateBlock(a,s):s()}r.WebGLRenderingContext_annotateBlock=i;function e(o,a,s){return Fs?o.annotateBlock(a,s):s()}r.WebGLRenderingContext_annotateBlockAndReturn=e;function t(o,a,s){Fs?o.annotateProfile(a,s):s()}r.WebGLRenderingContext_annotateProfile=t;function n(o,a){return o.TEXTURE0+a}r.WebGLRenderingContext_TEXTURE_N=n})(kl||(kl={}));var Fs=!1;var on;(o=>{function i(a){let s=[];for(let l=0,d=a.length;l<d;l=l+1)s.push(a[l]);return s}o.asList=i;function e(a,s,l){a.addEventListener(s,l)}o.on1=e;function t(a,s,l,d){a.addEventListener(s,l,d)}o.on2=t;function n(a,s,l){a.removeEventListener(s,l)}o.off=n;function r(a){a.preventDefault()}o.preventDefault=r})(on||(on={}));var no;(r=>{function i(o){try{return o.getContext("2d")}catch{}return null}r.HTMLCanvasElement_getContext2D=i;function e(o){let a=null;try{a=o.getContext("webgl")}catch{}return Fs?n(o,a):a}r.HTMLCanvasElement_getContextWebGL1=e;function t(o,a){let s=null;try{s=o.getContext("webgl",a)}catch{}return Fs?n(o,s):s}r.HTMLCanvasElement_getContextWebGL2=t;function n(o,a){console.log("WebGL intercepts are enabled. This records all calls.");let s=window.requestAnimationFrame,l=0,d=new Fd(a);window.requestAnimationFrame=()=>(l=l+1,d.hasPendingResults()&&d.resolveEventsIfPossible(),s.apply(window,arguments));let c=o,p=a,u=c.width,h=c.height,f=l,y=[],g={},A="  ",T=q=>{y.push(A+q)},b=()=>{l!=f&&(f=l,T("yield;"))},_=(q,K)=>{b(),T(`{ // ${q}`);let F=A;A+="  ",d.isRunning()&&d.pushFrame(q);let P=K();return d.isRunning()&&d.popFrame(q),A=F,T("}"),P},m=(q,K)=>{d.isRunning()&&d.pushFrame(q),K(),d.isRunning()&&d.popFrame(q)},S=()=>{let q=`function* render(gl) {

`;q+=`  // Recorded using https://github.com/evanw/webgl-recorder
`;for(let K in g)q+="  var "+K+`s = [];
`;for(let K of y)q+=K+`
`;return q+=`}
`,q},v=(q,K)=>{let F=document.createElement("a");F.href=URL.createObjectURL(new Blob([q],{type:"application/javascript"})),F.download=K??"trace.js",document.body.appendChild(F),F.click(),document.body.removeChild(F)},C=q=>{v(S(),q??"trace.js")},N=()=>{d.start()},x=q=>{d.stop();let K=()=>{d.hasPendingResults()?s(K):v(d.exportSpeedscopeProfile(),`viewer-${+new Date}.speedscope.json`)};K()},z=q=>{if(q instanceof WebGLActiveInfo||q instanceof WebGLBuffer||q instanceof WebGLFramebuffer||q instanceof WebGLProgram||q instanceof WebGLRenderbuffer||q instanceof WebGLShader||q instanceof WebGLShaderPrecisionFormat||q instanceof WebGLTexture||q instanceof WebGLUniformLocation){let K=q.constructor.name,F=K in g?g[K]:g[K]=[],P=F.indexOf(q);return P==-1&&(P=F.length,F.push(q)),K+"s["+P+"]"}return null},$={traceLines:y,compileTrace:S,downloadTrace:C,startProfile:N,stopProfile:x,annotateBlock:_,annotateProfile:m};T(`gl.canvas.width = ${u};`),T(`gl.canvas.height = ${h};`);for(let q in p){let K=p[q];if(typeof K=="function"){let F=((P,k)=>()=>{let H=[];b(),(c.width!=u||c.height!=h)&&(u=c.width,h=c.height,T(`gl.canvas.width = ${u};`),T(`gl.canvas.height = ${h};`));for(let M=0,te=arguments.length;M<te;M=M+1){let J=arguments[M];if(typeof J=="number"||typeof J=="boolean"||typeof J=="string"||Array.isArray(J)||J===null)H.push(JSON.stringify(J));else if(ArrayBuffer.isView(J))H.push(`new ${J.constructor.name}([${Array.prototype.slice.call(J)}])`);else{let oe=z(J);oe!=null?H.push(oe):(console.warn("unsupported value:",J),H.push("null"))}}let L=`gl.${P}(`;for(let M=0,te=H.length;M<te;M=M+1)M!=0&&(L+=", "),L+=H[M];L+=");",d.isRunning()&&P.startsWith("draw")&&d.pushFrame(L);let Q=k.apply(p,arguments);d.isRunning()&&P.startsWith("draw")&&d.popFrame(L);let X=z(Q);return X!=null&&(L=X+" = "+L),T(L),Q})(q,K);$[q]=F}else(F=>{Object.defineProperty($,F,{set:P=>{p[F]=P},get:()=>p[F]})})(q)}return window.recordingContext=$,$}r.HTMLCanvasElement_makeRecordableContext=n})(no||(no={}));var Ld;(t=>{function i(n){return n.result}t.FileReader_resultAsArrayBuffer=i;function e(n){return n.result}t.FileReader_resultAsString=e})(Ld||(Ld={}));var qa;(e=>{function i(t){return t&&t.now?t.now():+new Date}e.Performance_now=i})(qa||(qa={}));var Yt;(m=>{function i(S,v,C){on.on1(S,v,C)}m.EventTarget_addEventListener1=i;function e(S,v,C){on.on1(S,v,C)}m.EventTarget_addEventListener2=e;function t(S,v,C){on.on1(S,v,C)}m.EventTarget_addEventListener3=t;function n(S,v,C){on.on1(S,v,C)}m.EventTarget_addEventListener4=n;function r(S,v,C){on.on1(S,v,C)}m.EventTarget_addEventListener5=r;function o(S,v,C){on.on1(S,v,C)}m.EventTarget_addEventListener6=o;function a(S,v,C){on.on1(S,v,C)}m.EventTarget_addEventListener7=a;function s(S,v,C,N){on.on2(S,v,C,N)}m.EventTarget_addEventListener8=s;function l(S,v,C,N){on.on2(S,v,C,N)}m.EventTarget_addEventListener9=l;function d(S,v,C,N){on.on2(S,v,C,N)}m.EventTarget_addEventListener10=d;function c(S,v,C,N){on.on2(S,v,C,N)}m.EventTarget_addEventListener11=c;function p(S,v,C,N){on.on2(S,v,C,N)}m.EventTarget_addEventListener12=p;function u(S,v,C,N){on.on2(S,v,C,N)}m.EventTarget_addEventListener13=u;function h(S,v,C,N){on.on2(S,v,C,N)}m.EventTarget_addEventListener14=h;function f(S,v,C){on.off(S,v,C)}m.EventTarget_removeEventListener1=f;function y(S,v,C){on.off(S,v,C)}m.EventTarget_removeEventListener2=y;function g(S,v,C){on.off(S,v,C)}m.EventTarget_removeEventListener3=g;function A(S,v,C){on.off(S,v,C)}m.EventTarget_removeEventListener4=A;function T(S,v,C){on.off(S,v,C)}m.EventTarget_removeEventListener5=T;function b(S,v,C){on.off(S,v,C)}m.EventTarget_removeEventListener6=b;function _(S,v,C){on.off(S,v,C)}m.EventTarget_removeEventListener7=_})(Yt||(Yt={}));var Qr;(r=>{function i(o){return new Image}r.HTMLDocument_createElementImage=i;function e(o){return o.createElement("canvas")}r.HTMLDocument_createElementCanvas=e;function t(o,a){return on.asList(o.querySelectorAll(a))}r.HTMLDocument_querySelectorAll=t;function n(o,a){return on.asList(o.getElementsByClassName(a))}r.HTMLDocument_getElementsByClassName=n})(Qr||(Qr={}));var ko;(e=>{function i(t){on.preventDefault(t)}e.Event_preventDefault=i})(ko||(ko={}));var Md;(t=>{function i(n){return on.asList(n.types)}t.DataTransfer_types=i;function e(n){return on.asList(n.files)}t.DataTransfer_files=e})(Md||(Md={}));var h_;(e=>{function i(t){if(typeof t.buttons>"u"){let n=t.which;return n<2?n:n==3?2:4}return t.buttons}e.MouseEvent_buttons=i})(h_||(h_={}));var Bd;(n=>{function i(r){return on.asList(r.touches)}n.TouchEvent_touches=i;function e(r){return on.asList(r.targetTouches)}n.TouchEvent_targetTouches=e;function t(r){return on.asList(r.changedTouches)}n.TouchEvent_changedTouches=t})(Bd||(Bd={}));function Kr(){return self}var Ya=Kr();var Vd;(o=>{function i(s,l){let d=0;switch(l){case 0:{for(let c of s)c<128?d=d+1:c<2048?d=d+2:c<65536?d=d+3:d=d+4;break}case 1:{for(let c of s)c<65536?d=d+1:d=d+2;break}case 2:{d=s.length;break}}return d}o.codeUnitCountForCodePoints=i;let e;(c=>(c[c.UTF8=0]="UTF8",c[c.UTF16=1]="UTF16",c[c.UTF32=2]="UTF32"))(e=o.Encoding||(o.Encoding={}));let a=class a{reset(l,d){return this.value=l,this.index=d,this.stop=l.length,this}countCodePointsUntil(l){let d=0;for(;this.index<l&&this.nextCodePoint()>=0;)d=d+1;return d}previousCodePoint(){if(this.index<=0)return-1;let l=this.value.charCodeAt(this.index=this.index-1);return(l&64512)!=56320?l:this.index<=0?-1:(this.value.charCodeAt(this.index=this.index-1)<<10)+l+(65536-56623104-56320)}nextCodePoint(){if(this.index>=this.stop)return-1;let l=this.value.charCodeAt((this.index=this.index+1)+-1);if((l&64512)!=55296)return l;if(this.index>=this.stop)return-1;let d=this.value.charCodeAt((this.index=this.index+1)+-1);return(l<<10)+d+(65536-56623104-56320)}constructor(){this.value="",this.index=0,this.stop=0}};a.INSTANCE=new a;let t=a;o.StringIterator=a;let n;(l=>{function s(d){return e[d]}l.Encoding_toString=s})(n=o.in_Encoding||(o.in_Encoding={})),o.STRING_ENCODING=Bi==1?0:Bi==2||Bi==3?1:2})(Vd||(Vd={}));var _e=class{static equals(e,t){return e==null!=(t==null)?!1:e==null?!0:e.value==t.value}constructor(e){this.value=e}},m_=1e5;function On(i,e){if(e!=i,e.length<m_){i.push(...e);return}for(let t of e)i.push(t)}function g_(i,e,t){if(t!=i,t.length<m_){i.splice(e,0,...t);return}for(let n of t)i.splice(e,0,n),e=e+1}var ue;(d=>{function i(c){c.length!=0,c.pop()}d.List_removeLast=i;function e(c){let p=0;for(let u=0,h=c.length;u<h;u=u+1){let f=!1,y=c[u];for(let g=0;g<u;g=g+1)if(y==c[g]){f=!0;break}f||(p<u&&(c[p]=c[u]),p=p+1)}for(;p<c.length;)i(c)}d.List_removeDuplicates=e;function t(c){return c.length!=0,c[c.length-1]}d.List_last=t;function n(c,p){c.indexOf(p)==-1&&c.push(p)}d.List_appendOne=n;function r(c,p){let u=c.indexOf(p);u>=0&&c.splice(u,1)}d.List_removeOne=r;function o(c,p){let u=0;for(let h=0,f=c.length;h<f;h=h+1)p(c[h])||(u<h&&(c[u]=c[h]),u=u+1);for(;u<c.length;)i(c)}d.List_removeIf=o;function a(c,p){if(c.length!=p.length)return!1;for(let u=0,h=c.length;u<h;u=u+1)if(c[u]!=p[u])return!1;return!0}d.List_equals=a;function s(c,p){let u=c.slice();return u.push(p),u}d.List_cloneAndAppend=s;function l(c,p,u){if(c==null!=(p==null))return!1;if(c==null)return!0;if(c.length==p.length){for(let h=0,f=c.length;h<f;h=h+1)if(!u(c[h],p[h]))return!1;return!0}return!1}d.List_equalsWithComparison=l})(ue||(ue={}));var Be;(n=>{function i(r,o,a){let s=r.get(o);return s!==void 0?s:a}n.StringMap_get=i;function e(r,o){r.forEach((a,s)=>{o(s,a)})}n.StringMap_each=e;function t(r){let o={};return e(r,(a,s)=>{o[a]=s}),o}n.StringMap_toJSObject=t})(Be||(Be={}));var Ht;(t=>{function i(n,r,o){let a=n.get(r);return a!==void 0?a:o}t.IntMap_get=i;function e(n,r){n.forEach((o,a)=>{r(a,o)})}t.IntMap_each=e})(Ht||(Ht={}));var ht;(t=>{function i(n,r){return(r<n?1:0)-(r>n?1:0)}t.int_compare=i;function e(n,r){return Ya.hack1=n,Ya.hack2=r,Ya.hack3=Ya.hack1%Ya.hack2,Ya.hack3|0}t.int_remainder=e})(ht||(ht={}));var Xt;(n=>{function i(r,o){return(o<r?1:0)-(o>r?1:0)}n.double_compare=i;function e(r,o,a){return r*(1-a)+o*a}n.double_lerp=e;function t(r,o,a){return Math.min(Math.max(r,o),a)}n.double_clamp=t})(Xt||(Xt={}));var Bn;(a=>{function i(s){return s}a.string_toString=i;function e(s){let l=new Pd;for(let d of s)l.buffer+=o(d);return l.buffer}a.string_fromCodePoints=e;function t(s,l){return(l<s|0)-(l>s|0)}a.string_compare=t;function n(s){let l="";for(let d of s)l+=String.fromCharCode(d);return l}a.string_fromCodeUnits=n;function r(s){let l=[],d=Vd.StringIterator.INSTANCE;for(d.reset(s,0);;){let c=d.nextCodePoint();if(c<0)return l;l.push(c)}}a.string_codePoints=r;function o(s){return s<65536?String.fromCharCode(s):String.fromCharCode((s-65536>>10)+55296)+String.fromCharCode((s-65536&1024-1)+56320)}a.string_fromCodePoint=o})(Bn||(Bn={}));var Bi=3;var Pe;(_=>{function i(m,S,v,C,N,x){_._internalTrackAnalyticsEvent=m,_._internalDefinedAnalyticsHandler=S,_._appTimerStart=v,_._appTimerStop=C,_._internalLoadTimeTracker=N,_._internalSocketConnectionTracker=x}_.initialize=i;function e(m){let S=_._internalTrackAnalyticsEvent;return _._internalTrackAnalyticsEvent=m,()=>{_._internalTrackAnalyticsEvent=S}}_.mockTrackEvent=e,_.trackDefinedEvent=(m,S)=>{_._internalDefinedAnalyticsHandler!==null&&_._internalDefinedAnalyticsHandler.trackDefinedEvent(m,S)};function n(m,S,v){_._internalTrackAnalyticsEvent!=null&&(0,_._internalTrackAnalyticsEvent)(m,S,v)}_.trackEvent=n;function r(m,S){o(m,S,void 0)}_.trackEventJSON1=r;function o(m,S,v){_._internalTrackAnalyticsEvent!=null&&(0,_._internalTrackAnalyticsEvent)(m,S,v)}_.trackEventJSON2=o;function a(m){_._appTimerStart!=null&&(0,_._appTimerStart)(m)}_.appTimerStart=a;function s(m){_._appTimerStop!=null&&(0,_._appTimerStop)(m)}_.appTimerStop=s;function l(){_._internalLoadTimeTracker!==null&&_._internalLoadTimeTracker.handleMultiplayerOpenConnection()}_.handleMultiplayerOpenConnection=l;function d(){_._internalLoadTimeTracker!==null&&_._internalLoadTimeTracker.handleMultiplayerIFLSatisfied()}_.handleMultiplayerIFLSatisfied=d;function c(){_._internalLoadTimeTracker!==null&&_._internalLoadTimeTracker.handleMultiplayerFirstResponse()}_.handleMultiplayerFirstResponse=c;function p(){_._internalLoadTimeTracker!==null&&_._internalLoadTimeTracker.handleIFLCompleted()}_.handleIFLCompleted=p;function u(m){_._internalSocketConnectionTracker!==null&&_._internalSocketConnectionTracker.handleSocketDisconnect(m)}_.handleMultiplayerSocketDisconnected=u;function h(m,S,v,C){_._internalSocketConnectionTracker!==null&&(m||S>3)&&_._internalSocketConnectionTracker.handleSocketConnectionAttempt(m,S,v,C)}_.handleMultiplayerSocketConnectionAttempt=h,_._internalTrackAnalyticsEvent=null,_._internalDefinedAnalyticsHandler=null,_._internalLoadTimeTracker=null,_._internalSocketConnectionTracker=null,_._appTimerStart=null,_._appTimerStop=null})(Pe||(Pe={}));var Rt;(S=>{function i(){return S._workerURL}S.getWorkerURL=i;function e(v){S._workerURL=v}S.setWorkerURL=e;function t(){return S._imagePrefixURL}S.getImagePrefixURL=t;function n(v){S._imagePrefixURL=v}S.setImagePrefixURL=n;function r(){return S._imageBatchURL}S.getImageBatchURL=r;function o(v){S._imageBatchURL=v}S.setImageBatchURL=o;function a(){return S._videoPrefixURL}S.getVideoPrefixUrl=a;function s(v){S._videoPrefixURL=v}S.setVideoPrefixUrl=s;function l(){return S._deviceInfoByIdentifier}S.getDeviceInfoByIdentifier=l;function d(v){S._deviceInfoByIdentifier=v}S.setDeviceInfoByIdentifier=d;function c(){return S._containerElement}S.getContainerElement=c;function p(v){S._containerElement=v}S.setContainerElement=p;function u(){return S._forceMobileOptimizations}S.forceMobileOptimizations=u;function h(v){let C=x=>{if(!(x in v))throw new Error(`Missing required parameter '${x}'`);return v[x]},N=(x,z)=>x in v?v[x]:z;S._workerURL=C("workerURL"),S._deviceInfoByIdentifier=N("deviceInfoByIdentifier",S._deviceInfoByIdentifierDefault),S._containerElement=C("containerElement"),S._forceMobileOptimizations=N("forceMobileOptimizations",!1)}S.initialize=h,S._workerURL=null,S._imagePrefixURL=null,S._imageBatchURL=null,S._videoPrefixURL=null,S._deviceInfoByIdentifierDefault=null,S._deviceInfoByIdentifier=S._deviceInfoByIdentifierDefault,S._containerElement=null,S._forceMobileOptimizations=!1})(Rt||(Rt={}));var Je;(g=>{let i;function e(A){i=A}g.initialize=e;function t(){return i!=null&&i.mac==!0}g.mac=t;function n(){return i!=null&&i.windows==!0}g.windows=n;function r(){return i!=null&&i.ios==!0}g.ios=r;function o(){return i!=null&&i.android==!0}g.android=o;function a(){return i!=null&&i.linux==!0}g.linux=a;function s(){return i!=null&&i.chrome==!0}g.chrome=s;function l(){return i!=null&&i.safari==!0}g.safari=l;function d(){return i!=null&&i.firefox==!0}g.firefox=d;function c(){return i!=null&&i.msedge==!0}g.edge=c;function p(){return i!=null&&i.msie==!0}g.msie=p;function u(A){return A==2||A==1}g.isMobile=u;function h(){return g.isMobile(g.current())||g.current()==4&&navigator.maxTouchPoints>0}g.isCurrentOSMobileOrIPad=h;function f(){return g.OS__current==0&&(g.OS__current=t()?4:n()?5:r()?2:o()?1:a()?3:0),g.OS__current}g.current=f,g.OS__current=0})(Je||(Je={}));var kd=null;function D(){return kd}function Bh(i){kd=i}function Ul(){kd!=null&&kd.reset(),Bh(null)}var hi=null,Lr=!1,jo=!1,mi=!1;function f_(){jo=!0}function __(){mi=!0}var Y;(V=>{function i(){return k().keep_ref_trans_dissolve}V.keepReferenceTransitionDissolve=i;function e(){return k().use_int_boundaries_for_scissor}V.useIntBoundariesForScissor=e;function t(){return k().optimization_exposure_logging}V.optimizationExposureLogging=t;function n(){return k().viewer_perf_h2_2023_holdout}function r(){return!n()&&k().viewer_perf_h2_2023_combined}function o(){return!n()&&k().framebuffer_switch_budget_viewer}V.enableFramebufferSwitchBudget=o;function a(){return!n()&&k().viewer_skip_not_dirty_tree_opt}V.viewerSkipNotDirtyTreeOpt=a;function s(){return!n()&&k().viewer_animation_easing_cache}V.viewerAnimationEasingCache=s;function l(){return!n()&&k().rounded_mask_optimization}V.roundedMaskOptimization=l;function d(){return!n()&&k().static_render_tree_animations}V.useStaticRenderTreeIfNonAnimatingSubtree=d;function c(){return!n()&&k().debounce_mouse_move_scrolling}V.debounceMouseMoveScrolling=c;function p(){return!n()&&!r()&&k().consolidated_magic_move_cache}V.useConsolidatedRenderTreeMagicMoveCache=p;function u(){return!n()&&!r()&&k().viewer_skip_invisible_tree_opt}V.viewerSkipInvisibleTreeOpt=u;function h(){return!n()&&!r()&&k().viewer_tile_list_culling}V.cullTreesDuringTilePrioritization=h;function f(){return!Ot()&&!n()&&!r()&&k().smart_animate_cache_transform}V.smartAnimateCacheTransform=f;function y(){return!n()&&!r()&&k().viewer_ctg_equal_within_bounds}V.compositeTileGridEqualWithinBounds=y;function g(){return!n()&&k().prototype_mousemove_perf}V.prototypeMouseMovePerf=g;function A(){return!n()&&!r()&&k().prototype_ifl_time_slice}V.prototypeIFLTimeSlice=A;function T(){return!n()&&!r()&&k().viewer_bblur_bounds_opt||S()}V.backgroundBlurBoundsOpt=T;function b(){return!n()&&!r()&&k().viewer_extra_blit_fix}V.viewerExtraBlitFix=b;function _(){return!Ot()&&!n()&&!r()&&k().viewer_large_tiles_drawtoscreen}V.viewerLargeTilesDrawToScreen=_;function m(){return Ot()&&k().viewer_respect_budget_on_scroll}V.respectRenderBudgetOnScroll=m;function S(){return k().viewer_background_blur_opts}V.useBackgroundBlurOpts=S;function v(){return k().viewer_flush_after_clear}V.shouldFlushAfterClear=v;function C(){return k().viewer_flush_after_stencil_cover}V.shouldFlushAfterStencilCover=C;function N(){return k().flush_after_draws}V.shouldFlushAfterDraws=N;function x(){return Ot()}V.shouldPreventVolatileCaching=x;function z(){return k().use_glslx_replacement_viewer}V.shouldUseGLSLXReplacement=z;function $(){return window.devicePixelRatio>3}V.isHighDPR=$;function q(){return k().internal_only_debug_tools}V.internalDebugTools=q;function K(){return!$()}V.useSSAA=K;function F(W){return V._bowser.version===null||V._bowser.version===void 0?!1:V._bowser.compareVersions([V._bowser.version,W])>=0}V.isBrowserVersionAtLeast=F;function P(W){return V._bowser.osversion===null||V._bowser.osversion===void 0?!1:V._bowser.compareVersions([V._bowser.osversion,W])>=0}V.isOSVersionAtLeast=P;function k(){return V._featureFlags}V.getFeatureFlags=k;function H(W){var j,se;V._featureFlags=W,Lr?hi.featureFlagsCppApi.updateFeatureFlags(W):((se=(j=D())==null?void 0:j.modules())==null?void 0:se.featureFlagsCppApi)!=null&&D().modules().featureFlagsCppApi.updateFeatureFlags(W)}V.setFeatureFlags=H;function L(W){let j=Object.assign({},V._featureFlags);H(Object.assign(j,W))}V.updateFeatureFlags=L;function Q(){return V._viewerMode}V.getViewerMode=Q;function X(W){V._viewerMode=W}V.setViewerMode=X;function M(){return V._scrollToPan}V.getScrollToPan=M;function te(W){V._scrollToPan=W}V.setScrollToPan=te;function J(){return V._dragToPan}V.getDragToPan=J;function oe(W){V._dragToPan=W}V.setDragToPan=oe;function le(){return V._disablePrototypeDeviceFrames}V.disablePrototypeDeviceFrames1=le;function tt(W){V._disablePrototypeDeviceFrames=W}V.disablePrototypeDeviceFrames2=tt;function nt(){return V._gameControllerListener}V.gameControllerListener=nt;function At(){return V._isInlinePreview}V.isInlinePreview=At;function Lt(W){V.protoUseFrameEvictionForUnitTests=W}V.setProtoUseFrameEvictionForUnitTests=Lt;function Tt(){return 2==0?V.protoUseFrameEvictionForUnitTests:Ot()}V.protoUseFrameEviction=Tt;function de(){return!Tt()&&V._featureFlags.prototype_ifl_preload_more}V.protoPreloadMore=de;function yt(W){let j=ve=>{if(!(ve in W))throw new Error(`Missing required parameter '${ve}'`);return W[ve]},se=(ve,ct)=>ve in W?W[ve]:ct,he=j("featureFlags");H(he),V._viewerMode=ut.ViewerMode_create(j("viewerMode")),Pe.initialize(se("trackAnalyticsEvent",null),se("definedAnalyticsHandler",null),se("appTimerStart",null),se("appTimerStop",null),se("loadTimeTracker",null),se("socketConnectionTracker",null)),V._bowser=j("bowser"),Je.initialize(V._bowser),V._scrollToPan=se("scrollToPan",V._scrollToPanDefault),V._disablePrototypeDeviceFrames=se("disablePrototypeDeviceFrames",V._disablePrototypeDeviceFramesDefault),V._gameControllerListener=se("gameControllerListener",null),V._isInlinePreview=se("isInlinePreview",!1)}V.initialize=yt;function er(){return!V._disablePrototypeDeviceFrames&&V._viewerMode==1}V.deviceFramesSupported=er;function Wt(W){V.prototypeBackgroundColorOverride=W}V.setPrototypeBackgroundColorOverride=Wt;function cn(){if(V._htmlImageDecodeMethodIsPresent==null){let W=Qr.HTMLDocument_createElementImage(document),j=W.decode!==null&&W.decode!==void 0;V._htmlImageDecodeMethodIsPresent=new _e(j)}return V._htmlImageDecodeMethodIsPresent.value}V.htmlImageDecodeMethodIsPresent=cn;function Ot(){return Je.isMobile(Je.current())||Je.current()==4&&navigator.maxTouchPoints>0||Rt.forceMobileOptimizations()}V.shouldApplyMobileOptimizations=Ot;let st;(se=>(se[se.MIRROR=0]="MIRROR",se[se.PROTOTYPE=1]="PROTOTYPE"))(st=V.ViewerMode||(V.ViewerMode={}));let ut;(se=>{function W(he){if(typeof he=="string")switch(he){case"MIRROR":return 0;case"PROTOTYPE":return 1}throw new Error(`Invalid viewer mode: ${he}`)}se.ViewerMode_create=W;function j(he){return st[he]}se.ViewerMode_toString=j})(ut=V.in_ViewerMode||(V.in_ViewerMode={})),V._bowser=null,V._featureFlags={},V._viewerMode=1,V._scrollToPanDefault=!0,V._scrollToPan=V._scrollToPanDefault,V._dragToPanDefault=!0,V._dragToPan=V._dragToPanDefault,V._disablePrototypeDeviceFramesDefault=!1,V._disablePrototypeDeviceFrames=V._disablePrototypeDeviceFramesDefault,V._gameControllerListener=null,V._isInlinePreview=!1,V.protoUseFrameEvictionForUnitTests=!1,V.prototypeBackgroundColorOverride=null,V._htmlImageDecodeMethodIsPresent=null,V.forceInitiateStateChangeForTests=!1})(Y||(Y={}));var wn;(a=>{function i(s,l){if(r.set(s,l),!o.has(s))o.set(s,r.get(s));else{let d=o.get(s);o.set(s,Math.max(d,l))}}a.trackNumber=i;function e(s,l){if(r.has(s)?r.set(s,r.get(s)+l):r.set(s,l),!o.has(s))o.set(s,r.get(s));else{let d=o.get(s);o.set(s,Math.max(d,r.get(s)))}return r.get(s)}a.increment=e;function t(s){return o.has(s)?o.get(s):0}a.getMax=t;function n(){let s=window.performance.memory;s&&s.jsHeapSizeLimit&&s.usedJSHeapSize&&(i("JS Heap size (MB)",s.jsHeapSizeLimit/(1024*1024)|0),i("Used Heap size (MB)",s.usedJSHeapSize/(1024*1024)|0));let l={};for(let d of Array.from(r.keys())){let c=r.get(d);l[d]=Math.round(c*100)/100}return l}a.getStatsForDebugging=n;let r=new Map,o=new Map})(wn||(wn={}));function wv(){let i=new Map,e=window.location.search;if(e.length==0)return i;e=e.slice(1);for(let t of e.split("&")){let n=t.split("=");n.length==2&&i.set(n[0],n[1])}return i}function rr(){if(!A_){A_=!0;let i=wv(),e=Be.StringMap_get(i,"force-dpr",null);if(e!=null){let t=+parseFloat(e);isNaN(t)||(Vh=new _e(un.Math_clamp1(t,.1,4)))}}return Vh!=null?Vh.value:window.devicePixelRatio}var A_=!1,Vh=null;var Fn=class i{constructor(){Y.shouldUseGLSLXReplacement()?(this.GLSLX_NAME_U_SHAPE_TYPE="uShapeType",this.GLSLX_NAME_U_ELLIPSE_CENTER="uEllipseCenter",this.GLSLX_NAME_U_ELLIPSE_RADII="uEllipseRadii",this.GLSLX_NAME_U_RECT="uRect",this.GLSLX_NAME_U_CORNER_RADII="uCornerRadii",this.GLSLX_NAME_U_TYPE="uType",this.GLSLX_NAME_U_OPACITY="uOpacity",this.GLSLX_NAME_U_TEXTURE0="uTexture0",this.GLSLX_SOURCE_AAA_SHAPE_GRADIENT_FRAGMENT=`#extension GL_OES_standard_derivatives:enable
precision highp float;const int SHAPE_TYPE_ELLIPSE = 0;const int SHAPE_TYPE_ROUNDED_RECT = 1;uniform int uShapeType;uniform vec2 uEllipseCenter;uniform vec2 uEllipseRadii;uniform vec4 uRect;uniform vec4 uCornerRadii;float ellipseImplicitEquation(in vec2 nodeSpacePoint, in vec2 ellipseCenter, in vec2 ellipseRadii) {nodeSpacePoint -= ellipseCenter;return ((nodeSpacePoint.x * nodeSpacePoint.x) / (ellipseRadii.x * ellipseRadii.x) +(nodeSpacePoint.y * nodeSpacePoint.y) / (ellipseRadii.y * ellipseRadii.y) -1.);}float roundedRectImplicitEquation(in vec2 nodeSpacePoint, in vec4 bounds, vec4 cornerRadii) {vec2 quadrantSize = (bounds.zw - bounds.xy) / 2.;vec2 ptRelativeToBoxCenter = nodeSpacePoint - quadrantSize;vec2 radiiInBoxHalf = ptRelativeToBoxCenter.x > 0. ? cornerRadii.zy : cornerRadii.wx;float radiusInBoxQuadrant = ptRelativeToBoxCenter.y > 0. ? radiiInBoxHalf.x : radiiInBoxHalf.y;vec2 q = abs(ptRelativeToBoxCenter) - quadrantSize + radiusInBoxQuadrant;return min(max(q.x, q.y), 0.0) + length(max(q, 0.0)) - radiusInBoxQuadrant;}float shapeImplicitEquation(in vec2 nodeSpacePoint) {if (uShapeType == SHAPE_TYPE_ELLIPSE) {return ellipseImplicitEquation(nodeSpacePoint, uEllipseCenter, uEllipseRadii);} else if (uShapeType == SHAPE_TYPE_ROUNDED_RECT) {return roundedRectImplicitEquation(nodeSpacePoint, uRect, uCornerRadii);}return 0.;}float pixelShapeCoverage(vec2 nodeSpacePoint) {float eqValue = shapeImplicitEquation(nodeSpacePoint);float gradientLengthApprox = fwidth(eqValue);gradientLengthApprox = max(gradientLengthApprox, 0.00001);float distance = eqValue / gradientLengthApprox;return 1.0 - smoothstep(-0.5, 0.5, distance);}uniform int uType;const float PI = 3.141592;vec2 _gradientCoord(in vec2 paintUV) {const int LINEAR = 1;const int RADIAL = 2;const int ANGULAR = 3;const int DIAMOND = 4;vec2 uv = paintUV - 0.5;float t =uType == LINEAR ? uv.x + 0.5 :uType == RADIAL ? 2.0 * length(uv) :uType == ANGULAR ? fract(atan(uv.y, uv.x) / (2.0 * PI)) :uType == DIAMOND ? 2.0 * max(abs(uv.x + uv.y), abs(uv.y - uv.x)) :0.0;return vec2(t, 0.25 + (0.75 - 0.25) / 256.0);}const float DITHER_FACTOR = 0.003922;const float DITHER_RANGE = 2.0 * DITHER_FACTOR;float random() {vec2 coordCopy = gl_FragCoord.xy;return fract(sin(dot(vec2(12.9898, 78.233), coordCopy)) * 43758.5453);}vec4 ditherColor(vec4 color) {float offset = (random() - 0.5) * DITHER_RANGE; return color.a > 0.0 ? min(abs(color + offset), 1.0) : color;}uniform float uOpacity;uniform sampler2D uTexture0;varying vec2 vNodeSpacePoint;varying vec2 vGradientSampleUV;void main() {float coverageAlpha = pixelShapeCoverage(vNodeSpacePoint);vec2 coord = _gradientCoord(vGradientSampleUV);gl_FragColor = ditherColor(texture2D(uTexture0, coord) * uOpacity) * coverageAlpha;}`,this.GLSLX_NAME_U_EMULATE_WRAP_ADDRESS="uEmulateWrapAddress",this.GLSLX_NAME_U_EMULATE_BORDER_ADDRESS="uEmulateBorderAddress",this.GLSLX_SOURCE_AAA_SHAPE_IMAGE_FRAGMENT=`#extension GL_OES_standard_derivatives:enable
precision highp float;uniform bool uEmulateWrapAddress;uniform bool uEmulateBorderAddress;vec4 sampleImage(sampler2D texture, vec2 coord) {if (uEmulateWrapAddress) {coord = fract(coord);}vec4 color = texture2D(texture, coord);if (uEmulateBorderAddress && coord != clamp(coord, 0.0, 1.0)) color.a = 0.0;return color;}const vec2 AA_JITTER_PATTERN_1 = vec2(-3, -5);const vec2 AA_JITTER_PATTERN_2 = vec2(5, 1);const vec2 AA_JITTER_PATTERN_3 = vec2(-1, 3);const vec2 AA_JITTER_PATTERN_4 = vec2(7, -7);const vec2 AA_JITTER_PATTERN_5 = vec2(1, -3);const vec2 AA_JITTER_PATTERN_6 = vec2(-5, 5);const vec2 AA_JITTER_PATTERN_7 = vec2(3, 7);const vec2 AA_JITTER_PATTERN_8 = vec2(-7, -1);uniform sampler2D uTexture0;varying vec2 vPaintASample;varying vec2 vStepA;vec4 sampleImagePaintAWithMSAA() {return (sampleImage(uTexture0, vPaintASample + AA_JITTER_PATTERN_1 * vStepA) +sampleImage(uTexture0, vPaintASample + AA_JITTER_PATTERN_2 * vStepA) +sampleImage(uTexture0, vPaintASample + AA_JITTER_PATTERN_3 * vStepA) +sampleImage(uTexture0, vPaintASample + AA_JITTER_PATTERN_4 * vStepA) +sampleImage(uTexture0, vPaintASample + AA_JITTER_PATTERN_5 * vStepA) +sampleImage(uTexture0, vPaintASample + AA_JITTER_PATTERN_6 * vStepA) +sampleImage(uTexture0, vPaintASample + AA_JITTER_PATTERN_7 * vStepA) +sampleImage(uTexture0, vPaintASample + AA_JITTER_PATTERN_8 * vStepA)) / 8.;}const int SHAPE_TYPE_ELLIPSE = 0;const int SHAPE_TYPE_ROUNDED_RECT = 1;uniform int uShapeType;uniform vec2 uEllipseCenter;uniform vec2 uEllipseRadii;uniform vec4 uRect;uniform vec4 uCornerRadii;float ellipseImplicitEquation(in vec2 nodeSpacePoint, in vec2 ellipseCenter, in vec2 ellipseRadii) {nodeSpacePoint -= ellipseCenter;return ((nodeSpacePoint.x * nodeSpacePoint.x) / (ellipseRadii.x * ellipseRadii.x) +(nodeSpacePoint.y * nodeSpacePoint.y) / (ellipseRadii.y * ellipseRadii.y) -1.);}float roundedRectImplicitEquation(in vec2 nodeSpacePoint, in vec4 bounds, vec4 cornerRadii) {vec2 quadrantSize = (bounds.zw - bounds.xy) / 2.;vec2 ptRelativeToBoxCenter = nodeSpacePoint - quadrantSize;vec2 radiiInBoxHalf = ptRelativeToBoxCenter.x > 0. ? cornerRadii.zy : cornerRadii.wx;float radiusInBoxQuadrant = ptRelativeToBoxCenter.y > 0. ? radiiInBoxHalf.x : radiiInBoxHalf.y;vec2 q = abs(ptRelativeToBoxCenter) - quadrantSize + radiusInBoxQuadrant;return min(max(q.x, q.y), 0.0) + length(max(q, 0.0)) - radiusInBoxQuadrant;}float shapeImplicitEquation(in vec2 nodeSpacePoint) {if (uShapeType == SHAPE_TYPE_ELLIPSE) {return ellipseImplicitEquation(nodeSpacePoint, uEllipseCenter, uEllipseRadii);} else if (uShapeType == SHAPE_TYPE_ROUNDED_RECT) {return roundedRectImplicitEquation(nodeSpacePoint, uRect, uCornerRadii);}return 0.;}float pixelShapeCoverage(vec2 nodeSpacePoint) {float eqValue = shapeImplicitEquation(nodeSpacePoint);float gradientLengthApprox = fwidth(eqValue);gradientLengthApprox = max(gradientLengthApprox, 0.00001);float distance = eqValue / gradientLengthApprox;return 1.0 - smoothstep(-0.5, 0.5, distance);}uniform float uOpacity;varying vec2 vNodeSpacePoint;void main() {vec4 color = sampleImagePaintAWithMSAA();color.rgb *= color.a;gl_FragColor = color * uOpacity * pixelShapeCoverage(vNodeSpacePoint);}`,this.GLSLX_NAME_U_GLOBAL_TINT="uGlobalTint",this.GLSLX_NAME_U_GLOBAL_COLOR="uGlobalColor",this.GLSLX_NAME_U_GLOBAL_SHADOWS="uGlobalShadows",this.GLSLX_NAME_U_GLOBAL_HIGHLIGHTS="uGlobalHighlights",this.GLSLX_NAME_U_GLOBAL_EXPOSURE="uGlobalExposure",this.GLSLX_NAME_U_GLOBAL_TEMPERATURE="uGlobalTemperature",this.GLSLX_NAME_U_GLOBAL_CONTRAST="uGlobalContrast",this.GLSLX_SOURCE_AAA_SHAPE_IMAGE_COLOR_ADJUST_FRAGMENT=`#extension GL_OES_standard_derivatives:enable
precision highp float;uniform bool uEmulateWrapAddress;uniform bool uEmulateBorderAddress;vec4 sampleImage(sampler2D texture, vec2 coord) {if (uEmulateWrapAddress) {coord = fract(coord);}vec4 color = texture2D(texture, coord);if (uEmulateBorderAddress && coord != clamp(coord, 0.0, 1.0)) color.a = 0.0;return color;}const vec2 AA_JITTER_PATTERN_1 = vec2(-3, -5);const vec2 AA_JITTER_PATTERN_2 = vec2(5, 1);const vec2 AA_JITTER_PATTERN_3 = vec2(-1, 3);const vec2 AA_JITTER_PATTERN_4 = vec2(7, -7);const vec2 AA_JITTER_PATTERN_5 = vec2(1, -3);const vec2 AA_JITTER_PATTERN_6 = vec2(-5, 5);const vec2 AA_JITTER_PATTERN_7 = vec2(3, 7);const vec2 AA_JITTER_PATTERN_8 = vec2(-7, -1);uniform sampler2D uTexture0;varying vec2 vPaintASample;varying vec2 vStepA;vec4 sampleImagePaintAWithMSAA() {return (sampleImage(uTexture0, vPaintASample + AA_JITTER_PATTERN_1 * vStepA) +sampleImage(uTexture0, vPaintASample + AA_JITTER_PATTERN_2 * vStepA) +sampleImage(uTexture0, vPaintASample + AA_JITTER_PATTERN_3 * vStepA) +sampleImage(uTexture0, vPaintASample + AA_JITTER_PATTERN_4 * vStepA) +sampleImage(uTexture0, vPaintASample + AA_JITTER_PATTERN_5 * vStepA) +sampleImage(uTexture0, vPaintASample + AA_JITTER_PATTERN_6 * vStepA) +sampleImage(uTexture0, vPaintASample + AA_JITTER_PATTERN_7 * vStepA) +sampleImage(uTexture0, vPaintASample + AA_JITTER_PATTERN_8 * vStepA)) / 8.;}const vec3 RGB2Y = vec3(0.2126, 0.7152, 0.0722);const float IMAGE_HIGHLIGHT_SHADOW_THRESHOLD = 0.5;uniform float uGlobalTint;uniform float uGlobalColor;uniform float uGlobalShadows;uniform float uGlobalHighlights;uniform float uGlobalExposure;uniform float uGlobalTemperature;uniform float uGlobalContrast;vec3 colorToLinear(vec3 color) {color = pow(color, vec3(2.2));return color;}vec3 colorFromLinear(vec3 color) {color = pow(color, vec3(1.0 / 2.2));return color;}float rangeFactor(vec3 color, float shadows, float highlights) {float lThreshold = dot(color, RGB2Y) - pow(IMAGE_HIGHLIGHT_SHADOW_THRESHOLD, 2.2);return 0.75 * lThreshold / sqrt(1.0 + 4.0 * lThreshold * lThreshold) * (lThreshold > 0.0 ? highlights : -shadows * 0.999);}vec3 adjustExposure(vec3 color, float exposureAdjust) {float lFactor = pow(10.0, 2.0 * exposureAdjust) - 1.0;const float lSqueeze = 0.75;float lUnsqueeze = 1.0 / (1.0 - lSqueeze) - 1.0;float gray = dot(color, RGB2Y);lUnsqueeze *= 1.0 + gray * gray * min(0.0, exposureAdjust) / (0.2 - min(0.0, exposureAdjust));color += (gray - color) * lSqueeze;if (exposureAdjust < 0.0) {color *= 1.0 + exposureAdjust / 16.0;gray *= 1.0 + exposureAdjust / 16.0;}color *= (lFactor + 1.0) / (color * lFactor + 1.0);gray *= (lFactor + 1.0) / (gray * lFactor + 1.0);color += (color - gray) * lUnsqueeze;color = clamp(color, 0.0, 1.0);return color;}vec3 adjustColor(vec3 color, float colorAdjust) {float gray = dot(color, RGB2Y);if (colorAdjust <= 0.0) {color -= (gray - color) * colorAdjust;} else {float lNeg = gray / (gray - min(min(color.r, color.g), color.b) + 1e-6);float lPos = (1.0 - gray) / (max(max(color.r, color.g), color.b) - gray + 1e-6);float lFactor = mix(1.0, min(lNeg, lPos), colorAdjust);lFactor = min(lFactor, 2.0); color += (gray - color) * (1.0 - lFactor);}return color;}float smootherstep(float edge0, float edge1, float x) {x = clamp((x - edge0) / (edge1 - edge0), 0.0, 1.0);return x * x * x * (x * (x * 6.0 - 15.0) + 10.0);}vec3 adjustTempTintContrast(vec3 color, float temp, float tint, float contrast) {vec3 lXYZ = mat3(0.4124564, 0.2126729, 0.0193339,0.3575761, 0.7151522, 0.1191920,0.1804375, 0.0721750, 0.9503041) * color;lXYZ.x /= 0.95047;lXYZ.z /= 1.08883;lXYZ = pow(lXYZ, vec3(1.0 / 3.0));vec3 lLAB = vec3(116.0 * lXYZ.y - 16.0,500.0 * (lXYZ.x - lXYZ.y),200.0 * (lXYZ.y - lXYZ.z));lLAB.y += 30.0 * tint;lLAB.z += 30.0 * temp;float scaledThreshold = IMAGE_HIGHLIGHT_SHADOW_THRESHOLD * 100.0;float thresholdDelta = 30.0;float contrastLeftCurve = contrast < 0.0? (lLAB.x - scaledThreshold) * 0.2 + 50.0: lLAB.x;float contrastRightCurve = contrast < 0.0? lLAB.x: smootherstep(scaledThreshold - thresholdDelta,scaledThreshold + thresholdDelta, lLAB.x) * 100.0;float interp = contrast < 0.0 ? contrast + 1.0 : contrast;lLAB.x = mix(contrastLeftCurve, contrastRightCurve, interp);lXYZ.y = (lLAB.x + 16.0) / 116.0;lXYZ.x = lLAB.y / 500.0 + lXYZ.y;lXYZ.z = lXYZ.y - lLAB.z / 200.0;lXYZ *= lXYZ * lXYZ;lXYZ.x *= 0.95047;lXYZ.z *= 1.08883;color = mat3(3.2404542, -0.9692660, 0.0556434,-1.5371385, 1.8760108, -0.2040259,-0.4985314, 0.0415560, 1.0572252) * lXYZ;color = clamp(color, 0.0, 1.0);return color;}vec3 pipeline(vec3 color) {color = colorToLinear(color);float originalRangeFactor = rangeFactor(color, uGlobalShadows, uGlobalHighlights);color = adjustTempTintContrast(color, uGlobalTemperature, uGlobalTint, uGlobalContrast);color = adjustExposure(color, uGlobalExposure + originalRangeFactor);color = adjustColor(color, clamp(uGlobalColor, -1.0, 1.0));color = colorFromLinear(color);return color;}const int SHAPE_TYPE_ELLIPSE = 0;const int SHAPE_TYPE_ROUNDED_RECT = 1;uniform int uShapeType;uniform vec2 uEllipseCenter;uniform vec2 uEllipseRadii;uniform vec4 uRect;uniform vec4 uCornerRadii;float ellipseImplicitEquation(in vec2 nodeSpacePoint, in vec2 ellipseCenter, in vec2 ellipseRadii) {nodeSpacePoint -= ellipseCenter;return ((nodeSpacePoint.x * nodeSpacePoint.x) / (ellipseRadii.x * ellipseRadii.x) +(nodeSpacePoint.y * nodeSpacePoint.y) / (ellipseRadii.y * ellipseRadii.y) -1.);}float roundedRectImplicitEquation(in vec2 nodeSpacePoint, in vec4 bounds, vec4 cornerRadii) {vec2 quadrantSize = (bounds.zw - bounds.xy) / 2.;vec2 ptRelativeToBoxCenter = nodeSpacePoint - quadrantSize;vec2 radiiInBoxHalf = ptRelativeToBoxCenter.x > 0. ? cornerRadii.zy : cornerRadii.wx;float radiusInBoxQuadrant = ptRelativeToBoxCenter.y > 0. ? radiiInBoxHalf.x : radiiInBoxHalf.y;vec2 q = abs(ptRelativeToBoxCenter) - quadrantSize + radiusInBoxQuadrant;return min(max(q.x, q.y), 0.0) + length(max(q, 0.0)) - radiusInBoxQuadrant;}float shapeImplicitEquation(in vec2 nodeSpacePoint) {if (uShapeType == SHAPE_TYPE_ELLIPSE) {return ellipseImplicitEquation(nodeSpacePoint, uEllipseCenter, uEllipseRadii);} else if (uShapeType == SHAPE_TYPE_ROUNDED_RECT) {return roundedRectImplicitEquation(nodeSpacePoint, uRect, uCornerRadii);}return 0.;}float pixelShapeCoverage(vec2 nodeSpacePoint) {float eqValue = shapeImplicitEquation(nodeSpacePoint);float gradientLengthApprox = fwidth(eqValue);gradientLengthApprox = max(gradientLengthApprox, 0.00001);float distance = eqValue / gradientLengthApprox;return 1.0 - smoothstep(-0.5, 0.5, distance);}uniform float uOpacity;varying vec2 vNodeSpacePoint;void main() {vec4 color = sampleImagePaintAWithMSAA();color.rgb = pipeline(color.rgb) * color.a;gl_FragColor = color * uOpacity * pixelShapeCoverage(vNodeSpacePoint);}`,this.GLSLX_NAME_U_PROGRESS="uProgress",this.GLSLX_NAME_U_TEXTURE1="uTexture1",this.GLSLX_SOURCE_AAA_SHAPE_LERP_GRADIENT_FRAGMENT=`#extension GL_OES_standard_derivatives:enable
precision highp float;const int SHAPE_TYPE_ELLIPSE = 0;const int SHAPE_TYPE_ROUNDED_RECT = 1;uniform int uShapeType;uniform vec2 uEllipseCenter;uniform vec2 uEllipseRadii;uniform vec4 uRect;uniform vec4 uCornerRadii;float ellipseImplicitEquation(in vec2 nodeSpacePoint, in vec2 ellipseCenter, in vec2 ellipseRadii) {nodeSpacePoint -= ellipseCenter;return ((nodeSpacePoint.x * nodeSpacePoint.x) / (ellipseRadii.x * ellipseRadii.x) +(nodeSpacePoint.y * nodeSpacePoint.y) / (ellipseRadii.y * ellipseRadii.y) -1.);}float roundedRectImplicitEquation(in vec2 nodeSpacePoint, in vec4 bounds, vec4 cornerRadii) {vec2 quadrantSize = (bounds.zw - bounds.xy) / 2.;vec2 ptRelativeToBoxCenter = nodeSpacePoint - quadrantSize;vec2 radiiInBoxHalf = ptRelativeToBoxCenter.x > 0. ? cornerRadii.zy : cornerRadii.wx;float radiusInBoxQuadrant = ptRelativeToBoxCenter.y > 0. ? radiiInBoxHalf.x : radiiInBoxHalf.y;vec2 q = abs(ptRelativeToBoxCenter) - quadrantSize + radiusInBoxQuadrant;return min(max(q.x, q.y), 0.0) + length(max(q, 0.0)) - radiusInBoxQuadrant;}float shapeImplicitEquation(in vec2 nodeSpacePoint) {if (uShapeType == SHAPE_TYPE_ELLIPSE) {return ellipseImplicitEquation(nodeSpacePoint, uEllipseCenter, uEllipseRadii);} else if (uShapeType == SHAPE_TYPE_ROUNDED_RECT) {return roundedRectImplicitEquation(nodeSpacePoint, uRect, uCornerRadii);}return 0.;}float pixelShapeCoverage(vec2 nodeSpacePoint) {float eqValue = shapeImplicitEquation(nodeSpacePoint);float gradientLengthApprox = fwidth(eqValue);gradientLengthApprox = max(gradientLengthApprox, 0.00001);float distance = eqValue / gradientLengthApprox;return 1.0 - smoothstep(-0.5, 0.5, distance);}uniform int uType;const float PI = 3.141592;vec2 _gradientCoord(in vec2 paintUV) {const int LINEAR = 1;const int RADIAL = 2;const int ANGULAR = 3;const int DIAMOND = 4;vec2 uv = paintUV - 0.5;float t =uType == LINEAR ? uv.x + 0.5 :uType == RADIAL ? 2.0 * length(uv) :uType == ANGULAR ? fract(atan(uv.y, uv.x) / (2.0 * PI)) :uType == DIAMOND ? 2.0 * max(abs(uv.x + uv.y), abs(uv.y - uv.x)) :0.0;return vec2(t, 0.25 + (0.75 - 0.25) / 256.0);}const float DITHER_FACTOR = 0.003922;const float DITHER_RANGE = 2.0 * DITHER_FACTOR;float random() {vec2 coordCopy = gl_FragCoord.xy;return fract(sin(dot(vec2(12.9898, 78.233), coordCopy)) * 43758.5453);}vec4 ditherColor(vec4 color) {float offset = (random() - 0.5) * DITHER_RANGE; return color.a > 0.0 ? min(abs(color + offset), 1.0) : color;}uniform float uOpacity;uniform float uProgress;uniform sampler2D uTexture0;uniform sampler2D uTexture1;varying vec2 vNodeSpacePoint;varying vec2 vGradientSampleUV;void main() {float coverageAlpha = pixelShapeCoverage(vNodeSpacePoint);vec2 coord = _gradientCoord(vGradientSampleUV);vec4 lerped = mix(texture2D(uTexture0, coord), texture2D(uTexture1, coord), uProgress);gl_FragColor = ditherColor(lerped * uOpacity) * coverageAlpha;}`,this.GLSLX_SOURCE_AAA_SHAPE_LERP_IMAGE_FRAGMENT=`#extension GL_OES_standard_derivatives:enable
precision highp float;uniform bool uEmulateWrapAddress;uniform bool uEmulateBorderAddress;vec4 sampleImage(sampler2D texture, vec2 coord) {if (uEmulateWrapAddress) {coord = fract(coord);}vec4 color = texture2D(texture, coord);if (uEmulateBorderAddress && coord != clamp(coord, 0.0, 1.0)) color.a = 0.0;return color;}const vec2 AA_JITTER_PATTERN_1 = vec2(-3, -5);const vec2 AA_JITTER_PATTERN_2 = vec2(5, 1);const vec2 AA_JITTER_PATTERN_3 = vec2(-1, 3);const vec2 AA_JITTER_PATTERN_4 = vec2(7, -7);const vec2 AA_JITTER_PATTERN_5 = vec2(1, -3);const vec2 AA_JITTER_PATTERN_6 = vec2(-5, 5);const vec2 AA_JITTER_PATTERN_7 = vec2(3, 7);const vec2 AA_JITTER_PATTERN_8 = vec2(-7, -1);uniform sampler2D uTexture0;varying vec2 vPaintASample;varying vec2 vStepA;vec4 sampleImagePaintAWithMSAA() {return (sampleImage(uTexture0, vPaintASample + AA_JITTER_PATTERN_1 * vStepA) +sampleImage(uTexture0, vPaintASample + AA_JITTER_PATTERN_2 * vStepA) +sampleImage(uTexture0, vPaintASample + AA_JITTER_PATTERN_3 * vStepA) +sampleImage(uTexture0, vPaintASample + AA_JITTER_PATTERN_4 * vStepA) +sampleImage(uTexture0, vPaintASample + AA_JITTER_PATTERN_5 * vStepA) +sampleImage(uTexture0, vPaintASample + AA_JITTER_PATTERN_6 * vStepA) +sampleImage(uTexture0, vPaintASample + AA_JITTER_PATTERN_7 * vStepA) +sampleImage(uTexture0, vPaintASample + AA_JITTER_PATTERN_8 * vStepA)) / 8.;}uniform sampler2D uTexture1;varying vec2 vPaintBSample;varying vec2 vStepB;vec4 sampleImagePaintBWithMSAA() {return (sampleImage(uTexture1, vPaintBSample + AA_JITTER_PATTERN_1 * vStepB) +sampleImage(uTexture1, vPaintBSample + AA_JITTER_PATTERN_2 * vStepB) +sampleImage(uTexture1, vPaintBSample + AA_JITTER_PATTERN_3 * vStepB) +sampleImage(uTexture1, vPaintBSample + AA_JITTER_PATTERN_4 * vStepB) +sampleImage(uTexture1, vPaintBSample + AA_JITTER_PATTERN_5 * vStepB) +sampleImage(uTexture1, vPaintBSample + AA_JITTER_PATTERN_6 * vStepB) +sampleImage(uTexture1, vPaintBSample + AA_JITTER_PATTERN_7 * vStepB) +sampleImage(uTexture1, vPaintBSample + AA_JITTER_PATTERN_8 * vStepB)) / 8.;}const int SHAPE_TYPE_ELLIPSE = 0;const int SHAPE_TYPE_ROUNDED_RECT = 1;uniform int uShapeType;uniform vec2 uEllipseCenter;uniform vec2 uEllipseRadii;uniform vec4 uRect;uniform vec4 uCornerRadii;float ellipseImplicitEquation(in vec2 nodeSpacePoint, in vec2 ellipseCenter, in vec2 ellipseRadii) {nodeSpacePoint -= ellipseCenter;return ((nodeSpacePoint.x * nodeSpacePoint.x) / (ellipseRadii.x * ellipseRadii.x) +(nodeSpacePoint.y * nodeSpacePoint.y) / (ellipseRadii.y * ellipseRadii.y) -1.);}float roundedRectImplicitEquation(in vec2 nodeSpacePoint, in vec4 bounds, vec4 cornerRadii) {vec2 quadrantSize = (bounds.zw - bounds.xy) / 2.;vec2 ptRelativeToBoxCenter = nodeSpacePoint - quadrantSize;vec2 radiiInBoxHalf = ptRelativeToBoxCenter.x > 0. ? cornerRadii.zy : cornerRadii.wx;float radiusInBoxQuadrant = ptRelativeToBoxCenter.y > 0. ? radiiInBoxHalf.x : radiiInBoxHalf.y;vec2 q = abs(ptRelativeToBoxCenter) - quadrantSize + radiusInBoxQuadrant;return min(max(q.x, q.y), 0.0) + length(max(q, 0.0)) - radiusInBoxQuadrant;}float shapeImplicitEquation(in vec2 nodeSpacePoint) {if (uShapeType == SHAPE_TYPE_ELLIPSE) {return ellipseImplicitEquation(nodeSpacePoint, uEllipseCenter, uEllipseRadii);} else if (uShapeType == SHAPE_TYPE_ROUNDED_RECT) {return roundedRectImplicitEquation(nodeSpacePoint, uRect, uCornerRadii);}return 0.;}float pixelShapeCoverage(vec2 nodeSpacePoint) {float eqValue = shapeImplicitEquation(nodeSpacePoint);float gradientLengthApprox = fwidth(eqValue);gradientLengthApprox = max(gradientLengthApprox, 0.00001);float distance = eqValue / gradientLengthApprox;return 1.0 - smoothstep(-0.5, 0.5, distance);}uniform float uOpacity;uniform float uProgress;varying vec2 vNodeSpacePoint;void main() {vec4 imageA = sampleImagePaintAWithMSAA();vec4 imageB = sampleImagePaintBWithMSAA();vec4 lerped = mix(imageA, imageB, uProgress);lerped.rgb *= lerped.a;gl_FragColor = lerped * uOpacity * pixelShapeCoverage(vNodeSpacePoint);}`,this.GLSLX_SOURCE_AAA_SHAPE_LERP_IMAGE_COLOR_ADJUST_FRAGMENT=`#extension GL_OES_standard_derivatives:enable
precision highp float;uniform bool uEmulateWrapAddress;uniform bool uEmulateBorderAddress;vec4 sampleImage(sampler2D texture, vec2 coord) {if (uEmulateWrapAddress) {coord = fract(coord);}vec4 color = texture2D(texture, coord);if (uEmulateBorderAddress && coord != clamp(coord, 0.0, 1.0)) color.a = 0.0;return color;}const vec2 AA_JITTER_PATTERN_1 = vec2(-3, -5);const vec2 AA_JITTER_PATTERN_2 = vec2(5, 1);const vec2 AA_JITTER_PATTERN_3 = vec2(-1, 3);const vec2 AA_JITTER_PATTERN_4 = vec2(7, -7);const vec2 AA_JITTER_PATTERN_5 = vec2(1, -3);const vec2 AA_JITTER_PATTERN_6 = vec2(-5, 5);const vec2 AA_JITTER_PATTERN_7 = vec2(3, 7);const vec2 AA_JITTER_PATTERN_8 = vec2(-7, -1);uniform sampler2D uTexture0;varying vec2 vPaintASample;varying vec2 vStepA;vec4 sampleImagePaintAWithMSAA() {return (sampleImage(uTexture0, vPaintASample + AA_JITTER_PATTERN_1 * vStepA) +sampleImage(uTexture0, vPaintASample + AA_JITTER_PATTERN_2 * vStepA) +sampleImage(uTexture0, vPaintASample + AA_JITTER_PATTERN_3 * vStepA) +sampleImage(uTexture0, vPaintASample + AA_JITTER_PATTERN_4 * vStepA) +sampleImage(uTexture0, vPaintASample + AA_JITTER_PATTERN_5 * vStepA) +sampleImage(uTexture0, vPaintASample + AA_JITTER_PATTERN_6 * vStepA) +sampleImage(uTexture0, vPaintASample + AA_JITTER_PATTERN_7 * vStepA) +sampleImage(uTexture0, vPaintASample + AA_JITTER_PATTERN_8 * vStepA)) / 8.;}uniform sampler2D uTexture1;varying vec2 vPaintBSample;varying vec2 vStepB;vec4 sampleImagePaintBWithMSAA() {return (sampleImage(uTexture1, vPaintBSample + AA_JITTER_PATTERN_1 * vStepB) +sampleImage(uTexture1, vPaintBSample + AA_JITTER_PATTERN_2 * vStepB) +sampleImage(uTexture1, vPaintBSample + AA_JITTER_PATTERN_3 * vStepB) +sampleImage(uTexture1, vPaintBSample + AA_JITTER_PATTERN_4 * vStepB) +sampleImage(uTexture1, vPaintBSample + AA_JITTER_PATTERN_5 * vStepB) +sampleImage(uTexture1, vPaintBSample + AA_JITTER_PATTERN_6 * vStepB) +sampleImage(uTexture1, vPaintBSample + AA_JITTER_PATTERN_7 * vStepB) +sampleImage(uTexture1, vPaintBSample + AA_JITTER_PATTERN_8 * vStepB)) / 8.;}const vec3 RGB2Y = vec3(0.2126, 0.7152, 0.0722);const float IMAGE_HIGHLIGHT_SHADOW_THRESHOLD = 0.5;uniform float uGlobalTint;uniform float uGlobalColor;uniform float uGlobalShadows;uniform float uGlobalHighlights;uniform float uGlobalExposure;uniform float uGlobalTemperature;uniform float uGlobalContrast;vec3 colorToLinear(vec3 color) {color = pow(color, vec3(2.2));return color;}vec3 colorFromLinear(vec3 color) {color = pow(color, vec3(1.0 / 2.2));return color;}float rangeFactor(vec3 color, float shadows, float highlights) {float lThreshold = dot(color, RGB2Y) - pow(IMAGE_HIGHLIGHT_SHADOW_THRESHOLD, 2.2);return 0.75 * lThreshold / sqrt(1.0 + 4.0 * lThreshold * lThreshold) * (lThreshold > 0.0 ? highlights : -shadows * 0.999);}vec3 adjustExposure(vec3 color, float exposureAdjust) {float lFactor = pow(10.0, 2.0 * exposureAdjust) - 1.0;const float lSqueeze = 0.75;float lUnsqueeze = 1.0 / (1.0 - lSqueeze) - 1.0;float gray = dot(color, RGB2Y);lUnsqueeze *= 1.0 + gray * gray * min(0.0, exposureAdjust) / (0.2 - min(0.0, exposureAdjust));color += (gray - color) * lSqueeze;if (exposureAdjust < 0.0) {color *= 1.0 + exposureAdjust / 16.0;gray *= 1.0 + exposureAdjust / 16.0;}color *= (lFactor + 1.0) / (color * lFactor + 1.0);gray *= (lFactor + 1.0) / (gray * lFactor + 1.0);color += (color - gray) * lUnsqueeze;color = clamp(color, 0.0, 1.0);return color;}vec3 adjustColor(vec3 color, float colorAdjust) {float gray = dot(color, RGB2Y);if (colorAdjust <= 0.0) {color -= (gray - color) * colorAdjust;} else {float lNeg = gray / (gray - min(min(color.r, color.g), color.b) + 1e-6);float lPos = (1.0 - gray) / (max(max(color.r, color.g), color.b) - gray + 1e-6);float lFactor = mix(1.0, min(lNeg, lPos), colorAdjust);lFactor = min(lFactor, 2.0); color += (gray - color) * (1.0 - lFactor);}return color;}float smootherstep(float edge0, float edge1, float x) {x = clamp((x - edge0) / (edge1 - edge0), 0.0, 1.0);return x * x * x * (x * (x * 6.0 - 15.0) + 10.0);}vec3 adjustTempTintContrast(vec3 color, float temp, float tint, float contrast) {vec3 lXYZ = mat3(0.4124564, 0.2126729, 0.0193339,0.3575761, 0.7151522, 0.1191920,0.1804375, 0.0721750, 0.9503041) * color;lXYZ.x /= 0.95047;lXYZ.z /= 1.08883;lXYZ = pow(lXYZ, vec3(1.0 / 3.0));vec3 lLAB = vec3(116.0 * lXYZ.y - 16.0,500.0 * (lXYZ.x - lXYZ.y),200.0 * (lXYZ.y - lXYZ.z));lLAB.y += 30.0 * tint;lLAB.z += 30.0 * temp;float scaledThreshold = IMAGE_HIGHLIGHT_SHADOW_THRESHOLD * 100.0;float thresholdDelta = 30.0;float contrastLeftCurve = contrast < 0.0? (lLAB.x - scaledThreshold) * 0.2 + 50.0: lLAB.x;float contrastRightCurve = contrast < 0.0? lLAB.x: smootherstep(scaledThreshold - thresholdDelta,scaledThreshold + thresholdDelta, lLAB.x) * 100.0;float interp = contrast < 0.0 ? contrast + 1.0 : contrast;lLAB.x = mix(contrastLeftCurve, contrastRightCurve, interp);lXYZ.y = (lLAB.x + 16.0) / 116.0;lXYZ.x = lLAB.y / 500.0 + lXYZ.y;lXYZ.z = lXYZ.y - lLAB.z / 200.0;lXYZ *= lXYZ * lXYZ;lXYZ.x *= 0.95047;lXYZ.z *= 1.08883;color = mat3(3.2404542, -0.9692660, 0.0556434,-1.5371385, 1.8760108, -0.2040259,-0.4985314, 0.0415560, 1.0572252) * lXYZ;color = clamp(color, 0.0, 1.0);return color;}vec3 pipeline(vec3 color) {color = colorToLinear(color);float originalRangeFactor = rangeFactor(color, uGlobalShadows, uGlobalHighlights);color = adjustTempTintContrast(color, uGlobalTemperature, uGlobalTint, uGlobalContrast);color = adjustExposure(color, uGlobalExposure + originalRangeFactor);color = adjustColor(color, clamp(uGlobalColor, -1.0, 1.0));color = colorFromLinear(color);return color;}const int SHAPE_TYPE_ELLIPSE = 0;const int SHAPE_TYPE_ROUNDED_RECT = 1;uniform int uShapeType;uniform vec2 uEllipseCenter;uniform vec2 uEllipseRadii;uniform vec4 uRect;uniform vec4 uCornerRadii;float ellipseImplicitEquation(in vec2 nodeSpacePoint, in vec2 ellipseCenter, in vec2 ellipseRadii) {nodeSpacePoint -= ellipseCenter;return ((nodeSpacePoint.x * nodeSpacePoint.x) / (ellipseRadii.x * ellipseRadii.x) +(nodeSpacePoint.y * nodeSpacePoint.y) / (ellipseRadii.y * ellipseRadii.y) -1.);}float roundedRectImplicitEquation(in vec2 nodeSpacePoint, in vec4 bounds, vec4 cornerRadii) {vec2 quadrantSize = (bounds.zw - bounds.xy) / 2.;vec2 ptRelativeToBoxCenter = nodeSpacePoint - quadrantSize;vec2 radiiInBoxHalf = ptRelativeToBoxCenter.x > 0. ? cornerRadii.zy : cornerRadii.wx;float radiusInBoxQuadrant = ptRelativeToBoxCenter.y > 0. ? radiiInBoxHalf.x : radiiInBoxHalf.y;vec2 q = abs(ptRelativeToBoxCenter) - quadrantSize + radiusInBoxQuadrant;return min(max(q.x, q.y), 0.0) + length(max(q, 0.0)) - radiusInBoxQuadrant;}float shapeImplicitEquation(in vec2 nodeSpacePoint) {if (uShapeType == SHAPE_TYPE_ELLIPSE) {return ellipseImplicitEquation(nodeSpacePoint, uEllipseCenter, uEllipseRadii);} else if (uShapeType == SHAPE_TYPE_ROUNDED_RECT) {return roundedRectImplicitEquation(nodeSpacePoint, uRect, uCornerRadii);}return 0.;}float pixelShapeCoverage(vec2 nodeSpacePoint) {float eqValue = shapeImplicitEquation(nodeSpacePoint);float gradientLengthApprox = fwidth(eqValue);gradientLengthApprox = max(gradientLengthApprox, 0.00001);float distance = eqValue / gradientLengthApprox;return 1.0 - smoothstep(-0.5, 0.5, distance);}uniform float uOpacity;uniform float uProgress;varying vec2 vNodeSpacePoint;void main() {vec4 imageA = sampleImagePaintAWithMSAA();vec4 imageB = sampleImagePaintBWithMSAA();vec4 lerped = mix(imageA, imageB, uProgress);lerped.rgb = pipeline(lerped.rgb) * lerped.a;gl_FragColor = lerped * uOpacity * pixelShapeCoverage(vNodeSpacePoint);}`,this.GLSLX_NAME_U_UV_SCALE="uUvScale",this.GLSLX_NAME_U_PATH_SIZE="uPathSize",this.GLSLX_NAME_U_PIXEL_RATIO="uPixelRatio",this.GLSLX_NAME_U_PAINT_TRANSFORM0="uPaintTransform0",this.GLSLX_NAME_U_VERTEX_TRANSFORM="uVertexTransform",this.GLSLX_NAME_A_POSITION2="aPosition2",this.GLSLX_SOURCE_AAA_SHAPE_NON_SOLID_COLOR_PAINT_VERTEX="precision highp float;uniform vec2 uUvScale;vec2 uvExcludingBorderScreenspacePixel(in vec2 uv) {return (uv - vec2(.5, .5)) * uUvScale + vec2(.5, .5);}const vec2 AA_JITTER_STEP = vec2(1. / 16., 1. / 16.);uniform vec2 uPathSize;uniform float uPixelRatio;uniform mat3 uPaintTransform0;varying vec2 vPaintASample;varying vec2 vStepA;void setMSAAVaryingsForImagePaintA(vec2 shapeUv) {vec2 uvPixelSize = 1.0 / uPathSize / uPixelRatio;vPaintASample = (uPaintTransform0 * vec3(shapeUv, 1)).xy;vStepA = (uPaintTransform0 * vec3(shapeUv + AA_JITTER_STEP * uvPixelSize, 1)).xy - vPaintASample;}uniform mat3 uVertexTransform;attribute vec2 aPosition2;varying vec2 vNodeSpacePoint;varying vec2 vGradientSampleUV;void main() {vec2 shapeUv = uvExcludingBorderScreenspacePixel(aPosition2);vNodeSpacePoint = shapeUv * uPathSize;vGradientSampleUV = (uPaintTransform0 * vec3(shapeUv, 1)).xy;setMSAAVaryingsForImagePaintA(shapeUv);gl_Position = vec4(uVertexTransform * vec3(aPosition2, 1), 0).xywz;}",this.GLSLX_NAME_U_COLOR="uColor",this.GLSLX_SOURCE_AAA_SHAPE_SOLID_COLOR_PAINT_FRAGMENT=`#extension GL_OES_standard_derivatives:enable
precision highp float;const int SHAPE_TYPE_ELLIPSE = 0;const int SHAPE_TYPE_ROUNDED_RECT = 1;uniform int uShapeType;uniform vec2 uEllipseCenter;uniform vec2 uEllipseRadii;uniform vec4 uRect;uniform vec4 uCornerRadii;float ellipseImplicitEquation(in vec2 nodeSpacePoint, in vec2 ellipseCenter, in vec2 ellipseRadii) {nodeSpacePoint -= ellipseCenter;return ((nodeSpacePoint.x * nodeSpacePoint.x) / (ellipseRadii.x * ellipseRadii.x) +(nodeSpacePoint.y * nodeSpacePoint.y) / (ellipseRadii.y * ellipseRadii.y) -1.);}float roundedRectImplicitEquation(in vec2 nodeSpacePoint, in vec4 bounds, vec4 cornerRadii) {vec2 quadrantSize = (bounds.zw - bounds.xy) / 2.;vec2 ptRelativeToBoxCenter = nodeSpacePoint - quadrantSize;vec2 radiiInBoxHalf = ptRelativeToBoxCenter.x > 0. ? cornerRadii.zy : cornerRadii.wx;float radiusInBoxQuadrant = ptRelativeToBoxCenter.y > 0. ? radiiInBoxHalf.x : radiiInBoxHalf.y;vec2 q = abs(ptRelativeToBoxCenter) - quadrantSize + radiusInBoxQuadrant;return min(max(q.x, q.y), 0.0) + length(max(q, 0.0)) - radiusInBoxQuadrant;}float shapeImplicitEquation(in vec2 nodeSpacePoint) {if (uShapeType == SHAPE_TYPE_ELLIPSE) {return ellipseImplicitEquation(nodeSpacePoint, uEllipseCenter, uEllipseRadii);} else if (uShapeType == SHAPE_TYPE_ROUNDED_RECT) {return roundedRectImplicitEquation(nodeSpacePoint, uRect, uCornerRadii);}return 0.;}float pixelShapeCoverage(vec2 nodeSpacePoint) {float eqValue = shapeImplicitEquation(nodeSpacePoint);float gradientLengthApprox = fwidth(eqValue);gradientLengthApprox = max(gradientLengthApprox, 0.00001);float distance = eqValue / gradientLengthApprox;return 1.0 - smoothstep(-0.5, 0.5, distance);}uniform float uOpacity;uniform vec4 uColor;varying vec2 vNodeSpacePoint;void main() {float coverageAlpha = pixelShapeCoverage(vNodeSpacePoint);gl_FragColor = uColor * uOpacity * coverageAlpha;}`,this.GLSLX_SOURCE_AAA_SHAPE_SOLID_COLOR_PAINT_VERTEX="precision highp float;uniform vec2 uUvScale;vec2 uvExcludingBorderScreenspacePixel(in vec2 uv) {return (uv - vec2(.5, .5)) * uUvScale + vec2(.5, .5);}uniform vec2 uPathSize;uniform mat3 uVertexTransform;attribute vec2 aPosition2;varying vec2 vNodeSpacePoint;void main() {vec2 shapeUv = uvExcludingBorderScreenspacePixel(aPosition2);vNodeSpacePoint = shapeUv * uPathSize;gl_Position = vec4(uVertexTransform * vec3(aPosition2, 1.0), 0.0).xywz;}",this.GLSLX_NAME_U_PAINT_TRANSFORM1="uPaintTransform1",this.GLSLX_SOURCE_AAA_SHAPE_TWO_NON_SOLID_COLOR_PAINT_VERTEX="precision highp float;const vec2 AA_JITTER_STEP = vec2(1. / 16., 1. / 16.);uniform vec2 uUvScale;vec2 uvExcludingBorderScreenspacePixel(in vec2 uv) {return (uv - vec2(.5, .5)) * uUvScale + vec2(.5, .5);}uniform vec2 uPathSize;uniform float uPixelRatio;uniform mat3 uPaintTransform0;varying vec2 vPaintASample;varying vec2 vStepA;void setMSAAVaryingsForImagePaintA(vec2 shapeUv) {vec2 uvPixelSize = 1.0 / uPathSize / uPixelRatio;vPaintASample = (uPaintTransform0 * vec3(shapeUv, 1)).xy;vStepA = (uPaintTransform0 * vec3(shapeUv + AA_JITTER_STEP * uvPixelSize, 1)).xy - vPaintASample;}uniform mat3 uVertexTransform;uniform mat3 uPaintTransform1;attribute vec2 aPosition2;varying vec2 vPaintBSample;varying vec2 vStepB;varying vec2 vNodeSpacePoint;varying vec2 vGradientSampleUV;void setMSAAVaryingsForImagePaintB(vec2 shapeUv) {vec2 uvPixelSize = 1.0 / uPathSize / uPixelRatio;vPaintBSample = (uPaintTransform1 * vec3(shapeUv, 1)).xy;vStepB = (uPaintTransform1 * vec3(shapeUv + AA_JITTER_STEP * uvPixelSize, 1)).xy - vPaintBSample;}void main() {vec2 shapeUv = uvExcludingBorderScreenspacePixel(aPosition2);vNodeSpacePoint = shapeUv * uPathSize;vGradientSampleUV = (uPaintTransform0 * vec3(shapeUv, 1)).xy;setMSAAVaryingsForImagePaintA(shapeUv);setMSAAVaryingsForImagePaintB(shapeUv);gl_Position = vec4(uVertexTransform * vec3(aPosition2, 1), 0).xywz;}",this.GLSLX_SOURCE_BLEND_MODE_FRAGMENT="precision highp float;const float DITHER_FACTOR = 0.003922;uniform float uOpacity;uniform int uType;uniform sampler2D uTexture0;uniform sampler2D uTexture1;varying vec2 vCoord2;float minv3(vec3 c) {return min(min(c.r, c.g), c.b);}float maxv3(vec3 c) {return max(max(c.r, c.g), c.b);}float satv3(vec3 c) {return maxv3(c) - minv3(c);}float lumv3(vec3 c) {return dot(c, vec3(0.30, 0.59, 0.11)); }vec3 setLum(vec3 cbase, vec3 clum) {float llum = lumv3(clum);vec3 color = cbase + (llum - lumv3(cbase));float minc = minv3(color);float maxc = maxv3(color);if (minc < 0.0) {color = mix(vec3(llum), color, llum / (llum - minc));} else if (maxc > 1.0) {color = mix(vec3(llum), color, (1.0 - llum) / (maxc - llum));}return color;}vec3 setLumSat(vec3 cbase, vec3 csat, vec3 clum) {float sbase = satv3(cbase);vec3 color = vec3(0.0);if (sbase > 0.0) {float minbase = minv3(cbase);float ssat = satv3(csat);color = (cbase - minbase) * ssat / sbase;}return setLum(color, clum);}void main() {const int DARKEN       = 2;const int MULTIPLY     = 3;const int LINEAR_BURN  = 4;const int COLOR_BURN   = 5;const int LIGHTEN      = 6;const int SCREEN       = 7;const int LINEAR_DODGE = 8;const int COLOR_DODGE  = 9;const int OVERLAY = 10;const int SOFT_LIGHT = 11;const int HARD_LIGHT = 12;const int DIFFERENCE = 13;const int EXCLUSION = 14;const int HUE = 15;const int SATURATION = 16;const int COLOR = 17;const int LUMINOSITY = 18;vec4 source = texture2D(uTexture0, vCoord2) * uOpacity;vec4 target = texture2D(uTexture1, vCoord2);float Sa = source.a;float Da = target.a;vec3 Dca = target.rgb;if (Sa == 0.0) {gl_FragColor = vec4(Dca, Da);}else {float epsilon = 0.000001;vec3 Sca = source.rgb;vec3 color = Sca * (1.0 - Da) + Dca * (1.0 - Sa);if (uType == DARKEN) {color += min(Sca * Da, Dca * Sa);}else if (uType == MULTIPLY) {color += Sca * Dca;}else if (uType == LINEAR_BURN) {color = max(vec3(0.0), Sca + Dca - Sa * Da);}else if (uType == COLOR_BURN) {vec3 denominator = max(Sca * Da, DITHER_FACTOR);vec3 numerator = (Da - Dca) * Sa * step(DITHER_FACTOR, Da - Dca);color += Sa * Da * (1.0 - min(vec3(1.0), numerator / denominator));}else if (uType == LIGHTEN) {color += max(Sca * Da, Dca * Sa);}else if (uType == SCREEN) {color = Sca + Dca - Sca * Dca;}else if (uType == LINEAR_DODGE) {color = min(vec3(1.0), Sca + Dca);}else if (uType == COLOR_DODGE) {vec3 denominator = max(Da * (Sa - Sca), DITHER_FACTOR);vec3 numerator = Dca * Sa * step(DITHER_FACTOR, Dca);color += Sa * Da * min(vec3(1.0), numerator / denominator);}else if (uType == OVERLAY) {color += mix(Sa * Da - 2.0 * (Da - Dca) * (Sa - Sca),2.0 * Sca * Dca,vec3(lessThanEqual(2.0 * Dca, vec3(Da))));}else if (uType == HARD_LIGHT) {color += mix(2.0 * Sca * Dca,Sa * Da - 2.0 * (Da - Dca) * (Sa - Sca),vec3(greaterThan(2.0 * Sca, vec3(Sa))));}else if (uType == DIFFERENCE) {color += abs(Dca * Sa - Sca * Da);}else if (uType == EXCLUSION) {color += Sca * Da + Dca * Sa - 2.0 * Sca * Dca;}else {vec3 delta = vec3(0.0);vec3 Sc = Sca;vec3 Dc = Dca;if (Sa > 0.0) Sc /= Sa;if (Da > 0.0) Dc /= Da;if (uType == SOFT_LIGHT) {vec3 c0 = 1.0 - Dc;vec3 c1 = (16.0 * Dc - 12.0) * Dc + 3.0;vec3 c2 = inversesqrt(Dc + epsilon) - 1.0;vec3 c = mix(c1, c2, vec3(greaterThan(Dc, vec3(0.25))));c = mix(c, c0, vec3(greaterThan(Sc, vec3(0.50))));delta = Dc * (1.0 + c * (2.0 * Sc - 1.0));}else if (uType == HUE) {delta = setLumSat(Sc, Dc, Dc);}else if (uType == SATURATION) {delta = setLumSat(Dc, Sc, Dc);}else if (uType == COLOR) {delta = setLum(Sc, Dc);}else if (uType == LUMINOSITY) {delta = setLum(Dc, Sc);}color += Sa * Da * delta;}gl_FragColor = vec4(color, Sa + Da - Sa * Da);}}",this.GLSLX_SOURCE_BLEND_TEXTURE_FRAGMENT="precision highp float;uniform float uOpacity;uniform sampler2D uTexture0;varying vec2 vCoord2;void main() {gl_FragColor = texture2D(uTexture0, vCoord2) * uOpacity;}",this.GLSLX_NAME_U_COUNT="uCount",this.GLSLX_NAME_U_BLUR_DELTA="uBlurDelta",this.GLSLX_NAME_U_BLUR_CLAMP="uBlurClamp",this.GLSLX_SOURCE_CLAMPED_BLUR_TILE_FRAGMENT="precision highp float;uniform float uCount;uniform vec2 uBlurDelta;uniform vec4 uBlurClamp;uniform sampler2D uTexture0;varying vec2 vCoord2;void main() {vec2 coord2 = clamp(vCoord2, uBlurClamp.xy, uBlurClamp.zw);float weight = uCount;vec4 result = texture2D(uTexture0, coord2) * weight;float total = weight;for (int i = 1; i < 32; i += 2) {if (float(i) > uCount) {break;}float t0 = float(i);float t1 = min(t0 + 1.0, uCount);vec2 coord0_neg = coord2 - uBlurDelta * t0;vec2 coord0_pos = coord2 + uBlurDelta * t0;vec2 coord1_neg = coord2 - uBlurDelta * t1;vec2 coord1_pos = coord2 + uBlurDelta * t1;float weight0_neg = (uCount - t0) * float(coord0_neg == clamp(coord0_neg, uBlurClamp.xy, uBlurClamp.zw));float weight0_pos = (uCount - t0) * float(coord0_pos == clamp(coord0_pos, uBlurClamp.xy, uBlurClamp.zw));float weight1_neg = (uCount - t1) * float(coord1_neg == clamp(coord1_neg, uBlurClamp.xy, uBlurClamp.zw));float weight1_pos = (uCount - t1) * float(coord1_pos == clamp(coord1_pos, uBlurClamp.xy, uBlurClamp.zw));float weight_neg = weight0_neg + weight1_neg;float weight_pos = weight0_pos + weight1_pos;vec2 coord_neg = (coord0_neg * weight0_neg + coord1_neg * weight1_neg) / weight_neg;vec2 coord_pos = (coord0_pos * weight0_pos + coord1_pos * weight1_pos) / weight_pos;result +=texture2D(uTexture0, coord_neg) * weight_neg +texture2D(uTexture0, coord_pos) * weight_pos;total += weight_neg + weight_pos;}gl_FragColor = result / total;}",this.GLSLX_SOURCE_CLIP_SPACE_QUAD_VERTEX="precision highp float;attribute vec2 aPosition2;varying vec2 vCoord2;void main() {vCoord2 = aPosition2;gl_Position = vec4(aPosition2 * 2.0 - 1.0, 0.0, 1.0);}",this.GLSLX_NAME_U_QUAD="uQuad",this.GLSLX_SOURCE_COPY_TILE_VERTEX="precision highp float;uniform vec4 uQuad;attribute vec2 aPosition2;void main() {gl_Position = vec4(mix(uQuad.xy, uQuad.zw, aPosition2), 0, 1);}",this.GLSLX_SOURCE_DOWNSAMPLE_TILE_FRAGMENT="precision highp float;uniform sampler2D uTexture0;varying vec2 vCoord2;void main() {gl_FragColor = texture2D(uTexture0, vCoord2);}",this.GLSLX_NAME_U_SOURCE="uSource",this.GLSLX_SOURCE_DOWNSAMPLE_TILE_VERTEX="precision highp float;uniform vec4 uQuad;uniform vec4 uSource;attribute vec2 aPosition2;varying vec2 vCoord2;void main() {vCoord2 = mix(uSource.xy, uSource.zw, aPosition2);gl_Position = vec4(mix(uQuad.xy, uQuad.zw, aPosition2) * 2.0 - 1.0, 0, 1);}",this.GLSLX_NAME_U_UV_SPACE_CLAMPING_RECT="uUvSpaceClampingRect",this.GLSLX_NAME_U_UV_SPACE_SOURCE_RECT="uUvSpaceSourceRect",this.GLSLX_SOURCE_DRAW_TEXTURE_FRAGMENT="precision highp float;uniform float uOpacity;uniform vec4 uUvSpaceClampingRect;uniform vec4 uUvSpaceSourceRect;uniform sampler2D uTexture0;varying vec2 vCoord2;const bool drawDebugStuff = false;void main() {vec2 sampleCoordinates = clamp(vCoord2, uUvSpaceClampingRect.xy, uUvSpaceClampingRect.zw);gl_FragColor = texture2D(uTexture0, sampleCoordinates) * uOpacity;if (drawDebugStuff) {vec2 tt = 2.0 * abs((vCoord2 - uUvSpaceSourceRect.xy) / (uUvSpaceSourceRect.zw - uUvSpaceSourceRect.xy) - 0.5);float t = max(tt.x, tt.y);if (t > 0.99) {gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);}}}",this.GLSLX_NAME_U_TO_CLIP_SPACE_TRANSFORM="uToClipSpaceTransform",this.GLSLX_NAME_U_DESTINATION_RECT="uDestinationRect",this.GLSLX_SOURCE_DRAW_TEXTURE_VERTEX="precision highp float;uniform vec4 uUvSpaceSourceRect;uniform mat3 uToClipSpaceTransform;uniform vec4 uDestinationRect;attribute vec2 aPosition2;varying vec2 vCoord2;void main() {vCoord2 = mix(uUvSpaceSourceRect.xy, uUvSpaceSourceRect.zw, aPosition2);gl_Position = vec4((uToClipSpaceTransform * vec3(mix(uDestinationRect.xy, uDestinationRect.zw, aPosition2), 1.0)).xy,0,1);}",this.GLSLX_SOURCE_GRADIENT_FRAGMENT="precision highp float;uniform int uType;const float PI = 3.141592;vec2 _gradientCoord(in vec2 paintUV) {const int LINEAR = 1;const int RADIAL = 2;const int ANGULAR = 3;const int DIAMOND = 4;vec2 uv = paintUV - 0.5;float t =uType == LINEAR ? uv.x + 0.5 :uType == RADIAL ? 2.0 * length(uv) :uType == ANGULAR ? fract(atan(uv.y, uv.x) / (2.0 * PI)) :uType == DIAMOND ? 2.0 * max(abs(uv.x + uv.y), abs(uv.y - uv.x)) :0.0;return vec2(t, 0.25 + (0.75 - 0.25) / 256.0);}const float DITHER_FACTOR = 0.003922;const float DITHER_RANGE = 2.0 * DITHER_FACTOR;float random() {vec2 coordCopy = gl_FragCoord.xy;return fract(sin(dot(vec2(12.9898, 78.233), coordCopy)) * 43758.5453);}vec4 ditherColor(vec4 color) {float offset = (random() - 0.5) * DITHER_RANGE; return color.a > 0.0 ? min(abs(color + offset), 1.0) : color;}uniform float uOpacity;uniform sampler2D uTexture0;varying vec2 vCoord2;void main() {vec2 coord = _gradientCoord(vCoord2);gl_FragColor = ditherColor(texture2D(uTexture0, coord) * uOpacity);}",this.GLSLX_SOURCE_HARD_MASK_TILE_WITH_COLOR_FRAGMENT="precision highp float;uniform sampler2D uTexture0;uniform vec4 uColor;varying vec2 vCoord2;void main() {gl_FragColor = float(texture2D(uTexture0, vCoord2).a > 0.0) * uColor;}",this.GLSLX_NAME_U_TEXTURE_SIZE="uTextureSize",this.GLSLX_NAME_U_TEXTURE_PX="uTexturePx",this.GLSLX_SOURCE_HARD_MASK_WITH_COLOR_AND_DOWNSAMPLE_TILE_FRAGMENT="precision highp float;uniform vec4 uColor;uniform float uTextureSize;uniform float uTexturePx;uniform sampler2D uTexture0;varying vec2 vCoord2;void main() {vec2 coordInSSAA = vCoord2 * vec2(uTextureSize);vec2 lowerLeftInSSAA = floor(coordInSSAA - vec2(0.5)) + 0.5;vec2 lowerLeftTexelCoord = lowerLeftInSSAA * uTexturePx;vec2 lowerRightTexelCoord = lowerLeftTexelCoord + vec2(uTexturePx, 0.0);vec2 upperLeftTexelCoord = lowerLeftTexelCoord + vec2(0.0, uTexturePx);vec2 upperRightTexelCoord = lowerLeftTexelCoord + vec2(uTexturePx, uTexturePx);float lowerLeftAlpha = texture2D(uTexture0, lowerLeftTexelCoord).a;float lowerRightAlpha = texture2D(uTexture0, lowerRightTexelCoord).a;float upperLeftAlpha = texture2D(uTexture0, upperLeftTexelCoord).a;float upperRightAlpha = texture2D(uTexture0, upperRightTexelCoord).a;float hardMaskedLowerLeftAlpha = float(lowerLeftAlpha > 0.0);float hardMaskedLowerRightAlpha = float(lowerRightAlpha > 0.0);float hardMaskedUpperLeftAlpha = float(upperLeftAlpha > 0.0);float hardMaskedUpperRightAlpha = float(upperRightAlpha > 0.0);float rightWeight = coordInSSAA.x - lowerLeftInSSAA.x;float leftWeight = 1.0 - rightWeight;float topWeight = coordInSSAA.y - lowerLeftInSSAA.y;float bottomWeight = 1.0 - topWeight;float downsampledHardMaskedAlpha =(hardMaskedLowerLeftAlpha * leftWeight + hardMaskedLowerRightAlpha * rightWeight) * bottomWeight +(hardMaskedUpperLeftAlpha * leftWeight + hardMaskedUpperRightAlpha * rightWeight) * topWeight;gl_FragColor = downsampledHardMaskedAlpha * uColor;}",this.GLSLX_SOURCE_IMAGE_FRAGMENT="precision highp float;uniform bool uEmulateWrapAddress;uniform bool uEmulateBorderAddress;vec4 sampleImage(sampler2D texture, vec2 coord) {if (uEmulateWrapAddress) {coord = fract(coord);}vec4 color = texture2D(texture, coord);if (uEmulateBorderAddress && coord != clamp(coord, 0.0, 1.0)) color.a = 0.0;return color;}uniform float uOpacity;uniform sampler2D uTexture0;varying vec2 vCoord2;void main() {vec4 color = sampleImage(uTexture0, vCoord2);color.rgb *= color.a;gl_FragColor = color * uOpacity;}",this.GLSLX_SOURCE_IMAGE_COLOR_ADJUST_FRAGMENT="precision highp float;uniform bool uEmulateWrapAddress;uniform bool uEmulateBorderAddress;vec4 sampleImage(sampler2D texture, vec2 coord) {if (uEmulateWrapAddress) {coord = fract(coord);}vec4 color = texture2D(texture, coord);if (uEmulateBorderAddress && coord != clamp(coord, 0.0, 1.0)) color.a = 0.0;return color;}const vec3 RGB2Y = vec3(0.2126, 0.7152, 0.0722);const float IMAGE_HIGHLIGHT_SHADOW_THRESHOLD = 0.5;uniform float uGlobalTint;uniform float uGlobalColor;uniform float uGlobalShadows;uniform float uGlobalHighlights;uniform float uGlobalExposure;uniform float uGlobalTemperature;uniform float uGlobalContrast;vec3 colorToLinear(vec3 color) {color = pow(color, vec3(2.2));return color;}vec3 colorFromLinear(vec3 color) {color = pow(color, vec3(1.0 / 2.2));return color;}float rangeFactor(vec3 color, float shadows, float highlights) {float lThreshold = dot(color, RGB2Y) - pow(IMAGE_HIGHLIGHT_SHADOW_THRESHOLD, 2.2);return 0.75 * lThreshold / sqrt(1.0 + 4.0 * lThreshold * lThreshold) * (lThreshold > 0.0 ? highlights : -shadows * 0.999);}vec3 adjustExposure(vec3 color, float exposureAdjust) {float lFactor = pow(10.0, 2.0 * exposureAdjust) - 1.0;const float lSqueeze = 0.75;float lUnsqueeze = 1.0 / (1.0 - lSqueeze) - 1.0;float gray = dot(color, RGB2Y);lUnsqueeze *= 1.0 + gray * gray * min(0.0, exposureAdjust) / (0.2 - min(0.0, exposureAdjust));color += (gray - color) * lSqueeze;if (exposureAdjust < 0.0) {color *= 1.0 + exposureAdjust / 16.0;gray *= 1.0 + exposureAdjust / 16.0;}color *= (lFactor + 1.0) / (color * lFactor + 1.0);gray *= (lFactor + 1.0) / (gray * lFactor + 1.0);color += (color - gray) * lUnsqueeze;color = clamp(color, 0.0, 1.0);return color;}vec3 adjustColor(vec3 color, float colorAdjust) {float gray = dot(color, RGB2Y);if (colorAdjust <= 0.0) {color -= (gray - color) * colorAdjust;} else {float lNeg = gray / (gray - min(min(color.r, color.g), color.b) + 1e-6);float lPos = (1.0 - gray) / (max(max(color.r, color.g), color.b) - gray + 1e-6);float lFactor = mix(1.0, min(lNeg, lPos), colorAdjust);lFactor = min(lFactor, 2.0); color += (gray - color) * (1.0 - lFactor);}return color;}float smootherstep(float edge0, float edge1, float x) {x = clamp((x - edge0) / (edge1 - edge0), 0.0, 1.0);return x * x * x * (x * (x * 6.0 - 15.0) + 10.0);}vec3 adjustTempTintContrast(vec3 color, float temp, float tint, float contrast) {vec3 lXYZ = mat3(0.4124564, 0.2126729, 0.0193339,0.3575761, 0.7151522, 0.1191920,0.1804375, 0.0721750, 0.9503041) * color;lXYZ.x /= 0.95047;lXYZ.z /= 1.08883;lXYZ = pow(lXYZ, vec3(1.0 / 3.0));vec3 lLAB = vec3(116.0 * lXYZ.y - 16.0,500.0 * (lXYZ.x - lXYZ.y),200.0 * (lXYZ.y - lXYZ.z));lLAB.y += 30.0 * tint;lLAB.z += 30.0 * temp;float scaledThreshold = IMAGE_HIGHLIGHT_SHADOW_THRESHOLD * 100.0;float thresholdDelta = 30.0;float contrastLeftCurve = contrast < 0.0? (lLAB.x - scaledThreshold) * 0.2 + 50.0: lLAB.x;float contrastRightCurve = contrast < 0.0? lLAB.x: smootherstep(scaledThreshold - thresholdDelta,scaledThreshold + thresholdDelta, lLAB.x) * 100.0;float interp = contrast < 0.0 ? contrast + 1.0 : contrast;lLAB.x = mix(contrastLeftCurve, contrastRightCurve, interp);lXYZ.y = (lLAB.x + 16.0) / 116.0;lXYZ.x = lLAB.y / 500.0 + lXYZ.y;lXYZ.z = lXYZ.y - lLAB.z / 200.0;lXYZ *= lXYZ * lXYZ;lXYZ.x *= 0.95047;lXYZ.z *= 1.08883;color = mat3(3.2404542, -0.9692660, 0.0556434,-1.5371385, 1.8760108, -0.2040259,-0.4985314, 0.0415560, 1.0572252) * lXYZ;color = clamp(color, 0.0, 1.0);return color;}vec3 pipeline(vec3 color) {color = colorToLinear(color);float originalRangeFactor = rangeFactor(color, uGlobalShadows, uGlobalHighlights);color = adjustTempTintContrast(color, uGlobalTemperature, uGlobalTint, uGlobalContrast);color = adjustExposure(color, uGlobalExposure + originalRangeFactor);color = adjustColor(color, clamp(uGlobalColor, -1.0, 1.0));color = colorFromLinear(color);return color;}uniform float uOpacity;uniform sampler2D uTexture0;varying vec2 vCoord2;void main() {vec4 color = sampleImage(uTexture0, vCoord2);color.rgb = pipeline(color.rgb) * color.a;gl_FragColor = color * uOpacity;}",this.GLSLX_SOURCE_LERP_GRADIENT_FRAGMENT="precision highp float;uniform int uType;const float PI = 3.141592;vec2 _gradientCoord(in vec2 paintUV) {const int LINEAR = 1;const int RADIAL = 2;const int ANGULAR = 3;const int DIAMOND = 4;vec2 uv = paintUV - 0.5;float t =uType == LINEAR ? uv.x + 0.5 :uType == RADIAL ? 2.0 * length(uv) :uType == ANGULAR ? fract(atan(uv.y, uv.x) / (2.0 * PI)) :uType == DIAMOND ? 2.0 * max(abs(uv.x + uv.y), abs(uv.y - uv.x)) :0.0;return vec2(t, 0.25 + (0.75 - 0.25) / 256.0);}const float DITHER_FACTOR = 0.003922;const float DITHER_RANGE = 2.0 * DITHER_FACTOR;float random() {vec2 coordCopy = gl_FragCoord.xy;return fract(sin(dot(vec2(12.9898, 78.233), coordCopy)) * 43758.5453);}vec4 ditherColor(vec4 color) {float offset = (random() - 0.5) * DITHER_RANGE; return color.a > 0.0 ? min(abs(color + offset), 1.0) : color;}uniform float uOpacity;uniform float uProgress;uniform sampler2D uTexture0;uniform sampler2D uTexture1;varying vec2 vCoord2;void main() {vec2 coord = _gradientCoord(vCoord2);vec4 lerped = mix(texture2D(uTexture0, coord), texture2D(uTexture1, coord), uProgress);gl_FragColor = ditherColor(lerped * uOpacity);}",this.GLSLX_SOURCE_LERP_IMAGE_FRAGMENT="precision highp float;uniform bool uEmulateWrapAddress;uniform bool uEmulateBorderAddress;vec4 sampleImage(sampler2D texture, vec2 coord) {if (uEmulateWrapAddress) {coord = fract(coord);}vec4 color = texture2D(texture, coord);if (uEmulateBorderAddress && coord != clamp(coord, 0.0, 1.0)) color.a = 0.0;return color;}uniform float uOpacity;uniform float uProgress;uniform sampler2D uTexture0;uniform sampler2D uTexture1;varying vec2 vCoord2;varying vec2 vCoord2b;void main() {vec4 lerped = mix(sampleImage(uTexture0, vCoord2), sampleImage(uTexture1, vCoord2b), uProgress);lerped.rgb *= lerped.a;gl_FragColor = lerped * uOpacity;}",this.GLSLX_SOURCE_LERP_IMAGE_COLOR_ADJUST_FRAGMENT="precision highp float;uniform bool uEmulateWrapAddress;uniform bool uEmulateBorderAddress;vec4 sampleImage(sampler2D texture, vec2 coord) {if (uEmulateWrapAddress) {coord = fract(coord);}vec4 color = texture2D(texture, coord);if (uEmulateBorderAddress && coord != clamp(coord, 0.0, 1.0)) color.a = 0.0;return color;}const vec3 RGB2Y = vec3(0.2126, 0.7152, 0.0722);const float IMAGE_HIGHLIGHT_SHADOW_THRESHOLD = 0.5;uniform float uGlobalTint;uniform float uGlobalColor;uniform float uGlobalShadows;uniform float uGlobalHighlights;uniform float uGlobalExposure;uniform float uGlobalTemperature;uniform float uGlobalContrast;vec3 colorToLinear(vec3 color) {color = pow(color, vec3(2.2));return color;}vec3 colorFromLinear(vec3 color) {color = pow(color, vec3(1.0 / 2.2));return color;}float rangeFactor(vec3 color, float shadows, float highlights) {float lThreshold = dot(color, RGB2Y) - pow(IMAGE_HIGHLIGHT_SHADOW_THRESHOLD, 2.2);return 0.75 * lThreshold / sqrt(1.0 + 4.0 * lThreshold * lThreshold) * (lThreshold > 0.0 ? highlights : -shadows * 0.999);}vec3 adjustExposure(vec3 color, float exposureAdjust) {float lFactor = pow(10.0, 2.0 * exposureAdjust) - 1.0;const float lSqueeze = 0.75;float lUnsqueeze = 1.0 / (1.0 - lSqueeze) - 1.0;float gray = dot(color, RGB2Y);lUnsqueeze *= 1.0 + gray * gray * min(0.0, exposureAdjust) / (0.2 - min(0.0, exposureAdjust));color += (gray - color) * lSqueeze;if (exposureAdjust < 0.0) {color *= 1.0 + exposureAdjust / 16.0;gray *= 1.0 + exposureAdjust / 16.0;}color *= (lFactor + 1.0) / (color * lFactor + 1.0);gray *= (lFactor + 1.0) / (gray * lFactor + 1.0);color += (color - gray) * lUnsqueeze;color = clamp(color, 0.0, 1.0);return color;}vec3 adjustColor(vec3 color, float colorAdjust) {float gray = dot(color, RGB2Y);if (colorAdjust <= 0.0) {color -= (gray - color) * colorAdjust;} else {float lNeg = gray / (gray - min(min(color.r, color.g), color.b) + 1e-6);float lPos = (1.0 - gray) / (max(max(color.r, color.g), color.b) - gray + 1e-6);float lFactor = mix(1.0, min(lNeg, lPos), colorAdjust);lFactor = min(lFactor, 2.0); color += (gray - color) * (1.0 - lFactor);}return color;}float smootherstep(float edge0, float edge1, float x) {x = clamp((x - edge0) / (edge1 - edge0), 0.0, 1.0);return x * x * x * (x * (x * 6.0 - 15.0) + 10.0);}vec3 adjustTempTintContrast(vec3 color, float temp, float tint, float contrast) {vec3 lXYZ = mat3(0.4124564, 0.2126729, 0.0193339,0.3575761, 0.7151522, 0.1191920,0.1804375, 0.0721750, 0.9503041) * color;lXYZ.x /= 0.95047;lXYZ.z /= 1.08883;lXYZ = pow(lXYZ, vec3(1.0 / 3.0));vec3 lLAB = vec3(116.0 * lXYZ.y - 16.0,500.0 * (lXYZ.x - lXYZ.y),200.0 * (lXYZ.y - lXYZ.z));lLAB.y += 30.0 * tint;lLAB.z += 30.0 * temp;float scaledThreshold = IMAGE_HIGHLIGHT_SHADOW_THRESHOLD * 100.0;float thresholdDelta = 30.0;float contrastLeftCurve = contrast < 0.0? (lLAB.x - scaledThreshold) * 0.2 + 50.0: lLAB.x;float contrastRightCurve = contrast < 0.0? lLAB.x: smootherstep(scaledThreshold - thresholdDelta,scaledThreshold + thresholdDelta, lLAB.x) * 100.0;float interp = contrast < 0.0 ? contrast + 1.0 : contrast;lLAB.x = mix(contrastLeftCurve, contrastRightCurve, interp);lXYZ.y = (lLAB.x + 16.0) / 116.0;lXYZ.x = lLAB.y / 500.0 + lXYZ.y;lXYZ.z = lXYZ.y - lLAB.z / 200.0;lXYZ *= lXYZ * lXYZ;lXYZ.x *= 0.95047;lXYZ.z *= 1.08883;color = mat3(3.2404542, -0.9692660, 0.0556434,-1.5371385, 1.8760108, -0.2040259,-0.4985314, 0.0415560, 1.0572252) * lXYZ;color = clamp(color, 0.0, 1.0);return color;}vec3 pipeline(vec3 color) {color = colorToLinear(color);float originalRangeFactor = rangeFactor(color, uGlobalShadows, uGlobalHighlights);color = adjustTempTintContrast(color, uGlobalTemperature, uGlobalTint, uGlobalContrast);color = adjustExposure(color, uGlobalExposure + originalRangeFactor);color = adjustColor(color, clamp(uGlobalColor, -1.0, 1.0));color = colorFromLinear(color);return color;}uniform float uOpacity;uniform float uProgress;uniform sampler2D uTexture0;uniform sampler2D uTexture1;varying vec2 vCoord2;varying vec2 vCoord2b;void main() {vec4 lerped = mix(sampleImage(uTexture0, vCoord2), sampleImage(uTexture1, vCoord2b), uProgress);lerped.rgb = pipeline(lerped.rgb) * lerped.a;gl_FragColor = lerped * uOpacity;}",this.GLSLX_NAME_U_TEXTURE0_UV_SPACE_SCISSOR="uTexture0UvSpaceScissor",this.GLSLX_NAME_U_TEXTURE1_UV_SPACE_SCISSOR="uTexture1UvSpaceScissor",this.GLSLX_SOURCE_LERP_TILE_FRAGMENT="precision highp float;uniform float uOpacity;uniform sampler2D uTexture0;uniform sampler2D uTexture1;uniform vec4 uTexture0UvSpaceScissor;uniform vec4 uTexture1UvSpaceScissor;varying vec2 vCoord2;void main() {vec4 texture0Color =all(greaterThan(vCoord2, uTexture0UvSpaceScissor.xy)) && all(lessThan(vCoord2, uTexture0UvSpaceScissor.zw)) ?texture2D(uTexture0, vCoord2) :vec4(0.0);vec4 texture1Color =all(greaterThan(vCoord2, uTexture1UvSpaceScissor.xy)) && all(lessThan(vCoord2, uTexture1UvSpaceScissor.zw)) ?texture2D(uTexture1, vCoord2) :vec4(0.0);gl_FragColor = mix(texture0Color, texture1Color, uOpacity);}",this.GLSLX_SOURCE_LOOP_BLINN_FRAGMENT="precision highp float;varying vec3 vCoord3;void main() {if (vCoord3.x * vCoord3.x * vCoord3.x > vCoord3.y * vCoord3.z) {discard;}}",this.GLSLX_NAME_A_COORD3="aCoord3",this.GLSLX_SOURCE_LOOP_BLINN_VERTEX="precision highp float;uniform mat3 uVertexTransform;attribute vec2 aPosition2;attribute vec3 aCoord3;varying vec3 vCoord3;void main() {vCoord3 = aCoord3;gl_Position = vec4(uVertexTransform * vec3(aPosition2, 1.0), 0.0).xywz;}",this.GLSLX_SOURCE_MASK_BACKGROUND_BLUR_TILE_FRAGMENT="precision highp float;uniform sampler2D uTexture0;uniform sampler2D uTexture1;varying vec2 vCoord2;void main() {if (texture2D(uTexture1, vCoord2).a == 0.0) {discard;}gl_FragColor = texture2D(uTexture0, vCoord2);}",this.GLSLX_SOURCE_MASK_INNER_SHADOW_TILE_FRAGMENT="precision highp float;uniform sampler2D uTexture0;uniform sampler2D uTexture1;uniform vec4 uColor;varying vec2 vCoord2;void main() {gl_FragColor = (1.0 - texture2D(uTexture0, vCoord2).a) * texture2D(uTexture1, vCoord2).a * uColor;}",this.GLSLX_SOURCE_MASK_INNER_SHADOW_TILE_AND_FIRST_HARD_MASK_ALPHA_FRAGMENT="precision highp float;uniform sampler2D uTexture0;uniform sampler2D uTexture1;uniform vec4 uColor;varying vec2 vCoord2;void main() {float texture1HardMasked = float(texture2D(uTexture1, vCoord2).a > 0.0);gl_FragColor = (1.0 - texture2D(uTexture0, vCoord2).a) * texture1HardMasked * uColor;}",this.GLSLX_SOURCE_MASK_KNOCKOUT_SHADOW_TILE_FRAGMENT="precision highp float;uniform sampler2D uTexture0;uniform sampler2D uTexture1;varying vec2 vCoord2;void main() {gl_FragColor = texture2D(uTexture0, vCoord2) * float(texture2D(uTexture1, vCoord2).a == 0.);}",this.GLSLX_NAME_U_MASK_TEXTURE="uMaskTexture",this.GLSLX_SOURCE_MASK_KNOCKOUT_SHADOW_TILE_PASS_THROUGH_FRAGMENT="precision highp float;uniform sampler2D uTexture0;uniform sampler2D uTexture1;uniform sampler2D uMaskTexture;varying vec2 vCoord2;void main() {float geometryAlpha = texture2D(uMaskTexture, vCoord2).a;gl_FragColor = mix(texture2D(uTexture1, vCoord2),texture2D(uTexture0, vCoord2) * float(geometryAlpha == 0.),1.0 - geometryAlpha);}",this.GLSLX_SOURCE_MASK_TILE_FRAGMENT="precision highp float;uniform sampler2D uTexture0;uniform sampler2D uTexture1;varying vec2 vCoord2;void main() {gl_FragColor = texture2D(uTexture0, vCoord2) * texture2D(uTexture1, vCoord2).a;}",this.GLSLX_SOURCE_MASK_TILE_LUMINANCE_FRAGMENT="precision highp float;uniform sampler2D uTexture0;uniform sampler2D uTexture1;varying vec2 vCoord2;void main() {vec3 rgb = texture2D(uTexture1, vCoord2).rgb;vec3 weights = vec3(0.299, 0.587, 0.114);float c2 = dot(rgb * rgb, weights);float luminance = sqrt(c2);gl_FragColor = texture2D(uTexture0, vCoord2) * luminance * texture2D(uTexture1, vCoord2).a;}",this.GLSLX_SOURCE_MASK_TILE_LUMINANCE_PASS_THROUGH_FRAGMENT="precision highp float;uniform sampler2D uMaskTexture;uniform sampler2D uTexture0;uniform sampler2D uTexture1;varying vec2 vCoord2;void main() {vec3 rgb = texture2D(uMaskTexture, vCoord2).rgb;vec3 weights = vec3(0.299, 0.587, 0.114);float c2 = dot(rgb * rgb, weights);float luminance = sqrt(c2);gl_FragColor = mix(texture2D(uTexture1, vCoord2),texture2D(uTexture0, vCoord2),texture2D(uMaskTexture, vCoord2).a * luminance);}",this.GLSLX_SOURCE_MASK_TILE_PASS_THROUGH_FRAGMENT="precision highp float;uniform sampler2D uTexture0;uniform sampler2D uTexture1;uniform sampler2D uMaskTexture;varying vec2 vCoord2;void main() {gl_FragColor = mix(texture2D(uTexture1, vCoord2), texture2D(uTexture0, vCoord2), texture2D(uMaskTexture, vCoord2).a);}",this.GLSLX_SOURCE_NON_SOLID_COLOR_PAINT_VERTEX="precision highp float;uniform mat3 uVertexTransform;uniform mat3 uPaintTransform0;attribute vec2 aPosition2;varying vec2 vCoord2;void main() {vCoord2 = (uPaintTransform0 * vec3(aPosition2, 1)).xy;gl_Position = vec4(uVertexTransform * vec3(aPosition2, 1), 0).xywz;}",this.GLSLX_SOURCE_RECTANGLE_BLUR_FRAGMENT="precision highp float;const float DITHER_FACTOR = 0.003922;const float DITHER_RANGE = 2.0 * DITHER_FACTOR;float random() {vec2 coordCopy = gl_FragCoord.xy;return fract(sin(dot(vec2(12.9898, 78.233), coordCopy)) * 43758.5453);}vec4 ditherColor(vec4 color) {float offset = (random() - 0.5) * DITHER_RANGE; return color.a > 0.0 ? min(abs(color + offset), 1.0) : color;}float integrateTriangle(float x) {if (x < -1.0) return 0.0;else if (x < 0.0) return 0.5 * (x + 1.0) * (x + 1.0);else if (x < 1.0) return 0.5 - 0.5 * x * (x - 2.0);else return 1.0;}uniform vec4 uColor;varying vec4 vCoord4;void main() {float alpha = (integrateTriangle(vCoord4.x) - integrateTriangle(vCoord4.z)) * (integrateTriangle(vCoord4.y) - integrateTriangle(vCoord4.w));gl_FragColor = ditherColor(uColor * alpha);}",this.GLSLX_NAME_U_BLUR_RADIUS="uBlurRadius",this.GLSLX_SOURCE_RECTANGLE_BLUR_VERTEX="precision highp float;uniform mat3 uVertexTransform;uniform vec4 uQuad;uniform float uBlurRadius;attribute vec2 aPosition2;varying vec4 vCoord4;void main() {vec2 vertex = mix(uQuad.xy - uBlurRadius, uQuad.zw + uBlurRadius, aPosition2);vCoord4 = (vec4(vertex, vertex) - uQuad) / uBlurRadius;gl_Position = vec4(uVertexTransform * vec3(vertex, 1), 0).xywz;}",this.GLSLX_SOURCE_RENDER_DEVICE_FRAME_FRAGMENT="precision highp float;uniform sampler2D uTexture0;varying vec4 vPosition4;void main() {vec2 position = vPosition4.xy;vec2 uv = vPosition4.zw;uv.y = 1.0 - uv.y;gl_FragColor = texture2D(uTexture0, uv);}",this.GLSLX_NAME_A_POSITION4="aPosition4",this.GLSLX_SOURCE_RENDER_DEVICE_FRAME_VERTEX="precision highp float;uniform mat3 uVertexTransform;attribute vec4 aPosition4;varying vec4 vPosition4;void main() {vec2 transformedPosition = (uVertexTransform * vec3(aPosition4.xy, 1.0)).xy;vPosition4 = vec4(transformedPosition.xy, aPosition4.zw);gl_Position = vec4(transformedPosition, 0.0, 1.0);}",this.GLSLX_NAME_U_HOTSPOT_OPACITY="uHotspotOpacity",this.GLSLX_NAME_U_STROKE_PROPORTION="uStrokeProportion",this.GLSLX_NAME_U_UV_HOTSPOT_CLIPPING_RECT="uUvHotspotClippingRect",this.GLSLX_SOURCE_RENDER_HOTSPOT_FRAGMENT="precision highp float;uniform mat3 uVertexTransform;uniform float uHotspotOpacity;uniform vec2 uStrokeProportion;uniform vec4 uUvHotspotClippingRect;varying vec4 vPosition4;const vec3 HOTSPOT_COLOR = vec3(48.0 / 255.0, 194.0 / 255.0, 255.0 / 255.0);bool contains(vec4 rect, vec2 point) {return (rect.z >= 0.0 &&rect.w >= 0.0 &&clamp(point.x, rect.x, rect.x + rect.z) == point.x &&clamp(point.y, rect.y, rect.y + rect.w) == point.y);}void main() {vec2 position = vPosition4.xy;vec2 uv = vPosition4.zw;if (contains(uUvHotspotClippingRect, position)) {if (uv.x < uStrokeProportion.x || uv.x > 1.0 - uStrokeProportion.x ||uv.y < uStrokeProportion.y || uv.y > 1.0 - uStrokeProportion.y) {gl_FragColor = vec4(HOTSPOT_COLOR, 1.0 * uHotspotOpacity);} else {gl_FragColor = vec4(HOTSPOT_COLOR, 0.5 * uHotspotOpacity);}} else {gl_FragColor = vec4(0.0);}}",this.GLSLX_SOURCE_RENDER_HOTSPOT_VERTEX="precision highp float;uniform mat3 uVertexTransform;attribute vec4 aPosition4;varying vec4 vPosition4;void main() {vec2 transformedPosition = (uVertexTransform * vec3(aPosition4.xy, 1.0)).xy;vPosition4 = vec4(transformedPosition.xy, aPosition4.zw);gl_Position = vec4(transformedPosition, 0.0, 1.0);}",this.GLSLX_NAME_U_HALF_SIZE_OVER_BLUR_RADIUS="uHalfSizeOverBlurRadius",this.GLSLX_NAME_U_CORNER_RADIUS_OVER_BLUR_RADIUS="uCornerRadiusOverBlurRadius",this.GLSLX_SOURCE_ROUNDED_RECTANGLE_BLUR_FRAGMENT="precision highp float;const float DITHER_FACTOR = 0.003922;const float DITHER_RANGE = 2.0 * DITHER_FACTOR;float random() {vec2 coordCopy = gl_FragCoord.xy;return fract(sin(dot(vec2(12.9898, 78.233), coordCopy)) * 43758.5453);}vec4 ditherColor(vec4 color) {float offset = (random() - 0.5) * DITHER_RANGE; return color.a > 0.0 ? min(abs(color + offset), 1.0) : color;}float integrateTriangle(float x) {if (x < -1.0) return 0.0;else if (x < 0.0) return 0.5 * (x + 1.0) * (x + 1.0);else if (x < 1.0) return 0.5 - 0.5 * x * (x - 2.0);else return 1.0;}uniform vec4 uColor;uniform vec2 uHalfSizeOverBlurRadius;uniform float uCornerRadiusOverBlurRadius;varying vec2 vCoord2;float triangle(float x) {return max(0.0, (1.0 - abs(x)));}float roundedRectangleBlurHorizontal(float x, float y, float cornerRadius, vec2 halfSize) {float deltaY = min(halfSize.y - cornerRadius - abs(y), 0.0);float roundedRectX = halfSize.x - cornerRadius + sqrt(max(0.0, cornerRadius * cornerRadius - deltaY * deltaY));vec2 xRelativeToLowerAndUpper = vec2(x + roundedRectX, x - roundedRectX);return integrateTriangle(xRelativeToLowerAndUpper.x) - integrateTriangle(xRelativeToLowerAndUpper.y);}void main() {float alpha;if (all(lessThan(abs(vCoord2), uHalfSizeOverBlurRadius - vec2(uCornerRadiusOverBlurRadius + 1.0 )))) {alpha = 1.0;} else {float low = vCoord2.y - uHalfSizeOverBlurRadius.y;float high = vCoord2.y + uHalfSizeOverBlurRadius.y;float start = clamp(-1.0 , low, high);float end = clamp(1.0 , low, high);if (start == end) {alpha = 0.0;} else {const int numSamples = 4;float step = (end - start) / float(numSamples);float y = start + step * 0.5;float weightSum = 0.0;float result = 0.0;for (int i = 0; i < numSamples; i++) {float currentWeight = triangle(y);result +=roundedRectangleBlurHorizontal(vCoord2.x, vCoord2.y - y, uCornerRadiusOverBlurRadius, uHalfSizeOverBlurRadius) *currentWeight;weightSum += currentWeight;y += step;}float weightNormalizationFactor = (integrateTriangle(end) - integrateTriangle(start)) / weightSum;alpha = result * weightNormalizationFactor;}}gl_FragColor = ditherColor(uColor * alpha);}",this.GLSLX_SOURCE_ROUNDED_RECTANGLE_BLUR_VERTEX="precision highp float;uniform vec4 uQuad;uniform float uBlurRadius;uniform mat3 uVertexTransform;attribute vec2 aPosition2;varying vec2 vCoord2;void main() {vec2 center = (uQuad.xy + uQuad.zw) * 0.5;vec2 vertex = mix(uQuad.xy - uBlurRadius, uQuad.zw + uBlurRadius, aPosition2);vCoord2 = (vertex - center) / uBlurRadius;gl_Position = vec4(uVertexTransform * vec3(vertex, 1), 0).xywz;}",this.GLSLX_SOURCE_SMOOTH_PATH_FRAGMENT="precision highp float;varying vec2 vCoord2;varying vec4 vCoord4;void main() {gl_FragColor = vCoord4 * min(1.0, min(vCoord2.x, vCoord2.y));}",this.GLSLX_NAME_A_COORD4="aCoord4",this.GLSLX_SOURCE_SMOOTH_PATH_VERTEX="precision highp float;uniform mat3 uVertexTransform;attribute vec4 aCoord4;attribute vec4 aPosition4;varying vec2 vCoord2;varying vec4 vCoord4;void main() {vCoord2 = aPosition4.zw;vCoord4 = aCoord4;gl_Position = vec4(uVertexTransform * vec3(aPosition4.xy, 1.0), 0.0).xywz;}",this.GLSLX_SOURCE_SOLID_COLOR_PAINT_FRAGMENT="precision highp float;uniform float uOpacity;uniform vec4 uColor;void main() {gl_FragColor = uColor * uOpacity;}",this.GLSLX_SOURCE_SOLID_COLOR_PAINT_VERTEX="precision highp float;uniform mat3 uVertexTransform;attribute vec2 aPosition2;varying vec2 vCoord2;void main() {vCoord2 = aPosition2;gl_Position = vec4(uVertexTransform * vec3(aPosition2, 1.0), 0.0).xywz;}",this.GLSLX_SOURCE_SUPER_SSAA4X4_DOWNSAMPLE_TEXTURE_FRAGMENT="precision highp float;uniform float uOpacity;uniform sampler2D uTexture0;varying vec2 vCoord2;const int TILEATLAS_TILE_SIZE = 512;const int SSAA_4X4_DIMENSION = TILEATLAS_TILE_SIZE * 4;const float SSAA_4X4_PX = 1.0 / float(SSAA_4X4_DIMENSION);void main() {vec4 downsampledColor = 0.25 *(texture2D(uTexture0, vCoord2 + vec2(-SSAA_4X4_PX, -SSAA_4X4_PX)) +texture2D(uTexture0, vCoord2 + vec2(SSAA_4X4_PX, -SSAA_4X4_PX)) +texture2D(uTexture0, vCoord2 + vec2(SSAA_4X4_PX, SSAA_4X4_PX)) +texture2D(uTexture0, vCoord2 + vec2(-SSAA_4X4_PX, SSAA_4X4_PX)));gl_FragColor = downsampledColor * uOpacity;}",this.GLSLX_SOURCE_TILE_VERTEX="precision highp float;uniform vec4 uQuad;attribute vec2 aPosition2;varying vec2 vCoord2;void main() {vCoord2 = mix(uQuad.xy, uQuad.zw, aPosition2);gl_Position = vec4(vCoord2 * 2.0 - 1.0, 0, 1);}",this.GLSLX_SOURCE_TWO_NON_SOLID_COLOR_PAINT_VERTEX="precision highp float;uniform mat3 uVertexTransform;uniform mat3 uPaintTransform0;uniform mat3 uPaintTransform1;attribute vec2 aPosition2;varying vec2 vCoord2;varying vec2 vCoord2b;void main() {vCoord2 = (uPaintTransform0 * vec3(aPosition2, 1)).xy;vCoord2b = (uPaintTransform1 * vec3(aPosition2, 1)).xy;gl_Position = vec4(uVertexTransform * vec3(aPosition2, 1), 0).xywz;}",this.GLSLX_SOURCE_UNCLAMPED_BLUR_TILE_FRAGMENT="precision highp float;uniform float uCount;uniform vec2 uBlurDelta;uniform sampler2D uTexture0;varying vec2 vCoord2;void main() {float weight = uCount;vec4 result = texture2D(uTexture0, vCoord2) * weight;float total = weight;for (int i = 1; i < 32; i += 2) {if (float(i) > uCount) {break;}float t0 = float(i);float t1 = min(t0 + 1.0, uCount);vec2 coord0_neg = vCoord2 - uBlurDelta * t0;vec2 coord0_pos = vCoord2 + uBlurDelta * t0;vec2 coord1_neg = vCoord2 - uBlurDelta * t1;vec2 coord1_pos = vCoord2 + uBlurDelta * t1;float weight0 = uCount - t0;float weight1 = uCount - t1;float weightSum = weight0 + weight1;vec2 coord_neg = (coord0_neg * weight0 + coord1_neg * weight1) / weightSum;vec2 coord_pos = (coord0_pos * weight0 + coord1_pos * weight1) / weightSum;result += weightSum *(texture2D(uTexture0, coord_neg) +texture2D(uTexture0, coord_pos));total += 2.0 * weightSum;}gl_FragColor = result / total;}",this.GLSLX_SOURCE_UPSAMPLE_TILE_FRAGMENT="precision highp float;const float DITHER_FACTOR = 0.003922;const float DITHER_RANGE = 2.0 * DITHER_FACTOR;float random() {vec2 coordCopy = gl_FragCoord.xy;return fract(sin(dot(vec2(12.9898, 78.233), coordCopy)) * 43758.5453);}vec4 ditherColor(vec4 color) {float offset = (random() - 0.5) * DITHER_RANGE; return color.a > 0.0 ? min(abs(color + offset), 1.0) : color;}uniform sampler2D uTexture0;varying vec2 vCoord2;void main() {gl_FragColor = ditherColor(texture2D(uTexture0, vCoord2));}",this.GLSLX_SOURCE_UPSAMPLE_TILE_VERTEX="precision highp float;uniform vec4 uQuad;uniform vec4 uSource;attribute vec2 aPosition2;varying vec2 vCoord2;void main() {vCoord2 = mix(uSource.xy, uSource.zw, aPosition2);gl_Position = vec4(mix(uQuad.xy, uQuad.zw, aPosition2) * 2.0 - 1.0, 0, 1);}"):(this.GLSLX_SOURCE_SMOOTH_PATH_VERTEX="precision highp float;uniform mat3 u;attribute vec4 ha,jb;varying vec2 e;varying vec4 N;void main(){e=ha.zw,N=jb,gl_Position=vec4(u*vec3(ha.xy,1),0).xywz;}",this.GLSLX_SOURCE_SMOOTH_PATH_FRAGMENT="precision highp float;varying vec2 e;varying vec4 N;void main(){gl_FragColor=N*min(1.,min(e.x,e.y));}",this.GLSLX_SOURCE_RENDER_HOTSPOT_VERTEX="precision highp float;uniform mat3 u;attribute vec4 ha;varying vec4 W;void main(){vec2 a=(u*vec3(ha.xy,1)).xy;W=vec4(a.xy,ha.zw),gl_Position=vec4(a,0,1);}",this.GLSLX_SOURCE_RENDER_HOTSPOT_FRAGMENT="precision highp float;uniform float bb;uniform vec2 Qa;uniform vec4 kb;varying vec4 W;const vec3 cb=vec3(.188235,.760784,1);bool lb(vec4 a,vec2 b){return a.z>=0.&&a.w>=0.&&clamp(b.x,a.x,a.x+a.z)==b.x&&clamp(b.y,a.y,a.y+a.w)==b.y;}void main(){vec2 b=W.xy,a=W.zw;gl_FragColor=lb(kb,b)?a.x<Qa.x||a.x>1.-Qa.x||a.y<Qa.y||a.y>1.-Qa.y?vec4(cb,1.*bb):vec4(cb,.5*bb):vec4(0);}",this.GLSLX_SOURCE_RENDER_DEVICE_FRAME_VERTEX="precision highp float;uniform mat3 u;attribute vec4 ha;varying vec4 W;void main(){vec2 a=(u*vec3(ha.xy,1)).xy;W=vec4(a.xy,ha.zw),gl_Position=vec4(a,0,1);}",this.GLSLX_SOURCE_RENDER_DEVICE_FRAME_FRAGMENT="precision highp float;uniform sampler2D f;varying vec4 W;void main(){vec2 a=W.zw;a.y=1.-a.y,gl_FragColor=texture2D(f,a);}",this.GLSLX_SOURCE_UPSAMPLE_TILE_VERTEX="precision highp float;uniform vec4 s,Ma;attribute vec2 n;varying vec2 e;void main(){e=mix(Ma.xy,Ma.zw,n),gl_Position=vec4(mix(s.xy,s.zw,n)*2.-1.,0,1);}",this.GLSLX_SOURCE_UPSAMPLE_TILE_FRAGMENT="precision highp float;float x(){vec2 a=gl_FragCoord.xy;return fract(sin(dot(vec2(12.9898,78.233),a))*43758.5453);}uniform sampler2D f;varying vec2 e;vec4 O(vec4 a){float b=(x()-.5)*.007843;return a.a>0.?min(abs(a+b),1.):a;}void main(){gl_FragColor=O(texture2D(f,e));}",this.GLSLX_SOURCE_DOWNSAMPLE_TILE_VERTEX="precision highp float;uniform vec4 s,Ma;attribute vec2 n;varying vec2 e;void main(){e=mix(Ma.xy,Ma.zw,n),gl_Position=vec4(mix(s.xy,s.zw,n)*2.-1.,0,1);}",this.GLSLX_SOURCE_DOWNSAMPLE_TILE_FRAGMENT="precision highp float;uniform sampler2D f;varying vec2 e;void main(){gl_FragColor=texture2D(f,e);}",this.GLSLX_SOURCE_HARD_MASK_WITH_COLOR_AND_DOWNSAMPLE_TILE_FRAGMENT="precision highp float;uniform sampler2D f;uniform float db,ia;uniform vec4 I;varying vec2 e;void main(){vec2 b=e*vec2(db),c=floor(b-vec2(.5))+.5,a=c*ia,i=a+vec2(ia,0),m=a+vec2(0,ia),t=a+vec2(ia,ia);float D=texture2D(f,a).a,E=texture2D(f,i).a,J=texture2D(f,m).a,P=texture2D(f,t).a,X=float(D>0.),Y=float(E>0.),ua=float(J>0.),va=float(P>0.),d=b.x-c.x,g=1.-d,h=b.y-c.y,Ka=1.-h,Ya=(X*g+Y*d)*Ka+(ua*g+va*d)*h;gl_FragColor=Ya*I;}",this.GLSLX_SOURCE_COPY_TILE_VERTEX="precision highp float;uniform vec4 s;attribute vec2 n;void main(){gl_Position=vec4(mix(s.xy,s.zw,n),0,1);}",this.GLSLX_SOURCE_DRAW_TEXTURE_VERTEX="precision highp float;uniform mat3 mb;uniform vec4 eb,fb;attribute vec2 n;varying vec2 e;void main(){e=mix(eb.xy,eb.zw,n),gl_Position=vec4((mb*vec3(mix(fb.xy,fb.zw,n),1)).xy,0,1);}",this.GLSLX_SOURCE_DRAW_TEXTURE_FRAGMENT="precision highp float;uniform sampler2D f;uniform float q;uniform vec4 Ra;varying vec2 e;void main(){vec2 a=clamp(e,Ra.xy,Ra.zw);gl_FragColor=texture2D(f,a)*q;}",this.GLSLX_SOURCE_CLIP_SPACE_QUAD_VERTEX="precision highp float;attribute vec2 n;varying vec2 e;void main(){e=n,gl_Position=vec4(n*2.-1.,0,1);}",this.GLSLX_SOURCE_BLEND_TEXTURE_FRAGMENT="precision highp float;uniform sampler2D f;uniform float q;varying vec2 e;void main(){gl_FragColor=texture2D(f,e)*q;}",this.GLSLX_SOURCE_SUPER_SSAA4X4_DOWNSAMPLE_TEXTURE_FRAGMENT="precision highp float;uniform sampler2D f;uniform float q;varying vec2 e;void main(){vec4 a=.25*(texture2D(f,e+vec2(-4.882813e-4,-4.882813e-4))+texture2D(f,e+vec2(4.882813e-4,-4.882813e-4))+texture2D(f,e+vec2(4.882813e-4,4.882813e-4))+texture2D(f,e+vec2(-4.882813e-4,4.882813e-4)));gl_FragColor=a*q;}",this.GLSLX_SOURCE_LOOP_BLINN_VERTEX="precision highp float;uniform mat3 u;attribute vec2 n;attribute vec3 nb;varying vec3 wa;void main(){wa=nb,gl_Position=vec4(u*vec3(n,1),0).xywz;}",this.GLSLX_SOURCE_LOOP_BLINN_FRAGMENT="precision highp float;varying vec3 wa;void main(){if(wa.x*wa.x*wa.x>wa.y*wa.z)discard;}",this.GLSLX_SOURCE_TILE_VERTEX="precision highp float;uniform vec4 s;attribute vec2 n;varying vec2 e;void main(){e=mix(s.xy,s.zw,n),gl_Position=vec4(e*2.-1.,0,1);}",this.GLSLX_SOURCE_CLAMPED_BLUR_TILE_FRAGMENT="precision highp float;uniform sampler2D f;uniform float v;uniform vec2 F;uniform vec4 y;varying vec2 e;void main(){vec2 a=clamp(e,y.xy,y.zw);float t=v;vec4 ua=texture2D(f,a)*t;float va=t;for(int m=1;m<32;m+=2){if(float(m)>v)break;float b=float(m),c=min(b+1.,v);vec2 d=a-F*b,g=a+F*b,h=a-F*c,i=a+F*c;float D=(v-b)*float(d==clamp(d,y.xy,y.zw)),E=(v-b)*float(g==clamp(g,y.xy,y.zw)),J=(v-c)*float(h==clamp(h,y.xy,y.zw)),P=(v-c)*float(i==clamp(i,y.xy,y.zw)),X=D+J,Y=E+P;vec2 Ka=(d*D+h*J)/X,Ya=(g*E+i*P)/Y;ua+=texture2D(f,Ka)*X+texture2D(f,Ya)*Y,va+=X+Y;}gl_FragColor=ua/va;}",this.GLSLX_SOURCE_UNCLAMPED_BLUR_TILE_FRAGMENT="precision highp float;uniform sampler2D f;uniform float v;uniform vec2 F;varying vec2 e;void main(){float i=v;vec4 m=texture2D(f,e)*i;float t=i;for(int h=1;h<32;h+=2){if(float(h)>v)break;float a=float(h),b=min(a+1.,v);vec2 D=e-F*a,E=e+F*a,J=e-F*b,P=e+F*b;float c=v-a,d=v-b,g=c+d;vec2 X=(D*c+J*d)/g,Y=(E*c+P*d)/g;m+=g*(texture2D(f,X)+texture2D(f,Y)),t+=2.*g;}gl_FragColor=m/t;}",this.GLSLX_SOURCE_LERP_TILE_FRAGMENT="precision highp float;uniform sampler2D f,k;uniform float q;uniform vec4 Sa,Ta;varying vec2 e;void main(){vec4 a=all(greaterThan(e,Sa.xy))&&all(lessThan(e,Sa.zw))?texture2D(f,e):vec4(0),b=all(greaterThan(e,Ta.xy))&&all(lessThan(e,Ta.zw))?texture2D(k,e):vec4(0);gl_FragColor=mix(a,b,q);}",this.GLSLX_SOURCE_RECTANGLE_BLUR_VERTEX="precision highp float;uniform mat3 u;uniform float Z;uniform vec4 s;attribute vec2 n;varying vec4 N;void main(){vec2 a=mix(s.xy-Z,s.zw+Z,n);N=(vec4(a,a)-s)/Z,gl_Position=vec4(u*vec3(a,1),0).xywz;}",this.GLSLX_SOURCE_RECTANGLE_BLUR_FRAGMENT="precision highp float;float x(){vec2 a=gl_FragCoord.xy;return fract(sin(dot(vec2(12.9898,78.233),a))*43758.5453);}uniform vec4 I;varying vec4 N;vec4 O(vec4 a){float b=(x()-.5)*.007843;return a.a>0.?min(abs(a+b),1.):a;}float K(float a){return a<-1.?0.:a<0.?.5*(a+1.)*(a+1.):a<1.?.5-.5*a*(a-2.):1.;}void main(){float a=(K(N.x)-K(N.z))*(K(N.y)-K(N.w));gl_FragColor=O(I*a);}",this.GLSLX_SOURCE_ROUNDED_RECTANGLE_BLUR_VERTEX="precision highp float;uniform mat3 u;uniform float Z;uniform vec4 s;attribute vec2 n;varying vec2 e;void main(){vec2 b=(s.xy+s.zw)*.5,a=mix(s.xy-Z,s.zw+Z,n);e=(a-b)/Z,gl_Position=vec4(u*vec3(a,1),0).xywz;}",this.GLSLX_SOURCE_ROUNDED_RECTANGLE_BLUR_FRAGMENT="precision highp float;float x(){vec2 a=gl_FragCoord.xy;return fract(sin(dot(vec2(12.9898,78.233),a))*43758.5453);}uniform float gb;uniform vec2 La;uniform vec4 I;varying vec2 e;vec4 O(vec4 a){float b=(x()-.5)*.007843;return a.a>0.?min(abs(a+b),1.):a;}float K(float a){return a<-1.?0.:a<0.?.5*(a+1.)*(a+1.):a<1.?.5-.5*a*(a-2.):1.;}float hb(float a){return max(0.,1.-abs(a));}float ob(float b,float h,float a,vec2 c){float d=min(c.y-a-abs(h),0.),g=c.x-a+sqrt(max(0.,a*a-d*d));vec2 i=vec2(b+g,b-g);return K(i.x)-K(i.y);}void main(){float c;if(all(lessThan(abs(e),La-vec2(gb+1.))))c=1.;else{float d=e.y-La.y,g=e.y+La.y,a=clamp(-1.,d,g),b=clamp(1.,d,g);if(a==b)c=0.;else{float i=(b-a)/4.,h=a+i*.5,m=0.,t=0.;for(int D=0;D<4;D++){float E=hb(h);t+=ob(e.x,e.y-h,gb,La)*E,m+=E,h+=i;}float J=(K(b)-K(a))/m;c=t*J;}}gl_FragColor=O(I*c);}",this.GLSLX_SOURCE_MASK_TILE_FRAGMENT="precision highp float;uniform sampler2D f,k;varying vec2 e;void main(){gl_FragColor=texture2D(f,e)*texture2D(k,e).a;}",this.GLSLX_SOURCE_MASK_TILE_LUMINANCE_FRAGMENT="precision highp float;uniform sampler2D f,k;varying vec2 e;void main(){vec3 a=texture2D(k,e).rgb,b=vec3(.299,.587,.114);float c=dot(a*a,b),d=sqrt(c);gl_FragColor=texture2D(f,e)*d*texture2D(k,e).a;}",this.GLSLX_SOURCE_MASK_TILE_LUMINANCE_PASS_THROUGH_FRAGMENT="precision highp float;uniform sampler2D f,k,sa;varying vec2 e;void main(){vec3 a=texture2D(sa,e).rgb,b=vec3(.299,.587,.114);float c=dot(a*a,b),d=sqrt(c);gl_FragColor=mix(texture2D(k,e),texture2D(f,e),texture2D(sa,e).a*d);}",this.GLSLX_SOURCE_MASK_TILE_PASS_THROUGH_FRAGMENT="precision highp float;uniform sampler2D f,k,sa;varying vec2 e;void main(){gl_FragColor=mix(texture2D(k,e),texture2D(f,e),texture2D(sa,e).a);}",this.GLSLX_SOURCE_MASK_KNOCKOUT_SHADOW_TILE_FRAGMENT="precision highp float;uniform sampler2D f,k;varying vec2 e;void main(){gl_FragColor=texture2D(f,e)*float(texture2D(k,e).a==0.);}",this.GLSLX_SOURCE_MASK_KNOCKOUT_SHADOW_TILE_PASS_THROUGH_FRAGMENT="precision highp float;uniform sampler2D f,k,sa;varying vec2 e;void main(){float a=texture2D(sa,e).a;gl_FragColor=mix(texture2D(k,e),texture2D(f,e)*float(a==0.),1.-a);}",this.GLSLX_SOURCE_HARD_MASK_TILE_WITH_COLOR_FRAGMENT="precision highp float;uniform sampler2D f;uniform vec4 I;varying vec2 e;void main(){gl_FragColor=float(texture2D(f,e).a>0.)*I;}",this.GLSLX_SOURCE_MASK_INNER_SHADOW_TILE_FRAGMENT="precision highp float;uniform sampler2D f,k;uniform vec4 I;varying vec2 e;void main(){gl_FragColor=(1.-texture2D(f,e).a)*texture2D(k,e).a*I;}",this.GLSLX_SOURCE_MASK_INNER_SHADOW_TILE_AND_FIRST_HARD_MASK_ALPHA_FRAGMENT="precision highp float;uniform sampler2D f,k;uniform vec4 I;varying vec2 e;void main(){float a=float(texture2D(k,e).a>0.);gl_FragColor=(1.-texture2D(f,e).a)*a*I;}",this.GLSLX_SOURCE_MASK_BACKGROUND_BLUR_TILE_FRAGMENT="precision highp float;uniform sampler2D f,k;varying vec2 e;void main(){if(texture2D(k,e).a==0.)discard;gl_FragColor=texture2D(f,e);}",this.GLSLX_SOURCE_SOLID_COLOR_PAINT_VERTEX="precision highp float;uniform mat3 u;attribute vec2 n;varying vec2 e;void main(){e=n,gl_Position=vec4(u*vec3(n,1),0).xywz;}",this.GLSLX_SOURCE_SOLID_COLOR_PAINT_FRAGMENT="precision highp float;uniform float q;uniform vec4 I;void main(){gl_FragColor=I*q;}",this.GLSLX_SOURCE_NON_SOLID_COLOR_PAINT_VERTEX="precision highp float;uniform mat3 u,_;attribute vec2 n;varying vec2 e;void main(){e=(_*vec3(n,1)).xy,gl_Position=vec4(u*vec3(n,1),0).xywz;}",this.GLSLX_SOURCE_TWO_NON_SOLID_COLOR_PAINT_VERTEX="precision highp float;uniform mat3 u,_,Ua;attribute vec2 n;varying vec2 e,xa;void main(){e=(_*vec3(n,1)).xy,xa=(Ua*vec3(n,1)).xy,gl_Position=vec4(u*vec3(n,1),0).xywz;}",this.GLSLX_SOURCE_GRADIENT_FRAGMENT="precision highp float;float x(){vec2 a=gl_FragCoord.xy;return fract(sin(dot(vec2(12.9898,78.233),a))*43758.5453);}uniform int l;uniform sampler2D f;uniform float q;varying vec2 e;vec4 O(vec4 a){float b=(x()-.5)*.007843;return a.a>0.?min(abs(a+b),1.):a;}vec2 aa(in vec2 b){vec2 a=b-.5;float c=l==1?a.x+.5:l==2?2.*length(a):l==3?fract(atan(a.y,a.x)/6.283185):l==4?2.*max(abs(a.x+a.y),abs(a.y-a.x)):0.;return vec2(c,.251953);}void main(){vec2 a=aa(e);gl_FragColor=O(texture2D(f,a)*q);}",this.GLSLX_SOURCE_LERP_GRADIENT_FRAGMENT="precision highp float;float x(){vec2 a=gl_FragCoord.xy;return fract(sin(dot(vec2(12.9898,78.233),a))*43758.5453);}uniform int l;uniform sampler2D f,k;uniform float q,G;varying vec2 e;vec4 O(vec4 a){float b=(x()-.5)*.007843;return a.a>0.?min(abs(a+b),1.):a;}vec2 aa(in vec2 b){vec2 a=b-.5;float c=l==1?a.x+.5:l==2?2.*length(a):l==3?fract(atan(a.y,a.x)/6.283185):l==4?2.*max(abs(a.x+a.y),abs(a.y-a.x)):0.;return vec2(c,.251953);}void main(){vec2 a=aa(e);vec4 b=mix(texture2D(f,a),texture2D(k,a),G);gl_FragColor=O(b*q);}",this.GLSLX_SOURCE_IMAGE_FRAGMENT="precision highp float;uniform sampler2D f;uniform bool L,M;uniform float q;varying vec2 e;vec4 j(sampler2D b,vec2 a){a=L?fract(a):a;vec4 c=texture2D(b,a);M&&a!=clamp(a,0.,1.)?c.a=0.:0.;return c;}void main(){vec4 a=j(f,e);a.rgb*=a.a,gl_FragColor=a*q;}",this.GLSLX_SOURCE_LERP_IMAGE_FRAGMENT="precision highp float;uniform sampler2D f,k;uniform bool L,M;uniform float q,G;varying vec2 e,xa;vec4 j(sampler2D b,vec2 a){a=L?fract(a):a;vec4 c=texture2D(b,a);M&&a!=clamp(a,0.,1.)?c.a=0.:0.;return c;}void main(){vec4 a=mix(j(f,e),j(k,xa),G);a.rgb*=a.a,gl_FragColor=a*q;}",this.GLSLX_SOURCE_IMAGE_COLOR_ADJUST_FRAGMENT="precision highp float;uniform sampler2D f;uniform bool L,M;uniform float q,ya,za,ba,ca,Aa,Ba,Ca;varying vec2 e;const vec3 r=vec3(.2126,.7152,.0722);vec3 Da(vec3 a){a=pow(a,vec3(2.2));return a;}vec3 Ea(vec3 a){a=pow(a,vec3(.454545));return a;}float da(vec3 b,float c,float d){float a=dot(b,r)-pow(.5,2.2);return .75*a/sqrt(1.+4.*a*a)*(a>0.?d:-c*.999);}vec3 Fa(vec3 a,float b){float d=pow(10.,2.*b)-1.,g=3.,c=dot(a,r);g*=1.+c*c*min(0.,b)/(.2-min(0.,b)),a+=(c-a)*.75;if(b<0.)a*=1.+b/16.,c*=1.+b/16.;a*=(d+1.)/(a*d+1.),c*=(d+1.)/(c*d+1.),a+=(a-c)*g,a=clamp(a,0.,1.);return a;}vec3 Ga(vec3 a,float c){float b=dot(a,r);if(c<=0.)a-=(b-a)*c;else{float g=b/(b-min(min(a.r,a.g),a.b)+1e-6),h=(1.-b)/(max(max(a.r,a.g),a.b)-b+1e-6),d=mix(1.,min(g,h),c);d=min(d,2.),a+=(b-a)*(1.-d);}return a;}float ea(float b,float c,float a){a=clamp((a-b)/(c-b),0.,1.);return a*a*a*(a*(a*6.-15.)+10.);}vec3 Ha(vec3 d,float g,float h,float c){vec3 a=mat3(.412456,.212673,.019334,.357576,.715152,.119192,.180438,.072175,.950304)*d;a.x/=.95047,a.z/=1.08883,a=pow(a,vec3(.333333));vec3 b=vec3(116.*a.y-16.,500.*(a.x-a.y),200.*(a.y-a.z));b.y+=30.*h,b.z+=30.*g;float i=c<0.?(b.x-50.)*.2+50.:b.x,m=c<0.?b.x:ea(20.,80.,b.x)*100.,t=c<0.?c+1.:c;b.x=mix(i,m,t),a.y=(b.x+16.)/116.,a.x=b.y/500.+a.y,a.z=a.y-b.z/200.,a*=a*a,a.x*=.95047,a.z*=1.08883,d=mat3(3.240454,-.969266,.055643,-1.537138,1.876011,-.204026,-.498531,.041556,1.057225)*a,d=clamp(d,0.,1.);return d;}vec3 Ia(vec3 a){a=Da(a);float b=da(a,ba,ca);a=Ha(a,Ba,ya,Ca),a=Fa(a,Aa+b),a=Ga(a,clamp(za,-1.,1.)),a=Ea(a);return a;}vec4 j(sampler2D b,vec2 a){a=L?fract(a):a;vec4 c=texture2D(b,a);M&&a!=clamp(a,0.,1.)?c.a=0.:0.;return c;}void main(){vec4 a=j(f,e);a.rgb=Ia(a.rgb)*a.a,gl_FragColor=a*q;}",this.GLSLX_SOURCE_LERP_IMAGE_COLOR_ADJUST_FRAGMENT="precision highp float;uniform sampler2D f,k;uniform bool L,M;uniform float q,G,ya,za,ba,ca,Aa,Ba,Ca;varying vec2 e,xa;const vec3 r=vec3(.2126,.7152,.0722);vec3 Da(vec3 a){a=pow(a,vec3(2.2));return a;}vec3 Ea(vec3 a){a=pow(a,vec3(.454545));return a;}float da(vec3 b,float c,float d){float a=dot(b,r)-pow(.5,2.2);return .75*a/sqrt(1.+4.*a*a)*(a>0.?d:-c*.999);}vec3 Fa(vec3 a,float b){float d=pow(10.,2.*b)-1.,g=3.,c=dot(a,r);g*=1.+c*c*min(0.,b)/(.2-min(0.,b)),a+=(c-a)*.75;if(b<0.)a*=1.+b/16.,c*=1.+b/16.;a*=(d+1.)/(a*d+1.),c*=(d+1.)/(c*d+1.),a+=(a-c)*g,a=clamp(a,0.,1.);return a;}vec3 Ga(vec3 a,float c){float b=dot(a,r);if(c<=0.)a-=(b-a)*c;else{float g=b/(b-min(min(a.r,a.g),a.b)+1e-6),h=(1.-b)/(max(max(a.r,a.g),a.b)-b+1e-6),d=mix(1.,min(g,h),c);d=min(d,2.),a+=(b-a)*(1.-d);}return a;}float ea(float b,float c,float a){a=clamp((a-b)/(c-b),0.,1.);return a*a*a*(a*(a*6.-15.)+10.);}vec3 Ha(vec3 d,float g,float h,float c){vec3 a=mat3(.412456,.212673,.019334,.357576,.715152,.119192,.180438,.072175,.950304)*d;a.x/=.95047,a.z/=1.08883,a=pow(a,vec3(.333333));vec3 b=vec3(116.*a.y-16.,500.*(a.x-a.y),200.*(a.y-a.z));b.y+=30.*h,b.z+=30.*g;float i=c<0.?(b.x-50.)*.2+50.:b.x,m=c<0.?b.x:ea(20.,80.,b.x)*100.,t=c<0.?c+1.:c;b.x=mix(i,m,t),a.y=(b.x+16.)/116.,a.x=b.y/500.+a.y,a.z=a.y-b.z/200.,a*=a*a,a.x*=.95047,a.z*=1.08883,d=mat3(3.240454,-.969266,.055643,-1.537138,1.876011,-.204026,-.498531,.041556,1.057225)*a,d=clamp(d,0.,1.);return d;}vec3 Ia(vec3 a){a=Da(a);float b=da(a,ba,ca);a=Ha(a,Ba,ya,Ca),a=Fa(a,Aa+b),a=Ga(a,clamp(za,-1.,1.)),a=Ea(a);return a;}vec4 j(sampler2D b,vec2 a){a=L?fract(a):a;vec4 c=texture2D(b,a);M&&a!=clamp(a,0.,1.)?c.a=0.:0.;return c;}void main(){vec4 a=mix(j(f,e),j(k,xa),G);a.rgb=Ia(a.rgb)*a.a,gl_FragColor=a*q;}",this.GLSLX_SOURCE_BLEND_MODE_FRAGMENT="precision highp float;uniform int l;uniform sampler2D f,k;uniform float q;varying vec2 e;float Na(vec3 a){return min(min(a.r,a.g),a.b);}float Za(vec3 a){return max(max(a.r,a.g),a.b);}float Va(vec3 a){return Za(a)-Na(a);}float Wa(vec3 a){return dot(a,vec3(.3,.59,.11));}vec3 _a(vec3 c,vec3 d){float b=Wa(d);vec3 a=c+(b-Wa(c));float g=Na(a),h=Za(a);a=g<0.?mix(vec3(b),a,b/(b-g)):h>1.?mix(vec3(b),a,(1.-b)/(h-b)):a;return a;}vec3 ib(vec3 a,vec3 b,vec3 g){float c=Va(a);vec3 d=vec3(0);if(c>0.){float h=Na(a),i=Va(b);d=(a-h)*i/c;}return _a(d,g);}void main(){vec4 m=texture2D(f,e)*q,t=texture2D(k,e);float c=m.a,a=t.a;vec3 b=t.rgb;if(c==0.)gl_FragColor=vec4(b,a);else{vec3 d=m.rgb,h=d*(1.-a)+b*(1.-c);if(l==2)h+=min(d*a,b*c);else if(l==3)h+=d*b;else if(l==4)h=max(vec3(0),d+b-c*a);else if(l==5){vec3 X=max(d*a,.003922),Y=(a-b)*c*step(.003922,a-b);h+=c*a*(1.-min(vec3(1),Y/X));}else if(l==6)h+=max(d*a,b*c);else if(l==7)h=d+b-d*b;else if(l==8)h=min(vec3(1),d+b);else if(l==9){vec3 ua=max(a*(c-d),.003922),va=b*c*step(.003922,b);h+=c*a*min(vec3(1),va/ua);}else if(l==10)h+=mix(c*a-2.*(a-b)*(c-d),2.*d*b,vec3(lessThanEqual(2.*b,vec3(a))));else if(l==12)h+=mix(2.*d*b,c*a-2.*(a-b)*(c-d),vec3(greaterThan(2.*d,vec3(c))));else if(l==13)h+=abs(b*c-d*a);else if(l==14)h+=d*a+b*c-2.*d*b;else{vec3 D=vec3(0),i=d,g=b;if(c>0.)i/=c;if(a>0.)g/=a;if(l==11){vec3 Ka=1.-g,J=(16.*g-12.)*g+3.,P=inversesqrt(g+1e-6)-1.,E=mix(J,P,vec3(greaterThan(g,vec3(.25))));E=mix(E,Ka,vec3(greaterThan(i,vec3(.5)))),D=g*(1.+E*(2.*i-1.));}else D=l==15?ib(i,g,g):l==16?ib(g,i,g):l==17?_a(i,g):l==18?_a(g,i):D;h+=c*a*D;}gl_FragColor=vec4(h,c+a-c*a);}}",this.GLSLX_SOURCE_AAA_SHAPE_SOLID_COLOR_PAINT_VERTEX="precision highp float;uniform mat3 u;attribute vec2 n;uniform vec2 Oa,fa;varying vec2 w;vec2 ta(in vec2 a){return (a-vec2(.5,.5))*Oa+vec2(.5,.5);}void main(){vec2 a=ta(n);w=a*fa,gl_Position=vec4(u*vec3(n,1),0).xywz;}",this.GLSLX_SOURCE_AAA_SHAPE_NON_SOLID_COLOR_PAINT_VERTEX="precision highp float;uniform mat3 u,_;uniform float Ja;attribute vec2 n;uniform vec2 Oa,fa;varying vec2 w,ja,o,p;const vec2 Xa=vec2(.0625,.0625);void ab(vec2 a){vec2 b=1./fa/Ja;o=(_*vec3(a,1)).xy,p=(_*vec3(a+Xa*b,1)).xy-o;}vec2 ta(in vec2 a){return (a-vec2(.5,.5))*Oa+vec2(.5,.5);}void main(){vec2 a=ta(n);w=a*fa,ja=(_*vec3(a,1)).xy,ab(a),gl_Position=vec4(u*vec3(n,1),0).xywz;}",this.GLSLX_SOURCE_AAA_SHAPE_TWO_NON_SOLID_COLOR_PAINT_VERTEX="precision highp float;uniform mat3 u,_,Ua;uniform float Ja;attribute vec2 n;uniform vec2 Oa,fa;varying vec2 w,ja,o,z,p,C;const vec2 Xa=vec2(.0625,.0625);void ab(vec2 a){vec2 b=1./fa/Ja;o=(_*vec3(a,1)).xy,p=(_*vec3(a+Xa*b,1)).xy-o;}void pb(vec2 a){vec2 b=1./fa/Ja;z=(Ua*vec3(a,1)).xy,C=(Ua*vec3(a+Xa*b,1)).xy-z;}vec2 ta(in vec2 a){return (a-vec2(.5,.5))*Oa+vec2(.5,.5);}void main(){vec2 a=ta(n);w=a*fa,ja=(_*vec3(a,1)).xy,ab(a),pb(a),gl_Position=vec4(u*vec3(n,1),0).xywz;}",this.GLSLX_SOURCE_AAA_SHAPE_SOLID_COLOR_PAINT_FRAGMENT=`#extension GL_OES_standard_derivatives:enable
precision highp float;uniform float q;uniform int A;uniform vec2 Q,R;uniform vec4 I,S,T;varying vec2 w;float U(in vec2 a,in vec2 c,in vec2 b){a-=c;return a.x*a.x/(b.x*b.x)+a.y*a.y/(b.y*b.y)-1.;}float V(in vec2 m,in vec4 b,vec4 c){vec2 d=(b.zw-b.xy)/2.,a=m-d,g=a.x>0.?c.zy:c.wx;float h=a.y>0.?g.x:g.y;vec2 i=abs(a)-d+h;return min(max(i.x,i.y),0.)+length(max(i,0.))-h;}float B(in vec2 a){if(A==0)return U(a,Q,R);else if(A==1)return V(a,S,T);return 0.;}float H(vec2 c){float a=B(c),b=fwidth(a);b=max(b,1e-5);float d=a/b;return 1.-smoothstep(-.5,.5,d);}void main(){float a=H(w);gl_FragColor=I*q*a;}`,this.GLSLX_SOURCE_AAA_SHAPE_GRADIENT_FRAGMENT=`#extension GL_OES_standard_derivatives:enable
precision highp float;float x(){vec2 a=gl_FragCoord.xy;return fract(sin(dot(vec2(12.9898,78.233),a))*43758.5453);}uniform int l;uniform sampler2D f;uniform float q;vec4 O(vec4 a){float b=(x()-.5)*.007843;return a.a>0.?min(abs(a+b),1.):a;}vec2 aa(in vec2 b){vec2 a=b-.5;float c=l==1?a.x+.5:l==2?2.*length(a):l==3?fract(atan(a.y,a.x)/6.283185):l==4?2.*max(abs(a.x+a.y),abs(a.y-a.x)):0.;return vec2(c,.251953);}uniform int A;uniform vec2 Q,R;uniform vec4 S,T;varying vec2 w,ja;float U(in vec2 a,in vec2 c,in vec2 b){a-=c;return a.x*a.x/(b.x*b.x)+a.y*a.y/(b.y*b.y)-1.;}float V(in vec2 m,in vec4 b,vec4 c){vec2 d=(b.zw-b.xy)/2.,a=m-d,g=a.x>0.?c.zy:c.wx;float h=a.y>0.?g.x:g.y;vec2 i=abs(a)-d+h;return min(max(i.x,i.y),0.)+length(max(i,0.))-h;}float B(in vec2 a){if(A==0)return U(a,Q,R);else if(A==1)return V(a,S,T);return 0.;}float H(vec2 c){float a=B(c),b=fwidth(a);b=max(b,1e-5);float d=a/b;return 1.-smoothstep(-.5,.5,d);}void main(){float a=H(w);vec2 b=aa(ja);gl_FragColor=O(texture2D(f,b)*q)*a;}`,this.GLSLX_SOURCE_AAA_SHAPE_LERP_GRADIENT_FRAGMENT=`#extension GL_OES_standard_derivatives:enable
precision highp float;float x(){vec2 a=gl_FragCoord.xy;return fract(sin(dot(vec2(12.9898,78.233),a))*43758.5453);}uniform int l;uniform sampler2D f,k;uniform float q,G;vec4 O(vec4 a){float b=(x()-.5)*.007843;return a.a>0.?min(abs(a+b),1.):a;}vec2 aa(in vec2 b){vec2 a=b-.5;float c=l==1?a.x+.5:l==2?2.*length(a):l==3?fract(atan(a.y,a.x)/6.283185):l==4?2.*max(abs(a.x+a.y),abs(a.y-a.x)):0.;return vec2(c,.251953);}uniform int A;uniform vec2 Q,R;uniform vec4 S,T;varying vec2 w,ja;float U(in vec2 a,in vec2 c,in vec2 b){a-=c;return a.x*a.x/(b.x*b.x)+a.y*a.y/(b.y*b.y)-1.;}float V(in vec2 m,in vec4 b,vec4 c){vec2 d=(b.zw-b.xy)/2.,a=m-d,g=a.x>0.?c.zy:c.wx;float h=a.y>0.?g.x:g.y;vec2 i=abs(a)-d+h;return min(max(i.x,i.y),0.)+length(max(i,0.))-h;}float B(in vec2 a){if(A==0)return U(a,Q,R);else if(A==1)return V(a,S,T);return 0.;}float H(vec2 c){float a=B(c),b=fwidth(a);b=max(b,1e-5);float d=a/b;return 1.-smoothstep(-.5,.5,d);}void main(){float b=H(w);vec2 a=aa(ja);vec4 c=mix(texture2D(f,a),texture2D(k,a),G);gl_FragColor=O(c*q)*b;}`,this.GLSLX_SOURCE_AAA_SHAPE_IMAGE_FRAGMENT=`#extension GL_OES_standard_derivatives:enable
precision highp float;uniform sampler2D f;uniform bool L,M;uniform float q;vec4 j(sampler2D b,vec2 a){a=L?fract(a):a;vec4 c=texture2D(b,a);M&&a!=clamp(a,0.,1.)?c.a=0.:0.;return c;}uniform int A;uniform vec2 Q,R;uniform vec4 S,T;varying vec2 w,o,p;const vec2 ka=vec2(-3,-5),la=vec2(5,1),ma=vec2(-1,3),na=vec2(7,-7),oa=vec2(1,-3),pa=vec2(-5,5),qa=vec2(3,7),ra=vec2(-7,-1);vec4 ga(){return (j(f,o+ka*p)+j(f,o+la*p)+j(f,o+ma*p)+j(f,o+na*p)+j(f,o+oa*p)+j(f,o+pa*p)+j(f,o+qa*p)+j(f,o+ra*p))/8.;}float U(in vec2 a,in vec2 c,in vec2 b){a-=c;return a.x*a.x/(b.x*b.x)+a.y*a.y/(b.y*b.y)-1.;}float V(in vec2 m,in vec4 b,vec4 c){vec2 d=(b.zw-b.xy)/2.,a=m-d,g=a.x>0.?c.zy:c.wx;float h=a.y>0.?g.x:g.y;vec2 i=abs(a)-d+h;return min(max(i.x,i.y),0.)+length(max(i,0.))-h;}float B(in vec2 a){if(A==0)return U(a,Q,R);else if(A==1)return V(a,S,T);return 0.;}float H(vec2 c){float a=B(c),b=fwidth(a);b=max(b,1e-5);float d=a/b;return 1.-smoothstep(-.5,.5,d);}void main(){vec4 a=ga();a.rgb*=a.a,gl_FragColor=a*q*H(w);}`,this.GLSLX_SOURCE_AAA_SHAPE_LERP_IMAGE_FRAGMENT=`#extension GL_OES_standard_derivatives:enable
precision highp float;uniform sampler2D f,k;uniform bool L,M;uniform float q,G;vec4 j(sampler2D b,vec2 a){a=L?fract(a):a;vec4 c=texture2D(b,a);M&&a!=clamp(a,0.,1.)?c.a=0.:0.;return c;}uniform int A;uniform vec2 Q,R;uniform vec4 S,T;varying vec2 w,o,z,p,C;const vec2 ka=vec2(-3,-5),la=vec2(5,1),ma=vec2(-1,3),na=vec2(7,-7),oa=vec2(1,-3),pa=vec2(-5,5),qa=vec2(3,7),ra=vec2(-7,-1);vec4 ga(){return (j(f,o+ka*p)+j(f,o+la*p)+j(f,o+ma*p)+j(f,o+na*p)+j(f,o+oa*p)+j(f,o+pa*p)+j(f,o+qa*p)+j(f,o+ra*p))/8.;}vec4 Pa(){return (j(k,z+ka*C)+j(k,z+la*C)+j(k,z+ma*C)+j(k,z+na*C)+j(k,z+oa*C)+j(k,z+pa*C)+j(k,z+qa*C)+j(k,z+ra*C))/8.;}float U(in vec2 a,in vec2 c,in vec2 b){a-=c;return a.x*a.x/(b.x*b.x)+a.y*a.y/(b.y*b.y)-1.;}float V(in vec2 m,in vec4 b,vec4 c){vec2 d=(b.zw-b.xy)/2.,a=m-d,g=a.x>0.?c.zy:c.wx;float h=a.y>0.?g.x:g.y;vec2 i=abs(a)-d+h;return min(max(i.x,i.y),0.)+length(max(i,0.))-h;}float B(in vec2 a){if(A==0)return U(a,Q,R);else if(A==1)return V(a,S,T);return 0.;}float H(vec2 c){float a=B(c),b=fwidth(a);b=max(b,1e-5);float d=a/b;return 1.-smoothstep(-.5,.5,d);}void main(){vec4 b=ga(),c=Pa(),a=mix(b,c,G);a.rgb*=a.a,gl_FragColor=a*q*H(w);}`,this.GLSLX_SOURCE_AAA_SHAPE_IMAGE_COLOR_ADJUST_FRAGMENT=`#extension GL_OES_standard_derivatives:enable
precision highp float;uniform sampler2D f;uniform bool L,M;uniform float q,ya,za,ba,ca,Aa,Ba,Ca;const vec3 r=vec3(.2126,.7152,.0722);vec3 Da(vec3 a){a=pow(a,vec3(2.2));return a;}vec3 Ea(vec3 a){a=pow(a,vec3(.454545));return a;}float da(vec3 b,float c,float d){float a=dot(b,r)-pow(.5,2.2);return .75*a/sqrt(1.+4.*a*a)*(a>0.?d:-c*.999);}vec3 Fa(vec3 a,float b){float d=pow(10.,2.*b)-1.,g=3.,c=dot(a,r);g*=1.+c*c*min(0.,b)/(.2-min(0.,b)),a+=(c-a)*.75;if(b<0.)a*=1.+b/16.,c*=1.+b/16.;a*=(d+1.)/(a*d+1.),c*=(d+1.)/(c*d+1.),a+=(a-c)*g,a=clamp(a,0.,1.);return a;}vec3 Ga(vec3 a,float c){float b=dot(a,r);if(c<=0.)a-=(b-a)*c;else{float g=b/(b-min(min(a.r,a.g),a.b)+1e-6),h=(1.-b)/(max(max(a.r,a.g),a.b)-b+1e-6),d=mix(1.,min(g,h),c);d=min(d,2.),a+=(b-a)*(1.-d);}return a;}float ea(float b,float c,float a){a=clamp((a-b)/(c-b),0.,1.);return a*a*a*(a*(a*6.-15.)+10.);}vec3 Ha(vec3 d,float g,float h,float c){vec3 a=mat3(.412456,.212673,.019334,.357576,.715152,.119192,.180438,.072175,.950304)*d;a.x/=.95047,a.z/=1.08883,a=pow(a,vec3(.333333));vec3 b=vec3(116.*a.y-16.,500.*(a.x-a.y),200.*(a.y-a.z));b.y+=30.*h,b.z+=30.*g;float i=c<0.?(b.x-50.)*.2+50.:b.x,m=c<0.?b.x:ea(20.,80.,b.x)*100.,t=c<0.?c+1.:c;b.x=mix(i,m,t),a.y=(b.x+16.)/116.,a.x=b.y/500.+a.y,a.z=a.y-b.z/200.,a*=a*a,a.x*=.95047,a.z*=1.08883,d=mat3(3.240454,-.969266,.055643,-1.537138,1.876011,-.204026,-.498531,.041556,1.057225)*a,d=clamp(d,0.,1.);return d;}vec3 Ia(vec3 a){a=Da(a);float b=da(a,ba,ca);a=Ha(a,Ba,ya,Ca),a=Fa(a,Aa+b),a=Ga(a,clamp(za,-1.,1.)),a=Ea(a);return a;}vec4 j(sampler2D b,vec2 a){a=L?fract(a):a;vec4 c=texture2D(b,a);M&&a!=clamp(a,0.,1.)?c.a=0.:0.;return c;}uniform int A;uniform vec2 Q,R;uniform vec4 S,T;varying vec2 w,o,p;const vec2 ka=vec2(-3,-5),la=vec2(5,1),ma=vec2(-1,3),na=vec2(7,-7),oa=vec2(1,-3),pa=vec2(-5,5),qa=vec2(3,7),ra=vec2(-7,-1);vec4 ga(){return (j(f,o+ka*p)+j(f,o+la*p)+j(f,o+ma*p)+j(f,o+na*p)+j(f,o+oa*p)+j(f,o+pa*p)+j(f,o+qa*p)+j(f,o+ra*p))/8.;}float U(in vec2 a,in vec2 c,in vec2 b){a-=c;return a.x*a.x/(b.x*b.x)+a.y*a.y/(b.y*b.y)-1.;}float V(in vec2 m,in vec4 b,vec4 c){vec2 d=(b.zw-b.xy)/2.,a=m-d,g=a.x>0.?c.zy:c.wx;float h=a.y>0.?g.x:g.y;vec2 i=abs(a)-d+h;return min(max(i.x,i.y),0.)+length(max(i,0.))-h;}float B(in vec2 a){if(A==0)return U(a,Q,R);else if(A==1)return V(a,S,T);return 0.;}float H(vec2 c){float a=B(c),b=fwidth(a);b=max(b,1e-5);float d=a/b;return 1.-smoothstep(-.5,.5,d);}void main(){vec4 a=ga();a.rgb=Ia(a.rgb)*a.a,gl_FragColor=a*q*H(w);}`,this.GLSLX_SOURCE_AAA_SHAPE_LERP_IMAGE_COLOR_ADJUST_FRAGMENT=`#extension GL_OES_standard_derivatives:enable
precision highp float;uniform sampler2D f,k;uniform bool L,M;uniform float q,G,ya,za,ba,ca,Aa,Ba,Ca;const vec3 r=vec3(.2126,.7152,.0722);vec3 Da(vec3 a){a=pow(a,vec3(2.2));return a;}vec3 Ea(vec3 a){a=pow(a,vec3(.454545));return a;}float da(vec3 b,float c,float d){float a=dot(b,r)-pow(.5,2.2);return .75*a/sqrt(1.+4.*a*a)*(a>0.?d:-c*.999);}vec3 Fa(vec3 a,float b){float d=pow(10.,2.*b)-1.,g=3.,c=dot(a,r);g*=1.+c*c*min(0.,b)/(.2-min(0.,b)),a+=(c-a)*.75;if(b<0.)a*=1.+b/16.,c*=1.+b/16.;a*=(d+1.)/(a*d+1.),c*=(d+1.)/(c*d+1.),a+=(a-c)*g,a=clamp(a,0.,1.);return a;}vec3 Ga(vec3 a,float c){float b=dot(a,r);if(c<=0.)a-=(b-a)*c;else{float g=b/(b-min(min(a.r,a.g),a.b)+1e-6),h=(1.-b)/(max(max(a.r,a.g),a.b)-b+1e-6),d=mix(1.,min(g,h),c);d=min(d,2.),a+=(b-a)*(1.-d);}return a;}float ea(float b,float c,float a){a=clamp((a-b)/(c-b),0.,1.);return a*a*a*(a*(a*6.-15.)+10.);}vec3 Ha(vec3 d,float g,float h,float c){vec3 a=mat3(.412456,.212673,.019334,.357576,.715152,.119192,.180438,.072175,.950304)*d;a.x/=.95047,a.z/=1.08883,a=pow(a,vec3(.333333));vec3 b=vec3(116.*a.y-16.,500.*(a.x-a.y),200.*(a.y-a.z));b.y+=30.*h,b.z+=30.*g;float i=c<0.?(b.x-50.)*.2+50.:b.x,m=c<0.?b.x:ea(20.,80.,b.x)*100.,t=c<0.?c+1.:c;b.x=mix(i,m,t),a.y=(b.x+16.)/116.,a.x=b.y/500.+a.y,a.z=a.y-b.z/200.,a*=a*a,a.x*=.95047,a.z*=1.08883,d=mat3(3.240454,-.969266,.055643,-1.537138,1.876011,-.204026,-.498531,.041556,1.057225)*a,d=clamp(d,0.,1.);return d;}vec3 Ia(vec3 a){a=Da(a);float b=da(a,ba,ca);a=Ha(a,Ba,ya,Ca),a=Fa(a,Aa+b),a=Ga(a,clamp(za,-1.,1.)),a=Ea(a);return a;}vec4 j(sampler2D b,vec2 a){a=L?fract(a):a;vec4 c=texture2D(b,a);M&&a!=clamp(a,0.,1.)?c.a=0.:0.;return c;}uniform int A;uniform vec2 Q,R;uniform vec4 S,T;varying vec2 w,o,z,p,C;const vec2 ka=vec2(-3,-5),la=vec2(5,1),ma=vec2(-1,3),na=vec2(7,-7),oa=vec2(1,-3),pa=vec2(-5,5),qa=vec2(3,7),ra=vec2(-7,-1);vec4 ga(){return (j(f,o+ka*p)+j(f,o+la*p)+j(f,o+ma*p)+j(f,o+na*p)+j(f,o+oa*p)+j(f,o+pa*p)+j(f,o+qa*p)+j(f,o+ra*p))/8.;}vec4 Pa(){return (j(k,z+ka*C)+j(k,z+la*C)+j(k,z+ma*C)+j(k,z+na*C)+j(k,z+oa*C)+j(k,z+pa*C)+j(k,z+qa*C)+j(k,z+ra*C))/8.;}float U(in vec2 a,in vec2 c,in vec2 b){a-=c;return a.x*a.x/(b.x*b.x)+a.y*a.y/(b.y*b.y)-1.;}float V(in vec2 m,in vec4 b,vec4 c){vec2 d=(b.zw-b.xy)/2.,a=m-d,g=a.x>0.?c.zy:c.wx;float h=a.y>0.?g.x:g.y;vec2 i=abs(a)-d+h;return min(max(i.x,i.y),0.)+length(max(i,0.))-h;}float B(in vec2 a){if(A==0)return U(a,Q,R);else if(A==1)return V(a,S,T);return 0.;}float H(vec2 c){float a=B(c),b=fwidth(a);b=max(b,1e-5);float d=a/b;return 1.-smoothstep(-.5,.5,d);}void main(){vec4 b=ga(),c=Pa(),a=mix(b,c,G);a.rgb=Ia(a.rgb)*a.a,gl_FragColor=a*q*H(w);}`,this.GLSLX_NAME_U_TEXTURE0="f",this.GLSLX_NAME_U_TEXTURE1="k",this.GLSLX_NAME_U_TYPE="l",this.GLSLX_NAME_A_POSITION2="n",this.GLSLX_NAME_U_OPACITY="q",this.GLSLX_NAME_U_QUAD="s",this.GLSLX_NAME_U_VERTEX_TRANSFORM="u",this.GLSLX_NAME_U_COUNT="v",this.GLSLX_NAME_U_BLUR_CLAMP="y",this.GLSLX_NAME_U_SHAPE_TYPE="A",this.GLSLX_NAME_U_BLUR_DELTA="F",this.GLSLX_NAME_U_PROGRESS="G",this.GLSLX_NAME_U_COLOR="I",this.GLSLX_NAME_U_EMULATE_WRAP_ADDRESS="L",this.GLSLX_NAME_U_EMULATE_BORDER_ADDRESS="M",this.GLSLX_NAME_U_ELLIPSE_CENTER="Q",this.GLSLX_NAME_U_ELLIPSE_RADII="R",this.GLSLX_NAME_U_RECT="S",this.GLSLX_NAME_U_CORNER_RADII="T",this.GLSLX_NAME_U_BLUR_RADIUS="Z",this.GLSLX_NAME_U_PAINT_TRANSFORM0="_",this.GLSLX_NAME_U_GLOBAL_SHADOWS="ba",this.GLSLX_NAME_U_GLOBAL_HIGHLIGHTS="ca",this.GLSLX_NAME_U_PATH_SIZE="fa",this.GLSLX_NAME_A_POSITION4="ha",this.GLSLX_NAME_U_TEXTURE_PX="ia",this.GLSLX_NAME_U_MASK_TEXTURE="sa",this.GLSLX_NAME_U_GLOBAL_TINT="ya",this.GLSLX_NAME_U_GLOBAL_COLOR="za",this.GLSLX_NAME_U_GLOBAL_EXPOSURE="Aa",this.GLSLX_NAME_U_GLOBAL_TEMPERATURE="Ba",this.GLSLX_NAME_U_GLOBAL_CONTRAST="Ca",this.GLSLX_NAME_U_PIXEL_RATIO="Ja",this.GLSLX_NAME_U_HALF_SIZE_OVER_BLUR_RADIUS="La",this.GLSLX_NAME_U_SOURCE="Ma",this.GLSLX_NAME_U_UV_SCALE="Oa",this.GLSLX_NAME_U_STROKE_PROPORTION="Qa",this.GLSLX_NAME_U_UV_SPACE_CLAMPING_RECT="Ra",this.GLSLX_NAME_U_TEXTURE0_UV_SPACE_SCISSOR="Sa",this.GLSLX_NAME_U_TEXTURE1_UV_SPACE_SCISSOR="Ta",this.GLSLX_NAME_U_PAINT_TRANSFORM1="Ua",this.GLSLX_NAME_U_HOTSPOT_OPACITY="bb",this.GLSLX_NAME_U_TEXTURE_SIZE="db",this.GLSLX_NAME_U_UV_SPACE_SOURCE_RECT="eb",this.GLSLX_NAME_U_DESTINATION_RECT="fb",this.GLSLX_NAME_U_CORNER_RADIUS_OVER_BLUR_RADIUS="gb",this.GLSLX_NAME_A_COORD4="jb",this.GLSLX_NAME_U_UV_HOTSPOT_CLIPPING_RECT="kb",this.GLSLX_NAME_U_TO_CLIP_SPACE_TRANSFORM="mb",this.GLSLX_NAME_A_COORD3="nb")}static instance(){return i._instance||(i._instance=new i),i._instance}};var E;(X=>{function i(M){return M&255}X.red=i;function e(M){return M>>8&255}X.green=e;function t(M){return M>>16&255}X.blue=t;function n(M){return M>>>24}X.alpha=n;function r(M){return i(M)/255}X.redF=r;function o(M){return e(M)/255}X.greenF=o;function a(M){return t(M)/255}X.blueF=a;function s(M){return n(M)/255}X.alphaF=s;function l(M,te){return _(i(M),e(M),t(M),te)}X.withAlpha=l;function d(M){let te=s(M);return m(r(M)*te,o(M)*te,a(M)*te,te)}X.premultiplied=d;function c(M){let te=s(M);return m(r(M)/te,o(M)/te,a(M)/te,te)}X.unpremultiplied=c;function p(M,te){return M&16777215|v(s(M)*te)<<24}X.multiplyOpacity=p;function u(M){let te=1-s(M)+s(M)*r(M),J=1-s(M)+s(M)*o(M),oe=1-s(M)+s(M)*a(M);return m(te,J,oe,1)}X.rgbaToRgb=u;function h(M){return`Color(${i(M)}, ${e(M)}, ${t(M)}, ${n(M)})`}X.toString=h;function f(M){return n(M)==255}X.isOpaque=f;function y(M){return"#"+z(i(M))+z(e(M))+z(t(M))}X.toCSS=y;function g(M){return{red:r(M),green:o(M),blue:a(M),alpha:s(M)}}X.toColorF=g;function A(M){return{r:i(M),g:e(M),b:t(M),a:n(M)}}X.asInttoJSON=A;function T(M){return{r:r(M),g:o(M),b:a(M),a:s(M)}}X.asFloattoJSON=T;function b(M,te,J){return _(M,te,J,255)}X.new1=b;function _(M,te,J,oe){return M|te<<8|J<<16|oe<<24}X.new2=_;function m(M,te,J,oe){return _(v(M),v(te),v(J),v(oe))}X.new3=m;function S(M){return m(M.red,M.green,M.blue,M.alpha)}X.fromColorF=S;function v(M){return M<0?0:M>=1?255:Math.round(M*255)|0}X._clamp=v;function C(M,te,J){return m(r(M)+(r(te)-r(M))*J,o(M)+(o(te)-o(M))*J,a(M)+(a(te)-a(M))*J,s(M)+(s(te)-s(M))*J)}X.mix=C;function N(M,te){let J=s(M),oe=s(te),le=J*(1-oe),tt=le+oe,nt=le/tt,At=oe/tt;return m(r(M)*nt+r(te)*At,o(M)*nt+o(te)*At,a(M)*nt+a(te)*At,tt)}X.blend=N;function x(M,te){return m(r(M)*(1-s(te))+r(te),o(M)*(1-s(te))+o(te),a(M)*(1-s(te))+a(te),s(M)*(1-s(te))+s(te))}X.over=x;function z(M){let te=M.toString(16);return(te.length==1?"0"+te:te).toUpperCase()}X.asCSSComponent=z,X.TRANSPARENT=_(0,0,0,0),X.BLACK=b(0,0,0),X.WHITE=b(255,255,255),X.RED=b(255,0,0),X.GREEN=b(0,255,0),X.BLUE=b(0,0,255),X.YELLOW=b(255,255,0),X.CYAN=b(0,255,255),X.MAGENTA=b(255,0,255)})(E||(E={}));var gr=class i{constructor(){if(arguments.length==0)this._bytes=null,this._view=null,this._count=0,this._capacity=0,this._capacity=256,this._bytes=new Uint8Array(this._capacity),this._view=new DataView(this._bytes.buffer);else if(arguments.length==1){let e=arguments[0];this._bytes=null,this._view=null,this._count=0,this._capacity=0,this._bytes=e,this._count=this._capacity=e.length,this._view=new DataView(e.buffer,e.byteOffset,e.length)}}clear(){this._count=0}clone(){return new i(new Uint8Array(this.bytes()))}isEmpty(){return this._count==0}byteCount(){return this._count}bytes(){return this._bytes.subarray(0,this._count)}floatAt(e){return this._view.getFloat32(e,!0)}byteAt(e){return this._bytes[e]}appendFloat(e){return this._count+4>this._capacity&&this._grow(this._count+4),this._view.setFloat32(this._count,e,!0),this._count=this._count+4,this}appendByte(e){return this._count+1>this._capacity&&this._grow(this._count+1),this._bytes[this._count]=e,this._count=this._count+1,this}prependBytes(e){let t=e.byteCount();return this._count+t>this._capacity&&this._grow(this._count+t),this._bytes.set(this.bytes(),t),this._bytes.set(e.bytes()),this._count=this._count+t,this}appendBytes(e){let t=e.byteCount();return this._count+t>this._capacity&&this._grow(this._count+t),this._bytes.set(e.bytes(),this._count),this._count=this._count+t,this}setFloatAt(e,t){this._view.setFloat32(e,t,!0)}_grow(e){this._capacity=e*2;let t=new Uint8Array(this._capacity);this._bytes!=null&&t.set(this._bytes),this._bytes=t,this._view=new DataView(t.buffer)}},Ud;(e=>{function i(t,n){if(t==null||n==null||t.byteCount()!=n.byteCount())return!1;for(let r=0,o=t.byteCount();r<o;r=r+1)if(t.byteAt(r)!=n.byteAt(r))return!1;return!0}e.FrozenDataArray_equals=i})(Ud||(Ud={}));var S_=(l=>(l[l.ROTATE_0=0]="ROTATE_0",l[l.ROTATE_90=1]="ROTATE_90",l[l.ROTATE_180=2]="ROTATE_180",l[l.ROTATE_270=3]="ROTATE_270",l[l.FLIP_ROTATE_0=4]="FLIP_ROTATE_0",l[l.FLIP_ROTATE_90=5]="FLIP_ROTATE_90",l[l.FLIP_ROTATE_180=6]="FLIP_ROTATE_180",l[l.FLIP_ROTATE_270=7]="FLIP_ROTATE_270",l))(S_||{}),Gd;(u=>{function i(h,f){if(f.value+1>h.length)return null;let y=new _e(h[f.value]);return f.value=f.value+1,y}u._read8=i;function e(h,f,y){if(f.value+2>h.length)return null;let g=h[f.value],A=h[f.value+1];return f.value=f.value+2,new _e(y==1?g|A<<8:A|g<<8)}u._read16=e;function t(h,f,y){if(f.value+2>h.length)return null;let g=h[f.value],A=h[f.value+1],T=h[f.value+2],b=h[f.value+3];return f.value=f.value+4,new _e(y==1?g|A<<8|T<<16|b<<24:b|T<<8|A<<16|g<<24)}u._read32=t;function n(h){let f=[255,216,255];if(h.length<f.length)return null;for(let g=0,A=f.length;g<A;g=g+1)if(f[g]!=h[g])return null;let y=new _e(2);for(;y.value+4<=h.length;){let g=e(h,y,0);if(g==null||g.value>>8!=255)return null;let A=e(h,y,0);if(A==null||A.value<2)return null;if(y.value=y.value-2,g.value==65505){let T=r(h,y.value);if(T!=null)return T}y.value=y.value+A.value}return null}u.readFromJPEG=n;function r(h,f){let y=new _e(f),g=e(h,y,0);if(g==null||g.value<6)return null;let A=t(h,y,0);if(A==null||A.value!=1165519206)return null;let T=e(h,y,0);if(T==null||T.value!=0)return null;let b=t(h,y,0);if(b==null||b.value!=1229531648&&b.value!=1296891946)return null;let m=b.value==1229531648?1:0,S=t(h,y,m);if(S==null)return null;y.value=y.value+S.value-8;let v=e(h,y,m);if(v==null)return null;let C=v.value,N=-1;for(let x=0;x<C;x=x+1){let z=e(h,y,m);if(z==null)break;let $=z.value,q=e(h,y,m);if(q==null)break;let K=q.value,F=t(h,y,m);if(F==null)break;let P=F.value,k=new _e(y.value);if(y.value=y.value+4,!($!=u.EXIF_TAG_ORIENTATION||P!=1)){if(K==u.EXIF_FORMAT_BYTE){let H=i(h,k);if(H==null)return null;N=H.value}else if(K==u.EXIF_FORMAT_SHORT){let H=e(h,k,m);if(H==null)return null;N=H.value}else if(K==u.EXIF_FORMAT_LONG||K==u.EXIF_FORMAT_SLONG){let H=t(h,k,m);if(H==null)return null;N=H.value}else continue;switch(N){case 1:return new _e(0);case 6:return new _e(1);case 3:return new _e(2);case 8:return new _e(3);case 2:return new _e(4);case 5:return new _e(5);case 4:return new _e(6);case 7:return new _e(7)}}}return null}u._decodeExifOrientation=r;let o;(y=>(y[y.BIG=0]="BIG",y[y.LITTLE=1]="LITTLE"))(o=u.Endianness||(u.Endianness={}));let a;(f=>{function h(y){return o[y]}f.Endianness_toString=h})(a=u.in_Endianness||(u.in_Endianness={})),u.EXIF_TAG_ORIENTATION=274,u.EXIF_FORMAT_BYTE=1,u.EXIF_FORMAT_SHORT=3,u.EXIF_FORMAT_LONG=4,u.EXIF_FORMAT_SLONG=9})(Gd||(Gd={}));var Gl;(n=>{function i(r){switch(r){case 0:case 4:return 0;case 1:case 5:return 90;case 2:case 6:return 180;case 3:case 7:return 270;default:return 0}}n.ImageOrientation_rotationDegrees=i;function e(r){return r==4||r==5||r==6||r==7}n.ImageOrientation_shouldFlip=e;function t(r){return S_[r]}n.ImageOrientation_toString=t})(Gl||(Gl={}));function Ve(i){let e=typeof i=="string"?new Error(i):i;setTimeout(()=>{throw e},0)}function xv(i){let e=new Error(i);setTimeout(()=>{throw e},0)}function y_(i){xv(i)}var Hd=class{seconds(){return qa.Performance_now(Kr().performance)/1e3}milliseconds(){return qa.Performance_now(Kr().performance)}constructor(){}};var la=class{reset(){this._seconds=0}advanceSeconds(e){this._seconds+=e}seconds(){return this._seconds}milliseconds(){return this._seconds*1e3}constructor(){this._seconds=0}},ke;(a=>{function i(s){a._implementations.push(s)}a.dangerouslyPushMockTime=i;function e(){if(a._implementations.length==1)throw new Error("Popping last time implementation");ue.List_removeLast(a._implementations)}a.popMockTime=e;function t(){return ue.List_last(a._implementations).seconds()}a.seconds=t;function n(){return ue.List_last(a._implementations).milliseconds()}a.milliseconds=n;function r(s){let l=t(),d=t();for(;d-l<s;)d=t()}a.spin=r,a._implementations=[new Hd]})(ke||(ke={}));var Xa=class{elapsedSeconds(){return ke.seconds()-this._start}reset(){this._start=ke.seconds()}constructor(){this._start=ke.seconds()}};var kh=class{constructor(e){this._byteLength=0,this._cachedPx=null,this._cachedFrameIdx=null,this._byteLength=e,this._cachedPx=new Uint8Array(this._byteLength)}save(e,t){this._cachedFrameIdx!=null&&this._cachedFrameIdx.value==e||(this._cachedPx.set(t),this._cachedFrameIdx=new _e(e))}saveEmpty(e){this._cachedFrameIdx!=null&&this._cachedFrameIdx.value==e||(e!=0&&Ve("Saving empty frame for idx \u2260 0"),this._cachedPx.fill(0),this._cachedFrameIdx=new _e(e))}getLastNonDisposedFrame(){return this._cachedFrameIdx==null&&Ve("Attempting to get cached non-disposed frame while cache index has not been set"),this._cachedPx}},Uo=class Uo{constructor(e){this._width=0,this._height=0,this._frameCount=0,this._loopCount=0,this._currentLoop=0,this._frameByteLength=0,this._buf=null,this._frameInfos=null,this._startedPlayingMs=-1,this._currentFrame=-1,this._desiredFrameStartTimeMs=0,this._currentFramePx=null,this._prevDisposal=0,this._needPreviousFrame=!1,this._previousFrameCache=null,this._width=e.width,this._height=e.height,this._frameCount=e.frameCount,this._loopCount=e.loopCount,this._frameByteLength=this._width*this._height*4,this._buf=e.buf,this._frameInfos=e.frameInfos,this._currentFramePx=new Uint8Array(this._frameByteLength),this._needPreviousFrame=e.needLastNonDisposed,this._needPreviousFrame&&(this._previousFrameCache=new kh(this._frameByteLength))}width(){return this._width}height(){return this._height}frameCount(){return this._frameCount}loopCount(){return this._loopCount}loopsForever(){return this._loopCount==0}frameInfo(e){return(e<0||e>=this._frameInfos.length)&&Uo.fail("Frame index out of range."),this._frameInfos[e]}_shouldAdvance(){if(!this.loopsForever()&&this._currentFrame==this._frameCount-1&&(this._loopCount==-1||this._loopCount==this._currentLoop))return Uo.ShouldAdvance.NO;if(this._startedPlayingMs<0)return this._startedPlayingMs=ke.milliseconds(),Uo.ShouldAdvance.ONCE;let e=this.loopsForever()?Uo.ShouldAdvance.UNTIL_CAUGHT_UP:Uo.ShouldAdvance.ONCE;return ke.milliseconds()-this._startedPlayingMs>=this._desiredFrameStartTimeMs?e:Uo.ShouldAdvance.NO}_advanceFrame(){this._currentFrame=this._currentFrame+1,this._currentFrame>=this._frameCount&&(this._currentLoop=this._currentLoop+1,this._currentFrame=ht.int_remainder(this._currentFrame,this._frameCount));let e=this.frameInfo(this._currentFrame).delay*10;return e<=10&&(e=100),this._desiredFrameStartTimeMs+=e,this._blitFrame()}nextFrameIfNecessary(){let e=this._shouldAdvance();if(e==Uo.ShouldAdvance.NO)return null;let t=ke.milliseconds(),n=this._advanceFrame();if(e==Uo.ShouldAdvance.UNTIL_CAUGHT_UP)for(;this._shouldAdvance()!=Uo.ShouldAdvance.NO;){if(ke.milliseconds()-t>=16){this._desiredFrameStartTimeMs=ke.milliseconds()+this.frameInfo(this._currentFrame).delay*10-this._startedPlayingMs;break}n=this._advanceFrame()}return n}nextFrameForTesting(){return this._currentFrame=this._currentFrame+1,this._currentFrame>=this._frameCount&&(this._currentLoop=this._currentLoop+1,this._currentFrame=ht.int_remainder(this._currentFrame,this._frameCount)),this._blitFrame()}restart(){this._startedPlayingMs=-1,this._desiredFrameStartTimeMs=0,this._currentFrame=-1,this._currentLoop=0}toString(){let e=r=>"["+r.map(o=>`${o}`).join(", ")+"]",t=this._loopCount==0?"infinite":`${this._loopCount}`,n=this._frameInfos.map(r=>r.disposal);return ue.List_removeDuplicates(n),`GIF
 size: ${this._width} x ${this._height}
 loopCount: ${t}
 frameCount: ${this._frameCount}
 disposals: ${e(n)}`}_forEachRowIndexPairInSubrect(e,t){for(let n=e.y,r=e.y+e.height;n<r;n=n+1){let o=this.width()*4*n;t(o+e.x*4,o+(e.x+e.width)*4)}}_clearLastFrameToBackground(){let e=this._currentFrame>0?this._frameInfos[this._currentFrame-1]:null;e==null||e.width==this.width()&&e.height==this.height()?this._currentFramePx.fill(0):this._forEachRowIndexPairInSubrect(e,(t,n)=>{this._currentFramePx.subarray(t,n).fill(0)})}_blitFrame(){let e=this._frameInfos[this._currentFrame];if(this._currentFrame==0)this._clearLastFrameToBackground();else switch(this._prevDisposal){case 0:case 1:break;case 2:{this._clearLastFrameToBackground();break}case 3:{let f=this._currentFrame>0?this._currentFrame-1:this._frameCount-1,y=this._frameInfos[f],g=this._previousFrameCache.getLastNonDisposedFrame();y==null||g==null?this._clearLastFrameToBackground():y.width==this.width()&&y.height==this.height()?this._currentFramePx.set(g):this._forEachRowIndexPairInSubrect(y,(A,T)=>{let b=this._currentFramePx.subarray(A,T),_=g.subarray(A,T);b.set(_)});break}default:{console.error(`Disposal flag ${this._prevDisposal} not recognized`);break}}let t=e.width*e.height,n=new Uint8Array(t);this._LZWOutputIndexStream(this._buf,e.dataOffset,n,t);let r=e.paletteOffset,o=e.transparentIndex,a=e.width,s=this.width()-a,l=a,d=(e.y*this.width()+e.x)*4,c=((e.y+e.height)*this.width()-(this.width()-e.width-e.x))*4,p=d,u=s*4;e.interlaced&&(u=u+this.width()*4*7);let h=8;for(let f=0,y=n.length;f<y;f=f+1){let g=n[f];if(l==0&&(p=p+u,l=a,p>=c&&(u=s*4+this.width()*4*(h-1),p=d+(a+s)*(h<<1),h>>=1)),g==o)p=p+4;else{let A=this._buf[r+g*3],T=this._buf[r+g*3+1],b=this._buf[r+g*3+2];this._currentFramePx[(p=p+1)+-1]=A,this._currentFramePx[(p=p+1)+-1]=T,this._currentFramePx[(p=p+1)+-1]=b,this._currentFramePx[(p=p+1)+-1]=255}l=l-1}return this._prevDisposal=e.disposal,this._needPreviousFrame&&(this._prevDisposal<2?this._previousFrameCache.save(this._currentFrame,this._currentFramePx):this._currentFrame==0&&this._previousFrameCache.saveEmpty(this._currentFrame)),this._currentFramePx}_LZWOutputIndexStream(e,t,n,r){let o=e[(t=t+1)+-1],a=1<<o,s=a+1,l=s+1,d=o+1,c=(1<<d)-1,p=0,u=0,h=0,f=e[(t=t+1)+-1],y=new Int32Array(4096),g=-1;for(;;){for(;p<16&&f!=0;)u|=e[(t=t+1)+-1]<<p,p=p+8,f==1?f=e[(t=t+1)+-1]:f=f-1;if(p<d)break;let A=u&c;if(u>>=d,p=p-d,A==a){l=s+1,d=o+1,c=(1<<d)-1,g=-1;continue}else if(A==s)break;let T=A<l?A:g,b=0,_=T;for(;_>a;)_=y[_]>>8,b=b+1;let m=_;if(h+b+(T!=A?1:0)>r){console.warn("Warning, gif stream longer than expected.");return}n[(h=h+1)+-1]=m,h=h+b;let v=h;for(T!=A&&(n[(h=h+1)+-1]=m),_=T;(b=b-1)- -1!=0;)_=y[_],n[v=v-1]=_&255,_>>=8;g!=-1&&l<4096&&(y[(l=l+1)+-1]=g<<8|m,l>=c+1&&d<12&&(d=d+1,c=c<<1|1)),g=A}if(h!=r){console.warn("Warning, gif stream shorter than expected.");return}}decodedSize(){return this._buf.length}static fail(e){throw new Error(e)}};Uo.DEBUG_LOG=!1;var gi=Uo;(o=>{let i;(d=>(d[d.ONCE=0]="ONCE",d[d.UNTIL_CAUGHT_UP=1]="UNTIL_CAUGHT_UP",d[d.NO=2]="NO"))(i=o.ShouldAdvance||(o.ShouldAdvance={}));class e{constructor(s,l,d,c,p,u,h){this.width=s,this.height=l,this.frameCount=d,this.loopCount=c,this.buf=p,this.frameInfos=u,this.needLastNonDisposed=h}}o.DecodeResult=e;class t{toString(){return`Frame [x=${this.x}, y=${this.y}] [w=${this.width}, h=${this.height}] [delay=${this.delay}] [localPalette=${this.hasLocalPalette}] [interlaced=${this.interlaced}]`}constructor(s,l,d,c,p,u,h,f,y,g,A,T,b){this.x=s,this.y=l,this.width=d,this.height=c,this.hasLocalPalette=p,this.paletteOffset=u,this.paletteSize=h,this.dataOffset=f,this.dataLength=y,this.transparentIndex=g,this.interlaced=A,this.delay=T,this.disposal=b}}o.Frame=t;class n{_decode(s){let l=0;(s[(l=l+1)+-1]!=71||s[(l=l+1)+-1]!=73||s[(l=l+1)+-1]!=70||s[(l=l+1)+-1]!=56||(s[(l=l+1)+-1]+1&253)!=56||s[(l=l+1)+-1]!=97)&&o.fail("Invalid GIF 87a/89a header.");let d=s[(l=l+1)+-1]|s[(l=l+1)+-1]<<8,c=s[(l=l+1)+-1]|s[(l=l+1)+-1]<<8,p=s[(l=l+1)+-1],u=!!(p>>7),f=1<<(p&7)+1;l=l+1,l=l+1;let y=0,g=0;u&&(y=l,g=f,l=l+f*3);let A=!0,T=[],b=!1,_=0,m=256,S=0,v=-1,C=!0;e:for(;A&&l<s.length;)switch(s[(l=l+1)+-1]){case 33:{switch(s[(l=l+1)+-1]){case 255:{if(s[l]!=11||s[l+1]==78&&s[l+2]==69&&s[l+3]==84&&s[l+4]==83&&s[l+5]==67&&s[l+6]==65&&s[l+7]==80&&s[l+8]==69&&s[l+9]==50&&s[l+10]==46&&s[l+11]==48&&s[l+12]==3&&s[l+13]==1&&s[l+16]==0)l=l+14,v=s[(l=l+1)+-1]|s[(l=l+1)+-1]<<8,l=l+1;else for(l=l+12;;){let N=s[(l=l+1)+-1];if(N>=0||o.fail("Invalid block size"),N==0)break;l=l+N}break}case 249:{(s[(l=l+1)+-1]!=4||s[l+4]!=0)&&o.fail("Invalid graphics extension block.");let N=s[(l=l+1)+-1];_=s[(l=l+1)+-1]|s[(l=l+1)+-1]<<8,m=s[(l=l+1)+-1],N&1||(m=256),S=N>>2&7,!b&&S==3&&(b=!0),N>>1&1,l=l+1;break}case 254:case 1:{for(;;){let N=s[(l=l+1)+-1];if(N>=0||o.fail("Invalid block size"),N==0)break;l=l+N}break}default:{let N=s[l-1].toString(16);o.fail(`Unknown graphic control label: 0x${N}`);break}}break}case 44:{let N=s[(l=l+1)+-1]|s[(l=l+1)+-1]<<8,x=s[(l=l+1)+-1]|s[(l=l+1)+-1]<<8,z=s[(l=l+1)+-1]|s[(l=l+1)+-1]<<8,$=s[(l=l+1)+-1]|s[(l=l+1)+-1]<<8,q=s[(l=l+1)+-1],K=!!(q>>7),F=q>>6&1,k=1<<(q&7)+1,H=y,L=g,Q=!1;K&&(Q=!0,H=l,L=k,l=l+k*3);let X=l,M=!1;for(l=l+1;;){let te=s[(l=l+1)+-1];if(te===void 0){M=!0;break}if(te>=0||o.fail("Invalid block size"),te==0)break;l=l+te}M||T.push(new o.Frame(N,x,z,$,Q,H,L,X,l-X,m,!!F,_,S)),(z==d&&$==c||!Q||_>0)&&(C=!1);break}case 59:{A=!1;break e}default:{let N=s[l-1].toString(16);o.fail(`Unknown gif block: 0x${N}`);break}}if(C){let N="May have encountered multi-image/single-canvas GIF";N+=`
  GIF metadata: [${d} x ${c}], loopCount=${v}, disposal=${S}`;for(let x of T)N+=`
    ${x}`;console.warn(N)}return new o.DecodeResult(d,c,T.length,v,s,T,b)}static decodeBytes(s){{let l=new o.Decoder()._decode(s);return new mn(3,l.width,l.height,l)}}constructor(){}}o.Decoder=n;let r;(s=>{function a(l){return o.ShouldAdvance[l]}s.ShouldAdvance_toString=a})(r=o.in_ShouldAdvance||(o.in_ShouldAdvance={}))})(gi||(gi={}));var I_=(r=>(r[r.UNSENT=0]="UNSENT",r[r.SENT=1]="SENT",r[r.CANCELED=2]="CANCELED",r[r.COMPLETE=3]="COMPLETE",r))(I_||{}),zl=(t=>(t[t.STRING=0]="STRING",t[t.BYTES=1]="BYTES",t))(zl||{}),Hl=class{constructor(e){this.status=e}},Mr=class{state(){return this._state}get(){return this.send3("GET")}put(){return this.send3("PUT")}head(){return this.send3("HEAD")}setProgressCallback(e){this._progressCallback=e}header(e,t){return this._headers.set(e,t),this}format(e){return this._format=e,this}send1(e,t,n){if(2==0)return this.send3(e);if(Bi==3){this._blob=t;for(let r of Array.from(n.keys()))this._headers.set(r,n.get(r));return this.send3(e)}else throw new Error("unimplemented")}send2(e,t){if(2==0)return this.send3(e);if(Bi==3)return this._blob=t,this.send3(e);throw new Error("unimplemented")}send3(e){if(2==0)return new Promise((t,n)=>{if(v_==null){n(new Hl(0));return}let r=v_(this._url);if(r==200){let o=new zd;o.status=200,t(o)}else n(new Hl(r))});if(Bi==3){this._xhr.open(e,this._url);let t=null,n=null,r=new Promise((o,a)=>{t=o,n=a});r.then(null,o=>{this.cancel()});for(let o of Array.from(this._headers.keys()))this._xhr.setRequestHeader(o,this._headers.get(o));switch(this._format){case 1:{this._xhr.responseType="arraybuffer";break}}return this._xhr.onload=()=>{if(this._state==2)return;let o=new zd;switch(o.status=this._xhr.status,o.contentType=this._xhr.getResponseHeader("Content-Type"),this._format){case 0:{o.text=this._xhr.response;break}case 1:{o.bytes=new Uint8Array(this._xhr.response);break}}t(o)},this._xhr.onprogress=o=>{this._state!=2&&this._progressCallback!=null&&o.lengthComputable&&this._progressCallback(o.loaded/o.total)},this._xhr.onloadend=()=>{n(new Hl(this._xhr.status))},this._formData!=null?this._xhr.send(this._formData):this._xhr.send(this._blob),this._state=1,r}else throw new Error("unimplemented")}cancel(){if(2!=0)if(Bi==3)this._state==1&&this._xhr.abort(),(this._state==0||this._state==1)&&(this._state=2);else throw new Error("unimplemented")}constructor(e){this._url=e,this._method=null,this._headers=new Map,this._state=0,this._format=0,this._progressCallback=null,this._xhr=new XMLHttpRequest,this._formData=null,this._blob=null}},zd=class{mimeType(){let e=this.contentType!=null?this.contentType.indexOf(";"):-1;return e!=-1?this.contentType.slice(0,e):this.contentType}wasSuccessful(){return this.status>=200&&this.status<=299}constructor(){this.status=0,this.contentType=null,this.text=null,this.bytes=null}},b_;(e=>{function i(t){return I_[t]}e.HTTPRequestState_toString=i})(b_||(b_={}));var T_;(e=>{function i(t){return zl[t]}e.HTTPRequestFormat_toString=i})(T_||(T_={}));var v_=null;var Uh=(n=>(n[n.PENDING=0]="PENDING",n[n.FULFILLED=1]="FULFILLED",n[n.REJECTED=2]="REJECTED",n))(Uh||{}),ro=class{constructor(){this._state=0,this._promise=null,this._resolve=null,this._reject=null,this._promise=new Promise((e,t)=>{this._resolve=e,this._reject=t})}realPromise(){return this._promise}then1(e){this.then2(e,null)}then2(e,t){this._promise.then(e,t)}resolve(e){return this._state==0&&(this._state=1,this._resolve(e)),this}reject(e){return this._state==0&&(this._state=2,this._reject(e)),this}state(){return this._state}},Wd=class Wd{constructor(){}};Wd.VOID=new Wd;var or=Wd,E_;(e=>{function i(t){return Uh[t]}e.PromiseState_toString=i})(E_||(E_={}));function Qd(i){Promise.resolve(or.VOID).then(e=>{i()})}var Wl=(r=>(r[r.NONE=0]="NONE",r[r.FETCHING=1]="FETCHING",r[r.DECODED=2]="DECODED",r[r.FAILED=3]="FAILED",r))(Wl||{}),Kd=(t=>(t[t.CANVAS_ONLY=0]="CANVAS_ONLY",t[t.ANY=1]="ANY",t))(Kd||{}),qd=(n=>(n[n.FETCH=0]="FETCH",n[n.DECODE=1]="DECODE",n[n.ABORT=2]="ABORT",n))(qd||{}),Ir=class Ir{width(){return this.texture()!=null?this.texture().width():this._decodedData!=null?this._decodedData.width:0}height(){return this.texture()!=null?this.texture().height():this._decodedData!=null?this._decodedData.height:0}constructor(e,t,n,r){this._compressedData=null,this._url=null,this._downloadUrl=null,this._hash=null,this._allowDownscaling=!0,this._imageType=1,this._gif=null,this._fetchAndDecodePromise=null,this._decodedData=null,this._texture=null,this._url=e,this._downloadUrl=e,this._imageType=t,this._hash=n,this._allowDownscaling=r,n!=null&&!Lr&&Rt.getImageBatchURL()!=null&&O_(n)}primeWithCompressedData(e){this._compressedData=e,this._downloadUrl=URL.createObjectURL(new Blob([this._compressedData]))}imageType(){return this._imageType}isGIF(){return this._imageType==0}gif(){return this._gif}url(){return this._url}hash(){return this._hash}state(){return this.isDecoded()?2:this._fetchAndDecodePromise!=null&&this._fetchAndDecodePromise.state()==2?3:this._fetchAndDecodePromise!=null&&this._fetchAndDecodePromise.state()==0?1:0}loadDidFail(){return this.state()==3}_fetchImageBytesForSlowDecode(){let e=new ro;return this._compressedData!=null?e.resolve(this._compressedData):new Mr(this._downloadUrl).format(1).get().then(t=>{t.wasSuccessful()?e.resolve(t.bytes):(console.error(`failed to fetch image '${this}'`),e.reject(0))},t=>{e.reject(0)}),e}decodedData(){return this._decodedData}texture(){return this._texture}setTexture(e){this._texture=e}isDecoded(){return this._gif!=null||this._decodedData!=null||this._texture!=null}fetchAndDecode(e,t,n){if(this._decodedData!=null){t(this._decodedData);return}let r=this._fetchAndDecodePromise!=null;r||(this._fetchAndDecodePromise=new ro),this._fetchAndDecodePromise.then2(t,n),!r&&(this._hash==null||Rt.getImageBatchURL()==null?this._fetchAndDecode(e):O_(this._hash).then2(o=>{this._fetchAndDecodePromise!=null&&(this._downloadUrl=o,this._fetchAndDecode(e))},o=>{this._fetchAndDecodePromise!=null&&this._fetchAndDecodePromise.reject(o)}))}_fetchAndDecode(e){this._canUseFastFetchAndDecode()?this._fastFetchAndDecode(e):this._slowFetchAndDecode()}_canUseFastFetchAndDecode(){return Ir.browserSupportsFastImageDecoding()&&this._imageType==1}_fetchHTMLImageObject(){let e=new ro,t=Qr.HTMLDocument_createElementImage(document);return t.crossOrigin="anonymous",t.src=this._downloadUrl,t.onload=()=>{e.resolve(t)},t.onerror=()=>{e.reject(0)},e}_fastFetchAndDecode(e){this._fetchHTMLImageObject().then2(t=>{this._fetchAndDecodePromise!=null&&t.decode().then(n=>{if(this._fetchAndDecodePromise==null)return;if(e!=0){this._handleDecodeSuccess(new mn(2,t.naturalWidth,t.naturalHeight,t));return}let r=document.createElement("canvas");if(!(this._allowDownscaling&&(Je.isMobile(Je.current())||Je.current()==4&&navigator.maxTouchPoints>0||Rt.forceMobileOptimizations())))r.width=t.naturalWidth,r.height=t.naturalHeight;else{let s=Math.max(t.naturalWidth,t.naturalHeight),d=Math.min(2048,s)/s;r.width=Math.round(t.naturalWidth*d)|0,r.height=Math.round(t.naturalHeight*d)|0}let a=no.HTMLCanvasElement_getContext2D(r);a==null?(Ir.trackImageDecodeFailure("Canvas context creation failed"),this._fetchAndDecodePromise!=null&&this._fetchAndDecodePromise.reject(1)):(a.drawImage(t,0,0,r.width,r.height),this._handleDecodeSuccess(new mn(1,r)))},n=>{Ir.trackImageDecodeFailure("Image.decode"),this._fetchAndDecodePromise!=null&&this._fetchAndDecodePromise.reject(1)})},t=>{this._fetchAndDecodePromise!=null&&this._fetchAndDecodePromise.reject(0)})}_handleDecodeSuccess(e){this._fetchAndDecodePromise!=null&&(this._decodedData=e,this._imageType==0?(this._gif=new gi(e.gif),mn.setRamInUse(wn.increment("Decoded image data in RAM (MB)",1*this._gif.decodedSize()/(1024*1024)))):mn.setRamInUse(wn.increment("Decoded image data in RAM (MB)",1*e.width*e.height*4/(1024*1024))),this._fetchAndDecodePromise.resolve(e),wn.increment("# Decoded images",1))}_slowFetchAndDecode(){this._fetchImageBytesForSlowDecode().then2(e=>{this._fetchAndDecodePromise!=null&&mn.decodeImageBuffer(e,this._imageType).then(t=>{this._handleDecodeSuccess(t)},t=>{Ir.trackImageDecodeFailure("unknown"),console.error(`failed to load image '${this}'`),this._fetchAndDecodePromise!=null&&this._fetchAndDecodePromise.reject(1)})},e=>{this._fetchAndDecodePromise!=null&&this._fetchAndDecodePromise.reject(e)})}freeMemoryForDecodedData(){let e=!1;return this._decodedData!=null&&(wn.increment("# Decoded images",-1),mn.setRamInUse(wn.increment("Decoded image data in RAM (MB)",-1*this.width()*this.height()*4/(1024*1024))),this._decodedData=null,e=!0),e}freeMemoryForDecodedDataAndTexture(){let e=!1;return this.freeMemoryForDecodedData(),this._gif!=null&&(mn.setRamInUse(wn.increment("Decoded image data in RAM (MB)",-1*this._gif.decodedSize()/(1024*1024))),this._gif=null,e=!0),this.texture()!=null&&(this.texture().deleteTexture(),this.setTexture(null),e=!0),this._fetchAndDecodePromise!=null&&(this._fetchAndDecodePromise.reject(2),this._fetchAndDecodePromise=null,e=!0),e}objectHash(){return`ImageResourceImpl(${this._url}, ${ca[this._imageType]})`}toString(){return`ImageResourceImpl(${this._url}, ${ca[this._imageType]})`}static browserSupportsFastImageDecoding(){return(Je.chrome()&&Y.isBrowserVersionAtLeast("81")||Je.firefox()&&Y.isBrowserVersionAtLeast("77")||Je.safari()&&!Je.ios()&&Y.isBrowserVersionAtLeast("13.1")||Je.safari()&&Je.ios()&&Y.isBrowserVersionAtLeast("13.4")||Je.safari()&&Je.ios()&&Y.isOSVersionAtLeast("13.4.1"))&&Y.htmlImageDecodeMethodIsPresent()}static getEmojiImageUrl(e){let t=e.map(a=>a.toString(16)).join("-"),n=Y.getFeatureFlags().font_index_220528,r=Y.getFeatureFlags().font_index_emoji_low_res;return(n?r?"https://static.figma.com/emoji/4/64/":"https://static.figma.com/emoji/4/160/":"https://static.figma.com/emoji/1/64/")+t+".png"}static createEmojiImage1(e){let t=e.map(n=>n.toString(16)).join("-");return Ir.createEmojiImage2(t)}static createEmojiImage2(e){let t=Y.getFeatureFlags().font_index_220528,n=Y.getFeatureFlags().font_index_emoji_low_res,o=(t?n?"https://static.figma.com/emoji/4/64/":"https://static.figma.com/emoji/4/160/":"https://static.figma.com/emoji/1/64/")+e+".png";return new Ir(o,1,null,!0)}static createDeviceImage(e){let t=e.url,n=Kr().INITIAL_OPTIONS,r=n?n.cluster_name:"missing-cluster",o=t+`?cachebreaker=${r}`;return new Ir(o,1,null,!1)}static createImage(e,t,n){let r=Ir.bytesToHex(e),o=Rt.getImagePrefixURL(),s=`${o.endsWith("/")?o:o+"/"}${r}`,l=new Ir(s,n,r,!0);return t!=null&&l.primeWithCompressedData(t),l}static bytesToHex(e){let t="";for(let n=0,r=e.length;n<r;n=n+1)t+=(e[n]|256).toString(16).slice(-2);return t}static hexToBytes(e){let t=[];for(let n=0;n<e.length;n=n+2)t.push(parseInt(e.substr(n,2),16));return new Uint8Array(t)}static trackImageDecodeFailure(e){Ir.numDecodeFailuresLogged>=Ir.LOG_MAX_DECODE_FAILURES||(Pe.trackEvent("image_decode_failed",{reason:e}),Ir.numDecodeFailuresLogged=Ir.numDecodeFailuresLogged+1)}};Ir.LOG_MAX_DECODE_FAILURES=3,Ir.numDecodeFailuresLogged=0;var Un=Ir,C_;(e=>{function i(t){return Wl[t]}e.ImageState_toString=i})(C_||(C_={}));var R_;(e=>{function i(t){return Kd[t]}e.DecodeOutput_toString=i})(R_||(R_={}));var N_;(e=>{function i(t){return qd[t]}e.ImageFailure_toString=i})(N_||(N_={}));function Pv(){let i=Rt.getImageBatchURL(),e=Hh;Hh=[],Gh=0;let t=r=>{let o=new Mr(i),a=new Map,s=Kr().INITIAL_OPTIONS.user_data;s&&a.set("x-figma-user-id",s.id),o.send1("POST",new Blob([JSON.stringify({sha1s:r})],{type:"application/json"}),a).then(d=>{if(!d.wasSuccessful()){for(let u of r){let h=i+":"+u;Go.has(h)&&Go.get(h).reject(0)}return}let p=JSON.parse(d.text).meta.s3_urls;for(let u of Object.keys(p)){let h=i+":"+u;if(Go.has(h)){let f=Go.get(h);f.state()==0&&f.resolve(p[u])}}for(let u of r)if(!(u in p)){let h=i+":"+u;Go.has(h)&&Go.get(h).reject(0)}},d=>{for(let c of r){let p=i+":"+c;Go.has(p)&&Go.get(p).reject(0)}})},n=200;for(let r=0;r<=((e.length-1)/n|0);r=r+1){let o=e.slice(r*n,Math.min((r+1)*n,e.length));t(o)}}function O_(i){let e=Rt.getImageBatchURL()+":"+i;return Go.has(e)||(Hh.push(i),Go.set(e,new ro),Gh==0&&(Gh=setTimeout(()=>{Pv()},0))),Go.get(e)}var Gh=0,Hh=[],Go=new Map;var Ql;(K=>{function i(F){return F<0?0:F>255?255:F}K._clip=i;function e(F){return i(F+64>>7)}K._CF=e;function t(F,P){let k=0,H=F[P+4]<<11,L=F[P+6],Q=F[P+2],X=F[P+1],M=F[P+7],te=F[P+5],J=F[P+3],oe=0;if(!(H|L|Q|X|M|te|J)){let le=F[P]<<3;F[P]=le,F[P+1]=le,F[P+2]=le,F[P+3]=le,F[P+4]=le,F[P+5]=le,F[P+6]=le,F[P+7]=le;return}k=(F[P]<<11)+128,oe=K._W7*(X+M),X=oe+(K._W1-K._W7)*X,M=oe-(K._W1+K._W7)*M,oe=K._W3*(te+J),te=oe-(K._W3-K._W5)*te,J=oe-(K._W3+K._W5)*J,oe=k+H,k=k-H,H=K._W6*(Q+L),L=H-(K._W2+K._W6)*L,Q=H+(K._W2-K._W6)*Q,H=X+te,X=X-te,te=M+J,M=M-J,J=oe+Q,oe=oe-Q,Q=k+L,k=k-L,L=181*(X+M)+128>>8,X=181*(X-M)+128>>8,F[P]=J+H>>8,F[P+1]=Q+L>>8,F[P+2]=k+X>>8,F[P+3]=oe+te>>8,F[P+4]=oe-te>>8,F[P+5]=k-X>>8,F[P+6]=Q-L>>8,F[P+7]=J-H>>8}K._rowInverseDCT=t;function n(F,P,k,H,L){let Q=0,X=F[P+8*4]<<8,M=F[P+8*6],te=F[P+8*2],J=F[P+8*1],oe=F[P+8*7],le=F[P+8*5],tt=F[P+8*3],nt=0;if(!(X|M|te|J|oe|le|tt)){let At=i((F[P]+32>>6)+128);for(let Lt=8;Lt!=0;Lt=Lt-1)k[H]=At,H=H+L;return}Q=(F[P]<<8)+8192,nt=K._W7*(J+oe)+4,J=nt+(K._W1-K._W7)*J>>3,oe=nt-(K._W1+K._W7)*oe>>3,nt=K._W3*(le+tt)+4,le=nt-(K._W3-K._W5)*le>>3,tt=nt-(K._W3+K._W5)*tt>>3,nt=Q+X,Q=Q-X,X=K._W6*(te+M)+4,M=X-(K._W2+K._W6)*M>>3,te=X+(K._W2-K._W6)*te>>3,X=J+le,J=J-le,le=oe+tt,oe=oe-tt,tt=nt+te,nt=nt-te,te=Q+M,Q=Q-M,M=181*(J+oe)+128>>8,J=181*(J-oe)+128>>8,k[H]=i((tt+X>>14)+128),H=H+L,k[H]=i((te+M>>14)+128),H=H+L,k[H]=i((Q+J>>14)+128),H=H+L,k[H]=i((nt+le>>14)+128),H=H+L,k[H]=i((nt-le>>14)+128),H=H+L,k[H]=i((Q-J>>14)+128),H=H+L,k[H]=i((te-M>>14)+128),H=H+L,k[H]=i((tt-X>>14)+128)}K._colInverseDCT=n;let r;(Q=>(Q[Q.OK=0]="OK",Q[Q.NO_JPEG=1]="NO_JPEG",Q[Q.UNSUPPORTED=2]="UNSUPPORTED",Q[Q.SYNTAX_ERROR=3]="SYNTAX_ERROR",Q[Q.FINISHED=4]="FINISHED"))(r=K.Result||(K.Result={}));class o{upsampleH(){let P=this.width-3,k=0,H=0,L=new Uint8Array(this.width*this.height*2);for(let Q=this.height;Q!=0;Q=Q-1){L[H]=e(K._CF2A*this.pixels[k]+K._CF2B*this.pixels[k+1]),L[H+1]=e(K._CF3X*this.pixels[k]+K._CF3Y*this.pixels[k+1]+K._CF3Z*this.pixels[k+2]),L[H+2]=e(K._CF3A*this.pixels[k]+K._CF3B*this.pixels[k+1]+K._CF3C*this.pixels[k+2]);for(let X=0;X<P;X=X+1)L[H+X*2+3]=e(K._CF4A*this.pixels[k+X]+K._CF4B*this.pixels[k+X+1]+K._CF4C*this.pixels[k+X+2]+K._CF4D*this.pixels[k+X+3]),L[H+X*2+4]=e(K._CF4D*this.pixels[k+X]+K._CF4C*this.pixels[k+X+1]+K._CF4B*this.pixels[k+X+2]+K._CF4A*this.pixels[k+X+3]);k=k+this.stride,H=H+this.width*2,L[H+-3]=e(K._CF3A*this.pixels[k-1]+K._CF3B*this.pixels[k-2]+K._CF3C*this.pixels[k-3]),L[H+-2]=e(K._CF3X*this.pixels[k-1]+K._CF3Y*this.pixels[k-2]+K._CF3Z*this.pixels[k-3]),L[H+-1]=e(K._CF2A*this.pixels[k-1]+K._CF2B*this.pixels[k-2])}this.width<<=1,this.stride=this.width,this.pixels=L}upsampleV(){let P=this.width,k=this.stride,H=k+k,L=new Uint8Array(this.width*this.height*2);for(let Q=0;Q<P;Q=Q+1){let X=Q,M=Q;L[M]=e(K._CF2A*this.pixels[X]+K._CF2B*this.pixels[X+k]),M=M+P,L[M]=e(K._CF3X*this.pixels[X]+K._CF3Y*this.pixels[X+k]+K._CF3Z*this.pixels[X+H]),M=M+P,L[M]=e(K._CF3A*this.pixels[X]+K._CF3B*this.pixels[X+k]+K._CF3C*this.pixels[X+H]),M=M+P,X=X+k;for(let te=this.height-3;te!=0;te=te-1)L[M]=e(K._CF4A*this.pixels[X+-k]+K._CF4B*this.pixels[X]+K._CF4C*this.pixels[X+k]+K._CF4D*this.pixels[X+H]),M=M+P,L[M]=e(K._CF4D*this.pixels[X+-k]+K._CF4C*this.pixels[X]+K._CF4B*this.pixels[X+k]+K._CF4A*this.pixels[X+H]),M=M+P,X=X+k;X=X+k,L[M]=e(K._CF3A*this.pixels[X]+K._CF3B*this.pixels[X-k]+K._CF3C*this.pixels[X-H]),M=M+P,L[M]=e(K._CF3X*this.pixels[X]+K._CF3Y*this.pixels[X-k]+K._CF3Z*this.pixels[X-H]),M=M+P,L[M]=e(K._CF2A*this.pixels[X]+K._CF2B*this.pixels[X-k])}this.height<<=1,this.stride=this.width,this.pixels=L}constructor(){this.id=0,this.ssx=0,this.ssy=0,this.width=0,this.height=0,this.stride=0,this.quantizationTableIndex=0,this.acTableIndex=0,this.dcTableIndex=0,this.dcPred=0,this.pixels=null}}K.Component=o;class a{constructor(){}}K.Stop=a;let s;(J=>(J[J.NONE=0]="NONE",J[J.ROTATE_0=1]="ROTATE_0",J[J.FLIP_ROTATE_0=2]="FLIP_ROTATE_0",J[J.ROTATE_180=3]="ROTATE_180",J[J.FLIP_ROTATE_180=4]="FLIP_ROTATE_180",J[J.FLIP_ROTATE_90=5]="FLIP_ROTATE_90",J[J.ROTATE_90=6]="ROTATE_90",J[J.FLIP_ROTATE_270=7]="FLIP_ROTATE_270",J[J.ROTATE_270=8]="ROTATE_270"))(s=K.Orientation||(K.Orientation={}));class l{constructor(){this._bitBuffer=0,this._bitCount=0,this._block=new Int32Array(64),this._bytes=null,this._componentCount=0,this._components=[],this._error=0,this._exifOrientation=1,this._height=0,this._heightInMacroBlocks=0,this._huffmanTable=[],this._length=0,this._macroBlockSizeX=0,this._macroBlockSizeY=0,this._offset=0,this._quantizationTable=[],this._restartInterval=0,this._rgb=null,this._size=0,this._width=0,this._widthInMacroBlocks=0,this._getVLC_code=0;for(let P=0;P<4;P=P+1)this._quantizationTable.push(new Uint8Array(64)),this._huffmanTable.push(new Uint16Array(65536)),this._components.push(new o)}_throw(P){throw this._error=P,new a}_showBits(P){if(P==0)return 0;for(;this._bitCount<P;){if(this._size<=0){this._bitBuffer=this._bitBuffer<<8|255,this._bitCount=this._bitCount+8;continue}let k=this._bytes[this._offset];if(this._offset=this._offset+1,this._size=this._size-1,this._bitCount=this._bitCount+8,this._bitBuffer=this._bitBuffer<<8|k,k==255){this._size==0&&this._throw(3);let H=this._bytes[this._offset];this._offset=this._offset+1,this._size=this._size-1,H==217?this._size=0:H!=0&&H!=255&&((H&248)!=208&&this._throw(3),this._bitBuffer=this._bitBuffer<<8|H,this._bitCount=this._bitCount+8)}}return this._bitBuffer>>this._bitCount-P&(1<<P)-1}_skipBits(P){this._bitCount<P&&this._showBits(P),this._bitCount=this._bitCount-P}_getBits(P){let k=this._showBits(P);return this._skipBits(P),k}_byteAlign(){this._bitCount&=248}_skip(P){this._offset=this._offset+P,this._size=this._size-P,this._length=this._length-P,this._size<0&&this._throw(3)}_decodeBig16(P){return this._bytes[P]<<8|this._bytes[P+1]}_decodeBig32(P){return this._bytes[P]<<24|this._bytes[P+1]<<16|this._bytes[P+2]<<8|this._bytes[P+3]}_decode16(P,k){return k==l.Endianness.LITTLE?this._bytes[P]|this._bytes[P+1]<<8:this._decodeBig16(P)}_decode32(P,k){return k==l.Endianness.LITTLE?this._bytes[P]|this._bytes[P+1]<<8|this._bytes[P+2]<<16|this._bytes[P+3]<<24:this._decodeBig32(P)}_decodeLength(){this._size<2&&this._throw(3),this._length=this._decodeBig16(this._offset),this._length>this._size&&this._throw(3),this._skip(2)}_skipMarker(){this._decodeLength(),this._skip(this._length)}_decodeSOF(){let P=0,k=0,H=null;this._decodeLength(),this._length<9&&this._throw(3),this._bytes[this._offset]!=8&&this._throw(2),this._height=this._decodeBig16(this._offset+1),this._width=this._decodeBig16(this._offset+3),this._componentCount=this._bytes[this._offset+5],this._skip(6),this._componentCount!=1&&this._componentCount!=3&&this._throw(2),this._length<this._componentCount*3&&this._throw(3);for(let L=0;L<this._componentCount;L=L+1)H=this._components[L],H.id=this._bytes[this._offset],H.ssx=this._bytes[this._offset+1]>>4,H.ssy=this._bytes[this._offset+1]&15,H.quantizationTableIndex=this._bytes[this._offset+2],(H.ssx==0||H.ssy==0||H.quantizationTableIndex&252)&&this._throw(3),(H.ssx&H.ssx-1||H.ssy&H.ssy-1)&&this._throw(2),this._skip(3),H.ssx>P&&(P=H.ssx),H.ssy>k&&(k=H.ssy);this._componentCount==1&&(H=this._components[0],H.ssx=H.ssy=P=k=1),this._macroBlockSizeX=P<<3,this._macroBlockSizeY=k<<3,this._widthInMacroBlocks=(this._width+this._macroBlockSizeX-1)/this._macroBlockSizeX|0,this._heightInMacroBlocks=(this._height+this._macroBlockSizeY-1)/this._macroBlockSizeY|0;for(let L=0;L<this._componentCount;L=L+1)H=this._components[L],H.width=(this._width*H.ssx+P-1)/P|0,H.height=(this._height*H.ssy+k-1)/k|0,H.stride=this._widthInMacroBlocks*this._macroBlockSizeX*H.ssx/P|0,(H.width<3&&H.ssx!=P||H.height<3&&H.ssy!=k)&&this._throw(2),H.pixels=new Uint8Array(H.stride*(this._heightInMacroBlocks*this._macroBlockSizeY*H.ssy/k|0));this._rgb=new Uint8Array(this._width*this._height*3),this._skip(this._length)}_decodeDHT(){for(this._decodeLength();this._length>=17;){let P=this._bytes[this._offset];P&236&&this._throw(3),P&2&&this._throw(2),P=(P|P>>3)&3;let k=new Uint8Array(16);for(let M=1;M<=16;M=M+1)k[M-1]=this._bytes[this._offset+M];this._skip(17);let H=this._huffmanTable[P],L=0,Q=65536,X=65536;for(let M=1;M<=16;M=M+1){X>>=1;let te=k[M-1];if(te!=0){this._length<te&&this._throw(3),Q=Q-(te<<16-M),Q<0&&this._throw(3);for(let J=0;J<te;J=J+1){let oe=this._bytes[this._offset+J];for(let le=X;le!=0;le=le-1)L<65536&&(H[L]=M<<8|oe,L=L+1)}this._skip(te)}}for(;Q!=0;)Q=Q-1,L<65536&&(H[L]=H[L]&65280,L=L+1)}this._length!=0&&this._throw(3)}_decodeDQT(){for(this._decodeLength();this._length>=65;){let P=this._bytes[this._offset];P&252&&this._throw(3);let k=this._quantizationTable[P];for(let H=0;H<64;H=H+1)k[H]=this._bytes[this._offset+H+1];this._skip(65)}this._length!=0&&this._throw(3)}_decodeDRI(){this._decodeLength(),this._length<2&&this._throw(3),this._restartInterval=this._decodeBig16(this._offset),this._skip(this._length)}_getVLC(P){let k=this._showBits(16),H=P[k]>>8;return H==0&&this._throw(3),this._skipBits(H),k=P[k]&255,this._getVLC_code=k,H=k&15,H==0?0:(k=this._getBits(H),k<1<<H-1&&(k=k+((-1<<H)+1)),k)}_decodeBlock(P,k){let H=0;for(this._block=new Int32Array(64),P.dcPred=P.dcPred+this._getVLC(this._huffmanTable[P.dcTableIndex]),this._block[0]=P.dcPred*this._quantizationTable[P.quantizationTableIndex][0];H<63;){let L=this._getVLC(this._huffmanTable[P.acTableIndex]);if(this._getVLC_code==0)break;!(this._getVLC_code&15)&&this._getVLC_code!=240&&this._throw(3),H=H+((this._getVLC_code>>4)+1),H>63&&this._throw(3),this._block[K._zigZagTable[H]]=L*this._quantizationTable[P.quantizationTableIndex][H]}for(let L=0;L<64;L=L+8)t(this._block,L);for(let L=0;L<8;L=L+1)n(this._block,L,P.pixels,k+L,P.stride)}_decodeScan(){let P=this._restartInterval,k=0;this._decodeLength(),this._length<4+2*this._componentCount&&this._throw(3),this._bytes[this._offset]!=this._componentCount&&this._throw(2),this._skip(1);for(let H=0;H<this._componentCount;H=H+1){let L=this._components[H];this._bytes[this._offset]!=L.id&&this._throw(3),this._bytes[this._offset+1]&238&&this._throw(3),L.dcTableIndex=this._bytes[this._offset+1]>>4,L.acTableIndex=this._bytes[this._offset+1]&1|2,this._skip(2)}(this._bytes[this._offset]!=0||this._bytes[this._offset+1]!=63||this._bytes[this._offset+2]!=0)&&this._throw(2),this._skip(this._length);for(let H=0;H<this._heightInMacroBlocks;H=H+1)for(let L=0;L<this._widthInMacroBlocks;L=L+1){if((L!=0||H!=0)&&this._restartInterval!=0&&(P=P-1,P==0)){this._byteAlign();let Q=this._getBits(16);((Q&65528)!=65488||(Q&7)!=k)&&this._throw(3),k=k+1&7,P=this._restartInterval;for(let X=0;X<4;X=X+1)this._components[X].dcPred=0}for(let Q=0;Q<this._componentCount;Q=Q+1){let X=this._components[Q];for(let M=0;M<X.ssy;M=M+1)for(let te=0;te<X.ssx;te=te+1)this._decodeBlock(X,(H*X.ssy+M)*X.stride+L*X.ssx+te<<3)}}this._error=4}_decodeEXIF(){if(this._decodeLength(),this._length<6||this._decodeBig32(this._offset)!=1165519206||this._decodeBig16(this._offset+4)!=0){this._skip(this._length);return}this._skip(6);let P=this._offset;this._length<8&&this._throw(3);let k=this._decodeBig32(P),H=k==1229531648?l.Endianness.LITTLE:l.Endianness.BIG;H==l.Endianness.BIG&&k!=1296891946&&this._throw(3);let L=274,Q=1,X=3,M=4,te=9,J=P+this._decode32(P+4,H),oe=this._decode16(J,H);J=J+2;for(let le=0,tt=oe;le<tt;le=le+1){let nt=this._decode16(J,H),At=this._decode16(J+2,H),Lt=this._decode32(J+4,H);if(J=J+8,nt==L&&Lt==1){this._exifOrientation=0,At==Q?this._exifOrientation=this._bytes[J]:At==X?this._exifOrientation=this._decode16(J,H):(At==M||At==te)&&(this._exifOrientation=this._decode32(J,H)),(this._exifOrientation<1||this._exifOrientation>8)&&(this._exifOrientation=1);break}J=J+4}this._skip(this._length)}_convert(){for(let H=0;H<this._componentCount;H=H+1){let L=this._components[H];for(;L.width<this._width||L.height<this._height;)L.width<this._width&&L.upsampleH(),L.height<this._height&&L.upsampleV()}let P=this._components[0],k=this._rgb;if(this._componentCount==1){let H=0,L=0;for(let Q=this._height;Q!=0;Q=Q-1){for(let X=0;X<this._width;X=X+1){let M=P.pixels[L+X];k[H]=M,k[H+1]=M,k[H+2]=M,H=H+3}L=L+P.stride}}else{let H=this._components[1],L=this._components[2],Q=0,X=0,M=0,te=0;for(let J=this._height;J!=0;J=J-1){for(let oe=0;oe<this._width;oe=oe+1){let le=P.pixels[X+oe]<<8,tt=H.pixels[M+oe]-128,nt=L.pixels[te+oe]-128;k[Q]=i(le+359*nt+128>>8),k[Q+1]=i(le-88*tt-183*nt+128>>8),k[Q+2]=i(le+454*tt+128>>8),Q=Q+3}X=X+P.stride,M=M+H.stride,te=te+L.stride}}}_orient(){if(this._exifOrientation==1)return;let P=this._width,k=this._height,H=this._exifOrientation>=5,L=H?k:P,Q=H?P:k,X=this._rgb,M=new Uint8Array(L*Q*3);for(let te=0,J=0;te<k;te=te+1){let oe=0,le=0;switch(this._exifOrientation){case 2:{oe=te*L+L-1,le=-1;break}case 3:{oe=(k-te-1)*L+L-1,le=-1;break}case 4:{oe=(k-te-1)*L,le=1;break}case 5:{oe=te,le=L;break}case 6:{oe=k-te-1,le=L;break}case 7:{oe=k-te-1+L*(Q-1),le=-L;break}case 8:{oe=te+L*(Q-1),le=-L;break}}oe=oe*3,le=le*3;for(let tt=0;tt<P;tt=tt+1,J=J+3)M[oe]=X[J],M[oe+1]=X[J+1],M[oe+2]=X[J+2],oe=oe+le}this._width=L,this._height=Q,this._rgb=M}decodeBytes(P){try{for(this._bytes=P,this._offset=0,this._size=P.length,(this._size<2||this._bytes[0]!=255||this._bytes[1]!=216)&&this._throw(1),this._skip(2);this._error==0;){(this._size<2||this._bytes[this._offset]!=255)&&this._throw(3),this._skip(2);let k=this._bytes[this._offset-1];k==192?this._decodeSOF():k==196?this._decodeDHT():k==219?this._decodeDQT():k==221?this._decodeDRI():k==218?this._decodeScan():k==225?this._decodeEXIF():k==254?this._skipMarker():(k&240)==224?this._skipMarker():this._throw(2)}this._error!=4?this._error=3:(this._convert(),this._orient(),this._error=0)}catch{}return this._error}width(){return this._width}height(){return this._height}rgb(){return this._rgb}}K.Decoder=l,(k=>{let F;(Q=>(Q[Q.BIG=0]="BIG",Q[Q.LITTLE=1]="LITTLE"))(F=k.Endianness||(k.Endianness={}));let P;(L=>{function H(Q){return k.Endianness[Q]}L.Endianness_toString=H})(P=k.in_Endianness||(k.in_Endianness={}))})(l=K.Decoder||(K.Decoder={}));let d;(P=>{function F(k){return r[k]}P.Result_toString=F})(d=K.in_Result||(K.in_Result={}));let c;(P=>{function F(k){return s[k]}P.Orientation_toString=F})(c=K.in_Orientation||(K.in_Orientation={})),K._zigZagTable=[0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63],K._W1=2841,K._W2=2676,K._W3=2408,K._W5=1609,K._W6=1108,K._W7=565,K._CF4A=-9,K._CF4B=111,K._CF4C=29,K._CF4D=-3,K._CF3A=28,K._CF3B=109,K._CF3C=-9,K._CF3X=104,K._CF3Y=27,K._CF3Z=-3,K._CF2A=139,K._CF2B=-11})(Ql||(Ql={}));var zh;(e=>{function i(t,n){let r=Array.from(t);return On(r,Array.from(n)),new Uint8Array(r)}e.concat=i})(zh||(zh={}));var w_;(e=>{function i(t,n){if(t.byteLength!=n.byteLength)return!1;for(let r=0,o=t.byteLength;r<o;r=r+1)if(t[r]!=n[r])return!1;return!0}e.Uint8Array_equals=i})(w_||(w_={}));var Yd;(e=>{function i(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}e.DataView_new1=i})(Yd||(Yd={}));function ks(i){let e=i.length;for(;--e>=0;)i[e]=0}var Fv=0,gA=1,Dv=2,Lv=3,Mv=258,hm=29,ac=256,Zl=ac+1+hm,Ms=30,mm=19,fA=2*Zl+1,Ja=15,Wh=16,Bv=7,gm=256,_A=16,AA=17,SA=18,om=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),eu=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),Vv=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),yA=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),kv=512,Ui=new Array((Zl+2)*2);ks(Ui);var Xl=new Array(Ms*2);ks(Xl);var $l=new Array(kv);ks($l);var ec=new Array(Mv-Lv+1);ks(ec);var fm=new Array(hm);ks(fm);var tu=new Array(Ms);ks(tu);function Qh(i,e,t,n,r){this.static_tree=i,this.extra_bits=e,this.extra_base=t,this.elems=n,this.max_length=r,this.has_stree=i&&i.length}var bA,TA,vA;function Kh(i,e){this.dyn_tree=i,this.max_code=0,this.stat_desc=e}var IA=i=>i<256?$l[i]:$l[256+(i>>>7)],tc=(i,e)=>{i.pending_buf[i.pending++]=e&255,i.pending_buf[i.pending++]=e>>>8&255},oo=(i,e,t)=>{i.bi_valid>Wh-t?(i.bi_buf|=e<<i.bi_valid&65535,tc(i,i.bi_buf),i.bi_buf=e>>Wh-i.bi_valid,i.bi_valid+=t-Wh):(i.bi_buf|=e<<i.bi_valid&65535,i.bi_valid+=t)},_i=(i,e,t)=>{oo(i,t[e*2],t[e*2+1])},EA=(i,e)=>{let t=0;do t|=i&1,i>>>=1,t<<=1;while(--e>0);return t>>>1},Uv=i=>{i.bi_valid===16?(tc(i,i.bi_buf),i.bi_buf=0,i.bi_valid=0):i.bi_valid>=8&&(i.pending_buf[i.pending++]=i.bi_buf&255,i.bi_buf>>=8,i.bi_valid-=8)},Gv=(i,e)=>{let t=e.dyn_tree,n=e.max_code,r=e.stat_desc.static_tree,o=e.stat_desc.has_stree,a=e.stat_desc.extra_bits,s=e.stat_desc.extra_base,l=e.stat_desc.max_length,d,c,p,u,h,f,y=0;for(u=0;u<=Ja;u++)i.bl_count[u]=0;for(t[i.heap[i.heap_max]*2+1]=0,d=i.heap_max+1;d<fA;d++)c=i.heap[d],u=t[t[c*2+1]*2+1]+1,u>l&&(u=l,y++),t[c*2+1]=u,!(c>n)&&(i.bl_count[u]++,h=0,c>=s&&(h=a[c-s]),f=t[c*2],i.opt_len+=f*(u+h),o&&(i.static_len+=f*(r[c*2+1]+h)));if(y!==0){do{for(u=l-1;i.bl_count[u]===0;)u--;i.bl_count[u]--,i.bl_count[u+1]+=2,i.bl_count[l]--,y-=2}while(y>0);for(u=l;u!==0;u--)for(c=i.bl_count[u];c!==0;)p=i.heap[--d],!(p>n)&&(t[p*2+1]!==u&&(i.opt_len+=(u-t[p*2+1])*t[p*2],t[p*2+1]=u),c--)}},CA=(i,e,t)=>{let n=new Array(Ja+1),r=0,o,a;for(o=1;o<=Ja;o++)r=r+t[o-1]<<1,n[o]=r;for(a=0;a<=e;a++){let s=i[a*2+1];s!==0&&(i[a*2]=EA(n[s]++,s))}},Hv=()=>{let i,e,t,n,r,o=new Array(Ja+1);for(t=0,n=0;n<hm-1;n++)for(fm[n]=t,i=0;i<1<<om[n];i++)ec[t++]=n;for(ec[t-1]=n,r=0,n=0;n<16;n++)for(tu[n]=r,i=0;i<1<<eu[n];i++)$l[r++]=n;for(r>>=7;n<Ms;n++)for(tu[n]=r<<7,i=0;i<1<<eu[n]-7;i++)$l[256+r++]=n;for(e=0;e<=Ja;e++)o[e]=0;for(i=0;i<=143;)Ui[i*2+1]=8,i++,o[8]++;for(;i<=255;)Ui[i*2+1]=9,i++,o[9]++;for(;i<=279;)Ui[i*2+1]=7,i++,o[7]++;for(;i<=287;)Ui[i*2+1]=8,i++,o[8]++;for(CA(Ui,Zl+1,o),i=0;i<Ms;i++)Xl[i*2+1]=5,Xl[i*2]=EA(i,5);bA=new Qh(Ui,om,ac+1,Zl,Ja),TA=new Qh(Xl,eu,0,Ms,Ja),vA=new Qh(new Array(0),Vv,0,mm,Bv)},RA=i=>{let e;for(e=0;e<Zl;e++)i.dyn_ltree[e*2]=0;for(e=0;e<Ms;e++)i.dyn_dtree[e*2]=0;for(e=0;e<mm;e++)i.bl_tree[e*2]=0;i.dyn_ltree[gm*2]=1,i.opt_len=i.static_len=0,i.sym_next=i.matches=0},NA=i=>{i.bi_valid>8?tc(i,i.bi_buf):i.bi_valid>0&&(i.pending_buf[i.pending++]=i.bi_buf),i.bi_buf=0,i.bi_valid=0},x_=(i,e,t,n)=>{let r=e*2,o=t*2;return i[r]<i[o]||i[r]===i[o]&&n[e]<=n[t]},qh=(i,e,t)=>{let n=i.heap[t],r=t<<1;for(;r<=i.heap_len&&(r<i.heap_len&&x_(e,i.heap[r+1],i.heap[r],i.depth)&&r++,!x_(e,n,i.heap[r],i.depth));)i.heap[t]=i.heap[r],t=r,r<<=1;i.heap[t]=n},P_=(i,e,t)=>{let n,r,o=0,a,s;if(i.sym_next!==0)do n=i.pending_buf[i.sym_buf+o++]&255,n+=(i.pending_buf[i.sym_buf+o++]&255)<<8,r=i.pending_buf[i.sym_buf+o++],n===0?_i(i,r,e):(a=ec[r],_i(i,a+ac+1,e),s=om[a],s!==0&&(r-=fm[a],oo(i,r,s)),n--,a=IA(n),_i(i,a,t),s=eu[a],s!==0&&(n-=tu[a],oo(i,n,s)));while(o<i.sym_next);_i(i,gm,e)},im=(i,e)=>{let t=e.dyn_tree,n=e.stat_desc.static_tree,r=e.stat_desc.has_stree,o=e.stat_desc.elems,a,s,l=-1,d;for(i.heap_len=0,i.heap_max=fA,a=0;a<o;a++)t[a*2]!==0?(i.heap[++i.heap_len]=l=a,i.depth[a]=0):t[a*2+1]=0;for(;i.heap_len<2;)d=i.heap[++i.heap_len]=l<2?++l:0,t[d*2]=1,i.depth[d]=0,i.opt_len--,r&&(i.static_len-=n[d*2+1]);for(e.max_code=l,a=i.heap_len>>1;a>=1;a--)qh(i,t,a);d=o;do a=i.heap[1],i.heap[1]=i.heap[i.heap_len--],qh(i,t,1),s=i.heap[1],i.heap[--i.heap_max]=a,i.heap[--i.heap_max]=s,t[d*2]=t[a*2]+t[s*2],i.depth[d]=(i.depth[a]>=i.depth[s]?i.depth[a]:i.depth[s])+1,t[a*2+1]=t[s*2+1]=d,i.heap[1]=d++,qh(i,t,1);while(i.heap_len>=2);i.heap[--i.heap_max]=i.heap[1],Gv(i,e),CA(t,l,i.bl_count)},F_=(i,e,t)=>{let n,r=-1,o,a=e[0*2+1],s=0,l=7,d=4;for(a===0&&(l=138,d=3),e[(t+1)*2+1]=65535,n=0;n<=t;n++)o=a,a=e[(n+1)*2+1],!(++s<l&&o===a)&&(s<d?i.bl_tree[o*2]+=s:o!==0?(o!==r&&i.bl_tree[o*2]++,i.bl_tree[_A*2]++):s<=10?i.bl_tree[AA*2]++:i.bl_tree[SA*2]++,s=0,r=o,a===0?(l=138,d=3):o===a?(l=6,d=3):(l=7,d=4))},D_=(i,e,t)=>{let n,r=-1,o,a=e[0*2+1],s=0,l=7,d=4;for(a===0&&(l=138,d=3),n=0;n<=t;n++)if(o=a,a=e[(n+1)*2+1],!(++s<l&&o===a)){if(s<d)do _i(i,o,i.bl_tree);while(--s!==0);else o!==0?(o!==r&&(_i(i,o,i.bl_tree),s--),_i(i,_A,i.bl_tree),oo(i,s-3,2)):s<=10?(_i(i,AA,i.bl_tree),oo(i,s-3,3)):(_i(i,SA,i.bl_tree),oo(i,s-11,7));s=0,r=o,a===0?(l=138,d=3):o===a?(l=6,d=3):(l=7,d=4)}},zv=i=>{let e;for(F_(i,i.dyn_ltree,i.l_desc.max_code),F_(i,i.dyn_dtree,i.d_desc.max_code),im(i,i.bl_desc),e=mm-1;e>=3&&i.bl_tree[yA[e]*2+1]===0;e--);return i.opt_len+=3*(e+1)+5+5+4,e},Wv=(i,e,t,n)=>{let r;for(oo(i,e-257,5),oo(i,t-1,5),oo(i,n-4,4),r=0;r<n;r++)oo(i,i.bl_tree[yA[r]*2+1],3);D_(i,i.dyn_ltree,e-1),D_(i,i.dyn_dtree,t-1)},Qv=i=>{let e=4093624447,t;for(t=0;t<=31;t++,e>>>=1)if(e&1&&i.dyn_ltree[t*2]!==0)return 0;if(i.dyn_ltree[9*2]!==0||i.dyn_ltree[10*2]!==0||i.dyn_ltree[13*2]!==0)return 1;for(t=32;t<ac;t++)if(i.dyn_ltree[t*2]!==0)return 1;return 0},L_=!1,Kv=i=>{L_||(Hv(),L_=!0),i.l_desc=new Kh(i.dyn_ltree,bA),i.d_desc=new Kh(i.dyn_dtree,TA),i.bl_desc=new Kh(i.bl_tree,vA),i.bi_buf=0,i.bi_valid=0,RA(i)},OA=(i,e,t,n)=>{oo(i,(Fv<<1)+(n?1:0),3),NA(i),tc(i,t),tc(i,~t),t&&i.pending_buf.set(i.window.subarray(e,e+t),i.pending),i.pending+=t},qv=i=>{oo(i,gA<<1,3),_i(i,gm,Ui),Uv(i)},Yv=(i,e,t,n)=>{let r,o,a=0;i.level>0?(i.strm.data_type===2&&(i.strm.data_type=Qv(i)),im(i,i.l_desc),im(i,i.d_desc),a=zv(i),r=i.opt_len+3+7>>>3,o=i.static_len+3+7>>>3,o<=r&&(r=o)):r=o=t+5,t+4<=r&&e!==-1?OA(i,e,t,n):i.strategy===4||o===r?(oo(i,(gA<<1)+(n?1:0),3),P_(i,Ui,Xl)):(oo(i,(Dv<<1)+(n?1:0),3),Wv(i,i.l_desc.max_code+1,i.d_desc.max_code+1,a+1),P_(i,i.dyn_ltree,i.dyn_dtree)),RA(i),n&&NA(i)},Xv=(i,e,t)=>(i.pending_buf[i.sym_buf+i.sym_next++]=e,i.pending_buf[i.sym_buf+i.sym_next++]=e>>8,i.pending_buf[i.sym_buf+i.sym_next++]=t,e===0?i.dyn_ltree[t*2]++:(i.matches++,e--,i.dyn_ltree[(ec[t]+ac+1)*2]++,i.dyn_dtree[IA(e)*2]++),i.sym_next===i.sym_end),Jv=Kv,jv=OA,Zv=Yv,$v=Xv,eI=qv,tI={_tr_init:Jv,_tr_stored_block:jv,_tr_flush_block:Zv,_tr_tally:$v,_tr_align:eI},nI=(i,e,t,n)=>{let r=i&65535|0,o=i>>>16&65535|0,a=0;for(;t!==0;){a=t>2e3?2e3:t,t-=a;do r=r+e[n++]|0,o=o+r|0;while(--a);r%=65521,o%=65521}return r|o<<16|0},nc=nI,rI=()=>{let i,e=[];for(var t=0;t<256;t++){i=t;for(var n=0;n<8;n++)i=i&1?3988292384^i>>>1:i>>>1;e[t]=i}return e},oI=new Uint32Array(rI()),iI=(i,e,t,n)=>{let r=oI,o=n+t;i^=-1;for(let a=n;a<o;a++)i=i>>>8^r[(i^e[a])&255];return i^-1},fr=iI,$a={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Us={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8},{_tr_init:aI,_tr_stored_block:am,_tr_flush_block:sI,_tr_tally:pa,_tr_align:lI}=tI,{Z_NO_FLUSH:ha,Z_PARTIAL_FLUSH:cI,Z_FULL_FLUSH:dI,Z_FINISH:Ho,Z_BLOCK:M_,Z_OK:Er,Z_STREAM_END:B_,Z_STREAM_ERROR:Ai,Z_DATA_ERROR:uI,Z_BUF_ERROR:Yh,Z_DEFAULT_COMPRESSION:pI,Z_FILTERED:hI,Z_HUFFMAN_ONLY:Xd,Z_RLE:mI,Z_FIXED:gI,Z_DEFAULT_STRATEGY:fI,Z_UNKNOWN:_I,Z_DEFLATED:ou}=Us,AI=9,SI=15,yI=8,bI=29,TI=256,sm=TI+1+bI,vI=30,II=19,EI=2*sm+1,CI=15,zt=3,ua=258,Si=ua+zt+1,RI=32,Bs=42,_m=57,lm=69,cm=73,dm=91,um=103,ja=113,ql=666,qr=1,Gs=2,es=3,Hs=4,NI=3,Za=(i,e)=>(i.msg=$a[e],e),V_=i=>i*2-(i>4?9:0),da=i=>{let e=i.length;for(;--e>=0;)i[e]=0},OI=i=>{let e,t,n,r=i.w_size;e=i.hash_size,n=e;do t=i.head[--n],i.head[n]=t>=r?t-r:0;while(--e);e=r,n=e;do t=i.prev[--n],i.prev[n]=t>=r?t-r:0;while(--e)},wI=(i,e,t)=>(e<<i.hash_shift^t)&i.hash_mask,ma=wI,vo=i=>{let e=i.state,t=e.pending;t>i.avail_out&&(t=i.avail_out),t!==0&&(i.output.set(e.pending_buf.subarray(e.pending_out,e.pending_out+t),i.next_out),i.next_out+=t,e.pending_out+=t,i.total_out+=t,i.avail_out-=t,e.pending-=t,e.pending===0&&(e.pending_out=0))},Io=(i,e)=>{sI(i,i.block_start>=0?i.block_start:-1,i.strstart-i.block_start,e),i.block_start=i.strstart,vo(i.strm)},an=(i,e)=>{i.pending_buf[i.pending++]=e},Kl=(i,e)=>{i.pending_buf[i.pending++]=e>>>8&255,i.pending_buf[i.pending++]=e&255},pm=(i,e,t,n)=>{let r=i.avail_in;return r>n&&(r=n),r===0?0:(i.avail_in-=r,e.set(i.input.subarray(i.next_in,i.next_in+r),t),i.state.wrap===1?i.adler=nc(i.adler,e,r,t):i.state.wrap===2&&(i.adler=fr(i.adler,e,r,t)),i.next_in+=r,i.total_in+=r,r)},wA=(i,e)=>{let t=i.max_chain_length,n=i.strstart,r,o,a=i.prev_length,s=i.nice_match,l=i.strstart>i.w_size-Si?i.strstart-(i.w_size-Si):0,d=i.window,c=i.w_mask,p=i.prev,u=i.strstart+ua,h=d[n+a-1],f=d[n+a];i.prev_length>=i.good_match&&(t>>=2),s>i.lookahead&&(s=i.lookahead);do if(r=e,!(d[r+a]!==f||d[r+a-1]!==h||d[r]!==d[n]||d[++r]!==d[n+1])){n+=2,r++;do;while(d[++n]===d[++r]&&d[++n]===d[++r]&&d[++n]===d[++r]&&d[++n]===d[++r]&&d[++n]===d[++r]&&d[++n]===d[++r]&&d[++n]===d[++r]&&d[++n]===d[++r]&&n<u);if(o=ua-(u-n),n=u-ua,o>a){if(i.match_start=e,a=o,o>=s)break;h=d[n+a-1],f=d[n+a]}}while((e=p[e&c])>l&&--t!==0);return a<=i.lookahead?a:i.lookahead},Vs=i=>{let e=i.w_size,t,n,r;do{if(n=i.window_size-i.lookahead-i.strstart,i.strstart>=e+(e-Si)&&(i.window.set(i.window.subarray(e,e+e-n),0),i.match_start-=e,i.strstart-=e,i.block_start-=e,i.insert>i.strstart&&(i.insert=i.strstart),OI(i),n+=e),i.strm.avail_in===0)break;if(t=pm(i.strm,i.window,i.strstart+i.lookahead,n),i.lookahead+=t,i.lookahead+i.insert>=zt)for(r=i.strstart-i.insert,i.ins_h=i.window[r],i.ins_h=ma(i,i.ins_h,i.window[r+1]);i.insert&&(i.ins_h=ma(i,i.ins_h,i.window[r+zt-1]),i.prev[r&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=r,r++,i.insert--,!(i.lookahead+i.insert<zt)););}while(i.lookahead<Si&&i.strm.avail_in!==0)},xA=(i,e)=>{let t=i.pending_buf_size-5>i.w_size?i.w_size:i.pending_buf_size-5,n,r,o,a=0,s=i.strm.avail_in;do{if(n=65535,o=i.bi_valid+42>>3,i.strm.avail_out<o||(o=i.strm.avail_out-o,r=i.strstart-i.block_start,n>r+i.strm.avail_in&&(n=r+i.strm.avail_in),n>o&&(n=o),n<t&&(n===0&&e!==Ho||e===ha||n!==r+i.strm.avail_in)))break;a=e===Ho&&n===r+i.strm.avail_in?1:0,am(i,0,0,a),i.pending_buf[i.pending-4]=n,i.pending_buf[i.pending-3]=n>>8,i.pending_buf[i.pending-2]=~n,i.pending_buf[i.pending-1]=~n>>8,vo(i.strm),r&&(r>n&&(r=n),i.strm.output.set(i.window.subarray(i.block_start,i.block_start+r),i.strm.next_out),i.strm.next_out+=r,i.strm.avail_out-=r,i.strm.total_out+=r,i.block_start+=r,n-=r),n&&(pm(i.strm,i.strm.output,i.strm.next_out,n),i.strm.next_out+=n,i.strm.avail_out-=n,i.strm.total_out+=n)}while(a===0);return s-=i.strm.avail_in,s&&(s>=i.w_size?(i.matches=2,i.window.set(i.strm.input.subarray(i.strm.next_in-i.w_size,i.strm.next_in),0),i.strstart=i.w_size,i.insert=i.strstart):(i.window_size-i.strstart<=s&&(i.strstart-=i.w_size,i.window.set(i.window.subarray(i.w_size,i.w_size+i.strstart),0),i.matches<2&&i.matches++,i.insert>i.strstart&&(i.insert=i.strstart)),i.window.set(i.strm.input.subarray(i.strm.next_in-s,i.strm.next_in),i.strstart),i.strstart+=s,i.insert+=s>i.w_size-i.insert?i.w_size-i.insert:s),i.block_start=i.strstart),i.high_water<i.strstart&&(i.high_water=i.strstart),a?Hs:e!==ha&&e!==Ho&&i.strm.avail_in===0&&i.strstart===i.block_start?Gs:(o=i.window_size-i.strstart,i.strm.avail_in>o&&i.block_start>=i.w_size&&(i.block_start-=i.w_size,i.strstart-=i.w_size,i.window.set(i.window.subarray(i.w_size,i.w_size+i.strstart),0),i.matches<2&&i.matches++,o+=i.w_size,i.insert>i.strstart&&(i.insert=i.strstart)),o>i.strm.avail_in&&(o=i.strm.avail_in),o&&(pm(i.strm,i.window,i.strstart,o),i.strstart+=o,i.insert+=o>i.w_size-i.insert?i.w_size-i.insert:o),i.high_water<i.strstart&&(i.high_water=i.strstart),o=i.bi_valid+42>>3,o=i.pending_buf_size-o>65535?65535:i.pending_buf_size-o,t=o>i.w_size?i.w_size:o,r=i.strstart-i.block_start,(r>=t||(r||e===Ho)&&e!==ha&&i.strm.avail_in===0&&r<=o)&&(n=r>o?o:r,a=e===Ho&&i.strm.avail_in===0&&n===r?1:0,am(i,i.block_start,n,a),i.block_start+=n,vo(i.strm)),a?es:qr)},Xh=(i,e)=>{let t,n;for(;;){if(i.lookahead<Si){if(Vs(i),i.lookahead<Si&&e===ha)return qr;if(i.lookahead===0)break}if(t=0,i.lookahead>=zt&&(i.ins_h=ma(i,i.ins_h,i.window[i.strstart+zt-1]),t=i.prev[i.strstart&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=i.strstart),t!==0&&i.strstart-t<=i.w_size-Si&&(i.match_length=wA(i,t)),i.match_length>=zt)if(n=pa(i,i.strstart-i.match_start,i.match_length-zt),i.lookahead-=i.match_length,i.match_length<=i.max_lazy_match&&i.lookahead>=zt){i.match_length--;do i.strstart++,i.ins_h=ma(i,i.ins_h,i.window[i.strstart+zt-1]),t=i.prev[i.strstart&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=i.strstart;while(--i.match_length!==0);i.strstart++}else i.strstart+=i.match_length,i.match_length=0,i.ins_h=i.window[i.strstart],i.ins_h=ma(i,i.ins_h,i.window[i.strstart+1]);else n=pa(i,0,i.window[i.strstart]),i.lookahead--,i.strstart++;if(n&&(Io(i,!1),i.strm.avail_out===0))return qr}return i.insert=i.strstart<zt-1?i.strstart:zt-1,e===Ho?(Io(i,!0),i.strm.avail_out===0?es:Hs):i.sym_next&&(Io(i,!1),i.strm.avail_out===0)?qr:Gs},Ds=(i,e)=>{let t,n,r;for(;;){if(i.lookahead<Si){if(Vs(i),i.lookahead<Si&&e===ha)return qr;if(i.lookahead===0)break}if(t=0,i.lookahead>=zt&&(i.ins_h=ma(i,i.ins_h,i.window[i.strstart+zt-1]),t=i.prev[i.strstart&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=i.strstart),i.prev_length=i.match_length,i.prev_match=i.match_start,i.match_length=zt-1,t!==0&&i.prev_length<i.max_lazy_match&&i.strstart-t<=i.w_size-Si&&(i.match_length=wA(i,t),i.match_length<=5&&(i.strategy===hI||i.match_length===zt&&i.strstart-i.match_start>4096)&&(i.match_length=zt-1)),i.prev_length>=zt&&i.match_length<=i.prev_length){r=i.strstart+i.lookahead-zt,n=pa(i,i.strstart-1-i.prev_match,i.prev_length-zt),i.lookahead-=i.prev_length-1,i.prev_length-=2;do++i.strstart<=r&&(i.ins_h=ma(i,i.ins_h,i.window[i.strstart+zt-1]),t=i.prev[i.strstart&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=i.strstart);while(--i.prev_length!==0);if(i.match_available=0,i.match_length=zt-1,i.strstart++,n&&(Io(i,!1),i.strm.avail_out===0))return qr}else if(i.match_available){if(n=pa(i,0,i.window[i.strstart-1]),n&&Io(i,!1),i.strstart++,i.lookahead--,i.strm.avail_out===0)return qr}else i.match_available=1,i.strstart++,i.lookahead--}return i.match_available&&(n=pa(i,0,i.window[i.strstart-1]),i.match_available=0),i.insert=i.strstart<zt-1?i.strstart:zt-1,e===Ho?(Io(i,!0),i.strm.avail_out===0?es:Hs):i.sym_next&&(Io(i,!1),i.strm.avail_out===0)?qr:Gs},xI=(i,e)=>{let t,n,r,o,a=i.window;for(;;){if(i.lookahead<=ua){if(Vs(i),i.lookahead<=ua&&e===ha)return qr;if(i.lookahead===0)break}if(i.match_length=0,i.lookahead>=zt&&i.strstart>0&&(r=i.strstart-1,n=a[r],n===a[++r]&&n===a[++r]&&n===a[++r])){o=i.strstart+ua;do;while(n===a[++r]&&n===a[++r]&&n===a[++r]&&n===a[++r]&&n===a[++r]&&n===a[++r]&&n===a[++r]&&n===a[++r]&&r<o);i.match_length=ua-(o-r),i.match_length>i.lookahead&&(i.match_length=i.lookahead)}if(i.match_length>=zt?(t=pa(i,1,i.match_length-zt),i.lookahead-=i.match_length,i.strstart+=i.match_length,i.match_length=0):(t=pa(i,0,i.window[i.strstart]),i.lookahead--,i.strstart++),t&&(Io(i,!1),i.strm.avail_out===0))return qr}return i.insert=0,e===Ho?(Io(i,!0),i.strm.avail_out===0?es:Hs):i.sym_next&&(Io(i,!1),i.strm.avail_out===0)?qr:Gs},PI=(i,e)=>{let t;for(;;){if(i.lookahead===0&&(Vs(i),i.lookahead===0)){if(e===ha)return qr;break}if(i.match_length=0,t=pa(i,0,i.window[i.strstart]),i.lookahead--,i.strstart++,t&&(Io(i,!1),i.strm.avail_out===0))return qr}return i.insert=0,e===Ho?(Io(i,!0),i.strm.avail_out===0?es:Hs):i.sym_next&&(Io(i,!1),i.strm.avail_out===0)?qr:Gs};function fi(i,e,t,n,r){this.good_length=i,this.max_lazy=e,this.nice_length=t,this.max_chain=n,this.func=r}var Yl=[new fi(0,0,0,0,xA),new fi(4,4,8,4,Xh),new fi(4,5,16,8,Xh),new fi(4,6,32,32,Xh),new fi(4,4,16,16,Ds),new fi(8,16,32,32,Ds),new fi(8,16,128,128,Ds),new fi(8,32,128,256,Ds),new fi(32,128,258,1024,Ds),new fi(32,258,258,4096,Ds)],FI=i=>{i.window_size=2*i.w_size,da(i.head),i.max_lazy_match=Yl[i.level].max_lazy,i.good_match=Yl[i.level].good_length,i.nice_match=Yl[i.level].nice_length,i.max_chain_length=Yl[i.level].max_chain,i.strstart=0,i.block_start=0,i.lookahead=0,i.insert=0,i.match_length=i.prev_length=zt-1,i.match_available=0,i.ins_h=0};function DI(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=ou,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(EI*2),this.dyn_dtree=new Uint16Array((2*vI+1)*2),this.bl_tree=new Uint16Array((2*II+1)*2),da(this.dyn_ltree),da(this.dyn_dtree),da(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(CI+1),this.heap=new Uint16Array(2*sm+1),da(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*sm+1),da(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}var sc=i=>{if(!i)return 1;let e=i.state;return!e||e.strm!==i||e.status!==Bs&&e.status!==_m&&e.status!==lm&&e.status!==cm&&e.status!==dm&&e.status!==um&&e.status!==ja&&e.status!==ql?1:0},PA=i=>{if(sc(i))return Za(i,Ai);i.total_in=i.total_out=0,i.data_type=_I;let e=i.state;return e.pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap===2?_m:e.wrap?Bs:ja,i.adler=e.wrap===2?0:1,e.last_flush=-2,aI(e),Er},FA=i=>{let e=PA(i);return e===Er&&FI(i.state),e},LI=(i,e)=>sc(i)||i.state.wrap!==2?Ai:(i.state.gzhead=e,Er),DA=(i,e,t,n,r,o)=>{if(!i)return Ai;let a=1;if(e===pI&&(e=6),n<0?(a=0,n=-n):n>15&&(a=2,n-=16),r<1||r>AI||t!==ou||n<8||n>15||e<0||e>9||o<0||o>gI||n===8&&a!==1)return Za(i,Ai);n===8&&(n=9);let s=new DI;return i.state=s,s.strm=i,s.status=Bs,s.wrap=a,s.gzhead=null,s.w_bits=n,s.w_size=1<<s.w_bits,s.w_mask=s.w_size-1,s.hash_bits=r+7,s.hash_size=1<<s.hash_bits,s.hash_mask=s.hash_size-1,s.hash_shift=~~((s.hash_bits+zt-1)/zt),s.window=new Uint8Array(s.w_size*2),s.head=new Uint16Array(s.hash_size),s.prev=new Uint16Array(s.w_size),s.lit_bufsize=1<<r+6,s.pending_buf_size=s.lit_bufsize*4,s.pending_buf=new Uint8Array(s.pending_buf_size),s.sym_buf=s.lit_bufsize,s.sym_end=(s.lit_bufsize-1)*3,s.level=e,s.strategy=o,s.method=t,FA(i)},MI=(i,e)=>DA(i,e,ou,SI,yI,fI),BI=(i,e)=>{if(sc(i)||e>M_||e<0)return i?Za(i,Ai):Ai;let t=i.state;if(!i.output||i.avail_in!==0&&!i.input||t.status===ql&&e!==Ho)return Za(i,i.avail_out===0?Yh:Ai);let n=t.last_flush;if(t.last_flush=e,t.pending!==0){if(vo(i),i.avail_out===0)return t.last_flush=-1,Er}else if(i.avail_in===0&&V_(e)<=V_(n)&&e!==Ho)return Za(i,Yh);if(t.status===ql&&i.avail_in!==0)return Za(i,Yh);if(t.status===Bs&&t.wrap===0&&(t.status=ja),t.status===Bs){let r=ou+(t.w_bits-8<<4)<<8,o=-1;if(t.strategy>=Xd||t.level<2?o=0:t.level<6?o=1:t.level===6?o=2:o=3,r|=o<<6,t.strstart!==0&&(r|=RI),r+=31-r%31,Kl(t,r),t.strstart!==0&&(Kl(t,i.adler>>>16),Kl(t,i.adler&65535)),i.adler=1,t.status=ja,vo(i),t.pending!==0)return t.last_flush=-1,Er}if(t.status===_m){if(i.adler=0,an(t,31),an(t,139),an(t,8),t.gzhead)an(t,(t.gzhead.text?1:0)+(t.gzhead.hcrc?2:0)+(t.gzhead.extra?4:0)+(t.gzhead.name?8:0)+(t.gzhead.comment?16:0)),an(t,t.gzhead.time&255),an(t,t.gzhead.time>>8&255),an(t,t.gzhead.time>>16&255),an(t,t.gzhead.time>>24&255),an(t,t.level===9?2:t.strategy>=Xd||t.level<2?4:0),an(t,t.gzhead.os&255),t.gzhead.extra&&t.gzhead.extra.length&&(an(t,t.gzhead.extra.length&255),an(t,t.gzhead.extra.length>>8&255)),t.gzhead.hcrc&&(i.adler=fr(i.adler,t.pending_buf,t.pending,0)),t.gzindex=0,t.status=lm;else if(an(t,0),an(t,0),an(t,0),an(t,0),an(t,0),an(t,t.level===9?2:t.strategy>=Xd||t.level<2?4:0),an(t,NI),t.status=ja,vo(i),t.pending!==0)return t.last_flush=-1,Er}if(t.status===lm){if(t.gzhead.extra){let r=t.pending,o=(t.gzhead.extra.length&65535)-t.gzindex;for(;t.pending+o>t.pending_buf_size;){let s=t.pending_buf_size-t.pending;if(t.pending_buf.set(t.gzhead.extra.subarray(t.gzindex,t.gzindex+s),t.pending),t.pending=t.pending_buf_size,t.gzhead.hcrc&&t.pending>r&&(i.adler=fr(i.adler,t.pending_buf,t.pending-r,r)),t.gzindex+=s,vo(i),t.pending!==0)return t.last_flush=-1,Er;r=0,o-=s}let a=new Uint8Array(t.gzhead.extra);t.pending_buf.set(a.subarray(t.gzindex,t.gzindex+o),t.pending),t.pending+=o,t.gzhead.hcrc&&t.pending>r&&(i.adler=fr(i.adler,t.pending_buf,t.pending-r,r)),t.gzindex=0}t.status=cm}if(t.status===cm){if(t.gzhead.name){let r=t.pending,o;do{if(t.pending===t.pending_buf_size){if(t.gzhead.hcrc&&t.pending>r&&(i.adler=fr(i.adler,t.pending_buf,t.pending-r,r)),vo(i),t.pending!==0)return t.last_flush=-1,Er;r=0}t.gzindex<t.gzhead.name.length?o=t.gzhead.name.charCodeAt(t.gzindex++)&255:o=0,an(t,o)}while(o!==0);t.gzhead.hcrc&&t.pending>r&&(i.adler=fr(i.adler,t.pending_buf,t.pending-r,r)),t.gzindex=0}t.status=dm}if(t.status===dm){if(t.gzhead.comment){let r=t.pending,o;do{if(t.pending===t.pending_buf_size){if(t.gzhead.hcrc&&t.pending>r&&(i.adler=fr(i.adler,t.pending_buf,t.pending-r,r)),vo(i),t.pending!==0)return t.last_flush=-1,Er;r=0}t.gzindex<t.gzhead.comment.length?o=t.gzhead.comment.charCodeAt(t.gzindex++)&255:o=0,an(t,o)}while(o!==0);t.gzhead.hcrc&&t.pending>r&&(i.adler=fr(i.adler,t.pending_buf,t.pending-r,r))}t.status=um}if(t.status===um){if(t.gzhead.hcrc){if(t.pending+2>t.pending_buf_size&&(vo(i),t.pending!==0))return t.last_flush=-1,Er;an(t,i.adler&255),an(t,i.adler>>8&255),i.adler=0}if(t.status=ja,vo(i),t.pending!==0)return t.last_flush=-1,Er}if(i.avail_in!==0||t.lookahead!==0||e!==ha&&t.status!==ql){let r=t.level===0?xA(t,e):t.strategy===Xd?PI(t,e):t.strategy===mI?xI(t,e):Yl[t.level].func(t,e);if((r===es||r===Hs)&&(t.status=ql),r===qr||r===es)return i.avail_out===0&&(t.last_flush=-1),Er;if(r===Gs&&(e===cI?lI(t):e!==M_&&(am(t,0,0,!1),e===dI&&(da(t.head),t.lookahead===0&&(t.strstart=0,t.block_start=0,t.insert=0))),vo(i),i.avail_out===0))return t.last_flush=-1,Er}return e!==Ho?Er:t.wrap<=0?B_:(t.wrap===2?(an(t,i.adler&255),an(t,i.adler>>8&255),an(t,i.adler>>16&255),an(t,i.adler>>24&255),an(t,i.total_in&255),an(t,i.total_in>>8&255),an(t,i.total_in>>16&255),an(t,i.total_in>>24&255)):(Kl(t,i.adler>>>16),Kl(t,i.adler&65535)),vo(i),t.wrap>0&&(t.wrap=-t.wrap),t.pending!==0?Er:B_)},VI=i=>{if(sc(i))return Ai;let e=i.state.status;return i.state=null,e===ja?Za(i,uI):Er},kI=(i,e)=>{let t=e.length;if(sc(i))return Ai;let n=i.state,r=n.wrap;if(r===2||r===1&&n.status!==Bs||n.lookahead)return Ai;if(r===1&&(i.adler=nc(i.adler,e,t,0)),n.wrap=0,t>=n.w_size){r===0&&(da(n.head),n.strstart=0,n.block_start=0,n.insert=0);let l=new Uint8Array(n.w_size);l.set(e.subarray(t-n.w_size,t),0),e=l,t=n.w_size}let o=i.avail_in,a=i.next_in,s=i.input;for(i.avail_in=t,i.next_in=0,i.input=e,Vs(n);n.lookahead>=zt;){let l=n.strstart,d=n.lookahead-(zt-1);do n.ins_h=ma(n,n.ins_h,n.window[l+zt-1]),n.prev[l&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=l,l++;while(--d);n.strstart=l,n.lookahead=zt-1,Vs(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=zt-1,n.match_available=0,i.next_in=a,i.input=s,i.avail_in=o,n.wrap=r,Er},UI=MI,GI=DA,HI=FA,zI=PA,WI=LI,QI=BI,KI=VI,qI=kI,YI="pako deflate (from Nodeca project)",Jl={deflateInit:UI,deflateInit2:GI,deflateReset:HI,deflateResetKeep:zI,deflateSetHeader:WI,deflate:QI,deflateEnd:KI,deflateSetDictionary:qI,deflateInfo:YI},XI=(i,e)=>Object.prototype.hasOwnProperty.call(i,e),JI=function(i){let e=Array.prototype.slice.call(arguments,1);for(;e.length;){let t=e.shift();if(t){if(typeof t!="object")throw new TypeError(t+"must be non-object");for(let n in t)XI(t,n)&&(i[n]=t[n])}}return i},jI=i=>{let e=0;for(let n=0,r=i.length;n<r;n++)e+=i[n].length;let t=new Uint8Array(e);for(let n=0,r=0,o=i.length;n<o;n++){let a=i[n];t.set(a,r),r+=a.length}return t},iu={assign:JI,flattenChunks:jI},LA=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{LA=!1}var rc=new Uint8Array(256);for(let i=0;i<256;i++)rc[i]=i>=252?6:i>=248?5:i>=240?4:i>=224?3:i>=192?2:1;rc[254]=rc[254]=1;var ZI=i=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(i);let e,t,n,r,o,a=i.length,s=0;for(r=0;r<a;r++)t=i.charCodeAt(r),(t&64512)===55296&&r+1<a&&(n=i.charCodeAt(r+1),(n&64512)===56320&&(t=65536+(t-55296<<10)+(n-56320),r++)),s+=t<128?1:t<2048?2:t<65536?3:4;for(e=new Uint8Array(s),o=0,r=0;o<s;r++)t=i.charCodeAt(r),(t&64512)===55296&&r+1<a&&(n=i.charCodeAt(r+1),(n&64512)===56320&&(t=65536+(t-55296<<10)+(n-56320),r++)),t<128?e[o++]=t:t<2048?(e[o++]=192|t>>>6,e[o++]=128|t&63):t<65536?(e[o++]=224|t>>>12,e[o++]=128|t>>>6&63,e[o++]=128|t&63):(e[o++]=240|t>>>18,e[o++]=128|t>>>12&63,e[o++]=128|t>>>6&63,e[o++]=128|t&63);return e},$I=(i,e)=>{if(e<65534&&i.subarray&&LA)return String.fromCharCode.apply(null,i.length===e?i:i.subarray(0,e));let t="";for(let n=0;n<e;n++)t+=String.fromCharCode(i[n]);return t},eE=(i,e)=>{let t=e||i.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(i.subarray(0,e));let n,r,o=new Array(t*2);for(r=0,n=0;n<t;){let a=i[n++];if(a<128){o[r++]=a;continue}let s=rc[a];if(s>4){o[r++]=65533,n+=s-1;continue}for(a&=s===2?31:s===3?15:7;s>1&&n<t;)a=a<<6|i[n++]&63,s--;if(s>1){o[r++]=65533;continue}a<65536?o[r++]=a:(a-=65536,o[r++]=55296|a>>10&1023,o[r++]=56320|a&1023)}return $I(o,r)},tE=(i,e)=>{e=e||i.length,e>i.length&&(e=i.length);let t=e-1;for(;t>=0&&(i[t]&192)===128;)t--;return t<0||t===0?e:t+rc[i[t]]>e?t:e},oc={string2buf:ZI,buf2string:eE,utf8border:tE};function nE(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var MA=nE,BA=Object.prototype.toString,{Z_NO_FLUSH:rE,Z_SYNC_FLUSH:oE,Z_FULL_FLUSH:iE,Z_FINISH:aE,Z_OK:nu,Z_STREAM_END:sE,Z_DEFAULT_COMPRESSION:lE,Z_DEFAULT_STRATEGY:cE,Z_DEFLATED:dE}=Us;function lc(i){this.options=iu.assign({level:lE,method:dE,chunkSize:16384,windowBits:15,memLevel:8,strategy:cE},i||{});let e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new MA,this.strm.avail_out=0;let t=Jl.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(t!==nu)throw new Error($a[t]);if(e.header&&Jl.deflateSetHeader(this.strm,e.header),e.dictionary){let n;if(typeof e.dictionary=="string"?n=oc.string2buf(e.dictionary):BA.call(e.dictionary)==="[object ArrayBuffer]"?n=new Uint8Array(e.dictionary):n=e.dictionary,t=Jl.deflateSetDictionary(this.strm,n),t!==nu)throw new Error($a[t]);this._dict_set=!0}}lc.prototype.push=function(i,e){let t=this.strm,n=this.options.chunkSize,r,o;if(this.ended)return!1;for(e===~~e?o=e:o=e===!0?aE:rE,typeof i=="string"?t.input=oc.string2buf(i):BA.call(i)==="[object ArrayBuffer]"?t.input=new Uint8Array(i):t.input=i,t.next_in=0,t.avail_in=t.input.length;;){if(t.avail_out===0&&(t.output=new Uint8Array(n),t.next_out=0,t.avail_out=n),(o===oE||o===iE)&&t.avail_out<=6){this.onData(t.output.subarray(0,t.next_out)),t.avail_out=0;continue}if(r=Jl.deflate(t,o),r===sE)return t.next_out>0&&this.onData(t.output.subarray(0,t.next_out)),r=Jl.deflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===nu;if(t.avail_out===0){this.onData(t.output);continue}if(o>0&&t.next_out>0){this.onData(t.output.subarray(0,t.next_out)),t.avail_out=0;continue}if(t.avail_in===0)break}return!0};lc.prototype.onData=function(i){this.chunks.push(i)};lc.prototype.onEnd=function(i){i===nu&&(this.result=iu.flattenChunks(this.chunks)),this.chunks=[],this.err=i,this.msg=this.strm.msg};function Am(i,e){let t=new lc(e);if(t.push(i,!0),t.err)throw t.msg||$a[t.err];return t.result}function uE(i,e){return e=e||{},e.raw=!0,Am(i,e)}function pE(i,e){return e=e||{},e.gzip=!0,Am(i,e)}var hE=lc,mE=Am,gE=uE,fE=pE,_E=Us,AE={Deflate:hE,deflate:mE,deflateRaw:gE,gzip:fE,constants:_E},Jd=16209,SE=16191,yE=function(e,t){let n,r,o,a,s,l,d,c,p,u,h,f,y,g,A,T,b,_,m,S,v,C,N,x,z=e.state;n=e.next_in,N=e.input,r=n+(e.avail_in-5),o=e.next_out,x=e.output,a=o-(t-e.avail_out),s=o+(e.avail_out-257),l=z.dmax,d=z.wsize,c=z.whave,p=z.wnext,u=z.window,h=z.hold,f=z.bits,y=z.lencode,g=z.distcode,A=(1<<z.lenbits)-1,T=(1<<z.distbits)-1;e:do{f<15&&(h+=N[n++]<<f,f+=8,h+=N[n++]<<f,f+=8),b=y[h&A];t:for(;;){if(_=b>>>24,h>>>=_,f-=_,_=b>>>16&255,_===0)x[o++]=b&65535;else if(_&16){m=b&65535,_&=15,_&&(f<_&&(h+=N[n++]<<f,f+=8),m+=h&(1<<_)-1,h>>>=_,f-=_),f<15&&(h+=N[n++]<<f,f+=8,h+=N[n++]<<f,f+=8),b=g[h&T];n:for(;;){if(_=b>>>24,h>>>=_,f-=_,_=b>>>16&255,_&16){if(S=b&65535,_&=15,f<_&&(h+=N[n++]<<f,f+=8,f<_&&(h+=N[n++]<<f,f+=8)),S+=h&(1<<_)-1,S>l){e.msg="invalid distance too far back",z.mode=Jd;break e}if(h>>>=_,f-=_,_=o-a,S>_){if(_=S-_,_>c&&z.sane){e.msg="invalid distance too far back",z.mode=Jd;break e}if(v=0,C=u,p===0){if(v+=d-_,_<m){m-=_;do x[o++]=u[v++];while(--_);v=o-S,C=x}}else if(p<_){if(v+=d+p-_,_-=p,_<m){m-=_;do x[o++]=u[v++];while(--_);if(v=0,p<m){_=p,m-=_;do x[o++]=u[v++];while(--_);v=o-S,C=x}}}else if(v+=p-_,_<m){m-=_;do x[o++]=u[v++];while(--_);v=o-S,C=x}for(;m>2;)x[o++]=C[v++],x[o++]=C[v++],x[o++]=C[v++],m-=3;m&&(x[o++]=C[v++],m>1&&(x[o++]=C[v++]))}else{v=o-S;do x[o++]=x[v++],x[o++]=x[v++],x[o++]=x[v++],m-=3;while(m>2);m&&(x[o++]=x[v++],m>1&&(x[o++]=x[v++]))}}else if(_&64){e.msg="invalid distance code",z.mode=Jd;break e}else{b=g[(b&65535)+(h&(1<<_)-1)];continue n}break}}else if(_&64)if(_&32){z.mode=SE;break e}else{e.msg="invalid literal/length code",z.mode=Jd;break e}else{b=y[(b&65535)+(h&(1<<_)-1)];continue t}break}}while(n<r&&o<s);m=f>>3,n-=m,f-=m<<3,h&=(1<<f)-1,e.next_in=n,e.next_out=o,e.avail_in=n<r?5+(r-n):5-(n-r),e.avail_out=o<s?257+(s-o):257-(o-s),z.hold=h,z.bits=f},Ls=15,k_=852,U_=592,G_=0,Jh=1,H_=2,bE=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),TE=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),vE=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),IE=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),EE=(i,e,t,n,r,o,a,s)=>{let l=s.bits,d=0,c=0,p=0,u=0,h=0,f=0,y=0,g=0,A=0,T=0,b,_,m,S,v,C=null,N,x=new Uint16Array(Ls+1),z=new Uint16Array(Ls+1),$=null,q,K,F;for(d=0;d<=Ls;d++)x[d]=0;for(c=0;c<n;c++)x[e[t+c]]++;for(h=l,u=Ls;u>=1&&x[u]===0;u--);if(h>u&&(h=u),u===0)return r[o++]=1<<24|64<<16|0,r[o++]=1<<24|64<<16|0,s.bits=1,0;for(p=1;p<u&&x[p]===0;p++);for(h<p&&(h=p),g=1,d=1;d<=Ls;d++)if(g<<=1,g-=x[d],g<0)return-1;if(g>0&&(i===G_||u!==1))return-1;for(z[1]=0,d=1;d<Ls;d++)z[d+1]=z[d]+x[d];for(c=0;c<n;c++)e[t+c]!==0&&(a[z[e[t+c]]++]=c);if(i===G_?(C=$=a,N=20):i===Jh?(C=bE,$=TE,N=257):(C=vE,$=IE,N=0),T=0,c=0,d=p,v=o,f=h,y=0,m=-1,A=1<<h,S=A-1,i===Jh&&A>k_||i===H_&&A>U_)return 1;for(;;){q=d-y,a[c]+1<N?(K=0,F=a[c]):a[c]>=N?(K=$[a[c]-N],F=C[a[c]-N]):(K=32+64,F=0),b=1<<d-y,_=1<<f,p=_;do _-=b,r[v+(T>>y)+_]=q<<24|K<<16|F|0;while(_!==0);for(b=1<<d-1;T&b;)b>>=1;if(b!==0?(T&=b-1,T+=b):T=0,c++,--x[d]===0){if(d===u)break;d=e[t+a[c]]}if(d>h&&(T&S)!==m){for(y===0&&(y=h),v+=p,f=d-y,g=1<<f;f+y<u&&(g-=x[f+y],!(g<=0));)f++,g<<=1;if(A+=1<<f,i===Jh&&A>k_||i===H_&&A>U_)return 1;m=T&S,r[m]=h<<24|f<<16|v-o|0}}return T!==0&&(r[v+T]=d-y<<24|64<<16|0),s.bits=h,0},jl=EE,CE=0,VA=1,kA=2,{Z_FINISH:z_,Z_BLOCK:RE,Z_TREES:jd,Z_OK:ts,Z_STREAM_END:NE,Z_NEED_DICT:OE,Z_STREAM_ERROR:zo,Z_DATA_ERROR:UA,Z_MEM_ERROR:GA,Z_BUF_ERROR:wE,Z_DEFLATED:W_}=Us,au=16180,Q_=16181,K_=16182,q_=16183,Y_=16184,X_=16185,J_=16186,j_=16187,Z_=16188,$_=16189,ru=16190,ki=16191,jh=16192,eA=16193,Zh=16194,tA=16195,nA=16196,rA=16197,oA=16198,Zd=16199,$d=16200,iA=16201,aA=16202,sA=16203,lA=16204,cA=16205,$h=16206,dA=16207,uA=16208,xn=16209,HA=16210,zA=16211,xE=852,PE=592,FE=15,DE=FE,pA=i=>(i>>>24&255)+(i>>>8&65280)+((i&65280)<<8)+((i&255)<<24);function LE(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}var ns=i=>{if(!i)return 1;let e=i.state;return!e||e.strm!==i||e.mode<au||e.mode>zA?1:0},WA=i=>{if(ns(i))return zo;let e=i.state;return i.total_in=i.total_out=e.total=0,i.msg="",e.wrap&&(i.adler=e.wrap&1),e.mode=au,e.last=0,e.havedict=0,e.flags=-1,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new Int32Array(xE),e.distcode=e.distdyn=new Int32Array(PE),e.sane=1,e.back=-1,ts},QA=i=>{if(ns(i))return zo;let e=i.state;return e.wsize=0,e.whave=0,e.wnext=0,WA(i)},KA=(i,e)=>{let t;if(ns(i))return zo;let n=i.state;return e<0?(t=0,e=-e):(t=(e>>4)+5,e<48&&(e&=15)),e&&(e<8||e>15)?zo:(n.window!==null&&n.wbits!==e&&(n.window=null),n.wrap=t,n.wbits=e,QA(i))},qA=(i,e)=>{if(!i)return zo;let t=new LE;i.state=t,t.strm=i,t.window=null,t.mode=au;let n=KA(i,e);return n!==ts&&(i.state=null),n},ME=i=>qA(i,DE),hA=!0,em,tm,BE=i=>{if(hA){em=new Int32Array(512),tm=new Int32Array(32);let e=0;for(;e<144;)i.lens[e++]=8;for(;e<256;)i.lens[e++]=9;for(;e<280;)i.lens[e++]=7;for(;e<288;)i.lens[e++]=8;for(jl(VA,i.lens,0,288,em,0,i.work,{bits:9}),e=0;e<32;)i.lens[e++]=5;jl(kA,i.lens,0,32,tm,0,i.work,{bits:5}),hA=!1}i.lencode=em,i.lenbits=9,i.distcode=tm,i.distbits=5},YA=(i,e,t,n)=>{let r,o=i.state;return o.window===null&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new Uint8Array(o.wsize)),n>=o.wsize?(o.window.set(e.subarray(t-o.wsize,t),0),o.wnext=0,o.whave=o.wsize):(r=o.wsize-o.wnext,r>n&&(r=n),o.window.set(e.subarray(t-n,t-n+r),o.wnext),n-=r,n?(o.window.set(e.subarray(t-n,t),0),o.wnext=n,o.whave=o.wsize):(o.wnext+=r,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=r))),0},VE=(i,e)=>{let t,n,r,o,a,s,l,d,c,p,u,h,f,y,g=0,A,T,b,_,m,S,v,C,N=new Uint8Array(4),x,z,$=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(ns(i)||!i.output||!i.input&&i.avail_in!==0)return zo;t=i.state,t.mode===ki&&(t.mode=jh),a=i.next_out,r=i.output,l=i.avail_out,o=i.next_in,n=i.input,s=i.avail_in,d=t.hold,c=t.bits,p=s,u=l,C=ts;e:for(;;)switch(t.mode){case au:if(t.wrap===0){t.mode=jh;break}for(;c<16;){if(s===0)break e;s--,d+=n[o++]<<c,c+=8}if(t.wrap&2&&d===35615){t.wbits===0&&(t.wbits=15),t.check=0,N[0]=d&255,N[1]=d>>>8&255,t.check=fr(t.check,N,2,0),d=0,c=0,t.mode=Q_;break}if(t.head&&(t.head.done=!1),!(t.wrap&1)||(((d&255)<<8)+(d>>8))%31){i.msg="incorrect header check",t.mode=xn;break}if((d&15)!==W_){i.msg="unknown compression method",t.mode=xn;break}if(d>>>=4,c-=4,v=(d&15)+8,t.wbits===0&&(t.wbits=v),v>15||v>t.wbits){i.msg="invalid window size",t.mode=xn;break}t.dmax=1<<t.wbits,t.flags=0,i.adler=t.check=1,t.mode=d&512?$_:ki,d=0,c=0;break;case Q_:for(;c<16;){if(s===0)break e;s--,d+=n[o++]<<c,c+=8}if(t.flags=d,(t.flags&255)!==W_){i.msg="unknown compression method",t.mode=xn;break}if(t.flags&57344){i.msg="unknown header flags set",t.mode=xn;break}t.head&&(t.head.text=d>>8&1),t.flags&512&&t.wrap&4&&(N[0]=d&255,N[1]=d>>>8&255,t.check=fr(t.check,N,2,0)),d=0,c=0,t.mode=K_;case K_:for(;c<32;){if(s===0)break e;s--,d+=n[o++]<<c,c+=8}t.head&&(t.head.time=d),t.flags&512&&t.wrap&4&&(N[0]=d&255,N[1]=d>>>8&255,N[2]=d>>>16&255,N[3]=d>>>24&255,t.check=fr(t.check,N,4,0)),d=0,c=0,t.mode=q_;case q_:for(;c<16;){if(s===0)break e;s--,d+=n[o++]<<c,c+=8}t.head&&(t.head.xflags=d&255,t.head.os=d>>8),t.flags&512&&t.wrap&4&&(N[0]=d&255,N[1]=d>>>8&255,t.check=fr(t.check,N,2,0)),d=0,c=0,t.mode=Y_;case Y_:if(t.flags&1024){for(;c<16;){if(s===0)break e;s--,d+=n[o++]<<c,c+=8}t.length=d,t.head&&(t.head.extra_len=d),t.flags&512&&t.wrap&4&&(N[0]=d&255,N[1]=d>>>8&255,t.check=fr(t.check,N,2,0)),d=0,c=0}else t.head&&(t.head.extra=null);t.mode=X_;case X_:if(t.flags&1024&&(h=t.length,h>s&&(h=s),h&&(t.head&&(v=t.head.extra_len-t.length,t.head.extra||(t.head.extra=new Uint8Array(t.head.extra_len)),t.head.extra.set(n.subarray(o,o+h),v)),t.flags&512&&t.wrap&4&&(t.check=fr(t.check,n,h,o)),s-=h,o+=h,t.length-=h),t.length))break e;t.length=0,t.mode=J_;case J_:if(t.flags&2048){if(s===0)break e;h=0;do v=n[o+h++],t.head&&v&&t.length<65536&&(t.head.name+=String.fromCharCode(v));while(v&&h<s);if(t.flags&512&&t.wrap&4&&(t.check=fr(t.check,n,h,o)),s-=h,o+=h,v)break e}else t.head&&(t.head.name=null);t.length=0,t.mode=j_;case j_:if(t.flags&4096){if(s===0)break e;h=0;do v=n[o+h++],t.head&&v&&t.length<65536&&(t.head.comment+=String.fromCharCode(v));while(v&&h<s);if(t.flags&512&&t.wrap&4&&(t.check=fr(t.check,n,h,o)),s-=h,o+=h,v)break e}else t.head&&(t.head.comment=null);t.mode=Z_;case Z_:if(t.flags&512){for(;c<16;){if(s===0)break e;s--,d+=n[o++]<<c,c+=8}if(t.wrap&4&&d!==(t.check&65535)){i.msg="header crc mismatch",t.mode=xn;break}d=0,c=0}t.head&&(t.head.hcrc=t.flags>>9&1,t.head.done=!0),i.adler=t.check=0,t.mode=ki;break;case $_:for(;c<32;){if(s===0)break e;s--,d+=n[o++]<<c,c+=8}i.adler=t.check=pA(d),d=0,c=0,t.mode=ru;case ru:if(t.havedict===0)return i.next_out=a,i.avail_out=l,i.next_in=o,i.avail_in=s,t.hold=d,t.bits=c,OE;i.adler=t.check=1,t.mode=ki;case ki:if(e===RE||e===jd)break e;case jh:if(t.last){d>>>=c&7,c-=c&7,t.mode=$h;break}for(;c<3;){if(s===0)break e;s--,d+=n[o++]<<c,c+=8}switch(t.last=d&1,d>>>=1,c-=1,d&3){case 0:t.mode=eA;break;case 1:if(BE(t),t.mode=Zd,e===jd){d>>>=2,c-=2;break e}break;case 2:t.mode=nA;break;case 3:i.msg="invalid block type",t.mode=xn}d>>>=2,c-=2;break;case eA:for(d>>>=c&7,c-=c&7;c<32;){if(s===0)break e;s--,d+=n[o++]<<c,c+=8}if((d&65535)!==(d>>>16^65535)){i.msg="invalid stored block lengths",t.mode=xn;break}if(t.length=d&65535,d=0,c=0,t.mode=Zh,e===jd)break e;case Zh:t.mode=tA;case tA:if(h=t.length,h){if(h>s&&(h=s),h>l&&(h=l),h===0)break e;r.set(n.subarray(o,o+h),a),s-=h,o+=h,l-=h,a+=h,t.length-=h;break}t.mode=ki;break;case nA:for(;c<14;){if(s===0)break e;s--,d+=n[o++]<<c,c+=8}if(t.nlen=(d&31)+257,d>>>=5,c-=5,t.ndist=(d&31)+1,d>>>=5,c-=5,t.ncode=(d&15)+4,d>>>=4,c-=4,t.nlen>286||t.ndist>30){i.msg="too many length or distance symbols",t.mode=xn;break}t.have=0,t.mode=rA;case rA:for(;t.have<t.ncode;){for(;c<3;){if(s===0)break e;s--,d+=n[o++]<<c,c+=8}t.lens[$[t.have++]]=d&7,d>>>=3,c-=3}for(;t.have<19;)t.lens[$[t.have++]]=0;if(t.lencode=t.lendyn,t.lenbits=7,x={bits:t.lenbits},C=jl(CE,t.lens,0,19,t.lencode,0,t.work,x),t.lenbits=x.bits,C){i.msg="invalid code lengths set",t.mode=xn;break}t.have=0,t.mode=oA;case oA:for(;t.have<t.nlen+t.ndist;){for(;g=t.lencode[d&(1<<t.lenbits)-1],A=g>>>24,T=g>>>16&255,b=g&65535,!(A<=c);){if(s===0)break e;s--,d+=n[o++]<<c,c+=8}if(b<16)d>>>=A,c-=A,t.lens[t.have++]=b;else{if(b===16){for(z=A+2;c<z;){if(s===0)break e;s--,d+=n[o++]<<c,c+=8}if(d>>>=A,c-=A,t.have===0){i.msg="invalid bit length repeat",t.mode=xn;break}v=t.lens[t.have-1],h=3+(d&3),d>>>=2,c-=2}else if(b===17){for(z=A+3;c<z;){if(s===0)break e;s--,d+=n[o++]<<c,c+=8}d>>>=A,c-=A,v=0,h=3+(d&7),d>>>=3,c-=3}else{for(z=A+7;c<z;){if(s===0)break e;s--,d+=n[o++]<<c,c+=8}d>>>=A,c-=A,v=0,h=11+(d&127),d>>>=7,c-=7}if(t.have+h>t.nlen+t.ndist){i.msg="invalid bit length repeat",t.mode=xn;break}for(;h--;)t.lens[t.have++]=v}}if(t.mode===xn)break;if(t.lens[256]===0){i.msg="invalid code -- missing end-of-block",t.mode=xn;break}if(t.lenbits=9,x={bits:t.lenbits},C=jl(VA,t.lens,0,t.nlen,t.lencode,0,t.work,x),t.lenbits=x.bits,C){i.msg="invalid literal/lengths set",t.mode=xn;break}if(t.distbits=6,t.distcode=t.distdyn,x={bits:t.distbits},C=jl(kA,t.lens,t.nlen,t.ndist,t.distcode,0,t.work,x),t.distbits=x.bits,C){i.msg="invalid distances set",t.mode=xn;break}if(t.mode=Zd,e===jd)break e;case Zd:t.mode=$d;case $d:if(s>=6&&l>=258){i.next_out=a,i.avail_out=l,i.next_in=o,i.avail_in=s,t.hold=d,t.bits=c,yE(i,u),a=i.next_out,r=i.output,l=i.avail_out,o=i.next_in,n=i.input,s=i.avail_in,d=t.hold,c=t.bits,t.mode===ki&&(t.back=-1);break}for(t.back=0;g=t.lencode[d&(1<<t.lenbits)-1],A=g>>>24,T=g>>>16&255,b=g&65535,!(A<=c);){if(s===0)break e;s--,d+=n[o++]<<c,c+=8}if(T&&!(T&240)){for(_=A,m=T,S=b;g=t.lencode[S+((d&(1<<_+m)-1)>>_)],A=g>>>24,T=g>>>16&255,b=g&65535,!(_+A<=c);){if(s===0)break e;s--,d+=n[o++]<<c,c+=8}d>>>=_,c-=_,t.back+=_}if(d>>>=A,c-=A,t.back+=A,t.length=b,T===0){t.mode=cA;break}if(T&32){t.back=-1,t.mode=ki;break}if(T&64){i.msg="invalid literal/length code",t.mode=xn;break}t.extra=T&15,t.mode=iA;case iA:if(t.extra){for(z=t.extra;c<z;){if(s===0)break e;s--,d+=n[o++]<<c,c+=8}t.length+=d&(1<<t.extra)-1,d>>>=t.extra,c-=t.extra,t.back+=t.extra}t.was=t.length,t.mode=aA;case aA:for(;g=t.distcode[d&(1<<t.distbits)-1],A=g>>>24,T=g>>>16&255,b=g&65535,!(A<=c);){if(s===0)break e;s--,d+=n[o++]<<c,c+=8}if(!(T&240)){for(_=A,m=T,S=b;g=t.distcode[S+((d&(1<<_+m)-1)>>_)],A=g>>>24,T=g>>>16&255,b=g&65535,!(_+A<=c);){if(s===0)break e;s--,d+=n[o++]<<c,c+=8}d>>>=_,c-=_,t.back+=_}if(d>>>=A,c-=A,t.back+=A,T&64){i.msg="invalid distance code",t.mode=xn;break}t.offset=b,t.extra=T&15,t.mode=sA;case sA:if(t.extra){for(z=t.extra;c<z;){if(s===0)break e;s--,d+=n[o++]<<c,c+=8}t.offset+=d&(1<<t.extra)-1,d>>>=t.extra,c-=t.extra,t.back+=t.extra}if(t.offset>t.dmax){i.msg="invalid distance too far back",t.mode=xn;break}t.mode=lA;case lA:if(l===0)break e;if(h=u-l,t.offset>h){if(h=t.offset-h,h>t.whave&&t.sane){i.msg="invalid distance too far back",t.mode=xn;break}h>t.wnext?(h-=t.wnext,f=t.wsize-h):f=t.wnext-h,h>t.length&&(h=t.length),y=t.window}else y=r,f=a-t.offset,h=t.length;h>l&&(h=l),l-=h,t.length-=h;do r[a++]=y[f++];while(--h);t.length===0&&(t.mode=$d);break;case cA:if(l===0)break e;r[a++]=t.length,l--,t.mode=$d;break;case $h:if(t.wrap){for(;c<32;){if(s===0)break e;s--,d|=n[o++]<<c,c+=8}if(u-=l,i.total_out+=u,t.total+=u,t.wrap&4&&u&&(i.adler=t.check=t.flags?fr(t.check,r,u,a-u):nc(t.check,r,u,a-u)),u=l,t.wrap&4&&(t.flags?d:pA(d))!==t.check){i.msg="incorrect data check",t.mode=xn;break}d=0,c=0}t.mode=dA;case dA:if(t.wrap&&t.flags){for(;c<32;){if(s===0)break e;s--,d+=n[o++]<<c,c+=8}if(t.wrap&4&&d!==(t.total&4294967295)){i.msg="incorrect length check",t.mode=xn;break}d=0,c=0}t.mode=uA;case uA:C=NE;break e;case xn:C=UA;break e;case HA:return GA;case zA:default:return zo}return i.next_out=a,i.avail_out=l,i.next_in=o,i.avail_in=s,t.hold=d,t.bits=c,(t.wsize||u!==i.avail_out&&t.mode<xn&&(t.mode<$h||e!==z_))&&YA(i,i.output,i.next_out,u-i.avail_out),p-=i.avail_in,u-=i.avail_out,i.total_in+=p,i.total_out+=u,t.total+=u,t.wrap&4&&u&&(i.adler=t.check=t.flags?fr(t.check,r,u,i.next_out-u):nc(t.check,r,u,i.next_out-u)),i.data_type=t.bits+(t.last?64:0)+(t.mode===ki?128:0)+(t.mode===Zd||t.mode===Zh?256:0),(p===0&&u===0||e===z_)&&C===ts&&(C=wE),C},kE=i=>{if(ns(i))return zo;let e=i.state;return e.window&&(e.window=null),i.state=null,ts},UE=(i,e)=>{if(ns(i))return zo;let t=i.state;return t.wrap&2?(t.head=e,e.done=!1,ts):zo},GE=(i,e)=>{let t=e.length,n,r,o;return ns(i)||(n=i.state,n.wrap!==0&&n.mode!==ru)?zo:n.mode===ru&&(r=1,r=nc(r,e,t,0),r!==n.check)?UA:(o=YA(i,e,t,t),o?(n.mode=HA,GA):(n.havedict=1,ts))},HE=QA,zE=KA,WE=WA,QE=ME,KE=qA,qE=VE,YE=kE,XE=UE,JE=GE,jE="pako inflate (from Nodeca project)",Gi={inflateReset:HE,inflateReset2:zE,inflateResetKeep:WE,inflateInit:QE,inflateInit2:KE,inflate:qE,inflateEnd:YE,inflateGetHeader:XE,inflateSetDictionary:JE,inflateInfo:jE};function ZE(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var $E=ZE,XA=Object.prototype.toString,{Z_NO_FLUSH:e0,Z_FINISH:t0,Z_OK:ic,Z_STREAM_END:nm,Z_NEED_DICT:rm,Z_STREAM_ERROR:n0,Z_DATA_ERROR:mA,Z_MEM_ERROR:r0}=Us;function cc(i){this.options=iu.assign({chunkSize:1024*64,windowBits:15,to:""},i||{});let e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,e.windowBits===0&&(e.windowBits=-15)),e.windowBits>=0&&e.windowBits<16&&!(i&&i.windowBits)&&(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&(e.windowBits&15||(e.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new MA,this.strm.avail_out=0;let t=Gi.inflateInit2(this.strm,e.windowBits);if(t!==ic)throw new Error($a[t]);if(this.header=new $E,Gi.inflateGetHeader(this.strm,this.header),e.dictionary&&(typeof e.dictionary=="string"?e.dictionary=oc.string2buf(e.dictionary):XA.call(e.dictionary)==="[object ArrayBuffer]"&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(t=Gi.inflateSetDictionary(this.strm,e.dictionary),t!==ic)))throw new Error($a[t])}cc.prototype.push=function(i,e){let t=this.strm,n=this.options.chunkSize,r=this.options.dictionary,o,a,s;if(this.ended)return!1;for(e===~~e?a=e:a=e===!0?t0:e0,XA.call(i)==="[object ArrayBuffer]"?t.input=new Uint8Array(i):t.input=i,t.next_in=0,t.avail_in=t.input.length;;){for(t.avail_out===0&&(t.output=new Uint8Array(n),t.next_out=0,t.avail_out=n),o=Gi.inflate(t,a),o===rm&&r&&(o=Gi.inflateSetDictionary(t,r),o===ic?o=Gi.inflate(t,a):o===mA&&(o=rm));t.avail_in>0&&o===nm&&t.state.wrap>0&&i[t.next_in]!==0;)Gi.inflateReset(t),o=Gi.inflate(t,a);switch(o){case n0:case mA:case rm:case r0:return this.onEnd(o),this.ended=!0,!1}if(s=t.avail_out,t.next_out&&(t.avail_out===0||o===nm))if(this.options.to==="string"){let l=oc.utf8border(t.output,t.next_out),d=t.next_out-l,c=oc.buf2string(t.output,l);t.next_out=d,t.avail_out=n-d,d&&t.output.set(t.output.subarray(l,l+d),0),this.onData(c)}else this.onData(t.output.length===t.next_out?t.output:t.output.subarray(0,t.next_out));if(!(o===ic&&s===0)){if(o===nm)return o=Gi.inflateEnd(this.strm),this.onEnd(o),this.ended=!0,!0;if(t.avail_in===0)break}}return!0};cc.prototype.onData=function(i){this.chunks.push(i)};cc.prototype.onEnd=function(i){i===ic&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=iu.flattenChunks(this.chunks)),this.chunks=[],this.err=i,this.msg=this.strm.msg};function Sm(i,e){let t=new cc(e);if(t.push(i),t.err)throw t.msg||$a[t.err];return t.result}function o0(i,e){return e=e||{},e.raw=!0,Sm(i,e)}var i0=cc,a0=Sm,s0=o0,l0=Sm,c0=Us,d0={Inflate:i0,inflate:a0,inflateRaw:s0,ungzip:l0,constants:c0},{Deflate:BN,deflate:VN,deflateRaw:u0,gzip:kN}=AE,{Inflate:UN,inflate:GN,inflateRaw:p0,ungzip:HN}=d0;var JA=u0;var jA=p0;var yi;(t=>{function i(n){return jA(n)}t.inflateRaw=i;function e(n){return JA(n)}t.deflateRaw=e})(yi||(yi={}));var su;(n=>{class i{constructor(){}}n.Error=i;let r=class r{_decode(a){for(this._count=a.length,this._view=Yd.DataView_new1(a),(this._readInt()!=r._ID(137,80,78,71)||this._readInt()!=r._ID(13,10,26,10))&&r._fail();this._offset+12<=this._count;){let s=this._offset,l=this._readInt(),d=this._readInt(),c=s+8,p=c+l;switch(s+12+l>this._count&&(console.error("truncated png image"),r._fail()),d){case r._ID(73,72,68,82):{let u=this._readInt(),h=this._readInt(),f=this._readByte(),y=this._readByte(),g=this._readByte(),A=this._readByte(),T=this._readByte(),b=u<=0||h<=0||g!=0||A!=0||T!=0&&T!=1;if(!b)switch(y){case r.COLOR_TYPE_GRAY:{b=f!=1&&f!=2&&f!=4&&f!=8&&f!=16;break}case r.COLOR_TYPE_INDEXED:{b=f!=1&&f!=2&&f!=4&&f!=8;break}case r.COLOR_TYPE_RGB:case r.COLOR_TYPE_GRAY_ALPHA:case r.COLOR_TYPE_RGBA:{b=f!=8&&f!=16;break}default:{b=!0;break}}b&&(console.error("invalid png header"),r._fail()),this._width=u,this._height=h,this._bitDepth=f,this._colorType=y,this._isInterlaced=T==1;break}case r._ID(80,76,84,69):{this._palette=a.subarray(c,p),(l<3||l>256*3||ht.int_remainder(l,3)!=0)&&(console.error("invalid palette in png image"),r._fail());break}case r._ID(73,68,65,84):{this._dataStreamChunks.push(a.subarray(c,p)),this._dataStreamCount=this._dataStreamCount+l;break}case r._ID(116,82,78,83):{this._transparency=a.subarray(c,p);break}case r._ID(73,69,78,68):return n.DEBUG_LOG&&console.log(`png header: ${this._width}x${this._height}, ${this._bitDepth} bits per sample, `+new Map([[r.COLOR_TYPE_GRAY,"gray"],[r.COLOR_TYPE_RGB,"rgb"],[r.COLOR_TYPE_INDEXED,"indexed"],[r.COLOR_TYPE_GRAY_ALPHA,"gray_alpha"],[r.COLOR_TYPE_RGBA,"rgba"]]).get(this._colorType)+(this._isInterlaced?", interlaced":", non_interlaced")),this._decodeImage();default:{n.DEBUG_LOG&&console.warn(`unsupported png chunk '${Bn.string_fromCodePoints([d>>>24,d>>16&255,d>>8&255,d&255])}'`);break}}this._offset=s+l+12}return r._fail(),null}_readInt(){return this._offset=this._offset+4,this._offset>this._count&&(console.error("truncated png image"),r._fail()),this._view.getInt32(this._offset-4)}_readByte(){return this._offset=this._offset+1,this._offset>this._count&&(console.error("truncated png image"),r._fail()),this._view.getUint8(this._offset-1)}_decompressStream(){let a=new Uint8Array(this._dataStreamCount),s=0;for(let d of this._dataStreamChunks)a.set(d,s),s=s+d.length;let l=null;try{l=yi.inflateRaw(a.subarray(2))}catch{console.error("invalid zip stream in png image"),r._fail()}return l}_decodeImage(){(this._width<=0||this._height<=0||this._dataStreamCount==0)&&(console.error("incomplete png image"),r._fail());let a=this._decompressStream(),s=this._colorType==r.COLOR_TYPE_GRAY_ALPHA?2:this._colorType==r.COLOR_TYPE_RGB?3:this._colorType==r.COLOR_TYPE_RGBA?4:1,l=this._bitDepth*s,d=l+7>>3,c=this._width*l+7>>3,p=new Uint8Array(c*this._height),u=0;a.length!=(c+1)*this._height&&(console.error("invalid decompressed png stream"),r._fail());for(let y=0,g=this._height;y<g;y=y+1){let A=y*c,T=A-d,b=A-c,_=b-d,m=a[u];switch(u=u+1,m){case r.FILTER_TYPE_NONE:{p.set(a.subarray(u,u+c),A),u=u+c;break}case r.FILTER_TYPE_SUB:{for(let S=0,v=c;S<v;S=S+1)p[A+S]=a[u]+(S<d?0:p[T+S]),u=u+1;break}case r.FILTER_TYPE_UP:{for(let S=0,v=c;S<v;S=S+1)p[A+S]=a[u]+(y==0?0:p[b+S]),u=u+1;break}case r.FILTER_TYPE_AVERAGE:{for(let S=0,v=c;S<v;S=S+1){let C=S<d?0:p[T+S],N=y==0?0:p[b+S];p[A+S]=a[u]+(C+N>>1),u=u+1}break}case r.FILTER_TYPE_PAETH:{for(let S=0,v=c;S<v;S=S+1){let C=S<d?0:p[T+S],N=y==0?0:p[b+S],x=S<d||y==0?0:p[_+S],z=C+N-x,$=Math.abs(z-C),q=Math.abs(z-N),K=Math.abs(z-x);p[A+S]=a[u]+($<=q&&$<=K?C:q<=K?N:x),u=u+1}break}default:{console.error(`invalid png filter type ${m}`),r._fail();break}}}if(this._bitDepth==16){let y=new Uint8Array(p.length>>1);for(let g=0,A=y.length;g<A;g=g+1)y[g]=p[g*2];p=y,l>>=1,d>>=1,c>>=1,this._bitDepth=8}let h=this._width*this._height*4,f=s==4?p:new Uint8Array(h);switch(s){case 1:{let y=0,g=0,A=(1<<l)-1,T=A==1?255:255/A|0,b=this._colorType==r.COLOR_TYPE_INDEXED,_=this._palette,m=_!=null?_.length:0,S=this._transparency,v=S!=null?S.length:0;for(let C=0,N=this._height;C<N;C=C+1){let x=0,z=0;for(let $=0,q=this._width;$<q;$=$+1){x==0&&(z=p[y],x=8,y=y+1),x=x-l;let K=z>>x&A;if(b){let F=K*3;F>m-3&&(console.error(`invalid palette index ${K} in png image`),r._fail()),f[g]=_[F],f[g+1]=_[F+1],f[g+2]=_[F+2]}else K=K*T,f[g]=K,f[g+1]=K,f[g+2]=K;f[g+3]=b&&K<v?S[K]:255,g=g+4}}break}case 2:{for(let y=0,g=0;g<h;y=y+2,g=g+4){let A=p[y];f[g]=A,f[g+1]=A,f[g+2]=A,f[g+3]=p[y+1]}break}case 3:{for(let y=0,g=0;g<h;y=y+3,g=g+4){let A=p[y],T=p[y+1],b=p[y+2];f[g]=A,f[g+1]=T,f[g+2]=b,f[g+3]=255}break}}return new mn(0,this._width,this._height,f)}static _fail(){throw new i}static _ID(a,s,l,d){return a<<24|s<<16|l<<8|d}static decodeBytes(a){return new r()._decode(a)}constructor(){this._count=0,this._offset=0,this._palette=null,this._transparency=null,this._view=null,this._dataStreamChunks=[],this._dataStreamCount=0,this._width=0,this._height=0,this._bitDepth=0,this._colorType=0,this._isInterlaced=!1}};r.COLOR_TYPE_GRAY=0,r.COLOR_TYPE_RGB=2,r.COLOR_TYPE_INDEXED=3,r.COLOR_TYPE_GRAY_ALPHA=4,r.COLOR_TYPE_RGBA=6,r.FILTER_TYPE_NONE=0,r.FILTER_TYPE_SUB=1,r.FILTER_TYPE_UP=2,r.FILTER_TYPE_AVERAGE=3,r.FILTER_TYPE_PAETH=4;let e=r;n.Decoder=r,n.DEBUG_LOG=!1})(su||(su={}));var rs=class i{constructor(e){this._worker=null,this._queue=[],this._workerFailedToDownload=!1,this.onmessage=null,this.mainThreadFallback=null;let t=()=>{this._workerFailedToDownload=!0,this.mainThreadFallback!=null&&console.warn(`failed to download worker code from ${e}, falling back to running it on the main thread (this is slower)`);for(let n of this._queue)this.postMessage2(n.message,n.transfer)};new Mr(e).get().then(n=>{if(n.wasSuccessful()){try{this._worker=new Worker(URL.createObjectURL(new Blob([n.text])))}catch{t();return}this._worker.onmessage=r=>{this.onmessage!=null&&this.onmessage(r)};for(let r of this._queue)this.postMessage2(r.message,r.transfer)}else t()},n=>{t()})}postMessage1(e){this.postMessage2(e,null)}postMessage2(e,t){this._workerFailedToDownload?this.mainThreadFallback!=null&&this.onmessage!=null&&setTimeout(()=>{this.onmessage({data:this.mainThreadFallback(e)})},0):this._worker==null?this._queue.push(new i.Item(e,t)):t!=null?this._worker.postMessage(e,t):this._worker.postMessage(e)}};(e=>{class i{constructor(n,r){this.message=n,this.transfer=r}}e.Item=i})(rs||(rs={}));var He=class He{constructor(){if(arguments[0]==0){let[,e,t,n]=arguments;this.width=0,this.height=0,this.pixels=null,this.gif=null,this.width=e,this.height=t,this.pixels=new He.Pixels(0,n)}else if(arguments[0]==1){let[,e]=arguments;this.width=0,this.height=0,this.pixels=null,this.gif=null,this.width=e.width,this.height=e.height,this.pixels=new He.Pixels(1,e)}else if(arguments[0]==2){let[,e,t,n]=arguments;this.width=0,this.height=0,this.pixels=null,this.gif=null,this.width=e,this.height=t,this.pixels=new He.Pixels(2,n)}else if(arguments[0]==3){let[,e,t,n]=arguments;this.width=0,this.height=0,this.pixels=null,this.gif=null,this.width=e,this.height=t,this.pixels=null,this.gif=n}}static isPowerOf2(e){return e!=0&&(e&e-1)==0}static nextPowerOf2(e){return e=e-1,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,e=e+1,e}isGIF(){return this.gif!=null}pixelAtIndex(e,t){if(e<0||e>=this.width||t<0||t>=this.height)return E.TRANSPARENT;if(this.pixels.array!=null){let n=this.pixels.array,r=t*this.width*4+e*4,o=n[r],a=n[r+1],s=n[r+2],l=n[r+3];return E.new2(o,a,s,l)}else{if(this.pixels.img!=null)throw new Error("pixelAtIndex not implemented for image-based buffers");{let n=no.HTMLCanvasElement_getContext2D(this.pixels.canvas).getImageData(e,t,1,1).data;return E.new2(n[0],n[1],n[2],n[3])}}}expandToPowerOfTwo(){if(this.isGIF())return console.warn("ImageBuffer#expandToPowerOfTwo: unimplemented for GIF resources"),this;if(this.pixels.array!=null){let e=this.pixels.array,t=He.nextPowerOf2(this.width),n=He.nextPowerOf2(this.height),r=new Uint8Array(t*n*4);for(let o=0;o<t;o=o+1)for(let a=0;a<n;a=a+1)for(let s=0;s<4;s=s+1)r[s+(o+a*t)*4]=o<this.width&&a<this.height?e[s+(o+a*this.width)*4]:0;return new He(0,t,n,r)}else{if(this.pixels.img!=null)throw new Error("expandToPowerOfTwo not implemented for image-based buffers");{let e=document.createElement("canvas");return e.width=He.nextPowerOf2(this.width),e.height=He.nextPowerOf2(this.height),no.HTMLCanvasElement_getContext2D(e).drawImage(this.pixels.canvas,0,0,this.pixels.canvas.width,this.pixels.canvas.height),new He(1,e)}}}static initialize(){He._worker==null&&(He._worker=new rs(Rt.getWorkerURL()??"ts-imagedecoder.js"),He._worker.mainThreadFallback=e=>He.handleWorkerEvent(e),He._worker.onmessage=e=>{let t=e.data;if(t==null){console.log("No data received from image decode worker");return}let n=Ht.IntMap_get(He._pendingRequests,t.id,null);if(n==null)return;if(He._pendingRequests.delete(t.id),t.width>0&&t.height>0&&t.pixels!=null){let c=new He(0,t.width,t.height,t.pixels);He.dimensionsNeedDownsizing(t.width,t.height,He.computeMaxRes())&&(console.log("downsampling after worker"),c=He._downsampleBilinear(c,He.getMaxRes())),console.log(`image decode succeeded, got ${c.width}x${c.height} image`),n.resolve(c);return}else if(t.width>0&&t.height>0&&t.gif!=null){let c=new He(3,t.width,t.height,t.gif);console.log(`GIF decode succeeded, got ${c.width}x${c.height} image`),n.resolve(c);return}console.log("image decode failed, falling back to the browser's image decoder instead");let r=Qr.HTMLDocument_createElementImage(document),o=Gd.readFromJPEG(n.bytes),a=o!=null?Gl.ImageOrientation_rotationDegrees(o.value):0,s=o!=null?Gl.ImageOrientation_shouldFlip(o.value):!1,l=URL.createObjectURL(new Blob([n.bytes]));r.onerror=()=>{URL.revokeObjectURL(l),n.reject()};let d=()=>{URL.revokeObjectURL(l);let c=He._context!=null?He._context:He._context=no.HTMLCanvasElement_getContext2D(Qr.HTMLDocument_createElementCanvas(document)),p=c.canvas;if(r.width>0&&r.height>0){console.log(`image decode fallback succeeded, got ${r.width}x${r.height} image`);let u=a==0||a==180?r.width:r.height,h=a==0||a==180?r.height:r.width;p.width=u,p.height=h,c.save(),s&&(c.translate(p.width,0),c.scale(-1,1)),a==90?(c.translate(u,0),c.rotate(a*Math.PI/180)):a==180?(c.translate(u/2|0,h/2|0),c.rotate(a*Math.PI/180),c.translate(-u/2|0,-h/2|0)):a==270&&(c.translate(0,h),c.rotate(a*Math.PI/180)),c.drawImage(r,0,0,r.width,r.height),c.restore();let f=new He(0,u,h,new Uint8Array(c.getImageData(0,0,u,h).data.buffer));He.dimensionsNeedDownsizing(u,h,He.computeMaxRes())&&(f=He._downsampleBilinear(f,He.getMaxRes())),n.resolve(f);return}console.log("image decode fallback failed, giving up"),n.reject()};r.onload=()=>{Y.htmlImageDecodeMethodIsPresent()?r.decode().then(c=>{d()},c=>{Un.trackImageDecodeFailure("Slow decode fallback decode"),d()}):d()},r.src=l})}static setRamInUse(e){He._ramInUse=e}static setVRamInUse(e){He._vramInUse=e}static setMaxRes(e){He._maxRes=e}static getMaxRes(){return He._maxRes}static computeMaxRes(){if(!(Je.isMobile(Je.current())||Je.current()==4&&navigator.maxTouchPoints>0||Rt.forceMobileOptimizations()))return He._maxRes;let e=2048;return He._vramInUse>200||He._ramInUse>200?e=256:He._vramInUse>150||He._ramInUse>150?e=512:(He._vramInUse>100||He._ramInUse>100)&&(e=1024),e!=He._maxRes&&(He._maxRes=e),e}static decodeImageBuffer(e,t){return e=new Uint8Array(e),new Promise((n,r)=>{He.initialize(),He._worker.postMessage1(new ym(He._nextID,e,He.computeMaxRes(),t)),He._pendingRequests.set(He._nextID,new He.PendingRequest(e,n,()=>{r(new or)})),He._nextID=He._nextID+1})}static dimensionsNeedDownsizing(e,t,n){return n<=0||e<=He._maxRes&&t<=He._maxRes&&(e<13||t<13)||e*t<n*n*.5?!1:e>n||t>n}static handleWorkerEvent(e){var n;let t=null;if(e.isGIF)t=gi.Decoder.decodeBytes(e.bytes);else{try{t=su.Decoder.decodeBytes(e.bytes)}catch{}t==null&&(t=He._decodeJPEG(e.bytes)),t!=null&&He.dimensionsNeedDownsizing(t.width,t.height,e.maxRes)&&(t=He._downsampleBilinear(t,e.maxRes))}return new bm(e.id,t!=null?t.width:0,t!=null?t.height:0,t!=null?(n=t.pixels)==null?void 0:n.array:null,t!=null?t.gif:null)}static _decodeJPEG(e){let t=new Ql.Decoder;if(t.decodeBytes(e)!=Ql.Result.OK)return null;let n=t.width(),r=t.height(),o=t.rgb(),a=new Uint8Array(n*r*4),s=0,l=0;for(let d=0,c=n*r;d<c;d=d+1)a[l]=o[s],a[l+1]=o[s+1],a[l+2]=o[s+2],a[l+3]=255,s=s+3,l=l+4;return new He(0,n,r,a)}static redIndex(e,t,n){return(t*n+e)*4}static _downsampleBilinear(e,t){let n=Math.max(e.width,e.height);if(n<=0||t<=0)return e;let r=t/n,o=1/r,a=e.width*r|0,s=e.height*r|0,l=new Uint8Array(a*s*4),d=e.pixels.array;for(let c=0;c<s;c=c+1){let p=o*c,u=p-(p|0),h=c*a*4;for(let f=0;f<a;f=f+1){let y=o*f,g=y-(y|0),A=He.redIndex(f*o|0,c*o|0,e.width),T=d[A],b=d[A+1],_=d[A+2],m=d[A+3];f<a-1&&(A=He.redIndex((f*o|0)+1,c*o|0,e.width));let S=d[A],v=d[A+1],C=d[A+2],N=d[A+3];c<s-1?A=He.redIndex(f*o|0,(c*o|0)+1,e.width):A=He.redIndex(f*o|0,c*o|0,e.width);let x=d[A],z=d[A+1],$=d[A+2],q=d[A+3];c<s-1&&f<a-1&&(A=He.redIndex((f*o|0)+1,(c*o|0)+1,e.width));let K=d[A],F=d[A+1],P=d[A+2],k=d[A+3],H=1-g,L=1-u;l[h]=(T*H+S*g)*L+(x*H+K*g)*u|0,l[h+1]=(b*H+v*g)*L+(z*H+F*g)*u|0,l[h+2]=(_*H+C*g)*L+($*H+P*g)*u|0,l[h+3]=(m*H+N*g)*L+(q*H+k*g)*u|0,h=h+4}}return new He(0,a,s,l)}};He._pendingRequests=new Map,He._worker=null,He._nextID=0,He._context=null,He._handleResponse=null,He._ramInUse=0,He._vramInUse=0,He._maxRes=4096;var mn=He;(t=>{class i{constructor(){if(arguments[0]==0){let[,r]=arguments;this.array=null,this.canvas=null,this.img=null,this.array=r}else if(arguments[0]==1){let[,r]=arguments;this.array=null,this.canvas=null,this.img=null,this.canvas=r}else if(arguments[0]==2){let[,r]=arguments;this.array=null,this.canvas=null,this.img=null,this.img=r}}}t.Pixels=i;class e{constructor(r,o,a){this.bytes=r,this.resolve=o,this.reject=a}}t.PendingRequest=e})(mn||(mn={}));var ca=(t=>(t[t.ANIMATED=0]="ANIMATED",t[t.STATIC_IMAGE=1]="STATIC_IMAGE",t))(ca||{}),ym=class{constructor(e,t,n,r){this.id=0,this.bytes=null,this.maxRes=0,this.isGIF=!1,this.id=e,this.bytes=t,this.maxRes=n,this.isGIF=r==0}},bm=class i{static empty(e){return new i(e,0,0,null,null)}constructor(e,t,n,r,o){this.id=e,this.width=t,this.height=n,this.pixels=r,this.gif=o}};var I=class i{constructor(e,t){this._x=0,this._y=0,this._x=e,this._y=t}x(){return this._x}y(){return this._y}setX(e){this._x=e}setY(e){this._y=e}multiply(e){return new i(this.x()*e,this.y()*e)}multiply1(e){return new i(this.x()*e.x(),this.y()*e.y())}add(e){return new i(this.x()+e,this.y()+e)}add1(e){return new i(this.x()+e.x(),this.y()+e.y())}negative(){return new i(-this.x(),-this.y())}subtract(e){return new i(this.x()-e,this.y()-e)}subtract1(e){return new i(this.x()-e.x(),this.y()-e.y())}divide(e){return new i(this.x()/e,this.y()/e)}divide1(e){return new i(this.x()/e.x(),this.y()/e.y())}clone(){return new i(this.x(),this.y())}dot(e){return this.x()*e.x()+this.y()*e.y()}equals(e){return this.x()==e.x()&&this.y()==e.y()}freeze(){return this.clone()}isZero(){return this.x()==0&&this.y()==0}isPositive(){return this.x()>0&&this.y()>0}length(){return Math.sqrt(this.x()*this.x()+this.y()*this.y())}max1(){return Math.max(this.x(),this.y())}max2(e){return new i(Math.max(this.x(),e.x()),Math.max(this.y(),e.y()))}min1(){return Math.min(this.x(),this.y())}min2(e){return new i(Math.min(this.x(),e.x()),Math.min(this.y(),e.y()))}distanceTo(e){return Math.sqrt(this.squaredDistanceTo(e))}withOnesForZeros(){return new i(this.x()==0?1:this.x(),this.y()==0?1:this.y())}area(){return this.x()*this.y()}squaredDistanceTo(e){let t=this.x()-e.x(),n=this.y()-e.y();return t*t+n*n}approximatelyEquals(e,t){return this.squaredDistanceTo(e)<=t*t}mixedWith(e,t){return new i(this.x()+(e.x()-this.x())*t,this.y()+(e.y()-this.y())*t)}flipped(){return new i(this._y,this._x)}mixWith(e,t){this._x+=(e.x()-this.x())*t,this._y+=(e.y()-this.y())*t}addUpdate(e){this._x+=e,this._y+=e}addUpdate1(e){this._x+=e.x(),this._y+=e.y()}subtractUpdate(e){this._x-=e,this._y-=e}subtractUpdate1(e){this._x-=e.x(),this._y-=e.y()}multiplyUpdate(e){this._x*=e,this._y*=e}multiplyUpdate1(e){this._x*=e.x(),this._y*=e.y()}divideUpdate(e){this._x/=e,this._y/=e}divideUpdate1(e){this._x/=e.x(),this._y/=e.y()}rounded(){return new i(Math.round(this._x),Math.round(this._y))}setTo(e,t){return this._x=e,this._y=t,this}copyFrom(e){return this._x=e.x(),this._y=e.y(),this}makeAbs(){return this._x=Math.abs(this._x),this._y=Math.abs(this._y),this}toString(){return`Vector(${this.x()}, ${this.y()})`}toJSON(){return{x:this._x,y:this._y}}static new2(){return new i(0,0)}static new3(e){return new i(e.x(),e.y())}static cross(e,t){return e.x()*t.y()-e.y()*t.x()}static lerp(e,t,n){return e.multiply(1-n).add1(t.multiply(n))}static equals_(e,t){return e==null!=(t==null)?!1:e==null?!0:e.equals(t)}},Ie;(s=>{function i(){return I.new2()}s.FrozenVector_new1=i;function e(l){return l}s.FrozenVector_new2=e;function t(l){return I.new3(l)}s.FrozenVector_new3=t;function n(l,d){return new I(l,d)}s.FrozenVector_new4=n,s.FrozenVector_ZERO=i(),s.FrozenVector_ONE=n(1,1),s.FrozenVector_INFINITY=n(1/0,1/0)})(Ie||(Ie={}));var ir=class ir{static fromMinAndMax(e,t,n,r){return new ir(e,t,n-e,r-t)}constructor(e,t,n,r){this._x=0,this._y=0,this._width=0,this._height=0,this._x=e,this._y=t,this._width=n,this._height=r}x(){return this._x}y(){return this._y}width(){return this._width}height(){return this._height}setX(e){this._x=e}setY(e){this._y=e}setWidth(e){this._width=e}setHeight(e){this._height=e}clone(){return new ir(this.x(),this.y(),this.width(),this.height())}freeze(){return this.clone()}left(){return this.x()}top(){return this.y()}right(){return this.x()+this.width()}bottom(){return this.y()+this.height()}centerX(){return this.x()+this.width()/2}centerY(){return this.y()+this.height()/2}area(){return this.width()*this.height()}isEmpty(){return!(this.width()>0&&this.height()>0)}isInvalid(){return!(this.width()>=0&&this.height()>=0)}isFinite(){return isFinite(this._x)&&isFinite(this._y)&&isFinite(this._width)&&isFinite(this._height)}equals(e){return this.x()==e.x()&&this.y()==e.y()&&this.width()==e.width()&&this.height()==e.height()}contains1(e){return this.isEmpty()||e.isEmpty()?!1:this._x<=e.x()&&this._y<=e.y()&&this._x+this._width>=e.x()+e.width()&&this._y+this._height>=e.y()+e.height()}contains2(e){return!this.isEmpty()&&e!=null&&this.left()<=e.x()&&e.x()<this.right()&&this.top()<=e.y()&&e.y()<this.bottom()}overlaps(e){return!this.isEmpty()&&e!=null&&!e.isEmpty()&&this.left()<e.right()&&e.left()<this.right()&&this.top()<e.bottom()&&e.top()<this.bottom()}distanceTo(e){let t=Math.max(0,Math.abs(this.centerX()-e.centerX())-(this.width()+e.width())/2),n=Math.max(0,Math.abs(this.centerY()-e.centerY())-(this.height()+e.height())/2);return Math.sqrt(t*t+n*n)}topLeft(){return new I(this.left(),this.top())}topRight(){return new I(this.right(),this.top())}bottomLeft(){return new I(this.left(),this.bottom())}bottomRight(){return new I(this.right(),this.bottom())}size(){return new I(this.width(),this.height())}center(){return new I(this.x()+this.width()/2,this.y()+this.height()/2)}centerSelf(){return this.translate2(this.center().negative()),this}translate1(e,t){this._x+=e,this._y+=t}translate2(e){this._x+=e.x(),this._y+=e.y()}translatedBy(e){let t=this.clone();return t.translate2(e),t}scaleFromCenter(e){e-=1,this.expand2(this.width()*e,this.height()*e)}scaledBy1(e){return this.scaledBy2(new I(e,e))}scaledBy2(e){return this.isInvalid()?this.copyFrom(ir.INVALID):this.isFinite()?(this._x=this._x*e.x(),this._y=this._y*e.y(),this._width=this._width*e.x(),this._height=this._height*e.y(),this):this.copyFrom(ir.INFINITE)}expandToInts(){let e=Math.floor(this._x),t=Math.floor(this._y);this._width=Math.ceil(this._x+this._width)-e,this._height=Math.ceil(this._y+this._height)-t,this._x=e,this._y=t}setTo1(e,t,n,r){return this._x=e,this._y=t,this._width=n,this._height=r,this}setTo2(e,t){return this._x=e.x(),this._y=e.y(),this._width=t.x(),this._height=t.y(),this}copyFrom(e){return this.setX(e.x()),this.setY(e.y()),this.setWidth(e.width()),this.setHeight(e.height()),this}expand1(e){this._x-=e,this._y-=e,this._width+=2*e,this._height+=2*e}contract(e){this.expand1(-e)}expandedBy1(e){return this.expand1(e),this}expandedBy2(e,t){return this.expand2(e,t),this}expand2(e,t){this._x-=e,this._y-=t,this._width+=2*e,this._height+=2*t}expandToInclude(e){if(e.isEmpty())return;if(this.isEmpty()){this.copyFrom(e);return}let t=Math.min(this._x,e.x()),n=Math.min(this._y,e.y());this._width=Math.max(this._x+this._width,e.x()+e.width())-t,this._height=Math.max(this._y+this._height,e.y()+e.height())-n,this._x=t,this._y=n}intersectedWith(e){return this.intersectWith(e),this}intersectWith(e){if(this.isEmpty()||e.isEmpty())this.copyFrom(Kn.FrozenRect_EMPTY);else{let t=Math.max(this._x,e.x()),n=Math.max(this._y,e.y());this._width=Math.min(this._x+this._width,e.x()+e.width())-t,this._height=Math.min(this._y+this._height,e.y()+e.height())-n,this._x=t,this._y=n}}round(){let e=Math.round(this._x),t=Math.round(this._y),n=Math.round(this._x+this._width),r=Math.round(this._y+this._height);this._x=e,this._y=t,this._width=n-e,this._height=r-t}rounded(){return this.round(),this}toString(){return`Rect(${this.x()}, ${this.y()}, ${this.width()}, ${this.height()})`}transformInto1(e,t){_t.INSTANCE.reset();let n=I.new2();for(let r=0;r<4;r=r+1)n.setTo(this._x+this._width*(r&1),this._y+this._height*(r>>1)),t.transformPoint(n),_t.INSTANCE.include2(n);_t.INSTANCE.buildTo(e)}transformBy1(e){this.transformInto1(this,e)}transformInto2(e,t){_t.INSTANCE.reset();let n=I.new2();for(let r=0;r<4;r=r+1)n.setTo(this._x+this._width*(r&1),this._y+this._height*(r>>1)),t.transformPoint(n),_t.INSTANCE.include2(n);_t.INSTANCE.buildTo(e)}transformBy2(e){this.transformInto2(this,e)}leftThird(){return new ir(this._x,this._y,this._width/3,this._height)}rightThird(){let e=this._width/3;return new ir(this._x+2*e,this._y,this._width/3,this._height)}static new2(){return new ir(0,0,0,0)}static new3(e){return new ir(e.x(),e.y(),e.width(),e.height())}static new4(e,t){return new ir(e.x(),e.y(),t.x(),t.y())}};ir.INVALID=new ir(1/0,1/0,-1/0,-1/0),ir.INFINITE=new ir(-1/0,-1/0,1/0,1/0),ir.CLIP=ir.fromMinAndMax(-1,-1,1,1),ir.UNIT=new ir(0,0,1,1);var G=ir,lu=class lu{constructor(){this._minX=0,this._minY=0,this._maxX=0,this._maxY=0,this.reset()}isValid(){return this._minX<this._maxX&&this._minY<this._maxY}isValidOrZeroArea(){return this._minX<=this._maxX&&this._minY<=this._maxY}reset(){this._minX=1/0,this._minY=1/0,this._maxX=-1/0,this._maxY=-1/0}include1(e,t){this._minX=Math.min(this._minX,e),this._minY=Math.min(this._minY,t),this._maxX=Math.max(this._maxX,e),this._maxY=Math.max(this._maxY,t)}include2(e){this.include1(e.x(),e.y())}include3(e){e!=null&&!e.isEmpty()&&(this.include1(e.left(),e.top()),this.include1(e.right(),e.bottom()))}include4(e,t){if(!e.isEmpty()){let n=G.new2();e.transformInto1(n,t),this.include3(n)}}buildTo(e){e.setTo1(this._minX,this._minY,this._maxX-this._minX,this._maxY-this._minY)}build(){let e=G.new2();return this.buildTo(e),e}};lu.INSTANCE=new lu;var _t=lu,os=class i{constructor(){if(arguments[0]==0){let[,e,t,n,r]=arguments;this._rect=null,this._nodeRadius=0,this._vertexRadii=null,this._cornerSmoothing=0,this._rect=G.new4(e,t),this._nodeRadius=n,this._cornerSmoothing=r}else if(arguments[0]==1){let[,e,t,n,r]=arguments;this._rect=null,this._nodeRadius=0,this._vertexRadii=null,this._cornerSmoothing=0,this._rect=G.new4(e,t),this._vertexRadii=n,this._cornerSmoothing=r}else if(arguments[0]==2){let[,e,t,n,r]=arguments;this._rect=null,this._nodeRadius=0,this._vertexRadii=null,this._cornerSmoothing=0,this._rect=e,this._nodeRadius=t,this._vertexRadii=n}}clone(){var e;return new i(2,this._rect.clone(),this._nodeRadius,(e=this._vertexRadii)==null?void 0:e.slice(),this._cornerSmoothing)}cornerSmoothing(){return this._cornerSmoothing}left(){return this._rect.x()}top(){return this._rect.top()}width(){return this._rect.width()}height(){return this._rect.height()}rect(){return this._rect}nodeRadius(){return this._nodeRadius}vertexRadii(){return this._vertexRadii}isRounded(){return this._nodeRadius>0||this._vertexRadii!=null&&this._vertexRadii.some(e=>e>0)}transform(e){e.transformRect(this._rect)}contract(e){this._rect.contract(e)}expand(e){this._rect.expand1(e)}adjustCornerRadiiForSpread(e){if(this._vertexRadii!=null)for(let t=0,n=this.vertexRadii().length;t<n;t=t+1)this._vertexRadii[t]!=0&&(this._vertexRadii[t]=Math.max(this._vertexRadii[t]+e,0));else this._nodeRadius!=0&&(this._nodeRadius=Math.max(this._nodeRadius+e,0))}},Kn;(o=>{function i(){return G.new2()}o.FrozenRect_new1=i;function e(a){return a}o.FrozenRect_new2=e;function t(a){return G.new3(a)}o.FrozenRect_new3=t;function n(a,s,l,d){return new G(a,s,l,d)}o.FrozenRect_new4=n,o.FrozenRect_EMPTY=i()})(Kn||(Kn={}));var Hi;(d=>{function i(){let c=no.HTMLCanvasElement_getContextWebGL1(Qr.HTMLDocument_createElementCanvas(document));if(c==null)return!1;let p=c.canvas;document.body.appendChild(p);let u=c.createProgram(),h=c.createShader(c.VERTEX_SHADER);c.shaderSource(h,`
        precision highp float;
        attribute vec2 pos;
        void main(){
          gl_Position=vec4(pos*2.-1.,0.,1.);
        }
      `),c.compileShader(h),c.attachShader(u,h);let f=c.createShader(c.FRAGMENT_SHADER);c.shaderSource(f,`
        precision highp float;
        void main(){
          gl_FragColor=vec4(0., 0., 0., 1.);
        }
      `),c.compileShader(f),c.attachShader(u,f),c.bindAttribLocation(u,0,"pos"),c.linkProgram(u);let y=c.createBuffer();c.bindBuffer(c.ARRAY_BUFFER,y);let g=new Float32Array([0,0,1,0,0,1,1,1]);c.bufferData(c.ARRAY_BUFFER,g.length*4,c.DYNAMIC_DRAW),c.bufferSubData(c.ARRAY_BUFFER,0,g),c.enableVertexAttribArray(0),c.vertexAttribPointer(0,2,c.FLOAT,!1,8,0),c.canvas.width=10,c.canvas.height=1;let A=c.createFramebuffer();c.bindFramebuffer(c.FRAMEBUFFER,A);let T=c.createTexture();c.bindTexture(c.TEXTURE_2D,T),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.LINEAR),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.LINEAR),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE),c.bindTexture(c.TEXTURE_2D,T),c.texImage2D(c.TEXTURE_2D,0,c.RGBA,c.canvas.width,c.canvas.height,0,c.RGBA,c.UNSIGNED_BYTE,null),c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,T,0),c.useProgram(u),c.bindFramebuffer(c.FRAMEBUFFER,A),c.viewport(0,0,c.canvas.width/2|0,c.canvas.height),c.drawArrays(c.TRIANGLE_STRIP,0,4),c.bindFramebuffer(c.FRAMEBUFFER,null),c.viewport(0,0,c.canvas.width/2|0,c.canvas.height),c.drawArrays(c.TRIANGLE_STRIP,0,4);let b=new Uint8Array(4);return c.readPixels((c.canvas.width/2|0)+2,0,1,1,c.RGBA,c.UNSIGNED_BYTE,b),document.body.removeChild(p),b[3]!=0}d._featureDetectViewportBug=i;function e(){let c=no.HTMLCanvasElement_getContextWebGL1(Qr.HTMLDocument_createElementCanvas(document));if(c==null)return!1;let p=c.canvas;document.body.appendChild(p),c.canvas.width=1,c.canvas.height=1;let u=c.createTexture();c.bindTexture(c.TEXTURE_2D,u),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.NEAREST),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.NEAREST),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE),c.bindTexture(c.TEXTURE_2D,u),c.texImage2D(c.TEXTURE_2D,0,c.RGBA,c.canvas.width,c.canvas.height,0,c.RGBA,c.UNSIGNED_BYTE,null),c.bindTexture(c.TEXTURE_2D,u);let h=c.createFramebuffer();c.bindFramebuffer(c.FRAMEBUFFER,h),c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,u,0);let f=c.createBuffer();c.bindBuffer(c.ARRAY_BUFFER,f),c.bufferData(c.ARRAY_BUFFER,32,c.DYNAMIC_DRAW),c.bufferSubData(c.ARRAY_BUFFER,0,new Float32Array([1,1,1,-1,-1,1,-1,-1])),c.vertexAttribPointer(0,2,c.FLOAT,!1,8,0),c.enableVertexAttribArray(0),c.bindBuffer(c.ARRAY_BUFFER,f);let y=c.createProgram(),g=c.createShader(c.VERTEX_SHADER);c.shaderSource(g,`
        precision highp float;
        attribute vec2 pos;
        varying vec2 uv;
        void main(){
          uv = (pos + vec2(1.0)) / 2.0;
          gl_Position=vec4(pos*2.-1.,0.,1.);
        }
      `),c.compileShader(g),c.attachShader(y,g);let A=c.createShader(c.FRAGMENT_SHADER);c.shaderSource(A,`
        precision highp float;
        uniform sampler2D texture;
        varying vec2 uv;
        void main(){
          gl_FragColor=texture2D(texture, uv);
        }
      `),c.compileShader(A),c.attachShader(y,A),c.linkProgram(y);let T=c.createProgram(),b=c.createShader(c.VERTEX_SHADER);c.shaderSource(b,`
        precision highp float;
        attribute vec2 pos;
        void main(){
          gl_Position=vec4(pos,0.,1.);
        }
      `),c.compileShader(b),c.attachShader(T,b);let _=c.createShader(c.FRAGMENT_SHADER);c.shaderSource(_,`
        precision highp float;
        void main(){
          gl_FragColor=vec4(0.,0.,1.,1.);
        }
      `),c.compileShader(_),c.attachShader(T,_),c.bindAttribLocation(T,0,"pos"),c.linkProgram(T),c.clearColor(1,0,0,1),c.bindFramebuffer(c.FRAMEBUFFER,h),c.useProgram(T),c.drawArrays(c.TRIANGLE_STRIP,0,4),c.bindFramebuffer(c.FRAMEBUFFER,null),c.useProgram(y),c.drawArrays(c.TRIANGLE_STRIP,0,4),c.bindFramebuffer(c.FRAMEBUFFER,h),c.clear(c.COLOR_BUFFER_BIT),c.bindFramebuffer(c.FRAMEBUFFER,null),c.useProgram(y),c.drawArrays(c.TRIANGLE_STRIP,0,4);let m=new Uint8Array(4);return c.readPixels(0,0,1,1,c.RGBA,c.UNSIGNED_BYTE,m),document.body.removeChild(p),m[0]!=255}d._featureDetectDrawClearReorderingBug=e;function t(){return d._hasViewportBug==null?(Ve("Called hasViewportBug before running feature detection"),!1):d._hasViewportBug.value}d.hasViewportBug=t;function n(){return d._hasDrawClearReorderingBug==null?(Ve("Called hasDrawClearReorderingBug before running feature detection"),!1):d._hasDrawClearReorderingBug.value}d.hasDrawClearReorderingBug=n;function r(){return d._hasUnexpectedCompositingBug==null?(Ve("Called hasDrawClearReorderingBug before running feature detection"),!1):d._hasUnexpectedCompositingBug.value}d.hasUnexpectedCompositingBug=r;function o(){d._hasViewportBug=new _e(i()),t()&&console.warn("GPUBugs: device has buggy implementation of gl.viewport. Will apply workarounds."),d._hasDrawClearReorderingBug=new _e(e()),n()&&console.warn("GPUBugs: Device may re-order draw/clear commands. Will apply workarounds.");let c=navigator.userAgent,p=(c.indexOf("iPhone OS 14_0")|0)!=-1,u=(c.indexOf("iPhone OS 14_1")|0)!=-1,h=p||u,f=(c.indexOf("iPad; CPU OS 14_0")|0)!=-1,y=(c.indexOf("iPad; CPU OS 14_1")|0)!=-1,g=f||y,T=(c.indexOf("Version/14")|0)!=-1&&(c.indexOf("Safari")|0)!=-1&&(navigator.maxTouchPoints|0)>0;d._hasUnexpectedCompositingBug=new _e(h||g||T)}d.detect=o,d._hasViewportBug=null,d._hasDrawClearReorderingBug=null,d._hasUnexpectedCompositingBug=null})(Hi||(Hi={}));var w;(xe=>{function i(){return xe._supportsWebGLExtensionOESStandardDerivatives}xe.supportsWebGLExtensionOESStandardDerivatives=i;function e(lt){xe._supportsWebGLExtensionOESStandardDerivatives=lt}xe.setSupportsWebGLExtensionOESStandardDerivatives=e;function t(lt){return lt==0?4:1}xe.byteCount=t;function n(lt){window.testFakeLostContext=()=>{let O=lt.getExtension("WEBGL_lose_context");O.loseContext();let R=3;setTimeout(()=>{console.log(`waiting ${R} seconds to restore the context...`)},500),setTimeout(()=>{O.restoreContext()},R*1e3)},window.testRealLostContext=()=>{let O=[];for(let R=0;R<32;R=R+1)O.push(no.HTMLCanvasElement_getContextWebGL1(Qr.HTMLDocument_createElementCanvas(document)))}}xe.addContextLossTestFunctionsToGlobalScope=n;function r(lt){let O=lt==null?void 0:lt.graphicsCardName();return O!=null&&O.indexOf("SwiftShader")!=-1}xe.isUsingSoftwareRenderer=r;let o;(B=>(B[B.ZERO=0]="ZERO",B[B.ONE=1]="ONE",B[B.SOURCE_COLOR=2]="SOURCE_COLOR",B[B.TARGET_COLOR=3]="TARGET_COLOR",B[B.INVERSE_SOURCE_COLOR=4]="INVERSE_SOURCE_COLOR",B[B.INVERSE_TARGET_COLOR=5]="INVERSE_TARGET_COLOR",B[B.SOURCE_ALPHA=6]="SOURCE_ALPHA",B[B.TARGET_ALPHA=7]="TARGET_ALPHA",B[B.INVERSE_SOURCE_ALPHA=8]="INVERSE_SOURCE_ALPHA",B[B.INVERSE_TARGET_ALPHA=9]="INVERSE_TARGET_ALPHA",B[B.CONSTANT=10]="CONSTANT",B[B.INVERSE_CONSTANT=11]="INVERSE_CONSTANT"))(o=xe.BlendOperation||(xe.BlendOperation={}));let wt=class wt{static createInterpolateBlendState(O){return new wt(10,11,10,11,O)}constructor(O,R,V,W,j){this.sourceColor=O,this.targetColor=R,this.sourceAlpha=V,this.targetAlpha=W,this.constant=j}};wt.ZERO=new wt(0,0,0,0,0),wt.COPY=new wt(1,0,1,0,0),wt.KEEP=new wt(0,1,0,1,0),wt.PREMULTIPLIED=new wt(1,8,1,8,0),wt.PREMULTIPLIED_SOURCE_UNDER_TARGET=new wt(9,1,9,1,0),wt.UNPREMULTIPLIED=new wt(6,8,6,8,0),wt.SCREEN=new wt(1,4,1,8,0);let a=wt;xe.BlendState=wt;let s;(V=>(V[V.ALL=0]="ALL",V[V.COLOR=1]="COLOR",V[V.DEPTH_STENCIL=2]="DEPTH_STENCIL"))(s=xe.Clear||(xe.Clear={}));let l;(R=>(R[R.TRIANGLES=0]="TRIANGLES",R[R.TRIANGLE_STRIP=1]="TRIANGLE_STRIP"))(l=xe.Primitive||(xe.Primitive={}));let d;(ve=>(ve[ve.ALWAYS=0]="ALWAYS",ve[ve.EQUAL=1]="EQUAL",ve[ve.GREATER_THAN=2]="GREATER_THAN",ve[ve.GREATER_THAN_OR_EQUAL=3]="GREATER_THAN_OR_EQUAL",ve[ve.LESS_THAN=4]="LESS_THAN",ve[ve.LESS_THAN_OR_EQUAL=5]="LESS_THAN_OR_EQUAL",ve[ve.NEVER=6]="NEVER",ve[ve.NOT_EQUAL=7]="NOT_EQUAL"))(d=xe.Comparison||(xe.Comparison={}));let c;(ve=>(ve[ve.DECREMENT_CLAMP=0]="DECREMENT_CLAMP",ve[ve.DECREMENT_WRAP=1]="DECREMENT_WRAP",ve[ve.INCREMENT_CLAMP=2]="INCREMENT_CLAMP",ve[ve.INCREMENT_WRAP=3]="INCREMENT_WRAP",ve[ve.INVERT=4]="INVERT",ve[ve.KEEP=5]="KEEP",ve[ve.REPLACE=6]="REPLACE",ve[ve.ZERO=7]="ZERO"))(c=xe.StencilOperation||(xe.StencilOperation={}));let fn=class fn{equals(O){return this==O||this.reference==O.reference&&this.comparison==O.comparison&&this.readMask==O.readMask&&this.writeMask==O.writeMask&&this.stencilFail==O.stencilFail&&this.stencilPassDepthFail==O.stencilPassDepthFail&&this.stencilPassDepthPass==O.stencilPassDepthPass}constructor(O,R,V,W,j,se,he){this.reference=O,this.comparison=R,this.readMask=V,this.writeMask=W,this.stencilFail=j,this.stencilPassDepthFail=se,this.stencilPassDepthPass=he}};fn.NONE=new fn(0,6,0,-1,5,5,5);let p=fn;xe.StencilFaceState=fn;let _n=class _n{constructor(){if(arguments.length==0)this.isEnabled=!1,this.frontFace=null,this.backFace=null,this.isEnabled=!1,this.frontFace=p.NONE,this.backFace=p.NONE;else if(arguments.length==1){let O=arguments[0];this.isEnabled=!1,this.frontFace=null,this.backFace=null,this.isEnabled=!0,this.frontFace=O,this.backFace=O}else if(arguments.length==2){let O=arguments[0],R=arguments[1];this.isEnabled=!1,this.frontFace=null,this.backFace=null,this.isEnabled=!0,this.frontFace=O,this.backFace=R}}equals(O){return this==O||this.isEnabled==O.isEnabled&&this.frontFace.equals(O.frontFace)&&this.backFace.equals(O.backFace)}};_n.NONE=new _n;let u=_n;xe.StencilState=_n;class h{constructor(O,R){this.canvasSize=O,this.webGLDidAdjustCanvasSize=R}}xe.ComputedCanvasSize=h;let f;(R=>(R[R.FLOAT=0]="FLOAT",R[R.BYTE=1]="BYTE"))(f=xe.AttributeType||(xe.AttributeType={}));class y{constructor(O,R,V,W){this.name=O,this.type=R,this.count=V,this.byteOffset=W}}xe.Attribute=y;class g{attributes(){return this._attributes}stride(){return this._stride}add(O,R,V){return this._attributes.push(new y(O,R,V,this._stride)),this._stride=this._stride+V*t(R),this}constructor(){this._attributes=[],this._stride=0}static getPositionF2(){return g._POSITION_F2||(g._POSITION_F2=new g().add(Fn.instance().GLSLX_NAME_A_POSITION2,0,2)),g._POSITION_F2}static getPositionF2CoordF3(){return g._POSITION_F2_COORD_F3||(g._POSITION_F2_COORD_F3=new g().add(Fn.instance().GLSLX_NAME_A_POSITION2,0,2).add(Fn.instance().GLSLX_NAME_A_COORD3,0,3)),g._POSITION_F2_COORD_F3}static getPositionF4CoordF4(){return g._POSITION_F4_COORD_F4||(g._POSITION_F4_COORD_F4=new g().add(Fn.instance().GLSLX_NAME_A_POSITION4,0,4).add(Fn.instance().GLSLX_NAME_A_COORD4,0,4)),g._POSITION_F4_COORD_F4}static getPositionF4CoordB4(){return g._POSITION_F4_COORD_B4||(g._POSITION_F4_COORD_B4=new g().add(Fn.instance().GLSLX_NAME_A_POSITION4,0,4).add(Fn.instance().GLSLX_NAME_A_COORD4,1,4)),g._POSITION_F4_COORD_B4}static getPositionF4(){return g._POSITION_F4||(g._POSITION_F4=new g().add(Fn.instance().GLSLX_NAME_A_POSITION4,0,4)),g._POSITION_F4}}xe.VertexFormat=g;let A;(R=>(R[R.RGBA_32=0]="RGBA_32",R[R.DEPTH_24_STENCIL_8=1]="DEPTH_24_STENCIL_8"))(A=xe.PixelFormat||(xe.PixelFormat={}));let T;(R=>(R[R.NEAREST=0]="NEAREST",R[R.LINEAR=1]="LINEAR"))(T=xe.PixelFilter||(xe.PixelFilter={}));let b;(R=>(R[R.REPEAT=0]="REPEAT",R[R.CLAMP=1]="CLAMP"))(b=xe.PixelWrap||(xe.PixelWrap={}));let Gt=class Gt{constructor(O,R,V,W){this.pixelFormat=O,this.minFilter=R,this.magFilter=V,this.wrap=W}};Gt.RGBA_LINEAR_CLAMP=new Gt(0,1,1,1),Gt.RGBA_LINEAR_MIN_NEAREST_MAG_CLAMP=new Gt(0,1,0,1),Gt.RGBA_NEAREST_CLAMP=new Gt(0,0,0,1),Gt.RGBA_NEAREST_REPEAT=new Gt(0,0,0,0),Gt.STENCIL=new Gt(1,0,0,1);let _=Gt;xe.TextureFormat=Gt;class m{constructor(O,R){this.texture=null,this.uvSpaceRect=null,this.texture=O,this.uvSpaceRect=R}}xe.TextureRegion=m;let S;(W=>{function lt(j){return j.length==0}W.isEmpty=lt;function O(j,se){return j[se]}W.get=O;function R(j){return ue.List_last(j)}W.last=R;function V(j){return j.length}W.count=V})(S=xe.FrozenScissors||(xe.FrozenScissors={}));class v{totalVRAM(){return this._chunks.length*C.BYTE_COUNT}allocate(O,R){if(R.length==0)return null;R.length<=C.BYTE_COUNT;let V=O.stride();for(let j of this._chunks){let se=j.tryToAllocate(V,R);if(se!=null)return se}let W=new C(this,this._context.createVertexBuffer(C.BYTE_COUNT));return this._chunks.push(W),W.tryToAllocate(V,R)}constructor(O){this._context=O,this._chunks=[]}}xe.BufferPool=v;let In=class In{tryToAllocate(O,R){let V=R.length,W=this.areas,j=null;if(this.bytesUsed+V<=In.BYTE_COUNT){for(;W.length!=0&&ue.List_last(W).wasFreed();)ue.List_removeLast(W);j=this.allocateAtEnd(O,R),j==null&&(this.runCompactingGC(),j=this.allocateAtEnd(O,R)),j!=null&&(this.buffer.upload2(R,j.byteOffset()),this.bytesUsed=this.bytesUsed+V,W.push(j))}return j}allocateAtEnd(O,R){let V=this.areas.length==0?0:In._alignToNextMultiple(ue.List_last(this.areas).byteOffset()+ue.List_last(this.areas).byteCount(),O);return V+R.length<=In.BYTE_COUNT?new N(this,R.length,O,V,R):null}runCompactingGC(){let O=0;ue.List_removeIf(this.areas,R=>R.wasFreed()?!0:(O=In._alignToNextMultiple(O,R.stride()),R.byteOffset()!=O&&(this.buffer.move(R.byteOffset(),O,R.byteCount()),R.wasMovedTo(O)),O=O+R.byteCount(),!1)),xe.DISABLE_BUFFER_ASSERT||this.areas.forEach(R=>{R.assertBytesAreAsExpected()})}static _alignToNextMultiple(O,R){return O+ht.int_remainder(R-ht.int_remainder(O,R),R)}constructor(O,R){this.pool=O,this.buffer=R,this.areas=[],this.bytesUsed=0}};In.BYTE_COUNT=4*1024*1024;let C=In;xe.BufferChunk=In;class N{constructor(O,R,V,W,j){this._chunk=null,this._byteCount=0,this._stride=0,this._byteOffset=0,this._wasFreed=!1,this._expectedArray=null,this._chunk=O,this._byteCount=R,this._stride=V,this._byteOffset=W,this._saveBytes(j)}_saveBytes(O){this._expectedArray=new Uint8Array(O)}assertBytesAreAsExpected(){for(let O=0,R=this._byteCount;O<R;O=O+1)this._expectedArray[O]!=this._chunk.buffer.bytes()[O+this._byteOffset]}byteCount(){return this._byteCount}stride(){return this._stride}byteOffset(){return this._byteOffset}wasFreed(){return this._wasFreed}buffer(){return this._chunk.buffer}free(){this._wasFreed||(this._wasFreed=!0,this._chunk.bytesUsed-=this.byteCount())}wasMovedTo(O){this._byteOffset=O}}xe.BufferArea=N;class x{constructor(O,R){this._rectPoints=[I.new2(),I.new2(),I.new2(),I.new2()],this._inside=[],this._material=null,this._outside=[],this._vertices=new gr,this._context=null,this._pixelScale=1,this._pool=null,this._previousColor=E.TRANSPARENT,this._previousU=0,this._previousV=0,this._previousX=0,this._previousY=0,this._context=O,this._pool=R,this._materialStrings=Fn.instance(),this._material=O.createMaterial("smooth",g.getPositionF4CoordB4(),this._materialStrings.GLSLX_SOURCE_SMOOTH_PATH_VERTEX,this._materialStrings.GLSLX_SOURCE_SMOOTH_PATH_FRAGMENT)}pixelScale(){return this._pixelScale}setTransformAndPixelScale(O,R){3!=0,yt.Material_setUniformMat32(this._material,this._materialStrings.GLSLX_NAME_U_VERTEX_TRANSFORM,O),this._pixelScale=R}flush(){let O=this._pool.allocate(g.getPositionF4CoordB4(),this._vertices.bytes());O!=null&&(de.Context_setPremultipliedBlendState(this._context),this._context.draw(1,this._material,O),O.free()),this._vertices.clear()}_loadPoints(O){this._rectPoints[0].setTo(O.left(),O.top()),this._rectPoints[1].setTo(O.right(),O.top()),this._rectPoints[2].setTo(O.right(),O.bottom()),this._rectPoints[3].setTo(O.left(),O.bottom())}fillRect(O,R){this._loadPoints(O),this.fillConvexPolygon(this._rectPoints,R)}strokeRect(O,R,V){this._loadPoints(O),this.strokeNonOverlappingPolyline(this._rectPoints,R,V,x.Loop.CLOSED)}fillConvexPolygon(O,R){let V=this._inside,W=this._outside,j=O.length;if(!(j<3)){for(R=E.premultiplied(R);V.length<j;)V.push(I.new2()),W.push(I.new2());for(let se=0,he=j;se<he;se=se+1){let ve=O[ht.int_remainder(se+j-1,j)],ct=O[se],qe=O[ht.int_remainder(se+1,j)],De=ve.y()-ct.y(),B=ct.x()-ve.x(),U=this._length(De,B),Z=ct.y()-qe.y(),ae=qe.x()-ct.x(),ce=this._length(Z,ae),me=De/U+Z/ce,fe=B/U+ae/ce,Oe=.5*this._pixelScale*U/(De*me+B*fe),Se=me*Oe,be=fe*Oe;W[se].setTo(ct.x()-Se,ct.y()-be),V[se].setTo(ct.x()+Se,ct.y()+be)}for(let se=0,he=j-1;se<=he;se=se+1,he=he-1){let ve=V[se],ct=V[he];this._appendVertex(ve.x(),ve.y(),1,1,R),se==0&&this._appendPreviousVertex(),se<he&&this._appendVertex(ct.x(),ct.y(),1,1,R)}this._appendPreviousVertex();for(let se=0;se<=j;se=se+1){let he=ht.int_remainder(se,j),ve=V[he],ct=W[he];this._appendVertex(ct.x(),ct.y(),0,0,R),se==0&&this._appendPreviousVertex(),this._appendVertex(ve.x(),ve.y(),1,1,R)}this._appendPreviousVertex()}}strokeNonOverlappingPolyline(O,R,V,W){let j=(V+this._pixelScale)/this._pixelScale,se=(V+this._pixelScale)/2,he=O.length;if(he<2)return;if(R=E.premultiplied(R),W==x.Loop.OPEN){let qe=O[0],De=O[1],B=De.x()-qe.x(),U=De.y()-qe.y(),Z=this._length(B,U),ae=.5*this._pixelScale/Z,ce=B*ae,me=U*ae,fe=se/Z,Oe=-U*fe,Se=B*fe;this._appendVertex(qe.x()-ce-Oe,qe.y()-me-Se,0,-j,R),this._appendPreviousVertex(),this._appendVertex(qe.x()-ce+Oe,qe.y()-me+Se,-j,0,R),this._appendVertex(qe.x()+ce-Oe,qe.y()+me-Se,0,j,R),this._appendVertex(qe.x()+ce+Oe,qe.y()+me+Se,j,0,R)}let ve=W==x.Loop.CLOSED?0:1,ct=W==x.Loop.CLOSED?he+1:he-1;for(let qe=ve,De=ct;qe<De;qe=qe+1){let B=O[ht.int_remainder(qe+he-1,he)],U=O[ht.int_remainder(qe,he)],Z=O[ht.int_remainder(qe+1,he)],ae=B.y()-U.y(),ce=U.x()-B.x(),me=this._length(ae,ce),fe=U.y()-Z.y(),Oe=Z.x()-U.x(),Se=this._length(fe,Oe),be=ae/me+fe/Se,Qe=ce/me+Oe/Se,Me=se*me/(ae*be+ce*Qe),Le=be*Me,dt=Qe*Me;this._appendVertex(U.x()-Le,U.y()-dt,0,j,R),qe==0&&this._appendPreviousVertex(),this._appendVertex(U.x()+Le,U.y()+dt,j,0,R)}if(W==x.Loop.OPEN){let qe=O[he-2],De=O[he-1],B=De.x()-qe.x(),U=De.y()-qe.y(),Z=this._length(B,U),ae=.5*this._pixelScale/Z,ce=B*ae,me=U*ae,fe=se/Z,Oe=-U*fe,Se=B*fe;this._appendVertex(De.x()-ce-Oe,De.y()-me-Se,0,j,R),this._appendVertex(De.x()-ce+Oe,De.y()-me+Se,j,0,R),this._appendVertex(De.x()+ce-Oe,De.y()+me-Se,0,-j,R),this._appendVertex(De.x()+ce+Oe,De.y()+me+Se,-j,0,R)}this._appendPreviousVertex()}_appendVertex(O,R,V,W,j){this._previousX=O,this._previousY=R,this._previousU=V,this._previousV=W,this._previousColor=j,this._vertices.appendFloat(O).appendFloat(R).appendFloat(V).appendFloat(W),this._vertices.appendByte(E.red(j)).appendByte(E.green(j)).appendByte(E.blue(j)).appendByte(E.alpha(j))}_appendPreviousVertex(){this._appendVertex(this._previousX,this._previousY,this._previousU,this._previousV,this._previousColor)}_length(O,R){return Math.sqrt(O*O+R*R)}}xe.SmoothPath=x,(R=>{let lt;(j=>(j[j.CLOSED=0]="CLOSED",j[j.OPEN=1]="OPEN"))(lt=R.Loop||(R.Loop={}));let O;(W=>{function V(j){return R.Loop[j]}W.Loop_toString=V})(O=R.in_Loop||(R.in_Loop={}))})(x=xe.SmoothPath||(xe.SmoothPath={}));let z;(R=>(R[R.WEBGL_TEXTURE=0]="WEBGL_TEXTURE",R[R.WEBGL_BUFFER=1]="WEBGL_BUFFER"))(z=xe.MemoryType||(xe.MemoryType={}));class ${increment(O,R,V){let W=null;this._vramUsedByTypeAndPurpose.has(O)?W=this._vramUsedByTypeAndPurpose.get(O):(W=new Map,this._vramUsedByTypeAndPurpose.set(O,W)),W.has(R)||W.set(R,0);let j=W.get(R)+V;W.set(R,j),wn.trackNumber(z[O]+` (${R})`,j/(1024*1024)|0)}decrement(O,R,V){this.increment(O,R,-V)}resetOnContextRestored(){this._vramUsedByTypeAndPurpose=new Map}constructor(){this._vramUsedByTypeAndPurpose=new Map}}xe.MemoryStats=$;let Qt=class Qt{stats(){return this._stats}width(){return this._cachedSize.x()|0}height(){return this._cachedSize.y()|0}maxTextureSize(){return this._cachedMaxTextureSize}_loadOESStandardDerivativesExtension(O){let R=this._gl.getExtension("OES_standard_derivatives");e(R!==null),O&&!xe._supportsWebGLExtensionOESStandardDerivatives&&Pe.trackEvent("missing_webgl_extensions",{extensions:["OES_standard_derivatives"]})}constructor(){this._stats=new $,this._attributeCount=0,this._currentBlendState=a.ZERO,this._currentBlendOperations=0,this._blendOperationMap=null,this._comparisonMap=null,this._contextResetHandlers=[],this._currentClearColor=E.TRANSPARENT,this._currentScissors=null,this._currentStencilState=u.NONE,this._currentFramebuffer=null,this._currentProgramInUse=null,this._currentVertexBuffer=null,this._currentVertexFormat=null,this._defaultViewport=G.new2(),this._forceStateUpdate=!0,this._generation=1,this._gl=null,this._oldBlendState=null,this._oldBlendOperations=0,this._oldScissors=null,this._oldStencilState=u.NONE,this._oldFramebuffer=null,this._oldViewport=G.new2(),this._operationMap=null,this._cachedGraphicsCardName=null,this._cachedMaxTextureSize=0,this._cachedSize=new I(0,0),this._mockMaximumDrawingBufferSize=null,this._materialsToCheckProgramCreationStatus=[],this._hasLoggedHighpPrecisionUnsupported=!1,this._shouldFlushAfterDraws=!1,this._boundWebGLFramebuffer=null,this._webGLFramebufferUsedForLastClearOrDraw=null,this._numFramebufferSwitches=0,this.hackToAvoidMissingTextureWarningInChrome=null;let O={antialias:!1,depth:!1,stencil:!1,alpha:!1,preserveDrawingBuffer:mi,powerPreference:"high-performance"};if(this._gl=no.HTMLCanvasElement_getContextWebGL2(Qr.HTMLDocument_createElementCanvas(document),O),this._gl==null)throw console.error("WebGL initialization failed"),new Error("Could not initialize WebGL");this._loadOESStandardDerivativesExtension(!0);let R=this._gl.canvas,V=R.style;R.width=0,R.height=0,V.display="block",V.left="0",V.top="0",Yt.EventTarget_addEventListener2(R,"webglcontextlost",W=>{console.warn("WebGL context was lost"),ko.Event_preventDefault(W)}),Yt.EventTarget_addEventListener1(R,"webglcontextrestored",()=>{console.warn("WebGL context was restored"),this._attributeCount=0,this._currentClearColor=E.TRANSPARENT,this._currentScissors=null,this._forceStateUpdate=!0,this._loadOESStandardDerivativesExtension(!1),this._generation=this._generation+1,this._stats.resetOnContextRestored();for(let W of this._contextResetHandlers)W()}),n(this._gl),this._blendOperationMap=new Map([[0,this._gl.ZERO],[1,this._gl.ONE],[2,this._gl.SRC_COLOR],[3,this._gl.DST_COLOR],[4,this._gl.ONE_MINUS_SRC_COLOR],[5,this._gl.ONE_MINUS_DST_COLOR],[6,this._gl.SRC_ALPHA],[7,this._gl.DST_ALPHA],[8,this._gl.ONE_MINUS_SRC_ALPHA],[9,this._gl.ONE_MINUS_DST_ALPHA],[10,this._gl.CONSTANT_COLOR],[11,this._gl.ONE_MINUS_CONSTANT_COLOR]]),this._comparisonMap=new Map([[0,this._gl.ALWAYS],[1,this._gl.EQUAL],[2,this._gl.GREATER],[3,this._gl.GEQUAL],[4,this._gl.LESS],[5,this._gl.LEQUAL],[6,this._gl.NEVER],[7,this._gl.NOTEQUAL]]),this._operationMap=new Map([[0,this._gl.DECR],[1,this._gl.DECR_WRAP],[2,this._gl.INCR],[3,this._gl.INCR_WRAP],[4,this._gl.INVERT],[5,this._gl.KEEP],[6,this._gl.REPLACE],[7,this._gl.ZERO]]),this._cachedMaxTextureSize=Math.min(4096,this._gl.getParameter(this._gl.MAX_TEXTURE_SIZE))|0,mn.setMaxRes(this._cachedMaxTextureSize),this.hackToAvoidMissingTextureWarningInChrome=new J(this,_.RGBA_NEAREST_CLAMP,1,1,new mn(0,1,1,new Uint8Array(4)),null,"ChromeHack"),this._shouldFlushAfterDraws=this._detectShouldFlushAfterDraws()}gl(){return this._gl}generation(){return this._generation}addContextResetHandler(O){ue.List_appendOne(this._contextResetHandlers,O)}removeContextResetHandler(O){ue.List_removeOne(this._contextResetHandlers,O)}currentFramebuffer(){return this._currentFramebuffer}currentStencilState(){return this._currentStencilState}currentBlendState(){return this._currentBlendState}beginFrame(){this._checkMaterialProgramCreationStatuses(),this.setFramebuffer(null)}endFrame(){}flush(){this._gl.flush()}readPixels(O,R,V,W,j){var ve;let se=new Uint8Array(W*j*4),he=(ve=oe.from(O))==null?void 0:ve.framebuffer();return this.bindWebGLFramebufferAndTrackForBudget(he),this._gl.readPixels(R,V,W,j,this.gl().RGBA,this.gl().UNSIGNED_BYTE,se),se}setBlendState(O){this._currentBlendState=O,this._currentBlendOperations=Qt._packBlendModes(O.sourceColor,O.targetColor,O.sourceAlpha,O.targetAlpha)}setViewport(O,R,V,W){this._currentFramebuffer!=null?this._currentFramebuffer.setViewport(O,R,V,W):this._defaultViewport.setTo1(O,R,V,W)}_reportClearOrDraw(){this._boundWebGLFramebuffer!=this._webGLFramebufferUsedForLastClearOrDraw&&this._numFramebufferSwitches++,this._webGLFramebufferUsedForLastClearOrDraw=this._boundWebGLFramebuffer}draw(O,R,V){V!=null&&kl.WebGLRenderingContext_annotateBlock(this._gl,`material:${R.name()}`,()=>{this._updateFramebufferAndViewport(),M.from(R).prepare(),te.from(V.buffer()).prepare(R.format()),this._updateDeferredStates(),this._gl.drawArrays(O==0?this._gl.TRIANGLES:this._gl.TRIANGLE_STRIP,V.byteOffset()/V.stride()|0,V.byteCount()/V.stride()|0),this._forceStateUpdate=!1,this._shouldFlushAfterDraws&&this.flush(),this._reportClearOrDraw()})}_setCanvasSize(O,R){this._mockMaximumDrawingBufferSize!=null&&(O=Math.min(this._mockMaximumDrawingBufferSize.value,O)|0,R=Math.min(this._mockMaximumDrawingBufferSize.value,R)|0);let V=O/rr(),W=R/rr(),j=this._gl.canvas;j.width=O,j.height=R,j.style.width=`${V}px`,j.style.height=`${W}px`;let se=this._gl.drawingBufferWidth,he=this._gl.drawingBufferHeight,ve=se!=O||he!=R;return ve&&(V=se/rr(),W=he/rr(),j.width=se,j.height=he,j.style.width=`${V}px`,j.style.height=`${W}px`),new h(new I(se,he),ve)}resize(O,R){let V=!1;if((this._cachedSize.x()|0)!=O||(this._cachedSize.y()|0)!=R){let W=this._setCanvasSize(O,R);this._cachedSize=W.canvasSize,V=W.webGLDidAdjustCanvasSize,this.setViewport(0,0,this._cachedSize.x()|0,this._cachedSize.y()|0)}return new h(this._cachedSize,V)}_detectShouldFlushAfterDraws(){return!!(["Adreno (TM) 725","Adreno (TM) 730","Adreno (TM) 740"].indexOf(this.graphicsCardName())!=-1||Y.shouldFlushAfterDraws())}_shouldFlushAfterClear(){return!!(Hi.hasDrawClearReorderingBug()||["Mesa Intel(R) Graphics (ADL GT2)","Mesa Intel(R) Xe Graphics (TGL GT2)"].indexOf(this.graphicsCardName())!=-1||Y.shouldFlushAfterClear())}clear2(O,R){var V,W;this._updateFramebufferAndViewport(),this._updateDeferredStates(),R!=this._currentClearColor&&(this._gl.clearColor(E.redF(R),E.greenF(R),E.blueF(R),E.alphaF(R)),this._currentClearColor=R),this._gl.clear((O!=2?this._gl.COLOR_BUFFER_BIT:0)|(O!=1?this._gl.DEPTH_BUFFER_BIT|this._gl.STENCIL_BUFFER_BIT:0)),this._shouldFlushAfterClear()&&this._gl.flush(),this._currentFramebuffer!=null&&((O==0||O==1)&&((V=this._currentFramebuffer.colorTexture())==null||V.markContentHasBeenInitialized()),(O==0||O==2)&&((W=this._currentFramebuffer.depthStencilTexture())==null||W.markContentHasBeenInitialized())),this._reportClearOrDraw()}setStencilState(O){this._currentStencilState=O}setFramebuffer(O){var R;this._currentFramebuffer=oe.from(O),(R=this._currentFramebuffer)==null||R.updateScissor()}setScissor(O){O==null?this._currentScissors=null:(this._currentScissors==null&&(this._currentScissors=G.new2()),this._currentScissors.copyFrom(O))}useProgram(O){(this._forceStateUpdate||this._currentProgramInUse!=O)&&(this._gl.useProgram(O),this._currentProgramInUse=O)}bindVertexBufferWithFormat(O,R){if((this._forceStateUpdate||this._currentVertexBuffer!=O)&&(this._gl.bindBuffer(this._gl.ARRAY_BUFFER,O),this._currentVertexBuffer=O,this._currentVertexFormat=null),this._currentVertexFormat!=R){let V=this._gl,W=R.attributes(),j=W.length;for(let se=0,he=j;se<he;se=se+1){let ve=W[se],ct=ve.type==1;V.vertexAttribPointer(se,ve.count,ct?V.UNSIGNED_BYTE:V.FLOAT,ct,R.stride(),ve.byteOffset)}for(;this._attributeCount<j;)V.enableVertexAttribArray(this._attributeCount),this._attributeCount=this._attributeCount+1;for(;this._attributeCount>j;)this._attributeCount=this._attributeCount-1,V.disableVertexAttribArray(this._attributeCount);this._attributeCount=j,this._currentVertexFormat=R}}isContextLost(){return this._gl.isContextLost()}graphicsCardName(){if(this._cachedGraphicsCardName!=null)return this._cachedGraphicsCardName;let O=this._gl.getExtension("WEBGL_debug_renderer_info");return O===null?this._cachedGraphicsCardName="Unknown":this._cachedGraphicsCardName=this._gl.getParameter(O.UNMASKED_RENDERER_WEBGL),this._cachedGraphicsCardName}setMaximumDrawingBufferSizeForTesting(O){this._mockMaximumDrawingBufferSize=new _e(O)}clearMaximumDrawingBufferSizeForTesting(){this._mockMaximumDrawingBufferSize=null}createMaterial(O,R,V,W){return new M(this,O,R,V,W)}createVertexBuffer(O){return new te(this,O)}createTexture2(O,R,V,W,j){return new J(this,O,R,V,new mn(0,R,V,W),null,j)}createTexture3(O,R,V){return new J(this,O,R.videoWidth,R.videoHeight,null,R,V)}createFramebuffer(O,R,V){return new oe(this,J.from(O),J.from(R),V)}annotate(O,R){R()}annotateAndReturn(O,R){return R()}addMaterialToCheckProgramCreationStatusAsync(O){this._materialsToCheckProgramCreationStatus.push(O)}_checkMaterialProgramCreationStatuses(){if(this._materialsToCheckProgramCreationStatus.length!=0){for(let O of this._materialsToCheckProgramCreationStatus)O.haveCheckedProgramCreationStatus()||O.checkProgramCreationStatus();this._materialsToCheckProgramCreationStatus.length=0}}annotateProfile(O,R){R()}takeSpectorSnapshot(){le.takeSnapshot(this.gl().canvas)}_updateFramebufferAndViewport(){let O=this._currentFramebuffer,R=O!=null?O.viewport():this._defaultViewport,V=this._gl;if(this._forceStateUpdate||this._oldFramebuffer!=O){let W=O==null?void 0:O.framebuffer();this.bindWebGLFramebufferAndTrackForBudget(W),this._oldFramebuffer=O,Hi.hasViewportBug()&&this._oldViewport.equals(R)&&(this._oldViewport.setX(R.x()+1),V.viewport(this._oldViewport.x()|0,this._oldViewport.y()|0,this._oldViewport.width()|0,this._oldViewport.height()|0),V.clear(0))}(this._forceStateUpdate||!this._oldViewport.equals(R))&&(V.viewport(R.x()|0,R.y()|0,R.width()|0,R.height()|0),this._oldViewport.copyFrom(R))}_updateDeferredStates(){this._updateBlendState(),this._updateStencilState(),this._updateScissorState()}_updateBlendState(){if(this._forceStateUpdate||this._oldBlendOperations!=this._currentBlendOperations||this._oldBlendState.constant!=this._currentBlendState.constant){let O=this._gl,R=this._currentBlendOperations,V=this._oldBlendOperations,W=R&255,j=R>>8&255,se=R>>16&255,he=R>>24,ve=this._currentBlendState.constant;R==Qt.KEEP_BLEND_OPERATIONS?O.colorMask(!1,!1,!1,!1):((this._forceStateUpdate||V==Qt.KEEP_BLEND_OPERATIONS)&&O.colorMask(!0,!0,!0,!0),R==Qt.COPY_BLEND_OPERATIONS?O.disable(O.BLEND):((this._forceStateUpdate||V==Qt.COPY_BLEND_OPERATIONS||V==Qt.KEEP_BLEND_OPERATIONS)&&O.enable(O.BLEND),O.blendFuncSeparate(this._blendOperationMap.get(W),this._blendOperationMap.get(j),this._blendOperationMap.get(se),this._blendOperationMap.get(he)),O.blendColor(ve,ve,ve,ve))),this._oldBlendState=this._currentBlendState,this._oldBlendOperations=R}}_updateStencilState(){let O=this._gl,R=this._oldStencilState,V=this._currentStencilState,W=V.frontFace,j=V.backFace,se=W==j?O.FRONT_AND_BACK:O.FRONT;(this._forceStateUpdate||!R.equals(V))&&((this._forceStateUpdate||R.isEnabled!=V.isEnabled)&&(V.isEnabled?O.enable(O.STENCIL_TEST):O.disable(O.STENCIL_TEST)),O.stencilFuncSeparate(se,this._comparisonMap.get(W.comparison),W.reference,W.readMask),O.stencilOpSeparate(se,this._operationMap.get(W.stencilFail),this._operationMap.get(W.stencilPassDepthFail),this._operationMap.get(W.stencilPassDepthPass)),O.stencilMaskSeparate(se,W.writeMask),W!=j&&(O.stencilFuncSeparate(O.BACK,this._comparisonMap.get(j.comparison),j.reference,j.readMask),O.stencilOpSeparate(O.BACK,this._operationMap.get(j.stencilFail),this._operationMap.get(j.stencilPassDepthFail),this._operationMap.get(j.stencilPassDepthPass)),O.stencilMaskSeparate(O.BACK,j.writeMask)),this._oldStencilState=V)}_updateScissorState(){this._currentScissors==null?(this._oldScissors!=null&&this._gl.disable(this._gl.SCISSOR_TEST),this._oldScissors=null):(this._oldScissors==null&&this._gl.enable(this._gl.SCISSOR_TEST),(this._oldScissors==null||!this._currentScissors.equals(this._oldScissors))&&(this._gl.scissor(this._currentScissors.x()|0,this._currentScissors.y()|0,Math.max(this._currentScissors.width(),0)|0,Math.max(this._currentScissors.height(),0)|0),this._oldScissors==null&&(this._oldScissors=G.new2()),this._oldScissors.copyFrom(this._currentScissors)))}hasLoggedHighpPrecisionUnsupported(){return this._hasLoggedHighpPrecisionUnsupported}setHasLoggedHighpPrecisionUnsupported(){this._hasLoggedHighpPrecisionUnsupported=!0}static from(O){return O}static _packBlendModes(O,R,V,W){return O|R<<8|V<<16|W<<24}getNumFramebufferSwitches(){return this._numFramebufferSwitches}resetNumFramebufferSwitches(){this._numFramebufferSwitches=0}bindWebGLFramebufferAndTrackForBudget(O){this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,O),this._boundWebGLFramebuffer=O}};Qt.COPY_BLEND_OPERATIONS=Qt._packBlendModes(1,0,1,0),Qt.KEEP_BLEND_OPERATIONS=Qt._packBlendModes(0,1,0,1);let q=Qt;xe.HTMLContext=Qt;class K{location(){let O=q.from(this._material.context());if(this._generation!=O.generation()&&(this._location=O.gl().getUniformLocation(this._material.program(),this._name),this._generation=O.generation(),!1)){for(let W=0,j=V.getProgramParameter(R,V.ACTIVE_UNIFORMS);W<j;W=W+1)if(se.name==this._name)switch(se.type){case V.FLOAT:case V.FLOAT_MAT3:case V.FLOAT_VEC2:case V.FLOAT_VEC3:case V.FLOAT_VEC4:case V.INT:case V.BOOL:case V.SAMPLER_2D:default:}}return this._location}constructor(O,R){this._material=O,this._name=R,this._generation=0,this._location=null,this._isDirty=!0}}xe.HTMLUniform=K;class F extends K{constructor(R,V){super(R,V);this._x=0}set(R){R!=this._x&&(this._x=R,this._isDirty=!0)}prepare(){let R=q.from(this._material.context());(this._generation!=R.generation()||this._isDirty)&&(R.gl().uniform1f(this.location(),this._x),this._isDirty=!1)}}xe.HTMLUniformFloat=F;class P extends K{constructor(R,V){super(R,V);this._x=0}set(R){R!=this._x&&(this._x=R,this._isDirty=!0)}prepare(){let R=q.from(this._material.context());(this._generation!=R.generation()||this._isDirty)&&(R.gl().uniform1i(this.location(),this._x),this._isDirty=!1)}}xe.HTMLUniformInt=P;class k extends K{constructor(R,V){super(R,V);this._x=0,this._y=0}set(R,V){(R!=this._x||V!=this._y)&&(this._x=R,this._y=V,this._isDirty=!0)}prepare(){let R=q.from(this._material.context());(this._generation!=R.generation()||this._isDirty)&&(R.gl().uniform2f(this.location(),this._x,this._y),this._isDirty=!1)}}xe.HTMLUniformVec2=k;class H extends K{constructor(R,V){super(R,V);this._x=0,this._y=0,this._z=0}set(R,V,W){(R!=this._x||V!=this._y||W!=this._z)&&(this._x=R,this._y=V,this._z=W,this._isDirty=!0)}prepare(){let R=q.from(this._material.context());(this._generation!=R.generation()||this._isDirty)&&(R.gl().uniform3f(this.location(),this._x,this._y,this._z),this._isDirty=!1)}}xe.HTMLUniformVec3=H;class L extends K{constructor(R,V){super(R,V);this._x=0,this._y=0,this._z=0,this._w=0}set(R,V,W,j){(R!=this._x||V!=this._y||W!=this._z||j!=this._w)&&(this._x=R,this._y=V,this._z=W,this._w=j,this._isDirty=!0)}prepare(){let R=q.from(this._material.context());(this._generation!=R.generation()||this._isDirty)&&(R.gl().uniform4f(this.location(),this._x,this._y,this._z,this._w),this._isDirty=!1)}}xe.HTMLUniformVec4=L;let ln=class ln extends K{constructor(R,V){super(R,V);this._values=[1,0,0,0,1,0,0,0,1]}set(R,V,W,j,se,he,ve,ct,qe){ln._cachedValues[0]=R,ln._cachedValues[1]=j,ln._cachedValues[2]=ve,ln._cachedValues[3]=V,ln._cachedValues[4]=se,ln._cachedValues[5]=ct,ln._cachedValues[6]=W,ln._cachedValues[7]=he,ln._cachedValues[8]=qe;for(let De=0;De<9;De=De+1)if(ln._cachedValues[De]!=this._values[De]){let B=this._values;this._values=ln._cachedValues,ln._cachedValues=B,this._isDirty=!0;break}}prepare(){let R=q.from(this._material.context());(this._generation!=R.generation()||this._isDirty)&&(R.gl().uniformMatrix3fv(this.location(),!1,this._values),this._isDirty=!1)}};ln._cachedValues=[1,0,0,0,1,0,0,0,1];let Q=ln;xe.HTMLUniformMat3=ln;class X extends K{constructor(R,V){super(R,V);this._texture=null,this._index=-1}set(R,V){(this._texture!=R||this._index!=V)&&(this._texture=J.from(R),this._index=V,this._isDirty=!0)}prepare(){let R=q.from(this._material.context()),V=this._texture,W=R.gl();V==null&&(V=R.hackToAvoidMissingTextureWarningInChrome),(this._generation!=R.generation()||this._isDirty)&&(W.uniform1i(this.location(),this._index),this._isDirty=!1),W.activeTexture(kl.WebGLRenderingContext_TEXTURE_N(W,this._index)),W.bindTexture(W.TEXTURE_2D,V.texture())}}xe.HTMLUniformSampler=X;class M{constructor(O,R,V,W,j){this._context=null,this._name=null,this._format=null,this._vertexSource=null,this._fragmentSource=null,this._uniformsMap=new Map,this._uniformsList=[],this._generation=0,this._program=null,this._haveCheckedProgramCreationStatus=!1,this._context=O,this._name=R,this._format=V,this._vertexSource=W,this._fragmentSource=j,this._createProgram(),this._context.addMaterialToCheckProgramCreationStatusAsync(this)}context(){return this._context}name(){return this._name}format(){return this._format}setUniformFloat(O,R){let V=Be.StringMap_get(this._uniformsMap,O,null);V==null&&(V=new F(this,O),this._uniformsMap.set(O,V),this._uniformsList.push(V)),V.set(R)}setUniformInt(O,R){let V=Be.StringMap_get(this._uniformsMap,O,null);V==null&&(V=new P(this,O),this._uniformsMap.set(O,V),this._uniformsList.push(V)),V.set(R)}setUniformVec21(O,R,V){let W=Be.StringMap_get(this._uniformsMap,O,null);W==null&&(W=new k(this,O),this._uniformsMap.set(O,W),this._uniformsList.push(W)),W.set(R,V)}setUniformVec3(O,R,V,W){let j=Be.StringMap_get(this._uniformsMap,O,null);j==null&&(j=new H(this,O),this._uniformsMap.set(O,j),this._uniformsList.push(j)),j.set(R,V,W)}setUniformVec41(O,R,V,W,j){let se=Be.StringMap_get(this._uniformsMap,O,null);se==null&&(se=new L(this,O),this._uniformsMap.set(O,se),this._uniformsList.push(se)),se.set(R,V,W,j)}setUniformMat31(O,R,V,W,j,se,he,ve,ct,qe){let De=Be.StringMap_get(this._uniformsMap,O,null);De==null&&(De=new Q(this,O),this._uniformsMap.set(O,De),this._uniformsList.push(De)),De.set(R,V,W,j,se,he,ve,ct,qe)}setUniformSampler(O,R,V){let W=Be.StringMap_get(this._uniformsMap,O,null);W==null&&(W=new X(this,O),this._uniformsMap.set(O,W),this._uniformsList.push(W)),W.set(R,V)}program(){return this._generation!=this._context.generation()&&(this._createProgram(),this.checkProgramCreationStatus()),this._program}prepare(){this._context.useProgram(this.program());for(let O of this._uniformsList)O.prepare()}haveCheckedProgramCreationStatus(){return this._haveCheckedProgramCreationStatus}checkProgramCreationStatus(){if(this._generation!=this._context.generation())return;let O=this._context.gl();if((()=>{if(O.getProgramParameter(this._program,O.LINK_STATUS))return;let V=se=>se.replace(new RegExp("\\bhighp\\b","g"),"mediump"),W=O.getAttachedShaders(this._program),j=!1;for(let se of W){if(O.getShaderParameter(se,O.COMPILE_STATUS))continue;j=!0;let he=O.getShaderParameter(se,O.SHADER_TYPE);if(he===O.VERTEX_SHADER)this._vertexSource=V(this._vertexSource);else if(he===O.FRAGMENT_SHADER)this._fragmentSource=V(this._fragmentSource);else{if(O.isContextLost())return;throw new Error(`Unexpected shader type: ${he}`)}}if(!j){if(O.isContextLost())return;throw new Error(`Failed to link shader ${this.name()}: ${O.getProgramInfoLog(this._program)}`)}if(this._createProgram(),O.getProgramParameter(this._program,O.LINK_STATUS)){this.context().hasLoggedHighpPrecisionUnsupported()||(Pe.trackEvent("highp_unsupported_device",{}),this.context().setHasLoggedHighpPrecisionUnsupported());return}W=O.getAttachedShaders(this._program);for(let se of W)if(!O.getShaderParameter(se,O.COMPILE_STATUS)){if(O.isContextLost())return;{let he=O.getShaderInfoLog(se);throw new Error(he)}}if(!O.isContextLost())throw new Error(`Failed to link shader ${this.name()}: ${O.getProgramInfoLog(this._program)}`)})(),!1){for(let V of this.format().attributes())for(let W=0,j=O.getProgramParameter(this._program,O.ACTIVE_ATTRIBUTES);W<j;W=W+1)if(se.name==V.name)switch(V.count){case 1:case 2:case 3:case 4:default:}}this._haveCheckedProgramCreationStatus=!0}_createProgram(){let O=this._context.gl();this._program=O.createProgram(),le.addDebugMetadataToWebGLObject(this._program,{name:this._name}),this._compileShader(O,O.VERTEX_SHADER,this._vertexSource),this._compileShader(O,O.FRAGMENT_SHADER,this._fragmentSource);let R=this.format().attributes();for(let V=0,W=R.length;V<W;V=V+1)O.bindAttribLocation(this._program,V,R[V].name);O.linkProgram(this._program),this._generation=this._context.generation(),this._haveCheckedProgramCreationStatus=!1}_compileShader(O,R,V){let W=O.createShader(R);O.shaderSource(W,V),O.compileShader(W),O.attachShader(this._program,W)}static from(O){return O}}xe.HTMLMaterial=M;let tr=class tr{constructor(O,R){this._context=null,this._generation=0,this._buffer=null,this._bytes=null,this._isDirty=!0,this._dirtyMin=tr.INT_MAX,this._dirtyMax=0,this._totalMin=tr.INT_MAX,this._totalMax=0,this._byteCount=0,this._glByteCount=0,this._context=O,this._byteCount=R,this._bytes=new Uint8Array(R)}context(){return this._context}bytes(){return this._bytes}byteCount(){return this._byteCount}move(O,R,V){O!=R&&V!=0&&(this._bytes.set(this._bytes.subarray(O,O+V),R),this._growDirtyRegion(Math.min(O,R),Math.max(O,R)+V))}upload2(O,R){this._bytes.set(O,R),this._growDirtyRegion(R,R+O.length)}prepare(O){let R=this._context.gl();if(this._generation!=this._context.generation()&&(this._buffer=R.createBuffer(),le.addDebugMetadataToWebGLObject(this._buffer,{purpose:"Vertex Buffer"}),this._generation=this._context.generation(),this._isDirty=!0),this._context.bindVertexBufferWithFormat(this._buffer,O),this._isDirty){let V=this._glByteCount;R.bufferData(R.ARRAY_BUFFER,this._byteCount,R.DYNAMIC_DRAW),this._glByteCount=this.byteCount(),this._context.stats().increment(1,"all",this._glByteCount-V),this._dirtyMin=this._totalMin,this._dirtyMax=this._totalMax,this._isDirty=!1}this._dirtyMin<this._dirtyMax&&(R.bufferSubData(R.ARRAY_BUFFER,this._dirtyMin,this._bytes.subarray(this._dirtyMin,this._dirtyMax)),this._dirtyMin=tr.INT_MAX,this._dirtyMax=0)}_growDirtyRegion(O,R){this._dirtyMin=Math.min(this._dirtyMin,O),this._dirtyMax=Math.max(this._dirtyMax,R),this._totalMin=Math.min(this._totalMin,O),this._totalMax=Math.max(this._totalMax,R)}static from(O){return O}};tr.INT_MAX=2147483647;let te=tr;xe.HTMLVertexBuffer=tr;class J{context(){return this._context}format(){return this._format}width(){return this._width}height(){return this._height}hasContentBeenInitialized(){return this.isRenderbuffer()?this.renderbuffer():this.texture(),this._hasContentBeenInitialized}markContentHasBeenInitialized(){this._hasContentBeenInitialized=!0}setShouldUnloadImageBuffer(O){this._shouldUnloadImageBuffer=O}_currentGlTextureSizeInBytes(){let O=this._glTextureWidth*this._glTextureHeight*cn.PixelFormat_byteCount(this._format.pixelFormat);return this._useMipmap&&(O+=O*.33),O|0}deleteTexture(){this._texture!=null&&(this._context.gl().deleteTexture(this._texture),this._context.stats().decrement(0,this._purpose,this._currentGlTextureSizeInBytes()))}resize1(O,R,V,W){this._width=O,this._height=R,this._pixels=V,this._useMipmap=W,this._isContentDirty=!0}_needsUploadToGPUTexture(){return this._isContentDirty||this._video!=null}setFormat(O){this._format!=O&&(this._format=O,this._isFormatDirty=!0)}isRenderbuffer(){return this._format.pixelFormat==1}invalidateVideoFrame(){this._isVideoFrameDirty=!0}texture(){let O=this._context.gl();if(this._generation!=this._context.generation()&&(this._texture=O.createTexture(),le.addDebugMetadataToWebGLObject(this._texture,{purpose:this._purpose}),this._generation=this._context.generation(),this._isFormatDirty=!0,this._isContentDirty=!0,this._hasContentBeenInitialized=!1),this._isFormatDirty&&(O.bindTexture(O.TEXTURE_2D,this._texture),O.texParameteri(O.TEXTURE_2D,O.TEXTURE_MAG_FILTER,this.format().magFilter==0?O.NEAREST:O.LINEAR),O.texParameteri(O.TEXTURE_2D,O.TEXTURE_MIN_FILTER,this.format().minFilter==0?O.NEAREST:O.LINEAR),O.texParameteri(O.TEXTURE_2D,O.TEXTURE_WRAP_S,this.format().wrap==0?O.REPEAT:O.CLAMP_TO_EDGE),O.texParameteri(O.TEXTURE_2D,O.TEXTURE_WRAP_T,this.format().wrap==0?O.REPEAT:O.CLAMP_TO_EDGE),this._isFormatDirty=!1),this._needsUploadToGPUTexture()){let R=this._currentGlTextureSizeInBytes();if(O.bindTexture(O.TEXTURE_2D,this._texture),this._video!=null)this._isVideoFrameDirty&&(O.texImage2D(O.TEXTURE_2D,0,O.RGBA,O.RGBA,O.UNSIGNED_BYTE,this._video),this._isVideoFrameDirty=!1,this._hasContentBeenInitialized=!0);else{let W=this._pixels.pixels;W.img!=null?(O.texImage2D(O.TEXTURE_2D,0,O.RGBA,O.RGBA,O.UNSIGNED_BYTE,W.img),this._hasContentBeenInitialized=!0):W.canvas!=null?(O.texImage2D(O.TEXTURE_2D,0,O.RGBA,O.RGBA,O.UNSIGNED_BYTE,W.canvas),this._hasContentBeenInitialized=!0):(O.texImage2D(O.TEXTURE_2D,0,O.RGBA,this._width,this._height,0,O.RGBA,O.UNSIGNED_BYTE,W.array),this._hasContentBeenInitialized=W.array!=null),this._shouldUnloadImageBuffer&&(this._pixels=null)}this._glTextureWidth=this._width,this._glTextureHeight=this._height,this._useMipmap&&(O.generateMipmap(O.TEXTURE_2D),O.texParameteri(O.TEXTURE_2D,O.TEXTURE_MIN_FILTER,O.LINEAR_MIPMAP_LINEAR));let V=this._currentGlTextureSizeInBytes();this._context.stats().increment(0,this._purpose,V-R),this._isContentDirty=!1}return this._texture}renderbuffer(){let O=this._context.gl();return this._generation!=this._context.generation()&&(this._renderbuffer=O.createRenderbuffer(),le.addDebugMetadataToWebGLObject(this._renderbuffer,{purpose:this._purpose}),this._generation=this._context.generation(),this._isContentDirty=!0,this._hasContentBeenInitialized=!1),this._isContentDirty&&(O.bindRenderbuffer(O.RENDERBUFFER,this._renderbuffer),O.renderbufferStorage(O.RENDERBUFFER,O.DEPTH_STENCIL,this._width,this._height),this._isContentDirty=!1,this._hasContentBeenInitialized=!1),this._renderbuffer}static from(O){return O}constructor(O,R,V,W,j,se,he){this._context=O,this._format=R,this._width=V,this._height=W,this._pixels=j,this._video=se,this._purpose=he,this._shouldUnloadImageBuffer=!1,this._useMipmap=!1,this._renderbuffer=null,this._texture=null,this._generation=0,this._isFormatDirty=!0,this._isContentDirty=!0,this._isVideoFrameDirty=!0,this._hasContentBeenInitialized=!1,this._glTextureWidth=0,this._glTextureHeight=0}}xe.HTMLTexture=J;class oe{context(){return this._context}colorTexture(){return this._colorTexture}depthStencilTexture(){return this._depthStencilTexture}setColorTexture(O){this._colorTexture!=O&&(this._colorTexture=J.from(O),this._isDirty=!0)}resize(O,R){this._colorTexture!=null&&(O!=this._colorTexture.width()||R!=this._colorTexture.height())&&(this._colorTexture.resize1(O,R,null,!1),this._isDirty=!0),this._depthStencilTexture!=null&&(O!=this._depthStencilTexture.width()||R!=this._depthStencilTexture.height())&&(this._depthStencilTexture.resize1(O,R,null,!1),this._isDirty=!0)}viewport(){return this._viewport}setViewport(O,R,V,W){this._viewport.setTo1(O,R,V,W)}pushScissor1(O,R,V,W){let j=new G(O,R,V,W);this.pushScissor2(j)}pushScissor2(O){this._scissorStack.length!=0&&O.intersectWith(ue.List_last(this._scissorStack)),this._scissorStack.push(O),this.updateScissor()}popScissor(){ue.List_removeLast(this._scissorStack),this.updateScissor()}takeScissor(){let O=this._scissorStack.pop();return this.updateScissor(),O}takeAllScissors(){let O=this._scissorStack;return this._scissorStack=[],this.updateScissor(),O}replaceAllScissors(O){this._scissorStack=O,this.updateScissor()}scissors(){return this._scissorStack}clearScissors(){this._scissorStack.length=0}updateScissor(){this._context.setScissor(this._scissorStack.length==0?null:ue.List_last(this._scissorStack))}setDepthStencil(O){this._depthStencilTexture!=O&&(this._depthStencilTexture=J.from(O),this._isDirty=!0)}framebuffer(){let O=this._context.gl();return this._generation!=this._context.generation()&&(this._framebuffer=O.createFramebuffer(),le.addDebugMetadataToWebGLObject(this._framebuffer,{purpose:this._purpose}),this._generation=this._context.generation(),this._isDirty=!0),this._isDirty&&(this._context.bindWebGLFramebufferAndTrackForBudget(this._framebuffer),O.framebufferTexture2D(O.FRAMEBUFFER,O.COLOR_ATTACHMENT0,O.TEXTURE_2D,this._colorTexture.texture(),0),this._depthStencilTexture!=null&&O.framebufferRenderbuffer(O.FRAMEBUFFER,O.DEPTH_STENCIL_ATTACHMENT,O.RENDERBUFFER,this._depthStencilTexture.renderbuffer()),this._isDirty=!1),this._framebuffer}deleteTexture(){var O,R;(O=this._colorTexture)==null||O.deleteTexture(),(R=this._depthStencilTexture)==null||R.deleteTexture(),this._context.gl().deleteFramebuffer(this._framebuffer)}static from(O){return O}constructor(O,R,V,W){this._context=O,this._colorTexture=R,this._depthStencilTexture=V,this._purpose=W,this._scissorStack=[],this._framebuffer=null,this._generation=0,this._isDirty=!0,this._viewport=G.new2()}}xe.HTMLFramebuffer=oe;let le;(ve=>{function lt(ct){if(!window.spector){console.error("Can't take a Spector.js snapshot because Spector isn't loaded. Go here to install the Chrome extension: https://chrome.google.com/webstore/detail/spectorjs/denbgaamihkadbghdceggmchnflmhpmk?hl=en");return}window.spector.captureNextFrame(ct)}ve.takeSnapshot=lt;function O(ct,qe){}ve.addDebugMetadataToWebGLObject=O;function R(ct,qe){qe()}ve.annotate=R;function V(ct,qe){return qe()}ve.annotateAndReturn=V;function W(ct){ve._scopeStack.push(ct),se()}ve._beginScope=W;function j(ct){ve._scopeStack.pop(),se()}ve._endScope=j;function se(){if(ve._scopeStack.length==0)window.spector.clearMarker();else{let ct=ve._scopeStack.join(" > ");window.spector.setMarker(ct)}}ve._updateMarker=se,ve._scopeStack=[]})(le=xe.Spector||(xe.Spector={}));let tt;(O=>{function lt(R){return o[R]}O.BlendOperation_toString=lt})(tt=xe.in_BlendOperation||(xe.in_BlendOperation={}));let nt;(O=>{function lt(R){return s[R]}O.Clear_toString=lt})(nt=xe.in_Clear||(xe.in_Clear={}));let At;(O=>{function lt(R){return l[R]}O.Primitive_toString=lt})(At=xe.in_Primitive||(xe.in_Primitive={}));let Lt;(O=>{function lt(R){return d[R]}O.Comparison_toString=lt})(Lt=xe.in_Comparison||(xe.in_Comparison={}));let Tt;(O=>{function lt(R){return c[R]}O.StencilOperation_toString=lt})(Tt=xe.in_StencilOperation||(xe.in_StencilOperation={}));let de;(ct=>{function lt(qe,De){qe.clear2(De,E.TRANSPARENT)}ct.Context_clear1=lt;function O(qe,De,B,U,Z){return qe.createTexture2(De,B,U,null,Z)}ct.Context_createTexture1=O;function R(qe){qe.setBlendState(a.COPY)}ct.Context_setCopyBlendState=R;function V(qe){qe.setBlendState(a.KEEP)}ct.Context_setKeepBlendState=V;function W(qe,De){qe.setBlendState(a.createInterpolateBlendState(De))}ct.Context_setInterpolateBlendState=W;function j(qe){qe.setBlendState(a.PREMULTIPLIED)}ct.Context_setPremultipliedBlendState=j;function se(qe){qe.setBlendState(a.PREMULTIPLIED_SOURCE_UNDER_TARGET)}ct.Context_setPremultipliedSourceUnderTargetState=se;function he(qe){qe.setBlendState(a.UNPREMULTIPLIED)}ct.Context_setUnpremultipliedBlendState=he;function ve(qe){qe.setBlendState(a.SCREEN)}ct.Context_setScreenBlendState=ve})(de=xe.in_Context||(xe.in_Context={}));let yt;(W=>{function lt(j,se,he){j.setUniformVec21(se,he.x(),he.y())}W.Material_setUniformVec22=lt;function O(j,se,he){j.setUniformVec41(se,E.redF(he),E.greenF(he),E.blueF(he),E.alphaF(he))}W.Material_setUniformVec42=O;function R(j,se,he){j.setUniformVec41(se,he.x(),he.y(),he.x()+he.width(),he.y()+he.height())}W.Material_setUniformVec43=R;function V(j,se,he){j.setUniformMat31(se,he.m00(),he.m01(),he.m02(),he.m10(),he.m11(),he.m12(),0,0,1)}W.Material_setUniformMat32=V})(yt=xe.in_Material||(xe.in_Material={}));let er;(O=>{function lt(R){return f[R]}O.AttributeType_toString=lt})(er=xe.in_AttributeType||(xe.in_AttributeType={}));let Wt;(O=>{function lt(R,V){R.upload2(V,0)}O.VertexBuffer_upload1=lt})(Wt=xe.in_VertexBuffer||(xe.in_VertexBuffer={}));let cn;(R=>{function lt(V){return 4}R.PixelFormat_byteCount=lt;function O(V){return A[V]}R.PixelFormat_toString=O})(cn=xe.in_PixelFormat||(xe.in_PixelFormat={}));let Ot;(O=>{function lt(R){return T[R]}O.PixelFilter_toString=lt})(Ot=xe.in_PixelFilter||(xe.in_PixelFilter={}));let st;(O=>{function lt(R){return b[R]}O.PixelWrap_toString=lt})(st=xe.in_PixelWrap||(xe.in_PixelWrap={}));let ut;(V=>{function lt(W,j,se){W.resize1(j,se,null,!1)}V.Texture_resize2=lt;function O(W,j,se,he){W.resize1(j,se,he,!1)}V.Texture_resize3=O;function R(W){return W.width()*W.height()*cn.PixelFormat_byteCount(W.format().pixelFormat)}V.Texture_totalVRAM=R})(ut=xe.in_Texture||(xe.in_Texture={}));let Ge;(O=>{function lt(R){return z[R]}O.MemoryType_toString=lt})(Ge=xe.in_MemoryType||(xe.in_MemoryType={})),xe._supportsWebGLExtensionOESStandardDerivatives=!0,xe.DISABLE_BUFFER_ASSERT=!0})(w||(w={}));var is=class is{static instance(){return is._instance==null&&(is._instance=new is),is._instance}requestLibrary(){this.startLibLoad()}onLoadComplete(e){this._videoJsLib=e,this.onSuccess!=null&&this.onSuccess()}hasRequestedLibrary(){return this._requestStarted}isLibAvailable(){return this._videoJsLib!==null}getPlayer(e){return this._videoJsLib===null?(console.warn("VideoJS used before initialized"),null):this._videoJsLib.videoJs(e).player()}constructor(){this._videoJsLib=null,this._requestStarted=!1,this.startLibLoad=null,this.onSuccess=null}};is._instance=null;var io=is,cu;(e=>{function i(t){let n=document.getElementById(t.id());return(n==null?void 0:n.getElementsByTagName("video"))[0]}e.VideoJsPlayer_getBackingVideo=i})(cu||(cu={}));var ne=class i{constructor(e,t,n,r,o,a){this._m00=0,this._m01=0,this._m02=0,this._m10=0,this._m11=0,this._m12=0,this._m00=e,this._m01=t,this._m02=n,this._m10=r,this._m11=o,this._m12=a}m00(){return this._m00}m01(){return this._m01}m02(){return this._m02}m10(){return this._m10}m11(){return this._m11}m12(){return this._m12}setM00(e){this._m00=e}setM01(e){this._m01=e}setM02(e){this._m02=e}setM10(e){this._m10=e}setM11(e){this._m11=e}setM12(e){this._m12=e}axisX(){return new I(this.m00(),this.m10())}axisY(){return new I(this.m01(),this.m11())}clone(){return new i(this.m00(),this.m01(),this.m02(),this.m10(),this.m11(),this.m12())}toAngle(){return Math.atan2(-this.m01(),this.m00())}scale1(){return new I(Math.sqrt(this.m00()*this.m00()+this.m10()*this.m10()),Math.sqrt(this.m01()*this.m01()+this.m11()*this.m11()))}hasPerpendicularAxes(e){return Math.abs(this.m00()*this.m10()+this.m01()*this.m11())<e}isAxisAligned(e){return Math.abs(this.m00())<e&&Math.abs(this.m11())<e||Math.abs(this.m01())<e&&Math.abs(this.m10())<e}isAxisAlignedScaleInvariant(e){let t=Math.sqrt(this._m00*this._m00+this._m10*this._m10)*e,n=Math.sqrt(this._m01*this._m01+this._m11*this._m11)*e;return Math.abs(this.m00())<t&&Math.abs(this.m11())<n||Math.abs(this.m01())<t&&Math.abs(this.m10())<n}valueEquals(e,t){return e==t||isNaN(e)&&isNaN(t)}equals1(e){return this.valueEquals(this._m00,e.m00())&&this.valueEquals(this._m01,e.m01())&&this.valueEquals(this._m02,e.m02())&&this.valueEquals(this._m10,e.m10())&&this.valueEquals(this._m11,e.m11())&&this.valueEquals(this._m12,e.m12())}equals2(e,t){return Math.abs(this._m00-e.m00())<t&&Math.abs(this._m01-e.m01())<t&&Math.abs(this._m02-e.m02())<t&&Math.abs(this._m10-e.m10())<t&&Math.abs(this._m11-e.m11())<t&&Math.abs(this._m12-e.m12())<t}translation(){return new I(this._m02,this._m12)}translate1(e){this.translate2(e.x(),e.y())}translate2(e,t){this._m02+=e*this.m00()+t*this.m01(),this._m12+=e*this.m10()+t*this.m11()}translatedBy1(e){return this.translate1(e),this}translatedBy2(e,t){return this.translate2(e,t),this}rotatedBy(e){return this.rotate(e),this}rotate(e){let t=Math.sin(e),n=Math.cos(e),r=n*this.m00()+t*this.m01(),o=n*this.m01()-t*this.m00(),a=n*this.m10()+t*this.m11(),s=n*this.m11()-t*this.m10();this._m00=r,this._m01=o,this._m10=a,this._m11=s}scale2(e){this.scale4(e,e)}scale3(e){this.scale4(e.x(),e.y())}scale4(e,t){this._m00*=e,this._m01*=t,this._m10*=e,this._m11*=t}skewX(e){let t=Math.tan(e);this._m01+=this._m00*t,this._m11+=this._m10*t}skewY(e){let t=Math.tan(e);this._m00+=this._m01*t,this._m10+=this._m10*t}scaledBy1(e){return this.scale3(e),this}scaledBy2(e){return this.scale2(e),this}scaledBy3(e,t){return this.scale4(e,t),this}multiply(e){let t=this.m00()*e.m00()+this.m01()*e.m10(),n=this.m00()*e.m01()+this.m01()*e.m11(),r=this.m00()*e.m02()+this.m01()*e.m12()+this.m02(),o=this.m10()*e.m00()+this.m11()*e.m10(),a=this.m10()*e.m01()+this.m11()*e.m11(),s=this.m10()*e.m02()+this.m11()*e.m12()+this.m12();this._m00=t,this._m01=n,this._m02=r,this._m10=o,this._m11=a,this._m12=s}rightMultiply(e){this.multiply(e)}leftMultiply(e){let t=this.m00()*e.m00()+this.m10()*e.m01(),n=this.m01()*e.m00()+this.m11()*e.m01(),r=this.m02()*e.m00()+this.m12()*e.m01()+e.m02(),o=this.m00()*e.m10()+this.m10()*e.m11(),a=this.m01()*e.m10()+this.m11()*e.m11(),s=this.m02()*e.m10()+this.m12()*e.m11()+e.m12();this._m00=t,this._m01=n,this._m02=r,this._m10=o,this._m11=a,this._m12=s}multipliedBy1(e){return this.multiply(e),this}multipliedBy2(e){return this.multipliedBy1(vt.FrozenAffineTransform_new6(e))}invert(){let e=1/(this.m00()*this.m11()-this.m01()*this.m10());if(!isFinite(e))return!1;let t=this.m11()*e,n=-this.m01()*e,r=(this.m01()*this.m12()-this.m11()*this.m02())*e,o=-this.m10()*e,a=this.m00()*e,s=(this.m10()*this.m02()-this.m00()*this.m12())*e;return this._m00=t,this._m01=n,this._m02=r,this._m10=o,this._m11=a,this._m12=s,!0}inverse(){let e=this.clone(),t=e.invert();return e}transformPoint(e){let t=this.m00()*e.x()+this.m01()*e.y()+this.m02(),n=this.m10()*e.x()+this.m11()*e.y()+this.m12();return e.setX(t),e.setY(n),e}transformPoints(e){for(let t=0,n=e.length;t<n;t=t+1){let r=e[t],o=this.m00()*r.x()+this.m01()*r.y()+this.m02(),a=this.m10()*r.x()+this.m11()*r.y()+this.m12();r.setX(o),r.setY(a)}return e}transformDirection(e){let t=this.m00()*e.x()+this.m01()*e.y(),n=this.m10()*e.x()+this.m11()*e.y();return e.setX(t),e.setY(n),e}transformRect(e){if(e.isInvalid())return e.copyFrom(G.INVALID);if(!e.isFinite())return e.copyFrom(G.INFINITE);let t=new _t;return t.include2(this.transformPoint(e.topLeft())),t.include2(this.transformPoint(e.topRight())),t.include2(this.transformPoint(e.bottomLeft())),t.include2(this.transformPoint(e.bottomRight())),t.buildTo(e),e}setTo(e,t,n,r,o,a){return this._m00=e,this._m01=t,this._m02=n,this._m10=r,this._m11=o,this._m12=a,this}copyFrom(e){return this._m00=e.m00(),this._m01=e.m01(),this._m02=e.m02(),this._m10=e.m10(),this._m11=e.m11(),this._m12=e.m12(),this}postTranslate(e){let t=i.new2();t.translate1(e),this.leftMultiply(t)}postRotate(e){let t=i.new2();t.rotate(e),this.leftMultiply(t)}postScale(e){let t=i.new2();t.scale3(e),this.leftMultiply(t)}toString(){return`AffineTransform(${this.m00()}, ${this.m01()}, ${this.m02()}, ${this.m10()}, ${this.m11()}, ${this.m12()})`}static new2(){return new i(1,0,0,0,1,0)}static new3(e){return new i(e.m00(),e.m01(),e.m02(),e.m10(),e.m11(),e.m12())}static new4(e){return new i(e.scale(),0,e.offset().x(),0,e.scale(),e.offset().y())}static translated(e,t){let n=i.new2();return n.translate2(e,t),n}},vt;(s=>{function i(){return ne.new2()}s.FrozenAffineTransform_new1=i;function e(l){return l}s.FrozenAffineTransform_new2=e;function t(l){return ne.new3(l)}s.FrozenAffineTransform_new3=t;function n(l,d,c,p,u,h){return new ne(l,d,c,p,u,h)}s.FrozenAffineTransform_new4=n;function r(l){return ne.new4(l)}s.FrozenAffineTransform_new5=r;function o(l){return ne.new4(l)}s.FrozenAffineTransform_new6=o,s.FrozenAffineTransform_IDENTITY=i()})(vt||(vt={}));var du=class{equals(e){return this.url==e.url&&this.scaleFactor==e.scaleFactor&&this.nonRotatedImageSize.equals(e.nonRotatedImageSize)&&this.nonRotatedOffset.equals(e.nonRotatedOffset)&&this.nonRotatedFramePresetSize.equals(e.nonRotatedFramePresetSize)}constructor(e,t,n,r,o){this.url=e,this.scaleFactor=t,this.nonRotatedImageSize=n,this.nonRotatedOffset=r,this.nonRotatedFramePresetSize=o}},Wo=class Wo{static deserializeVector(e){return new I(e.x,e.y)}static initialize(){let e=Rt.getDeviceInfoByIdentifier();if(e!==null){Wo._infoByIdentifier=new Map;for(let t in e){let n=e[t];Wo._infoByIdentifier.set(t,new du(n.url,n.scaleFactor,Wo.deserializeVector(n.imageSize),Wo.deserializeVector(n.offset),Wo.deserializeVector(n.framePresetSize)))}}}static infoForDevice(e){return Wo._infoByIdentifier==null||e==null||e.type!="PRESET"?null:Be.StringMap_get(Wo._infoByIdentifier,e.presetIdentifier,null)}static adjustNodeBoundsForDevice(e,t){let n=Wo.infoForDevice(t);if(n==null)return e;let r=t.canvasSpaceTopLeftOffset(n),o=t.canvasSpaceImageSize(n),a=e.clone();return a.setX(e.x()-r.x()),a.setY(e.y()-r.y()),a.setWidth(o.x()),a.setHeight(o.y()),a}static canvasSpaceContentSize(e,t){let n=Wo.infoForDevice(t);return n==null?e:t.canvasSpaceImageSize(n)}clearOnContextReset(){for(let e of Array.from(this._imageByURL.keys()))this._imageByURL.delete(e)}getImage(e,t){this._imageByURL.has(e.url)||this._imageByURL.set(e.url,Un.createDeviceImage(e));let n=this._imageByURL.get(e.url);return n.texture()==null&&n.fetchAndDecode(0,r=>{let o=w.in_Context.Context_createTexture1(t,w.TextureFormat.RGBA_LINEAR_CLAMP,1,1,"DeviceImage");n.setTexture(o);let a=r.expandToPowerOfTwo();n.texture().resize1(a.width,a.height,a,!0)},r=>{}),n}constructor(){this._imageByURL=new Map}};Wo._infoByIdentifier=null;var Br=Wo;var ee;(c=>{function i(p){return p!="-1:-1"&&p!=""}c.isValid=i;function e(p,u){let h=t(p),f=t(u),y=ht.int_compare(h.sessionID,f.sessionID);return y==0&&(y=ht.int_compare(h.localID,f.localID)),y}c.compare=e;function t(p){let u=p.split(":");if(u.length==2){let h={};return h.sessionID=parseInt(u[0]),h.localID=parseInt(u[1]),h}return null}c.toFigGUID=t;function n(){return"-1:-1"}c.invalid=n;function r(p){if(p==null)return null;let u=t(p);return u==null?null:u.sessionID<0||u.localID<0?"-1:-1":p}c.fromString=r;function o(p,u){return p<0||u<0?"-1:-1":`${p}:${u}`}c._new=o;function a(p){return o(p.sessionID,p.localID)}c.fromFigGUID=a;function s(p,u){return p==u}c.equals=s;function l(p,u){if(p.length!=u.length)return!1;for(let h=0,f=p.length;h<f;h=h+1)if(p[h]!=u[h])return!1;return!0}c.isSamePath=l;function d(p){return p=="0:0"}c.isRoot=d})(ee||(ee={}));var Eo=class{constructor(e){this._hashKey=null,this._keyByHash=new Map,this._valueByKeyHash=new Map,this._hashKey=e}count(){return this._keyByHash.size}_in(e){let t=this._hashKey(e);return this._keyByHash.has(t)}set(e,t){let n=this._hashKey(e);this._keyByHash.set(n,e),this._valueByKeyHash.set(n,t)}get1(e){let t=this._hashKey(e);return this._valueByKeyHash.get(t)}get(e,t){let n=this._hashKey(e);return Be.StringMap_get(this._valueByKeyHash,n,t)}remove(e){let t=this._hashKey(e);this._keyByHash.delete(t),this._valueByKeyHash.delete(t)}clear(){this._keyByHash=new Map,this._valueByKeyHash=new Map}keys(){return Array.from(this._keyByHash.values())}values(){return Array.from(this._valueByKeyHash.values())}each(e){this.keys().forEach(t=>{e(t,this.get1(t))})}isEmpty(){return this.count()==0}},zi=class{constructor(e){this._hash=null,this._hash=new Eo(e)}add(e){this._hash.set(e,!0)}addList(e){for(let t of e)this.add(t)}_in(e){return this._hash._in(e)}remove(e){this._hash.remove(e)}count(){return this._hash.count()}asList(){return this._hash.keys()}each(e){this._hash.keys().forEach(e)}map(e){return this._hash.keys().map(e)}equals(e){if(e==null||this.count()!=e.count())return!1;for(let t of this._hash.keys())if(!e._in(t))return!1;return!0}};var Wi=(T=>(T[T.NONE=0]="NONE",T[T.WINDOW_VISIBILITY=1]="WINDOW_VISIBILITY",T[T.WINDOW_RESIZE=2]="WINDOW_RESIZE",T[T.WINDOW_FRAME=3]="WINDOW_FRAME",T[T.MOUSE_MOVE=4]="MOUSE_MOVE",T[T.MOUSE_PRESS=5]="MOUSE_PRESS",T[T.MOUSE_DRAG=6]="MOUSE_DRAG",T[T.MOUSE_RELEASE=7]="MOUSE_RELEASE",T[T.MOUSE_SCROLL=8]="MOUSE_SCROLL",T[T.MOUSE_DROP=9]="MOUSE_DROP",T[T.MOUSE_LEAVE=10]="MOUSE_LEAVE",T[T.TOUCH_PRESS=11]="TOUCH_PRESS",T[T.TOUCH_DRAG=12]="TOUCH_DRAG",T[T.TOUCH_RELEASE=13]="TOUCH_RELEASE",T[T.KEY_PRESS=14]="KEY_PRESS",T[T.KEY_RELEASE=15]="KEY_RELEASE",T[T.GAMEPAD_DOWN=16]="GAMEPAD_DOWN",T[T.ON_MEDIA_HIT=17]="ON_MEDIA_HIT",T))(Wi||{}),Co=class{type(){return this._type}target(){return this._target}modifiers(){return this._modifiers}asMouseEvent(){return null}asTouchEvent(){return null}asKeyEvent(){return null}asGamepadEvent(){return null}isAccepted(){return this._isAccepted}accept(){this._isAccepted=!0}constructor(e,t,n){this._type=e,this._target=t,this._modifiers=n,this._isAccepted=!1}},vm=(t=>(t[t.MOUSE=0]="MOUSE",t[t.TOUCH=1]="TOUCH",t))(vm||{}),as=class i extends Co{constructor(t,n,r,o,a,s,l,d){super(t,n,r);this._type=t;this._target=n;this._modifiers=r;this.locationInWindow=o,this.previousLocationInWindow=a,this.scrollDelta=s,this.clickCount=l,this.droppedFiles=d}interactionType(){return 0}asMouseEvent(){return this}interactionCount(){return 1}locationInView(t){let n=t.absoluteBounds();return new I(this.locationInWindow.x()-n.x(),this.locationInWindow.y()-n.y())}previousLocationInView(t){let n=t.absoluteBounds();return new I(this.previousLocationInWindow.x()-n.x(),this.previousLocationInWindow.y()-n.y())}delta(){return this.locationInWindow.subtract1(this.previousLocationInWindow)}clone(){return new i(this.type(),this.target(),this.modifiers(),this.locationInWindow,this.previousLocationInWindow,this.scrollDelta,this.clickCount,this.droppedFiles)}},zs=class{locationInView(e){let t=e.absoluteBounds();return new I(this.locationInWindow.x()-t.x(),this.locationInWindow.y()-t.y())}previousLocationInView(e){let t=e.absoluteBounds();return new I(this.previousLocationInWindow.x()-t.x(),this.previousLocationInWindow.y()-t.y())}constructor(e,t,n,r){this.id=e,this.originalTarget=t,this.locationInWindow=n,this.previousLocationInWindow=r}},Tm=class{constructor(e,t,n){this.centroid=e,this.distance=t,this.count=n}},ss=class i extends Co{constructor(t,n,r,o,a){super(t,n,r);this._type=t;this._target=n;this._modifiers=r;this.touches=o,this.allTouches=a,this.scrollDelta=null}interactionType(){return 1}asTouchEvent(){return this}interactionCount(){return this.touches.length}locationInView(t){return this.touches[0].locationInView(t)}previousLocationInView(t){return this.touches[0].previousLocationInView(t)}summaryInView(t){return t==null?i._summarizeTouches(this.touches,n=>n.locationInWindow):i._summarizeTouches(this.touches,n=>n.locationInView(t))}previousSummaryInView(t){return t==null?i._summarizeTouches(this.touches,n=>n.previousLocationInWindow):i._summarizeTouches(this.touches,n=>n.previousLocationInView(t))}delta(){return this.summaryInView(null).centroid.subtract1(this.previousSummaryInView(null).centroid)}static _summarizeTouches(t,n){let r=I.new2(),o=0;if(t.length!=0){for(let a of t)r.addUpdate1(n(a));r.divideUpdate(t.length);for(let a of t)o+=n(a).distanceTo(r);o/=t.length}return new Tm(r,o,t.length)}},ls=class extends Co{constructor(t,n,r,o,a){super(t,n,r);this._type=t;this._target=n;this._modifiers=r;this.key=o,this.isRepeat=a}asKeyEvent(){return this}},uu=class extends Co{constructor(t,n,r,o,a){super(t,n,r);this._type=t;this._target=n;this._modifiers=r;this.button=o,this.controllerType=a}asGamepadEvent(){return this}},qn;(n=>{function i(r){return r.length}n.handlerCount=i;function e(r,o){ue.List_appendOne(r,o)}n.addUpdate=e;function t(r,o){ue.List_removeOne(r,o)}n.subtractUpdate=t})(qn||(qn={}));var Kt;(S=>{function i(v){return _(v,1)}S.windowVisibility=i;function e(v){return _(v,2)}S.windowResize=e;function t(v){return _(v,3)}S.windowFrame=t;function n(v){return _(v,4)}S.mouseMove=n;function r(v){return _(v,5)}S.mousePress=r;function o(v){return _(v,6)}S.mouseDrag=o;function a(v){return _(v,7)}S.mouseRelease=a;function s(v){return _(v,8)}S.mouseScroll=s;function l(v){return _(v,9)}S.mouseDrop=l;function d(v){return _(v,10)}S.mouseLeave=d;function c(v){return _(v,11)}S.touchPress=c;function p(v){return _(v,12)}S.touchDrag=p;function u(v){return _(v,13)}S.touchRelease=u;function h(v){return _(v,14)}S.keyPress=h;function f(v){return _(v,15)}S.keyRelease=f;function y(v){return _(v,16)}S.gamepadDown=y;function g(v,C,N){ue.List_appendOne(_(v,C),N)}S.on=g;function A(v,C,N){let x=b(v,C);x!=null&&ue.List_removeOne(x,N)}S.off=A;function T(v,C){let N=b(v,C.type());if(N!=null){for(let x of N)if(x(C),C.isAccepted())break}}S.trigger=T;function b(v,C){return Ht.IntMap_get(v,C,null)}S._handlers=b;function _(v,C){let N=Ht.IntMap_get(v,C,null);return N==null&&(N=[],v.set(C,N)),N}S._createHandlers=_;function m(){return new Map}S._new=m})(Kt||(Kt={}));var ZA;(e=>{function i(){return new Map}e._new=i})(ZA||(ZA={}));var pu;(t=>{function i(n){return Be.StringMap_get(t._triggerDeviceMap,n,"UNKNOWN_CONTROLLER")}t.stringToTriggerDevice=i,t._triggerDeviceMap=new Map([["KEYBOARD","KEYBOARD"],["UNKNOWN_CONTROLLER","UNKNOWN_CONTROLLER"],["XBOX_ONE","XBOX_ONE"],["PS4","PS4"],["SWITCH_PRO","SWITCH_PRO"]])})(pu||(pu={}));var Ws;(t=>{function i(n,r,o,a){return Ht.IntMap_get(n,r<<8|o,a)}t.KeyShortcutMap_get=i;function e(n,r,o,a){n.set(r<<8|o,a)}t.KeyShortcutMap_set=e})(Ws||(Ws={}));var ga;(l=>{function i(d){return d==1||d==2||d==3}l.ViewerEventType_isWindowEventType=i;function e(d){return d==4||d==5||d==6||d==7||d==8||d==9||d==10}l.ViewerEventType_isMouseEventType=e;function t(d){return d==11||d==12||d==13}l.ViewerEventType_isTouchEventType=t;function n(d){return d==14||d==15}l.ViewerEventType_isKeyEventType=n;function r(d){return d==11||d==13||d==5||d==7||d==8||d==9}l.ViewerEventType_isTypeToBeBlockedByDeviceFrame=r;function o(d){return Be.StringMap_get(l.ViewerEventType__eventTypeFromString,d,0)}l.ViewerEventType_fromString=o;function a(d){return Wi[d]}l.ViewerEventType_toString=a,l.ViewerEventType__eventTypeFromString=new Map([["NONE",0],["WINDOW_VISIBILITY",1],["WINDOW_RESIZE",2],["WINDOW_FRAME",3],["MOUSE_MOVE",4],["MOUSE_PRESS",5],["MOUSE_DRAG",6],["MOUSE_RELEASE",7],["MOUSE_SCROLL",8],["MOUSE_DROP",9],["MOUSE_LEAVE",10],["TOUCH_PRESS",11],["TOUCH_DRAG",12],["TOUCH_RELEASE",13],["KEY_PRESS",14],["KEY_RELEASE",15],["GAMEPAD_DOWN",16]])})(ga||(ga={}));var $A;(e=>{function i(t){return vm[t]}e.InteractionType_toString=i})($A||($A={}));var dc;(t=>{function i(n){return n>=105&&n<=108}t.Key_isModifier=i;function e(n){return Ht.IntMap_get(g0,n,[0])}t.Key_keyToKeyCode=e})(dc||(dc={}));var cs;(e=>{function i(){return Je.current()==4?2:8}e.Modifiers_currentPlatformModifier=i})(cs||(cs={}));function m0(i){let e=new Map;return Ht.IntMap_each(i,(t,n)=>{let r=n;if(e.has(r)){e.get(r).push(t);return}e.set(r,[t])}),e}var Im=new Map([[8,1],[9,2],[10,3],[13,3],[16,107],[17,108],[18,105],[19,5],[20,6],[27,7],[32,8],[33,9],[34,10],[35,11],[36,12],[37,13],[38,14],[39,15],[40,16],[44,17],[45,18],[46,19],[48,20],[49,21],[50,22],[51,23],[52,24],[53,25],[54,26],[55,27],[56,28],[57,29],[59,90],[61,93],[63,30],[65,31],[66,32],[67,33],[68,34],[69,35],[70,36],[71,37],[72,38],[73,39],[74,40],[75,41],[76,42],[77,43],[78,44],[79,45],[80,46],[81,47],[82,48],[83,49],[84,50],[85,51],[86,52],[87,53],[88,54],[89,55],[90,56],[91,106],[92,106],[93,57],[96,58],[97,59],[98,60],[99,61],[100,62],[101,63],[102,64],[103,65],[104,66],[105,67],[106,68],[107,69],[109,70],[110,71],[111,72],[112,76],[113,77],[114,78],[115,79],[116,80],[117,81],[118,82],[119,83],[120,84],[121,85],[122,86],[123,87],[144,88],[145,89],[173,91],[186,90],[187,93],[188,94],[189,91],[190,95],[191,96],[192,104],[219,99],[220,100],[221,101],[222,98],[224,106]]),g0=m0(Im);var nS=(n=>(n[n.MIN_MIN=0]="MIN_MIN",n[n.MIN_MAX=1]="MIN_MAX",n[n.MAX_MAX=2]="MAX_MAX",n))(nS||{}),pc=(n=>(n[n.NONE=0]="NONE",n[n.POINTER=1]="POINTER",n[n.TOUCH=2]="TOUCH",n))(pc||{}),bi=class bi{parent(){return this._parent}window(){return this._window}children(){return this._children}events(){return this._events}focus(){this._window.setFocusedView(this)}absoluteBounds(){if(this._cachedAbsoluteBounds!=null)return this._cachedAbsoluteBounds;let e=null;if(this.parent()!=null)e=this.parent().absoluteBounds();else if(this==this.window().root())e=new G(0,0,this.window().width(),this.window().height());else return null;let t=e.width()|0,n=e.height()|0,r=this._minX+(this._alignX==2?t:0),o=this._maxX+(this._alignX!=0?t:0),a=this._minY+(this._alignY==2?n:0),s=this._maxY+(this._alignY!=0?n:0);return this._cachedAbsoluteBounds=new G(e.x()+r,e.y()+a,Math.max(0,o-r),Math.max(0,s-a)),e}viewFromPoint(e){let t=this.children().length;for(let n=0,r=t;n<r;n=n+1){let o=this.children()[t-n-1];if(o.absoluteBounds().contains2(e))return o.viewFromPoint(e)}return this}invalidateBounds(){this.forSelfAndDescendents(e=>{e._cachedAbsoluteBounds=null})}isEqualToOrParentOf(e){for(;e!=null;){if(e==this)return!0;e=e.parent()}return!1}selfAndParents(){let e=[];for(let t=this;t!=null;t=t.parent())e.push(t);return e}selfAndChildren(){let e=[],t=[this];for(;t.length!=0;){let n=t.pop(),r=n.children().length;e.push(n);for(let o=0,a=r;o<a;o=o+1)t.push(n.children()[r-o-1])}return e}setLayout(e,t,n,r,o,a){(this._alignX!=e||this._minX!=t||this._maxX!=n||this._alignY!=r||this._minY!=o||this._maxY!=a)&&(this._alignX=e,this._minX=t,this._maxX=n,this._alignY=r,this._minY=o,this._maxY=a,this._handleLayoutChange(),this.invalidateBounds())}setParent(e){if(e==this._parent)return;this._parent!=null&&ue.List_removeOne(this._parent.children(),this),e!=null&&e.children().push(this),this._handleParentChange(this._parent,e),this._parent=e,this.invalidateBounds();let t=e==null?void 0:e._window;this._window!=t&&this.forSelfAndDescendents(n=>{n._window=t})}forSelfAndDescendents(e){e(this);for(let t of this.children())t.forSelfAndDescendents(e)}setCursor(e){bi._appendCursorStyleIfNecessary(),e!=this._cursor&&(this._element.classList.remove(bi._cssCursorClassName(this._cursor)),this._cursor=e,this._element.classList.add(bi._cssCursorClassName(this._cursor)))}cursor(){return this._cursor}element(){return this._element==null&&(this._element=document.createElement("div"),this._element.style.position="absolute",this._handleLayoutChange()),this._element}becomeRoot(e){this._window=e}_handleParentChange(e,t){t!=null&&t._element!=null?t._element.appendChild(this.element()):e._element!=null&&e._element.removeChild(this.element())}_handleLayoutChange(){if(this._element!=null){let e=this._element.style;e.left=this._alignX==2?"auto":this._minX.toString()+"px",e.top=this._alignY==2?"auto":this._minY.toString()+"px",e.right=this._alignX==0?"auto":this._maxX.toString()+"px",e.bottom=this._alignY==0?"auto":this._maxY.toString()+"px",e.width=this._alignX==1?"auto":(this._maxX-this._minX).toString()+"px",e.height=this._alignY==1?"auto":(this._maxY-this._minY).toString()+"px"}}static _appendCursorStyleIfNecessary(){if(bi._cursorStyle!=null)return;let e=(c,p,u,h)=>`
      cursor: url("${u}"), auto; /* Edge, IE */
      cursor: url("${c}") 30 30, pointer; /* Legacy */
      cursor: url("${h}") 30 30, pointer; /* FF */
      cursor: -webkit-image-set(url("${c}") 1x, url("${p}") 2x) 30 30, pointer; /* Webkit */
      `,t="/images/viewer/cursor-touch.png",n="/images/viewer/cursor-touch.cur",r="/images/viewer/cursor-touch@2x.png",o="/images/viewer/cursor-touch.svg",a="/images/viewer/cursor-touch-down.png",s="/images/viewer/cursor-touch-down.cur",l="/images/viewer/cursor-touch-down@2x.png",d="/images/viewer/cursor-touch-down.svg";bi._cursorStyle=document.createElement("style"),bi._cursorStyle.textContent=`
    .cursor-default {
      cursor: default;
    }

    .cursor-pointer {
      cursor: pointer;
    }

    .cursor-touch {
      ${e(t,r,n,o)}
    }

    .cursor-touch:active {
      ${e(a,l,s,d)}
    }

    /*
      We provide a mechanism for the app outside of the viewer to disable all
      viewer cursors. This is useful e.g. in comments mode where the containing
      react application is responsible for setting the cursor instead of code
      inside the viewer library. To use this, the containing application would
      add the viewer-cursors-disabled class to the HTMLElement that hosts the
      viewer canvas.
    */

    .viewer-cursors-disabled .cursor-default {
      cursor: inherit;
    }

    .viewer-cursors-disabled .cursor-pointer {
      cursor: inherit;
    }

    .viewer-cursors-disabled .cursor-touch {
      cursor: inherit;
    }

    .viewer-cursors-disabled .cursor-touch:active {
      cursor: inherit;
    }
`,document.head.appendChild(bi._cursorStyle)}static _cssCursorClassName(e){switch(e){case 0:return"cursor-default";case 1:return"cursor-pointer";case 2:return"cursor-touch"}return null}constructor(){this._parent=null,this._window=null,this._children=[],this._events=Kt._new(),this._alignX=1,this._minX=0,this._maxX=0,this._alignY=1,this._minY=0,this._maxY=0,this._cachedAbsoluteBounds=null,this._element=null,this._cursor=0}};bi._cursorStyle=null;var uc=bi,Em=class{name(){return this._file.name}mimeType(){return this._file.type}bytes(){return this._promise==null&&(this._promise=new Promise((e,t)=>{let n=new FileReader;n.onload=()=>{e(new Uint8Array(Ld.FileReader_resultAsArrayBuffer(n)))},n.onloadend=()=>{t(or.VOID)},n.readAsArrayBuffer(this._file)})),this._promise}constructor(e){this._file=e,this._promise=null}},hu=class{constructor(e,t,n,r){this._root=null,this._width=0,this._height=0,this._devicePixelRatio=0,this._eventHandlersBefore=Kt._new(),this._eventHandlersAfter=Kt._new(),this._isInlinePreviewCallback=r,this._events=Kt._new(),this._afterNotifyCallback=null,this._isActive=!0,this._focusedView=null,this._containerElement=null,this._disableOwnOnFrameCallback=!1,this._internalOnFrameID=0,this.forceFrame=null,this.internalOnFrame=null,this._containerElement=e,this._disableOwnOnFrameCallback=n,this._root=new uc,this._root.becomeRoot(this);let o=null,a=null,s=null,l=null,d=null,c=null,p=document,u=window,h=this.root().element(),f=F=>{ko.Event_preventDefault(F)},y=(F,P)=>{Yt.EventTarget_removeEventListener3(F,"mousemove",a),Yt.EventTarget_removeEventListener3(F,"mouseup",s),Yt.EventTarget_removeEventListener5(F,"touchmove",d),Yt.EventTarget_removeEventListener5(F,"touchend",c),Yt.EventTarget_addEventListener4(P,"mousemove",a),Yt.EventTarget_addEventListener4(P,"mouseup",s),Yt.EventTarget_addEventListener6(P,"touchmove",d),Yt.EventTarget_addEventListener6(P,"touchend",c)};this.forceFrame=()=>{this._resize(),Kt.trigger(this.events(),new Co(3,this.root(),0))},this.internalOnFrame=()=>{this._resize();try{Kt.trigger(this.events(),new Co(3,this.root(),0))}catch(F){Ve(F)}this._disableOwnOnFrameCallback||(this._internalOnFrameID=requestAnimationFrame(this.internalOnFrame))};let g=()=>{this._isActive=!p.hidden,Kt.trigger(this.events(),new Co(1,this.root(),0)),y(p,h)},A=F=>{let P=(F.altKey?1:0)|(F.metaKey?2:0)|(F.shiftKey?4:0)|(F.ctrlKey?8:0);return cs.Modifiers_currentPlatformModifier()&P?P|16:P},T=(F,P)=>{for(let k=this.root().element();k!=null;k=k.offsetParent)F=F-k.offsetLeft,P=P-k.offsetTop;return new I(F,P)},b=0,_=0,m=0,S=0,v=F=>{let P=0,k=qa.Performance_now(u.performance);return P=1,S!=0&&k-S<500&&Math.abs(F.pageX-b)<4&&Math.abs(F.pageY-_)<4&&(P=m+1),b=F.pageX,_=F.pageY,m=P,S=k,P},C=null,N=null,x=!1,z=(F,P,k,H)=>{let L=T(F.pageX,F.pageY),Q=N??this.root().viewFromPoint(L),X=new as(P==4&&x?6:P,Q,A(F),L,C??L,k,P==5?v(F):0,H);C=L,this.notify(X),X.isAccepted()&&(X.type()==5&&F.button==0||ko.Event_preventDefault(F),P==5&&(N=Q)),P==5?x=!0:P==7&&(N=null,x=!1)},$=new Map,q=(F,P)=>{let k=new Map,H=[];Array.from($.values()).forEach(Q=>{ue.List_appendOne(H,Q.originalTarget)});let L=Bd.TouchEvent_touches(F).map(Q=>{let X=Q.identifier,M=T(Q.pageX,Q.pageY),te=Ht.IntMap_get($,X,null),J=te!=null?te.originalTarget:this.root().viewFromPoint(M),oe=new zs(X,J,M,te!=null?te.locationInWindow:M);return k.set(X,oe),ue.List_appendOne(H,J),oe});$=k;for(let Q of H){let X=new ss(P,Q,A(F),L.filter(M=>M.originalTarget==Q),L);this.notify(X),X.isAccepted()&&ko.Event_preventDefault(F)}},K=(F,P)=>{let k=Ht.IntMap_get(Im,F.which,0),H=A(F),L=(cs.Modifiers_currentPlatformModifier()&H)!=0&&(k==91||k==93||k==20),Q=this.focusedView();L&&ko.Event_preventDefault(F);let X=M=>{for(;M!==p;){if(M.className.split(" ").indexOf("viewer-forward-keyevents")!=-1)return!0;M=M.parentNode}return!1};if((L||p.activeElement==null||p.activeElement==p.body||X(p.activeElement))&&k!=0&&Q!=null){let M=new ls(P,Q,H,k,!1);this.notify(M),(M.isAccepted()||k==1)&&(ko.Event_preventDefault(F),F.stopPropagation())}};if(o=F=>{y(h,p),z(F,5,null,null),window.focus(),document.activeElement!=null&&document.activeElement.blur()},a=F=>{z(F,4,null,null)},s=F=>{y(p,h),z(F,7,null,null)},l=F=>{q(F,11)},d=F=>{q(F,12)},c=F=>{q(F,13)},Yt.EventTarget_addEventListener3(p,"keydown",F=>{K(F,14)}),Yt.EventTarget_addEventListener3(p,"keyup",F=>{K(F,15)}),Yt.EventTarget_addEventListener7(h,"wheel",F=>{let P=F.deltaMode,k=P==F.DOM_DELTA_LINE?10:P==F.DOM_DELTA_PAGE?100:1;z(F,8,new I(F.deltaX*k,F.deltaY*k),null)}),Yt.EventTarget_addEventListener14(p,"wheel",F=>{F.ctrlKey&&ko.Event_preventDefault(F)},{passive:!1}),Yt.EventTarget_addEventListener5(p,"drop",F=>{ko.Event_preventDefault(F),z(F,9,null,Md.DataTransfer_files(F.dataTransfer).map(P=>new Em(P)))}),Yt.EventTarget_addEventListener4(p,"mouseenter",F=>{C=null}),Yt.EventTarget_addEventListener4(h,"mouseleave",F=>{z(F,10,null,null)}),t!=null){let F=t;F.onPress(P=>{let k=new uu(16,this.root(),0,P.buttons[0],pu.stringToTriggerDevice(P.controllerType));this.notifyAll(k)}),F.start()}Yt.EventTarget_addEventListener1(u,"resize",()=>{this._resize()}),Yt.EventTarget_addEventListener1(u,"visibilitychange",g),Yt.EventTarget_addEventListener2(h,"contextmenu",f),Yt.EventTarget_addEventListener4(h,"mousedown",o),Yt.EventTarget_addEventListener6(h,"touchstart",l),Yt.EventTarget_addEventListener2(p,"dragenter",f),Yt.EventTarget_addEventListener2(p,"dragover",f),this._containerElement!=null&&this._containerElement.appendChild(h),this._focusedView=this.root(),g(),this._resize(),this._disableOwnOnFrameCallback||(this._internalOnFrameID=requestAnimationFrame(this.internalOnFrame))}root(){return this._root}width(){return this._width}height(){return this._height}size(){return new I(this._width,this._height)}isActive(){return this._isActive}focusedView(){return this._focusedView}devicePixelRatio(){return this._devicePixelRatio}eventsBefore(){return this._eventHandlersBefore}eventsAfter(){return this._eventHandlersAfter}events(){return this._events}setAfterNotify(e){this._afterNotifyCallback=e}clearAfterNotify(){this._afterNotifyCallback=null}_afterNotify(e){this._afterNotifyCallback!=null&&this._afterNotifyCallback(e)}notify(e){let t=e.target().selfAndParents();if(Kt.trigger(this._eventHandlersBefore,e),e.isAccepted()){this._afterNotify(e);return}for(let n of t)if(Kt.trigger(n.events(),e),e.isAccepted()){this._afterNotify(e);return}Kt.trigger(this._eventHandlersAfter,e),this._afterNotify(e)}notifyAll(e){let t=e.target().selfAndChildren();if(Kt.trigger(this._eventHandlersBefore,e),!e.isAccepted()){for(let n of t)if(Kt.trigger(n.events(),e),e.isAccepted())return;Kt.trigger(this._eventHandlersAfter,e)}}dangerouslyDisableOnFrameCallbackForTesting(){this._disableOwnOnFrameCallback=!0}_resize(){if(this._containerElement==null)return;let e=document.body,t=this._isInlinePreviewCallback()?this._containerElement.getBoundingClientRect().width:this._containerElement==e?window.innerWidth:this._containerElement.clientWidth,n=this._isInlinePreviewCallback()?this._containerElement.getBoundingClientRect().height:this._containerElement==e?window.innerHeight:this._containerElement.clientHeight,r=rr();(this._width!=t||this._height!=n||this._devicePixelRatio!=r)&&(this._width=t,this._height=n,this._devicePixelRatio=r,this.root().invalidateBounds(),this.notifyAll(new Co(2,this.root(),0)))}setFocusedView(e){this._focusedView=e}createDiv(){return document.createElement("div")}setNewContainerElement(e){if(e==null)throw new Error("Can't mount the viewer in a null DOM node");this._containerElement=e,e.appendChild(this.root().element()),this._resize(),this._internalOnFrameID!=0&&cancelAnimationFrame(this._internalOnFrameID),this._disableOwnOnFrameCallback||(this._internalOnFrameID=requestAnimationFrame(this.internalOnFrame))}},eS;(e=>{function i(t){return nS[t]}e.ViewAlign_toString=i})(eS||(eS={}));var tS;(e=>{function i(t){return pc[t]}e.Cursor_toString=i})(tS||(tS={}));var oS=Wa(rS());var Yn=class Yn{constructor(e){this._valueBySnapshotId=null,this._isDirty=!1,this._valueBySnapshotId=e}getValueOrNull(e){return Be.StringMap_get(this._valueBySnapshotId,e,null)}updateValue(e,t){this._valueBySnapshotId.set(e,t),this._isDirty=!0}toString(){let e=Array.from(this._valueBySnapshotId.keys());e.sort((n,r)=>Bn.string_compare(n,r));let t="";for(let n of e)t+=`
${Yn._PREFIX}snapshotId: ${n}
`,t+=this._valueBySnapshotId.get(n);return t}isDirty(){return this._isDirty}static _createEmptyDefaultDirtyAtPath(e){if(Yn._snapshotFileCache.has(e))throw new Error("Snapshot file at path already exists in cache");return Yn._snapshotFileCache.set(e,new Yn(new Map)),Yn._snapshotFileCache.get(e)._isDirty=!0,Yn._snapshotFileCache.get(e)}static loadOrCreateFromPath(e){let t=Be.StringMap_get(Yn._snapshotFileCache,e,null);return t!=null?Promise.resolve(t):ProtoTestHost_readFile(e).then(n=>{let r=Be.StringMap_get(Yn._snapshotFileCache,e,null);return r??(n==null?(console.log(`[Snapshot] Create empty default dirty snapshot at path ${e}`),Yn._createEmptyDefaultDirtyAtPath(e)):(Yn._snapshotFileCache.set(e,new Yn(Yn._snapshotStringToMap(n))),Yn._snapshotFileCache.get(e)))})}static _snapshotStringToMap(e){let t=new Map,n=e.split(`
`),r=null,o=null;for(let a of n){let s=`${Yn._PREFIX}snapshotId: `;a.startsWith(s)?(r!=null&&t.set(r,o.join(`
`)),r=a.slice(s.length),o=[]):o!=null&&o.push(a)}return r!=null&&t.set(r,o.join(`
`)),t}static flushSnapshotUpdates(){let e=[];return Be.StringMap_each(Yn._snapshotFileCache,(t,n)=>{n.isDirty()&&e.push(Yn._saveToPath(t,n))}),Promise.all(e)}static _saveToPath(e,t){return console.log(`[Snapshot] Saving to file ${e}`),ProtoTestHost_writeFile(e,t.toString())}};Yn._PREFIX="#*#* ",Yn._snapshotFileCache=new Map;var Qs=Yn;var _a=class{constructor(e){this._testFilepath=null,this._testFilepath=e}asyncAssertMatchesSnapshot(e,t){if(gu==null)throw new Error("asyncAssertMatchesSnapshot called outside of a test");let r=this._testFilepath.split(".sk").join(".snapshot.txt"),o=gu+" -- "+e,a=ProtoTestHost_env.UPDATE_SNAPSHOTS!==void 0;return A0(r,o).then(s=>{let l=new RegExp("\\d+\\.\\d*","g"),d=t.replaceAll(l,c=>`${Math.round(parseFloat(c)*1e3)/1e3}`);if(s==null||a)return _0(r,o,d),or.VOID;if(s!==d)throw new Error(`${gc}Snapshot ${o} in file ${r} did not match previous value. Here's a diff that changes the ${aS}stored snapshot${gc} into the ${iS}received value${gc}:

${f0(s,d)}`);return or.VOID})}},fa;(o=>{function i(){return o.hasSetExpectedErrorsBeenCalled=!1,hi.interactionTestHelpers.resetExpectedErrorsAndGetErrorString(1)}o.resetExpectedErrorsAndGetErrorString=i;function e(a){if(o.hasSetExpectedErrorsBeenCalled)throw new Error("Can only call setExpectedErrors once per test");o.hasSetExpectedErrorsBeenCalled=!0,hi.interactionTestHelpers.setExpectedErrors(a)}o.setExpectedErrors=e;function t(){o.isUnhandledErrorsExpected=!0}o.setUnhandledErrorsExpected=t,o.hasSetExpectedErrorsBeenCalled=!1,o.isUnhandledErrorsExpected=!1})(fa||(fa={}));function Ce(i,e){Nm(i,()=>new Promise((t,n)=>{e(),setTimeout(()=>{t(or.VOID)},0)}))}function Te(i,e){Nm(i,e)}function ds(i,e){Nm(i,()=>e().then(t=>or.VOID))}function Nm(i,e){mc.push(i);let t=mc.join(" -- ");ue.List_removeLast(mc),it(i,()=>{gu=t,Ro=[],fa.isUnhandledErrorsExpected=!1;let n=fa.resetExpectedErrorsAndGetErrorString();return n.length>0&&Ro.push(new Error("Errors detected from before test started. Maybe from test harness initialization, or from a previous test: "+n)),e().catch(r=>(Ro.push(r),or.VOID)).then(r=>{let o=fa.resetExpectedErrorsAndGetErrorString();if(o.length>0&&Ro.push(new Error(o)),Ul(),gu=null,fa.isUnhandledErrorsExpected){if(Ro.length==0)throw new Error("Expected errors, but none were triggered")}else{Ro=Ro.filter(s=>s.message.indexOf("/api/web_logger/metrics/unhandled_error")==-1);let a=Ro.length>1?Ro.length.toString()+`unhandled errors: 
`:`Unhandled error: 
`;if(Ro.length==1)throw Ro[0];if(Ro.length>1){for(let s of Ro)a+=s.message,a+=`
`,a+=s.stack;throw new Error(a)}}return or.VOID})})}function Ft(i,e){mc.push(i),describe(i,()=>{e()}),ue.List_removeLast(mc)}function f0(i,e){let t=oS.diffLines(i,e),n="";return t.forEach(r=>{let o="",a="";r.added?(o="+ ",a=iS):r.removed?(o="- ",a=aS):(o="  ",a=gc),n+=`${a}${o}${r.value}${gc}
`}),n}function _0(i,e,t){Qs.loadOrCreateFromPath(i).then(n=>{n.updateValue(e,t)})}function A0(i,e){return Qs.loadOrCreateFromPath(i).then(t=>t.getValueOrNull(e))}var Ro=[],mc=[],gu=null,iS="\x1B[32m",aS="\x1B[31m",gc="\x1B[0m";var Ks=class{constructor(e,t,n){this.prototypeApp=e,this.skewKiwiSerialization=t,this.deprecatedJsSceneHooks=n}};var Aa;(e=>{function i(t){return t!="NONE"&&t!="PRESENTATION"}e.hasDevice=i})(Aa||(Aa={}));var Jt;(r=>{function i(o){return o=="BOOLEAN_OPERATION"||o=="VECTOR"||o=="STAR"||o=="LINE"||o=="ELLIPSE"||o=="RECTANGLE"||o=="REGULAR_POLYGON"||o=="ROUNDED_RECTANGLE"||o=="TEXT"||o=="STAMP"||o=="WASHI_TAPE"}r.isGeometryLeaf=i;function e(o){return o=="FRAME"||o=="SYMBOL"||o=="INSTANCE"||o=="SECTION"||n(o)||o=="TABLE_CELL"||o=="SLIDE"}r.isFrameLike=e;function t(o){return o=="RECTANGLE"||o=="ROUNDED_RECTANGLE"||o=="ELLIPSE"||o=="STAMP"||e(o)}r.isRectOrEllipseLike=t;function n(o){return o=="STICKY"||o=="SHAPE_WITH_TEXT"||o=="CONNECTOR"||o=="CODE_BLOCK"||o=="MEDIA"||o=="SECTION_OVERLAY"||o=="TABLE"}r.isImmutableFrame=n})(Jt||(Jt={}));var Om;(t=>{function i(){return ee._new(-1,t._nextLocalID=t._nextLocalID+1)}t.generateId=i,t._nextLocalID=0})(Om||(Om={}));var Yr=class i{recomposed(){let e=ne.new2();e.setM00(this.m00),e.setM01(this.m01),e.setM10(this.m10),e.setM11(this.m11),e.setM02(this.translation.x()),e.setM12(this.translation.y());let t=Math.PI/180*this.angleDegrees,n=Math.cos(t),r=Math.sin(t),o=ne.new2();return o.setM00(n),o.setM01(-r),o.setM10(r),o.setM11(n),e.multiply(o),e.setM00(e.m00()*this.scale.x()),e.setM01(e.m01()*this.scale.y()),e.setM10(e.m10()*this.scale.x()),e.setM11(e.m11()*this.scale.y()),e}static from(e){let t=new i,n=e.m00(),r=e.m10(),o=e.m01(),a=e.m11();t.translation=I.new3(e.translation()),t.scale=I.new3(e.scale1()),n*a-r*o<0&&(n<a?t.scale.setX(-t.scale.x()):t.scale.setY(-t.scale.y())),t.scale.x()!=0&&(n*=1/t.scale.x(),r*=1/t.scale.x()),t.scale.y()!=0&&(o*=1/t.scale.y(),a*=1/t.scale.y());let l=Math.atan2(r,n);if(l!=0){let d=-r,c=n,p=n,u=r,h=o,f=a;n=c*p+d*h,r=c*u+d*f,o=-d*p+c*h,a=-d*u+c*f}return t.angleDegrees=180/Math.PI*l,t.m00=n,t.m10=r,t.m01=o,t.m11=a,t}static lerp1(e,t,n){let r=i.from(e),o=i.from(t);return i.lerp2(r,o,n).recomposed()}static lerp2(e,t,n){(e.scale.x()<0&&t.scale.y()<0||e.scale.y()<0&&t.scale.x()<0)&&(e.scale.setX(-e.scale.x()),e.scale.setY(-e.scale.y()),e.angleDegrees+=e.angleDegrees<0?180:-180),e.angleDegrees==0&&(e.angleDegrees=360),t.angleDegrees==0&&(t.angleDegrees=360),Math.abs(e.angleDegrees-t.angleDegrees)>180&&(e.angleDegrees>t.angleDegrees?e.angleDegrees-=360:t.angleDegrees-=360);let r=new i;return r.translation=e.translation.multiply(1-n).add1(t.translation.multiply(n)),r.scale=e.scale.multiply(1-n).add1(t.scale.multiply(n)),r.angleDegrees=e.angleDegrees*(1-n)+t.angleDegrees*n,r.m00=e.m00*(1-n)+t.m00*n,r.m10=e.m10*(1-n)+t.m10*n,r.m01=e.m01*(1-n)+t.m01*n,r.m11=e.m11*(1-n)+t.m11*n,r}constructor(){this.translation=I.new2(),this.scale=I.new2(),this.angleDegrees=0,this.m00=0,this.m01=0,this.m10=0,this.m11=0}};var sS;(t=>{function i(){return[]}t.new1=i;function e(n){return n.slice()}t.new2=e})(sS||(sS={}));var en;(T=>{function i(b){return b.length}T.FrozenList_count=i;function e(b){return b.length==0}T.FrozenList_isEmpty=e;function t(b,_){return b[_]}T.FrozenList_get=t;function n(b){return ue.List_last(b)}T.FrozenList_last=n;function r(b,_){return b.some(_)}T.FrozenList_any=r;function o(b,_){return b.filter(_)}T.FrozenList_filter=o;function a(b,_){b.forEach(_)}T.FrozenList_each=a;function s(b){return b[0]}T.FrozenList_first=s;function l(b,_){return b.map(_)}T.FrozenList_map=l;function d(b){return b.slice()}T.FrozenList_clone=d;function c(b,_,m){return b.slice(_,m)}T.FrozenList_slice=c;function p(b,_){let m=b.slice();return ue.List_appendOne(m,_),m}T.FrozenList_cloneAndAppendOne=p;function u(b,_){let m=b.slice();return ue.List_removeOne(m,_),m}T.FrozenList_cloneAndRemoveOne=u;function h(b,_,m){return ue.List_equalsWithComparison(b,_,m)}T.FrozenList_equals=h;function f(b,_){return b.indexOf(_)!=-1}T._in=f;function y(b,_){for(let m of b)if(_(m))return!0;return!1}T.FrozenList_contains=y;function g(b,_){let m=b.slice();return m.sort(_),m}T.FrozenList_sorted=g;function A(b,_){let m=b.slice();return m.push(_),m}T.FrozenList_cloneAndAppend=A})(en||(en={}));var us;(t=>{function i(n){return n=="GRADIENT_LINEAR"||n=="GRADIENT_RADIAL"||n=="GRADIENT_ANGULAR"||n=="GRADIENT_DIAMOND"}t.isGradient=i;function e(n){return n=="GRADIENT_ANGULAR"}t.shouldWrap=e})(us||(us={}));var $e=class{constructor(e,t){this.color=e,this.position=t}};$e.COMPARE=(e,t)=>Xt.double_compare(e.position,t.position),$e.EQUALS=(e,t)=>e.color==t.color&&e.position==t.position;var fc=class fc{id(){return this._id}asSinglePaint(){return null}asVolatilePaint(){return null}debugString(){return""}isGradient(){switch(this.type()){case"GRADIENT_ANGULAR":case"GRADIENT_DIAMOND":case"GRADIENT_LINEAR":case"GRADIENT_RADIAL":return!0}return!1}constructor(){this._id=fc._previousID=fc._previousID+1}};fc._previousID=0;var fu=fc,ao=class ao extends fu{constructor(t){super();this._type=null,this._color=E.TRANSPARENT,this._opacity=1,this._isEnabled=!0,this._colorStops=null,this._blendMode="NORMAL",this._image=null,this._imageThumbnail=null,this._video=null,this._videoPlaybackParams="",this._transform=vt.FrozenAffineTransform_IDENTITY,this._rotationDeg=0,this._scalingFactor=1,this._imageScaleMode="STRETCH",this._filterColorAdjust=null,this._originalImageWidth=0,this._originalImageHeight=0,this._decodedImageIsReady=!1,this._decodedImageThumbnailIsReady=!1,this._type=t}type(){return this._type}color(){return this._color}opacity(){return this._opacity}isEnabled(){return this._isEnabled}isVolatile(){return!1}isVisible(){return this._isEnabled&&this._opacity>0}blendMode(){return this._blendMode}transform(){return this._transform}setIsEnabled(t){this._isEnabled=t}debugString(){return`SinglePaint id=${this._id} type=${this._type} blend=${this._blendMode} opacity=${this._opacity}${this._isEnabled?"":" [hidden]"}`}image(){return this._image}imageThumbnail(){return this._imageThumbnail}video(){return this._video}imageScaleMode(){return this._imageScaleMode}rotationDeg(){return this._rotationDeg}scalingFactor(){return this._scalingFactor}filterColorAdjust(){return this._filterColorAdjust}decodedImageIsReady(){return this._decodedImageIsReady}decodedImageThumbnailIsReady(){return this._decodedImageThumbnailIsReady}colorStops(){return this._colorStops}lastStopIsTransparent(){return this._colorStops.length!=0&&E.alpha(ue.List_last(this._colorStops).color)==0}isImageAvailable(){return this._image!=null&&this._image.isDecoded()}isImageThumbnailAvailable(){return this._image!=null&&this._image.isDecoded()}setType(t){this._type=t}setColor(t){this._color=t}setBlendMode(t){this._blendMode=t}setImage(t){this._image=t}setImageThumbnail(t){this._imageThumbnail=t}setVideo(t){this._video!=null&&t==null&&console.log(new Error().stack),this._video=t}videoPlaybackParams(t){this._videoPlaybackParams=t}setTransform(t){this._transform=t}setTransform1(t){this._transform=t.clone()}setImageScaleMode(t){this._imageScaleMode=t}setRotationDeg(t){this._rotationDeg=t}setScalingFactor(t){this._scalingFactor=t}setFilterColorAdjust(t){this._filterColorAdjust=t}setDecodedImageIsReady(t){this._decodedImageIsReady=t}setDecodedImageThumbnailIsReady(t){this._decodedImageThumbnailIsReady=t}setColorStops(t){this._colorStops=t}setColorStops1(t){this._colorStops=t.slice()}setOpacity(t){this._opacity=t}setOriginalImageWidth(t){this._originalImageWidth=t}setOriginalImageHeight(t){this._originalImageHeight=t}allocateBoundsToImageRatio(t,n){let r=I.new3(t);return this._rotationDeg!=0&&(ne.new2().rotatedBy(this._rotationDeg*(Math.PI/180)).transformPoint(n),n.makeAbs()),r.divideUpdate1(n),r}allocateImageSize(){let t=this._video!=null&&this._video.didLoad(this),n=this._image!=null&&this._image.isDecoded(),r=this._imageThumbnail!=null&&this._imageThumbnail.isDecoded();return t?this._video.size(this):n?new I(this._image.width(),this._image.height()):r?this._originalImageWidth!=0&&this._originalImageHeight!=0?new I(this._originalImageWidth,this._originalImageHeight):new I(this._imageThumbnail.width(),this._imageThumbnail.height()):null}allocateImageTransformForGeometrySize(t){let n=this._rotationDeg*(Math.PI/180),r=ne.new2(),o=this.allocateImageSize();o==null&&Ve("Trying to render image before it is loaded");let a=this.allocateBoundsToImageRatio(t,o);switch(this.imageScaleMode()){case"FILL":{r=r.translatedBy2(.5,.5).rotatedBy(-n).scaledBy3(a.x()/a.max1(),a.y()/a.max1()).translatedBy2(-.5,-.5);break}case"FIT":{r=r.translatedBy2(.5,.5).rotatedBy(-n).scaledBy3(a.x()/a.min1(),a.y()/a.min1()).translatedBy2(-.5,-.5);break}case"STRETCH":{r.copyFrom(this.transform());break}case"TILE":{r=r.translatedBy2(.5,.5).rotatedBy(-n).translatedBy2(-.5,-.5).scaledBy2(1/this.scalingFactor()).scaledBy1(a);break}}return r}decodedImage(){return this.image().isDecoded()?this.image():null}decodedImageThumbnail(){return this.imageThumbnail().isDecoded()?this.imageThumbnail():null}scalingFactorForImage(t){return this.image()==null||t==null||t.width()==0||this.image().width()==0?this.scalingFactor():this.scalingFactor()*(this.image().width()/t.width())}colorAdjustIsActive(){return this._filterColorAdjust!=null&&(this._filterColorAdjust.tint!=0||this._filterColorAdjust.vibrance!=0||this._filterColorAdjust.shadows!=0||this._filterColorAdjust.highlights!=0||this._filterColorAdjust.exposure!=0||this._filterColorAdjust.contrast!=0||this._filterColorAdjust.temperature!=0)}colorAdjustSetData(t){let n=Fn.instance();t.setUniformFloat(n.GLSLX_NAME_U_GLOBAL_TINT,this._filterColorAdjust.tint),t.setUniformFloat(n.GLSLX_NAME_U_GLOBAL_COLOR,this._filterColorAdjust.vibrance),t.setUniformFloat(n.GLSLX_NAME_U_GLOBAL_SHADOWS,this._filterColorAdjust.shadows),t.setUniformFloat(n.GLSLX_NAME_U_GLOBAL_HIGHLIGHTS,this._filterColorAdjust.highlights),t.setUniformFloat(n.GLSLX_NAME_U_GLOBAL_EXPOSURE,this._filterColorAdjust.exposure),t.setUniformFloat(n.GLSLX_NAME_U_GLOBAL_CONTRAST,this._filterColorAdjust.contrast),t.setUniformFloat(n.GLSLX_NAME_U_GLOBAL_TEMPERATURE,this._filterColorAdjust.temperature)}isEnabledAndVisible(){if(!this.isEnabled()||this.opacity()<=0)return!1;switch(this.type()){case"SOLID":return E.alpha(this.color())>0;case"GRADIENT_ANGULAR":case"GRADIENT_DIAMOND":case"GRADIENT_LINEAR":case"GRADIENT_RADIAL":{for(let t=0,n=this.colorStops().length;t<n;t=t+1)if(E.alpha(this.colorStops()[t].color)>0)return!0;return!1}}return!0}hasAnyFullyTransparentAreas(){if(!this.isEnabled()||this.opacity()<=0)return!0;switch(this.type()){case"SOLID":return E.alpha(this.color())==0;case"GRADIENT_ANGULAR":case"GRADIENT_DIAMOND":case"GRADIENT_LINEAR":case"GRADIENT_RADIAL":{for(let t=0,n=this.colorStops().length;t<n;t=t+1)if(E.alpha(this.colorStops()[t].color)==0)return!0;return!1}case"EMOJI":case"IMAGE":case"VIDEO":return!0}return!0}hasAnimatingMedia(){return this.image()!=null&&this.image().gif()!=null||this.video()!=null}optimized(){if(this.isGradient()&&this.colorStops().length!=0){let t=this.colorStops()[0].color;for(let n=1,r=this.colorStops().length;n<r;n=n+1)if(t!=this.colorStops()[n].color)return this;return ao.create("SOLID",this.opacity(),this.blendMode(),this.isEnabled(),t)}return this}equals1(t){return t.isVolatile()?!1:this.equals2(t.asSinglePaint())}equals2(t){if(this._colorStops==null||t.colorStops()==null){if(this._colorStops==null!=(t.colorStops()==null))return!1}else if(!en.FrozenList_equals(this._colorStops,t.colorStops(),$e.EQUALS))return!1;if(this._transform==null||t.transform()==null){if(this._transform==null!=(t.transform()==null))return!1}else if(!this.transform().equals1(t.transform()))return!1;if(this._video==null||t.video()==null){if(this._video==null!=(t.video()==null))return!1}else if(this._video.hash()!=t.video().hash())return!1;if(this._image==null||t.image()==null){if(this._image==null!=(t.image()==null))return!1}else if(this._image.objectHash()!=t.image().objectHash())return!1;if(this._imageThumbnail==null||t.imageThumbnail()==null){if(this._imageThumbnail==null!=(t.imageThumbnail()==null))return!1}else if(this._imageThumbnail.objectHash()!=t.imageThumbnail().objectHash())return!1;return this._type==t.type()&&this._blendMode==t.blendMode()&&this._color==t.color()&&this._isEnabled==t.isEnabled()&&this._opacity==t.opacity()&&this._rotationDeg==t.rotationDeg()&&this._scalingFactor==t.scalingFactor()&&this._imageScaleMode==t.imageScaleMode()&&this._filterColorAdjust==t.filterColorAdjust()&&this._decodedImageIsReady==t.decodedImageIsReady()&&this._decodedImageThumbnailIsReady==t.decodedImageThumbnailIsReady()}clone(){return this.cloneAsSinglePaint()}cloneAsSinglePaint(){let t=new ao(this._type);return t._blendMode=this._blendMode,t._color=this.color(),t._colorStops=this._colorStops,t._image=this._image,t._imageThumbnail=this._imageThumbnail,t._video=this._video,t._isEnabled=this._isEnabled,t._opacity=this._opacity,t._transform=this._transform,t._rotationDeg=this._rotationDeg,t._scalingFactor=this._scalingFactor,t._imageScaleMode=this._imageScaleMode,t._filterColorAdjust=this._filterColorAdjust,t._decodedImageIsReady=this._decodedImageIsReady,t._decodedImageThumbnailIsReady=this._decodedImageThumbnailIsReady,t._originalImageWidth=this._originalImageWidth,t._originalImageHeight=this._originalImageHeight,t}isOpaque(){if(this.opacity()<1||this.blendMode()!="NORMAL")return!1;switch(this.type()){case"SOLID":return E.isOpaque(this._color);case"GRADIENT_LINEAR":case"GRADIENT_RADIAL":case"GRADIENT_ANGULAR":case"GRADIENT_DIAMOND":{for(let t=0,n=this._colorStops.length;t<n;t=t+1){let r=this._colorStops[t];if(!E.isOpaque(r.color))return!1}return!0}case"EMOJI":case"IMAGE":case"VIDEO":return!1}return!1}flattenedStops(){let t=this._colorStops.slice();if(t.sort((n,r)=>Xt.double_compare(n.position,r.position)),us.shouldWrap(this.type())&&t.length>=2){let n=t[0],r=ue.List_last(t);if(n.position>0)if(r.position<1){let o=E.mix(n.color,r.color,n.position/(1-r.position+n.position));t.unshift(new $e(o,0)),t.push(new $e(o,1))}else t.unshift(new $e(r.color,0));else r.position<1&&t.push(new $e(n.color,1))}return t}asSinglePaint(){return this}getCanvasSpaceUnclippedImageSize(t){if(!this.isImageAvailable()&&!this.isImageThumbnailAvailable())return Ie.FrozenVector_ZERO;let n=this.allocateImageSize(),r=null;switch(this.imageScaleMode()){case"STRETCH":{r=t.divide1(this._transform.scale1());break}case"FILL":{let o=this.allocateBoundsToImageRatio(t,n);o.x()>o.y()?r=new I(t.x(),o.x()*this._image.height()):r=new I(o.y()*this._image.width(),t.y());break}case"FIT":{let o=this.allocateBoundsToImageRatio(t,n);o.x()>o.y()?r=new I(o.y()*this._image.width(),t.y()):r=new I(t.x(),o.x()*this._image.height());break}case"TILE":return Ie.FrozenVector_ZERO;default:return console.warn(`Unimplemented imageScaleMode ${this.imageScaleMode()} in getCanvasSpaceUnclippedImageSize`),Ie.FrozenVector_ZERO}return r}static create(t,n,r,o,a){let s=new ao(t);return s.setOpacity(n),s.setBlendMode(r),s.setIsEnabled(o),s.setColor(a),s}static createSolid(t,n){return ao.create("SOLID",n*E.alphaF(t),"NORMAL",!0,E.withAlpha(t,255))}static createLinearGradient(t){let n=ao.create("GRADIENT_LINEAR",1,"NORMAL",!0,E.BLACK);return n.setColorStops1(t),n}static createRadialGradient(t){let n=ao.create("GRADIENT_RADIAL",1,"NORMAL",!0,E.BLACK);return n.setColorStops1(t),n}static createAngularGradient(t){let n=ao.create("GRADIENT_ANGULAR",1,"NORMAL",!0,E.BLACK);return n.setColorStops1(t),n}static createDiamondGradient(t){let n=ao.create("GRADIENT_DIAMOND",1,"NORMAL",!0,E.BLACK);return n.setColorStops1(t),n}};ao.TRANSPARENT=ao.create("SOLID",0,"NORMAL",!0,E.BLACK),ao.SOLID_BLACK=ao.create("SOLID",1,"NORMAL",!0,E.BLACK);var ie=ao,_c=class i extends fu{constructor(t,n,r,o,a){super();this._from=null,this._to=null,this._getEasedT=null,this._fromCanvasSpaceNodeSize=null,this._toCanvasSpaceNodeSize=null,this._cachedFromTransform=null,this._cachedToTransform=null,this._cachedFromOffsetFromCenter=null,this._cachedToOffsetFromCenter=null,this._cachedFromImageOnCanvasSize=null,this._cachedToImageOnCanvasSize=null,this._from=t,this._to=n,this._getEasedT=r,this._fromCanvasSpaceNodeSize=o,this._toCanvasSpaceNodeSize=a,this._needsImageDimensionsForInterpolation()&&this._computeCachedImageDimensions()}_needsImageDimensionsForInterpolation(){return this.type()!="IMAGE"&&this.type()!="VIDEO"||!this._from.isImageAvailable()&&!this._from.isImageThumbnailAvailable()||!this._to.isImageAvailable()&&!this._to.isImageThumbnailAvailable()?!1:this._from.imageScaleMode()!="TILE"&&this._to.imageScaleMode()!="TILE"&&(this._from.imageScaleMode()=="STRETCH"||this._to.imageScaleMode()=="STRETCH"||this._from.imageScaleMode()!=this._to.imageScaleMode())}_computeCachedImageDimensions(){this.from().imageScaleMode()!="STRETCH"?(this._cachedFromTransform=this._from.allocateImageTransformForGeometrySize(this._fromCanvasSpaceNodeSize),this._cachedFromOffsetFromCenter=new I(0,0)):(this._cachedFromTransform=this.from().transform(),this._cachedFromOffsetFromCenter=new I(.5,.5).subtract1(this._cachedFromTransform.scale1().divide(2).add1(this._cachedFromTransform.translation()))),this.to().imageScaleMode()!="STRETCH"?(this._cachedToTransform=this._to.allocateImageTransformForGeometrySize(this._toCanvasSpaceNodeSize),this._cachedToOffsetFromCenter=new I(0,0)):(this._cachedToTransform=this.to().transform(),this._cachedToOffsetFromCenter=new I(.5,.5).subtract1(this._cachedToTransform.scale1().divide(2).add1(this._cachedToTransform.translation()))),this._cachedFromImageOnCanvasSize=this.from().getCanvasSpaceUnclippedImageSize(this._fromCanvasSpaceNodeSize),this._cachedToImageOnCanvasSize=this.to().getCanvasSpaceUnclippedImageSize(this._toCanvasSpaceNodeSize)}isEnabled(){return this._from.isEnabled()||this._to.isEnabled()}isVisible(){return this.isEnabled()&&(this._from.opacity()>0||this._to.opacity()>0)}isVolatile(){return!0}type(){return this._from.type()}blendMode(){return this._from.blendMode()}setIsEnabled(t){this._from.setIsEnabled(t),this._to.setIsEnabled(t)}isEnabledAndVisible(){return this._from.isEnabledAndVisible()||this._to.isEnabledAndVisible()}debugString(){return`VolatilePaint from=[${this._from.debugString()}] to=[${this._to.debugString()}]`}t(){return this._getEasedT()}from(){return this._from}to(){return this._to}color(){return E.mix(this._from.color(),this._to.color(),this._getEasedT())}isOpaque(){return this._from.isOpaque()&&this._to.isOpaque()}transform(){let t=new I(.5,.5),n=this._from.transform().clone().translatedBy1(t),r=this._to.transform().clone().translatedBy1(t);return Yr.lerp1(n,r,this.t()).translatedBy1(t.negative())}allocateImageTransformForGeometrySize(t){let n=ne.new2(),r=I.lerp(this._fromCanvasSpaceNodeSize,this._toCanvasSpaceNodeSize,this.t());if(this.from().imageScaleMode()=="STRETCH"||this.to().imageScaleMode()=="STRETCH"||this.from().imageScaleMode()!=this.to().imageScaleMode()){(this._cachedFromTransform==null||this._cachedToTransform==null||this._cachedFromOffsetFromCenter==null||this._cachedToOffsetFromCenter==null||this._cachedFromImageOnCanvasSize==null||this._cachedToImageOnCanvasSize==null)&&this._computeCachedImageDimensions();let o=I.lerp(this._cachedFromImageOnCanvasSize,this._cachedToImageOnCanvasSize,this.t()),a=r.divide1(o),s=I.lerp(this._cachedFromOffsetFromCenter,this._cachedToOffsetFromCenter,this.t()),l=new I(.5,.5).subtract1(s).subtract1(a.divide(2)),d=Xt.double_lerp(this._cachedFromTransform.toAngle(),this._cachedToTransform.toAngle(),this.t());return n.translatedBy1(l).rotatedBy(d).scaledBy1(a)}else{let o=this._from.allocateImageTransformForGeometrySize(r),a=this._to.allocateImageTransformForGeometrySize(r);return n.copyFrom(Yr.lerp1(o,a,this.t())),n}}opacity(){return Xt.double_clamp(Xt.double_lerp(this.from().opacity(),this.to().opacity(),this.t()),0,1)}colorAdjustIsActive(){return this._from.colorAdjustIsActive()||this._to.colorAdjustIsActive()}colorAdjustSetData(t){let n=Fn.instance();t.setUniformFloat(n.GLSLX_NAME_U_GLOBAL_TINT,Xt.double_clamp(Xt.double_lerp(this.from().filterColorAdjust()!=null?this.from().filterColorAdjust().tint:0,this.to().filterColorAdjust()!=null?this.to().filterColorAdjust().tint:0,this.t()),-1,1)),t.setUniformFloat(n.GLSLX_NAME_U_GLOBAL_COLOR,Xt.double_clamp(Xt.double_lerp(this.from().filterColorAdjust()!=null?this.from().filterColorAdjust().vibrance:0,this.to().filterColorAdjust()!=null?this.to().filterColorAdjust().vibrance:0,this.t()),-1,1)),t.setUniformFloat(n.GLSLX_NAME_U_GLOBAL_SHADOWS,Xt.double_clamp(Xt.double_lerp(this.from().filterColorAdjust()!=null?this.from().filterColorAdjust().shadows:0,this.to().filterColorAdjust()!=null?this.to().filterColorAdjust().shadows:0,this.t()),-1,1)),t.setUniformFloat(n.GLSLX_NAME_U_GLOBAL_HIGHLIGHTS,Xt.double_clamp(Xt.double_lerp(this.from().filterColorAdjust()!=null?this.from().filterColorAdjust().highlights:0,this.to().filterColorAdjust()!=null?this.to().filterColorAdjust().highlights:0,this.t()),-1,1)),t.setUniformFloat(n.GLSLX_NAME_U_GLOBAL_EXPOSURE,Xt.double_clamp(Xt.double_lerp(this.from().filterColorAdjust()!=null?this.from().filterColorAdjust().exposure:0,this.to().filterColorAdjust()!=null?this.to().filterColorAdjust().exposure:0,this.t()),-1,1)),t.setUniformFloat(n.GLSLX_NAME_U_GLOBAL_CONTRAST,Xt.double_clamp(Xt.double_lerp(this.from().filterColorAdjust()!=null?this.from().filterColorAdjust().contrast:0,this.to().filterColorAdjust()!=null?this.to().filterColorAdjust().contrast:0,this.t()),-.3,.3)),t.setUniformFloat(n.GLSLX_NAME_U_GLOBAL_TEMPERATURE,Xt.double_clamp(Xt.double_lerp(this.from().filterColorAdjust()!=null?this.from().filterColorAdjust().temperature:0,this.to().filterColorAdjust()!=null?this.to().filterColorAdjust().temperature:0,this.t()),-1,1))}equals1(t){return t.isVolatile()?this.equals2(t.asVolatilePaint()):!1}equals2(t){if(!t.isVolatile())return!1;let n=t;return this._from.equals2(n._from.asSinglePaint())&&this._to.equals2(n._to.asSinglePaint())&&this._getEasedT==n._getEasedT&&this._fromCanvasSpaceNodeSize.equals(n._fromCanvasSpaceNodeSize)&&this._toCanvasSpaceNodeSize.equals(n._toCanvasSpaceNodeSize)}clone(){return this.cloneAsVolatilePaint()}cloneAsVolatilePaint(){return new i(this._from.cloneAsSinglePaint(),this._to.cloneAsSinglePaint(),this._getEasedT,this._fromCanvasSpaceNodeSize,this._toCanvasSpaceNodeSize)}hasAnyFullyTransparentAreas(){return this._from.hasAnyFullyTransparentAreas()&&this._to.hasAnyFullyTransparentAreas()}asVolatilePaint(){return this}eitherPaint(t){return t(this._from)||t(this._to)}static create(t,n,r,o,a){return new i(t,n,a,r,o)}},lS;(e=>e.FrozenPaint_EMPTY_LIST=[])(lS||(lS={}));var Ne;(K=>{function i(F,P){return[ie.createSolid(F,P)]}K.createFromSolidColor=i;function e(F){return F}K.create1=e;function t(F){return F}K.create2=t;function n(F){return[F]}K.fromPaint=n;function r(F){return F}K.asPaintList=r;function o(F){return F.length==0}K.isEmpty=o;function a(F){return F.length}K.count=a;function s(F,P){return F[P]}K.get=s;function l(F){return F[0]}K.first=l;function d(F){return ue.List_last(F)}K.last=d;function c(F){return F.slice()}K.clone=c;function p(F){let P=!1;for(let k=0,H=F.length;k<H;k=k+1)F[k].type()=="EMOJI"&&(P=!0);return P}K.hasEmoji=p;function u(F,P){return en.FrozenList_equals(F,P,(k,H)=>k==null||H==null?k==null==(H==null):k.equals1(H))}K.equals=u;function h(F){return F.length==1?F[0]:null}K.onlyPaintOrNull=h;function f(F){let P=h(F);return P!=null&&P.type()=="SOLID"&&!P.isVolatile()?P:null}K.onlySolidPaintOrNull=f;function y(F){for(let P=0,k=F.length;P<k;P=P+1){let H=F.length-1-P;if(!F[H].isEnabledAndVisible())continue;let L=F[H];return L!=null&&L.type()=="SOLID"&&!L.isVolatile()&&L.asSinglePaint().isOpaque()?L:null}return null}K.firstPaintIfSolidAndOpaqueOrNull=y;function g(F){return F.length==1&&F[0].type()=="EMOJI"}K.isEmojiPaint=g;function A(F){for(let P=0,k=F.length;P<k;P=P+1){let H=F[P].asSinglePaint();if(H!=null){if(H.blendMode()!="NORMAL"&&H.blendMode()!="PASS_THROUGH")return!1}else{let L=F[P].asVolatilePaint();if(L!=null&&L.eitherPaint(Q=>Q.blendMode()!="NORMAL"&&Q.blendMode()!="PASS_THROUGH"))return!1}}return!0}K.isIsolated=A;function T(F){for(let P=0,k=F.length;P<k;P=P+1)if(F[P].isEnabledAndVisible())return!0;return!1}K.containsAtLeastOneVisiblePaint=T;function b(F){for(let P=0,k=F.length;P<k;P=P+1){let H=F[P].asSinglePaint(),L=F[P].asVolatilePaint();if(H==null&&L!=null&&L.isVisible()||H!=null&&H.isVisible()&&!H.hasAnyFullyTransparentAreas())return!0}return!1}K.containsAtLeastOneVisibleNotFullyTransparentPaint=b;function _(F){for(let P=0,k=F.length;P<k;P=P+1){if(!F[P].isEnabledAndVisible())continue;let H=F[P].asSinglePaint();if(H!=null){if(H.isOpaque())return!0}else{let L=F[P].asVolatilePaint();if(L!=null&&L.isOpaque())return!0}}return!1}K.containsAtLeastOneVisibleOpaquePaint=_;function m(F){for(let P=0,k=F.length;P<k;P=P+1){let H=F[P].asSinglePaint();if(H!=null){if(!H.isOpaque())return!0}else{let L=F[P].asVolatilePaint();if(L!=null&&!L.isOpaque())return!0}}return!1}K.containsAtLeastOneNonOpaquePaint=m;function S(F){for(let P=0,k=F.length;P<k;P=P+1){let H=F[P].asSinglePaint();if(H==null&&F[P].asVolatilePaint()!=null||!H.hasAnyFullyTransparentAreas())return!1}return!0}K.hasAnyFullyTransparentAreas=S;function v(F){for(let P=0,k=F.length;P<k;P=P+1){let H=F[P].asSinglePaint();if(H!=null){if(H.hasAnimatingMedia())return!0}else{let L=F[P].asVolatilePaint();if(L!=null&&L.eitherPaint(Q=>Q.hasAnimatingMedia()))return!0}}return!1}K.hasAnimatingMediaPaints=v;function C(F){for(let P=0,k=F.length;P<k;P=P+1)if(F[P].isVolatile())return!0;return!1}K.hasVolatilePaints=C;function N(F,P){var k,H;for(let L=0,Q=F.length;L<Q;L=L+1){let X=F[L].asSinglePaint();(X==null?void 0:X.video())!=null&&P(X);let M=F[L].asVolatilePaint();((k=M==null?void 0:M.to())==null?void 0:k.video())!=null&&P(M.to()),((H=M==null?void 0:M.from())==null?void 0:H.video())!=null&&P(M.from())}}K.forEachPaintWithVideo=N;function x(F){if(A(F))return[F];let P=[],k="NORMAL",H=[];for(let L=0,Q=F.length;L<Q;L=L+1){let X=F[L];(X.blendMode()!=k||X.blendMode()!="NORMAL")&&H.length!=0&&(P.push(H.slice()),H.length=0),k=X.blendMode(),H.push(X)}return H.length!=0&&P.push(H.slice()),P}K.isolatedPaints=x;function z(F){if(C(F))return F;if(F.length==2&&F[0].type()=="SOLID"&&ue.List_last(F).asSinglePaint().isGradient()){let k=F[0].asSinglePaint(),H=E.multiplyOpacity(k.color(),k.opacity()),L=ue.List_last(F).clone(),Q=[],X=-1,M=!0,te=L.colorStops();for(let J=0,oe=te.length;J<oe;J=J+1){let le=te[J];if(X>=0&&X!=E.alpha(le.color)){M=!1;break}X=E.alpha(le.color);let tt=E.multiplyOpacity(le.color,L.opacity());Q.push(new $e(E.blend(H,tt),le.position))}if(M)return L.setOpacity(1),L.setColorStops1(Q),z([L])}let P=F.length;for(let k=0;k<P;k=k+1){let H=F[k].asSinglePaint().optimized();if(H==F[k])continue;let L=F.slice(0,k);for(L.push(H);(k=k+1)<P;)L.push(F[k].asSinglePaint().optimized());return L}return F}K.optimize=z,K.SOLID_BLACK=[ie.createSolid(E.BLACK,1)],K.EMPTY=[]})(Ne||(Ne={}));var sn;(u=>{function i(h,f){return Bn.string_compare(h,f)}u.compare=i;function e(h,f){return h==f}u.equals=e;function t(h){return h}u.toString=t;function n(h){return h.length>0}u.isValid=n;function r(h){let f=h,y=f.length-1,g=y;for(;g>=0;){let A=f.charCodeAt(g);if(A>u.LOWER+1)return f.slice(0,g)+String.fromCharCode(A-1);g=g-1}return f.slice(0,y)+String.fromCharCode(u.LOWER)+String.fromCharCode(u.UPPER)}u.before=r;function o(h){let f=h,y=f.length-1;for(;y>=0;){let g=f.charCodeAt(y);if(g<u.UPPER)return f.slice(0,y)+String.fromCharCode(g+1);y=y-1}return f+String.fromCharCode(u.LOWER+1)}u.after=o;function a(h){if(h==null||h==""||h.charCodeAt(h.length-1)==u.LOWER)return null;for(let f=0,y=h.length;f<y;f=f+1)if(h.charCodeAt(f)<u.LOWER||h.charCodeAt(f)>u.UPPER)return null;return h}u.fromString=a;function s(h,f){let y=h,g=f,A=y.length,T=g.length,b="",_=!1;for(let m=0,S=Math.max(A,T);m<S;m=m+1){let v=m<A?y.charCodeAt(m):u.LOWER,C=m<T&&!_?g.charCodeAt(m):u.UPPER;if(v==C)b+=String.fromCharCode(v);else if(C-v>1){b+=String.fromCharCode(v+C>>1),_=!1;break}else b+=String.fromCharCode(v),_=!0}return _&&(b+=String.fromCharCode(u.LOWER+u.UPPER>>1)),b}u.between=s,u.LOWER=32,u.UPPER=126,u.FIRST_POSITION=String.fromCharCode(u.LOWER+1),u.SECOND_POSITION=String.fromCharCode(u.LOWER+2)})(sn||(sn={}));var Gn=class i{toString(){return`${this.id};${sn.toString(this.position)}`}equals(e){return ee.equals(this.id,e.id)&&sn.equals(this.position,e.position)}static fromString(e){let t=e.indexOf(";");if(t==-1)return null;let n=e.slice(0,t);if(n=="-1:-1")return null;let r=ee.fromString(n);return new i(r,sn.fromString(e.slice(t+1)))}constructor(e,t){this.id=e,this.position=t}};var so=class i{constructor(){this._float=null,this._int=null,this._value=0,this._float=new Float32Array(1),this._int=new Int32Array(this._float.buffer)}reset(){this._value=0}value(){return this._value}hash1(e){this._float[0]=e,this._value=i.combine(this._value,this._int[0])}hash2(e){this._value=i.combine(this._value,e)}static combine(e,t){return t+-1640531527+(e<<6)+(e>>2)}};function cS(i,e,t){if(e==5&&i[4].equals(i[0])&&(e=e-1),e!=4)return!1;let s=.001,l=0,d=0;for(let c=0;c<e;c=c+1){let p=i[c],u=0;if(p.x()<t.left()+s)if(p.y()<t.top()+s)u=0;else if(p.y()>t.bottom()-s)u=2;else return!1;else if(p.x()>t.right()-s)if(p.y()<t.top()+s)u=1;else if(p.y()>t.bottom()-s)u=3;else return!1;else return!1;if(c>0){let h=l^u;if(h!=1&&h!=2)return!1}d|=1<<u,l=u}return d==15}var Ac=class{constructor(e,t){this.bounds=e,this.isRect=t}},Ye=class i{constructor(){if(arguments.length==1){let e=arguments[0];this._data=null,this._cachedInfo=null,this._hash=null,this.VERTEX_PATTERN_COUNT=5,this.VERTEX_PATTERN=[null,null,null,null,null],this._data=e,this._cachedInfo=null,this._hash=null}else if(arguments.length==3){let e=arguments[0],t=arguments[1],n=arguments[2];this._data=null,this._cachedInfo=null,this._hash=null,this.VERTEX_PATTERN_COUNT=5,this.VERTEX_PATTERN=[null,null,null,null,null],this._data=e,this._cachedInfo=t,this._hash=new _e(n)}}_invalidateCachedData(){this._cachedInfo=null,this._hash=null}equals2(e){return e instanceof i?this.equals1(e):!1}equals1(e){return this._data.byteCount()!=e._data.byteCount()||this.hash()!=e.hash()?!1:Ud.FrozenDataArray_equals(this._data,e._data)}clone(){return this.getMutableClone()}getMutableClone(){return new Et(this._data.clone())}isEmpty(){return this._data.isEmpty()}start(){return 0}bounds(){return this._cachedInfo==null&&(this._cachedInfo=this._computeBoundsAndRectInfo()),this._cachedInfo.bounds}isRect(){return this._cachedInfo==null&&(this._cachedInfo=this._computeBoundsAndRectInfo()),this._cachedInfo.isRect}asRoundedRectPath(){return null}canBeAnalyticallyAntialiased(){return!1}hash(){if(this._cachedInfo==null&&(this._cachedInfo=this._computeBoundsAndRectInfo()),this._hash==null){let e=new so;for(let t=0,n=this._data.byteCount();t<n;t=t+1)e.hash2(this._data.byteAt(t));this._hash=new _e(e.value())}return this._hash.value}countCommands(){let e=0;for(let t=this.start();i.Command.isValid(t,this);t=i.Command.next(t,this))e=e+1;return e}_computeBoundsAndRectInfo(){let e=_t.INSTANCE;e.reset();for(let d=0,c=this.VERTEX_PATTERN_COUNT;d<c;d=d+1)this.VERTEX_PATTERN[d]=null;let t=!1,n=!1,r=0,o=I.new2(),a=d=>{r<this.VERTEX_PATTERN_COUNT&&(this.VERTEX_PATTERN[r]=d),e.include2(d),r=r+1};for(let d=this.start();i.Command.isValid(d,this);d=i.Command.next(d,this))switch(i.Command.kind(d,this)){case i.Command.Kind.CLOSE:{n=!1;break}case i.Command.Kind.MOVE_TO:{o=i.Command.point(d,this),n=!1;break}case i.Command.Kind.LINE_TO:case i.Command.Kind.QUADRATIC_TO:case i.Command.Kind.CUBIC_TO:{n||(a(o),n=!0),i.Command.kind(d,this)==i.Command.Kind.QUADRATIC_TO?(e.include2(i.Command.control1(d,this)),t=!0):i.Command.kind(d,this)==i.Command.Kind.CUBIC_TO&&(e.include2(i.Command.control1(d,this)),e.include2(i.Command.control2(d,this)),t=!0),o=i.Command.point(d,this),a(o);break}default:break}let s=e.isValid()?e.build():G.INVALID,l=!t&&r<=this.VERTEX_PATTERN_COUNT&&cS(this.VERTEX_PATTERN,r,s);return new Ac(s,l)}toBezierPath(){return this}toString(){let e="";for(let t=this.start();i.Command.isValid(t,this);t=i.Command.next(t,this))switch(t!=this.start()&&(e+=" "),i.Command.kind(t,this)){case i.Command.Kind.CLOSE:{e+="Z";break}case i.Command.Kind.MOVE_TO:{e+=`M ${i.Command.moveToX(t,this)} ${i.Command.moveToY(t,this)}`;break}case i.Command.Kind.LINE_TO:{e+=`L ${i.Command.lineToX(t,this)} ${i.Command.lineToY(t,this)}`;break}case i.Command.Kind.QUADRATIC_TO:{e+=`Q ${i.Command.quadraticToFirstX(t,this)} ${i.Command.quadraticToFirstY(t,this)} ${i.Command.quadraticToX(t,this)} ${i.Command.quadraticToY(t,this)}`;break}case i.Command.Kind.CUBIC_TO:{e+=`C ${i.Command.cubicToFirstX(t,this)} ${i.Command.cubicToFirstY(t,this)} ${i.Command.cubicToSecondX(t,this)} ${i.Command.cubicToSecondY(t,this)} ${i.Command.cubicToX(t,this)} ${i.Command.cubicToY(t,this)}`;break}default:{break}}return e}data(){return this._data}};(e=>{let i;(te=>{function t(J,oe){return oe.data().byteAt(J)}te.kind=t;function n(J,oe){let le=t(J,oe);return J+(le==4?1+4*6:le==3?1+4*4:le==0?1:1+4*2)}te.next=n;function r(J,oe){if(J>=oe.data().byteCount())return!1;let le=0;switch(t(J,oe)){case 0:{le=1;break}case 1:case 2:{le=1+1*8;break}case 3:{le=1+2*8;break}case 4:{le=1+3*8;break}default:return!1}return J+le<=oe.data().byteCount()}te.isValid=r;function o(J,oe){return l(J,oe,t(J,oe)==3?1:t(J,oe)==4?2:0)}te.point=o;function a(J,oe){return l(J,oe,0)}te.control1=a;function s(J,oe){return l(J,oe,1)}te.control2=s;function l(J,oe,le){return new I(oe.data().floatAt(J+1+8*le),oe.data().floatAt(J+1+8*le+4))}te.pointAtIndex=l;function d(J,oe){return oe.data().floatAt(J+1)}te.moveToX=d;function c(J,oe){return oe.data().floatAt(J+(1+4))}te.moveToY=c;function p(J,oe,le){oe.setFloatAt(J+1,le)}te.setMoveToX=p;function u(J,oe,le){oe.setFloatAt(J+(1+4),le)}te.setMoveToY=u;function h(J,oe){return oe.data().floatAt(J+1)}te.lineToX=h;function f(J,oe){return oe.data().floatAt(J+(1+4))}te.lineToY=f;function y(J,oe,le){oe.setFloatAt(J+1,le)}te.setLineToX=y;function g(J,oe,le){oe.setFloatAt(J+(1+4),le)}te.setLineToY=g;function A(J,oe){return oe.data().floatAt(J+1)}te.quadraticToFirstX=A;function T(J,oe){return oe.data().floatAt(J+(1+4))}te.quadraticToFirstY=T;function b(J,oe){return oe.data().floatAt(J+(1+4*2))}te.quadraticToX=b;function _(J,oe){return oe.data().floatAt(J+(1+4*3))}te.quadraticToY=_;function m(J,oe,le){oe.setFloatAt(J+1,le)}te.setQuadraticToFirstX=m;function S(J,oe,le){oe.setFloatAt(J+(1+4),le)}te.setQuadraticToFirstY=S;function v(J,oe,le){oe.setFloatAt(J+(1+4*2),le)}te.setQuadraticToX=v;function C(J,oe,le){oe.setFloatAt(J+(1+4*3),le)}te.setQuadraticToY=C;function N(J,oe){return oe.data().floatAt(J+1)}te.cubicToFirstX=N;function x(J,oe){return oe.data().floatAt(J+(1+4))}te.cubicToFirstY=x;function z(J,oe){return oe.data().floatAt(J+(1+4*2))}te.cubicToSecondX=z;function $(J,oe){return oe.data().floatAt(J+(1+4*3))}te.cubicToSecondY=$;function q(J,oe){return oe.data().floatAt(J+(1+4*4))}te.cubicToX=q;function K(J,oe){return oe.data().floatAt(J+(1+4*5))}te.cubicToY=K;function F(J,oe,le){oe.setFloatAt(J+1,le)}te.setCubicToFirstX=F;function P(J,oe,le){oe.setFloatAt(J+(1+4),le)}te.setCubicToFirstY=P;function k(J,oe,le){oe.setFloatAt(J+(1+4*2),le)}te.setCubicToSecondX=k;function H(J,oe,le){oe.setFloatAt(J+(1+4*3),le)}te.setCubicToSecondY=H;function L(J,oe,le){oe.setFloatAt(J+(1+4*4),le)}te.setCubicToX=L;function Q(J,oe,le){oe.setFloatAt(J+(1+4*5),le)}te.setCubicToY=Q;let X;(At=>(At[At.CLOSE=0]="CLOSE",At[At.MOVE_TO=1]="MOVE_TO",At[At.LINE_TO=2]="LINE_TO",At[At.QUADRATIC_TO=3]="QUADRATIC_TO",At[At.CUBIC_TO=4]="CUBIC_TO"))(X=te.Kind||(te.Kind={}));let M;(oe=>{function J(le){return X[le]}oe.Kind_toString=J})(M=te.in_Kind||(te.in_Kind={}))})(i=e.Command||(e.Command={}))})(Ye||(Ye={}));var pt=class pt extends Ye{constructor(e){super(e)}static mutableData(e){return e._data}append(e){this._invalidateCachedData(),!this.isEmpty()&&!e.isEmpty()&&Ye.Command.kind(e.start(),e)!=1&&this.moveTo1(0,0),this._data.appendBytes(e.data())}setFloatAt(e,t){this._invalidateCachedData(),this._data.setFloatAt(e,t)}moveTo1(e,t){return this._invalidateCachedData(),this._data.appendByte(1),this._data.appendFloat(e),this._data.appendFloat(t),this}moveTo2(e){return this.moveTo1(e.x(),e.y())}lineTo(e,t){return this._invalidateCachedData(),this._data.appendByte(2),this._data.appendFloat(e),this._data.appendFloat(t),this}quadraticTo(e,t,n,r){return this._invalidateCachedData(),this._data.appendByte(3),this._data.appendFloat(e),this._data.appendFloat(t),this._data.appendFloat(n),this._data.appendFloat(r),this}cubicTo1(e,t,n,r,o,a){return this._invalidateCachedData(),this._data.appendByte(4),this._data.appendFloat(e),this._data.appendFloat(t),this._data.appendFloat(n),this._data.appendFloat(r),this._data.appendFloat(o),this._data.appendFloat(a),this}cubicTo2(e,t,n){return this.cubicTo1(e.x(),e.y(),t.x(),t.y(),n.x(),n.y())}close(){return this._invalidateCachedData(),this._data.appendByte(0),this}transformBy(e){this._invalidateCachedData(),!this.isEmpty()&&Ye.Command.kind(this.start(),this)!=1&&this._data.prependBytes(new pt(new gr).moveTo1(0,0)._data);for(let t=this.start();Ye.Command.isValid(t,this);t=Ye.Command.next(t,this))switch(Ye.Command.kind(t,this)){case 0:break;case 1:{pt._p0.setTo(Ye.Command.moveToX(t,this),Ye.Command.moveToY(t,this)),e.transformPoint(pt._p0),Ye.Command.setMoveToX(t,this,pt._p0.x()),Ye.Command.setMoveToY(t,this,pt._p0.y());break}case 2:{pt._p0.setTo(Ye.Command.lineToX(t,this),Ye.Command.lineToY(t,this)),e.transformPoint(pt._p0),Ye.Command.setLineToX(t,this,pt._p0.x()),Ye.Command.setLineToY(t,this,pt._p0.y());break}case 3:{pt._p0.setTo(Ye.Command.quadraticToFirstX(t,this),Ye.Command.quadraticToFirstY(t,this)),e.transformPoint(pt._p0),Ye.Command.setQuadraticToFirstX(t,this,pt._p0.x()),Ye.Command.setQuadraticToFirstY(t,this,pt._p0.y()),pt._p0.setTo(Ye.Command.quadraticToX(t,this),Ye.Command.quadraticToY(t,this)),e.transformPoint(pt._p0),Ye.Command.setQuadraticToX(t,this,pt._p0.x()),Ye.Command.setQuadraticToY(t,this,pt._p0.y());break}case 4:{pt._p0.setTo(Ye.Command.cubicToFirstX(t,this),Ye.Command.cubicToFirstY(t,this)),e.transformPoint(pt._p0),Ye.Command.setCubicToFirstX(t,this,pt._p0.x()),Ye.Command.setCubicToFirstY(t,this,pt._p0.y()),pt._p0.setTo(Ye.Command.cubicToSecondX(t,this),Ye.Command.cubicToSecondY(t,this)),e.transformPoint(pt._p0),Ye.Command.setCubicToSecondX(t,this,pt._p0.x()),Ye.Command.setCubicToSecondY(t,this,pt._p0.y()),pt._p0.setTo(Ye.Command.cubicToX(t,this),Ye.Command.cubicToY(t,this)),e.transformPoint(pt._p0),Ye.Command.setCubicToX(t,this,pt._p0.x()),Ye.Command.setCubicToY(t,this,pt._p0.y());break}default:break}}static new2(){return new pt(new gr)}static fromRect(e){return pt._fromRect(e.x(),e.y(),e.width(),e.height())}static _fromRect(e,t,n,r){let o=pt.new2();return o.moveTo1(e,t).lineTo(e+n,t).lineTo(e+n,t+r).lineTo(e,t+r).close(),o}static fromRoundedRectWithSpread(e,t){return e.adjustCornerRadiiForSpread(t),pt.fromRoundedRect1(e)}static fromRoundedRect1(e){return e.vertexRadii()!=null?pt.fromRoundedRect3(e.left(),e.top(),e.width(),e.height(),e.vertexRadii()):pt.fromRoundedRect2(e.left(),e.top(),e.width(),e.height(),e.nodeRadius())}static fromRoundedRect2(e,t,n,r,o){if(o=Math.min(o,Math.min(n/2,r/2)),o==0)return pt._fromRect(e,t,n,r);let a=pt.new2(),s=pt.CIRCLE_APPROXIMATION_CONSTANT*o;return a.moveTo1(e,t+o).cubicTo1(e,t+o-s,e+o-s,t,e+o,t).lineTo(e+n-o,t).cubicTo1(e+n-o+s,t,e+n,t+o-s,e+n,t+o).lineTo(e+n,t+r-o).cubicTo1(e+n,t+r-o+s,e+n-o+s,t+r,e+n-o,t+r).lineTo(e+o,t+r).cubicTo1(e+o-s,t+r,e,t+r-o+s,e,t+r-o).close(),a}static fromRoundedRect3(e,t,n,r,o){let a=!0;for(let d=0,c=o.length;d<c;d=d+1)o[d]!=0&&(a=!1),o[d]=Math.min(o[d],Math.min(n/2,r/2));if(a)return pt._fromRect(e,t,n,r);let s=pt.new2(),l=o.map(d=>pt.CIRCLE_APPROXIMATION_CONSTANT*d);return s.moveTo1(e,t+o[0]).cubicTo1(e,t+o[0]-l[0],e+o[0]-l[0],t,e+o[0],t).lineTo(e+n-o[1],t).cubicTo1(e+n-o[1]+l[1],t,e+n,t+o[1]-l[1],e+n,t+o[1]).lineTo(e+n,t+r-o[2]).cubicTo1(e+n,t+r-o[2]+l[2],e+n-o[2]+l[2],t+r,e+n-o[2],t+r).lineTo(e+o[3],t+r).cubicTo1(e+o[3]-l[3],t+r,e,t+r-o[3]+l[3],e,t+r-o[3]).close(),s}static forEllipse(e){let t=new I(e.left()+e.width()/2,e.top()+e.height()/2),n=new I(e.width()/2,0),r=new I(0,e.height()/2),o=n.multiply(pt.CIRCLE_APPROXIMATION_CONSTANT),a=r.multiply(pt.CIRCLE_APPROXIMATION_CONSTANT),s=pt.new2();return s.moveTo2(t.add1(n)).cubicTo2(t.add1(n).add1(a),t.add1(o).add1(r),t.add1(r)).cubicTo2(t.subtract1(o).add1(r),t.subtract1(n).add1(a),t.subtract1(n)).cubicTo2(t.subtract1(n).subtract1(a),t.subtract1(o).subtract1(r),t.subtract1(r)).cubicTo2(t.add1(o).subtract1(r),t.add1(n).subtract1(a),t.add1(n)).close(),s}static forCenterStrokeAroundRect(e,t){let n=e.x(),r=e.y(),o=e.width(),a=e.height(),s=t/2,l=pt.new2();return l.moveTo1(n-s,r-s).lineTo(n+o+s,r-s).lineTo(n+o+s,r+a+s).lineTo(n-s,r+a+s).lineTo(n-s,r-s).lineTo(n+s,r+s).lineTo(n+s,r+a-s).lineTo(n+o-s,r+a-s).lineTo(n+o-s,r+s).lineTo(n+s,r+s).close(),l}};pt.CIRCLE_APPROXIMATION_CONSTANT=4/3*(Math.sqrt(2)-1),pt._p0=I.new2(),pt._p1=I.new2(),pt._p2=I.new2(),pt._p3=I.new2(),pt._r=G.new2();var Et=pt;var Cr=class Cr{constructor(e,t){this._rect=null,this._radii=null,this._hash=0,this._cachedBezier=null,this._rect=e,this._radii=t.clippedForRectOfBounds(e),Cr.hasher.reset(),Cr.hasher.hash1(this._rect.x()),Cr.hasher.hash1(this._rect.y()),Cr.hasher.hash1(this._rect.width()),Cr.hasher.hash1(this._rect.height()),Cr.hasher.hash1(this._radii.topLeft),Cr.hasher.hash1(this._radii.topRight),Cr.hasher.hash1(this._radii.bottomRight),Cr.hasher.hash1(this._radii.bottomLeft),this._hash=Cr.hasher.value()}radii(){return this._radii}bounds(){return this._rect}equals2(e){return e instanceof Cr?this.equals1(e):!1}equals1(e){return this._rect.equals(e._rect)&&this._radii.equals(e._radii)}clone(){return new Cr(this._rect.clone(),this._radii)}hash(){return this._hash}isRect(){return this._radii.isZeros()}canBeAnalyticallyAntialiased(){return w.supportsWebGLExtensionOESStandardDerivatives()}toBezierPath(){return this._cachedBezier==null&&(this._cachedBezier=Et.fromRoundedRect3(this._rect.x(),this._rect.y(),this._rect.width(),this._rect.height(),this._radii.toList())),this._cachedBezier}asRoundedRectPath(){return this}static fromRect(e){return new Cr(e,lo.fromNodeRadius(0))}static fromRoundedRect(e){let t=e.vertexRadii()!=null?lo.fromList(e.vertexRadii()):e.nodeRadius()!=0?lo.fromNodeRadius(e.nodeRadius()):lo.ZEROS;return new Cr(e.rect(),t)}static isRoundedRectSupported(e){if(e.cornerSmoothing()!=0)return!1;let t=e.vertexRadii();if(t!=null){let n=Math.max(Math.max(t[0],t[1]),Math.max(t[2],t[3])),r=Math.min(e.width()/2,e.height()/2);if(n>r)return!1}return!0}};Cr.hasher=new so;var Nt=Cr,Qi=class Qi{constructor(e,t,n,r){this.topLeft=0,this.topRight=0,this.bottomRight=0,this.bottomLeft=0,this.topLeft=Math.max(e,0),this.topRight=Math.max(t,0),this.bottomRight=Math.max(n,0),this.bottomLeft=Math.max(r,0)}isZeros(){return this.topLeft==0&&this.topRight==0&&this.bottomRight==0&&this.bottomLeft==0}isUniform(){return this.topRight==this.topLeft&&this.bottomRight==this.topLeft&&this.bottomLeft==this.topLeft}equals(e){return this.topLeft==e.topLeft&&this.topRight==e.topRight&&this.bottomRight==e.bottomRight&&this.bottomLeft==e.bottomLeft}clippedForRectOfBounds(e){let t=Math.min(e.width()/2,e.height()/2);return new Qi(Math.min(this.topLeft,t),Math.min(this.topRight,t),Math.min(this.bottomRight,t),Math.min(this.bottomLeft,t))}toList(){return[this.topLeft,this.topRight,this.bottomRight,this.bottomLeft]}static fromList(e){return new Qi(e[0],e[1],e[2],e[3])}static fromNodeRadius(e){return new Qi(e,e,e,e)}static fromRoundedRect(e){return e.vertexRadii()!=null?Qi.fromList(e.vertexRadii()):Qi.fromNodeRadius(e.nodeRadius())}};Qi.ZEROS=new Qi(0,0,0,0);var lo=Qi;var co=class i{constructor(e){this.handle=0,this._cachedInfo=null,this._hash=0,this.handle=e}_updateCachedInfoIfNecessary(){if(this._cachedInfo==null){let e=D().modules().uniquePath_Internal.bounds(this.handle),t=e.max.x-e.min.x,n=e.max.y-e.min.y,r=new G(e.min.x,e.min.y,t,n);this._cachedInfo=new Ac(r,D().modules().uniquePath_Internal.isRect(this.handle))}}bounds(){return this._updateCachedInfoIfNecessary(),this._cachedInfo.bounds}equals2(e){return e instanceof i?this.handle==e.handle:!1}clone(){return new i(this.handle)}hash(){return this._hash==null&&(this._hash=D().modules().uniquePath_Internal.getHash(this.handle)),this._hash}isRect(){return this._updateCachedInfoIfNecessary(),this._cachedInfo.isRect}canBeAnalyticallyAntialiased(){return!1}toBezierPath(){throw new Error("We should never need to copy UniquePath data into JS")}asRoundedRectPath(){return null}compileLoopBlinnAndReturnVolatileTriangles(){let e=D().modules().uniquePath_Internal.loopBlinnCompile(this.handle);return e??(Ve("Failed to compile UniquePath"),S0)}},S0=new Uint8Array([]);var Vr;(t=>{function i(n){return n!=-1}t.WeakHandle_isValid=i;function e(n){return n}t.WeakHandle_toInt=e})(Vr||(Vr={}));var _u=class{textAlignHorizontal(){D().prepareCppNodeForAccess(this);let e=D().nodeTsApiGenerated().getTextAlignHorizontal(2);return ye.schema.TextAlignHorizontal[e]}setTextAlignHorizontal(e){D().prepareCppNodeForAccess(this);let t=ye.schema.TextAlignHorizontal[e];D().nodeTsApiGenerated().setTextAlignHorizontal(t,2)}textAlignVertical(){D().prepareCppNodeForAccess(this);let e=D().nodeTsApiGenerated().getTextAlignVertical(2);return ye.schema.TextAlignVertical[e]}setTextAlignVertical(e){D().prepareCppNodeForAccess(this);let t=ye.schema.TextAlignVertical[e];D().nodeTsApiGenerated().setTextAlignVertical(t,2)}fontSize(){return D().prepareCppNodeForAccess(this),D().nodeTsApiGenerated().getFontSize(2)}setFontSize(e){D().prepareCppNodeForAccess(this);let t=e;D().nodeTsApiGenerated().setFontSize(t,2)}visible(){return D().prepareCppNodeForAccess(this),D().nodeTsApiGenerated().getVisible(2)}setVisible(e){D().prepareCppNodeForAccess(this);let t=e;D().nodeTsApiGenerated().setVisible(t,2)}isBackgroundEnabled(){return D().prepareCppNodeForAccess(this),D().nodeTsApiGenerated().getBackgroundEnabled(2)}setIsBackgroundEnabled(e){D().prepareCppNodeForAccess(this);let t=e;D().nodeTsApiGenerated().setBackgroundEnabled(t,2)}isMask(){return D().prepareCppNodeForAccess(this),D().nodeTsApiGenerated().getIsMask(2)}setIsMask(e){D().prepareCppNodeForAccess(this);let t=e;D().nodeTsApiGenerated().setIsMask(t,2)}isMaskOutline_DEPRECATED(){return D().prepareCppNodeForAccess(this),D().nodeTsApiGenerated().getIsMaskOutline_DEPRECATED(2)}setIsMaskOutline_DEPRECATED(e){D().prepareCppNodeForAccess(this);let t=e;D().nodeTsApiGenerated().setIsMaskOutline_DEPRECATED(t,2)}isInternalOnly(){return D().prepareCppNodeForAccess(this),D().nodeTsApiGenerated().getIsInternalOnly(2)}setIsInternalOnly(e){D().prepareCppNodeForAccess(this);let t=e;D().nodeTsApiGenerated().setIsInternalOnly(t,2)}isFrameMaskDisabled(){return D().prepareCppNodeForAccess(this),D().nodeTsApiGenerated().getIsFrameClippingDisabled(2)}setIsFrameMaskDisabled(e){D().prepareCppNodeForAccess(this);let t=e;D().nodeTsApiGenerated().setIsFrameClippingDisabled(t,2)}isResizeToFit(){return D().prepareCppNodeForAccess(this),D().nodeTsApiGenerated().getResizeToFit(2)}setIsResizeToFit(e){D().prepareCppNodeForAccess(this);let t=e;D().nodeTsApiGenerated().setResizeToFit(t,2)}rectangleCornerRadiiIndependent(){return D().prepareCppNodeForAccess(this),D().nodeTsApiGenerated().getRectangleCornerRadiiIndependent(2)}setRectangleCornerRadiiIndependent(e){D().prepareCppNodeForAccess(this);let t=e;D().nodeTsApiGenerated().setRectangleCornerRadiiIndependent(t,2)}horizontalConstraint(){D().prepareCppNodeForAccess(this);let e=D().nodeTsApiGenerated().getHorizontalConstraint(2);return ye.schema.ConstraintType[e]}setHorizontalConstraint(e){D().prepareCppNodeForAccess(this);let t=ye.schema.ConstraintType[e];D().nodeTsApiGenerated().setHorizontalConstraint(t,2)}verticalConstraint(){D().prepareCppNodeForAccess(this);let e=D().nodeTsApiGenerated().getVerticalConstraint(2);return ye.schema.ConstraintType[e]}setVerticalConstraint(e){D().prepareCppNodeForAccess(this);let t=ye.schema.ConstraintType[e];D().nodeTsApiGenerated().setVerticalConstraint(t,2)}blendMode(){D().prepareCppNodeForAccess(this);let e=D().nodeTsApiGenerated().getBlendMode(2);return ye.schema.BlendMode[e]}setBlendMode(e){D().prepareCppNodeForAccess(this);let t=ye.schema.BlendMode[e];D().nodeTsApiGenerated().setBlendMode(t,2)}strokeAlign(){D().prepareCppNodeForAccess(this);let e=D().nodeTsApiGenerated().getStrokeAlign(2);return ye.schema.StrokeAlign[e]}setStrokeAlign(e){D().prepareCppNodeForAccess(this);let t=ye.schema.StrokeAlign[e];D().nodeTsApiGenerated().setStrokeAlign(t,2)}overlayPositionType(){D().prepareCppNodeForAccess(this);let e=D().nodeTsApiGenerated().getOverlayPositionType(2);return ye.schema.OverlayPositionType[e]}setOverlayPositionType(e){D().prepareCppNodeForAccess(this);let t=ye.schema.OverlayPositionType[e];D().nodeTsApiGenerated().setOverlayPositionType(t,2)}overlayBackgroundInteraction(){D().prepareCppNodeForAccess(this);let e=D().nodeTsApiGenerated().getOverlayBackgroundInteraction(2);return ye.schema.OverlayBackgroundInteraction[e]}setOverlayBackgroundInteraction(e){D().prepareCppNodeForAccess(this);let t=ye.schema.OverlayBackgroundInteraction[e];D().nodeTsApiGenerated().setOverlayBackgroundInteraction(t,2)}styleType(){D().prepareCppNodeForAccess(this);let e=D().nodeTsApiGenerated().getStyleType(2);return ye.schema.StyleType[e]}setStyleType(e){D().prepareCppNodeForAccess(this);let t=ye.schema.StyleType[e];D().nodeTsApiGenerated().setStyleType(t,2)}overflowDirection(){D().prepareCppNodeForAccess(this);let e=D().nodeTsApiGenerated().getOverflowDirection(2);return ye.schema.ScrollDirection[e]}setOverflowDirection(e){D().prepareCppNodeForAccess(this);let t=ye.schema.ScrollDirection[e];D().nodeTsApiGenerated().setOverflowDirection(t,2)}scrollBehavior(){D().prepareCppNodeForAccess(this);let e=D().nodeTsApiGenerated().getScrollBehavior(2);return ye.schema.ScrollBehavior[e]}setScrollBehavior(e){D().prepareCppNodeForAccess(this);let t=ye.schema.ScrollBehavior[e];D().nodeTsApiGenerated().setScrollBehavior(t,2)}maskType(){D().prepareCppNodeForAccess(this);let e=D().nodeTsApiGenerated().getMaskType(2);return ye.schema.MaskType[e]}setMaskType(e){D().prepareCppNodeForAccess(this);let t=ye.schema.MaskType[e];D().nodeTsApiGenerated().setMaskType(t,2)}opacity(){return D().prepareCppNodeForAccess(this),D().nodeTsApiGenerated().getOpacity(2)}setOpacity(e){D().prepareCppNodeForAccess(this);let t=e;D().nodeTsApiGenerated().setOpacity(t,2)}backgroundOpacity(){return D().prepareCppNodeForAccess(this),D().nodeTsApiGenerated().getBackgroundOpacity(2)}setBackgroundOpacity(e){D().prepareCppNodeForAccess(this);let t=e;D().nodeTsApiGenerated().setBackgroundOpacity(t,2)}rectangleTopLeftCornerRadius(){return D().prepareCppNodeForAccess(this),D().nodeTsApiGenerated().getRectangleTopLeftCornerRadius(2)}setRectangleTopLeftCornerRadius(e){D().prepareCppNodeForAccess(this);let t=e;D().nodeTsApiGenerated().setRectangleTopLeftCornerRadius(t,2)}rectangleTopRightCornerRadius(){return D().prepareCppNodeForAccess(this),D().nodeTsApiGenerated().getRectangleTopRightCornerRadius(2)}setRectangleTopRightCornerRadius(e){D().prepareCppNodeForAccess(this);let t=e;D().nodeTsApiGenerated().setRectangleTopRightCornerRadius(t,2)}rectangleBottomLeftCornerRadius(){return D().prepareCppNodeForAccess(this),D().nodeTsApiGenerated().getRectangleBottomLeftCornerRadius(2)}setRectangleBottomLeftCornerRadius(e){D().prepareCppNodeForAccess(this);let t=e;D().nodeTsApiGenerated().setRectangleBottomLeftCornerRadius(t,2)}rectangleBottomRightCornerRadius(){return D().prepareCppNodeForAccess(this),D().nodeTsApiGenerated().getRectangleBottomRightCornerRadius(2)}setRectangleBottomRightCornerRadius(e){D().prepareCppNodeForAccess(this);let t=e;D().nodeTsApiGenerated().setRectangleBottomRightCornerRadius(t,2)}strokeWeight(){return D().prepareCppNodeForAccess(this),D().nodeTsApiGenerated().getStrokeWeight(2)}setStrokeWeight(e){D().prepareCppNodeForAccess(this);let t=e;D().nodeTsApiGenerated().setStrokeWeight(t,2)}cornerRadius(){return D().prepareCppNodeForAccess(this),D().nodeTsApiGenerated().getCornerRadius(2)}setCornerRadius(e){D().prepareCppNodeForAccess(this);let t=e;D().nodeTsApiGenerated().setCornerRadius(t,2)}cornerSmoothing(){return D().prepareCppNodeForAccess(this),D().nodeTsApiGenerated().getCornerSmoothing(2)}setCornerSmoothing(e){D().prepareCppNodeForAccess(this);let t=e;D().nodeTsApiGenerated().setCornerSmoothing(t,2)}overrideKey(){return D().prepareCppNodeForAccess(this),D().nodeTsApiGenerated().getOverrideKey(2)}setOverrideKey(e){D().prepareCppNodeForAccess(this);let t=e;D().nodeTsApiGenerated().setOverrideKey(t,2)}overriddenSymbolID(){return D().prepareCppNodeForAccess(this),D().nodeTsApiGenerated().getOverriddenSymbolID(2)}stackReverseZIndex(){return D().prepareCppNodeForAccess(this),D().nodeTsApiGenerated().getStackReverseZIndex(2)}setStackReverseZIndex(e){D().prepareCppNodeForAccess(this);let t=e;D().nodeTsApiGenerated().setStackReverseZIndex(t,2)}containerSupportsFillStrokeAndCorners(){return D().prepareCppNodeForAccess(this),D().nodeTsApiGenerated().getContainerSupportsFillStrokeAndCorners(2)}setContainerSupportsFillStrokeAndCorners(e){D().prepareCppNodeForAccess(this);let t=e;D().nodeTsApiGenerated().setContainerSupportsFillStrokeAndCorners(t,2)}isStateGroup(){return D().prepareCppNodeForAccess(this),D().nodeTsApiGenerated().getIsStateGroup(2)}setIsStateGroup(e){D().prepareCppNodeForAccess(this);let t=e;D().nodeTsApiGenerated().setIsStateGroup(t,2)}shapeWithTextType(){D().prepareCppNodeForAccess(this);let e=D().nodeTsApiGenerated().getShapeWithTextType(2);return ye.schema.ShapeWithTextType[e]}setShapeWithTextType(e){D().prepareCppNodeForAccess(this);let t=ye.schema.ShapeWithTextType[e];D().nodeTsApiGenerated().setShapeWithTextType(t,2)}usedAsBaseScreen(){return D().prepareCppNodeForAccess(this),D().nodeTsApiGenerated().getUsedAsBaseScreen(2)}setUsedAsBaseScreen(e){D().prepareCppNodeForAccess(this);let t=e;D().nodeTsApiGenerated().setUsedAsBaseScreen(t,2)}hasBeenLoaded(){return D().prepareCppNodeForAccess(this),D().nodeTsApiGenerated().getHasBeenLoaded(2)}setHasBeenLoaded(e){D().prepareCppNodeForAccess(this);let t=e;D().nodeTsApiGenerated().setHasBeenLoaded(t,2)}};var Ct=(re=>(re[re.MISSING__=0]="MISSING__",re[re.TEXT_ALIGN_HORIZONTAL=1]="TEXT_ALIGN_HORIZONTAL",re[re.TEXT_ALIGN_VERTICAL=2]="TEXT_ALIGN_VERTICAL",re[re.FONT_SIZE=3]="FONT_SIZE",re[re.TEXT_DATA=4]="TEXT_DATA",re[re.DERIVED_TEXT_DATA=5]="DERIVED_TEXT_DATA",re[re.HYPERLINK=6]="HYPERLINK",re[re.MENTION=7]="MENTION",re[re.VISIBLE=8]="VISIBLE",re[re.IS_BACKGROUND_ENABLED=9]="IS_BACKGROUND_ENABLED",re[re.IS_MASK=10]="IS_MASK",re[re.IS_MASK_OUTLINE__DEPRECATED=11]="IS_MASK_OUTLINE__DEPRECATED",re[re.IS_INTERNAL_ONLY=12]="IS_INTERNAL_ONLY",re[re.IS_FRAME_MASK_DISABLED=13]="IS_FRAME_MASK_DISABLED",re[re.IS_RESIZE_TO_FIT=14]="IS_RESIZE_TO_FIT",re[re.RECTANGLE_CORNER_RADII_INDEPENDENT=15]="RECTANGLE_CORNER_RADII_INDEPENDENT",re[re.INTERACTION_MAINTAINED__DEPRECATED=16]="INTERACTION_MAINTAINED__DEPRECATED",re[re.TRANSITION_PRESERVE_SCROLL__DEPRECATED=17]="TRANSITION_PRESERVE_SCROLL__DEPRECATED",re[re.TRANSITION_SHOULD_SMART_ANIMATE__DEPRECATED=18]="TRANSITION_SHOULD_SMART_ANIMATE__DEPRECATED",re[re.TYPE=19]="TYPE",re[re.HORIZONTAL_CONSTRAINT=20]="HORIZONTAL_CONSTRAINT",re[re.VERTICAL_CONSTRAINT=21]="VERTICAL_CONSTRAINT",re[re.BLEND_MODE=22]="BLEND_MODE",re[re.STROKE_ALIGN=23]="STROKE_ALIGN",re[re.RELATIVE_TRANSFORM=24]="RELATIVE_TRANSFORM",re[re.PARENT_INDEX=25]="PARENT_INDEX",re[re.CONNECTION_TYPE__DEPRECATED=26]="CONNECTION_TYPE__DEPRECATED",re[re.TRANSITION_TYPE__DEPRECATED=27]="TRANSITION_TYPE__DEPRECATED",re[re.EASING_TYPE__DEPRECATED=28]="EASING_TYPE__DEPRECATED",re[re.INTERACTION_TYPE__DEPRECATED=29]="INTERACTION_TYPE__DEPRECATED",re[re.NAVIGATION_TYPE__DEPRECATED=30]="NAVIGATION_TYPE__DEPRECATED",re[re.OVERLAY_POSITION_TYPE=31]="OVERLAY_POSITION_TYPE",re[re.OVERLAY_BACKGROUND_INTERACTION=32]="OVERLAY_BACKGROUND_INTERACTION",re[re.STYLE_TYPE=33]="STYLE_TYPE",re[re.OVERFLOW_DIRECTION=34]="OVERFLOW_DIRECTION",re[re.SCROLL_BEHAVIOR=35]="SCROLL_BEHAVIOR",re[re.MASK_TYPE=36]="MASK_TYPE",re[re.OPACITY=37]="OPACITY",re[re.BACKGROUND_OPACITY=38]="BACKGROUND_OPACITY",re[re.RECTANGLE_TOP_LEFT_CORNER_RADIUS=39]="RECTANGLE_TOP_LEFT_CORNER_RADIUS",re[re.RECTANGLE_TOP_RIGHT_CORNER_RADIUS=40]="RECTANGLE_TOP_RIGHT_CORNER_RADIUS",re[re.RECTANGLE_BOTTOM_LEFT_CORNER_RADIUS=41]="RECTANGLE_BOTTOM_LEFT_CORNER_RADIUS",re[re.RECTANGLE_BOTTOM_RIGHT_CORNER_RADIUS=42]="RECTANGLE_BOTTOM_RIGHT_CORNER_RADIUS",re[re.STROKE_WEIGHT=43]="STROKE_WEIGHT",re[re.CORNER_RADIUS=44]="CORNER_RADIUS",re[re.CORNER_SMOOTHING=45]="CORNER_SMOOTHING",re[re.TRANSITION_DURATION__DEPRECATED=46]="TRANSITION_DURATION__DEPRECATED",re[re.TRANSITION_TIMEOUT__DEPRECATED=47]="TRANSITION_TIMEOUT__DEPRECATED",re[re.INTERACTION_DURATION__DEPRECATED=48]="INTERACTION_DURATION__DEPRECATED",re[re.SIZE=49]="SIZE",re[re.OVERRIDE_KEY=50]="OVERRIDE_KEY",re[re.OVERRIDDEN_SYMBOL_ID=51]="OVERRIDDEN_SYMBOL_ID",re[re.INHERIT_FILL_STYLE_ID=52]="INHERIT_FILL_STYLE_ID",re[re.INHERIT_FILL_STYLE_ID_FOR_STROKE=53]="INHERIT_FILL_STYLE_ID_FOR_STROKE",re[re.INHERIT_FILL_STYLE_ID_FOR_BACKGROUND=54]="INHERIT_FILL_STYLE_ID_FOR_BACKGROUND",re[re.INHERIT_TEXT_STYLE_ID=55]="INHERIT_TEXT_STYLE_ID",re[re.INHERIT_EFFECT_STYLE_ID=56]="INHERIT_EFFECT_STYLE_ID",re[re.OVERLAY_RELATIVE_POSITION__DEPRECATED=57]="OVERLAY_RELATIVE_POSITION__DEPRECATED",re[re.BACKGROUND_PAINT_DATA=58]="BACKGROUND_PAINT_DATA",re[re.FILL_PAINT_DATA=59]="FILL_PAINT_DATA",re[re.STROKE_PAINT_DATA=60]="STROKE_PAINT_DATA",re[re.EFFECT_DATA=61]="EFFECT_DATA",re[re.NAME=62]="NAME",re[re.ARC_DATA=63]="ARC_DATA",re[re.BACKGROUND_COLOR=64]="BACKGROUND_COLOR",re[re.PROTOTYPE_BACKGROUND_COLOR=65]="PROTOTYPE_BACKGROUND_COLOR",re[re.PROTOTYPE_DEVICE=66]="PROTOTYPE_DEVICE",re[re.OVERLAY_BACKGROUND_APPEARANCE=67]="OVERLAY_BACKGROUND_APPEARANCE",re[re.EXPORT_SETTINGS_DATA=68]="EXPORT_SETTINGS_DATA",re[re.PROTOTYPE_START_NODE_ID=69]="PROTOTYPE_START_NODE_ID",re[re.CONNECTION_URL_DEPRECATED=70]="CONNECTION_URL_DEPRECATED",re[re.TRANSITION_NODE_ID_DEPRECATED=71]="TRANSITION_NODE_ID_DEPRECATED",re[re.VIDEO_PLAYBACK=72]="VIDEO_PLAYBACK",re[re.FILL_GEOMETRY=73]="FILL_GEOMETRY",re[re.STROKE_GEOMETRY=74]="STROKE_GEOMETRY",re[re.SYMBOL_DATA=75]="SYMBOL_DATA",re[re.COMPILED_VECTOR_DATA=76]="COMPILED_VECTOR_DATA",re[re.STACK_MODE=77]="STACK_MODE",re[re.STACK_REVERSE_Z_INDEX=78]="STACK_REVERSE_Z_INDEX",re[re.CONTAINER_SUPPORTS_FILL_STROKE_AND_CORNERS=79]="CONTAINER_SUPPORTS_FILL_STROKE_AND_CORNERS",re[re.KEY_TRIGGER__DEPRECATED=80]="KEY_TRIGGER__DEPRECATED",re[re.IS_STATE_GROUP=81]="IS_STATE_GROUP",re[re.PROTOTYPE_INTERACTIONS=82]="PROTOTYPE_INTERACTIONS",re[re.VOICE_EVENT_PHRASE__DEPRECATED=83]="VOICE_EVENT_PHRASE__DEPRECATED",re[re.PROTOTYPE_STARTING_POINT=84]="PROTOTYPE_STARTING_POINT",re[re.SHAPE_WITH_TEXT_TYPE=85]="SHAPE_WITH_TEXT_TYPE",re[re.INTERACTIVE_SLIDE_CONFIG_DATA=86]="INTERACTIVE_SLIDE_CONFIG_DATA",re[re.INTERACTIVE_SLIDE_PARTICIPANT_DATA=87]="INTERACTIVE_SLIDE_PARTICIPANT_DATA",re[re.SCROLL_OFFSET=88]="SCROLL_OFFSET",re[re.USED_AS_BASE_SCREEN=89]="USED_AS_BASE_SCREEN",re[re.CURRENT_VIEWPORT_SIZE=90]="CURRENT_VIEWPORT_SIZE",re[re.HAS_BEEN_LOADED=91]="HAS_BEEN_LOADED",re[re.STYLE_ID_FOR_FILL=92]="STYLE_ID_FOR_FILL",re[re.STYLE_ID_FOR_STROKE_FILL=93]="STYLE_ID_FOR_STROKE_FILL",re[re.STYLE_ID_FOR_TEXT=94]="STYLE_ID_FOR_TEXT",re[re.STYLE_ID_FOR_EFFECT=95]="STYLE_ID_FOR_EFFECT",re[re.STYLE_ID_FOR_GRID=96]="STYLE_ID_FOR_GRID",re[re.SLIDE_SPEAKER_NOTES=97]="SLIDE_SPEAKER_NOTES",re[re.PHASE=98]="PHASE",re[re.END__=99]="END__",re))(Ct||{});function Iu(i){return Eu(i.map(([e,t])=>new Array(e).fill(t,0,e)))}function Eu(i){return i.reduce((e,t)=>e.concat(Array.isArray(t)?Eu(t):t),[])}var uS=[0,1,2,3].concat(...Iu([[2,4],[2,5],[4,6],[4,7],[8,8],[8,9],[16,10],[16,11],[32,12],[32,13],[64,14],[64,15],[2,0],[1,16],[1,17],[2,18],[2,19],[4,20],[4,21],[8,22],[8,23],[16,24],[16,25],[32,26],[32,27],[64,28],[64,29]]));function En(){let i=this;function e(r){let o=i.dyn_tree,a=i.stat_desc.static_tree,s=i.stat_desc.extra_bits,l=i.stat_desc.extra_base,d=i.stat_desc.max_length,c,p,u,h,f,y,g=0;for(h=0;h<=15;h++)r.bl_count[h]=0;for(o[r.heap[r.heap_max]*2+1]=0,c=r.heap_max+1;c<573;c++)p=r.heap[c],h=o[o[p*2+1]*2+1]+1,h>d&&(h=d,g++),o[p*2+1]=h,!(p>i.max_code)&&(r.bl_count[h]++,f=0,p>=l&&(f=s[p-l]),y=o[p*2],r.opt_len+=y*(h+f),a&&(r.static_len+=y*(a[p*2+1]+f)));if(g!==0){do{for(h=d-1;r.bl_count[h]===0;)h--;r.bl_count[h]--,r.bl_count[h+1]+=2,r.bl_count[d]--,g-=2}while(g>0);for(h=d;h!==0;h--)for(p=r.bl_count[h];p!==0;)u=r.heap[--c],!(u>i.max_code)&&(o[u*2+1]!=h&&(r.opt_len+=(h-o[u*2+1])*o[u*2],o[u*2+1]=h),p--)}}function t(r,o){let a=0;do a|=r&1,r>>>=1,a<<=1;while(--o>0);return a>>>1}function n(r,o,a){let s=[],l=0,d,c,p;for(d=1;d<=15;d++)s[d]=l=l+a[d-1]<<1;for(c=0;c<=o;c++)p=r[c*2+1],p!==0&&(r[c*2]=t(s[p]++,p))}i.build_tree=function(r){let o=i.dyn_tree,a=i.stat_desc.static_tree,s=i.stat_desc.elems,l,d,c=-1,p;for(r.heap_len=0,r.heap_max=573,l=0;l<s;l++)o[l*2]!==0?(r.heap[++r.heap_len]=c=l,r.depth[l]=0):o[l*2+1]=0;for(;r.heap_len<2;)p=r.heap[++r.heap_len]=c<2?++c:0,o[p*2]=1,r.depth[p]=0,r.opt_len--,a&&(r.static_len-=a[p*2+1]);for(i.max_code=c,l=Math.floor(r.heap_len/2);l>=1;l--)r.pqdownheap(o,l);p=s;do l=r.heap[1],r.heap[1]=r.heap[r.heap_len--],r.pqdownheap(o,1),d=r.heap[1],r.heap[--r.heap_max]=l,r.heap[--r.heap_max]=d,o[p*2]=o[l*2]+o[d*2],r.depth[p]=Math.max(r.depth[l],r.depth[d])+1,o[l*2+1]=o[d*2+1]=p,r.heap[1]=p++,r.pqdownheap(o,1);while(r.heap_len>=2);r.heap[--r.heap_max]=r.heap[1],e(r),n(o,i.max_code,r.bl_count)}}En._length_code=[0,1,2,3,4,5,6,7].concat(...Iu([[2,8],[2,9],[2,10],[2,11],[4,12],[4,13],[4,14],[4,15],[8,16],[8,17],[8,18],[8,19],[16,20],[16,21],[16,22],[16,23],[32,24],[32,25],[32,26],[31,27],[1,28]]));En.base_length=[0,1,2,3,4,5,6,7,8,10,12,14,16,20,24,28,32,40,48,56,64,80,96,112,128,160,192,224,0];En.base_dist=[0,1,2,3,4,6,8,12,16,24,32,48,64,96,128,192,256,384,512,768,1024,1536,2048,3072,4096,6144,8192,12288,16384,24576];En.d_code=function(i){return i<256?uS[i]:uS[256+(i>>>7)]};En.extra_lbits=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0];En.extra_dbits=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13];En.extra_blbits=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7];En.bl_order=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];function Rr(i,e,t,n,r){let o=this;o.static_tree=i,o.extra_bits=e,o.extra_base=t,o.elems=n,o.max_length=r}var y0=[12,140,76,204,44,172,108,236,28,156,92,220,60,188,124,252,2,130,66,194,34,162,98,226,18,146,82,210,50,178,114,242,10,138,74,202,42,170,106,234,26,154,90,218,58,186,122,250,6,134,70,198,38,166,102,230,22,150,86,214,54,182,118,246,14,142,78,206,46,174,110,238,30,158,94,222,62,190,126,254,1,129,65,193,33,161,97,225,17,145,81,209,49,177,113,241,9,137,73,201,41,169,105,233,25,153,89,217,57,185,121,249,5,133,69,197,37,165,101,229,21,149,85,213,53,181,117,245,13,141,77,205,45,173,109,237,29,157,93,221,61,189,125,253,19,275,147,403,83,339,211,467,51,307,179,435,115,371,243,499,11,267,139,395,75,331,203,459,43,299,171,427,107,363,235,491,27,283,155,411,91,347,219,475,59,315,187,443,123,379,251,507,7,263,135,391,71,327,199,455,39,295,167,423,103,359,231,487,23,279,151,407,87,343,215,471,55,311,183,439,119,375,247,503,15,271,143,399,79,335,207,463,47,303,175,431,111,367,239,495,31,287,159,415,95,351,223,479,63,319,191,447,127,383,255,511,0,64,32,96,16,80,48,112,8,72,40,104,24,88,56,120,4,68,36,100,20,84,52,116,3,131,67,195,35,163,99,227],b0=Iu([[144,8],[112,9],[24,7],[8,8]]);Rr.static_ltree=Eu(y0.map((i,e)=>[i,b0[e]]));var T0=[0,16,8,24,4,20,12,28,2,18,10,26,6,22,14,30,1,17,9,25,5,21,13,29,3,19,11,27,7,23],v0=Iu([[30,5]]);Rr.static_dtree=Eu(T0.map((i,e)=>[i,v0[e]]));Rr.static_l_desc=new Rr(Rr.static_ltree,En.extra_lbits,256+1,286,15);Rr.static_d_desc=new Rr(Rr.static_dtree,En.extra_dbits,0,30,15);Rr.static_bl_desc=new Rr(null,En.extra_blbits,0,19,7);var I0=9,E0=8;function Ti(i,e,t,n,r){let o=this;o.good_length=i,o.max_lazy=e,o.nice_length=t,o.max_chain=n,o.func=r}var hS=0,Tu=1,ps=2,Zo=[new Ti(0,0,0,0,hS),new Ti(4,4,8,4,Tu),new Ti(4,5,16,8,Tu),new Ti(4,6,32,32,Tu),new Ti(4,4,16,16,ps),new Ti(8,16,32,32,ps),new Ti(8,16,128,128,ps),new Ti(8,32,128,256,ps),new Ti(32,128,258,1024,ps),new Ti(32,258,258,4096,ps)],Au=["need dictionary","stream end","","","stream error","data error","","buffer error","",""],Qo=0,Su=1,Sc=2,yu=3,C0=32,wm=42,bu=113,yc=666,xm=8,R0=0,Pm=1,N0=2,Pn=3,vu=258,No=vu+Pn+1;function pS(i,e,t,n){let r=i[e*2],o=i[t*2];return r<o||r==o&&n[e]<=n[t]}function O0(){let i=this,e,t,n,r,o,a,s,l,d,c,p,u,h,f,y,g,A,T,b,_,m,S,v,C,N,x,z,$,q,K,F,P,k,H=new En,L=new En,Q=new En;i.depth=[];let X,M,te,J,oe,le;i.bl_count=[],i.heap=[],F=[],P=[],k=[];function tt(){d=2*o,p[h-1]=0;for(let R=0;R<h-1;R++)p[R]=0;x=Zo[z].max_lazy,q=Zo[z].good_length,K=Zo[z].nice_length,N=Zo[z].max_chain,m=0,A=0,v=0,T=C=Pn-1,_=0,u=0}function nt(){let R;for(R=0;R<286;R++)F[R*2]=0;for(R=0;R<30;R++)P[R*2]=0;for(R=0;R<19;R++)k[R*2]=0;F[256*2]=1,i.opt_len=i.static_len=0,M=te=0}function At(){H.dyn_tree=F,H.stat_desc=Rr.static_l_desc,L.dyn_tree=P,L.stat_desc=Rr.static_d_desc,Q.dyn_tree=k,Q.stat_desc=Rr.static_bl_desc,oe=0,le=0,J=8,nt()}i.pqdownheap=function(R,V){let W=i.heap,j=W[V],se=V<<1;for(;se<=i.heap_len&&(se<i.heap_len&&pS(R,W[se+1],W[se],i.depth)&&se++,!pS(R,j,W[se],i.depth));)W[V]=W[se],V=se,se<<=1;W[V]=j};function Lt(R,V){let W=-1,j,se=R[0*2+1],he=0,ve=7,ct=4;se===0&&(ve=138,ct=3),R[(V+1)*2+1]=65535;for(let qe=0;qe<=V;qe++)j=se,se=R[(qe+1)*2+1],!(++he<ve&&j==se)&&(he<ct?k[j*2]+=he:j!==0?(j!=W&&k[j*2]++,k[16*2]++):he<=10?k[17*2]++:k[18*2]++,he=0,W=j,se===0?(ve=138,ct=3):j==se?(ve=6,ct=3):(ve=7,ct=4))}function Tt(){let R;for(Lt(F,H.max_code),Lt(P,L.max_code),Q.build_tree(i),R=19-1;R>=3&&k[En.bl_order[R]*2+1]===0;R--);return i.opt_len+=3*(R+1)+5+5+4,R}function de(R){i.pending_buf[i.pending++]=R}function yt(R){de(R&255),de(R>>>8&255)}function er(R){de(R>>8&255),de(R&255&255)}function Wt(R,V){let W,j=V;le>16-j?(W=R,oe|=W<<le&65535,yt(oe),oe=W>>>16-le,le+=j-16):(oe|=R<<le&65535,le+=j)}function cn(R,V){let W=R*2;Wt(V[W]&65535,V[W+1]&65535)}function Ot(R,V){let W,j=-1,se,he=R[0*2+1],ve=0,ct=7,qe=4;for(he===0&&(ct=138,qe=3),W=0;W<=V;W++)if(se=he,he=R[(W+1)*2+1],!(++ve<ct&&se==he)){if(ve<qe)do cn(se,k);while(--ve!==0);else se!==0?(se!=j&&(cn(se,k),ve--),cn(16,k),Wt(ve-3,2)):ve<=10?(cn(17,k),Wt(ve-3,3)):(cn(18,k),Wt(ve-11,7));ve=0,j=se,he===0?(ct=138,qe=3):se==he?(ct=6,qe=3):(ct=7,qe=4)}}function st(R,V,W){let j;for(Wt(R-257,5),Wt(V-1,5),Wt(W-4,4),j=0;j<W;j++)Wt(k[En.bl_order[j]*2+1],3);Ot(F,R-1),Ot(P,V-1)}function ut(){le==16?(yt(oe),oe=0,le=0):le>=8&&(de(oe&255),oe>>>=8,le-=8)}function Ge(){Wt(Pm<<1,3),cn(256,Rr.static_ltree),ut(),1+J+10-le<9&&(Wt(Pm<<1,3),cn(256,Rr.static_ltree),ut()),J=7}function bt(R,V){let W,j,se;if(i.dist_buf[M]=R,i.lc_buf[M]=V&255,M++,R===0?F[V*2]++:(te++,R--,F[(En._length_code[V]+256+1)*2]++,P[En.d_code(R)*2]++),!(M&8191)&&z>2){for(W=M*8,j=m-A,se=0;se<30;se++)W+=P[se*2]*(5+En.extra_dbits[se]);if(W>>>=3,te<Math.floor(M/2)&&W<Math.floor(j/2))return!0}return M==X-1}function kt(R,V){let W,j,se=0,he,ve;if(M!==0)do W=i.dist_buf[se],j=i.lc_buf[se],se++,W===0?cn(j,R):(he=En._length_code[j],cn(he+256+1,R),ve=En.extra_lbits[he],ve!==0&&(j-=En.base_length[he],Wt(j,ve)),W--,he=En.d_code(W),cn(he,V),ve=En.extra_dbits[he],ve!==0&&(W-=En.base_dist[he],Wt(W,ve)));while(se<M);cn(256,R),J=R[256*2+1]}function xe(){le>8?yt(oe):le>0&&de(oe&255),oe=0,le=0}function wt(R,V,W){xe(),J=8,W&&(yt(V),yt(~V)),i.pending_buf.set(l.subarray(R,R+V),i.pending),i.pending+=V}function fn(R,V,W){Wt((R0<<1)+(W?1:0),3),wt(R,V,!0)}function _n(R,V,W){let j,se,he=0;z>0?(H.build_tree(i),L.build_tree(i),he=Tt(),j=i.opt_len+3+7>>>3,se=i.static_len+3+7>>>3,se<=j&&(j=se)):j=se=V+5,V+4<=j&&R!=-1?fn(R,V,W):se==j?(Wt((Pm<<1)+(W?1:0),3),kt(Rr.static_ltree,Rr.static_dtree)):(Wt((N0<<1)+(W?1:0),3),st(H.max_code+1,L.max_code+1,he+1),kt(F,P)),nt(),W&&xe()}function Gt(R){_n(A>=0?A:-1,m-A,R),A=m,e.flush_pending()}function In(){let R,V,W,j;do{if(j=d-v-m,j===0&&m===0&&v===0)j=o;else if(j==-1)j--;else if(m>=o+o-No){l.set(l.subarray(o,o+o),0),S-=o,m-=o,A-=o,R=h,W=R;do V=p[--W]&65535,p[W]=V>=o?V-o:0;while(--R!==0);R=o,W=R;do V=c[--W]&65535,c[W]=V>=o?V-o:0;while(--R!==0);j+=o}if(e.avail_in===0)return;R=e.read_buf(l,m+v,j),v+=R,v>=Pn&&(u=l[m]&255,u=(u<<g^l[m+1]&255)&y)}while(v<No&&e.avail_in!==0)}function Qt(R){let V=65535,W;for(V>n-5&&(V=n-5);;){if(v<=1){if(In(),v===0&&R==0)return Qo;if(v===0)break}if(m+=v,v=0,W=A+V,(m===0||m>=W)&&(v=m-W,m=W,Gt(!1),e.avail_out===0)||m-A>=o-No&&(Gt(!1),e.avail_out===0))return Qo}return Gt(R==4),e.avail_out===0?R==4?Sc:Qo:R==4?yu:Su}function ln(R){let V=N,W=m,j,se,he=C,ve=m>o-No?m-(o-No):0,ct=K,qe=s,De=m+vu,B=l[W+he-1],U=l[W+he];C>=q&&(V>>=2),ct>v&&(ct=v);do if(j=R,!(l[j+he]!=U||l[j+he-1]!=B||l[j]!=l[W]||l[++j]!=l[W+1])){W+=2,j++;do;while(l[++W]==l[++j]&&l[++W]==l[++j]&&l[++W]==l[++j]&&l[++W]==l[++j]&&l[++W]==l[++j]&&l[++W]==l[++j]&&l[++W]==l[++j]&&l[++W]==l[++j]&&W<De);if(se=vu-(De-W),W=De-vu,se>he){if(S=R,he=se,se>=ct)break;B=l[W+he-1],U=l[W+he]}}while((R=c[R&qe]&65535)>ve&&--V!==0);return he<=v?he:v}function tr(R){let V=0,W;for(;;){if(v<No){if(In(),v<No&&R==0)return Qo;if(v===0)break}if(v>=Pn&&(u=(u<<g^l[m+(Pn-1)]&255)&y,V=p[u]&65535,c[m&s]=p[u],p[u]=m),V!==0&&(m-V&65535)<=o-No&&$!=2&&(T=ln(V)),T>=Pn)if(W=bt(m-S,T-Pn),v-=T,T<=x&&v>=Pn){T--;do m++,u=(u<<g^l[m+(Pn-1)]&255)&y,V=p[u]&65535,c[m&s]=p[u],p[u]=m;while(--T!==0);m++}else m+=T,T=0,u=l[m]&255,u=(u<<g^l[m+1]&255)&y;else W=bt(0,l[m]&255),v--,m++;if(W&&(Gt(!1),e.avail_out===0))return Qo}return Gt(R==4),e.avail_out===0?R==4?Sc:Qo:R==4?yu:Su}function lt(R){let V=0,W,j;for(;;){if(v<No){if(In(),v<No&&R==0)return Qo;if(v===0)break}if(v>=Pn&&(u=(u<<g^l[m+(Pn-1)]&255)&y,V=p[u]&65535,c[m&s]=p[u],p[u]=m),C=T,b=S,T=Pn-1,V!==0&&C<x&&(m-V&65535)<=o-No&&($!=2&&(T=ln(V)),T<=5&&($==1||T==Pn&&m-S>4096)&&(T=Pn-1)),C>=Pn&&T<=C){j=m+v-Pn,W=bt(m-1-b,C-Pn),v-=C-1,C-=2;do++m<=j&&(u=(u<<g^l[m+(Pn-1)]&255)&y,V=p[u]&65535,c[m&s]=p[u],p[u]=m);while(--C!==0);if(_=0,T=Pn-1,m++,W&&(Gt(!1),e.avail_out===0))return Qo}else if(_!==0){if(W=bt(0,l[m-1]&255),W&&Gt(!1),m++,v--,e.avail_out===0)return Qo}else _=1,m++,v--}return _!==0&&(W=bt(0,l[m-1]&255),_=0),Gt(R==4),e.avail_out===0?R==4?Sc:Qo:R==4?yu:Su}function O(R){return R.total_in=R.total_out=0,R.msg=null,i.pending=0,i.pending_out=0,t=bu,r=0,At(),tt(),0}i.deflateInit=function(R,V,W,j,se,he){return j||(j=xm),se||(se=E0),he||(he=0),R.msg=null,V==-1&&(V=6),se<1||se>I0||j!=xm||W<9||W>15||V<0||V>9||he<0||he>2?-2:(R.dstate=i,a=W,o=1<<a,s=o-1,f=se+7,h=1<<f,y=h-1,g=Math.floor((f+Pn-1)/Pn),l=new Uint8Array(o*2),c=[],p=[],X=1<<se+6,i.pending_buf=new Uint8Array(X*4),n=X*4,i.dist_buf=new Uint16Array(X),i.lc_buf=new Uint8Array(X),z=V,$=he,O(R))},i.deflateEnd=function(){return t!=wm&&t!=bu&&t!=yc?-2:(i.lc_buf=null,i.dist_buf=null,i.pending_buf=null,p=null,c=null,l=null,i.dstate=null,t==bu?-3:0)},i.deflateParams=function(R,V,W){let j=0;return V==-1&&(V=6),V<0||V>9||W<0||W>2?-2:(Zo[z].func!=Zo[V].func&&R.total_in!==0&&(j=R.deflate(1)),z!=V&&(z=V,x=Zo[z].max_lazy,q=Zo[z].good_length,K=Zo[z].nice_length,N=Zo[z].max_chain),$=W,j)},i.deflateSetDictionary=function(R,V,W){let j=W,se,he=0;if(!V||t!=wm)return-2;if(j<Pn)return 0;for(j>o-No&&(j=o-No,he=W-j),l.set(V.subarray(he,he+j),0),m=j,A=j,u=l[0]&255,u=(u<<g^l[1]&255)&y,se=0;se<=j-Pn;se++)u=(u<<g^l[se+(Pn-1)]&255)&y,c[se&s]=p[u],p[u]=se;return 0},i.deflate=function(R,V){let W,j,se,he,ve;if(V>4||V<0)return-2;if(!R.next_out||!R.next_in&&R.avail_in!==0||t==yc&&V!=4)return R.msg=Au[2- -2],-2;if(R.avail_out===0)return R.msg=Au[2- -5],-5;if(e=R,he=r,r=V,t==wm&&(j=xm+(a-8<<4)<<8,se=(z-1&255)>>1,se>3&&(se=3),j|=se<<6,m!==0&&(j|=C0),j+=31-j%31,t=bu,er(j)),i.pending!==0){if(e.flush_pending(),e.avail_out===0)return r=-1,0}else if(e.avail_in===0&&V<=he&&V!=4)return e.msg=Au[2- -5],-5;if(t==yc&&e.avail_in!==0)return R.msg=Au[2- -5],-5;if(e.avail_in!==0||v!==0||V!=0&&t!=yc){switch(ve=-1,Zo[z].func){case hS:ve=Qt(V);break;case Tu:ve=tr(V);break;case ps:ve=lt(V);break;default:}if((ve==Sc||ve==yu)&&(t=yc),ve==Qo||ve==Sc)return e.avail_out===0&&(r=-1),0;if(ve==Su){if(V==1)Ge();else if(fn(0,0,!1),V==3)for(W=0;W<h;W++)p[W]=0;if(e.flush_pending(),e.avail_out===0)return r=-1,0}}return V!=4?0:1}}function mS(){let i=this;i.next_in_index=0,i.next_out_index=0,i.avail_in=0,i.total_in=0,i.avail_out=0,i.total_out=0}mS.prototype={deflateInit:function(i,e){let t=this;return t.dstate=new O0,e||(e=15),t.dstate.deflateInit(t,i,e)},deflate:function(i){let e=this;return e.dstate?e.dstate.deflate(e,i):-2},deflateEnd:function(){let i=this;if(!i.dstate)return-2;let e=i.dstate.deflateEnd();return i.dstate=null,e},deflateParams:function(i,e){let t=this;return t.dstate?t.dstate.deflateParams(t,i,e):-2},deflateSetDictionary:function(i,e){let t=this;return t.dstate?t.dstate.deflateSetDictionary(t,i,e):-2},read_buf:function(i,e,t){let n=this,r=n.avail_in;return r>t&&(r=t),r===0?0:(n.avail_in-=r,i.set(n.next_in.subarray(n.next_in_index,n.next_in_index+r),e),n.next_in_index+=r,n.total_in+=r,r)},flush_pending:function(){let i=this,e=i.dstate.pending;e>i.avail_out&&(e=i.avail_out),e!==0&&(i.next_out.set(i.dstate.pending_buf.subarray(i.dstate.pending_out,i.dstate.pending_out+e),i.next_out_index),i.next_out_index+=e,i.dstate.pending_out+=e,i.total_out+=e,i.avail_out-=e,i.dstate.pending-=e,i.dstate.pending===0&&(i.dstate.pending_out=0))}};function w0(i){let e=this,t=new mS,n=x0(i&&i.chunkSize?i.chunkSize:64*1024),r=0,o=new Uint8Array(n),a=i?i.level:-1;typeof a>"u"&&(a=-1),t.deflateInit(a),t.next_out=o,e.append=function(s,l){let d,c,p=0,u=0,h=0,f=[];if(s.length){t.next_in_index=0,t.next_in=s,t.avail_in=s.length;do{if(t.next_out_index=0,t.avail_out=n,d=t.deflate(r),d!=0)throw new Error("deflating: "+t.msg);t.next_out_index&&(t.next_out_index==n?f.push(new Uint8Array(o)):f.push(o.slice(0,t.next_out_index))),h+=t.next_out_index,l&&t.next_in_index>0&&t.next_in_index!=p&&(l(t.next_in_index),p=t.next_in_index)}while(t.avail_in>0||t.avail_out===0);return f.length>1?(c=new Uint8Array(h),f.forEach(function(y){c.set(y,u),u+=y.length})):c=f[0]||new Uint8Array(0),c}},e.flush=function(){let s,l,d=0,c=0,p=[];do{if(t.next_out_index=0,t.avail_out=n,s=t.deflate(4),s!=1&&s!=0)throw new Error("deflating: "+t.msg);n-t.avail_out>0&&p.push(o.slice(0,t.next_out_index)),c+=t.next_out_index}while(t.avail_in>0||t.avail_out===0);return t.deflateEnd(),l=new Uint8Array(c),p.forEach(function(u){l.set(u,d),d+=u.length}),l}}function x0(i){return i+5*(Math.floor(i/16383)+1)}var gS=w0;var Oo=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535],LS=1440,P0=0,F0=4,D0=9,L0=5,M0=[96,7,256,0,8,80,0,8,16,84,8,115,82,7,31,0,8,112,0,8,48,0,9,192,80,7,10,0,8,96,0,8,32,0,9,160,0,8,0,0,8,128,0,8,64,0,9,224,80,7,6,0,8,88,0,8,24,0,9,144,83,7,59,0,8,120,0,8,56,0,9,208,81,7,17,0,8,104,0,8,40,0,9,176,0,8,8,0,8,136,0,8,72,0,9,240,80,7,4,0,8,84,0,8,20,85,8,227,83,7,43,0,8,116,0,8,52,0,9,200,81,7,13,0,8,100,0,8,36,0,9,168,0,8,4,0,8,132,0,8,68,0,9,232,80,7,8,0,8,92,0,8,28,0,9,152,84,7,83,0,8,124,0,8,60,0,9,216,82,7,23,0,8,108,0,8,44,0,9,184,0,8,12,0,8,140,0,8,76,0,9,248,80,7,3,0,8,82,0,8,18,85,8,163,83,7,35,0,8,114,0,8,50,0,9,196,81,7,11,0,8,98,0,8,34,0,9,164,0,8,2,0,8,130,0,8,66,0,9,228,80,7,7,0,8,90,0,8,26,0,9,148,84,7,67,0,8,122,0,8,58,0,9,212,82,7,19,0,8,106,0,8,42,0,9,180,0,8,10,0,8,138,0,8,74,0,9,244,80,7,5,0,8,86,0,8,22,192,8,0,83,7,51,0,8,118,0,8,54,0,9,204,81,7,15,0,8,102,0,8,38,0,9,172,0,8,6,0,8,134,0,8,70,0,9,236,80,7,9,0,8,94,0,8,30,0,9,156,84,7,99,0,8,126,0,8,62,0,9,220,82,7,27,0,8,110,0,8,46,0,9,188,0,8,14,0,8,142,0,8,78,0,9,252,96,7,256,0,8,81,0,8,17,85,8,131,82,7,31,0,8,113,0,8,49,0,9,194,80,7,10,0,8,97,0,8,33,0,9,162,0,8,1,0,8,129,0,8,65,0,9,226,80,7,6,0,8,89,0,8,25,0,9,146,83,7,59,0,8,121,0,8,57,0,9,210,81,7,17,0,8,105,0,8,41,0,9,178,0,8,9,0,8,137,0,8,73,0,9,242,80,7,4,0,8,85,0,8,21,80,8,258,83,7,43,0,8,117,0,8,53,0,9,202,81,7,13,0,8,101,0,8,37,0,9,170,0,8,5,0,8,133,0,8,69,0,9,234,80,7,8,0,8,93,0,8,29,0,9,154,84,7,83,0,8,125,0,8,61,0,9,218,82,7,23,0,8,109,0,8,45,0,9,186,0,8,13,0,8,141,0,8,77,0,9,250,80,7,3,0,8,83,0,8,19,85,8,195,83,7,35,0,8,115,0,8,51,0,9,198,81,7,11,0,8,99,0,8,35,0,9,166,0,8,3,0,8,131,0,8,67,0,9,230,80,7,7,0,8,91,0,8,27,0,9,150,84,7,67,0,8,123,0,8,59,0,9,214,82,7,19,0,8,107,0,8,43,0,9,182,0,8,11,0,8,139,0,8,75,0,9,246,80,7,5,0,8,87,0,8,23,192,8,0,83,7,51,0,8,119,0,8,55,0,9,206,81,7,15,0,8,103,0,8,39,0,9,174,0,8,7,0,8,135,0,8,71,0,9,238,80,7,9,0,8,95,0,8,31,0,9,158,84,7,99,0,8,127,0,8,63,0,9,222,82,7,27,0,8,111,0,8,47,0,9,190,0,8,15,0,8,143,0,8,79,0,9,254,96,7,256,0,8,80,0,8,16,84,8,115,82,7,31,0,8,112,0,8,48,0,9,193,80,7,10,0,8,96,0,8,32,0,9,161,0,8,0,0,8,128,0,8,64,0,9,225,80,7,6,0,8,88,0,8,24,0,9,145,83,7,59,0,8,120,0,8,56,0,9,209,81,7,17,0,8,104,0,8,40,0,9,177,0,8,8,0,8,136,0,8,72,0,9,241,80,7,4,0,8,84,0,8,20,85,8,227,83,7,43,0,8,116,0,8,52,0,9,201,81,7,13,0,8,100,0,8,36,0,9,169,0,8,4,0,8,132,0,8,68,0,9,233,80,7,8,0,8,92,0,8,28,0,9,153,84,7,83,0,8,124,0,8,60,0,9,217,82,7,23,0,8,108,0,8,44,0,9,185,0,8,12,0,8,140,0,8,76,0,9,249,80,7,3,0,8,82,0,8,18,85,8,163,83,7,35,0,8,114,0,8,50,0,9,197,81,7,11,0,8,98,0,8,34,0,9,165,0,8,2,0,8,130,0,8,66,0,9,229,80,7,7,0,8,90,0,8,26,0,9,149,84,7,67,0,8,122,0,8,58,0,9,213,82,7,19,0,8,106,0,8,42,0,9,181,0,8,10,0,8,138,0,8,74,0,9,245,80,7,5,0,8,86,0,8,22,192,8,0,83,7,51,0,8,118,0,8,54,0,9,205,81,7,15,0,8,102,0,8,38,0,9,173,0,8,6,0,8,134,0,8,70,0,9,237,80,7,9,0,8,94,0,8,30,0,9,157,84,7,99,0,8,126,0,8,62,0,9,221,82,7,27,0,8,110,0,8,46,0,9,189,0,8,14,0,8,142,0,8,78,0,9,253,96,7,256,0,8,81,0,8,17,85,8,131,82,7,31,0,8,113,0,8,49,0,9,195,80,7,10,0,8,97,0,8,33,0,9,163,0,8,1,0,8,129,0,8,65,0,9,227,80,7,6,0,8,89,0,8,25,0,9,147,83,7,59,0,8,121,0,8,57,0,9,211,81,7,17,0,8,105,0,8,41,0,9,179,0,8,9,0,8,137,0,8,73,0,9,243,80,7,4,0,8,85,0,8,21,80,8,258,83,7,43,0,8,117,0,8,53,0,9,203,81,7,13,0,8,101,0,8,37,0,9,171,0,8,5,0,8,133,0,8,69,0,9,235,80,7,8,0,8,93,0,8,29,0,9,155,84,7,83,0,8,125,0,8,61,0,9,219,82,7,23,0,8,109,0,8,45,0,9,187,0,8,13,0,8,141,0,8,77,0,9,251,80,7,3,0,8,83,0,8,19,85,8,195,83,7,35,0,8,115,0,8,51,0,9,199,81,7,11,0,8,99,0,8,35,0,9,167,0,8,3,0,8,131,0,8,67,0,9,231,80,7,7,0,8,91,0,8,27,0,9,151,84,7,67,0,8,123,0,8,59,0,9,215,82,7,19,0,8,107,0,8,43,0,9,183,0,8,11,0,8,139,0,8,75,0,9,247,80,7,5,0,8,87,0,8,23,192,8,0,83,7,51,0,8,119,0,8,55,0,9,207,81,7,15,0,8,103,0,8,39,0,9,175,0,8,7,0,8,135,0,8,71,0,9,239,80,7,9,0,8,95,0,8,31,0,9,159,84,7,99,0,8,127,0,8,63,0,9,223,82,7,27,0,8,111,0,8,47,0,9,191,0,8,15,0,8,143,0,8,79,0,9,255],B0=[80,5,1,87,5,257,83,5,17,91,5,4097,81,5,5,89,5,1025,85,5,65,93,5,16385,80,5,3,88,5,513,84,5,33,92,5,8193,82,5,9,90,5,2049,86,5,129,192,5,24577,80,5,2,87,5,385,83,5,25,91,5,6145,81,5,7,89,5,1537,85,5,97,93,5,24577,80,5,4,88,5,769,84,5,49,92,5,12289,82,5,13,90,5,3073,86,5,193,192,5,24577],V0=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],k0=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,112,112],U0=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],G0=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],Sa=15;function Mm(){let i=this,e,t,n,r,o,a;function s(d,c,p,u,h,f,y,g,A,T,b){let _,m,S,v,C,N,x,z,$,q,K,F,P,k,H;q=0,C=p;do n[d[c+q]]++,q++,C--;while(C!==0);if(n[0]==p)return y[0]=-1,g[0]=0,0;for(z=g[0],N=1;N<=Sa&&n[N]===0;N++);for(x=N,z<N&&(z=N),C=Sa;C!==0&&n[C]===0;C--);for(S=C,z>C&&(z=C),g[0]=z,k=1<<N;N<C;N++,k<<=1)if((k-=n[N])<0)return-3;if((k-=n[C])<0)return-3;for(n[C]+=k,a[1]=N=0,q=1,P=2;--C!==0;)a[P]=N+=n[q],P++,q++;C=0,q=0;do(N=d[c+q])!==0&&(b[a[N]++]=C),q++;while(++C<p);for(p=a[S],a[0]=C=0,q=0,v=-1,F=-z,o[0]=0,K=0,H=0;x<=S;x++)for(_=n[x];_--!==0;){for(;x>F+z;){if(v++,F+=z,H=S-F,H=H>z?z:H,(m=1<<(N=x-F))>_+1&&(m-=_+1,P=x,N<H))for(;++N<H&&!((m<<=1)<=n[++P]);)m-=n[P];if(H=1<<N,T[0]+H>LS)return-3;o[v]=K=T[0],T[0]+=H,v!==0?(a[v]=C,r[0]=N,r[1]=z,N=C>>>F-z,r[2]=K-o[v-1]-N,A.set(r,(o[v-1]+N)*3)):y[0]=K}for(r[1]=x-F,q>=p?r[0]=128+64:b[q]<u?(r[0]=b[q]<256?0:32+64,r[2]=b[q++]):(r[0]=f[b[q]-u]+16+64,r[2]=h[b[q++]-u]),m=1<<x-F,N=C>>>F;N<H;N+=m)A.set(r,(K+N)*3);for(N=1<<x-1;C&N;N>>>=1)C^=N;for(C^=N,$=(1<<F)-1;(C&$)!=a[v];)v--,F-=z,$=(1<<F)-1}return k!==0&&S!=1?-5:0}function l(d){let c;for(e||(e=[],t=[],n=new Int32Array(Sa+1),r=[],o=new Int32Array(Sa),a=new Int32Array(Sa+1)),t.length<d&&(t=[]),c=0;c<d;c++)t[c]=0;for(c=0;c<Sa+1;c++)n[c]=0;for(c=0;c<3;c++)r[c]=0;o.set(n.subarray(0,Sa),0),a.set(n.subarray(0,Sa+1),0)}i.inflate_trees_bits=function(d,c,p,u,h){let f;return l(19),e[0]=0,f=s(d,0,19,19,null,null,p,c,u,e,t),f==-3?h.msg="oversubscribed dynamic bit lengths tree":(f==-5||c[0]===0)&&(h.msg="incomplete dynamic bit lengths tree",f=-3),f},i.inflate_trees_dynamic=function(d,c,p,u,h,f,y,g,A){let T;return l(288),e[0]=0,T=s(p,0,d,257,V0,k0,f,u,g,e,t),T!=0||u[0]===0?(T==-3?A.msg="oversubscribed literal/length tree":T!=-4&&(A.msg="incomplete literal/length tree",T=-3),T):(l(288),T=s(p,d,c,0,U0,G0,y,h,g,e,t),T!=0||h[0]===0&&d>257?(T==-3?A.msg="oversubscribed distance tree":T==-5?(A.msg="incomplete distance tree",T=-3):T!=-4&&(A.msg="empty distance tree with lengths",T=-3),T):0)}}Mm.inflate_trees_fixed=function(i,e,t,n){return i[0]=D0,e[0]=L0,t[0]=M0,n[0]=B0,0};var Cu=0,fS=1,_S=2,AS=3,SS=4,yS=5,bS=6,Fm=7,TS=8,Ru=9;function H0(){let i=this,e,t=0,n,r=0,o=0,a=0,s=0,l=0,d=0,c=0,p,u=0,h,f=0;function y(g,A,T,b,_,m,S,v){let C,N,x,z,$,q,K,F,P,k,H,L,Q,X,M,te;K=v.next_in_index,F=v.avail_in,$=S.bitb,q=S.bitk,P=S.write,k=P<S.read?S.read-P-1:S.end-P,H=Oo[g],L=Oo[A];do{for(;q<20;)F--,$|=(v.read_byte(K++)&255)<<q,q+=8;if(C=$&H,N=T,x=b,te=(x+C)*3,(z=N[te])===0){$>>=N[te+1],q-=N[te+1],S.win[P++]=N[te+2],k--;continue}do{if($>>=N[te+1],q-=N[te+1],z&16){for(z&=15,Q=N[te+2]+($&Oo[z]),$>>=z,q-=z;q<15;)F--,$|=(v.read_byte(K++)&255)<<q,q+=8;C=$&L,N=_,x=m,te=(x+C)*3,z=N[te];do if($>>=N[te+1],q-=N[te+1],z&16){for(z&=15;q<z;)F--,$|=(v.read_byte(K++)&255)<<q,q+=8;if(X=N[te+2]+($&Oo[z]),$>>=z,q-=z,k-=Q,P>=X)M=P-X,P-M>0&&2>P-M?(S.win[P++]=S.win[M++],S.win[P++]=S.win[M++],Q-=2):(S.win.set(S.win.subarray(M,M+2),P),P+=2,M+=2,Q-=2);else{M=P-X;do M+=S.end;while(M<0);if(z=S.end-M,Q>z){if(Q-=z,P-M>0&&z>P-M)do S.win[P++]=S.win[M++];while(--z!==0);else S.win.set(S.win.subarray(M,M+z),P),P+=z,M+=z,z=0;M=0}}if(P-M>0&&Q>P-M)do S.win[P++]=S.win[M++];while(--Q!==0);else S.win.set(S.win.subarray(M,M+Q),P),P+=Q,M+=Q,Q=0;break}else if(!(z&64))C+=N[te+2],C+=$&Oo[z],te=(x+C)*3,z=N[te];else return v.msg="invalid distance code",Q=v.avail_in-F,Q=q>>3<Q?q>>3:Q,F+=Q,K-=Q,q-=Q<<3,S.bitb=$,S.bitk=q,v.avail_in=F,v.total_in+=K-v.next_in_index,v.next_in_index=K,S.write=P,-3;while(!0);break}if(z&64)return z&32?(Q=v.avail_in-F,Q=q>>3<Q?q>>3:Q,F+=Q,K-=Q,q-=Q<<3,S.bitb=$,S.bitk=q,v.avail_in=F,v.total_in+=K-v.next_in_index,v.next_in_index=K,S.write=P,1):(v.msg="invalid literal/length code",Q=v.avail_in-F,Q=q>>3<Q?q>>3:Q,F+=Q,K-=Q,q-=Q<<3,S.bitb=$,S.bitk=q,v.avail_in=F,v.total_in+=K-v.next_in_index,v.next_in_index=K,S.write=P,-3);if(C+=N[te+2],C+=$&Oo[z],te=(x+C)*3,(z=N[te])===0){$>>=N[te+1],q-=N[te+1],S.win[P++]=N[te+2],k--;break}}while(!0)}while(k>=258&&F>=10);return Q=v.avail_in-F,Q=q>>3<Q?q>>3:Q,F+=Q,K-=Q,q-=Q<<3,S.bitb=$,S.bitk=q,v.avail_in=F,v.total_in+=K-v.next_in_index,v.next_in_index=K,S.write=P,0}i.init=function(g,A,T,b,_,m){e=Cu,d=g,c=A,p=T,u=b,h=_,f=m,n=null},i.proc=function(g,A,T){let b,_,m,S=0,v=0,C=0,N,x,z,$;for(C=A.next_in_index,N=A.avail_in,S=g.bitb,v=g.bitk,x=g.write,z=x<g.read?g.read-x-1:g.end-x;;)switch(e){case Cu:if(z>=258&&N>=10&&(g.bitb=S,g.bitk=v,A.avail_in=N,A.total_in+=C-A.next_in_index,A.next_in_index=C,g.write=x,T=y(d,c,p,u,h,f,g,A),C=A.next_in_index,N=A.avail_in,S=g.bitb,v=g.bitk,x=g.write,z=x<g.read?g.read-x-1:g.end-x,T!=0)){e=T==1?Fm:Ru;break}o=d,n=p,r=u,e=fS;case fS:for(b=o;v<b;){if(N!==0)T=0;else return g.bitb=S,g.bitk=v,A.avail_in=N,A.total_in+=C-A.next_in_index,A.next_in_index=C,g.write=x,g.inflate_flush(A,T);N--,S|=(A.read_byte(C++)&255)<<v,v+=8}if(_=(r+(S&Oo[b]))*3,S>>>=n[_+1],v-=n[_+1],m=n[_],m===0){a=n[_+2],e=bS;break}if(m&16){s=m&15,t=n[_+2],e=_S;break}if(!(m&64)){o=m,r=_/3+n[_+2];break}if(m&32){e=Fm;break}return e=Ru,A.msg="invalid literal/length code",T=-3,g.bitb=S,g.bitk=v,A.avail_in=N,A.total_in+=C-A.next_in_index,A.next_in_index=C,g.write=x,g.inflate_flush(A,T);case _S:for(b=s;v<b;){if(N!==0)T=0;else return g.bitb=S,g.bitk=v,A.avail_in=N,A.total_in+=C-A.next_in_index,A.next_in_index=C,g.write=x,g.inflate_flush(A,T);N--,S|=(A.read_byte(C++)&255)<<v,v+=8}t+=S&Oo[b],S>>=b,v-=b,o=c,n=h,r=f,e=AS;case AS:for(b=o;v<b;){if(N!==0)T=0;else return g.bitb=S,g.bitk=v,A.avail_in=N,A.total_in+=C-A.next_in_index,A.next_in_index=C,g.write=x,g.inflate_flush(A,T);N--,S|=(A.read_byte(C++)&255)<<v,v+=8}if(_=(r+(S&Oo[b]))*3,S>>=n[_+1],v-=n[_+1],m=n[_],m&16){s=m&15,l=n[_+2],e=SS;break}if(!(m&64)){o=m,r=_/3+n[_+2];break}return e=Ru,A.msg="invalid distance code",T=-3,g.bitb=S,g.bitk=v,A.avail_in=N,A.total_in+=C-A.next_in_index,A.next_in_index=C,g.write=x,g.inflate_flush(A,T);case SS:for(b=s;v<b;){if(N!==0)T=0;else return g.bitb=S,g.bitk=v,A.avail_in=N,A.total_in+=C-A.next_in_index,A.next_in_index=C,g.write=x,g.inflate_flush(A,T);N--,S|=(A.read_byte(C++)&255)<<v,v+=8}l+=S&Oo[b],S>>=b,v-=b,e=yS;case yS:for($=x-l;$<0;)$+=g.end;for(;t!==0;){if(z===0&&(x==g.end&&g.read!==0&&(x=0,z=x<g.read?g.read-x-1:g.end-x),z===0&&(g.write=x,T=g.inflate_flush(A,T),x=g.write,z=x<g.read?g.read-x-1:g.end-x,x==g.end&&g.read!==0&&(x=0,z=x<g.read?g.read-x-1:g.end-x),z===0)))return g.bitb=S,g.bitk=v,A.avail_in=N,A.total_in+=C-A.next_in_index,A.next_in_index=C,g.write=x,g.inflate_flush(A,T);g.win[x++]=g.win[$++],z--,$==g.end&&($=0),t--}e=Cu;break;case bS:if(z===0&&(x==g.end&&g.read!==0&&(x=0,z=x<g.read?g.read-x-1:g.end-x),z===0&&(g.write=x,T=g.inflate_flush(A,T),x=g.write,z=x<g.read?g.read-x-1:g.end-x,x==g.end&&g.read!==0&&(x=0,z=x<g.read?g.read-x-1:g.end-x),z===0)))return g.bitb=S,g.bitk=v,A.avail_in=N,A.total_in+=C-A.next_in_index,A.next_in_index=C,g.write=x,g.inflate_flush(A,T);T=0,g.win[x++]=a,z--,e=Cu;break;case Fm:if(v>7&&(v-=8,N++,C--),g.write=x,T=g.inflate_flush(A,T),x=g.write,z=x<g.read?g.read-x-1:g.end-x,g.read!=g.write)return g.bitb=S,g.bitk=v,A.avail_in=N,A.total_in+=C-A.next_in_index,A.next_in_index=C,g.write=x,g.inflate_flush(A,T);e=TS;case TS:return T=1,g.bitb=S,g.bitk=v,A.avail_in=N,A.total_in+=C-A.next_in_index,A.next_in_index=C,g.write=x,g.inflate_flush(A,T);case Ru:return T=-3,g.bitb=S,g.bitk=v,A.avail_in=N,A.total_in+=C-A.next_in_index,A.next_in_index=C,g.write=x,g.inflate_flush(A,T);default:return T=-2,g.bitb=S,g.bitk=v,A.avail_in=N,A.total_in+=C-A.next_in_index,A.next_in_index=C,g.write=x,g.inflate_flush(A,T)}},i.free=function(){}}var vS=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],qs=0,Dm=1,IS=2,ES=3,CS=4,RS=5,Nu=6,Ou=7,NS=8,hs=9;function z0(i,e){let t=this,n=qs,r=0,o=0,a=0,s,l=[0],d=[0],c=new H0,p=0,u=new Int32Array(LS*3),h=0,f=new Mm;t.bitk=0,t.bitb=0,t.win=new Uint8Array(e),t.end=e,t.read=0,t.write=0,t.reset=function(y,g){g&&(g[0]=h),n==Nu&&c.free(y),n=qs,t.bitk=0,t.bitb=0,t.read=t.write=0},t.reset(i,null),t.inflate_flush=function(y,g){let A,T,b;return T=y.next_out_index,b=t.read,A=(b<=t.write?t.write:t.end)-b,A>y.avail_out&&(A=y.avail_out),A!==0&&g==-5&&(g=0),y.avail_out-=A,y.total_out+=A,y.next_out.set(t.win.subarray(b,b+A),T),T+=A,b+=A,b==t.end&&(b=0,t.write==t.end&&(t.write=0),A=t.write-b,A>y.avail_out&&(A=y.avail_out),A!==0&&g==-5&&(g=0),y.avail_out-=A,y.total_out+=A,y.next_out.set(t.win.subarray(b,b+A),T),T+=A,b+=A),y.next_out_index=T,t.read=b,g},t.proc=function(y,g){let A,T,b,_,m,S,v,C;for(_=y.next_in_index,m=y.avail_in,T=t.bitb,b=t.bitk,S=t.write,v=S<t.read?t.read-S-1:t.end-S;;){let N,x,z,$,q,K,F,P;switch(n){case qs:for(;b<3;){if(m!==0)g=0;else return t.bitb=T,t.bitk=b,y.avail_in=m,y.total_in+=_-y.next_in_index,y.next_in_index=_,t.write=S,t.inflate_flush(y,g);m--,T|=(y.read_byte(_++)&255)<<b,b+=8}switch(A=T&7,p=A&1,A>>>1){case 0:T>>>=3,b-=3,A=b&7,T>>>=A,b-=A,n=Dm;break;case 1:N=[],x=[],z=[[]],$=[[]],Mm.inflate_trees_fixed(N,x,z,$),c.init(N[0],x[0],z[0],0,$[0],0),T>>>=3,b-=3,n=Nu;break;case 2:T>>>=3,b-=3,n=ES;break;case 3:return T>>>=3,b-=3,n=hs,y.msg="invalid block type",g=-3,t.bitb=T,t.bitk=b,y.avail_in=m,y.total_in+=_-y.next_in_index,y.next_in_index=_,t.write=S,t.inflate_flush(y,g)}break;case Dm:for(;b<32;){if(m!==0)g=0;else return t.bitb=T,t.bitk=b,y.avail_in=m,y.total_in+=_-y.next_in_index,y.next_in_index=_,t.write=S,t.inflate_flush(y,g);m--,T|=(y.read_byte(_++)&255)<<b,b+=8}if((~T>>>16&65535)!=(T&65535))return n=hs,y.msg="invalid stored block lengths",g=-3,t.bitb=T,t.bitk=b,y.avail_in=m,y.total_in+=_-y.next_in_index,y.next_in_index=_,t.write=S,t.inflate_flush(y,g);r=T&65535,T=b=0,n=r!==0?IS:p!==0?Ou:qs;break;case IS:if(m===0||v===0&&(S==t.end&&t.read!==0&&(S=0,v=S<t.read?t.read-S-1:t.end-S),v===0&&(t.write=S,g=t.inflate_flush(y,g),S=t.write,v=S<t.read?t.read-S-1:t.end-S,S==t.end&&t.read!==0&&(S=0,v=S<t.read?t.read-S-1:t.end-S),v===0)))return t.bitb=T,t.bitk=b,y.avail_in=m,y.total_in+=_-y.next_in_index,y.next_in_index=_,t.write=S,t.inflate_flush(y,g);if(g=0,A=r,A>m&&(A=m),A>v&&(A=v),t.win.set(y.read_buf(_,A),S),_+=A,m-=A,S+=A,v-=A,(r-=A)!==0)break;n=p!==0?Ou:qs;break;case ES:for(;b<14;){if(m!==0)g=0;else return t.bitb=T,t.bitk=b,y.avail_in=m,y.total_in+=_-y.next_in_index,y.next_in_index=_,t.write=S,t.inflate_flush(y,g);m--,T|=(y.read_byte(_++)&255)<<b,b+=8}if(o=A=T&16383,(A&31)>29||(A>>5&31)>29)return n=hs,y.msg="too many length or distance symbols",g=-3,t.bitb=T,t.bitk=b,y.avail_in=m,y.total_in+=_-y.next_in_index,y.next_in_index=_,t.write=S,t.inflate_flush(y,g);if(A=258+(A&31)+(A>>5&31),!s||s.length<A)s=[];else for(C=0;C<A;C++)s[C]=0;T>>>=14,b-=14,a=0,n=CS;case CS:for(;a<4+(o>>>10);){for(;b<3;){if(m!==0)g=0;else return t.bitb=T,t.bitk=b,y.avail_in=m,y.total_in+=_-y.next_in_index,y.next_in_index=_,t.write=S,t.inflate_flush(y,g);m--,T|=(y.read_byte(_++)&255)<<b,b+=8}s[vS[a++]]=T&7,T>>>=3,b-=3}for(;a<19;)s[vS[a++]]=0;if(l[0]=7,A=f.inflate_trees_bits(s,l,d,u,y),A!=0)return g=A,g==-3&&(s=null,n=hs),t.bitb=T,t.bitk=b,y.avail_in=m,y.total_in+=_-y.next_in_index,y.next_in_index=_,t.write=S,t.inflate_flush(y,g);a=0,n=RS;case RS:for(;A=o,!(a>=258+(A&31)+(A>>5&31));){let k,H;for(A=l[0];b<A;){if(m!==0)g=0;else return t.bitb=T,t.bitk=b,y.avail_in=m,y.total_in+=_-y.next_in_index,y.next_in_index=_,t.write=S,t.inflate_flush(y,g);m--,T|=(y.read_byte(_++)&255)<<b,b+=8}if(A=u[(d[0]+(T&Oo[A]))*3+1],H=u[(d[0]+(T&Oo[A]))*3+2],H<16)T>>>=A,b-=A,s[a++]=H;else{for(C=H==18?7:H-14,k=H==18?11:3;b<A+C;){if(m!==0)g=0;else return t.bitb=T,t.bitk=b,y.avail_in=m,y.total_in+=_-y.next_in_index,y.next_in_index=_,t.write=S,t.inflate_flush(y,g);m--,T|=(y.read_byte(_++)&255)<<b,b+=8}if(T>>>=A,b-=A,k+=T&Oo[C],T>>>=C,b-=C,C=a,A=o,C+k>258+(A&31)+(A>>5&31)||H==16&&C<1)return s=null,n=hs,y.msg="invalid bit length repeat",g=-3,t.bitb=T,t.bitk=b,y.avail_in=m,y.total_in+=_-y.next_in_index,y.next_in_index=_,t.write=S,t.inflate_flush(y,g);H=H==16?s[C-1]:0;do s[C++]=H;while(--k!==0);a=C}}if(d[0]=-1,q=[],K=[],F=[],P=[],q[0]=9,K[0]=6,A=o,A=f.inflate_trees_dynamic(257+(A&31),1+(A>>5&31),s,q,K,F,P,u,y),A!=0)return A==-3&&(s=null,n=hs),g=A,t.bitb=T,t.bitk=b,y.avail_in=m,y.total_in+=_-y.next_in_index,y.next_in_index=_,t.write=S,t.inflate_flush(y,g);c.init(q[0],K[0],u,F[0],u,P[0]),n=Nu;case Nu:if(t.bitb=T,t.bitk=b,y.avail_in=m,y.total_in+=_-y.next_in_index,y.next_in_index=_,t.write=S,(g=c.proc(t,y,g))!=1)return t.inflate_flush(y,g);if(g=0,c.free(y),_=y.next_in_index,m=y.avail_in,T=t.bitb,b=t.bitk,S=t.write,v=S<t.read?t.read-S-1:t.end-S,p===0){n=qs;break}n=Ou;case Ou:if(t.write=S,g=t.inflate_flush(y,g),S=t.write,v=S<t.read?t.read-S-1:t.end-S,t.read!=t.write)return t.bitb=T,t.bitk=b,y.avail_in=m,y.total_in+=_-y.next_in_index,y.next_in_index=_,t.write=S,t.inflate_flush(y,g);n=NS;case NS:return g=1,t.bitb=T,t.bitk=b,y.avail_in=m,y.total_in+=_-y.next_in_index,y.next_in_index=_,t.write=S,t.inflate_flush(y,g);case hs:return g=-3,t.bitb=T,t.bitk=b,y.avail_in=m,y.total_in+=_-y.next_in_index,y.next_in_index=_,t.write=S,t.inflate_flush(y,g);default:return g=-2,t.bitb=T,t.bitk=b,y.avail_in=m,y.total_in+=_-y.next_in_index,y.next_in_index=_,t.write=S,t.inflate_flush(y,g)}}},t.free=function(y){t.reset(y,null),t.win=null,u=null},t.set_dictionary=function(y,g,A){t.win.set(y.subarray(g,g+A),0),t.read=t.write=A},t.sync_point=function(){return n==Dm?1:0}}var W0=32,Q0=8,K0=0,OS=1,wS=2,xS=3,PS=4,FS=5,Lm=6,bc=7,DS=12,ya=13,q0=[0,0,255,255];function Y0(){let i=this;i.mode=0,i.method=0,i.was=[0],i.need=0,i.marker=0,i.wbits=0;function e(t){return!t||!t.istate?-2:(t.total_in=t.total_out=0,t.msg=null,t.istate.mode=bc,t.istate.blocks.reset(t,null),0)}i.inflateEnd=function(t){return i.blocks&&i.blocks.free(t),i.blocks=null,0},i.inflateInit=function(t,n){return t.msg=null,i.blocks=null,n<8||n>15?(i.inflateEnd(t),-2):(i.wbits=n,t.istate.blocks=new z0(t,1<<n),e(t),0)},i.inflate=function(t,n){let r,o;if(!t||!t.istate||!t.next_in)return-2;let a=t.istate;for(n=n==F0?-5:0,r=-5;;)switch(a.mode){case K0:if(t.avail_in===0)return r;if(r=n,t.avail_in--,t.total_in++,((a.method=t.read_byte(t.next_in_index++))&15)!=Q0){a.mode=ya,t.msg="unknown compression method",a.marker=5;break}if((a.method>>4)+8>a.wbits){a.mode=ya,t.msg="invalid win size",a.marker=5;break}a.mode=OS;case OS:if(t.avail_in===0)return r;if(r=n,t.avail_in--,t.total_in++,o=t.read_byte(t.next_in_index++)&255,((a.method<<8)+o)%31!==0){a.mode=ya,t.msg="incorrect header check",a.marker=5;break}if(!(o&W0)){a.mode=bc;break}a.mode=wS;case wS:if(t.avail_in===0)return r;r=n,t.avail_in--,t.total_in++,a.need=(t.read_byte(t.next_in_index++)&255)<<24&4278190080,a.mode=xS;case xS:if(t.avail_in===0)return r;r=n,t.avail_in--,t.total_in++,a.need+=(t.read_byte(t.next_in_index++)&255)<<16&16711680,a.mode=PS;case PS:if(t.avail_in===0)return r;r=n,t.avail_in--,t.total_in++,a.need+=(t.read_byte(t.next_in_index++)&255)<<8&65280,a.mode=FS;case FS:return t.avail_in===0?r:(r=n,t.avail_in--,t.total_in++,a.need+=t.read_byte(t.next_in_index++)&255,a.mode=Lm,2);case Lm:return a.mode=ya,t.msg="need dictionary",a.marker=0,-2;case bc:if(r=a.blocks.proc(t,r),r==-3){a.mode=ya,a.marker=0;break}if(r==0&&(r=n),r!=1)return r;r=n,a.blocks.reset(t,a.was),a.mode=DS;case DS:return t.avail_in=0,1;case ya:return-3;default:return-2}},i.inflateSetDictionary=function(t,n,r){let o=0,a=r;if(!t||!t.istate||t.istate.mode!=Lm)return-2;let s=t.istate;return a>=1<<s.wbits&&(a=(1<<s.wbits)-1,o=r-a),s.blocks.set_dictionary(n,o,a),s.mode=bc,0},i.inflateSync=function(t){let n,r,o,a,s;if(!t||!t.istate)return-2;let l=t.istate;if(l.mode!=ya&&(l.mode=ya,l.marker=0),(n=t.avail_in)===0)return-5;for(r=t.next_in_index,o=l.marker;n!==0&&o<4;)t.read_byte(r)==q0[o]?o++:t.read_byte(r)!==0?o=0:o=4-o,r++,n--;return t.total_in+=r-t.next_in_index,t.next_in_index=r,t.avail_in=n,l.marker=o,o!=4?-3:(a=t.total_in,s=t.total_out,e(t),t.total_in=a,t.total_out=s,l.mode=bc,0)},i.inflateSyncPoint=function(t){return!t||!t.istate||!t.istate.blocks?-2:t.istate.blocks.sync_point()}}function MS(){}MS.prototype={inflateInit:function(i){let e=this;return e.istate=new Y0,i||(i=15),e.istate.inflateInit(e,i)},inflate:function(i){let e=this;return e.istate?e.istate.inflate(e,i):-2},inflateEnd:function(){let i=this;if(!i.istate)return-2;let e=i.istate.inflateEnd(i);return i.istate=null,e},inflateSync:function(){let i=this;return i.istate?i.istate.inflateSync(i):-2},inflateSetDictionary:function(i,e){let t=this;return t.istate?t.istate.inflateSetDictionary(t,i,e):-2},read_byte:function(i){return this.next_in[i]},read_buf:function(i,e){return this.next_in.subarray(i,i+e)}};function X0(i){let e=this,t=new MS,n=i&&i.chunkSize?Math.floor(i.chunkSize*2):128*1024,r=P0,o=new Uint8Array(n),a=!1;t.inflateInit(),t.next_out=o,e.append=function(s,l){let d=[],c,p,u=0,h=0,f=0;if(s.length!==0){t.next_in_index=0,t.next_in=s,t.avail_in=s.length;do{if(t.next_out_index=0,t.avail_out=n,t.avail_in===0&&!a&&(t.next_in_index=0,a=!0),c=t.inflate(r),a&&c===-5){if(t.avail_in!==0)throw new Error("inflating: bad input")}else if(c!==0&&c!==1)throw new Error("inflating: "+t.msg);if((a||c===1)&&t.avail_in===s.length)throw new Error("inflating: bad input");t.next_out_index&&(t.next_out_index===n?d.push(new Uint8Array(o)):d.push(o.slice(0,t.next_out_index))),f+=t.next_out_index,l&&t.next_in_index>0&&t.next_in_index!=u&&(l(t.next_in_index),u=t.next_in_index)}while(t.avail_in>0||t.avail_out===0);return d.length>1?(p=new Uint8Array(f),d.forEach(function(y){p.set(y,h),h+=y.length})):p=d[0]||new Uint8Array(0),p}},e.flush=function(){t.inflateEnd()}}var BS=X0;var J0={chunkSize:524288,maxWorkers:typeof navigator<"u"&&navigator.hardwareConcurrency||2,terminateWorkerTimeout:5e3,useWebWorkers:!0,workerScripts:void 0},uo=Object.assign({},J0);function Bm(){return uo}function Ys(i){if(i.baseURL!==void 0&&(uo.baseURL=i.baseURL),i.chunkSize!==void 0&&(uo.chunkSize=i.chunkSize),i.maxWorkers!==void 0&&(uo.maxWorkers=i.maxWorkers),i.terminateWorkerTimeout!==void 0&&(uo.terminateWorkerTimeout=i.terminateWorkerTimeout),i.useWebWorkers!==void 0&&(uo.useWebWorkers=i.useWebWorkers),i.Deflate!==void 0&&(uo.Deflate=i.Deflate),i.Inflate!==void 0&&(uo.Inflate=i.Inflate),i.workerScripts!==void 0){if(i.workerScripts.deflate){if(!Array.isArray(i.workerScripts.deflate))throw new Error("workerScripts.deflate must be an array");uo.workerScripts||(uo.workerScripts={}),uo.workerScripts.deflate=i.workerScripts.deflate}if(i.workerScripts.inflate){if(!Array.isArray(i.workerScripts.inflate))throw new Error("workerScripts.inflate must be an array");uo.workerScripts||(uo.workerScripts={}),uo.workerScripts.inflate=i.workerScripts.inflate}}}var Tc={application:{"andrew-inset":"ez",annodex:"anx","atom+xml":"atom","atomcat+xml":"atomcat","atomserv+xml":"atomsrv",bbolin:"lin",cap:["cap","pcap"],"cu-seeme":"cu","davmount+xml":"davmount",dsptype:"tsp",ecmascript:["es","ecma"],futuresplash:"spl",hta:"hta","java-archive":"jar","java-serialized-object":"ser","java-vm":"class",javascript:"js",m3g:"m3g","mac-binhex40":"hqx",mathematica:["nb","ma","mb"],msaccess:"mdb",msword:["doc","dot"],mxf:"mxf",oda:"oda",ogg:"ogx",pdf:"pdf","pgp-keys":"key","pgp-signature":["asc","sig"],"pics-rules":"prf",postscript:["ps","ai","eps","epsi","epsf","eps2","eps3"],rar:"rar","rdf+xml":"rdf","rss+xml":"rss",rtf:"rtf",smil:["smi","smil"],"xhtml+xml":["xhtml","xht"],xml:["xml","xsl","xsd"],"xspf+xml":"xspf",zip:"zip","vnd.android.package-archive":"apk","vnd.cinderella":"cdy","vnd.google-earth.kml+xml":"kml","vnd.google-earth.kmz":"kmz","vnd.mozilla.xul+xml":"xul","vnd.ms-excel":["xls","xlb","xlt","xlm","xla","xlc","xlw"],"vnd.ms-pki.seccat":"cat","vnd.ms-pki.stl":"stl","vnd.ms-powerpoint":["ppt","pps","pot"],"vnd.oasis.opendocument.chart":"odc","vnd.oasis.opendocument.database":"odb","vnd.oasis.opendocument.formula":"odf","vnd.oasis.opendocument.graphics":"odg","vnd.oasis.opendocument.graphics-template":"otg","vnd.oasis.opendocument.image":"odi","vnd.oasis.opendocument.presentation":"odp","vnd.oasis.opendocument.presentation-template":"otp","vnd.oasis.opendocument.spreadsheet":"ods","vnd.oasis.opendocument.spreadsheet-template":"ots","vnd.oasis.opendocument.text":"odt","vnd.oasis.opendocument.text-master":"odm","vnd.oasis.opendocument.text-template":"ott","vnd.oasis.opendocument.text-web":"oth","vnd.openxmlformats-officedocument.spreadsheetml.sheet":"xlsx","vnd.openxmlformats-officedocument.spreadsheetml.template":"xltx","vnd.openxmlformats-officedocument.presentationml.presentation":"pptx","vnd.openxmlformats-officedocument.presentationml.slideshow":"ppsx","vnd.openxmlformats-officedocument.presentationml.template":"potx","vnd.openxmlformats-officedocument.wordprocessingml.document":"docx","vnd.openxmlformats-officedocument.wordprocessingml.template":"dotx","vnd.smaf":"mmf","vnd.stardivision.calc":"sdc","vnd.stardivision.chart":"sds","vnd.stardivision.draw":"sda","vnd.stardivision.impress":"sdd","vnd.stardivision.math":["sdf","smf"],"vnd.stardivision.writer":["sdw","vor"],"vnd.stardivision.writer-global":"sgl","vnd.sun.xml.calc":"sxc","vnd.sun.xml.calc.template":"stc","vnd.sun.xml.draw":"sxd","vnd.sun.xml.draw.template":"std","vnd.sun.xml.impress":"sxi","vnd.sun.xml.impress.template":"sti","vnd.sun.xml.math":"sxm","vnd.sun.xml.writer":"sxw","vnd.sun.xml.writer.global":"sxg","vnd.sun.xml.writer.template":"stw","vnd.symbian.install":["sis","sisx"],"vnd.visio":["vsd","vst","vss","vsw"],"vnd.wap.wbxml":"wbxml","vnd.wap.wmlc":"wmlc","vnd.wap.wmlscriptc":"wmlsc","vnd.wordperfect":"wpd","vnd.wordperfect5.1":"wp5","x-123":"wk","x-7z-compressed":"7z","x-abiword":"abw","x-apple-diskimage":"dmg","x-bcpio":"bcpio","x-bittorrent":"torrent","x-cbr":["cbr","cba","cbt","cb7"],"x-cbz":"cbz","x-cdf":["cdf","cda"],"x-cdlink":"vcd","x-chess-pgn":"pgn","x-cpio":"cpio","x-csh":"csh","x-debian-package":["deb","udeb"],"x-director":["dcr","dir","dxr","cst","cct","cxt","w3d","fgd","swa"],"x-dms":"dms","x-doom":"wad","x-dvi":"dvi","x-httpd-eruby":"rhtml","x-font":"pcf.Z","x-freemind":"mm","x-gnumeric":"gnumeric","x-go-sgf":"sgf","x-graphing-calculator":"gcf","x-gtar":["gtar","taz"],"x-hdf":"hdf","x-httpd-php":["phtml","pht","php"],"x-httpd-php-source":"phps","x-httpd-php3":"php3","x-httpd-php3-preprocessed":"php3p","x-httpd-php4":"php4","x-httpd-php5":"php5","x-ica":"ica","x-info":"info","x-internet-signup":["ins","isp"],"x-iphone":"iii","x-iso9660-image":"iso","x-java-jnlp-file":"jnlp","x-jmol":"jmz","x-killustrator":"kil","x-koan":["skp","skd","skt","skm"],"x-kpresenter":["kpr","kpt"],"x-kword":["kwd","kwt"],"x-latex":"latex","x-lha":"lha","x-lyx":"lyx","x-lzh":"lzh","x-lzx":"lzx","x-maker":["frm","maker","frame","fm","fb","book","fbdoc"],"x-ms-wmd":"wmd","x-ms-wmz":"wmz","x-msdos-program":["com","exe","bat","dll"],"x-msi":"msi","x-netcdf":["nc","cdf"],"x-ns-proxy-autoconfig":["pac","dat"],"x-nwc":"nwc","x-object":"o","x-oz-application":"oza","x-pkcs7-certreqresp":"p7r","x-python-code":["pyc","pyo"],"x-qgis":["qgs","shp","shx"],"x-quicktimeplayer":"qtl","x-redhat-package-manager":"rpm","x-ruby":"rb","x-sh":"sh","x-shar":"shar","x-shockwave-flash":["swf","swfl"],"x-silverlight":"scr","x-stuffit":"sit","x-sv4cpio":"sv4cpio","x-sv4crc":"sv4crc","x-tar":"tar","x-tcl":"tcl","x-tex-gf":"gf","x-tex-pk":"pk","x-texinfo":["texinfo","texi"],"x-trash":["~","%","bak","old","sik"],"x-troff":["t","tr","roff"],"x-troff-man":"man","x-troff-me":"me","x-troff-ms":"ms","x-ustar":"ustar","x-wais-source":"src","x-wingz":"wz","x-x509-ca-cert":["crt","der","cer"],"x-xcf":"xcf","x-xfig":"fig","x-xpinstall":"xpi",applixware:"aw","atomsvc+xml":"atomsvc","ccxml+xml":"ccxml","cdmi-capability":"cdmia","cdmi-container":"cdmic","cdmi-domain":"cdmid","cdmi-object":"cdmio","cdmi-queue":"cdmiq","docbook+xml":"dbk","dssc+der":"dssc","dssc+xml":"xdssc","emma+xml":"emma","epub+zip":"epub",exi:"exi","font-tdpfr":"pfr","gml+xml":"gml","gpx+xml":"gpx",gxf:"gxf",hyperstudio:"stk","inkml+xml":["ink","inkml"],ipfix:"ipfix",json:"json","jsonml+json":"jsonml","lost+xml":"lostxml","mads+xml":"mads",marc:"mrc","marcxml+xml":"mrcx","mathml+xml":"mathml",mbox:"mbox","mediaservercontrol+xml":"mscml","metalink+xml":"metalink","metalink4+xml":"meta4","mets+xml":"mets","mods+xml":"mods",mp21:["m21","mp21"],mp4:"mp4s","oebps-package+xml":"opf","omdoc+xml":"omdoc",onenote:["onetoc","onetoc2","onetmp","onepkg"],oxps:"oxps","patch-ops-error+xml":"xer","pgp-encrypted":"pgp",pkcs10:"p10","pkcs7-mime":["p7m","p7c"],"pkcs7-signature":"p7s",pkcs8:"p8","pkix-attr-cert":"ac","pkix-crl":"crl","pkix-pkipath":"pkipath",pkixcmp:"pki","pls+xml":"pls","prs.cww":"cww","pskc+xml":"pskcxml","reginfo+xml":"rif","relax-ng-compact-syntax":"rnc","resource-lists+xml":"rl","resource-lists-diff+xml":"rld","rls-services+xml":"rs","rpki-ghostbusters":"gbr","rpki-manifest":"mft","rpki-roa":"roa","rsd+xml":"rsd","sbml+xml":"sbml","scvp-cv-request":"scq","scvp-cv-response":"scs","scvp-vp-request":"spq","scvp-vp-response":"spp",sdp:"sdp","set-payment-initiation":"setpay","set-registration-initiation":"setreg","shf+xml":"shf","sparql-query":"rq","sparql-results+xml":"srx",srgs:"gram","srgs+xml":"grxml","sru+xml":"sru","ssdl+xml":"ssdl","ssml+xml":"ssml","tei+xml":["tei","teicorpus"],"thraud+xml":"tfi","timestamped-data":"tsd","vnd.3gpp.pic-bw-large":"plb","vnd.3gpp.pic-bw-small":"psb","vnd.3gpp.pic-bw-var":"pvb","vnd.3gpp2.tcap":"tcap","vnd.3m.post-it-notes":"pwn","vnd.accpac.simply.aso":"aso","vnd.accpac.simply.imp":"imp","vnd.acucobol":"acu","vnd.acucorp":["atc","acutc"],"vnd.adobe.air-application-installer-package+zip":"air","vnd.adobe.formscentral.fcdt":"fcdt","vnd.adobe.fxp":["fxp","fxpl"],"vnd.adobe.xdp+xml":"xdp","vnd.adobe.xfdf":"xfdf","vnd.ahead.space":"ahead","vnd.airzip.filesecure.azf":"azf","vnd.airzip.filesecure.azs":"azs","vnd.amazon.ebook":"azw","vnd.americandynamics.acc":"acc","vnd.amiga.ami":"ami","vnd.anser-web-certificate-issue-initiation":"cii","vnd.anser-web-funds-transfer-initiation":"fti","vnd.antix.game-component":"atx","vnd.apple.installer+xml":"mpkg","vnd.apple.mpegurl":"m3u8","vnd.aristanetworks.swi":"swi","vnd.astraea-software.iota":"iota","vnd.audiograph":"aep","vnd.blueice.multipass":"mpm","vnd.bmi":"bmi","vnd.businessobjects":"rep","vnd.chemdraw+xml":"cdxml","vnd.chipnuts.karaoke-mmd":"mmd","vnd.claymore":"cla","vnd.cloanto.rp9":"rp9","vnd.clonk.c4group":["c4g","c4d","c4f","c4p","c4u"],"vnd.cluetrust.cartomobile-config":"c11amc","vnd.cluetrust.cartomobile-config-pkg":"c11amz","vnd.commonspace":"csp","vnd.contact.cmsg":"cdbcmsg","vnd.cosmocaller":"cmc","vnd.crick.clicker":"clkx","vnd.crick.clicker.keyboard":"clkk","vnd.crick.clicker.palette":"clkp","vnd.crick.clicker.template":"clkt","vnd.crick.clicker.wordbank":"clkw","vnd.criticaltools.wbs+xml":"wbs","vnd.ctc-posml":"pml","vnd.cups-ppd":"ppd","vnd.curl.car":"car","vnd.curl.pcurl":"pcurl","vnd.dart":"dart","vnd.data-vision.rdz":"rdz","vnd.dece.data":["uvf","uvvf","uvd","uvvd"],"vnd.dece.ttml+xml":["uvt","uvvt"],"vnd.dece.unspecified":["uvx","uvvx"],"vnd.dece.zip":["uvz","uvvz"],"vnd.denovo.fcselayout-link":"fe_launch","vnd.dna":"dna","vnd.dolby.mlp":"mlp","vnd.dpgraph":"dpg","vnd.dreamfactory":"dfac","vnd.ds-keypoint":"kpxx","vnd.dvb.ait":"ait","vnd.dvb.service":"svc","vnd.dynageo":"geo","vnd.ecowin.chart":"mag","vnd.enliven":"nml","vnd.epson.esf":"esf","vnd.epson.msf":"msf","vnd.epson.quickanime":"qam","vnd.epson.salt":"slt","vnd.epson.ssf":"ssf","vnd.eszigno3+xml":["es3","et3"],"vnd.ezpix-album":"ez2","vnd.ezpix-package":"ez3","vnd.fdf":"fdf","vnd.fdsn.mseed":"mseed","vnd.fdsn.seed":["seed","dataless"],"vnd.flographit":"gph","vnd.fluxtime.clip":"ftc","vnd.framemaker":["fm","frame","maker","book"],"vnd.frogans.fnc":"fnc","vnd.frogans.ltf":"ltf","vnd.fsc.weblaunch":"fsc","vnd.fujitsu.oasys":"oas","vnd.fujitsu.oasys2":"oa2","vnd.fujitsu.oasys3":"oa3","vnd.fujitsu.oasysgp":"fg5","vnd.fujitsu.oasysprs":"bh2","vnd.fujixerox.ddd":"ddd","vnd.fujixerox.docuworks":"xdw","vnd.fujixerox.docuworks.binder":"xbd","vnd.fuzzysheet":"fzs","vnd.genomatix.tuxedo":"txd","vnd.geogebra.file":"ggb","vnd.geogebra.tool":"ggt","vnd.geometry-explorer":["gex","gre"],"vnd.geonext":"gxt","vnd.geoplan":"g2w","vnd.geospace":"g3w","vnd.gmx":"gmx","vnd.grafeq":["gqf","gqs"],"vnd.groove-account":"gac","vnd.groove-help":"ghf","vnd.groove-identity-message":"gim","vnd.groove-injector":"grv","vnd.groove-tool-message":"gtm","vnd.groove-tool-template":"tpl","vnd.groove-vcard":"vcg","vnd.hal+xml":"hal","vnd.handheld-entertainment+xml":"zmm","vnd.hbci":"hbci","vnd.hhe.lesson-player":"les","vnd.hp-hpgl":"hpgl","vnd.hp-hpid":"hpid","vnd.hp-hps":"hps","vnd.hp-jlyt":"jlt","vnd.hp-pcl":"pcl","vnd.hp-pclxl":"pclxl","vnd.hydrostatix.sof-data":"sfd-hdstx","vnd.ibm.minipay":"mpy","vnd.ibm.modcap":["afp","listafp","list3820"],"vnd.ibm.rights-management":"irm","vnd.ibm.secure-container":"sc","vnd.iccprofile":["icc","icm"],"vnd.igloader":"igl","vnd.immervision-ivp":"ivp","vnd.immervision-ivu":"ivu","vnd.insors.igm":"igm","vnd.intercon.formnet":["xpw","xpx"],"vnd.intergeo":"i2g","vnd.intu.qbo":"qbo","vnd.intu.qfx":"qfx","vnd.ipunplugged.rcprofile":"rcprofile","vnd.irepository.package+xml":"irp","vnd.is-xpr":"xpr","vnd.isac.fcs":"fcs","vnd.jam":"jam","vnd.jcp.javame.midlet-rms":"rms","vnd.jisp":"jisp","vnd.joost.joda-archive":"joda","vnd.kahootz":["ktz","ktr"],"vnd.kde.karbon":"karbon","vnd.kde.kchart":"chrt","vnd.kde.kformula":"kfo","vnd.kde.kivio":"flw","vnd.kde.kontour":"kon","vnd.kde.kpresenter":["kpr","kpt"],"vnd.kde.kspread":"ksp","vnd.kde.kword":["kwd","kwt"],"vnd.kenameaapp":"htke","vnd.kidspiration":"kia","vnd.kinar":["kne","knp"],"vnd.koan":["skp","skd","skt","skm"],"vnd.kodak-descriptor":"sse","vnd.las.las+xml":"lasxml","vnd.llamagraphics.life-balance.desktop":"lbd","vnd.llamagraphics.life-balance.exchange+xml":"lbe","vnd.lotus-1-2-3":"123","vnd.lotus-approach":"apr","vnd.lotus-freelance":"pre","vnd.lotus-notes":"nsf","vnd.lotus-organizer":"org","vnd.lotus-screencam":"scm","vnd.lotus-wordpro":"lwp","vnd.macports.portpkg":"portpkg","vnd.mcd":"mcd","vnd.medcalcdata":"mc1","vnd.mediastation.cdkey":"cdkey","vnd.mfer":"mwf","vnd.mfmp":"mfm","vnd.micrografx.flo":"flo","vnd.micrografx.igx":"igx","vnd.mif":"mif","vnd.mobius.daf":"daf","vnd.mobius.dis":"dis","vnd.mobius.mbk":"mbk","vnd.mobius.mqy":"mqy","vnd.mobius.msl":"msl","vnd.mobius.plc":"plc","vnd.mobius.txf":"txf","vnd.mophun.application":"mpn","vnd.mophun.certificate":"mpc","vnd.ms-artgalry":"cil","vnd.ms-cab-compressed":"cab","vnd.ms-excel.addin.macroenabled.12":"xlam","vnd.ms-excel.sheet.binary.macroenabled.12":"xlsb","vnd.ms-excel.sheet.macroenabled.12":"xlsm","vnd.ms-excel.template.macroenabled.12":"xltm","vnd.ms-fontobject":"eot","vnd.ms-htmlhelp":"chm","vnd.ms-ims":"ims","vnd.ms-lrm":"lrm","vnd.ms-officetheme":"thmx","vnd.ms-powerpoint.addin.macroenabled.12":"ppam","vnd.ms-powerpoint.presentation.macroenabled.12":"pptm","vnd.ms-powerpoint.slide.macroenabled.12":"sldm","vnd.ms-powerpoint.slideshow.macroenabled.12":"ppsm","vnd.ms-powerpoint.template.macroenabled.12":"potm","vnd.ms-project":["mpp","mpt"],"vnd.ms-word.document.macroenabled.12":"docm","vnd.ms-word.template.macroenabled.12":"dotm","vnd.ms-works":["wps","wks","wcm","wdb"],"vnd.ms-wpl":"wpl","vnd.ms-xpsdocument":"xps","vnd.mseq":"mseq","vnd.musician":"mus","vnd.muvee.style":"msty","vnd.mynfc":"taglet","vnd.neurolanguage.nlu":"nlu","vnd.nitf":["ntf","nitf"],"vnd.noblenet-directory":"nnd","vnd.noblenet-sealer":"nns","vnd.noblenet-web":"nnw","vnd.nokia.n-gage.data":"ngdat","vnd.nokia.n-gage.symbian.install":"n-gage","vnd.nokia.radio-preset":"rpst","vnd.nokia.radio-presets":"rpss","vnd.novadigm.edm":"edm","vnd.novadigm.edx":"edx","vnd.novadigm.ext":"ext","vnd.oasis.opendocument.chart-template":"otc","vnd.oasis.opendocument.formula-template":"odft","vnd.oasis.opendocument.image-template":"oti","vnd.olpc-sugar":"xo","vnd.oma.dd2+xml":"dd2","vnd.openofficeorg.extension":"oxt","vnd.openxmlformats-officedocument.presentationml.slide":"sldx","vnd.osgeo.mapguide.package":"mgp","vnd.osgi.dp":"dp","vnd.osgi.subsystem":"esa","vnd.palm":["pdb","pqa","oprc"],"vnd.pawaafile":"paw","vnd.pg.format":"str","vnd.pg.osasli":"ei6","vnd.picsel":"efif","vnd.pmi.widget":"wg","vnd.pocketlearn":"plf","vnd.powerbuilder6":"pbd","vnd.previewsystems.box":"box","vnd.proteus.magazine":"mgz","vnd.publishare-delta-tree":"qps","vnd.pvi.ptid1":"ptid","vnd.quark.quarkxpress":["qxd","qxt","qwd","qwt","qxl","qxb"],"vnd.realvnc.bed":"bed","vnd.recordare.musicxml":"mxl","vnd.recordare.musicxml+xml":"musicxml","vnd.rig.cryptonote":"cryptonote","vnd.rn-realmedia":"rm","vnd.rn-realmedia-vbr":"rmvb","vnd.route66.link66+xml":"link66","vnd.sailingtracker.track":"st","vnd.seemail":"see","vnd.sema":"sema","vnd.semd":"semd","vnd.semf":"semf","vnd.shana.informed.formdata":"ifm","vnd.shana.informed.formtemplate":"itp","vnd.shana.informed.interchange":"iif","vnd.shana.informed.package":"ipk","vnd.simtech-mindmapper":["twd","twds"],"vnd.smart.teacher":"teacher","vnd.solent.sdkm+xml":["sdkm","sdkd"],"vnd.spotfire.dxp":"dxp","vnd.spotfire.sfs":"sfs","vnd.stepmania.package":"smzip","vnd.stepmania.stepchart":"sm","vnd.sus-calendar":["sus","susp"],"vnd.svd":"svd","vnd.syncml+xml":"xsm","vnd.syncml.dm+wbxml":"bdm","vnd.syncml.dm+xml":"xdm","vnd.tao.intent-module-archive":"tao","vnd.tcpdump.pcap":["pcap","cap","dmp"],"vnd.tmobile-livetv":"tmo","vnd.trid.tpt":"tpt","vnd.triscape.mxs":"mxs","vnd.trueapp":"tra","vnd.ufdl":["ufd","ufdl"],"vnd.uiq.theme":"utz","vnd.umajin":"umj","vnd.unity":"unityweb","vnd.uoml+xml":"uoml","vnd.vcx":"vcx","vnd.visionary":"vis","vnd.vsf":"vsf","vnd.webturbo":"wtb","vnd.wolfram.player":"nbp","vnd.wqd":"wqd","vnd.wt.stf":"stf","vnd.xara":"xar","vnd.xfdl":"xfdl","vnd.yamaha.hv-dic":"hvd","vnd.yamaha.hv-script":"hvs","vnd.yamaha.hv-voice":"hvp","vnd.yamaha.openscoreformat":"osf","vnd.yamaha.openscoreformat.osfpvg+xml":"osfpvg","vnd.yamaha.smaf-audio":"saf","vnd.yamaha.smaf-phrase":"spf","vnd.yellowriver-custom-menu":"cmp","vnd.zul":["zir","zirz"],"vnd.zzazz.deck+xml":"zaz","voicexml+xml":"vxml",widget:"wgt",winhlp:"hlp","wsdl+xml":"wsdl","wspolicy+xml":"wspolicy","x-ace-compressed":"ace","x-authorware-bin":["aab","x32","u32","vox"],"x-authorware-map":"aam","x-authorware-seg":"aas","x-blorb":["blb","blorb"],"x-bzip":"bz","x-bzip2":["bz2","boz"],"x-cfs-compressed":"cfs","x-chat":"chat","x-conference":"nsc","x-dgc-compressed":"dgc","x-dtbncx+xml":"ncx","x-dtbook+xml":"dtb","x-dtbresource+xml":"res","x-eva":"eva","x-font-bdf":"bdf","x-font-ghostscript":"gsf","x-font-linux-psf":"psf","x-font-otf":"otf","x-font-pcf":"pcf","x-font-snf":"snf","x-font-ttf":["ttf","ttc"],"x-font-type1":["pfa","pfb","pfm","afm"],"x-font-woff":"woff","x-freearc":"arc","x-gca-compressed":"gca","x-glulx":"ulx","x-gramps-xml":"gramps","x-install-instructions":"install","x-lzh-compressed":["lzh","lha"],"x-mie":"mie","x-mobipocket-ebook":["prc","mobi"],"x-ms-application":"application","x-ms-shortcut":"lnk","x-ms-xbap":"xbap","x-msbinder":"obd","x-mscardfile":"crd","x-msclip":"clp","x-msdownload":["exe","dll","com","bat","msi"],"x-msmediaview":["mvb","m13","m14"],"x-msmetafile":["wmf","wmz","emf","emz"],"x-msmoney":"mny","x-mspublisher":"pub","x-msschedule":"scd","x-msterminal":"trm","x-mswrite":"wri","x-nzb":"nzb","x-pkcs12":["p12","pfx"],"x-pkcs7-certificates":["p7b","spc"],"x-research-info-systems":"ris","x-silverlight-app":"xap","x-sql":"sql","x-stuffitx":"sitx","x-subrip":"srt","x-t3vm-image":"t3","x-tads":"gam","x-tex":"tex","x-tex-tfm":"tfm","x-tgif":"obj","x-xliff+xml":"xlf","x-xz":"xz","x-zmachine":["z1","z2","z3","z4","z5","z6","z7","z8"],"xaml+xml":"xaml","xcap-diff+xml":"xdf","xenc+xml":"xenc","xml-dtd":"dtd","xop+xml":"xop","xproc+xml":"xpl","xslt+xml":"xslt","xv+xml":["mxml","xhvml","xvml","xvm"],yang:"yang","yin+xml":"yin",envoy:"evy",fractals:"fif","internet-property-stream":"acx",olescript:"axs","vnd.ms-outlook":"msg","vnd.ms-pkicertstore":"sst","x-compress":"z","x-compressed":"tgz","x-gzip":"gz","x-perfmon":["pma","pmc","pml","pmr","pmw"],"x-pkcs7-mime":["p7c","p7m"],"ynd.ms-pkipko":"pko"},audio:{amr:"amr","amr-wb":"awb",annodex:"axa",basic:["au","snd"],flac:"flac",midi:["mid","midi","kar","rmi"],mpeg:["mpga","mpega","mp2","mp3","m4a","mp2a","m2a","m3a"],mpegurl:"m3u",ogg:["oga","ogg","spx"],"prs.sid":"sid","x-aiff":["aif","aiff","aifc"],"x-gsm":"gsm","x-ms-wma":"wma","x-ms-wax":"wax","x-pn-realaudio":"ram","x-realaudio":"ra","x-sd2":"sd2","x-wav":"wav",adpcm:"adp",mp4:"mp4a",s3m:"s3m",silk:"sil","vnd.dece.audio":["uva","uvva"],"vnd.digital-winds":"eol","vnd.dra":"dra","vnd.dts":"dts","vnd.dts.hd":"dtshd","vnd.lucent.voice":"lvp","vnd.ms-playready.media.pya":"pya","vnd.nuera.ecelp4800":"ecelp4800","vnd.nuera.ecelp7470":"ecelp7470","vnd.nuera.ecelp9600":"ecelp9600","vnd.rip":"rip",webm:"weba","x-aac":"aac","x-caf":"caf","x-matroska":"mka","x-pn-realaudio-plugin":"rmp",xm:"xm",mid:["mid","rmi"]},chemical:{"x-alchemy":"alc","x-cache":["cac","cache"],"x-cache-csf":"csf","x-cactvs-binary":["cbin","cascii","ctab"],"x-cdx":"cdx","x-chem3d":"c3d","x-cif":"cif","x-cmdf":"cmdf","x-cml":"cml","x-compass":"cpa","x-crossfire":"bsd","x-csml":["csml","csm"],"x-ctx":"ctx","x-cxf":["cxf","cef"],"x-embl-dl-nucleotide":["emb","embl"],"x-gamess-input":["inp","gam","gamin"],"x-gaussian-checkpoint":["fch","fchk"],"x-gaussian-cube":"cub","x-gaussian-input":["gau","gjc","gjf"],"x-gaussian-log":"gal","x-gcg8-sequence":"gcg","x-genbank":"gen","x-hin":"hin","x-isostar":["istr","ist"],"x-jcamp-dx":["jdx","dx"],"x-kinemage":"kin","x-macmolecule":"mcm","x-macromodel-input":["mmd","mmod"],"x-mdl-molfile":"mol","x-mdl-rdfile":"rd","x-mdl-rxnfile":"rxn","x-mdl-sdfile":["sd","sdf"],"x-mdl-tgf":"tgf","x-mmcif":"mcif","x-mol2":"mol2","x-molconn-Z":"b","x-mopac-graph":"gpt","x-mopac-input":["mop","mopcrt","mpc","zmt"],"x-mopac-out":"moo","x-ncbi-asn1":"asn","x-ncbi-asn1-ascii":["prt","ent"],"x-ncbi-asn1-binary":["val","aso"],"x-pdb":["pdb","ent"],"x-rosdal":"ros","x-swissprot":"sw","x-vamas-iso14976":"vms","x-vmd":"vmd","x-xtel":"xtel","x-xyz":"xyz"},image:{gif:"gif",ief:"ief",jpeg:["jpeg","jpg","jpe"],pcx:"pcx",png:"png","svg+xml":["svg","svgz"],tiff:["tiff","tif"],"vnd.djvu":["djvu","djv"],"vnd.wap.wbmp":"wbmp","x-canon-cr2":"cr2","x-canon-crw":"crw","x-cmu-raster":"ras","x-coreldraw":"cdr","x-coreldrawpattern":"pat","x-coreldrawtemplate":"cdt","x-corelphotopaint":"cpt","x-epson-erf":"erf","x-icon":"ico","x-jg":"art","x-jng":"jng","x-nikon-nef":"nef","x-olympus-orf":"orf","x-photoshop":"psd","x-portable-anymap":"pnm","x-portable-bitmap":"pbm","x-portable-graymap":"pgm","x-portable-pixmap":"ppm","x-rgb":"rgb","x-xbitmap":"xbm","x-xpixmap":"xpm","x-xwindowdump":"xwd",bmp:"bmp",cgm:"cgm",g3fax:"g3",ktx:"ktx","prs.btif":"btif",sgi:"sgi","vnd.dece.graphic":["uvi","uvvi","uvg","uvvg"],"vnd.dwg":"dwg","vnd.dxf":"dxf","vnd.fastbidsheet":"fbs","vnd.fpx":"fpx","vnd.fst":"fst","vnd.fujixerox.edmics-mmr":"mmr","vnd.fujixerox.edmics-rlc":"rlc","vnd.ms-modi":"mdi","vnd.ms-photo":"wdp","vnd.net-fpx":"npx","vnd.xiff":"xif",webp:"webp","x-3ds":"3ds","x-cmx":"cmx","x-freehand":["fh","fhc","fh4","fh5","fh7"],"x-pict":["pic","pct"],"x-tga":"tga","cis-cod":"cod",pipeg:"jfif"},message:{rfc822:["eml","mime","mht","mhtml","nws"]},model:{iges:["igs","iges"],mesh:["msh","mesh","silo"],vrml:["wrl","vrml"],"x3d+vrml":["x3dv","x3dvz"],"x3d+xml":["x3d","x3dz"],"x3d+binary":["x3db","x3dbz"],"vnd.collada+xml":"dae","vnd.dwf":"dwf","vnd.gdl":"gdl","vnd.gtw":"gtw","vnd.mts":"mts","vnd.vtu":"vtu"},text:{"cache-manifest":["manifest","appcache"],calendar:["ics","icz","ifb"],css:"css",csv:"csv",h323:"323",html:["html","htm","shtml","stm"],iuls:"uls",mathml:"mml",plain:["txt","text","brf","conf","def","list","log","in","bas"],richtext:"rtx",scriptlet:["sct","wsc"],texmacs:["tm","ts"],"tab-separated-values":"tsv","vnd.sun.j2me.app-descriptor":"jad","vnd.wap.wml":"wml","vnd.wap.wmlscript":"wmls","x-bibtex":"bib","x-boo":"boo","x-c++hdr":["h++","hpp","hxx","hh"],"x-c++src":["c++","cpp","cxx","cc"],"x-component":"htc","x-dsrc":"d","x-diff":["diff","patch"],"x-haskell":"hs","x-java":"java","x-literate-haskell":"lhs","x-moc":"moc","x-pascal":["p","pas"],"x-pcs-gcd":"gcd","x-perl":["pl","pm"],"x-python":"py","x-scala":"scala","x-setext":"etx","x-tcl":["tcl","tk"],"x-tex":["tex","ltx","sty","cls"],"x-vcalendar":"vcs","x-vcard":"vcf",n3:"n3","prs.lines.tag":"dsc",sgml:["sgml","sgm"],troff:["t","tr","roff","man","me","ms"],turtle:"ttl","uri-list":["uri","uris","urls"],vcard:"vcard","vnd.curl":"curl","vnd.curl.dcurl":"dcurl","vnd.curl.scurl":"scurl","vnd.curl.mcurl":"mcurl","vnd.dvb.subtitle":"sub","vnd.fly":"fly","vnd.fmi.flexstor":"flx","vnd.graphviz":"gv","vnd.in3d.3dml":"3dml","vnd.in3d.spot":"spot","x-asm":["s","asm"],"x-c":["c","cc","cxx","cpp","h","hh","dic"],"x-fortran":["f","for","f77","f90"],"x-opml":"opml","x-nfo":"nfo","x-sfv":"sfv","x-uuencode":"uu",webviewhtml:"htt"},video:{avif:".avif","3gpp":"3gp",annodex:"axv",dl:"dl",dv:["dif","dv"],fli:"fli",gl:"gl",mpeg:["mpeg","mpg","mpe","m1v","m2v","mp2","mpa","mpv2"],mp4:["mp4","mp4v","mpg4"],quicktime:["qt","mov"],ogg:"ogv","vnd.mpegurl":["mxu","m4u"],"x-flv":"flv","x-la-asf":["lsf","lsx"],"x-mng":"mng","x-ms-asf":["asf","asx","asr"],"x-ms-wm":"wm","x-ms-wmv":"wmv","x-ms-wmx":"wmx","x-ms-wvx":"wvx","x-msvideo":"avi","x-sgi-movie":"movie","x-matroska":["mpv","mkv","mk3d","mks"],"3gpp2":"3g2",h261:"h261",h263:"h263",h264:"h264",jpeg:"jpgv",jpm:["jpm","jpgm"],mj2:["mj2","mjp2"],"vnd.dece.hd":["uvh","uvvh"],"vnd.dece.mobile":["uvm","uvvm"],"vnd.dece.pd":["uvp","uvvp"],"vnd.dece.sd":["uvs","uvvs"],"vnd.dece.video":["uvv","uvvv"],"vnd.dvb.file":"dvb","vnd.fvt":"fvt","vnd.ms-playready.media.pyv":"pyv","vnd.uvvu.mp4":["uvu","uvvu"],"vnd.vivo":"viv",webm:"webm","x-f4v":"f4v","x-m4v":"m4v","x-ms-vob":"vob","x-smv":"smv"},"x-conference":{"x-cooltalk":"ice"},"x-world":{"x-vrml":["vrm","vrml","wrl","flr","wrz","xaf","xof"]}},qx=(()=>{let i={};for(let e in Tc)if(Tc.hasOwnProperty(e)){for(let t in Tc[e])if(Tc[e].hasOwnProperty(t)){let n=Tc[e][t];if(typeof n=="string")i[n]=e+"/"+t;else for(let r=0;r<n.length;r++)i[n[r]]=e+"/"+t}}return i})();var VS=[];for(let i=0;i<256;i++){let e=i;for(let t=0;t<8;t++)e&1?e=e>>>1^3988292384:e=e>>>1;VS[i]=e}var Vm=class{constructor(e){this.crc=e||-1}append(e){let t=this.crc|0;for(let n=0,r=e.length|0;n<r;n++)t=t>>>8^VS[(t^e[n])&255];this.crc=t}get(){return~this.crc}},ba=Vm;var km=Z0;function Z0(i){if(typeof TextEncoder>"u"){i=unescape(encodeURIComponent(i));let e=new Uint8Array(i.length);for(let t=0;t<e.length;t++)e[t]=i.charCodeAt(t);return e}else return new TextEncoder().encode(i)}var Xr={concat(i,e){if(i.length===0||e.length===0)return i.concat(e);let t=i[i.length-1],n=Xr.getPartial(t);return n===32?i.concat(e):Xr._shiftRight(e,n,t|0,i.slice(0,i.length-1))},bitLength(i){let e=i.length;if(e===0)return 0;let t=i[e-1];return(e-1)*32+Xr.getPartial(t)},clamp(i,e){if(i.length*32<e)return i;i=i.slice(0,Math.ceil(e/32));let t=i.length;return e=e&31,t>0&&e&&(i[t-1]=Xr.partial(e,i[t-1]&2147483648>>e-1,1)),i},partial(i,e,t){return i===32?e:(t?e|0:e<<32-i)+i*1099511627776},getPartial(i){return Math.round(i/1099511627776)||32},_shiftRight(i,e,t,n){for(n===void 0&&(n=[]);e>=32;e-=32)n.push(t),t=0;if(e===0)return n.concat(i);for(let a=0;a<i.length;a++)n.push(t|i[a]>>>e),t=i[a]<<32-e;let r=i.length?i[i.length-1]:0,o=Xr.getPartial(r);return n.push(Xr.partial(e+o&31,e+o>32?t:n.pop(),1)),n}},vc={bytes:{fromBits(i){let t=Xr.bitLength(i)/8,n=new Uint8Array(t),r;for(let o=0;o<t;o++)o&3||(r=i[o/4]),n[o]=r>>>24,r<<=8;return n},toBits(i){let e=[],t,n=0;for(t=0;t<i.length;t++)n=n<<8|i[t],(t&3)===3&&(e.push(n),n=0);return t&3&&e.push(Xr.partial(8*(t&3),n)),e}}},Um={};Um.sha1=function(i){i?(this._h=i._h.slice(0),this._buffer=i._buffer.slice(0),this._length=i._length):this.reset()};Um.sha1.prototype={blockSize:512,reset:function(){let i=this;return i._h=this._init.slice(0),i._buffer=[],i._length=0,i},update:function(i){let e=this;typeof i=="string"&&(i=vc.utf8String.toBits(i));let t=e._buffer=Xr.concat(e._buffer,i),n=e._length,r=e._length=n+Xr.bitLength(i);if(r>9007199254740991)throw new Error("Cannot hash more than 2^53 - 1 bits");let o=new Uint32Array(t),a=0;for(let s=e.blockSize+n-(e.blockSize+n&e.blockSize-1);s<=r;s+=e.blockSize)e._block(o.subarray(16*a,16*(a+1))),a+=1;return t.splice(0,16*a),e},finalize:function(){let i=this,e=i._buffer,t=i._h;e=Xr.concat(e,[Xr.partial(1,1)]);for(let n=e.length+2;n&15;n++)e.push(0);for(e.push(Math.floor(i._length/4294967296)),e.push(i._length|0);e.length;)i._block(e.splice(0,16));return i.reset(),t},_init:[1732584193,4023233417,2562383102,271733878,3285377520],_key:[1518500249,1859775393,2400959708,3395469782],_f:function(i,e,t,n){if(i<=19)return e&t|~e&n;if(i<=39)return e^t^n;if(i<=59)return e&t|e&n|t&n;if(i<=79)return e^t^n},_S:function(i,e){return e<<i|e>>>32-i},_block:function(i){let e=this,t=e._h,n=Array(80);for(let d=0;d<16;d++)n[d]=i[d];let r=t[0],o=t[1],a=t[2],s=t[3],l=t[4];for(let d=0;d<=79;d++){d>=16&&(n[d]=e._S(1,n[d-3]^n[d-8]^n[d-14]^n[d-16]));let c=e._S(5,r)+e._f(d,o,a,s)+l+n[d]+e._key[Math.floor(d/20)]|0;l=s,s=a,a=e._S(30,o),o=r,r=c}t[0]=t[0]+r|0,t[1]=t[1]+o|0,t[2]=t[2]+a|0,t[3]=t[3]+s|0,t[4]=t[4]+l|0}};var Gm={};Gm.aes=class{constructor(i){let e=this;e._tables=[[[],[],[],[],[]],[[],[],[],[],[]]],e._tables[0][0][0]||e._precompute();let t=e._tables[0][4],n=e._tables[1],r=i.length,o,a,s,l=1;if(r!==4&&r!==6&&r!==8)throw new Error("invalid aes key size");for(e._key=[a=i.slice(0),s=[]],o=r;o<4*r+28;o++){let d=a[o-1];(o%r===0||r===8&&o%r===4)&&(d=t[d>>>24]<<24^t[d>>16&255]<<16^t[d>>8&255]<<8^t[d&255],o%r===0&&(d=d<<8^d>>>24^l<<24,l=l<<1^(l>>7)*283)),a[o]=a[o-r]^d}for(let d=0;o;d++,o--){let c=a[d&3?o:o-4];o<=4||d<4?s[d]=c:s[d]=n[0][t[c>>>24]]^n[1][t[c>>16&255]]^n[2][t[c>>8&255]]^n[3][t[c&255]]}}encrypt(i){return this._crypt(i,0)}decrypt(i){return this._crypt(i,1)}_precompute(){let i=this._tables[0],e=this._tables[1],t=i[4],n=e[4],r=[],o=[],a,s,l,d;for(let c=0;c<256;c++)o[(r[c]=c<<1^(c>>7)*283)^c]=c;for(let c=a=0;!t[c];c^=s||1,a=o[a]||1){let p=a^a<<1^a<<2^a<<3^a<<4;p=p>>8^p&255^99,t[c]=p,n[p]=c,d=r[l=r[s=r[c]]];let u=d*16843009^l*65537^s*257^c*16843008,h=r[p]*257^p*16843008;for(let f=0;f<4;f++)i[f][c]=h=h<<24^h>>>8,e[f][p]=u=u<<24^u>>>8}for(let c=0;c<5;c++)i[c]=i[c].slice(0),e[c]=e[c].slice(0)}_crypt(i,e){if(i.length!==4)throw new Error("invalid aes block size");let t=this._key[e],n=t.length/4-2,r=[0,0,0,0],o=this._tables[e],a=o[0],s=o[1],l=o[2],d=o[3],c=o[4],p=i[0]^t[0],u=i[e?3:1]^t[1],h=i[2]^t[2],f=i[e?1:3]^t[3],y=4,g,A,T;for(let b=0;b<n;b++)g=a[p>>>24]^s[u>>16&255]^l[h>>8&255]^d[f&255]^t[y],A=a[u>>>24]^s[h>>16&255]^l[f>>8&255]^d[p&255]^t[y+1],T=a[h>>>24]^s[f>>16&255]^l[p>>8&255]^d[u&255]^t[y+2],f=a[f>>>24]^s[p>>16&255]^l[u>>8&255]^d[h&255]^t[y+3],y+=4,p=g,u=A,h=T;for(let b=0;b<4;b++)r[e?3&-b:b]=c[p>>>24]<<24^c[u>>16&255]<<16^c[h>>8&255]<<8^c[f&255]^t[y++],g=p,p=u,u=h,h=f,f=g;return r}};var kS={getRandomValues(i){let e=new Uint32Array(i.buffer),t=n=>{let r=987654321,o=4294967295;return function(){return r=36969*(r&65535)+(r>>16)&o,n=18e3*(n&65535)+(n>>16)&o,(((r<<16)+n&o)/4294967296+.5)*(Math.random()>.5?1:-1)}};for(let n=0,r;n<i.length;n+=4){let o=t((r||Math.random())*4294967296);r=o()*987654071,e[n/4]=o()*4294967296|0}return i}},Hm={};Hm.ctrGladman=class{constructor(i,e){this._prf=i,this._initIv=e,this._iv=e}reset(){this._iv=this._initIv}update(i){return this.calculate(this._prf,i,this._iv)}incWord(i){if((i>>24&255)===255){let e=i>>16&255,t=i>>8&255,n=i&255;e===255?(e=0,t===255?(t=0,n===255?n=0:++n):++t):++e,i=0,i+=e<<16,i+=t<<8,i+=n}else i+=1<<24;return i}incCounter(i){(i[0]=this.incWord(i[0]))===0&&(i[1]=this.incWord(i[1]))}calculate(i,e,t){let n;if(!(n=e.length))return[];let r=Xr.bitLength(e);for(let o=0;o<n;o+=4){this.incCounter(t);let a=i.encrypt(t);e[o]^=a[0],e[o+1]^=a[1],e[o+2]^=a[2],e[o+3]^=a[3]}return Xr.clamp(e,r)}};var Xs={importKey(i){return new Xs.hmacSha1(vc.bytes.toBits(i))},pbkdf2(i,e,t,n){if(t=t||1e4,n<0||t<0)throw new Error("invalid params to pbkdf2");let r=(n>>5)+1<<2,o,a,s,l,d,c=new ArrayBuffer(r),p=new DataView(c),u=0,h=Xr;for(e=vc.bytes.toBits(e),d=1;u<(r||1);d++){for(o=a=i.encrypt(h.concat(e,[d])),s=1;s<t;s++)for(a=i.encrypt(a),l=0;l<a.length;l++)o[l]^=a[l];for(s=0;u<(r||1)&&s<o.length;s++)p.setInt32(u,o[s]),u+=4}return c.slice(0,n/8)}};Xs.hmacSha1=class{constructor(i){let e=this,t=e._hash=Um.sha1,n=[[],[]],r=t.prototype.blockSize/32;e._baseHash=[new t,new t],i.length>r&&(i=t.hash(i));for(let o=0;o<r;o++)n[0][o]=i[o]^909522486,n[1][o]=i[o]^1549556828;e._baseHash[0].update(n[0]),e._baseHash[1].update(n[1]),e._resultHash=new t(e._baseHash[0])}reset(){let i=this;i._resultHash=new i._hash(i._baseHash[0]),i._updated=!1}update(i){let e=this;e._updated=!0,e._resultHash.update(i)}digest(){let i=this,e=i._resultHash.finalize(),t=new i._hash(i._baseHash[1]).update(e).finalize();return i.reset(),t}encrypt(i){if(this._updated)throw new Error("encrypt on already updated hmac called!");return this.update(i),this.digest(i)}};var ms="Invalid pasword",Js=16,$0="raw",US={name:"PBKDF2"},eC={name:"HMAC"},tC="SHA-1",nC=Object.assign({hash:eC},US),GS=Object.assign({iterations:1e3,hash:{name:tC}},US),rC=["deriveBits"],Ec=[8,12,16],Ic=[16,24,32],Ta=10,HS=[0,0,0,0],Pu=typeof crypto<"u",zS=Pu&&typeof crypto.subtle<"u",vi=vc.bytes,WS=Gm.aes,QS=Hm.ctrGladman,KS=Xs.hmacSha1,wu=class{constructor(e,t,n){Object.assign(this,{password:e,signed:t,strength:n-1,pendingInput:new Uint8Array(0)})}async append(e){let t=this;if(t.password){let r=wo(e,0,Ec[t.strength]+2);await oC(t,r,t.password),t.password=null,t.aesCtrGladman=new QS(new WS(t.keys.key),Array.from(HS)),t.hmac=new KS(t.keys.authentication),e=wo(e,Ec[t.strength]+2)}let n=new Uint8Array(e.length-Ta-(e.length-Ta)%Js);return qS(t,e,n,0,Ta,!0)}flush(){let e=this,t=e.pendingInput,n=wo(t,0,t.length-Ta),r=wo(t,t.length-Ta),o=new Uint8Array(0);if(n.length){let s=vi.toBits(n);e.hmac.update(s);let l=e.aesCtrGladman.update(s);o=vi.fromBits(l)}let a=!0;if(e.signed){let s=wo(vi.fromBits(e.hmac.digest()),0,Ta);for(let l=0;l<Ta;l++)s[l]!=r[l]&&(a=!1)}return{valid:a,data:o}}},xu=class{constructor(e,t){Object.assign(this,{password:e,strength:t-1,pendingInput:new Uint8Array(0)})}async append(e){let t=this,n=new Uint8Array(0);t.password&&(n=await iC(t,t.password),t.password=null,t.aesCtrGladman=new QS(new WS(t.keys.key),Array.from(HS)),t.hmac=new KS(t.keys.authentication));let r=new Uint8Array(n.length+e.length-e.length%Js);return r.set(n,0),qS(t,e,r,n.length,0)}flush(){let e=this,t=new Uint8Array(0);if(e.pendingInput.length){let r=e.aesCtrGladman.update(vi.toBits(e.pendingInput));e.hmac.update(r),t=vi.fromBits(r)}let n=wo(vi.fromBits(e.hmac.digest()),0,Ta);return{data:zm(t,n),signature:n}}};function qS(i,e,t,n,r,o){let a=e.length-r;i.pendingInput.length&&(e=zm(i.pendingInput,e),t=cC(t,a-a%Js));let s;for(s=0;s<=a-Js;s+=Js){let l=vi.toBits(wo(e,s,s+Js));o&&i.hmac.update(l);let d=i.aesCtrGladman.update(l);o||i.hmac.update(d),t.set(vi.fromBits(d),s+n)}return i.pendingInput=wo(e,s),t}async function oC(i,e,t){await YS(i,t,wo(e,0,Ec[i.strength]));let n=wo(e,Ec[i.strength]),r=i.keys.passwordVerification;if(r[0]!=n[0]||r[1]!=n[1])throw new Error(ms)}async function iC(i,e){let t=aC(new Uint8Array(Ec[i.strength]));return await YS(i,e,t),zm(t,i.keys.passwordVerification)}async function YS(i,e,t){let n=km(e),r=await sC($0,n,nC,!1,rC),o=await lC(Object.assign({salt:t},GS),r,8*(Ic[i.strength]*2+2)),a=new Uint8Array(o);i.keys={key:vi.toBits(wo(a,0,Ic[i.strength])),authentication:vi.toBits(wo(a,Ic[i.strength],Ic[i.strength]*2)),passwordVerification:wo(a,Ic[i.strength]*2)}}function aC(i){return Pu&&typeof crypto.getRandomValues=="function"?crypto.getRandomValues(i):kS.getRandomValues(i)}function sC(i,e,t,n,r){return Pu&&zS&&typeof crypto.subtle.importKey=="function"?crypto.subtle.importKey(i,e,t,n,r):Xs.importKey(e)}async function lC(i,e,t){return Pu&&zS&&typeof crypto.subtle.deriveBits=="function"?await crypto.subtle.deriveBits(i,e,t):Xs.pbkdf2(e,i.salt,GS.iterations,t)}function zm(i,e){let t=i;return i.length+e.length&&(t=new Uint8Array(i.length+e.length),t.set(i,0),t.set(e,i.length)),t}function cC(i,e){if(e&&e>i.length){let t=i;i=new Uint8Array(e),i.set(t,0)}return i}function wo(i,e,t){return i.subarray(e,t)}var js=12,Fu=class{constructor(e,t){let n=this;Object.assign(n,{password:e,passwordVerification:t}),ZS(n,e)}append(e){let t=this;if(t.password){let n=XS(t,e.subarray(0,js));if(t.password=null,n[js-1]!=t.passwordVerification)throw new Error(ms);e=e.subarray(js)}return XS(t,e)}flush(){return{valid:!0,data:new Uint8Array(0)}}},Du=class{constructor(e,t){let n=this;Object.assign(n,{password:e,passwordVerification:t}),ZS(n,e)}append(e){let t=this,n,r;if(t.password){t.password=null;let o=crypto.getRandomValues(new Uint8Array(js));o[js-1]=t.passwordVerification,n=new Uint8Array(e.length+o.length),n.set(JS(t,o),0),r=js}else n=new Uint8Array(e.length),r=0;return n.set(JS(t,e),r),n}flush(){return{data:new Uint8Array(0)}}};function XS(i,e){let t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=$S(i)^e[n],Wm(i,t[n]);return t}function JS(i,e){let t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=$S(i)^e[n],Wm(i,e[n]);return t}function ZS(i,e){i.keys=[305419896,591751049,878082192],i.crcKey0=new ba(i.keys[0]),i.crcKey2=new ba(i.keys[2]);for(let t=0;t<e.length;t++)Wm(i,e.charCodeAt(t))}function Wm(i,e){i.crcKey0.append([e]),i.keys[0]=~i.crcKey0.get(),i.keys[1]=jS(i.keys[1]+ey(i.keys[0])),i.keys[1]=jS(Math.imul(i.keys[1],134775813)+1),i.crcKey2.append([i.keys[1]>>>24]),i.keys[2]=~i.crcKey2.get()}function $S(i){let e=i.keys[2]|2;return ey(Math.imul(e,e^1)>>>8)}function ey(i){return i&255}function jS(i){return i&4294967295}var qm="deflate",Lu="inflate",Cc="Invalid signature",Qm=class{constructor(e,{signature:t,password:n,signed:r,compressed:o,zipCrypto:a,passwordVerification:s,encryptionStrength:l},{chunkSize:d}){let c=!!n;Object.assign(this,{signature:t,encrypted:c,signed:r,compressed:o,inflate:o&&new e({chunkSize:d}),crc32:r&&new ba,zipCrypto:a,decrypt:c&&a?new Fu(n,s):new wu(n,r,l)})}async append(e){let t=this;return t.encrypted&&e.length&&(e=await t.decrypt.append(e)),t.compressed&&e.length&&(e=await t.inflate.append(e)),(!t.encrypted||t.zipCrypto)&&t.signed&&e.length&&t.crc32.append(e),e}async flush(){let e=this,t,n=new Uint8Array(0);if(e.encrypted){let r=e.decrypt.flush();if(!r.valid)throw new Error(Cc);n=r.data}if((!e.encrypted||e.zipCrypto)&&e.signed){let r=new DataView(new Uint8Array(4).buffer);if(t=e.crc32.get(),r.setUint32(0,t),e.signature!=r.getUint32(0,!1))throw new Error(Cc)}return e.compressed&&(n=await e.inflate.append(n)||new Uint8Array(0),await e.inflate.flush()),{data:n,signature:t}}},Km=class{constructor(e,{encrypted:t,signed:n,compressed:r,level:o,zipCrypto:a,password:s,passwordVerification:l,encryptionStrength:d},{chunkSize:c}){Object.assign(this,{encrypted:t,signed:n,compressed:r,deflate:r&&new e({level:o||5,chunkSize:c}),crc32:n&&new ba,zipCrypto:a,encrypt:t&&a?new Du(s,l):new xu(s,d)})}async append(e){let t=this,n=e;return t.compressed&&e.length&&(n=await t.deflate.append(e)),t.encrypted&&n.length&&(n=await t.encrypt.append(n)),(!t.encrypted||t.zipCrypto)&&t.signed&&e.length&&t.crc32.append(e),n}async flush(){let e=this,t,n=new Uint8Array(0);if(e.compressed&&(n=await e.deflate.flush()||new Uint8Array(0)),e.encrypted){n=await e.encrypt.append(n);let r=e.encrypt.flush();t=r.signature;let o=new Uint8Array(n.length+r.data.length);o.set(n,0),o.set(r.data,n.length),n=o}return(!e.encrypted||e.zipCrypto)&&e.signed&&(t=e.crc32.get()),{data:n,signature:t}}};function ty(i,e,t){if(e.codecType.startsWith(qm))return new Km(i,e,t);if(e.codecType.startsWith(Lu))return new Qm(i,e,t)}var ny="init",ry="append",Ym="flush",dC="message",oy=!0,Mu=(i,e,t,n,r,o,a)=>(Object.assign(i,{busy:!0,codecConstructor:e,options:Object.assign({},t),scripts:a,terminate(){i.worker&&!i.busy&&(i.worker.terminate(),i.interface=null)},onTaskFinished(){i.busy=!1,r(i)}}),o?pC(i,n):uC(i,n));function uC(i,e){let t=ty(i.codecConstructor,i.options,e);return{async append(n){try{return await t.append(n)}catch(r){throw i.onTaskFinished(),r}},async flush(){try{return await t.flush()}finally{i.onTaskFinished()}},abort(){i.onTaskFinished()}}}function pC(i,e){let t,n={type:"module"};if(!i.interface){if(!oy)i.worker=r(n,e.baseURL);else try{i.worker=r({},e.baseURL)}catch{oy=!1,i.worker=r(n,e.baseURL)}i.worker.addEventListener(dC,s,!1),i.interface={append(l){return o({type:ry,data:l})},flush(){return o({type:Ym})},abort(){i.onTaskFinished()}}}return i.interface;function r(l,d){let c,p;c=i.scripts[0],typeof c=="function"&&(c=c());try{p=new URL(c,d)}catch{p=c}return new Worker(p,l)}async function o(l){if(!t){let d=i.options,c=i.scripts.slice(1);await a({scripts:c,type:ny,options:d,config:{chunkSize:e.chunkSize}})}return a(l)}function a(l){let d=i.worker,c=new Promise((p,u)=>t={resolve:p,reject:u});try{if(l.data)try{l.data=l.data.buffer,d.postMessage(l,[l.data])}catch{d.postMessage(l)}else d.postMessage(l)}catch(p){t.reject(p),t=null,i.onTaskFinished()}return c}function s(l){let d=l.data;if(t){let c=d.error,p=d.type;if(c){let u=new Error(c.message);u.stack=c.stack,t.reject(u),t=null,i.onTaskFinished()}else if(p==ny||p==Ym||p==ry){let u=d.data;p==Ym?(t.resolve({data:new Uint8Array(u),signature:d.signature}),t=null,i.onTaskFinished()):t.resolve(u&&new Uint8Array(u))}}}}var gs=[],Xm=[];function Jm(i,e,t){let r=!(!e.compressed&&!e.signed&&!e.encrypted)&&(e.useWebWorkers||e.useWebWorkers===void 0&&t.useWebWorkers),o=r&&t.workerScripts?t.workerScripts[e.codecType]:[];if(gs.length<t.maxWorkers){let s={};return gs.push(s),Mu(s,i,e,t,a,r,o)}else{let s=gs.find(l=>!l.busy);return s?(iy(s),Mu(s,i,e,t,a,r,o)):new Promise(l=>Xm.push({resolve:l,codecConstructor:i,options:e,webWorker:r,scripts:o}))}function a(s){if(Xm.length){let[{resolve:l,codecConstructor:d,options:c,webWorker:p,scripts:u}]=Xm.splice(0,1);l(Mu(s,d,c,t,a,p,u))}else s.worker?(iy(s),Number.isFinite(t.terminateWorkerTimeout)&&t.terminateWorkerTimeout>=0&&(s.terminateTimeout=setTimeout(()=>{gs=gs.filter(l=>l!=s),s.terminate()},t.terminateWorkerTimeout))):gs=gs.filter(l=>l!=s)}}function iy(i){i.terminateTimeout&&(clearTimeout(i.terminateTimeout),i.terminateTimeout=null)}var ay=i=>{if(typeof URL.createObjectURL=="function"){let e=()=>URL.createObjectURL(new Blob([`const{Array:t,Object:e,Math:n,Error:r,Uint8Array:i,Uint16Array:o,Uint32Array:s,Int32Array:f,DataView:c,TextEncoder:l,crypto:u,postMessage:a}=globalThis,w=[];for(let t=0;256>t;t++){let e=t;for(let t=0;8>t;t++)1&e?e=e>>>1^3988292384:e>>>=1;w[t]=e}class h{constructor(t){this.t=t||-1}append(t){let e=0|this.t;for(let n=0,r=0|t.length;r>n;n++)e=e>>>8^w[255&(e^t[n])];this.t=e}get(){return~this.t}}const d={concat(t,e){if(0===t.length||0===e.length)return t.concat(e);const n=t[t.length-1],r=d.i(n);return 32===r?t.concat(e):d.o(e,r,0|n,t.slice(0,t.length-1))},l(t){const e=t.length;if(0===e)return 0;const n=t[e-1];return 32*(e-1)+d.i(n)},u(t,e){if(32*t.length<e)return t;const r=(t=t.slice(0,n.ceil(e/32))).length;return e&=31,r>0&&e&&(t[r-1]=d.h(e,t[r-1]&2147483648>>e-1,1)),t},h:(t,e,n)=>32===t?e:(n?0|e:e<<32-t)+1099511627776*t,i:t=>n.round(t/1099511627776)||32,o(t,e,n,r){for(void 0===r&&(r=[]);e>=32;e-=32)r.push(n),n=0;if(0===e)return r.concat(t);for(let i=0;i<t.length;i++)r.push(n|t[i]>>>e),n=t[i]<<32-e;const i=t.length?t[t.length-1]:0,o=d.i(i);return r.push(d.h(e+o&31,e+o>32?n:r.pop(),1)),r}},p={p:{k(t){const e=d.l(t)/8,n=new i(e);let r;for(let i=0;e>i;i++)0==(3&i)&&(r=t[i/4]),n[i]=r>>>24,r<<=8;return n},g(t){const e=[];let n,r=0;for(n=0;n<t.length;n++)r=r<<8|t[n],3==(3&n)&&(e.push(r),r=0);return 3&n&&e.push(d.h(8*(3&n),r)),e}}},y={v:function(t){t?(this.m=t.m.slice(0),this.S=t.S.slice(0),this._=t._):this.reset()}};y.v.prototype={blockSize:512,reset:function(){const t=this;return t.m=this.I.slice(0),t.S=[],t._=0,t},update:function(t){const e=this;"string"==typeof t&&(t=p.A.g(t));const n=e.S=d.concat(e.S,t),i=e._,o=e._=i+d.l(t);if(o>9007199254740991)throw new r("Cannot hash more than 2^53 - 1 bits");const f=new s(n);let c=0;for(let t=e.blockSize+i-(e.blockSize+i&e.blockSize-1);o>=t;t+=e.blockSize)e.C(f.subarray(16*c,16*(c+1))),c+=1;return n.splice(0,16*c),e},V:function(){const t=this;let e=t.S;const r=t.m;e=d.concat(e,[d.h(1,1)]);for(let t=e.length+2;15&t;t++)e.push(0);for(e.push(n.floor(t._/4294967296)),e.push(0|t._);e.length;)t.C(e.splice(0,16));return t.reset(),r},I:[1732584193,4023233417,2562383102,271733878,3285377520],B:[1518500249,1859775393,2400959708,3395469782],D:(t,e,n,r)=>t>19?t>39?t>59?t>79?void 0:e^n^r:e&n|e&r|n&r:e^n^r:e&n|~e&r,U:(t,e)=>e<<t|e>>>32-t,C:function(e){const r=this,i=r.m,o=t(80);for(let t=0;16>t;t++)o[t]=e[t];let s=i[0],f=i[1],c=i[2],l=i[3],u=i[4];for(let t=0;79>=t;t++){16>t||(o[t]=r.U(1,o[t-3]^o[t-8]^o[t-14]^o[t-16]));const e=r.U(5,s)+r.D(t,f,c,l)+u+o[t]+r.B[n.floor(t/20)]|0;u=l,l=c,c=r.U(30,f),f=s,s=e}i[0]=i[0]+s|0,i[1]=i[1]+f|0,i[2]=i[2]+c|0,i[3]=i[3]+l|0,i[4]=i[4]+u|0}};const b={getRandomValues(t){const e=new s(t.buffer),r=t=>{let e=987654321;const r=4294967295;return()=>(e=36969*(65535&e)+(e>>16)&r,(((e<<16)+(t=18e3*(65535&t)+(t>>16)&r)&r)/4294967296+.5)*(n.random()>.5?1:-1))};for(let i,o=0;o<t.length;o+=4){const t=r(4294967296*(i||n.random()));i=987654071*t(),e[o/4]=4294967296*t()|0}return t}},k={importKey:t=>new k.M(p.p.g(t)),P(t,e,n,i){if(n=n||1e4,0>i||0>n)throw new r("invalid params to pbkdf2");const o=1+(i>>5)<<2;let s,f,l,u,a;const w=new ArrayBuffer(o),h=new c(w);let y=0;const b=d;for(e=p.p.g(e),a=1;(o||1)>y;a++){for(s=f=t.encrypt(b.concat(e,[a])),l=1;n>l;l++)for(f=t.encrypt(f),u=0;u<f.length;u++)s[u]^=f[u];for(l=0;(o||1)>y&&l<s.length;l++)h.setInt32(y,s[l]),y+=4}return w.slice(0,i/8)},M:class{constructor(t){const e=this,n=e.R=y.v,r=[[],[]],i=n.prototype.blockSize/32;e.H=[new n,new n],t.length>i&&(t=n.hash(t));for(let e=0;i>e;e++)r[0][e]=909522486^t[e],r[1][e]=1549556828^t[e];e.H[0].update(r[0]),e.H[1].update(r[1]),e.K=new n(e.H[0])}reset(){const t=this;t.K=new t.R(t.H[0]),t.L=!1}update(t){this.L=!0,this.K.update(t)}digest(){const t=this,e=t.K.V(),n=new t.R(t.H[1]).update(e).V();return t.reset(),n}encrypt(t){if(this.L)throw new r("encrypt on already updated hmac called!");return this.update(t),this.digest(t)}}},g={name:"PBKDF2"},v=e.assign({hash:{name:"HMAC"}},g),m=e.assign({iterations:1e3,hash:{name:"SHA-1"}},g),S=["deriveBits"],z=[8,12,16],_=[16,24,32],I=[0,0,0,0],A=void 0!==u,C=A&&void 0!==u.subtle,V=p.p,B=class{constructor(t){const e=this;e.T=[[[],[],[],[],[]],[[],[],[],[],[]]],e.T[0][0][0]||e.j();const n=e.T[0][4],i=e.T[1],o=t.length;let s,f,c,l=1;if(4!==o&&6!==o&&8!==o)throw new r("invalid aes key size");for(e.B=[f=t.slice(0),c=[]],s=o;4*o+28>s;s++){let t=f[s-1];(s%o==0||8===o&&s%o==4)&&(t=n[t>>>24]<<24^n[t>>16&255]<<16^n[t>>8&255]<<8^n[255&t],s%o==0&&(t=t<<8^t>>>24^l<<24,l=l<<1^283*(l>>7))),f[s]=f[s-o]^t}for(let t=0;s;t++,s--){const e=f[3&t?s:s-4];c[t]=4>=s||4>t?e:i[0][n[e>>>24]]^i[1][n[e>>16&255]]^i[2][n[e>>8&255]]^i[3][n[255&e]]}}encrypt(t){return this.F(t,0)}decrypt(t){return this.F(t,1)}j(){const t=this.T[0],e=this.T[1],n=t[4],r=e[4],i=[],o=[];let s,f,c,l;for(let t=0;256>t;t++)o[(i[t]=t<<1^283*(t>>7))^t]=t;for(let u=s=0;!n[u];u^=f||1,s=o[s]||1){let o=s^s<<1^s<<2^s<<3^s<<4;o=o>>8^255&o^99,n[u]=o,r[o]=u,l=i[c=i[f=i[u]]];let a=16843009*l^65537*c^257*f^16843008*u,w=257*i[o]^16843008*o;for(let n=0;4>n;n++)t[n][u]=w=w<<24^w>>>8,e[n][o]=a=a<<24^a>>>8}for(let n=0;5>n;n++)t[n]=t[n].slice(0),e[n]=e[n].slice(0)}F(t,e){if(4!==t.length)throw new r("invalid aes block size");const n=this.B[e],i=n.length/4-2,o=[0,0,0,0],s=this.T[e],f=s[0],c=s[1],l=s[2],u=s[3],a=s[4];let w,h,d,p=t[0]^n[0],y=t[e?3:1]^n[1],b=t[2]^n[2],k=t[e?1:3]^n[3],g=4;for(let t=0;i>t;t++)w=f[p>>>24]^c[y>>16&255]^l[b>>8&255]^u[255&k]^n[g],h=f[y>>>24]^c[b>>16&255]^l[k>>8&255]^u[255&p]^n[g+1],d=f[b>>>24]^c[k>>16&255]^l[p>>8&255]^u[255&y]^n[g+2],k=f[k>>>24]^c[p>>16&255]^l[y>>8&255]^u[255&b]^n[g+3],g+=4,p=w,y=h,b=d;for(let t=0;4>t;t++)o[e?3&-t:t]=a[p>>>24]<<24^a[y>>16&255]<<16^a[b>>8&255]<<8^a[255&k]^n[g++],w=p,p=y,y=b,b=k,k=w;return o}},E=class{constructor(t,e){this.O=t,this.W=e,this.q=e}reset(){this.q=this.W}update(t){return this.G(this.O,t,this.q)}J(t){if(255==(t>>24&255)){let e=t>>16&255,n=t>>8&255,r=255&t;255===e?(e=0,255===n?(n=0,255===r?r=0:++r):++n):++e,t=0,t+=e<<16,t+=n<<8,t+=r}else t+=1<<24;return t}N(t){0===(t[0]=this.J(t[0]))&&(t[1]=this.J(t[1]))}G(t,e,n){let r;if(!(r=e.length))return[];const i=d.l(e);for(let i=0;r>i;i+=4){this.N(n);const r=t.encrypt(n);e[i]^=r[0],e[i+1]^=r[1],e[i+2]^=r[2],e[i+3]^=r[3]}return d.u(e,i)}},D=k.M;class U{constructor(t,n,r){e.assign(this,{password:t,signed:n,X:r-1,Y:new i(0)})}async append(e){const n=this;if(n.password){const i=K(e,0,z[n.X]+2);await(async(t,e,n)=>{await R(t,n,K(e,0,z[t.X]));const i=K(e,z[t.X]),o=t.keys.passwordVerification;if(o[0]!=i[0]||o[1]!=i[1])throw new r("Invalid pasword")})(n,i,n.password),n.password=null,n.Z=new E(new B(n.keys.key),t.from(I)),n.$=new D(n.keys.tt),e=K(e,z[n.X]+2)}return P(n,e,new i(e.length-10-(e.length-10)%16),0,10,!0)}flush(){const t=this,e=t.Y,n=K(e,0,e.length-10),r=K(e,e.length-10);let o=new i(0);if(n.length){const e=V.g(n);t.$.update(e);const r=t.Z.update(e);o=V.k(r)}let s=!0;if(t.signed){const e=K(V.k(t.$.digest()),0,10);for(let t=0;10>t;t++)e[t]!=r[t]&&(s=!1)}return{valid:s,data:o}}}class M{constructor(t,n){e.assign(this,{password:t,X:n-1,Y:new i(0)})}async append(e){const n=this;let r=new i(0);n.password&&(r=await(async(t,e)=>{const n=(r=new i(z[t.X]),A&&"function"==typeof u.getRandomValues?u.getRandomValues(r):b.getRandomValues(r));var r;return await R(t,e,n),H(n,t.keys.passwordVerification)})(n,n.password),n.password=null,n.Z=new E(new B(n.keys.key),t.from(I)),n.$=new D(n.keys.tt));const o=new i(r.length+e.length-e.length%16);return o.set(r,0),P(n,e,o,r.length,0)}flush(){const t=this;let e=new i(0);if(t.Y.length){const n=t.Z.update(V.g(t.Y));t.$.update(n),e=V.k(n)}const n=K(V.k(t.$.digest()),0,10);return{data:H(e,n),signature:n}}}function P(t,e,n,r,o,s){const f=e.length-o;let c;for(t.Y.length&&(e=H(t.Y,e),n=((t,e)=>{if(e&&e>t.length){const n=t;(t=new i(e)).set(n,0)}return t})(n,f-f%16)),c=0;f-16>=c;c+=16){const i=V.g(K(e,c,c+16));s&&t.$.update(i);const o=t.Z.update(i);s||t.$.update(o),n.set(V.k(o),c+r)}return t.Y=K(e,c),n}async function R(t,n,r){const o=(t=>{if(void 0===l){const e=new i((t=unescape(encodeURIComponent(t))).length);for(let n=0;n<e.length;n++)e[n]=t.charCodeAt(n);return e}return(new l).encode(t)})(n),s=await((t,e,n,r,i)=>A&&C&&"function"==typeof u.subtle.importKey?u.subtle.importKey("raw",e,n,!1,i):k.importKey(e))(0,o,v,0,S),f=await(async(t,e,n)=>A&&C&&"function"==typeof u.subtle.deriveBits?await u.subtle.deriveBits(t,e,n):k.P(e,t.salt,m.iterations,n))(e.assign({salt:r},m),s,8*(2*_[t.X]+2)),c=new i(f);t.keys={key:V.g(K(c,0,_[t.X])),tt:V.g(K(c,_[t.X],2*_[t.X])),passwordVerification:K(c,2*_[t.X])}}function H(t,e){let n=t;return t.length+e.length&&(n=new i(t.length+e.length),n.set(t,0),n.set(e,t.length)),n}function K(t,e,n){return t.subarray(e,n)}class L{constructor(t,n){e.assign(this,{password:t,passwordVerification:n}),F(this,t)}append(t){const e=this;if(e.password){const n=j(e,t.subarray(0,12));if(e.password=null,n[11]!=e.passwordVerification)throw new r("Invalid pasword");t=t.subarray(12)}return j(e,t)}flush(){return{valid:!0,data:new i(0)}}}class T{constructor(t,n){e.assign(this,{password:t,passwordVerification:n}),F(this,t)}append(t){const e=this;let n,r;if(e.password){e.password=null;const o=u.getRandomValues(new i(12));o[11]=e.passwordVerification,n=new i(t.length+o.length),n.set(x(e,o),0),r=12}else n=new i(t.length),r=0;return n.set(x(e,t),r),n}flush(){return{data:new i(0)}}}function j(t,e){const n=new i(e.length);for(let r=0;r<e.length;r++)n[r]=W(t)^e[r],O(t,n[r]);return n}function x(t,e){const n=new i(e.length);for(let r=0;r<e.length;r++)n[r]=W(t)^e[r],O(t,e[r]);return n}function F(t,e){t.keys=[305419896,591751049,878082192],t.et=new h(t.keys[0]),t.nt=new h(t.keys[2]);for(let n=0;n<e.length;n++)O(t,e.charCodeAt(n))}function O(t,e){t.et.append([e]),t.keys[0]=~t.et.get(),t.keys[1]=G(t.keys[1]+q(t.keys[0])),t.keys[1]=G(n.imul(t.keys[1],134775813)+1),t.nt.append([t.keys[1]>>>24]),t.keys[2]=~t.nt.get()}function W(t){const e=2|t.keys[2];return q(n.imul(e,1^e)>>>8)}function q(t){return 255&t}function G(t){return 4294967295&t}class J{constructor(t,{signature:n,password:r,signed:i,compressed:o,zipCrypto:s,passwordVerification:f,encryptionStrength:c},{rt:l}){const u=!!r;e.assign(this,{signature:n,encrypted:u,signed:i,compressed:o,it:o&&new t({rt:l}),ot:i&&new h,zipCrypto:s,decrypt:u&&s?new L(r,f):new U(r,i,c)})}async append(t){const e=this;return e.encrypted&&t.length&&(t=await e.decrypt.append(t)),e.compressed&&t.length&&(t=await e.it.append(t)),(!e.encrypted||e.zipCrypto)&&e.signed&&t.length&&e.ot.append(t),t}async flush(){const t=this;let e,n=new i(0);if(t.encrypted){const e=t.decrypt.flush();if(!e.valid)throw new r("Invalid signature");n=e.data}if((!t.encrypted||t.zipCrypto)&&t.signed){const n=new c(new i(4).buffer);if(e=t.ot.get(),n.setUint32(0,e),t.signature!=n.getUint32(0,!1))throw new r("Invalid signature")}return t.compressed&&(n=await t.it.append(n)||new i(0),await t.it.flush()),{data:n,signature:e}}}class N{constructor(t,{encrypted:n,signed:r,compressed:i,level:o,zipCrypto:s,password:f,passwordVerification:c,encryptionStrength:l},{rt:u}){e.assign(this,{encrypted:n,signed:r,compressed:i,st:i&&new t({level:o||5,rt:u}),ot:r&&new h,zipCrypto:s,encrypt:n&&s?new T(f,c):new M(f,l)})}async append(t){const e=this;let n=t;return e.compressed&&t.length&&(n=await e.st.append(t)),e.encrypted&&n.length&&(n=await e.encrypt.append(n)),(!e.encrypted||e.zipCrypto)&&e.signed&&t.length&&e.ot.append(t),n}async flush(){const t=this;let e,n=new i(0);if(t.compressed&&(n=await t.st.flush()||new i(0)),t.encrypted){n=await t.encrypt.append(n);const r=t.encrypt.flush();e=r.signature;const o=new i(n.length+r.data.length);o.set(n,0),o.set(r.data,n.length),n=o}return t.encrypted&&!t.zipCrypto||!t.signed||(e=t.ot.get()),{data:n,signature:e}}}const Q={init(t){t.scripts&&t.scripts.length&&importScripts.apply(void 0,t.scripts);const e=t.options;let n;self.initCodec&&self.initCodec(),e.codecType.startsWith("deflate")?n=self.Deflate:e.codecType.startsWith("inflate")&&(n=self.Inflate),X=((t,e,n)=>e.codecType.startsWith("deflate")?new N(t,e,n):e.codecType.startsWith("inflate")?new J(t,e,n):void 0)(n,e,t.config)},append:async t=>({data:await X.append(t.data)}),flush:()=>X.flush()};let X;function Y(e){return Z(e.map((([e,n])=>new t(e).fill(n,0,e))))}function Z(e){return e.reduce(((e,n)=>e.concat(t.isArray(n)?Z(n):n)),[])}addEventListener("message",(async t=>{const e=t.data,n=e.type,r=Q[n];if(r)try{e.data&&(e.data=new i(e.data));const t=await r(e)||{};if(t.type=n,t.data)try{t.data=t.data.buffer,a(t,[t.data])}catch(e){a(t)}else a(t)}catch(t){a({type:n,error:{message:t.message,stack:t.stack}})}}));const $=[0,1,2,3].concat(...Y([[2,4],[2,5],[4,6],[4,7],[8,8],[8,9],[16,10],[16,11],[32,12],[32,13],[64,14],[64,15],[2,0],[1,16],[1,17],[2,18],[2,19],[4,20],[4,21],[8,22],[8,23],[16,24],[16,25],[32,26],[32,27],[64,28],[64,29]]));function tt(){const t=this;function e(t,e){let n=0;do{n|=1&t,t>>>=1,n<<=1}while(--e>0);return n>>>1}t.ft=r=>{const i=t.ct,o=t.ut.lt,s=t.ut.wt;let f,c,l,u=-1;for(r.ht=0,r.dt=573,f=0;s>f;f++)0!==i[2*f]?(r.yt[++r.ht]=u=f,r.bt[f]=0):i[2*f+1]=0;for(;2>r.ht;)l=r.yt[++r.ht]=2>u?++u:0,i[2*l]=1,r.bt[l]=0,r.kt--,o&&(r.gt-=o[2*l+1]);for(t.vt=u,f=n.floor(r.ht/2);f>=1;f--)r.St(i,f);l=s;do{f=r.yt[1],r.yt[1]=r.yt[r.ht--],r.St(i,1),c=r.yt[1],r.yt[--r.dt]=f,r.yt[--r.dt]=c,i[2*l]=i[2*f]+i[2*c],r.bt[l]=n.max(r.bt[f],r.bt[c])+1,i[2*f+1]=i[2*c+1]=l,r.yt[1]=l++,r.St(i,1)}while(r.ht>=2);r.yt[--r.dt]=r.yt[1],(e=>{const n=t.ct,r=t.ut.lt,i=t.ut.zt,o=t.ut._t,s=t.ut.It;let f,c,l,u,a,w,h=0;for(u=0;15>=u;u++)e.At[u]=0;for(n[2*e.yt[e.dt]+1]=0,f=e.dt+1;573>f;f++)c=e.yt[f],u=n[2*n[2*c+1]+1]+1,u>s&&(u=s,h++),n[2*c+1]=u,c>t.vt||(e.At[u]++,a=0,o>c||(a=i[c-o]),w=n[2*c],e.kt+=w*(u+a),r&&(e.gt+=w*(r[2*c+1]+a)));if(0!==h){do{for(u=s-1;0===e.At[u];)u--;e.At[u]--,e.At[u+1]+=2,e.At[s]--,h-=2}while(h>0);for(u=s;0!==u;u--)for(c=e.At[u];0!==c;)l=e.yt[--f],l>t.vt||(n[2*l+1]!=u&&(e.kt+=(u-n[2*l+1])*n[2*l],n[2*l+1]=u),c--)}})(r),((t,n,r)=>{const i=[];let o,s,f,c=0;for(o=1;15>=o;o++)i[o]=c=c+r[o-1]<<1;for(s=0;n>=s;s++)f=t[2*s+1],0!==f&&(t[2*s]=e(i[f]++,f))})(i,t.vt,r.At)}}function et(t,e,n,r,i){const o=this;o.lt=t,o.zt=e,o._t=n,o.wt=r,o.It=i}tt.Ct=[0,1,2,3,4,5,6,7].concat(...Y([[2,8],[2,9],[2,10],[2,11],[4,12],[4,13],[4,14],[4,15],[8,16],[8,17],[8,18],[8,19],[16,20],[16,21],[16,22],[16,23],[32,24],[32,25],[32,26],[31,27],[1,28]])),tt.Vt=[0,1,2,3,4,5,6,7,8,10,12,14,16,20,24,28,32,40,48,56,64,80,96,112,128,160,192,224,0],tt.Bt=[0,1,2,3,4,6,8,12,16,24,32,48,64,96,128,192,256,384,512,768,1024,1536,2048,3072,4096,6144,8192,12288,16384,24576],tt.Et=t=>256>t?$[t]:$[256+(t>>>7)],tt.Dt=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],tt.Ut=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],tt.Mt=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],tt.Pt=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];const nt=Y([[144,8],[112,9],[24,7],[8,8]]);et.Rt=Z([12,140,76,204,44,172,108,236,28,156,92,220,60,188,124,252,2,130,66,194,34,162,98,226,18,146,82,210,50,178,114,242,10,138,74,202,42,170,106,234,26,154,90,218,58,186,122,250,6,134,70,198,38,166,102,230,22,150,86,214,54,182,118,246,14,142,78,206,46,174,110,238,30,158,94,222,62,190,126,254,1,129,65,193,33,161,97,225,17,145,81,209,49,177,113,241,9,137,73,201,41,169,105,233,25,153,89,217,57,185,121,249,5,133,69,197,37,165,101,229,21,149,85,213,53,181,117,245,13,141,77,205,45,173,109,237,29,157,93,221,61,189,125,253,19,275,147,403,83,339,211,467,51,307,179,435,115,371,243,499,11,267,139,395,75,331,203,459,43,299,171,427,107,363,235,491,27,283,155,411,91,347,219,475,59,315,187,443,123,379,251,507,7,263,135,391,71,327,199,455,39,295,167,423,103,359,231,487,23,279,151,407,87,343,215,471,55,311,183,439,119,375,247,503,15,271,143,399,79,335,207,463,47,303,175,431,111,367,239,495,31,287,159,415,95,351,223,479,63,319,191,447,127,383,255,511,0,64,32,96,16,80,48,112,8,72,40,104,24,88,56,120,4,68,36,100,20,84,52,116,3,131,67,195,35,163,99,227].map(((t,e)=>[t,nt[e]])));const rt=Y([[30,5]]);function it(t,e,n,r,i){const o=this;o.Ht=t,o.Kt=e,o.Lt=n,o.Tt=r,o.jt=i}et.xt=Z([0,16,8,24,4,20,12,28,2,18,10,26,6,22,14,30,1,17,9,25,5,21,13,29,3,19,11,27,7,23].map(((t,e)=>[t,rt[e]]))),et.Ft=new et(et.Rt,tt.Dt,257,286,15),et.Ot=new et(et.xt,tt.Ut,0,30,15),et.Wt=new et(null,tt.Mt,0,19,7);const ot=[new it(0,0,0,0,0),new it(4,4,8,4,1),new it(4,5,16,8,1),new it(4,6,32,32,1),new it(4,4,16,16,2),new it(8,16,32,32,2),new it(8,16,128,128,2),new it(8,32,128,256,2),new it(32,128,258,1024,2),new it(32,258,258,4096,2)],st=["need dictionary","stream end","","","stream error","data error","","buffer error","",""];function ft(t,e,n,r){const i=t[2*e],o=t[2*n];return o>i||i==o&&r[e]<=r[n]}function ct(){const t=this;let e,r,s,f,c,l,u,a,w,h,d,p,y,b,k,g,v,m,S,z,_,I,A,C,V,B,E,D,U,M,P,R,H;const K=new tt,L=new tt,T=new tt;let j,x,F,O,W,q;function G(){let e;for(e=0;286>e;e++)P[2*e]=0;for(e=0;30>e;e++)R[2*e]=0;for(e=0;19>e;e++)H[2*e]=0;P[512]=1,t.kt=t.gt=0,x=F=0}function J(t,e){let n,r=-1,i=t[1],o=0,s=7,f=4;0===i&&(s=138,f=3),t[2*(e+1)+1]=65535;for(let c=0;e>=c;c++)n=i,i=t[2*(c+1)+1],++o<s&&n==i||(f>o?H[2*n]+=o:0!==n?(n!=r&&H[2*n]++,H[32]++):o>10?H[36]++:H[34]++,o=0,r=n,0===i?(s=138,f=3):n==i?(s=6,f=3):(s=7,f=4))}function N(e){t.qt[t.pending++]=e}function Q(t){N(255&t),N(t>>>8&255)}function X(t,e){let n;const r=e;q>16-r?(n=t,W|=n<<q&65535,Q(W),W=n>>>16-q,q+=r-16):(W|=t<<q&65535,q+=r)}function Y(t,e){const n=2*t;X(65535&e[n],65535&e[n+1])}function Z(t,e){let n,r,i=-1,o=t[1],s=0,f=7,c=4;for(0===o&&(f=138,c=3),n=0;e>=n;n++)if(r=o,o=t[2*(n+1)+1],++s>=f||r!=o){if(c>s)do{Y(r,H)}while(0!=--s);else 0!==r?(r!=i&&(Y(r,H),s--),Y(16,H),X(s-3,2)):s>10?(Y(18,H),X(s-11,7)):(Y(17,H),X(s-3,3));s=0,i=r,0===o?(f=138,c=3):r==o?(f=6,c=3):(f=7,c=4)}}function $(){16==q?(Q(W),W=0,q=0):8>q||(N(255&W),W>>>=8,q-=8)}function nt(e,r){let i,o,s;if(t.Gt[x]=e,t.Jt[x]=255&r,x++,0===e?P[2*r]++:(F++,e--,P[2*(tt.Ct[r]+256+1)]++,R[2*tt.Et(e)]++),0==(8191&x)&&E>2){for(i=8*x,o=_-v,s=0;30>s;s++)i+=R[2*s]*(5+tt.Ut[s]);if(i>>>=3,F<n.floor(x/2)&&i<n.floor(o/2))return!0}return x==j-1}function rt(e,n){let r,i,o,s,f=0;if(0!==x)do{r=t.Gt[f],i=t.Jt[f],f++,0===r?Y(i,e):(o=tt.Ct[i],Y(o+256+1,e),s=tt.Dt[o],0!==s&&(i-=tt.Vt[o],X(i,s)),r--,o=tt.Et(r),Y(o,n),s=tt.Ut[o],0!==s&&(r-=tt.Bt[o],X(r,s)))}while(x>f);Y(256,e),O=e[513]}function it(){q>8?Q(W):q>0&&N(255&W),W=0,q=0}function ct(e,n,r){X(0+(r?1:0),3),((e,n)=>{it(),O=8,Q(n),Q(~n),t.qt.set(a.subarray(e,e+n),t.pending),t.pending+=n})(e,n)}function lt(n){((e,n,r)=>{let i,o,s=0;E>0?(K.ft(t),L.ft(t),s=(()=>{let e;for(J(P,K.vt),J(R,L.vt),T.ft(t),e=18;e>=3&&0===H[2*tt.Pt[e]+1];e--);return t.kt+=14+3*(e+1),e})(),i=t.kt+3+7>>>3,o=t.gt+3+7>>>3,o>i||(i=o)):i=o=n+5,n+4>i||-1==e?o==i?(X(2+(r?1:0),3),rt(et.Rt,et.xt)):(X(4+(r?1:0),3),((t,e,n)=>{let r;for(X(t-257,5),X(e-1,5),X(n-4,4),r=0;n>r;r++)X(H[2*tt.Pt[r]+1],3);Z(P,t-1),Z(R,e-1)})(K.vt+1,L.vt+1,s+1),rt(P,R)):ct(e,n,r),G(),r&&it()})(0>v?-1:v,_-v,n),v=_,e.Nt()}function ut(){let t,n,r,i;do{if(i=w-A-_,0===i&&0===_&&0===A)i=c;else if(-1==i)i--;else if(_>=c+c-262){a.set(a.subarray(c,c+c),0),I-=c,_-=c,v-=c,t=y,r=t;do{n=65535&d[--r],d[r]=c>n?0:n-c}while(0!=--t);t=c,r=t;do{n=65535&h[--r],h[r]=c>n?0:n-c}while(0!=--t);i+=c}if(0===e.Qt)return;t=e.Xt(a,_+A,i),A+=t,3>A||(p=255&a[_],p=(p<<g^255&a[_+1])&k)}while(262>A&&0!==e.Qt)}function at(t){let e,n,r=V,i=_,o=C;const s=_>c-262?_-(c-262):0;let f=M;const l=u,w=_+258;let d=a[i+o-1],p=a[i+o];U>C||(r>>=2),f>A&&(f=A);do{if(e=t,a[e+o]==p&&a[e+o-1]==d&&a[e]==a[i]&&a[++e]==a[i+1]){i+=2,e++;do{}while(a[++i]==a[++e]&&a[++i]==a[++e]&&a[++i]==a[++e]&&a[++i]==a[++e]&&a[++i]==a[++e]&&a[++i]==a[++e]&&a[++i]==a[++e]&&a[++i]==a[++e]&&w>i);if(n=258-(w-i),i=w-258,n>o){if(I=t,o=n,n>=f)break;d=a[i+o-1],p=a[i+o]}}}while((t=65535&h[t&l])>s&&0!=--r);return o>A?A:o}t.bt=[],t.At=[],t.yt=[],P=[],R=[],H=[],t.St=(e,n)=>{const r=t.yt,i=r[n];let o=n<<1;for(;o<=t.ht&&(o<t.ht&&ft(e,r[o+1],r[o],t.bt)&&o++,!ft(e,i,r[o],t.bt));)r[n]=r[o],n=o,o<<=1;r[n]=i},t.Yt=(e,S,I,x,F,J)=>(x||(x=8),F||(F=8),J||(J=0),e.Zt=null,-1==S&&(S=6),1>F||F>9||8!=x||9>I||I>15||0>S||S>9||0>J||J>2?-2:(e.$t=t,l=I,c=1<<l,u=c-1,b=F+7,y=1<<b,k=y-1,g=n.floor((b+3-1)/3),a=new i(2*c),h=[],d=[],j=1<<F+6,t.qt=new i(4*j),s=4*j,t.Gt=new o(j),t.Jt=new i(j),E=S,D=J,(e=>(e.te=e.ee=0,e.Zt=null,t.pending=0,t.ne=0,r=113,f=0,K.ct=P,K.ut=et.Ft,L.ct=R,L.ut=et.Ot,T.ct=H,T.ut=et.Wt,W=0,q=0,O=8,G(),(()=>{w=2*c,d[y-1]=0;for(let t=0;y-1>t;t++)d[t]=0;B=ot[E].Kt,U=ot[E].Ht,M=ot[E].Lt,V=ot[E].Tt,_=0,v=0,A=0,m=C=2,z=0,p=0})(),0))(e))),t.re=()=>42!=r&&113!=r&&666!=r?-2:(t.Jt=null,t.Gt=null,t.qt=null,d=null,h=null,a=null,t.$t=null,113==r?-3:0),t.ie=(t,e,n)=>{let r=0;return-1==e&&(e=6),0>e||e>9||0>n||n>2?-2:(ot[E].jt!=ot[e].jt&&0!==t.te&&(r=t.st(1)),E!=e&&(E=e,B=ot[E].Kt,U=ot[E].Ht,M=ot[E].Lt,V=ot[E].Tt),D=n,r)},t.oe=(t,e,n)=>{let i,o=n,s=0;if(!e||42!=r)return-2;if(3>o)return 0;for(o>c-262&&(o=c-262,s=n-o),a.set(e.subarray(s,s+o),0),_=o,v=o,p=255&a[0],p=(p<<g^255&a[1])&k,i=0;o-3>=i;i++)p=(p<<g^255&a[i+2])&k,h[i&u]=d[p],d[p]=i;return 0},t.st=(n,i)=>{let o,w,b,V,U;if(i>4||0>i)return-2;if(!n.se||!n.fe&&0!==n.Qt||666==r&&4!=i)return n.Zt=st[4],-2;if(0===n.ce)return n.Zt=st[7],-5;var M;if(e=n,V=f,f=i,42==r&&(w=8+(l-8<<4)<<8,b=(E-1&255)>>1,b>3&&(b=3),w|=b<<6,0!==_&&(w|=32),w+=31-w%31,r=113,N((M=w)>>8&255),N(255&M)),0!==t.pending){if(e.Nt(),0===e.ce)return f=-1,0}else if(0===e.Qt&&V>=i&&4!=i)return e.Zt=st[7],-5;if(666==r&&0!==e.Qt)return n.Zt=st[7],-5;if(0!==e.Qt||0!==A||0!=i&&666!=r){switch(U=-1,ot[E].jt){case 0:U=(t=>{let n,r=65535;for(r>s-5&&(r=s-5);;){if(1>=A){if(ut(),0===A&&0==t)return 0;if(0===A)break}if(_+=A,A=0,n=v+r,(0===_||_>=n)&&(A=_-n,_=n,lt(!1),0===e.ce))return 0;if(_-v>=c-262&&(lt(!1),0===e.ce))return 0}return lt(4==t),0===e.ce?4==t?2:0:4==t?3:1})(i);break;case 1:U=(t=>{let n,r=0;for(;;){if(262>A){if(ut(),262>A&&0==t)return 0;if(0===A)break}if(3>A||(p=(p<<g^255&a[_+2])&k,r=65535&d[p],h[_&u]=d[p],d[p]=_),0===r||(_-r&65535)>c-262||2!=D&&(m=at(r)),3>m)n=nt(0,255&a[_]),A--,_++;else if(n=nt(_-I,m-3),A-=m,m>B||3>A)_+=m,m=0,p=255&a[_],p=(p<<g^255&a[_+1])&k;else{m--;do{_++,p=(p<<g^255&a[_+2])&k,r=65535&d[p],h[_&u]=d[p],d[p]=_}while(0!=--m);_++}if(n&&(lt(!1),0===e.ce))return 0}return lt(4==t),0===e.ce?4==t?2:0:4==t?3:1})(i);break;case 2:U=(t=>{let n,r,i=0;for(;;){if(262>A){if(ut(),262>A&&0==t)return 0;if(0===A)break}if(3>A||(p=(p<<g^255&a[_+2])&k,i=65535&d[p],h[_&u]=d[p],d[p]=_),C=m,S=I,m=2,0!==i&&B>C&&c-262>=(_-i&65535)&&(2!=D&&(m=at(i)),5>=m&&(1==D||3==m&&_-I>4096)&&(m=2)),3>C||m>C)if(0!==z){if(n=nt(0,255&a[_-1]),n&&lt(!1),_++,A--,0===e.ce)return 0}else z=1,_++,A--;else{r=_+A-3,n=nt(_-1-S,C-3),A-=C-1,C-=2;do{++_>r||(p=(p<<g^255&a[_+2])&k,i=65535&d[p],h[_&u]=d[p],d[p]=_)}while(0!=--C);if(z=0,m=2,_++,n&&(lt(!1),0===e.ce))return 0}}return 0!==z&&(n=nt(0,255&a[_-1]),z=0),lt(4==t),0===e.ce?4==t?2:0:4==t?3:1})(i)}if(2!=U&&3!=U||(r=666),0==U||2==U)return 0===e.ce&&(f=-1),0;if(1==U){if(1==i)X(2,3),Y(256,et.Rt),$(),9>1+O+10-q&&(X(2,3),Y(256,et.Rt),$()),O=7;else if(ct(0,0,!1),3==i)for(o=0;y>o;o++)d[o]=0;if(e.Nt(),0===e.ce)return f=-1,0}}return 4!=i?0:1}}function lt(){const t=this;t.le=0,t.ue=0,t.Qt=0,t.te=0,t.ce=0,t.ee=0}function ut(t){const e=new lt,o=(s=t&&t.rt?t.rt:65536)+5*(n.floor(s/16383)+1);var s;const f=new i(o);let c=t?t.level:-1;void 0===c&&(c=-1),e.Yt(c),e.se=f,this.append=(t,n)=>{let s,c,l=0,u=0,a=0;const w=[];if(t.length){e.le=0,e.fe=t,e.Qt=t.length;do{if(e.ue=0,e.ce=o,s=e.st(0),0!=s)throw new r("deflating: "+e.Zt);e.ue&&(e.ue==o?w.push(new i(f)):w.push(f.slice(0,e.ue))),a+=e.ue,n&&e.le>0&&e.le!=l&&(n(e.le),l=e.le)}while(e.Qt>0||0===e.ce);return w.length>1?(c=new i(a),w.forEach((t=>{c.set(t,u),u+=t.length}))):c=w[0]||new i(0),c}},this.flush=()=>{let t,n,s=0,c=0;const l=[];do{if(e.ue=0,e.ce=o,t=e.st(4),1!=t&&0!=t)throw new r("deflating: "+e.Zt);o-e.ce>0&&l.push(f.slice(0,e.ue)),c+=e.ue}while(e.Qt>0||0===e.ce);return e.re(),n=new i(c),l.forEach((t=>{n.set(t,s),s+=t.length})),n}}lt.prototype={Yt:function(t,e){const n=this;return n.$t=new ct,e||(e=15),n.$t.Yt(n,t,e)},st:function(t){const e=this;return e.$t?e.$t.st(e,t):-2},re:function(){const t=this;if(!t.$t)return-2;const e=t.$t.re();return t.$t=null,e},ie:function(t,e){const n=this;return n.$t?n.$t.ie(n,t,e):-2},oe:function(t,e){const n=this;return n.$t?n.$t.oe(n,t,e):-2},Xt:function(t,e,n){const r=this;let i=r.Qt;return i>n&&(i=n),0===i?0:(r.Qt-=i,t.set(r.fe.subarray(r.le,r.le+i),e),r.le+=i,r.te+=i,i)},Nt:function(){const t=this;let e=t.$t.pending;e>t.ce&&(e=t.ce),0!==e&&(t.se.set(t.$t.qt.subarray(t.$t.ne,t.$t.ne+e),t.ue),t.ue+=e,t.$t.ne+=e,t.ee+=e,t.ce-=e,t.$t.pending-=e,0===t.$t.pending&&(t.$t.ne=0))}};const at=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535],wt=[96,7,256,0,8,80,0,8,16,84,8,115,82,7,31,0,8,112,0,8,48,0,9,192,80,7,10,0,8,96,0,8,32,0,9,160,0,8,0,0,8,128,0,8,64,0,9,224,80,7,6,0,8,88,0,8,24,0,9,144,83,7,59,0,8,120,0,8,56,0,9,208,81,7,17,0,8,104,0,8,40,0,9,176,0,8,8,0,8,136,0,8,72,0,9,240,80,7,4,0,8,84,0,8,20,85,8,227,83,7,43,0,8,116,0,8,52,0,9,200,81,7,13,0,8,100,0,8,36,0,9,168,0,8,4,0,8,132,0,8,68,0,9,232,80,7,8,0,8,92,0,8,28,0,9,152,84,7,83,0,8,124,0,8,60,0,9,216,82,7,23,0,8,108,0,8,44,0,9,184,0,8,12,0,8,140,0,8,76,0,9,248,80,7,3,0,8,82,0,8,18,85,8,163,83,7,35,0,8,114,0,8,50,0,9,196,81,7,11,0,8,98,0,8,34,0,9,164,0,8,2,0,8,130,0,8,66,0,9,228,80,7,7,0,8,90,0,8,26,0,9,148,84,7,67,0,8,122,0,8,58,0,9,212,82,7,19,0,8,106,0,8,42,0,9,180,0,8,10,0,8,138,0,8,74,0,9,244,80,7,5,0,8,86,0,8,22,192,8,0,83,7,51,0,8,118,0,8,54,0,9,204,81,7,15,0,8,102,0,8,38,0,9,172,0,8,6,0,8,134,0,8,70,0,9,236,80,7,9,0,8,94,0,8,30,0,9,156,84,7,99,0,8,126,0,8,62,0,9,220,82,7,27,0,8,110,0,8,46,0,9,188,0,8,14,0,8,142,0,8,78,0,9,252,96,7,256,0,8,81,0,8,17,85,8,131,82,7,31,0,8,113,0,8,49,0,9,194,80,7,10,0,8,97,0,8,33,0,9,162,0,8,1,0,8,129,0,8,65,0,9,226,80,7,6,0,8,89,0,8,25,0,9,146,83,7,59,0,8,121,0,8,57,0,9,210,81,7,17,0,8,105,0,8,41,0,9,178,0,8,9,0,8,137,0,8,73,0,9,242,80,7,4,0,8,85,0,8,21,80,8,258,83,7,43,0,8,117,0,8,53,0,9,202,81,7,13,0,8,101,0,8,37,0,9,170,0,8,5,0,8,133,0,8,69,0,9,234,80,7,8,0,8,93,0,8,29,0,9,154,84,7,83,0,8,125,0,8,61,0,9,218,82,7,23,0,8,109,0,8,45,0,9,186,0,8,13,0,8,141,0,8,77,0,9,250,80,7,3,0,8,83,0,8,19,85,8,195,83,7,35,0,8,115,0,8,51,0,9,198,81,7,11,0,8,99,0,8,35,0,9,166,0,8,3,0,8,131,0,8,67,0,9,230,80,7,7,0,8,91,0,8,27,0,9,150,84,7,67,0,8,123,0,8,59,0,9,214,82,7,19,0,8,107,0,8,43,0,9,182,0,8,11,0,8,139,0,8,75,0,9,246,80,7,5,0,8,87,0,8,23,192,8,0,83,7,51,0,8,119,0,8,55,0,9,206,81,7,15,0,8,103,0,8,39,0,9,174,0,8,7,0,8,135,0,8,71,0,9,238,80,7,9,0,8,95,0,8,31,0,9,158,84,7,99,0,8,127,0,8,63,0,9,222,82,7,27,0,8,111,0,8,47,0,9,190,0,8,15,0,8,143,0,8,79,0,9,254,96,7,256,0,8,80,0,8,16,84,8,115,82,7,31,0,8,112,0,8,48,0,9,193,80,7,10,0,8,96,0,8,32,0,9,161,0,8,0,0,8,128,0,8,64,0,9,225,80,7,6,0,8,88,0,8,24,0,9,145,83,7,59,0,8,120,0,8,56,0,9,209,81,7,17,0,8,104,0,8,40,0,9,177,0,8,8,0,8,136,0,8,72,0,9,241,80,7,4,0,8,84,0,8,20,85,8,227,83,7,43,0,8,116,0,8,52,0,9,201,81,7,13,0,8,100,0,8,36,0,9,169,0,8,4,0,8,132,0,8,68,0,9,233,80,7,8,0,8,92,0,8,28,0,9,153,84,7,83,0,8,124,0,8,60,0,9,217,82,7,23,0,8,108,0,8,44,0,9,185,0,8,12,0,8,140,0,8,76,0,9,249,80,7,3,0,8,82,0,8,18,85,8,163,83,7,35,0,8,114,0,8,50,0,9,197,81,7,11,0,8,98,0,8,34,0,9,165,0,8,2,0,8,130,0,8,66,0,9,229,80,7,7,0,8,90,0,8,26,0,9,149,84,7,67,0,8,122,0,8,58,0,9,213,82,7,19,0,8,106,0,8,42,0,9,181,0,8,10,0,8,138,0,8,74,0,9,245,80,7,5,0,8,86,0,8,22,192,8,0,83,7,51,0,8,118,0,8,54,0,9,205,81,7,15,0,8,102,0,8,38,0,9,173,0,8,6,0,8,134,0,8,70,0,9,237,80,7,9,0,8,94,0,8,30,0,9,157,84,7,99,0,8,126,0,8,62,0,9,221,82,7,27,0,8,110,0,8,46,0,9,189,0,8,14,0,8,142,0,8,78,0,9,253,96,7,256,0,8,81,0,8,17,85,8,131,82,7,31,0,8,113,0,8,49,0,9,195,80,7,10,0,8,97,0,8,33,0,9,163,0,8,1,0,8,129,0,8,65,0,9,227,80,7,6,0,8,89,0,8,25,0,9,147,83,7,59,0,8,121,0,8,57,0,9,211,81,7,17,0,8,105,0,8,41,0,9,179,0,8,9,0,8,137,0,8,73,0,9,243,80,7,4,0,8,85,0,8,21,80,8,258,83,7,43,0,8,117,0,8,53,0,9,203,81,7,13,0,8,101,0,8,37,0,9,171,0,8,5,0,8,133,0,8,69,0,9,235,80,7,8,0,8,93,0,8,29,0,9,155,84,7,83,0,8,125,0,8,61,0,9,219,82,7,23,0,8,109,0,8,45,0,9,187,0,8,13,0,8,141,0,8,77,0,9,251,80,7,3,0,8,83,0,8,19,85,8,195,83,7,35,0,8,115,0,8,51,0,9,199,81,7,11,0,8,99,0,8,35,0,9,167,0,8,3,0,8,131,0,8,67,0,9,231,80,7,7,0,8,91,0,8,27,0,9,151,84,7,67,0,8,123,0,8,59,0,9,215,82,7,19,0,8,107,0,8,43,0,9,183,0,8,11,0,8,139,0,8,75,0,9,247,80,7,5,0,8,87,0,8,23,192,8,0,83,7,51,0,8,119,0,8,55,0,9,207,81,7,15,0,8,103,0,8,39,0,9,175,0,8,7,0,8,135,0,8,71,0,9,239,80,7,9,0,8,95,0,8,31,0,9,159,84,7,99,0,8,127,0,8,63,0,9,223,82,7,27,0,8,111,0,8,47,0,9,191,0,8,15,0,8,143,0,8,79,0,9,255],ht=[80,5,1,87,5,257,83,5,17,91,5,4097,81,5,5,89,5,1025,85,5,65,93,5,16385,80,5,3,88,5,513,84,5,33,92,5,8193,82,5,9,90,5,2049,86,5,129,192,5,24577,80,5,2,87,5,385,83,5,25,91,5,6145,81,5,7,89,5,1537,85,5,97,93,5,24577,80,5,4,88,5,769,84,5,49,92,5,12289,82,5,13,90,5,3073,86,5,193,192,5,24577],dt=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],pt=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,112,112],yt=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],bt=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13];function kt(){let t,e,n,r,i,o;function s(t,e,s,f,c,l,u,a,w,h,d){let p,y,b,k,g,v,m,S,z,_,I,A,C,V,B;_=0,g=s;do{n[t[e+_]]++,_++,g--}while(0!==g);if(n[0]==s)return u[0]=-1,a[0]=0,0;for(S=a[0],v=1;15>=v&&0===n[v];v++);for(m=v,v>S&&(S=v),g=15;0!==g&&0===n[g];g--);for(b=g,S>g&&(S=g),a[0]=S,V=1<<v;g>v;v++,V<<=1)if(0>(V-=n[v]))return-3;if(0>(V-=n[g]))return-3;for(n[g]+=V,o[1]=v=0,_=1,C=2;0!=--g;)o[C]=v+=n[_],C++,_++;g=0,_=0;do{0!==(v=t[e+_])&&(d[o[v]++]=g),_++}while(++g<s);for(s=o[b],o[0]=g=0,_=0,k=-1,A=-S,i[0]=0,I=0,B=0;b>=m;m++)for(p=n[m];0!=p--;){for(;m>A+S;){if(k++,A+=S,B=b-A,B=B>S?S:B,(y=1<<(v=m-A))>p+1&&(y-=p+1,C=m,B>v))for(;++v<B&&(y<<=1)>n[++C];)y-=n[C];if(B=1<<v,h[0]+B>1440)return-3;i[k]=I=h[0],h[0]+=B,0!==k?(o[k]=g,r[0]=v,r[1]=S,v=g>>>A-S,r[2]=I-i[k-1]-v,w.set(r,3*(i[k-1]+v))):u[0]=I}for(r[1]=m-A,s>_?d[_]<f?(r[0]=256>d[_]?0:96,r[2]=d[_++]):(r[0]=l[d[_]-f]+16+64,r[2]=c[d[_++]-f]):r[0]=192,y=1<<m-A,v=g>>>A;B>v;v+=y)w.set(r,3*(I+v));for(v=1<<m-1;0!=(g&v);v>>>=1)g^=v;for(g^=v,z=(1<<A)-1;(g&z)!=o[k];)k--,A-=S,z=(1<<A)-1}return 0!==V&&1!=b?-5:0}function c(s){let c;for(t||(t=[],e=[],n=new f(16),r=[],i=new f(15),o=new f(16)),e.length<s&&(e=[]),c=0;s>c;c++)e[c]=0;for(c=0;16>c;c++)n[c]=0;for(c=0;3>c;c++)r[c]=0;i.set(n.subarray(0,15),0),o.set(n.subarray(0,16),0)}this.ae=(n,r,i,o,f)=>{let l;return c(19),t[0]=0,l=s(n,0,19,19,null,null,i,r,o,t,e),-3==l?f.Zt="oversubscribed dynamic bit lengths tree":-5!=l&&0!==r[0]||(f.Zt="incomplete dynamic bit lengths tree",l=-3),l},this.we=(n,r,i,o,f,l,u,a,w)=>{let h;return c(288),t[0]=0,h=s(i,0,n,257,dt,pt,l,o,a,t,e),0!=h||0===o[0]?(-3==h?w.Zt="oversubscribed literal/length tree":-4!=h&&(w.Zt="incomplete literal/length tree",h=-3),h):(c(288),h=s(i,n,r,0,yt,bt,u,f,a,t,e),0!=h||0===f[0]&&n>257?(-3==h?w.Zt="oversubscribed distance tree":-5==h?(w.Zt="incomplete distance tree",h=-3):-4!=h&&(w.Zt="empty distance tree with lengths",h=-3),h):0)}}function gt(){const t=this;let e,n,r,i,o=0,s=0,f=0,c=0,l=0,u=0,a=0,w=0,h=0,d=0;function p(t,e,n,r,i,o,s,f){let c,l,u,a,w,h,d,p,y,b,k,g,v,m,S,z;d=f.le,p=f.Qt,w=s.he,h=s.de,y=s.write,b=y<s.read?s.read-y-1:s.end-y,k=at[t],g=at[e];do{for(;20>h;)p--,w|=(255&f.pe(d++))<<h,h+=8;if(c=w&k,l=n,u=r,z=3*(u+c),0!==(a=l[z]))for(;;){if(w>>=l[z+1],h-=l[z+1],0!=(16&a)){for(a&=15,v=l[z+2]+(w&at[a]),w>>=a,h-=a;15>h;)p--,w|=(255&f.pe(d++))<<h,h+=8;for(c=w&g,l=i,u=o,z=3*(u+c),a=l[z];;){if(w>>=l[z+1],h-=l[z+1],0!=(16&a)){for(a&=15;a>h;)p--,w|=(255&f.pe(d++))<<h,h+=8;if(m=l[z+2]+(w&at[a]),w>>=a,h-=a,b-=v,m>y){S=y-m;do{S+=s.end}while(0>S);if(a=s.end-S,v>a){if(v-=a,y-S>0&&a>y-S)do{s.ye[y++]=s.ye[S++]}while(0!=--a);else s.ye.set(s.ye.subarray(S,S+a),y),y+=a,S+=a,a=0;S=0}}else S=y-m,y-S>0&&2>y-S?(s.ye[y++]=s.ye[S++],s.ye[y++]=s.ye[S++],v-=2):(s.ye.set(s.ye.subarray(S,S+2),y),y+=2,S+=2,v-=2);if(y-S>0&&v>y-S)do{s.ye[y++]=s.ye[S++]}while(0!=--v);else s.ye.set(s.ye.subarray(S,S+v),y),y+=v,S+=v,v=0;break}if(0!=(64&a))return f.Zt="invalid distance code",v=f.Qt-p,v=v>h>>3?h>>3:v,p+=v,d-=v,h-=v<<3,s.he=w,s.de=h,f.Qt=p,f.te+=d-f.le,f.le=d,s.write=y,-3;c+=l[z+2],c+=w&at[a],z=3*(u+c),a=l[z]}break}if(0!=(64&a))return 0!=(32&a)?(v=f.Qt-p,v=v>h>>3?h>>3:v,p+=v,d-=v,h-=v<<3,s.he=w,s.de=h,f.Qt=p,f.te+=d-f.le,f.le=d,s.write=y,1):(f.Zt="invalid literal/length code",v=f.Qt-p,v=v>h>>3?h>>3:v,p+=v,d-=v,h-=v<<3,s.he=w,s.de=h,f.Qt=p,f.te+=d-f.le,f.le=d,s.write=y,-3);if(c+=l[z+2],c+=w&at[a],z=3*(u+c),0===(a=l[z])){w>>=l[z+1],h-=l[z+1],s.ye[y++]=l[z+2],b--;break}}else w>>=l[z+1],h-=l[z+1],s.ye[y++]=l[z+2],b--}while(b>=258&&p>=10);return v=f.Qt-p,v=v>h>>3?h>>3:v,p+=v,d-=v,h-=v<<3,s.he=w,s.de=h,f.Qt=p,f.te+=d-f.le,f.le=d,s.write=y,0}t.init=(t,o,s,f,c,l)=>{e=0,a=t,w=o,r=s,h=f,i=c,d=l,n=null},t.be=(t,y,b)=>{let k,g,v,m,S,z,_,I=0,A=0,C=0;for(C=y.le,m=y.Qt,I=t.he,A=t.de,S=t.write,z=S<t.read?t.read-S-1:t.end-S;;)switch(e){case 0:if(z>=258&&m>=10&&(t.he=I,t.de=A,y.Qt=m,y.te+=C-y.le,y.le=C,t.write=S,b=p(a,w,r,h,i,d,t,y),C=y.le,m=y.Qt,I=t.he,A=t.de,S=t.write,z=S<t.read?t.read-S-1:t.end-S,0!=b)){e=1==b?7:9;break}f=a,n=r,s=h,e=1;case 1:for(k=f;k>A;){if(0===m)return t.he=I,t.de=A,y.Qt=m,y.te+=C-y.le,y.le=C,t.write=S,t.ke(y,b);b=0,m--,I|=(255&y.pe(C++))<<A,A+=8}if(g=3*(s+(I&at[k])),I>>>=n[g+1],A-=n[g+1],v=n[g],0===v){c=n[g+2],e=6;break}if(0!=(16&v)){l=15&v,o=n[g+2],e=2;break}if(0==(64&v)){f=v,s=g/3+n[g+2];break}if(0!=(32&v)){e=7;break}return e=9,y.Zt="invalid literal/length code",b=-3,t.he=I,t.de=A,y.Qt=m,y.te+=C-y.le,y.le=C,t.write=S,t.ke(y,b);case 2:for(k=l;k>A;){if(0===m)return t.he=I,t.de=A,y.Qt=m,y.te+=C-y.le,y.le=C,t.write=S,t.ke(y,b);b=0,m--,I|=(255&y.pe(C++))<<A,A+=8}o+=I&at[k],I>>=k,A-=k,f=w,n=i,s=d,e=3;case 3:for(k=f;k>A;){if(0===m)return t.he=I,t.de=A,y.Qt=m,y.te+=C-y.le,y.le=C,t.write=S,t.ke(y,b);b=0,m--,I|=(255&y.pe(C++))<<A,A+=8}if(g=3*(s+(I&at[k])),I>>=n[g+1],A-=n[g+1],v=n[g],0!=(16&v)){l=15&v,u=n[g+2],e=4;break}if(0==(64&v)){f=v,s=g/3+n[g+2];break}return e=9,y.Zt="invalid distance code",b=-3,t.he=I,t.de=A,y.Qt=m,y.te+=C-y.le,y.le=C,t.write=S,t.ke(y,b);case 4:for(k=l;k>A;){if(0===m)return t.he=I,t.de=A,y.Qt=m,y.te+=C-y.le,y.le=C,t.write=S,t.ke(y,b);b=0,m--,I|=(255&y.pe(C++))<<A,A+=8}u+=I&at[k],I>>=k,A-=k,e=5;case 5:for(_=S-u;0>_;)_+=t.end;for(;0!==o;){if(0===z&&(S==t.end&&0!==t.read&&(S=0,z=S<t.read?t.read-S-1:t.end-S),0===z&&(t.write=S,b=t.ke(y,b),S=t.write,z=S<t.read?t.read-S-1:t.end-S,S==t.end&&0!==t.read&&(S=0,z=S<t.read?t.read-S-1:t.end-S),0===z)))return t.he=I,t.de=A,y.Qt=m,y.te+=C-y.le,y.le=C,t.write=S,t.ke(y,b);t.ye[S++]=t.ye[_++],z--,_==t.end&&(_=0),o--}e=0;break;case 6:if(0===z&&(S==t.end&&0!==t.read&&(S=0,z=S<t.read?t.read-S-1:t.end-S),0===z&&(t.write=S,b=t.ke(y,b),S=t.write,z=S<t.read?t.read-S-1:t.end-S,S==t.end&&0!==t.read&&(S=0,z=S<t.read?t.read-S-1:t.end-S),0===z)))return t.he=I,t.de=A,y.Qt=m,y.te+=C-y.le,y.le=C,t.write=S,t.ke(y,b);b=0,t.ye[S++]=c,z--,e=0;break;case 7:if(A>7&&(A-=8,m++,C--),t.write=S,b=t.ke(y,b),S=t.write,z=S<t.read?t.read-S-1:t.end-S,t.read!=t.write)return t.he=I,t.de=A,y.Qt=m,y.te+=C-y.le,y.le=C,t.write=S,t.ke(y,b);e=8;case 8:return b=1,t.he=I,t.de=A,y.Qt=m,y.te+=C-y.le,y.le=C,t.write=S,t.ke(y,b);case 9:return b=-3,t.he=I,t.de=A,y.Qt=m,y.te+=C-y.le,y.le=C,t.write=S,t.ke(y,b);default:return b=-2,t.he=I,t.de=A,y.Qt=m,y.te+=C-y.le,y.le=C,t.write=S,t.ke(y,b)}},t.ge=()=>{}}kt.ve=(t,e,n,r)=>(t[0]=9,e[0]=5,n[0]=wt,r[0]=ht,0);const vt=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];function mt(t,e){const n=this;let r,o=0,s=0,c=0,l=0;const u=[0],a=[0],w=new gt;let h=0,d=new f(4320);const p=new kt;n.de=0,n.he=0,n.ye=new i(e),n.end=e,n.read=0,n.write=0,n.reset=(t,e)=>{e&&(e[0]=0),6==o&&w.ge(t),o=0,n.de=0,n.he=0,n.read=n.write=0},n.reset(t,null),n.ke=(t,e)=>{let r,i,o;return i=t.ue,o=n.read,r=(o>n.write?n.end:n.write)-o,r>t.ce&&(r=t.ce),0!==r&&-5==e&&(e=0),t.ce-=r,t.ee+=r,t.se.set(n.ye.subarray(o,o+r),i),i+=r,o+=r,o==n.end&&(o=0,n.write==n.end&&(n.write=0),r=n.write-o,r>t.ce&&(r=t.ce),0!==r&&-5==e&&(e=0),t.ce-=r,t.ee+=r,t.se.set(n.ye.subarray(o,o+r),i),i+=r,o+=r),t.ue=i,n.read=o,e},n.be=(t,e)=>{let i,f,y,b,k,g,v,m;for(b=t.le,k=t.Qt,f=n.he,y=n.de,g=n.write,v=g<n.read?n.read-g-1:n.end-g;;){let S,z,_,I,A,C,V,B;switch(o){case 0:for(;3>y;){if(0===k)return n.he=f,n.de=y,t.Qt=k,t.te+=b-t.le,t.le=b,n.write=g,n.ke(t,e);e=0,k--,f|=(255&t.pe(b++))<<y,y+=8}switch(i=7&f,h=1&i,i>>>1){case 0:f>>>=3,y-=3,i=7&y,f>>>=i,y-=i,o=1;break;case 1:S=[],z=[],_=[[]],I=[[]],kt.ve(S,z,_,I),w.init(S[0],z[0],_[0],0,I[0],0),f>>>=3,y-=3,o=6;break;case 2:f>>>=3,y-=3,o=3;break;case 3:return f>>>=3,y-=3,o=9,t.Zt="invalid block type",e=-3,n.he=f,n.de=y,t.Qt=k,t.te+=b-t.le,t.le=b,n.write=g,n.ke(t,e)}break;case 1:for(;32>y;){if(0===k)return n.he=f,n.de=y,t.Qt=k,t.te+=b-t.le,t.le=b,n.write=g,n.ke(t,e);e=0,k--,f|=(255&t.pe(b++))<<y,y+=8}if((~f>>>16&65535)!=(65535&f))return o=9,t.Zt="invalid stored block lengths",e=-3,n.he=f,n.de=y,t.Qt=k,t.te+=b-t.le,t.le=b,n.write=g,n.ke(t,e);s=65535&f,f=y=0,o=0!==s?2:0!==h?7:0;break;case 2:if(0===k)return n.he=f,n.de=y,t.Qt=k,t.te+=b-t.le,t.le=b,n.write=g,n.ke(t,e);if(0===v&&(g==n.end&&0!==n.read&&(g=0,v=g<n.read?n.read-g-1:n.end-g),0===v&&(n.write=g,e=n.ke(t,e),g=n.write,v=g<n.read?n.read-g-1:n.end-g,g==n.end&&0!==n.read&&(g=0,v=g<n.read?n.read-g-1:n.end-g),0===v)))return n.he=f,n.de=y,t.Qt=k,t.te+=b-t.le,t.le=b,n.write=g,n.ke(t,e);if(e=0,i=s,i>k&&(i=k),i>v&&(i=v),n.ye.set(t.Xt(b,i),g),b+=i,k-=i,g+=i,v-=i,0!=(s-=i))break;o=0!==h?7:0;break;case 3:for(;14>y;){if(0===k)return n.he=f,n.de=y,t.Qt=k,t.te+=b-t.le,t.le=b,n.write=g,n.ke(t,e);e=0,k--,f|=(255&t.pe(b++))<<y,y+=8}if(c=i=16383&f,(31&i)>29||(i>>5&31)>29)return o=9,t.Zt="too many length or distance symbols",e=-3,n.he=f,n.de=y,t.Qt=k,t.te+=b-t.le,t.le=b,n.write=g,n.ke(t,e);if(i=258+(31&i)+(i>>5&31),!r||r.length<i)r=[];else for(m=0;i>m;m++)r[m]=0;f>>>=14,y-=14,l=0,o=4;case 4:for(;4+(c>>>10)>l;){for(;3>y;){if(0===k)return n.he=f,n.de=y,t.Qt=k,t.te+=b-t.le,t.le=b,n.write=g,n.ke(t,e);e=0,k--,f|=(255&t.pe(b++))<<y,y+=8}r[vt[l++]]=7&f,f>>>=3,y-=3}for(;19>l;)r[vt[l++]]=0;if(u[0]=7,i=p.ae(r,u,a,d,t),0!=i)return-3==(e=i)&&(r=null,o=9),n.he=f,n.de=y,t.Qt=k,t.te+=b-t.le,t.le=b,n.write=g,n.ke(t,e);l=0,o=5;case 5:for(;i=c,258+(31&i)+(i>>5&31)>l;){let s,w;for(i=u[0];i>y;){if(0===k)return n.he=f,n.de=y,t.Qt=k,t.te+=b-t.le,t.le=b,n.write=g,n.ke(t,e);e=0,k--,f|=(255&t.pe(b++))<<y,y+=8}if(i=d[3*(a[0]+(f&at[i]))+1],w=d[3*(a[0]+(f&at[i]))+2],16>w)f>>>=i,y-=i,r[l++]=w;else{for(m=18==w?7:w-14,s=18==w?11:3;i+m>y;){if(0===k)return n.he=f,n.de=y,t.Qt=k,t.te+=b-t.le,t.le=b,n.write=g,n.ke(t,e);e=0,k--,f|=(255&t.pe(b++))<<y,y+=8}if(f>>>=i,y-=i,s+=f&at[m],f>>>=m,y-=m,m=l,i=c,m+s>258+(31&i)+(i>>5&31)||16==w&&1>m)return r=null,o=9,t.Zt="invalid bit length repeat",e=-3,n.he=f,n.de=y,t.Qt=k,t.te+=b-t.le,t.le=b,n.write=g,n.ke(t,e);w=16==w?r[m-1]:0;do{r[m++]=w}while(0!=--s);l=m}}if(a[0]=-1,A=[],C=[],V=[],B=[],A[0]=9,C[0]=6,i=c,i=p.we(257+(31&i),1+(i>>5&31),r,A,C,V,B,d,t),0!=i)return-3==i&&(r=null,o=9),e=i,n.he=f,n.de=y,t.Qt=k,t.te+=b-t.le,t.le=b,n.write=g,n.ke(t,e);w.init(A[0],C[0],d,V[0],d,B[0]),o=6;case 6:if(n.he=f,n.de=y,t.Qt=k,t.te+=b-t.le,t.le=b,n.write=g,1!=(e=w.be(n,t,e)))return n.ke(t,e);if(e=0,w.ge(t),b=t.le,k=t.Qt,f=n.he,y=n.de,g=n.write,v=g<n.read?n.read-g-1:n.end-g,0===h){o=0;break}o=7;case 7:if(n.write=g,e=n.ke(t,e),g=n.write,v=g<n.read?n.read-g-1:n.end-g,n.read!=n.write)return n.he=f,n.de=y,t.Qt=k,t.te+=b-t.le,t.le=b,n.write=g,n.ke(t,e);o=8;case 8:return e=1,n.he=f,n.de=y,t.Qt=k,t.te+=b-t.le,t.le=b,n.write=g,n.ke(t,e);case 9:return e=-3,n.he=f,n.de=y,t.Qt=k,t.te+=b-t.le,t.le=b,n.write=g,n.ke(t,e);default:return e=-2,n.he=f,n.de=y,t.Qt=k,t.te+=b-t.le,t.le=b,n.write=g,n.ke(t,e)}}},n.ge=t=>{n.reset(t,null),n.ye=null,d=null},n.me=(t,e,r)=>{n.ye.set(t.subarray(e,e+r),0),n.read=n.write=r},n.Se=()=>1==o?1:0}const St=[0,0,255,255];function zt(){const t=this;function e(t){return t&&t.ze?(t.te=t.ee=0,t.Zt=null,t.ze.mode=7,t.ze._e.reset(t,null),0):-2}t.mode=0,t.method=0,t.Ie=[0],t.Ae=0,t.marker=0,t.Ce=0,t.Ve=e=>(t._e&&t._e.ge(e),t._e=null,0),t.Be=(n,r)=>(n.Zt=null,t._e=null,8>r||r>15?(t.Ve(n),-2):(t.Ce=r,n.ze._e=new mt(n,1<<r),e(n),0)),t.it=(t,e)=>{let n,r;if(!t||!t.ze||!t.fe)return-2;const i=t.ze;for(e=4==e?-5:0,n=-5;;)switch(i.mode){case 0:if(0===t.Qt)return n;if(n=e,t.Qt--,t.te++,8!=(15&(i.method=t.pe(t.le++)))){i.mode=13,t.Zt="unknown compression method",i.marker=5;break}if(8+(i.method>>4)>i.Ce){i.mode=13,t.Zt="invalid win size",i.marker=5;break}i.mode=1;case 1:if(0===t.Qt)return n;if(n=e,t.Qt--,t.te++,r=255&t.pe(t.le++),((i.method<<8)+r)%31!=0){i.mode=13,t.Zt="incorrect header check",i.marker=5;break}if(0==(32&r)){i.mode=7;break}i.mode=2;case 2:if(0===t.Qt)return n;n=e,t.Qt--,t.te++,i.Ae=(255&t.pe(t.le++))<<24&4278190080,i.mode=3;case 3:if(0===t.Qt)return n;n=e,t.Qt--,t.te++,i.Ae+=(255&t.pe(t.le++))<<16&16711680,i.mode=4;case 4:if(0===t.Qt)return n;n=e,t.Qt--,t.te++,i.Ae+=(255&t.pe(t.le++))<<8&65280,i.mode=5;case 5:return 0===t.Qt?n:(n=e,t.Qt--,t.te++,i.Ae+=255&t.pe(t.le++),i.mode=6,2);case 6:return i.mode=13,t.Zt="need dictionary",i.marker=0,-2;case 7:if(n=i._e.be(t,n),-3==n){i.mode=13,i.marker=0;break}if(0==n&&(n=e),1!=n)return n;n=e,i._e.reset(t,i.Ie),i.mode=12;case 12:return t.Qt=0,1;case 13:return-3;default:return-2}},t.Ee=(t,e,n)=>{let r=0,i=n;if(!t||!t.ze||6!=t.ze.mode)return-2;const o=t.ze;return i<1<<o.Ce||(i=(1<<o.Ce)-1,r=n-i),o._e.me(e,r,i),o.mode=7,0},t.De=t=>{let n,r,i,o,s;if(!t||!t.ze)return-2;const f=t.ze;if(13!=f.mode&&(f.mode=13,f.marker=0),0===(n=t.Qt))return-5;for(r=t.le,i=f.marker;0!==n&&4>i;)t.pe(r)==St[i]?i++:i=0!==t.pe(r)?0:4-i,r++,n--;return t.te+=r-t.le,t.le=r,t.Qt=n,f.marker=i,4!=i?-3:(o=t.te,s=t.ee,e(t),t.te=o,t.ee=s,f.mode=7,0)},t.Ue=t=>t&&t.ze&&t.ze._e?t.ze._e.Se():-2}function _t(){}function It(t){const e=new _t,o=t&&t.rt?n.floor(2*t.rt):131072,s=new i(o);let f=!1;e.Be(),e.se=s,this.append=(t,n)=>{const c=[];let l,u,a=0,w=0,h=0;if(0!==t.length){e.le=0,e.fe=t,e.Qt=t.length;do{if(e.ue=0,e.ce=o,0!==e.Qt||f||(e.le=0,f=!0),l=e.it(0),f&&-5===l){if(0!==e.Qt)throw new r("inflating: bad input")}else if(0!==l&&1!==l)throw new r("inflating: "+e.Zt);if((f||1===l)&&e.Qt===t.length)throw new r("inflating: bad input");e.ue&&(e.ue===o?c.push(new i(s)):c.push(s.slice(0,e.ue))),h+=e.ue,n&&e.le>0&&e.le!=a&&(n(e.le),a=e.le)}while(e.Qt>0||0===e.ce);return c.length>1?(u=new i(h),c.forEach((t=>{u.set(t,w),w+=t.length}))):u=c[0]||new i(0),u}},this.flush=()=>{e.Ve()}}_t.prototype={Be:function(t){const e=this;return e.ze=new zt,t||(t=15),e.ze.Be(e,t)},it:function(t){const e=this;return e.ze?e.ze.it(e,t):-2},Ve:function(){const t=this;if(!t.ze)return-2;const e=t.ze.Ve(t);return t.ze=null,e},De:function(){const t=this;return t.ze?t.ze.De(t):-2},Ee:function(t,e){const n=this;return n.ze?n.ze.Ee(n,t,e):-2},pe:function(t){return this.fe[t]},Xt:function(t,e){return this.fe.subarray(t,t+e)}},self.initCodec=()=>{self.Deflate=ut,self.Inflate=It};
`],{type:"text/javascript"}));i({workerScripts:{inflate:[e],deflate:[e]}})}};var Bu=class{constructor(){this.size=0}init(){this.initialized=!0}},Rc=class extends Bu{},Vu=class extends Bu{writeUint8Array(e){this.size+=e.length}};var Zs=class extends Rc{constructor(e){super(),this.array=e,this.size=e.length}readUint8Array(e,t){return this.array.slice(e,e+t)}},$s=class extends Vu{constructor(){super(),this.array=new Uint8Array(0)}writeUint8Array(e){super.writeUint8Array(e);let t=this.array;this.array=new Uint8Array(t.length+e.length),this.array.set(t),this.array.set(e,t.length)}getData(){return this.array}};var jm="/",hC=new Date(2107,11,31),mC=new Date(1980,0,1);var gC="\0\u263A\u263B\u2665\u2666\u2663\u2660\u2022\u25D8\u25CB\u25D9\u2642\u2640\u266A\u266B\u263C\u25BA\u25C4\u2195\u203C\xB6\xA7\u25AC\u21A8\u2191\u2193\u2192\u2190\u221F\u2194\u25B2\u25BC !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~\u2302\xC7\xFC\xE9\xE2\xE4\xE0\xE5\xE7\xEA\xEB\xE8\xEF\xEE\xEC\xC4\xC5\xC9\xE6\xC6\xF4\xF6\xF2\xFB\xF9\xFF\xD6\xDC\xA2\xA3\xA5\u20A7\u0192\xE1\xED\xF3\xFA\xF1\xD1\xAA\xBA\xBF\u2310\xAC\xBD\xBC\xA1\xAB\xBB\u2591\u2592\u2593\u2502\u2524\u2561\u2562\u2556\u2555\u2563\u2551\u2557\u255D\u255C\u255B\u2510\u2514\u2534\u252C\u251C\u2500\u253C\u255E\u255F\u255A\u2554\u2569\u2566\u2560\u2550\u256C\u2567\u2568\u2564\u2565\u2559\u2558\u2552\u2553\u256B\u256A\u2518\u250C\u2588\u2584\u258C\u2590\u2580\u03B1\xDF\u0393\u03C0\u03A3\u03C3\xB5\u03C4\u03A6\u0398\u03A9\u03B4\u221E\u03C6\u03B5\u2229\u2261\xB1\u2265\u2264\u2320\u2321\xF7\u2248\xB0\u2219\xB7\u221A\u207F\xB2\u25A0 ".split(""),sy=i=>{let e="";for(let t=0;t<i.length;t++)e+=gC[i[t]];return e};var ku=fC;function fC(i,e){if(e&&e.trim().toLowerCase()=="cp437")return sy(i);if(typeof TextDecoder>"u"){let t=new FileReader;return new Promise((n,r)=>{t.onload=o=>n(o.target.result),t.onerror=()=>r(t.error),t.readAsText(new Blob([i]))})}else return new TextDecoder(e).decode(i)}var $m="Abort error";async function eg(i,e,t,n,r,o,a){let s=Math.max(o.chunkSize,64);return l();async function l(d=0,c=0){let p=a.signal,u=r();if(d<u){Zm(p,i);let h=await e.readUint8Array(d+n,Math.min(s,u-d)),f=h.length;Zm(p,i);let y=await i.append(h);if(Zm(p,i),c+=await ly(t,y),a.onprogress)try{a.onprogress(d+f,u)}catch{}return l(d+s,c)}else{let h=await i.flush();return c+=await ly(t,h.data),{signature:h.signature,length:c}}}}function Zm(i,e){if(i&&i.aborted)throw e.abort(),new Error($m)}async function ly(i,e){return e.length&&await i.writeUint8Array(e),e.length}var _C=["filename","rawFilename","directory","encrypted","compressedSize","uncompressedSize","lastModDate","rawLastModDate","comment","rawComment","signature","extraField","rawExtraField","bitFlag","extraFieldZip64","extraFieldUnicodePath","extraFieldUnicodeComment","extraFieldAES","filenameUTF8","commentUTF8","offset","zip64","compressionMethod","extraFieldNTFS","lastAccessDate","creationDate","extraFieldExtendedTimestamp","version","versionMadeBy","msDosCompatible","internalFileAttribute","externalFileAttribute"],fs=class{constructor(e){_C.forEach(t=>this[t]=e[t])}};var Uu="File format is not recognized",Iy="End of central directory not found",Ey="End of Zip64 central directory not found",Cy="End of Zip64 central directory locator not found",Ry="Central directory header not found",Ny="Local file header not found",Oy="Zip64 extra field not found",wy="File contains encrypted entry",xy="Encryption method not supported",pg="Compression method not supported",cy="utf-8",dy="cp437",uy=["uncompressedSize","compressedSize","offset"],nl=class{constructor(e,t={}){Object.assign(this,{reader:e,options:t,config:Bm()})}async*getEntriesGenerator(e={}){let t=this,n=t.reader;if(n.initialized||await n.init(),n.size<22)throw new Error(Uu);let r=await EC(n,101010256,n.size,22,65535*16);if(!r)throw new Error(Iy);let o=kr(r),a=_r(o,12),s=_r(o,16),l=xo(o,8),d=0;if(s==4294967295||a==4294967295||l==65535){let h=await va(n,r.offset-20,20),f=kr(h);if(_r(f,0)!=117853008)throw new Error(Ey);s=Gu(f,8);let y=await va(n,s,56),g=kr(y),A=r.offset-20-56;if(_r(g,0)!=101075792&&s!=A){let T=s;s=A,d=s-T,y=await va(n,s,56),g=kr(y)}if(_r(g,0)!=101075792)throw new Error(Cy);l=Gu(g,32),a=Gu(g,40),s-=a}if(s<0||s>=n.size)throw new Error(Uu);let c=0,p=await va(n,s,a),u=kr(p);if(a){let h=r.offset-a;if(_r(u,c)!=33639248&&s!=h){let f=s;s=h,d=s-f,p=await va(n,s,a),u=kr(p)}}if(s<0||s>=n.size)throw new Error(Uu);for(let h=0;h<l;h++){let f=new hg(n,t.config,t.options);if(_r(u,c)!=33639248)throw new Error(Ry);Py(f,u,c+6);let y=!!f.bitFlag.languageEncodingFlag,g=c+46,A=g+f.filenameLength,T=A+f.extraFieldLength,b=xo(u,c+4),_=(b&0)==0;Object.assign(f,{versionMadeBy:b,msDosCompatible:_,compressedSize:0,uncompressedSize:0,commentLength:xo(u,c+32),directory:_&&(tl(u,c+38)&16)==16,offset:_r(u,c+42)+d,internalFileAttribute:_r(u,c+34),externalFileAttribute:_r(u,c+38),rawFilename:p.subarray(g,A),filenameUTF8:y,commentUTF8:y,rawExtraField:p.subarray(A,T)});let m=T+f.commentLength;f.rawComment=p.subarray(T,m);let S=el(t,e,"filenameEncoding"),v=el(t,e,"commentEncoding"),[C,N]=await Promise.all([ku(f.rawFilename,f.filenameUTF8?cy:S||dy),ku(f.rawComment,f.commentUTF8?cy:v||dy)]);f.filename=C,f.comment=N,!f.directory&&f.filename.endsWith(jm)&&(f.directory=!0),await Fy(f,f,u,c+6);let x=new fs(f);if(x.getData=(z,$)=>f.getData(z,x,$),c=m,e.onprogress)try{e.onprogress(h+1,l,new fs(f))}catch{}yield x}return!0}async getEntries(e={}){let t=[],n=this.getEntriesGenerator(e),r=n.next();for(;!(await r).done;)t.push((await r).value),r=n.next();return t}async close(){}};var hg=class{constructor(e,t,n){Object.assign(this,{reader:e,config:t,options:n})}async getData(e,t,n={}){let r=this,{reader:o,offset:a,extraFieldAES:s,compressionMethod:l,config:d,bitFlag:c,signature:p,rawLastModDate:u,compressedSize:h}=r,f=r.localDirectory={};o.initialized||await o.init();let y=await va(o,a,30),g=kr(y),A=el(r,n,"password");if(A=A&&A.length&&A,s&&s.originalCompressionMethod!=99)throw new Error(pg);if(l!=0&&l!=8)throw new Error(pg);if(_r(g,0)!=67324752)throw new Error(Ny);Py(f,g,4),y=await va(o,a,30+f.filenameLength+f.extraFieldLength),f.rawExtraField=y.subarray(30+f.filenameLength),await Fy(r,f,g,4),t.lastAccessDate=f.lastAccessDate,t.creationDate=f.creationDate;let T=r.encrypted&&f.encrypted,b=T&&!s;if(T){if(!b&&s.strength===void 0)throw new Error(xy);if(!A)throw new Error(wy)}let _=await Jm(d.Inflate,{codecType:Lu,password:A,zipCrypto:b,encryptionStrength:s&&s.strength,signed:el(r,n,"checkSignature"),passwordVerification:b&&(c.dataDescriptor?u>>>8&255:p>>>24&255),signature:p,compressed:l!=0,encrypted:T,useWebWorkers:el(r,n,"useWebWorkers")},d);e.initialized||await e.init();let m=el(r,n,"signal"),S=a+30+f.filenameLength+f.extraFieldLength;return await eg(_,o,e,S,()=>h,d,{onprogress:n.onprogress,signal:m}),e.getData()}};function Py(i,e,t){let n=i.rawBitFlag=xo(e,t+2),r=(n&1)==1,o=_r(e,t+6);Object.assign(i,{encrypted:r,version:xo(e,t),bitFlag:{level:(n&6)>>1,dataDescriptor:(n&8)==8,languageEncodingFlag:(n&2048)==2048},rawLastModDate:o,lastModDate:CC(o),filenameLength:xo(e,t+22),extraFieldLength:xo(e,t+24)})}async function Fy(i,e,t,n){let r=e.rawExtraField,o=e.extraField=new Map,a=kr(new Uint8Array(r)),s=0;try{for(;s<r.length;){let y=xo(a,s),g=xo(a,s+2);o.set(y,{type:y,data:r.slice(s+4,s+4+g)}),s+=4+g}}catch{}let l=xo(t,n+4);e.signature=_r(t,n+10),e.uncompressedSize=_r(t,n+18),e.compressedSize=_r(t,n+14);let d=o.get(1);d&&(bC(d,e),e.extraFieldZip64=d);let c=o.get(28789);c&&(await py(c,"filename","rawFilename",e,i),e.extraFieldUnicodePath=c);let p=o.get(25461);p&&(await py(p,"comment","rawComment",e,i),e.extraFieldUnicodeComment=p);let u=o.get(39169);u?(TC(u,e,l),e.extraFieldAES=u):e.compressionMethod=l;let h=o.get(10);h&&(vC(h,e),e.extraFieldNTFS=h);let f=o.get(21589);f&&(IC(f,e),e.extraFieldExtendedTimestamp=f)}function bC(i,e){e.zip64=!0;let t=kr(i.data);i.values=[];for(let r=0;r<Math.floor(i.data.length/8);r++)i.values.push(Gu(t,0+r*8));let n=uy.filter(r=>e[r]==4294967295);for(let r=0;r<n.length;r++)i[n[r]]=i.values[r];uy.forEach(r=>{if(e[r]==4294967295)if(i[r]!==void 0)e[r]=i[r];else throw new Error(Oy)})}async function py(i,e,t,n,r){let o=kr(i.data);i.version=tl(o,0),i.signature=_r(o,1);let a=new ba;a.append(r[t]);let s=kr(new Uint8Array(4));s.setUint32(0,a.get(),!0),i[e]=await ku(i.data.subarray(5)),i.valid=!r.bitFlag.languageEncodingFlag&&i.signature==_r(s,0),i.valid&&(n[e]=i[e],n[e+"UTF8"]=!0)}function TC(i,e,t){let n=kr(i.data);i.vendorVersion=tl(n,0),i.vendorId=tl(n,2);let r=tl(n,4);i.strength=r,i.originalCompressionMethod=t,e.compressionMethod=i.compressionMethod=xo(n,5)}function vC(i,e){let t=kr(i.data),n=4,r;try{for(;n<i.data.length&&!r;){let o=xo(t,n),a=xo(t,n+2);o==1&&(r=i.data.slice(n+4,n+4+a)),n+=4+a}}catch{}try{if(r&&r.length==24){let o=kr(r),a=o.getBigUint64(0,!0),s=o.getBigUint64(8,!0),l=o.getBigUint64(16,!0);Object.assign(i,{rawLastModDate:a,rawLastAccessDate:s,rawCreationDate:l});let d=rg(a),c=rg(s),p=rg(l),u={lastModDate:d,lastAccessDate:c,creationDate:p};Object.assign(i,u),Object.assign(e,u)}}catch{}}function IC(i,e){let t=kr(i.data),n=tl(t,0),r=[],o=[];(n&1)==1&&(r.push("lastModDate"),o.push("rawLastModDate")),(n&2)==2&&(r.push("lastAccessDate"),o.push("rawLastAccessDate")),(n&4)==4&&(r.push("creationDate"),o.push("rawCreationDate"));let a=1;r.forEach((s,l)=>{if(i.data.length>=a+4){let d=_r(t,a);e[s]=i[s]=new Date(d*1e3);let c=o[l];i[c]=d}a+=4})}async function EC(i,e,t,n,r){let o=new Uint8Array(4),a=kr(o);RC(a,0,e);let s=n+r;return await l(n)||await l(Math.min(s,t));async function l(d){let c=t-d,p=await va(i,c,d);for(let u=p.length-n;u>=0;u--)if(p[u]==o[0]&&p[u+1]==o[1]&&p[u+2]==o[2]&&p[u+3]==o[3])return{offset:c+u,buffer:p.slice(u,u+n).buffer}}}function el(i,e,t){return e[t]===void 0?i.options[t]:e[t]}function CC(i){let e=(i&4294901760)>>16,t=i&65535;try{return new Date(1980+((e&65024)>>9),((e&480)>>5)-1,e&31,(t&63488)>>11,(t&2016)>>5,(t&31)*2,0)}catch{}}function rg(i){return new Date(Number(i/BigInt(1e4)-BigInt(116444736e5)))}function tl(i,e){return i.getUint8(e)}function xo(i,e){return i.getUint16(e,!0)}function _r(i,e){return i.getUint32(e,!0)}function Gu(i,e){return Number(i.getBigUint64(e,!0))}function RC(i,e,t){i.setUint32(e,t,!0)}function kr(i){return new DataView(i.buffer)}function va(i,e,t){return i.readUint8Array(e,t)}var KP=new Uint8Array([7,0,2,0,65,69,3,0,0]);var jP=512*1024;var BC={},Ly;try{Ly=BC.url}catch{}Ys({baseURL:Ly});ay(Ys);Ys({Deflate:gS,Inflate:BS});var ih=Wa(xs());var Oc,Ki,gg,mg={env:{emscripten_notify_memory_growth:function(i){gg=new Uint8Array(Ki.exports.memory.buffer)}}},Hu=class{init(){return Oc||(typeof fetch<"u"?Oc=fetch("data:application/wasm;base64,"+My).then(e=>e.arrayBuffer()).then(e=>WebAssembly.instantiate(e,mg)).then(this._init):Oc=WebAssembly.instantiate(Buffer.from(My,"base64"),mg).then(this._init),Oc)}_init(e){Ki=e.instance,mg.env.emscripten_notify_memory_growth(0)}decode(e,t=0){if(!Ki)throw new Error("ZSTDDecoder: Await .init() before decoding.");let n=e.byteLength,r=Ki.exports.malloc(n);gg.set(e,r),t=t||Number(Ki.exports.ZSTD_findDecompressedSize(r,n));let o=Ki.exports.malloc(t),a=Ki.exports.ZSTD_decompress(o,t,r,n),s=gg.slice(o,o+a);return Ki.exports.free(r),Ki.exports.free(o),s}},My="AGFzbQEAAAABpQEVYAF/AX9gAn9/AGADf39/AX9gBX9/f39/AX9gAX8AYAJ/fwF/YAR/f39/AX9gA39/fwBgBn9/f39/fwF/YAd/f39/f39/AX9gAn9/AX5gAn5+AX5gAABgBX9/f39/AGAGf39/f39/AGAIf39/f39/f38AYAl/f39/f39/f38AYAABf2AIf39/f39/f38Bf2ANf39/f39/f39/f39/fwF/YAF/AX4CJwEDZW52H2Vtc2NyaXB0ZW5fbm90aWZ5X21lbW9yeV9ncm93dGgABANpaAEFAAAFAgEFCwACAQABAgIFBQcAAwABDgsBAQcAEhMHAAUBDAQEAAANBwQCAgYCBAgDAwMDBgEACQkHBgICAAYGAgQUBwYGAwIGAAMCAQgBBwUGCgoEEQAEBAEIAwgDBQgDEA8IAAcABAUBcAECAgUEAQCAAgYJAX8BQaCgwAILB2AHBm1lbW9yeQIABm1hbGxvYwAoBGZyZWUAJgxaU1REX2lzRXJyb3IAaBlaU1REX2ZpbmREZWNvbXByZXNzZWRTaXplAFQPWlNURF9kZWNvbXByZXNzAEoGX3N0YXJ0ACQJBwEAQQELASQKussBaA8AIAAgACgCBCABajYCBAsZACAAKAIAIAAoAgRBH3F0QQAgAWtBH3F2CwgAIABBiH9LC34BBH9BAyEBIAAoAgQiA0EgTQRAIAAoAggiASAAKAIQTwRAIAAQDQ8LIAAoAgwiAiABRgRAQQFBAiADQSBJGw8LIAAgASABIAJrIANBA3YiBCABIARrIAJJIgEbIgJrIgQ2AgggACADIAJBA3RrNgIEIAAgBCgAADYCAAsgAQsUAQF/IAAgARACIQIgACABEAEgAgv3AQECfyACRQRAIABCADcCACAAQQA2AhAgAEIANwIIQbh/DwsgACABNgIMIAAgAUEEajYCECACQQRPBEAgACABIAJqIgFBfGoiAzYCCCAAIAMoAAA2AgAgAUF/ai0AACIBBEAgAEEIIAEQFGs2AgQgAg8LIABBADYCBEF/DwsgACABNgIIIAAgAS0AACIDNgIAIAJBfmoiBEEBTQRAIARBAWtFBEAgACABLQACQRB0IANyIgM2AgALIAAgAS0AAUEIdCADajYCAAsgASACakF/ai0AACIBRQRAIABBADYCBEFsDwsgAEEoIAEQFCACQQN0ams2AgQgAgsWACAAIAEpAAA3AAAgACABKQAINwAICy8BAX8gAUECdEGgHWooAgAgACgCAEEgIAEgACgCBGprQR9xdnEhAiAAIAEQASACCyEAIAFCz9bTvtLHq9lCfiAAfEIfiUKHla+vmLbem55/fgsdAQF/IAAoAgggACgCDEYEfyAAKAIEQSBGBUEACwuCBAEDfyACQYDAAE8EQCAAIAEgAhBnIAAPCyAAIAJqIQMCQCAAIAFzQQNxRQRAAkAgAkEBSARAIAAhAgwBCyAAQQNxRQRAIAAhAgwBCyAAIQIDQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADTw0BIAJBA3ENAAsLAkAgA0F8cSIEQcAASQ0AIAIgBEFAaiIFSw0AA0AgAiABKAIANgIAIAIgASgCBDYCBCACIAEoAgg2AgggAiABKAIMNgIMIAIgASgCEDYCECACIAEoAhQ2AhQgAiABKAIYNgIYIAIgASgCHDYCHCACIAEoAiA2AiAgAiABKAIkNgIkIAIgASgCKDYCKCACIAEoAiw2AiwgAiABKAIwNgIwIAIgASgCNDYCNCACIAEoAjg2AjggAiABKAI8NgI8IAFBQGshASACQUBrIgIgBU0NAAsLIAIgBE8NAQNAIAIgASgCADYCACABQQRqIQEgAkEEaiICIARJDQALDAELIANBBEkEQCAAIQIMAQsgA0F8aiIEIABJBEAgACECDAELIAAhAgNAIAIgAS0AADoAACACIAEtAAE6AAEgAiABLQACOgACIAIgAS0AAzoAAyABQQRqIQEgAkEEaiICIARNDQALCyACIANJBEADQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADRw0ACwsgAAsMACAAIAEpAAA3AAALQQECfyAAKAIIIgEgACgCEEkEQEEDDwsgACAAKAIEIgJBB3E2AgQgACABIAJBA3ZrIgE2AgggACABKAAANgIAQQALDAAgACABKAIANgAAC/cCAQJ/AkAgACABRg0AAkAgASACaiAASwRAIAAgAmoiBCABSw0BCyAAIAEgAhALDwsgACABc0EDcSEDAkACQCAAIAFJBEAgAwRAIAAhAwwDCyAAQQNxRQRAIAAhAwwCCyAAIQMDQCACRQ0EIAMgAS0AADoAACABQQFqIQEgAkF/aiECIANBAWoiA0EDcQ0ACwwBCwJAIAMNACAEQQNxBEADQCACRQ0FIAAgAkF/aiICaiIDIAEgAmotAAA6AAAgA0EDcQ0ACwsgAkEDTQ0AA0AgACACQXxqIgJqIAEgAmooAgA2AgAgAkEDSw0ACwsgAkUNAgNAIAAgAkF/aiICaiABIAJqLQAAOgAAIAINAAsMAgsgAkEDTQ0AIAIhBANAIAMgASgCADYCACABQQRqIQEgA0EEaiEDIARBfGoiBEEDSw0ACyACQQNxIQILIAJFDQADQCADIAEtAAA6AAAgA0EBaiEDIAFBAWohASACQX9qIgINAAsLIAAL8wICAn8BfgJAIAJFDQAgACACaiIDQX9qIAE6AAAgACABOgAAIAJBA0kNACADQX5qIAE6AAAgACABOgABIANBfWogAToAACAAIAE6AAIgAkEHSQ0AIANBfGogAToAACAAIAE6AAMgAkEJSQ0AIABBACAAa0EDcSIEaiIDIAFB/wFxQYGChAhsIgE2AgAgAyACIARrQXxxIgRqIgJBfGogATYCACAEQQlJDQAgAyABNgIIIAMgATYCBCACQXhqIAE2AgAgAkF0aiABNgIAIARBGUkNACADIAE2AhggAyABNgIUIAMgATYCECADIAE2AgwgAkFwaiABNgIAIAJBbGogATYCACACQWhqIAE2AgAgAkFkaiABNgIAIAQgA0EEcUEYciIEayICQSBJDQAgAa0iBUIghiAFhCEFIAMgBGohAQNAIAEgBTcDGCABIAU3AxAgASAFNwMIIAEgBTcDACABQSBqIQEgAkFgaiICQR9LDQALCyAACy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAIajYCACADCy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAFajYCACADCx8AIAAgASACKAIEEAg2AgAgARAEGiAAIAJBCGo2AgQLCAAgAGdBH3MLugUBDX8jAEEQayIKJAACfyAEQQNNBEAgCkEANgIMIApBDGogAyAEEAsaIAAgASACIApBDGpBBBAVIgBBbCAAEAMbIAAgACAESxsMAQsgAEEAIAEoAgBBAXRBAmoQECENQVQgAygAACIGQQ9xIgBBCksNABogAiAAQQVqNgIAIAMgBGoiAkF8aiEMIAJBeWohDiACQXtqIRAgAEEGaiELQQQhBSAGQQR2IQRBICAAdCIAQQFyIQkgASgCACEPQQAhAiADIQYCQANAIAlBAkggAiAPS3JFBEAgAiEHAkAgCARAA0AgBEH//wNxQf//A0YEQCAHQRhqIQcgBiAQSQR/IAZBAmoiBigAACAFdgUgBUEQaiEFIARBEHYLIQQMAQsLA0AgBEEDcSIIQQNGBEAgBUECaiEFIARBAnYhBCAHQQNqIQcMAQsLIAcgCGoiByAPSw0EIAVBAmohBQNAIAIgB0kEQCANIAJBAXRqQQA7AQAgAkEBaiECDAELCyAGIA5LQQAgBiAFQQN1aiIHIAxLG0UEQCAHKAAAIAVBB3EiBXYhBAwCCyAEQQJ2IQQLIAYhBwsCfyALQX9qIAQgAEF/anEiBiAAQQF0QX9qIgggCWsiEUkNABogBCAIcSIEQQAgESAEIABIG2shBiALCyEIIA0gAkEBdGogBkF/aiIEOwEAIAlBASAGayAEIAZBAUgbayEJA0AgCSAASARAIABBAXUhACALQX9qIQsMAQsLAn8gByAOS0EAIAcgBSAIaiIFQQN1aiIGIAxLG0UEQCAFQQdxDAELIAUgDCIGIAdrQQN0awshBSACQQFqIQIgBEUhCCAGKAAAIAVBH3F2IQQMAQsLQWwgCUEBRyAFQSBKcg0BGiABIAJBf2o2AgAgBiAFQQdqQQN1aiADawwBC0FQCyEAIApBEGokACAACwkAQQFBBSAAGwsMACAAIAEoAAA2AAALqgMBCn8jAEHwAGsiCiQAIAJBAWohDiAAQQhqIQtBgIAEIAVBf2p0QRB1IQxBACECQQEhBkEBIAV0IglBf2oiDyEIA0AgAiAORkUEQAJAIAEgAkEBdCINai8BACIHQf//A0YEQCALIAhBA3RqIAI2AgQgCEF/aiEIQQEhBwwBCyAGQQAgDCAHQRB0QRB1ShshBgsgCiANaiAHOwEAIAJBAWohAgwBCwsgACAFNgIEIAAgBjYCACAJQQN2IAlBAXZqQQNqIQxBACEAQQAhBkEAIQIDQCAGIA5GBEADQAJAIAAgCUYNACAKIAsgAEEDdGoiASgCBCIGQQF0aiICIAIvAQAiAkEBajsBACABIAUgAhAUayIIOgADIAEgAiAIQf8BcXQgCWs7AQAgASAEIAZBAnQiAmooAgA6AAIgASACIANqKAIANgIEIABBAWohAAwBCwsFIAEgBkEBdGouAQAhDUEAIQcDQCAHIA1ORQRAIAsgAkEDdGogBjYCBANAIAIgDGogD3EiAiAISw0ACyAHQQFqIQcMAQsLIAZBAWohBgwBCwsgCkHwAGokAAsjAEIAIAEQCSAAhUKHla+vmLbem55/fkLj3MqV/M7y9YV/fAsQACAAQn43AwggACABNgIACyQBAX8gAARAIAEoAgQiAgRAIAEoAgggACACEQEADwsgABAmCwsfACAAIAEgAi8BABAINgIAIAEQBBogACACQQRqNgIEC0oBAX9BoCAoAgAiASAAaiIAQX9MBEBBiCBBMDYCAEF/DwsCQCAAPwBBEHRNDQAgABBmDQBBiCBBMDYCAEF/DwtBoCAgADYCACABC9cBAQh/Qbp/IQoCQCACKAIEIgggAigCACIJaiIOIAEgAGtLDQBBbCEKIAkgBCADKAIAIgtrSw0AIAAgCWoiBCACKAIIIgxrIQ0gACABQWBqIg8gCyAJQQAQKSADIAkgC2o2AgACQAJAIAwgBCAFa00EQCANIQUMAQsgDCAEIAZrSw0CIAcgDSAFayIAaiIBIAhqIAdNBEAgBCABIAgQDxoMAgsgBCABQQAgAGsQDyEBIAIgACAIaiIINgIEIAEgAGshBAsgBCAPIAUgCEEBECkLIA4hCgsgCgubAgEBfyMAQYABayINJAAgDSADNgJ8AkAgAkEDSwRAQX8hCQwBCwJAAkACQAJAIAJBAWsOAwADAgELIAZFBEBBuH8hCQwEC0FsIQkgBS0AACICIANLDQMgACAHIAJBAnQiAmooAgAgAiAIaigCABA7IAEgADYCAEEBIQkMAwsgASAJNgIAQQAhCQwCCyAKRQRAQWwhCQwCC0EAIQkgC0UgDEEZSHINAUEIIAR0QQhqIQBBACECA0AgAiAATw0CIAJBQGshAgwAAAsAC0FsIQkgDSANQfwAaiANQfgAaiAFIAYQFSICEAMNACANKAJ4IgMgBEsNACAAIA0gDSgCfCAHIAggAxAYIAEgADYCACACIQkLIA1BgAFqJAAgCQsLACAAIAEgAhALGgsQACAALwAAIAAtAAJBEHRyCy8AAn9BuH8gAUEISQ0AGkFyIAAoAAQiAEF3Sw0AGkG4fyAAQQhqIgAgACABSxsLCwkAIAAgATsAAAsDAAELigYBBX8gACAAKAIAIgVBfnE2AgBBACAAIAVBAXZqQYQgKAIAIgQgAEYbIQECQAJAIAAoAgQiAkUNACACKAIAIgNBAXENACACQQhqIgUgA0EBdkF4aiIDQQggA0EISxtnQR9zQQJ0QYAfaiIDKAIARgRAIAMgAigCDDYCAAsgAigCCCIDBEAgAyACKAIMNgIECyACKAIMIgMEQCADIAIoAgg2AgALIAIgAigCACAAKAIAQX5xajYCAEGEICEAAkACQCABRQ0AIAEgAjYCBCABKAIAIgNBAXENASADQQF2QXhqIgNBCCADQQhLG2dBH3NBAnRBgB9qIgMoAgAgAUEIakYEQCADIAEoAgw2AgALIAEoAggiAwRAIAMgASgCDDYCBAsgASgCDCIDBEAgAyABKAIINgIAQYQgKAIAIQQLIAIgAigCACABKAIAQX5xajYCACABIARGDQAgASABKAIAQQF2akEEaiEACyAAIAI2AgALIAIoAgBBAXZBeGoiAEEIIABBCEsbZ0Efc0ECdEGAH2oiASgCACEAIAEgBTYCACACIAA2AgwgAkEANgIIIABFDQEgACAFNgIADwsCQCABRQ0AIAEoAgAiAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAigCACABQQhqRgRAIAIgASgCDDYCAAsgASgCCCICBEAgAiABKAIMNgIECyABKAIMIgIEQCACIAEoAgg2AgBBhCAoAgAhBAsgACAAKAIAIAEoAgBBfnFqIgI2AgACQCABIARHBEAgASABKAIAQQF2aiAANgIEIAAoAgAhAgwBC0GEICAANgIACyACQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgIoAgAhASACIABBCGoiAjYCACAAIAE2AgwgAEEANgIIIAFFDQEgASACNgIADwsgBUEBdkF4aiIBQQggAUEISxtnQR9zQQJ0QYAfaiICKAIAIQEgAiAAQQhqIgI2AgAgACABNgIMIABBADYCCCABRQ0AIAEgAjYCAAsLDgAgAARAIABBeGoQJQsLgAIBA38CQCAAQQ9qQXhxQYQgKAIAKAIAQQF2ayICEB1Bf0YNAAJAQYQgKAIAIgAoAgAiAUEBcQ0AIAFBAXZBeGoiAUEIIAFBCEsbZ0Efc0ECdEGAH2oiASgCACAAQQhqRgRAIAEgACgCDDYCAAsgACgCCCIBBEAgASAAKAIMNgIECyAAKAIMIgFFDQAgASAAKAIINgIAC0EBIQEgACAAKAIAIAJBAXRqIgI2AgAgAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAygCACECIAMgAEEIaiIDNgIAIAAgAjYCDCAAQQA2AgggAkUNACACIAM2AgALIAELtwIBA38CQAJAIABBASAAGyICEDgiAA0AAkACQEGEICgCACIARQ0AIAAoAgAiA0EBcQ0AIAAgA0EBcjYCACADQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgAgAEEIakYEQCABIAAoAgw2AgALIAAoAggiAQRAIAEgACgCDDYCBAsgACgCDCIBBEAgASAAKAIINgIACyACECchAkEAIQFBhCAoAgAhACACDQEgACAAKAIAQX5xNgIAQQAPCyACQQ9qQXhxIgMQHSICQX9GDQIgAkEHakF4cSIAIAJHBEAgACACaxAdQX9GDQMLAkBBhCAoAgAiAUUEQEGAICAANgIADAELIAAgATYCBAtBhCAgADYCACAAIANBAXRBAXI2AgAMAQsgAEUNAQsgAEEIaiEBCyABC7kDAQJ/IAAgA2ohBQJAIANBB0wEQANAIAAgBU8NAiAAIAItAAA6AAAgAEEBaiEAIAJBAWohAgwAAAsACyAEQQFGBEACQCAAIAJrIgZBB00EQCAAIAItAAA6AAAgACACLQABOgABIAAgAi0AAjoAAiAAIAItAAM6AAMgAEEEaiACIAZBAnQiBkHAHmooAgBqIgIQFyACIAZB4B5qKAIAayECDAELIAAgAhAMCyACQQhqIQIgAEEIaiEACwJAAkACQAJAIAUgAU0EQCAAIANqIQEgBEEBRyAAIAJrQQ9Kcg0BA0AgACACEAwgAkEIaiECIABBCGoiACABSQ0ACwwFCyAAIAFLBEAgACEBDAQLIARBAUcgACACa0EPSnINASAAIQMgAiEEA0AgAyAEEAwgBEEIaiEEIANBCGoiAyABSQ0ACwwCCwNAIAAgAhAHIAJBEGohAiAAQRBqIgAgAUkNAAsMAwsgACEDIAIhBANAIAMgBBAHIARBEGohBCADQRBqIgMgAUkNAAsLIAIgASAAa2ohAgsDQCABIAVPDQEgASACLQAAOgAAIAFBAWohASACQQFqIQIMAAALAAsLQQECfyAAIAAoArjgASIDNgLE4AEgACgCvOABIQQgACABNgK84AEgACABIAJqNgK44AEgACABIAQgA2tqNgLA4AELpgEBAX8gACAAKALs4QEQFjYCyOABIABCADcD+OABIABCADcDuOABIABBwOABakIANwMAIABBqNAAaiIBQYyAgOAANgIAIABBADYCmOIBIABCADcDiOEBIABCAzcDgOEBIABBrNABakHgEikCADcCACAAQbTQAWpB6BIoAgA2AgAgACABNgIMIAAgAEGYIGo2AgggACAAQaAwajYCBCAAIABBEGo2AgALYQEBf0G4fyEDAkAgAUEDSQ0AIAIgABAhIgFBA3YiADYCCCACIAFBAXE2AgQgAiABQQF2QQNxIgM2AgACQCADQX9qIgFBAksNAAJAIAFBAWsOAgEAAgtBbA8LIAAhAwsgAwsMACAAIAEgAkEAEC4LiAQCA38CfiADEBYhBCAAQQBBKBAQIQAgBCACSwRAIAQPCyABRQRAQX8PCwJAAkAgA0EBRg0AIAEoAAAiBkGo6r5pRg0AQXYhAyAGQXBxQdDUtMIBRw0BQQghAyACQQhJDQEgAEEAQSgQECEAIAEoAAQhASAAQQE2AhQgACABrTcDAEEADwsgASACIAMQLyIDIAJLDQAgACADNgIYQXIhAyABIARqIgVBf2otAAAiAkEIcQ0AIAJBIHEiBkUEQEFwIQMgBS0AACIFQacBSw0BIAVBB3GtQgEgBUEDdkEKaq2GIgdCA4h+IAd8IQggBEEBaiEECyACQQZ2IQMgAkECdiEFAkAgAkEDcUF/aiICQQJLBEBBACECDAELAkACQAJAIAJBAWsOAgECAAsgASAEai0AACECIARBAWohBAwCCyABIARqLwAAIQIgBEECaiEEDAELIAEgBGooAAAhAiAEQQRqIQQLIAVBAXEhBQJ+AkACQAJAIANBf2oiA0ECTQRAIANBAWsOAgIDAQtCfyAGRQ0DGiABIARqMQAADAMLIAEgBGovAACtQoACfAwCCyABIARqKAAArQwBCyABIARqKQAACyEHIAAgBTYCICAAIAI2AhwgACAHNwMAQQAhAyAAQQA2AhQgACAHIAggBhsiBzcDCCAAIAdCgIAIIAdCgIAIVBs+AhALIAMLWwEBf0G4fyEDIAIQFiICIAFNBH8gACACakF/ai0AACIAQQNxQQJ0QaAeaigCACACaiAAQQZ2IgFBAnRBsB5qKAIAaiAAQSBxIgBFaiABRSAAQQV2cWoFQbh/CwsdACAAKAKQ4gEQWiAAQQA2AqDiASAAQgA3A5DiAQu1AwEFfyMAQZACayIKJABBuH8hBgJAIAVFDQAgBCwAACIIQf8BcSEHAkAgCEF/TARAIAdBgn9qQQF2IgggBU8NAkFsIQYgB0GBf2oiBUGAAk8NAiAEQQFqIQdBACEGA0AgBiAFTwRAIAUhBiAIIQcMAwUgACAGaiAHIAZBAXZqIgQtAABBBHY6AAAgACAGQQFyaiAELQAAQQ9xOgAAIAZBAmohBgwBCwAACwALIAcgBU8NASAAIARBAWogByAKEFMiBhADDQELIAYhBEEAIQYgAUEAQTQQECEJQQAhBQNAIAQgBkcEQCAAIAZqIggtAAAiAUELSwRAQWwhBgwDBSAJIAFBAnRqIgEgASgCAEEBajYCACAGQQFqIQZBASAILQAAdEEBdSAFaiEFDAILAAsLQWwhBiAFRQ0AIAUQFEEBaiIBQQxLDQAgAyABNgIAQQFBASABdCAFayIDEBQiAXQgA0cNACAAIARqIAFBAWoiADoAACAJIABBAnRqIgAgACgCAEEBajYCACAJKAIEIgBBAkkgAEEBcXINACACIARBAWo2AgAgB0EBaiEGCyAKQZACaiQAIAYLxhEBDH8jAEHwAGsiBSQAQWwhCwJAIANBCkkNACACLwAAIQogAi8AAiEJIAIvAAQhByAFQQhqIAQQDgJAIAMgByAJIApqakEGaiIMSQ0AIAUtAAohCCAFQdgAaiACQQZqIgIgChAGIgsQAw0BIAVBQGsgAiAKaiICIAkQBiILEAMNASAFQShqIAIgCWoiAiAHEAYiCxADDQEgBUEQaiACIAdqIAMgDGsQBiILEAMNASAAIAFqIg9BfWohECAEQQRqIQZBASELIAAgAUEDakECdiIDaiIMIANqIgIgA2oiDiEDIAIhBCAMIQcDQCALIAMgEElxBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgCS0AAyELIAcgBiAFQUBrIAgQAkECdGoiCS8BADsAACAFQUBrIAktAAIQASAJLQADIQogBCAGIAVBKGogCBACQQJ0aiIJLwEAOwAAIAVBKGogCS0AAhABIAktAAMhCSADIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgDS0AAyENIAAgC2oiCyAGIAVB2ABqIAgQAkECdGoiAC8BADsAACAFQdgAaiAALQACEAEgAC0AAyEAIAcgCmoiCiAGIAVBQGsgCBACQQJ0aiIHLwEAOwAAIAVBQGsgBy0AAhABIActAAMhByAEIAlqIgkgBiAFQShqIAgQAkECdGoiBC8BADsAACAFQShqIAQtAAIQASAELQADIQQgAyANaiIDIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgACALaiEAIAcgCmohByAEIAlqIQQgAyANLQADaiEDIAVB2ABqEA0gBUFAaxANciAFQShqEA1yIAVBEGoQDXJFIQsMAQsLIAQgDksgByACS3INAEFsIQsgACAMSw0BIAxBfWohCQNAQQAgACAJSSAFQdgAahAEGwRAIAAgBiAFQdgAaiAIEAJBAnRqIgovAQA7AAAgBUHYAGogCi0AAhABIAAgCi0AA2oiACAGIAVB2ABqIAgQAkECdGoiCi8BADsAACAFQdgAaiAKLQACEAEgACAKLQADaiEADAEFIAxBfmohCgNAIAVB2ABqEAQgACAKS3JFBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgACAJLQADaiEADAELCwNAIAAgCk0EQCAAIAYgBUHYAGogCBACQQJ0aiIJLwEAOwAAIAVB2ABqIAktAAIQASAAIAktAANqIQAMAQsLAkAgACAMTw0AIAAgBiAFQdgAaiAIEAIiAEECdGoiDC0AADoAACAMLQADQQFGBEAgBUHYAGogDC0AAhABDAELIAUoAlxBH0sNACAFQdgAaiAGIABBAnRqLQACEAEgBSgCXEEhSQ0AIAVBIDYCXAsgAkF9aiEMA0BBACAHIAxJIAVBQGsQBBsEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiIAIAYgBUFAayAIEAJBAnRqIgcvAQA7AAAgBUFAayAHLQACEAEgACAHLQADaiEHDAEFIAJBfmohDANAIAVBQGsQBCAHIAxLckUEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwNAIAcgDE0EQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwJAIAcgAk8NACAHIAYgBUFAayAIEAIiAEECdGoiAi0AADoAACACLQADQQFGBEAgBUFAayACLQACEAEMAQsgBSgCREEfSw0AIAVBQGsgBiAAQQJ0ai0AAhABIAUoAkRBIUkNACAFQSA2AkQLIA5BfWohAgNAQQAgBCACSSAFQShqEAQbBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2oiACAGIAVBKGogCBACQQJ0aiIELwEAOwAAIAVBKGogBC0AAhABIAAgBC0AA2ohBAwBBSAOQX5qIQIDQCAFQShqEAQgBCACS3JFBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsDQCAEIAJNBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsCQCAEIA5PDQAgBCAGIAVBKGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBKGogAi0AAhABDAELIAUoAixBH0sNACAFQShqIAYgAEECdGotAAIQASAFKAIsQSFJDQAgBUEgNgIsCwNAQQAgAyAQSSAFQRBqEAQbBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2oiACAGIAVBEGogCBACQQJ0aiICLwEAOwAAIAVBEGogAi0AAhABIAAgAi0AA2ohAwwBBSAPQX5qIQIDQCAFQRBqEAQgAyACS3JFBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsDQCADIAJNBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsCQCADIA9PDQAgAyAGIAVBEGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBEGogAi0AAhABDAELIAUoAhRBH0sNACAFQRBqIAYgAEECdGotAAIQASAFKAIUQSFJDQAgBUEgNgIUCyABQWwgBUHYAGoQCiAFQUBrEApxIAVBKGoQCnEgBUEQahAKcRshCwwJCwAACwALAAALAAsAAAsACwAACwALQWwhCwsgBUHwAGokACALC7UEAQ5/IwBBEGsiBiQAIAZBBGogABAOQVQhBQJAIARB3AtJDQAgBi0ABCEHIANB8ARqQQBB7AAQECEIIAdBDEsNACADQdwJaiIJIAggBkEIaiAGQQxqIAEgAhAxIhAQA0UEQCAGKAIMIgQgB0sNASADQdwFaiEPIANBpAVqIREgAEEEaiESIANBqAVqIQEgBCEFA0AgBSICQX9qIQUgCCACQQJ0aigCAEUNAAsgAkEBaiEOQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgASALaiAKNgIAIAVBAWohBSAKIAxqIQoMAQsLIAEgCjYCAEEAIQUgBigCCCELA0AgBSALRkUEQCABIAUgCWotAAAiDEECdGoiDSANKAIAIg1BAWo2AgAgDyANQQF0aiINIAw6AAEgDSAFOgAAIAVBAWohBQwBCwtBACEBIANBADYCqAUgBEF/cyAHaiEJQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgAyALaiABNgIAIAwgBSAJanQgAWohASAFQQFqIQUMAQsLIAcgBEEBaiIBIAJrIgRrQQFqIQgDQEEBIQUgBCAIT0UEQANAIAUgDk9FBEAgBUECdCIJIAMgBEE0bGpqIAMgCWooAgAgBHY2AgAgBUEBaiEFDAELCyAEQQFqIQQMAQsLIBIgByAPIAogESADIAIgARBkIAZBAToABSAGIAc6AAYgACAGKAIENgIACyAQIQULIAZBEGokACAFC8ENAQt/IwBB8ABrIgUkAEFsIQkCQCADQQpJDQAgAi8AACEKIAIvAAIhDCACLwAEIQYgBUEIaiAEEA4CQCADIAYgCiAMampBBmoiDUkNACAFLQAKIQcgBUHYAGogAkEGaiICIAoQBiIJEAMNASAFQUBrIAIgCmoiAiAMEAYiCRADDQEgBUEoaiACIAxqIgIgBhAGIgkQAw0BIAVBEGogAiAGaiADIA1rEAYiCRADDQEgACABaiIOQX1qIQ8gBEEEaiEGQQEhCSAAIAFBA2pBAnYiAmoiCiACaiIMIAJqIg0hAyAMIQQgCiECA0AgCSADIA9JcQRAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAACAGIAVBQGsgBxACQQF0aiIILQAAIQsgBUFAayAILQABEAEgAiALOgAAIAYgBUEoaiAHEAJBAXRqIggtAAAhCyAFQShqIAgtAAEQASAEIAs6AAAgBiAFQRBqIAcQAkEBdGoiCC0AACELIAVBEGogCC0AARABIAMgCzoAACAGIAVB2ABqIAcQAkEBdGoiCC0AACELIAVB2ABqIAgtAAEQASAAIAs6AAEgBiAFQUBrIAcQAkEBdGoiCC0AACELIAVBQGsgCC0AARABIAIgCzoAASAGIAVBKGogBxACQQF0aiIILQAAIQsgBUEoaiAILQABEAEgBCALOgABIAYgBUEQaiAHEAJBAXRqIggtAAAhCyAFQRBqIAgtAAEQASADIAs6AAEgA0ECaiEDIARBAmohBCACQQJqIQIgAEECaiEAIAkgBUHYAGoQDUVxIAVBQGsQDUVxIAVBKGoQDUVxIAVBEGoQDUVxIQkMAQsLIAQgDUsgAiAMS3INAEFsIQkgACAKSw0BIApBfWohCQNAIAVB2ABqEAQgACAJT3JFBEAgBiAFQdgAaiAHEAJBAXRqIggtAAAhCyAFQdgAaiAILQABEAEgACALOgAAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAASAAQQJqIQAMAQsLA0AgBUHYAGoQBCAAIApPckUEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCwNAIAAgCkkEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCyAMQX1qIQADQCAFQUBrEAQgAiAAT3JFBEAgBiAFQUBrIAcQAkEBdGoiCi0AACEJIAVBQGsgCi0AARABIAIgCToAACAGIAVBQGsgBxACQQF0aiIKLQAAIQkgBUFAayAKLQABEAEgAiAJOgABIAJBAmohAgwBCwsDQCAFQUBrEAQgAiAMT3JFBEAgBiAFQUBrIAcQAkEBdGoiAC0AACEKIAVBQGsgAC0AARABIAIgCjoAACACQQFqIQIMAQsLA0AgAiAMSQRAIAYgBUFAayAHEAJBAXRqIgAtAAAhCiAFQUBrIAAtAAEQASACIAo6AAAgAkEBaiECDAELCyANQX1qIQADQCAFQShqEAQgBCAAT3JFBEAgBiAFQShqIAcQAkEBdGoiAi0AACEKIAVBKGogAi0AARABIAQgCjoAACAGIAVBKGogBxACQQF0aiICLQAAIQogBUEoaiACLQABEAEgBCAKOgABIARBAmohBAwBCwsDQCAFQShqEAQgBCANT3JFBEAgBiAFQShqIAcQAkEBdGoiAC0AACECIAVBKGogAC0AARABIAQgAjoAACAEQQFqIQQMAQsLA0AgBCANSQRAIAYgBUEoaiAHEAJBAXRqIgAtAAAhAiAFQShqIAAtAAEQASAEIAI6AAAgBEEBaiEEDAELCwNAIAVBEGoQBCADIA9PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIAYgBUEQaiAHEAJBAXRqIgAtAAAhAiAFQRBqIAAtAAEQASADIAI6AAEgA0ECaiEDDAELCwNAIAVBEGoQBCADIA5PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIANBAWohAwwBCwsDQCADIA5JBEAgBiAFQRBqIAcQAkEBdGoiAC0AACECIAVBEGogAC0AARABIAMgAjoAACADQQFqIQMMAQsLIAFBbCAFQdgAahAKIAVBQGsQCnEgBUEoahAKcSAFQRBqEApxGyEJDAELQWwhCQsgBUHwAGokACAJC8oCAQR/IwBBIGsiBSQAIAUgBBAOIAUtAAIhByAFQQhqIAIgAxAGIgIQA0UEQCAEQQRqIQIgACABaiIDQX1qIQQDQCAFQQhqEAQgACAET3JFBEAgAiAFQQhqIAcQAkEBdGoiBi0AACEIIAVBCGogBi0AARABIAAgCDoAACACIAVBCGogBxACQQF0aiIGLQAAIQggBUEIaiAGLQABEAEgACAIOgABIABBAmohAAwBCwsDQCAFQQhqEAQgACADT3JFBEAgAiAFQQhqIAcQAkEBdGoiBC0AACEGIAVBCGogBC0AARABIAAgBjoAACAAQQFqIQAMAQsLA0AgACADT0UEQCACIAVBCGogBxACQQF0aiIELQAAIQYgBUEIaiAELQABEAEgACAGOgAAIABBAWohAAwBCwsgAUFsIAVBCGoQChshAgsgBUEgaiQAIAILtgMBCX8jAEEQayIGJAAgBkEANgIMIAZBADYCCEFUIQQCQAJAIANBQGsiDCADIAZBCGogBkEMaiABIAIQMSICEAMNACAGQQRqIAAQDiAGKAIMIgcgBi0ABEEBaksNASAAQQRqIQogBkEAOgAFIAYgBzoABiAAIAYoAgQ2AgAgB0EBaiEJQQEhBANAIAQgCUkEQCADIARBAnRqIgEoAgAhACABIAU2AgAgACAEQX9qdCAFaiEFIARBAWohBAwBCwsgB0EBaiEHQQAhBSAGKAIIIQkDQCAFIAlGDQEgAyAFIAxqLQAAIgRBAnRqIgBBASAEdEEBdSILIAAoAgAiAWoiADYCACAHIARrIQhBACEEAkAgC0EDTQRAA0AgBCALRg0CIAogASAEakEBdGoiACAIOgABIAAgBToAACAEQQFqIQQMAAALAAsDQCABIABPDQEgCiABQQF0aiIEIAg6AAEgBCAFOgAAIAQgCDoAAyAEIAU6AAIgBCAIOgAFIAQgBToABCAEIAg6AAcgBCAFOgAGIAFBBGohAQwAAAsACyAFQQFqIQUMAAALAAsgAiEECyAGQRBqJAAgBAutAQECfwJAQYQgKAIAIABHIAAoAgBBAXYiAyABa0F4aiICQXhxQQhHcgR/IAIFIAMQJ0UNASACQQhqC0EQSQ0AIAAgACgCACICQQFxIAAgAWpBD2pBeHEiASAAa0EBdHI2AgAgASAANgIEIAEgASgCAEEBcSAAIAJBAXZqIAFrIgJBAXRyNgIAQYQgIAEgAkH/////B3FqQQRqQYQgKAIAIABGGyABNgIAIAEQJQsLygIBBX8CQAJAAkAgAEEIIABBCEsbZ0EfcyAAaUEBR2oiAUEESSAAIAF2cg0AIAFBAnRB/B5qKAIAIgJFDQADQCACQXhqIgMoAgBBAXZBeGoiBSAATwRAIAIgBUEIIAVBCEsbZ0Efc0ECdEGAH2oiASgCAEYEQCABIAIoAgQ2AgALDAMLIARBHksNASAEQQFqIQQgAigCBCICDQALC0EAIQMgAUEgTw0BA0AgAUECdEGAH2ooAgAiAkUEQCABQR5LIQIgAUEBaiEBIAJFDQEMAwsLIAIgAkF4aiIDKAIAQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgBGBEAgASACKAIENgIACwsgAigCACIBBEAgASACKAIENgIECyACKAIEIgEEQCABIAIoAgA2AgALIAMgAygCAEEBcjYCACADIAAQNwsgAwvhCwINfwV+IwBB8ABrIgckACAHIAAoAvDhASIINgJcIAEgAmohDSAIIAAoAoDiAWohDwJAAkAgBUUEQCABIQQMAQsgACgCxOABIRAgACgCwOABIREgACgCvOABIQ4gAEEBNgKM4QFBACEIA0AgCEEDRwRAIAcgCEECdCICaiAAIAJqQazQAWooAgA2AkQgCEEBaiEIDAELC0FsIQwgB0EYaiADIAQQBhADDQEgB0EsaiAHQRhqIAAoAgAQEyAHQTRqIAdBGGogACgCCBATIAdBPGogB0EYaiAAKAIEEBMgDUFgaiESIAEhBEEAIQwDQCAHKAIwIAcoAixBA3RqKQIAIhRCEIinQf8BcSEIIAcoAkAgBygCPEEDdGopAgAiFUIQiKdB/wFxIQsgBygCOCAHKAI0QQN0aikCACIWQiCIpyEJIBVCIIghFyAUQiCIpyECAkAgFkIQiKdB/wFxIgNBAk8EQAJAIAZFIANBGUlyRQRAIAkgB0EYaiADQSAgBygCHGsiCiAKIANLGyIKEAUgAyAKayIDdGohCSAHQRhqEAQaIANFDQEgB0EYaiADEAUgCWohCQwBCyAHQRhqIAMQBSAJaiEJIAdBGGoQBBoLIAcpAkQhGCAHIAk2AkQgByAYNwNIDAELAkAgA0UEQCACBEAgBygCRCEJDAMLIAcoAkghCQwBCwJAAkAgB0EYakEBEAUgCSACRWpqIgNBA0YEQCAHKAJEQX9qIgMgA0VqIQkMAQsgA0ECdCAHaigCRCIJIAlFaiEJIANBAUYNAQsgByAHKAJINgJMCwsgByAHKAJENgJIIAcgCTYCRAsgF6chAyALBEAgB0EYaiALEAUgA2ohAwsgCCALakEUTwRAIAdBGGoQBBoLIAgEQCAHQRhqIAgQBSACaiECCyAHQRhqEAQaIAcgB0EYaiAUQhiIp0H/AXEQCCAUp0H//wNxajYCLCAHIAdBGGogFUIYiKdB/wFxEAggFadB//8DcWo2AjwgB0EYahAEGiAHIAdBGGogFkIYiKdB/wFxEAggFqdB//8DcWo2AjQgByACNgJgIAcoAlwhCiAHIAk2AmggByADNgJkAkACQAJAIAQgAiADaiILaiASSw0AIAIgCmoiEyAPSw0AIA0gBGsgC0Egak8NAQsgByAHKQNoNwMQIAcgBykDYDcDCCAEIA0gB0EIaiAHQdwAaiAPIA4gESAQEB4hCwwBCyACIARqIQggBCAKEAcgAkERTwRAIARBEGohAgNAIAIgCkEQaiIKEAcgAkEQaiICIAhJDQALCyAIIAlrIQIgByATNgJcIAkgCCAOa0sEQCAJIAggEWtLBEBBbCELDAILIBAgAiAOayICaiIKIANqIBBNBEAgCCAKIAMQDxoMAgsgCCAKQQAgAmsQDyEIIAcgAiADaiIDNgJkIAggAmshCCAOIQILIAlBEE8EQCADIAhqIQMDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALDAELAkAgCUEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgCUECdCIDQcAeaigCAGoiAhAXIAIgA0HgHmooAgBrIQIgBygCZCEDDAELIAggAhAMCyADQQlJDQAgAyAIaiEDIAhBCGoiCCACQQhqIgJrQQ9MBEADQCAIIAIQDCACQQhqIQIgCEEIaiIIIANJDQAMAgALAAsDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALCyAHQRhqEAQaIAsgDCALEAMiAhshDCAEIAQgC2ogAhshBCAFQX9qIgUNAAsgDBADDQFBbCEMIAdBGGoQBEECSQ0BQQAhCANAIAhBA0cEQCAAIAhBAnQiAmpBrNABaiACIAdqKAJENgIAIAhBAWohCAwBCwsgBygCXCEIC0G6fyEMIA8gCGsiACANIARrSw0AIAQEfyAEIAggABALIABqBUEACyABayEMCyAHQfAAaiQAIAwLkRcCFn8FfiMAQdABayIHJAAgByAAKALw4QEiCDYCvAEgASACaiESIAggACgCgOIBaiETAkACQCAFRQRAIAEhAwwBCyAAKALE4AEhESAAKALA4AEhFSAAKAK84AEhDyAAQQE2AozhAUEAIQgDQCAIQQNHBEAgByAIQQJ0IgJqIAAgAmpBrNABaigCADYCVCAIQQFqIQgMAQsLIAcgETYCZCAHIA82AmAgByABIA9rNgJoQWwhECAHQShqIAMgBBAGEAMNASAFQQQgBUEESBshFyAHQTxqIAdBKGogACgCABATIAdBxABqIAdBKGogACgCCBATIAdBzABqIAdBKGogACgCBBATQQAhBCAHQeAAaiEMIAdB5ABqIQoDQCAHQShqEARBAksgBCAXTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEJIAcoAkggBygCREEDdGopAgAiH0IgiKchCCAeQiCIISAgHUIgiKchAgJAIB9CEIinQf8BcSIDQQJPBEACQCAGRSADQRlJckUEQCAIIAdBKGogA0EgIAcoAixrIg0gDSADSxsiDRAFIAMgDWsiA3RqIQggB0EoahAEGiADRQ0BIAdBKGogAxAFIAhqIQgMAQsgB0EoaiADEAUgCGohCCAHQShqEAQaCyAHKQJUISEgByAINgJUIAcgITcDWAwBCwJAIANFBEAgAgRAIAcoAlQhCAwDCyAHKAJYIQgMAQsCQAJAIAdBKGpBARAFIAggAkVqaiIDQQNGBEAgBygCVEF/aiIDIANFaiEIDAELIANBAnQgB2ooAlQiCCAIRWohCCADQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAg2AlQLICCnIQMgCQRAIAdBKGogCRAFIANqIQMLIAkgC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgAmohAgsgB0EoahAEGiAHIAcoAmggAmoiCSADajYCaCAKIAwgCCAJSxsoAgAhDSAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogB0EoaiAfQhiIp0H/AXEQCCEOIAdB8ABqIARBBHRqIgsgCSANaiAIazYCDCALIAg2AgggCyADNgIEIAsgAjYCACAHIA4gH6dB//8DcWo2AkQgBEEBaiEEDAELCyAEIBdIDQEgEkFgaiEYIAdB4ABqIRogB0HkAGohGyABIQMDQCAHQShqEARBAksgBCAFTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEIIAcoAkggBygCREEDdGopAgAiH0IgiKchCSAeQiCIISAgHUIgiKchDAJAIB9CEIinQf8BcSICQQJPBEACQCAGRSACQRlJckUEQCAJIAdBKGogAkEgIAcoAixrIgogCiACSxsiChAFIAIgCmsiAnRqIQkgB0EoahAEGiACRQ0BIAdBKGogAhAFIAlqIQkMAQsgB0EoaiACEAUgCWohCSAHQShqEAQaCyAHKQJUISEgByAJNgJUIAcgITcDWAwBCwJAIAJFBEAgDARAIAcoAlQhCQwDCyAHKAJYIQkMAQsCQAJAIAdBKGpBARAFIAkgDEVqaiICQQNGBEAgBygCVEF/aiICIAJFaiEJDAELIAJBAnQgB2ooAlQiCSAJRWohCSACQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAk2AlQLICCnIRQgCARAIAdBKGogCBAFIBRqIRQLIAggC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgDGohDAsgB0EoahAEGiAHIAcoAmggDGoiGSAUajYCaCAbIBogCSAZSxsoAgAhHCAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogByAHQShqIB9CGIinQf8BcRAIIB+nQf//A3FqNgJEIAcgB0HwAGogBEEDcUEEdGoiDSkDCCIdNwPIASAHIA0pAwAiHjcDwAECQAJAAkAgBygCvAEiDiAepyICaiIWIBNLDQAgAyAHKALEASIKIAJqIgtqIBhLDQAgEiADayALQSBqTw0BCyAHIAcpA8gBNwMQIAcgBykDwAE3AwggAyASIAdBCGogB0G8AWogEyAPIBUgERAeIQsMAQsgAiADaiEIIAMgDhAHIAJBEU8EQCADQRBqIQIDQCACIA5BEGoiDhAHIAJBEGoiAiAISQ0ACwsgCCAdpyIOayECIAcgFjYCvAEgDiAIIA9rSwRAIA4gCCAVa0sEQEFsIQsMAgsgESACIA9rIgJqIhYgCmogEU0EQCAIIBYgChAPGgwCCyAIIBZBACACaxAPIQggByACIApqIgo2AsQBIAggAmshCCAPIQILIA5BEE8EQCAIIApqIQoDQCAIIAIQByACQRBqIQIgCEEQaiIIIApJDQALDAELAkAgDkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgDkECdCIKQcAeaigCAGoiAhAXIAIgCkHgHmooAgBrIQIgBygCxAEhCgwBCyAIIAIQDAsgCkEJSQ0AIAggCmohCiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAKSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAKSQ0ACwsgCxADBEAgCyEQDAQFIA0gDDYCACANIBkgHGogCWs2AgwgDSAJNgIIIA0gFDYCBCAEQQFqIQQgAyALaiEDDAILAAsLIAQgBUgNASAEIBdrIQtBACEEA0AgCyAFSARAIAcgB0HwAGogC0EDcUEEdGoiAikDCCIdNwPIASAHIAIpAwAiHjcDwAECQAJAAkAgBygCvAEiDCAepyICaiIKIBNLDQAgAyAHKALEASIJIAJqIhBqIBhLDQAgEiADayAQQSBqTw0BCyAHIAcpA8gBNwMgIAcgBykDwAE3AxggAyASIAdBGGogB0G8AWogEyAPIBUgERAeIRAMAQsgAiADaiEIIAMgDBAHIAJBEU8EQCADQRBqIQIDQCACIAxBEGoiDBAHIAJBEGoiAiAISQ0ACwsgCCAdpyIGayECIAcgCjYCvAEgBiAIIA9rSwRAIAYgCCAVa0sEQEFsIRAMAgsgESACIA9rIgJqIgwgCWogEU0EQCAIIAwgCRAPGgwCCyAIIAxBACACaxAPIQggByACIAlqIgk2AsQBIAggAmshCCAPIQILIAZBEE8EQCAIIAlqIQYDQCAIIAIQByACQRBqIQIgCEEQaiIIIAZJDQALDAELAkAgBkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgBkECdCIGQcAeaigCAGoiAhAXIAIgBkHgHmooAgBrIQIgBygCxAEhCQwBCyAIIAIQDAsgCUEJSQ0AIAggCWohBiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAGSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAGSQ0ACwsgEBADDQMgC0EBaiELIAMgEGohAwwBCwsDQCAEQQNHBEAgACAEQQJ0IgJqQazQAWogAiAHaigCVDYCACAEQQFqIQQMAQsLIAcoArwBIQgLQbp/IRAgEyAIayIAIBIgA2tLDQAgAwR/IAMgCCAAEAsgAGoFQQALIAFrIRALIAdB0AFqJAAgEAslACAAQgA3AgAgAEEAOwEIIABBADoACyAAIAE2AgwgACACOgAKC7QFAQN/IwBBMGsiBCQAIABB/wFqIgVBfWohBgJAIAMvAQIEQCAEQRhqIAEgAhAGIgIQAw0BIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahASOgAAIAMgBEEIaiAEQRhqEBI6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0FIAEgBEEQaiAEQRhqEBI6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBSABIARBCGogBEEYahASOgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEjoAACABIAJqIABrIQIMAwsgAyAEQRBqIARBGGoQEjoAAiADIARBCGogBEEYahASOgADIANBBGohAwwAAAsACyAEQRhqIAEgAhAGIgIQAw0AIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahAROgAAIAMgBEEIaiAEQRhqEBE6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0EIAEgBEEQaiAEQRhqEBE6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBCABIARBCGogBEEYahAROgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEToAACABIAJqIABrIQIMAgsgAyAEQRBqIARBGGoQEToAAiADIARBCGogBEEYahAROgADIANBBGohAwwAAAsACyAEQTBqJAAgAgtpAQF/An8CQAJAIAJBB00NACABKAAAQbfIwuF+Rw0AIAAgASgABDYCmOIBQWIgAEEQaiABIAIQPiIDEAMNAhogAEKBgICAEDcDiOEBIAAgASADaiACIANrECoMAQsgACABIAIQKgtBAAsLrQMBBn8jAEGAAWsiAyQAQWIhCAJAIAJBCUkNACAAQZjQAGogAUEIaiIEIAJBeGogAEGY0AAQMyIFEAMiBg0AIANBHzYCfCADIANB/ABqIANB+ABqIAQgBCAFaiAGGyIEIAEgAmoiAiAEaxAVIgUQAw0AIAMoAnwiBkEfSw0AIAMoAngiB0EJTw0AIABBiCBqIAMgBkGAC0GADCAHEBggA0E0NgJ8IAMgA0H8AGogA0H4AGogBCAFaiIEIAIgBGsQFSIFEAMNACADKAJ8IgZBNEsNACADKAJ4IgdBCk8NACAAQZAwaiADIAZBgA1B4A4gBxAYIANBIzYCfCADIANB/ABqIANB+ABqIAQgBWoiBCACIARrEBUiBRADDQAgAygCfCIGQSNLDQAgAygCeCIHQQpPDQAgACADIAZBwBBB0BEgBxAYIAQgBWoiBEEMaiIFIAJLDQAgAiAFayEFQQAhAgNAIAJBA0cEQCAEKAAAIgZBf2ogBU8NAiAAIAJBAnRqQZzQAWogBjYCACACQQFqIQIgBEEEaiEEDAELCyAEIAFrIQgLIANBgAFqJAAgCAtGAQN/IABBCGohAyAAKAIEIQJBACEAA0AgACACdkUEQCABIAMgAEEDdGotAAJBFktqIQEgAEEBaiEADAELCyABQQggAmt0C4YDAQV/Qbh/IQcCQCADRQ0AIAItAAAiBEUEQCABQQA2AgBBAUG4fyADQQFGGw8LAn8gAkEBaiIFIARBGHRBGHUiBkF/Sg0AGiAGQX9GBEAgA0EDSA0CIAUvAABBgP4BaiEEIAJBA2oMAQsgA0ECSA0BIAItAAEgBEEIdHJBgIB+aiEEIAJBAmoLIQUgASAENgIAIAVBAWoiASACIANqIgNLDQBBbCEHIABBEGogACAFLQAAIgVBBnZBI0EJIAEgAyABa0HAEEHQEUHwEiAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBmCBqIABBCGogBUEEdkEDcUEfQQggASABIAZqIAgbIgEgAyABa0GAC0GADEGAFyAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBoDBqIABBBGogBUECdkEDcUE0QQkgASABIAZqIAgbIgEgAyABa0GADUHgDkGQGSAAKAKM4QEgACgCnOIBIAQQHyIAEAMNACAAIAFqIAJrIQcLIAcLrQMBCn8jAEGABGsiCCQAAn9BUiACQf8BSw0AGkFUIANBDEsNABogAkEBaiELIABBBGohCUGAgAQgA0F/anRBEHUhCkEAIQJBASEEQQEgA3QiB0F/aiIMIQUDQCACIAtGRQRAAkAgASACQQF0Ig1qLwEAIgZB//8DRgRAIAkgBUECdGogAjoAAiAFQX9qIQVBASEGDAELIARBACAKIAZBEHRBEHVKGyEECyAIIA1qIAY7AQAgAkEBaiECDAELCyAAIAQ7AQIgACADOwEAIAdBA3YgB0EBdmpBA2ohBkEAIQRBACECA0AgBCALRkUEQCABIARBAXRqLgEAIQpBACEAA0AgACAKTkUEQCAJIAJBAnRqIAQ6AAIDQCACIAZqIAxxIgIgBUsNAAsgAEEBaiEADAELCyAEQQFqIQQMAQsLQX8gAg0AGkEAIQIDfyACIAdGBH9BAAUgCCAJIAJBAnRqIgAtAAJBAXRqIgEgAS8BACIBQQFqOwEAIAAgAyABEBRrIgU6AAMgACABIAVB/wFxdCAHazsBACACQQFqIQIMAQsLCyEFIAhBgARqJAAgBQvjBgEIf0FsIQcCQCACQQNJDQACQAJAAkACQCABLQAAIgNBA3EiCUEBaw4DAwEAAgsgACgCiOEBDQBBYg8LIAJBBUkNAkEDIQYgASgAACEFAn8CQAJAIANBAnZBA3EiCEF+aiIEQQFNBEAgBEEBaw0BDAILIAVBDnZB/wdxIQQgBUEEdkH/B3EhAyAIRQwCCyAFQRJ2IQRBBCEGIAVBBHZB//8AcSEDQQAMAQsgBUEEdkH//w9xIgNBgIAISw0DIAEtAARBCnQgBUEWdnIhBEEFIQZBAAshBSAEIAZqIgogAksNAgJAIANBgQZJDQAgACgCnOIBRQ0AQQAhAgNAIAJBg4ABSw0BIAJBQGshAgwAAAsACwJ/IAlBA0YEQCABIAZqIQEgAEHw4gFqIQIgACgCDCEGIAUEQCACIAMgASAEIAYQXwwCCyACIAMgASAEIAYQXQwBCyAAQbjQAWohAiABIAZqIQEgAEHw4gFqIQYgAEGo0ABqIQggBQRAIAggBiADIAEgBCACEF4MAQsgCCAGIAMgASAEIAIQXAsQAw0CIAAgAzYCgOIBIABBATYCiOEBIAAgAEHw4gFqNgLw4QEgCUECRgRAIAAgAEGo0ABqNgIMCyAAIANqIgBBiOMBakIANwAAIABBgOMBakIANwAAIABB+OIBakIANwAAIABB8OIBakIANwAAIAoPCwJ/AkACQAJAIANBAnZBA3FBf2oiBEECSw0AIARBAWsOAgACAQtBASEEIANBA3YMAgtBAiEEIAEvAABBBHYMAQtBAyEEIAEQIUEEdgsiAyAEaiIFQSBqIAJLBEAgBSACSw0CIABB8OIBaiABIARqIAMQCyEBIAAgAzYCgOIBIAAgATYC8OEBIAEgA2oiAEIANwAYIABCADcAECAAQgA3AAggAEIANwAAIAUPCyAAIAM2AoDiASAAIAEgBGo2AvDhASAFDwsCfwJAAkACQCADQQJ2QQNxQX9qIgRBAksNACAEQQFrDgIAAgELQQEhByADQQN2DAILQQIhByABLwAAQQR2DAELIAJBBEkgARAhIgJBj4CAAUtyDQFBAyEHIAJBBHYLIQIgAEHw4gFqIAEgB2otAAAgAkEgahAQIQEgACACNgKA4gEgACABNgLw4QEgB0EBaiEHCyAHC0sAIABC+erQ0OfJoeThADcDICAAQgA3AxggAELP1tO+0ser2UI3AxAgAELW64Lu6v2J9eAANwMIIABCADcDACAAQShqQQBBKBAQGgviAgICfwV+IABBKGoiASAAKAJIaiECAn4gACkDACIDQiBaBEAgACkDECIEQgeJIAApAwgiBUIBiXwgACkDGCIGQgyJfCAAKQMgIgdCEol8IAUQGSAEEBkgBhAZIAcQGQwBCyAAKQMYQsXP2bLx5brqJ3wLIAN8IQMDQCABQQhqIgAgAk0EQEIAIAEpAAAQCSADhUIbiUKHla+vmLbem55/fkLj3MqV/M7y9YV/fCEDIAAhAQwBCwsCQCABQQRqIgAgAksEQCABIQAMAQsgASgAAK1Ch5Wvr5i23puef34gA4VCF4lCz9bTvtLHq9lCfkL5893xmfaZqxZ8IQMLA0AgACACSQRAIAAxAABCxc/ZsvHluuonfiADhUILiUKHla+vmLbem55/fiEDIABBAWohAAwBCwsgA0IhiCADhULP1tO+0ser2UJ+IgNCHYggA4VC+fPd8Zn2masWfiIDQiCIIAOFC+8CAgJ/BH4gACAAKQMAIAKtfDcDAAJAAkAgACgCSCIDIAJqIgRBH00EQCABRQ0BIAAgA2pBKGogASACECAgACgCSCACaiEEDAELIAEgAmohAgJ/IAMEQCAAQShqIgQgA2ogAUEgIANrECAgACAAKQMIIAQpAAAQCTcDCCAAIAApAxAgACkAMBAJNwMQIAAgACkDGCAAKQA4EAk3AxggACAAKQMgIABBQGspAAAQCTcDICAAKAJIIQMgAEEANgJIIAEgA2tBIGohAQsgAUEgaiACTQsEQCACQWBqIQMgACkDICEFIAApAxghBiAAKQMQIQcgACkDCCEIA0AgCCABKQAAEAkhCCAHIAEpAAgQCSEHIAYgASkAEBAJIQYgBSABKQAYEAkhBSABQSBqIgEgA00NAAsgACAFNwMgIAAgBjcDGCAAIAc3AxAgACAINwMICyABIAJPDQEgAEEoaiABIAIgAWsiBBAgCyAAIAQ2AkgLCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQEBogAwVBun8LCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQCxogAwVBun8LC6gCAQZ/IwBBEGsiByQAIABB2OABaikDAEKAgIAQViEIQbh/IQUCQCAEQf//B0sNACAAIAMgBBBCIgUQAyIGDQAgACgCnOIBIQkgACAHQQxqIAMgAyAFaiAGGyIKIARBACAFIAYbayIGEEAiAxADBEAgAyEFDAELIAcoAgwhBCABRQRAQbp/IQUgBEEASg0BCyAGIANrIQUgAyAKaiEDAkAgCQRAIABBADYCnOIBDAELAkACQAJAIARBBUgNACAAQdjgAWopAwBCgICACFgNAAwBCyAAQQA2ApziAQwBCyAAKAIIED8hBiAAQQA2ApziASAGQRRPDQELIAAgASACIAMgBSAEIAgQOSEFDAELIAAgASACIAMgBSAEIAgQOiEFCyAHQRBqJAAgBQtnACAAQdDgAWogASACIAAoAuzhARAuIgEQAwRAIAEPC0G4fyECAkAgAQ0AIABB7OABaigCACIBBEBBYCECIAAoApjiASABRw0BC0EAIQIgAEHw4AFqKAIARQ0AIABBkOEBahBDCyACCycBAX8QVyIERQRAQUAPCyAEIAAgASACIAMgBBBLEE8hACAEEFYgAAs/AQF/AkACQAJAIAAoAqDiAUEBaiIBQQJLDQAgAUEBaw4CAAECCyAAEDBBAA8LIABBADYCoOIBCyAAKAKU4gELvAMCB38BfiMAQRBrIgkkAEG4fyEGAkAgBCgCACIIQQVBCSAAKALs4QEiBRtJDQAgAygCACIHQQFBBSAFGyAFEC8iBRADBEAgBSEGDAELIAggBUEDakkNACAAIAcgBRBJIgYQAw0AIAEgAmohCiAAQZDhAWohCyAIIAVrIQIgBSAHaiEHIAEhBQNAIAcgAiAJECwiBhADDQEgAkF9aiICIAZJBEBBuH8hBgwCCyAJKAIAIghBAksEQEFsIQYMAgsgB0EDaiEHAn8CQAJAAkAgCEEBaw4CAgABCyAAIAUgCiAFayAHIAYQSAwCCyAFIAogBWsgByAGEEcMAQsgBSAKIAVrIActAAAgCSgCCBBGCyIIEAMEQCAIIQYMAgsgACgC8OABBEAgCyAFIAgQRQsgAiAGayECIAYgB2ohByAFIAhqIQUgCSgCBEUNAAsgACkD0OABIgxCf1IEQEFsIQYgDCAFIAFrrFINAQsgACgC8OABBEBBaiEGIAJBBEkNASALEEQhDCAHKAAAIAynRw0BIAdBBGohByACQXxqIQILIAMgBzYCACAEIAI2AgAgBSABayEGCyAJQRBqJAAgBgsuACAAECsCf0EAQQAQAw0AGiABRSACRXJFBEBBYiAAIAEgAhA9EAMNARoLQQALCzcAIAEEQCAAIAAoAsTgASABKAIEIAEoAghqRzYCnOIBCyAAECtBABADIAFFckUEQCAAIAEQWwsL0QIBB38jAEEQayIGJAAgBiAENgIIIAYgAzYCDCAFBEAgBSgCBCEKIAUoAgghCQsgASEIAkACQANAIAAoAuzhARAWIQsCQANAIAQgC0kNASADKAAAQXBxQdDUtMIBRgRAIAMgBBAiIgcQAw0EIAQgB2shBCADIAdqIQMMAQsLIAYgAzYCDCAGIAQ2AggCQCAFBEAgACAFEE5BACEHQQAQA0UNAQwFCyAAIAogCRBNIgcQAw0ECyAAIAgQUCAMQQFHQQAgACAIIAIgBkEMaiAGQQhqEEwiByIDa0EAIAMQAxtBCkdyRQRAQbh/IQcMBAsgBxADDQMgAiAHayECIAcgCGohCEEBIQwgBigCDCEDIAYoAgghBAwBCwsgBiADNgIMIAYgBDYCCEG4fyEHIAQNASAIIAFrIQcMAQsgBiADNgIMIAYgBDYCCAsgBkEQaiQAIAcLRgECfyABIAAoArjgASICRwRAIAAgAjYCxOABIAAgATYCuOABIAAoArzgASEDIAAgATYCvOABIAAgASADIAJrajYCwOABCwutAgIEfwF+IwBBQGoiBCQAAkACQCACQQhJDQAgASgAAEFwcUHQ1LTCAUcNACABIAIQIiEBIABCADcDCCAAQQA2AgQgACABNgIADAELIARBGGogASACEC0iAxADBEAgACADEBoMAQsgAwRAIABBuH8QGgwBCyACIAQoAjAiA2shAiABIANqIQMDQAJAIAAgAyACIARBCGoQLCIFEAMEfyAFBSACIAVBA2oiBU8NAUG4fwsQGgwCCyAGQQFqIQYgAiAFayECIAMgBWohAyAEKAIMRQ0ACyAEKAI4BEAgAkEDTQRAIABBuH8QGgwCCyADQQRqIQMLIAQoAighAiAEKQMYIQcgAEEANgIEIAAgAyABazYCACAAIAIgBmytIAcgB0J/URs3AwgLIARBQGskAAslAQF/IwBBEGsiAiQAIAIgACABEFEgAigCACEAIAJBEGokACAAC30BBH8jAEGQBGsiBCQAIARB/wE2AggCQCAEQRBqIARBCGogBEEMaiABIAIQFSIGEAMEQCAGIQUMAQtBVCEFIAQoAgwiB0EGSw0AIAMgBEEQaiAEKAIIIAcQQSIFEAMNACAAIAEgBmogAiAGayADEDwhBQsgBEGQBGokACAFC4cBAgJ/An5BABAWIQMCQANAIAEgA08EQAJAIAAoAABBcHFB0NS0wgFGBEAgACABECIiAhADRQ0BQn4PCyAAIAEQVSIEQn1WDQMgBCAFfCIFIARUIQJCfiEEIAINAyAAIAEQUiICEAMNAwsgASACayEBIAAgAmohAAwBCwtCfiAFIAEbIQQLIAQLPwIBfwF+IwBBMGsiAiQAAn5CfiACQQhqIAAgARAtDQAaQgAgAigCHEEBRg0AGiACKQMICyEDIAJBMGokACADC40BAQJ/IwBBMGsiASQAAkAgAEUNACAAKAKI4gENACABIABB/OEBaigCADYCKCABIAApAvThATcDICAAEDAgACgCqOIBIQIgASABKAIoNgIYIAEgASkDIDcDECACIAFBEGoQGyAAQQA2AqjiASABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALKgECfyMAQRBrIgAkACAAQQA2AgggAEIANwMAIAAQWCEBIABBEGokACABC4cBAQN/IwBBEGsiAiQAAkAgACgCAEUgACgCBEVzDQAgAiAAKAIINgIIIAIgACkCADcDAAJ/IAIoAgAiAQRAIAIoAghBqOMJIAERBQAMAQtBqOMJECgLIgFFDQAgASAAKQIANwL04QEgAUH84QFqIAAoAgg2AgAgARBZIAEhAwsgAkEQaiQAIAMLywEBAn8jAEEgayIBJAAgAEGBgIDAADYCtOIBIABBADYCiOIBIABBADYC7OEBIABCADcDkOIBIABBADYCpOMJIABBADYC3OIBIABCADcCzOIBIABBADYCvOIBIABBADYCxOABIABCADcCnOIBIABBpOIBakIANwIAIABBrOIBakEANgIAIAFCADcCECABQgA3AhggASABKQMYNwMIIAEgASkDEDcDACABKAIIQQh2QQFxIQIgAEEANgLg4gEgACACNgKM4gEgAUEgaiQAC3YBA38jAEEwayIBJAAgAARAIAEgAEHE0AFqIgIoAgA2AiggASAAKQK80AE3AyAgACgCACEDIAEgAigCADYCGCABIAApArzQATcDECADIAFBEGoQGyABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALzAEBAX8gACABKAK00AE2ApjiASAAIAEoAgQiAjYCwOABIAAgAjYCvOABIAAgAiABKAIIaiICNgK44AEgACACNgLE4AEgASgCuNABBEAgAEKBgICAEDcDiOEBIAAgAUGk0ABqNgIMIAAgAUGUIGo2AgggACABQZwwajYCBCAAIAFBDGo2AgAgAEGs0AFqIAFBqNABaigCADYCACAAQbDQAWogAUGs0AFqKAIANgIAIABBtNABaiABQbDQAWooAgA2AgAPCyAAQgA3A4jhAQs7ACACRQRAQbp/DwsgBEUEQEFsDwsgAiAEEGAEQCAAIAEgAiADIAQgBRBhDwsgACABIAIgAyAEIAUQZQtGAQF/IwBBEGsiBSQAIAVBCGogBBAOAn8gBS0ACQRAIAAgASACIAMgBBAyDAELIAAgASACIAMgBBA0CyEAIAVBEGokACAACzQAIAAgAyAEIAUQNiIFEAMEQCAFDwsgBSAESQR/IAEgAiADIAVqIAQgBWsgABA1BUG4fwsLRgEBfyMAQRBrIgUkACAFQQhqIAQQDgJ/IAUtAAkEQCAAIAEgAiADIAQQYgwBCyAAIAEgAiADIAQQNQshACAFQRBqJAAgAAtZAQF/QQ8hAiABIABJBEAgAUEEdCAAbiECCyAAQQh2IgEgAkEYbCIAQYwIaigCAGwgAEGICGooAgBqIgJBA3YgAmogAEGACGooAgAgAEGECGooAgAgAWxqSQs3ACAAIAMgBCAFQYAQEDMiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQMgVBuH8LC78DAQN/IwBBIGsiBSQAIAVBCGogAiADEAYiAhADRQRAIAAgAWoiB0F9aiEGIAUgBBAOIARBBGohAiAFLQACIQMDQEEAIAAgBkkgBUEIahAEGwRAIAAgAiAFQQhqIAMQAkECdGoiBC8BADsAACAFQQhqIAQtAAIQASAAIAQtAANqIgQgAiAFQQhqIAMQAkECdGoiAC8BADsAACAFQQhqIAAtAAIQASAEIAAtAANqIQAMAQUgB0F+aiEEA0AgBUEIahAEIAAgBEtyRQRAIAAgAiAFQQhqIAMQAkECdGoiBi8BADsAACAFQQhqIAYtAAIQASAAIAYtAANqIQAMAQsLA0AgACAES0UEQCAAIAIgBUEIaiADEAJBAnRqIgYvAQA7AAAgBUEIaiAGLQACEAEgACAGLQADaiEADAELCwJAIAAgB08NACAAIAIgBUEIaiADEAIiA0ECdGoiAC0AADoAACAALQADQQFGBEAgBUEIaiAALQACEAEMAQsgBSgCDEEfSw0AIAVBCGogAiADQQJ0ai0AAhABIAUoAgxBIUkNACAFQSA2AgwLIAFBbCAFQQhqEAobIQILCwsgBUEgaiQAIAILkgIBBH8jAEFAaiIJJAAgCSADQTQQCyEDAkAgBEECSA0AIAMgBEECdGooAgAhCSADQTxqIAgQIyADQQE6AD8gAyACOgA+QQAhBCADKAI8IQoDQCAEIAlGDQEgACAEQQJ0aiAKNgEAIARBAWohBAwAAAsAC0EAIQkDQCAGIAlGRQRAIAMgBSAJQQF0aiIKLQABIgtBAnRqIgwoAgAhBCADQTxqIAotAABBCHQgCGpB//8DcRAjIANBAjoAPyADIAcgC2siCiACajoAPiAEQQEgASAKa3RqIQogAygCPCELA0AgACAEQQJ0aiALNgEAIARBAWoiBCAKSQ0ACyAMIAo2AgAgCUEBaiEJDAELCyADQUBrJAALowIBCX8jAEHQAGsiCSQAIAlBEGogBUE0EAsaIAcgBmshDyAHIAFrIRADQAJAIAMgCkcEQEEBIAEgByACIApBAXRqIgYtAAEiDGsiCGsiC3QhDSAGLQAAIQ4gCUEQaiAMQQJ0aiIMKAIAIQYgCyAPTwRAIAAgBkECdGogCyAIIAUgCEE0bGogCCAQaiIIQQEgCEEBShsiCCACIAQgCEECdGooAgAiCEEBdGogAyAIayAHIA4QYyAGIA1qIQgMAgsgCUEMaiAOECMgCUEBOgAPIAkgCDoADiAGIA1qIQggCSgCDCELA0AgBiAITw0CIAAgBkECdGogCzYBACAGQQFqIQYMAAALAAsgCUHQAGokAA8LIAwgCDYCACAKQQFqIQoMAAALAAs0ACAAIAMgBCAFEDYiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQNAVBuH8LCyMAIAA/AEEQdGtB//8DakEQdkAAQX9GBEBBAA8LQQAQAEEBCzsBAX8gAgRAA0AgACABIAJBgCAgAkGAIEkbIgMQCyEAIAFBgCBqIQEgAEGAIGohACACIANrIgINAAsLCwYAIAAQAwsLqBUJAEGICAsNAQAAAAEAAAACAAAAAgBBoAgLswYBAAAAAQAAAAIAAAACAAAAJgAAAIIAAAAhBQAASgAAAGcIAAAmAAAAwAEAAIAAAABJBQAASgAAAL4IAAApAAAALAIAAIAAAABJBQAASgAAAL4IAAAvAAAAygIAAIAAAACKBQAASgAAAIQJAAA1AAAAcwMAAIAAAACdBQAASgAAAKAJAAA9AAAAgQMAAIAAAADrBQAASwAAAD4KAABEAAAAngMAAIAAAABNBgAASwAAAKoKAABLAAAAswMAAIAAAADBBgAATQAAAB8NAABNAAAAUwQAAIAAAAAjCAAAUQAAAKYPAABUAAAAmQQAAIAAAABLCQAAVwAAALESAABYAAAA2gQAAIAAAABvCQAAXQAAACMUAABUAAAARQUAAIAAAABUCgAAagAAAIwUAABqAAAArwUAAIAAAAB2CQAAfAAAAE4QAAB8AAAA0gIAAIAAAABjBwAAkQAAAJAHAACSAAAAAAAAAAEAAAABAAAABQAAAA0AAAAdAAAAPQAAAH0AAAD9AAAA/QEAAP0DAAD9BwAA/Q8AAP0fAAD9PwAA/X8AAP3/AAD9/wEA/f8DAP3/BwD9/w8A/f8fAP3/PwD9/38A/f//AP3//wH9//8D/f//B/3//w/9//8f/f//P/3//38AAAAAAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABEAAAASAAAAEwAAABQAAAAVAAAAFgAAABcAAAAYAAAAGQAAABoAAAAbAAAAHAAAAB0AAAAeAAAAHwAAAAMAAAAEAAAABQAAAAYAAAAHAAAACAAAAAkAAAAKAAAACwAAAAwAAAANAAAADgAAAA8AAAAQAAAAEQAAABIAAAATAAAAFAAAABUAAAAWAAAAFwAAABgAAAAZAAAAGgAAABsAAAAcAAAAHQAAAB4AAAAfAAAAIAAAACEAAAAiAAAAIwAAACUAAAAnAAAAKQAAACsAAAAvAAAAMwAAADsAAABDAAAAUwAAAGMAAACDAAAAAwEAAAMCAAADBAAAAwgAAAMQAAADIAAAA0AAAAOAAAADAAEAQeAPC1EBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAEAAAABQAAAAcAAAAIAAAACQAAAAoAAAALAAAADAAAAA0AAAAOAAAADwAAABAAQcQQC4sBAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABIAAAAUAAAAFgAAABgAAAAcAAAAIAAAACgAAAAwAAAAQAAAAIAAAAAAAQAAAAIAAAAEAAAACAAAABAAAAAgAAAAQAAAAIAAAAAAAQBBkBIL5gQBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAAAEAAAAEAAAACAAAAAAAAAABAAEBBgAAAAAAAAQAAAAAEAAABAAAAAAgAAAFAQAAAAAAAAUDAAAAAAAABQQAAAAAAAAFBgAAAAAAAAUHAAAAAAAABQkAAAAAAAAFCgAAAAAAAAUMAAAAAAAABg4AAAAAAAEFEAAAAAAAAQUUAAAAAAABBRYAAAAAAAIFHAAAAAAAAwUgAAAAAAAEBTAAAAAgAAYFQAAAAAAABwWAAAAAAAAIBgABAAAAAAoGAAQAAAAADAYAEAAAIAAABAAAAAAAAAAEAQAAAAAAAAUCAAAAIAAABQQAAAAAAAAFBQAAACAAAAUHAAAAAAAABQgAAAAgAAAFCgAAAAAAAAULAAAAAAAABg0AAAAgAAEFEAAAAAAAAQUSAAAAIAABBRYAAAAAAAIFGAAAACAAAwUgAAAAAAADBSgAAAAAAAYEQAAAABAABgRAAAAAIAAHBYAAAAAAAAkGAAIAAAAACwYACAAAMAAABAAAAAAQAAAEAQAAACAAAAUCAAAAIAAABQMAAAAgAAAFBQAAACAAAAUGAAAAIAAABQgAAAAgAAAFCQAAACAAAAULAAAAIAAABQwAAAAAAAAGDwAAACAAAQUSAAAAIAABBRQAAAAgAAIFGAAAACAAAgUcAAAAIAADBSgAAAAgAAQFMAAAAAAAEAYAAAEAAAAPBgCAAAAAAA4GAEAAAAAADQYAIABBgBcLhwIBAAEBBQAAAAAAAAUAAAAAAAAGBD0AAAAAAAkF/QEAAAAADwX9fwAAAAAVBf3/HwAAAAMFBQAAAAAABwR9AAAAAAAMBf0PAAAAABIF/f8DAAAAFwX9/38AAAAFBR0AAAAAAAgE/QAAAAAADgX9PwAAAAAUBf3/DwAAAAIFAQAAABAABwR9AAAAAAALBf0HAAAAABEF/f8BAAAAFgX9/z8AAAAEBQ0AAAAQAAgE/QAAAAAADQX9HwAAAAATBf3/BwAAAAEFAQAAABAABgQ9AAAAAAAKBf0DAAAAABAF/f8AAAAAHAX9//8PAAAbBf3//wcAABoF/f//AwAAGQX9//8BAAAYBf3//wBBkBkLhgQBAAEBBgAAAAAAAAYDAAAAAAAABAQAAAAgAAAFBQAAAAAAAAUGAAAAAAAABQgAAAAAAAAFCQAAAAAAAAULAAAAAAAABg0AAAAAAAAGEAAAAAAAAAYTAAAAAAAABhYAAAAAAAAGGQAAAAAAAAYcAAAAAAAABh8AAAAAAAAGIgAAAAAAAQYlAAAAAAABBikAAAAAAAIGLwAAAAAAAwY7AAAAAAAEBlMAAAAAAAcGgwAAAAAACQYDAgAAEAAABAQAAAAAAAAEBQAAACAAAAUGAAAAAAAABQcAAAAgAAAFCQAAAAAAAAUKAAAAAAAABgwAAAAAAAAGDwAAAAAAAAYSAAAAAAAABhUAAAAAAAAGGAAAAAAAAAYbAAAAAAAABh4AAAAAAAAGIQAAAAAAAQYjAAAAAAABBicAAAAAAAIGKwAAAAAAAwYzAAAAAAAEBkMAAAAAAAUGYwAAAAAACAYDAQAAIAAABAQAAAAwAAAEBAAAABAAAAQFAAAAIAAABQcAAAAgAAAFCAAAACAAAAUKAAAAIAAABQsAAAAAAAAGDgAAAAAAAAYRAAAAAAAABhQAAAAAAAAGFwAAAAAAAAYaAAAAAAAABh0AAAAAAAAGIAAAAAAAEAYDAAEAAAAPBgOAAAAAAA4GA0AAAAAADQYDIAAAAAAMBgMQAAAAAAsGAwgAAAAACgYDBABBpB0L2QEBAAAAAwAAAAcAAAAPAAAAHwAAAD8AAAB/AAAA/wAAAP8BAAD/AwAA/wcAAP8PAAD/HwAA/z8AAP9/AAD//wAA//8BAP//AwD//wcA//8PAP//HwD//z8A//9/AP///wD///8B////A////wf///8P////H////z////9/AAAAAAEAAAACAAAABAAAAAAAAAACAAAABAAAAAgAAAAAAAAAAQAAAAIAAAABAAAABAAAAAQAAAAEAAAABAAAAAgAAAAIAAAACAAAAAcAAAAIAAAACQAAAAoAAAALAEGgIAsDwBBQ";function zu(i){return i}(t=>{t.INVALID=t("");function e(n){return n}t.toString=e})(zu||(zu={}));function fg(i){return i}(t=>{t.INVALID=t("");function e(n){return n}t.toString=e})(fg||(fg={}));function _g(i){return i}(t=>{t.INVALID=t("");function e(n){return n}t.toString=e})(_g||(_g={}));function Ag(i){return i}(t=>{t.INVALID=t("");function e(n){return n}t.toString=e})(Ag||(Ag={}));function rl(i){return i}(t=>{t.INVALID=t("");function e(n){return n}t.toString=e})(rl||(rl={}));function Sg(i){return i}(t=>{t.INVALID=t("");function e(n){return n}t.toString=e})(Sg||(Sg={}));function yg(i){return i}(t=>{t.INVALID=t("");function e(n){return n}t.toString=e})(yg||(yg={}));function bg(i){return i}(t=>{t.INVALID=t("");function e(n){return n}t.toString=e})(bg||(bg={}));function Tg(i){return i}(t=>{t.INVALID=t("");function e(n){return n}t.toString=e})(Tg||(Tg={}));function Wu(i){return i}(t=>{t.INVALID=t("");function e(n){return n}t.toString=e})(Wu||(Wu={}));function vg(i){return i}(t=>{t.INVALID=t("");function e(n){return n}t.toString=e})(vg||(vg={}));function Ig(i){return i}(t=>{t.INVALID=t("");function e(n){return n}t.toString=e})(Ig||(Ig={}));function Eg(i){return i}(t=>{t.INVALID=t("");function e(n){return n}t.toString=e})(Eg||(Eg={}));function ol(i){return i}(t=>{t.INVALID=t("");function e(n){return n}t.toString=e})(ol||(ol={}));function Cg(i){return i}(t=>{t.INVALID=t("");function e(n){return n}t.toString=e})(Cg||(Cg={}));function Rg(i){return i}(t=>{t.INVALID=t("");function e(n){return n}t.toString=e})(Rg||(Rg={}));function Ng(i){return i}(t=>{t.INVALID=t("");function e(n){return n}t.toString=e})(Ng||(Ng={}));function Og(i){return i}(t=>{t.INVALID=t("");function e(n){return n}t.toString=e})(Og||(Og={}));var By;(o=>(o.toString=qi,o.fromString=Yi,o.fromKiwi=Xi,o.isEqual=Ji,o.isValid=ji))(By||(By={}));var Vy;(o=>(o.toString=qi,o.fromString=Yi,o.fromKiwi=Xi,o.isEqual=Ji,o.isValid=ji))(Vy||(Vy={}));var ky;(o=>(o.toString=qi,o.fromString=Yi,o.fromKiwi=Xi,o.isEqual=Ji,o.isValid=ji))(ky||(ky={}));var Uy;(o=>(o.toString=qi,o.fromString=Yi,o.fromKiwi=Xi,o.isEqual=Ji,o.isValid=ji))(Uy||(Uy={}));var Gy;(o=>(o.toString=qi,o.fromString=Yi,o.fromKiwi=Xi,o.isEqual=Ji,o.isValid=ji))(Gy||(Gy={}));var Hy;(o=>(o.toString=qi,o.fromString=Yi,o.fromKiwi=Xi,o.isEqual=Ji,o.isValid=ji))(Hy||(Hy={}));var zy;(o=>(o.toString=qi,o.fromString=Yi,o.fromKiwi=Xi,o.isEqual=Ji,o.isValid=ji))(zy||(zy={}));var Wy;(o=>(o.toString=qi,o.fromString=Yi,o.fromKiwi=Xi,o.isEqual=Ji,o.isValid=ji))(Wy||(Wy={}));var Qy;(o=>(o.toString=qi,o.fromString=Yi,o.fromKiwi=Xi,o.isEqual=Ji,o.isValid=ji))(Qy||(Qy={}));function qi({key:i,version:e}){return`${zu.toString(i)}/${Wu.toString(e)}`}function Yi(i){let e=i.split("/");if(e.length!==2)return null;let[t,n]=e;return t&&n?{key:t,version:n}:null}function Xi({key:i,version:e}){return!i||!e?null:{key:i,version:e}}function Ji(i,e){return!i||!e?i===e:i.key===e.key&&i.version===e.version}function ji({key:i,version:e}){return!!(i&&e)}var we=class i{blendMode(){return this._blendMode}blurColor(){return this._blurColor}blurOffset(){return this._blurOffset}blurRadius(){return this._blurRadius}spread(){return this._spread}isEnabled(){return this._isEnabled}opacity(){return this._opacity}showShadowBehindNode(){return this._showShadowBehindNode}type(){return this._type}setBlendMode(e){this._blendMode=e}setBlurColor(e){this._blurColor=e}setBlurOffset(e){this._blurOffset=e}setBlurOffset1(e){this._blurOffset=e.clone()}setBlurRadius(e){this._blurRadius=e}setSpread(e){this._spread=e}setIsEnabled(e){this._isEnabled=e}setOpacity(e){this._opacity=e}setShowShadowBehindNode(e){this._showShadowBehindNode=e}setType(e){this._type=e}clone(){let e=new i;return e.setBlendMode(this.blendMode()),e.setBlurColor(this.blurColor()),e.setBlurOffset1(this.blurOffset().clone()),e.setBlurRadius(this.blurRadius()),e.setSpread(this.spread()),e.setIsEnabled(this.isEnabled()),e.setOpacity(this.opacity()),e.setShowShadowBehindNode(this.showShadowBehindNode()),e.setType(this.type()),e}isVisibleForRendering(){switch(this.type()){case"DROP_SHADOW":return this.isEnabled()&&E.alpha(this.blurColor())>0&&this.opacity()>0;case"INNER_SHADOW":return this.isEnabled()&&E.alpha(this.blurColor())>0&&this.opacity()>0&&(this.blurRadius()>0||this.blurOffset().x()!=0||this.blurOffset().y()!=0||this.spread()>0);case"BACKGROUND_BLUR":return this.isEnabled()&&this.blurRadius()>0;case"FOREGROUND_BLUR":return this.isEnabled()&&this.blurRadius()>0}return!1}isEnabledAndVisible(){return this.isEnabled()&&this.opacity()>0}equals(e){return this.blendMode()==e.blendMode()&&this.blurColor()==e.blurColor()&&this.blurOffset().equals(e.blurOffset())&&this.blurRadius()==e.blurRadius()&&this.spread()==e.spread()&&this.showShadowBehindNode()==e.showShadowBehindNode()&&this.isEnabled()==e.isEnabled()&&this.opacity()==e.opacity()&&this.type()==e.type()}static createForegroundBlur(e){let t=new i;return t.setType("FOREGROUND_BLUR"),t.setBlurRadius(e),t}static createBackgroundBlur(e){let t=new i;return t.setType("BACKGROUND_BLUR"),t.setBlurRadius(e),t}static createInnerShadow(e,t,n,r){let o=new i;return o.setType("INNER_SHADOW"),o.setBlurRadius(e),o.setBlurOffset(t),o.setBlurColor(n),o.setOpacity(r),o}static createDropShadow1(e,t,n,r){return i.createDropShadow3(e,t,n,r,0,!0)}static createDropShadow2(e,t,n,r,o){return i.createDropShadow3(e,t,n,r,o,!0)}static createDropShadow3(e,t,n,r,o,a){let s=new i;return s.setType("DROP_SHADOW"),s.setBlurRadius(e),s.setBlurOffset(t),s.setBlurColor(n),s.setOpacity(r),s.setSpread(o),s.setShowShadowBehindNode(a),s}constructor(){this._blendMode="NORMAL",this._blurColor=E.TRANSPARENT,this._blurOffset=Ie.FrozenVector_ZERO,this._blurRadius=0,this._spread=0,this._isEnabled=!0,this._opacity=1,this._showShadowBehindNode=!1,this._type="DROP_SHADOW"}};var ar=class{constructor(e,t){this.a=e,this.b=t}};var il=class{imageType(){return this._imageType}setImageType(e){this._imageType=e}constructor(e,t){this._ctx=null,this._decodeCallback=null,this._failureCallback=null,this._texture=null,this._imageHash=null,this._isImageMockLoading=!1,this._mockDecodedData=null,this._imageType=1,this._ctx=e,this._imageHash=t}width(){return 0}height(){return 0}url(){return"https://dummy-url"}hash(){return this._imageHash}state(){return this._mockDecodedData!=null?2:this._isImageMockLoading?1:0}gif(){return null}decodedData(){return this._mockDecodedData}texture(){return this._texture}setTexture(e){this._texture=e}loadDidFail(){return!1}objectHash(){return`Image(${this._imageHash})`}fetchAndDecode(e,t,n){this._isImageMockLoading||(this._decodeCallback=t,this._failureCallback=n,this._isImageMockLoading=!0,this._ctx.markImageFetched(this))}imageLoads(){this._isImageMockLoading&&(this._mockDecodedData=new mn(0,1,1,new Uint8Array(1)),this._decodeCallback(this._mockDecodedData),this._isImageMockLoading=!1)}imageFailsToLoad(){this._isImageMockLoading=!1,this._failureCallback(0)}freeMemoryForDecodedDataAndTexture(){return this.freeMemoryForDecodedData(),this._texture=null,!0}freeMemoryForDecodedData(){return this._mockDecodedData=null,this._isImageMockLoading=!1,!0}isDecoded(){return this._mockDecodedData!=null}isGIF(){return!1}};var Xn=class{add(e){this._observers=en.FrozenList_cloneAndAppendOne(this._observers,e)}remove(e){this._observers=en.FrozenList_cloneAndRemoveOne(this._observers,e)}forEach(e){let t=this._observers;t.forEach(n=>{(t==this._observers||this._observers.indexOf(n)!=-1)&&e(n)})}constructor(){this._observers=[]}};var po=class i{constructor(e,t){this._offset=null,this._scale=0,this._offset=e,this._scale=t}offset(){return this._offset}scale(){return this._scale}setOffset(e){this._offset=e}setScale(e){this._scale=e}clone(){return new i(this.offset(),this.scale())}equals(e){return this._offset.equals(e.offset())&&this._scale==e.scale()}translate1(e,t){this._offset.setX(this._offset.x()+e*this._scale),this._offset.setY(this._offset.y()+t*this._scale)}translate2(e){this.translate1(e.x(),e.y())}translatedBy1(e){return this.translatedBy2(e.x(),e.y())}translatedBy2(e,t){return this.translate1(e,t),this}scaledBy(e){return this._scale=this._scale*e,this}multiply(e){this._offset=this._offset.add1(e.offset().multiply(this._scale)),this._scale=this._scale*e.scale()}multipliedBy(e){return this.multiply(e),this}transformRect(e){if(e.isInvalid())return e.copyFrom(G.INVALID);if(!e.isFinite())return e.copyFrom(G.INFINITE);let t=new _t;return t.include2(this.transformPoint(e.topLeft())),t.include2(this.transformPoint(e.bottomRight())),t.buildTo(e),e}inverseTransformRect(e){if(e.isInvalid())return e.copyFrom(G.INVALID);if(!e.isFinite())return e.copyFrom(G.INFINITE);let t=new _t;return t.include2(this.inverseTransformPoint(e.topLeft())),t.include2(this.inverseTransformPoint(e.bottomRight())),t.buildTo(e),e}transformPoint(e){return e.multiplyUpdate(this._scale),e.addUpdate1(this._offset),e}inverseTransformPoint(e){return e.subtractUpdate1(this._offset),e.divideUpdate(this._scale),e}transformDirection(e){return e.multiplyUpdate(this._scale),e}inverseTransformDirection(e){return e.divideUpdate(this._scale),e}invert(){let e=1/this.scale();return isNaN(e)?!1:(this._offset=this._offset.negative().multiply(e),this._scale=e,!0)}copyFrom(e){return this._offset.copyFrom(e.offset()),this._scale=e.scale(),this}toString(){return`SimpleTransform({${this.offset().x()}, ${this.offset().y()}}, ${this.scale()})`}static new2(){return new i(I.new2(),1)}static new3(e){return new i(e.offset(),e.scale())}},Ky;(o=>{function i(){return po.new2()}o.FrozenSimpleTransform_new1=i;function e(a){return a}o.FrozenSimpleTransform_new2=e;function t(a){return po.new3(a)}o.FrozenSimpleTransform_new3=t;function n(a,s){return new po(a,s)}o.FrozenSimpleTransform_new4=n,o.FrozenSimpleTransform_IDENTITY=i()})(Ky||(Ky={}));var Ia=(u=>(u[u.NONE=0]="NONE",u[u.ZOOM_IN=1]="ZOOM_IN",u[u.ZOOM_OUT=2]="ZOOM_OUT",u[u.ZOOM_RESET=3]="ZOOM_RESET",u[u.ZOOM_TO_FIT=4]="ZOOM_TO_FIT",u[u.MIRROR_TAP=5]="MIRROR_TAP",u[u.CANVAS_MOUSE_DOWN=6]="CANVAS_MOUSE_DOWN",u[u.CANVAS_MOUSE_MOVE=7]="CANVAS_MOUSE_MOVE",u[u.CANVAS_MOUSE_DRAG=8]="CANVAS_MOUSE_DRAG",u[u.CANVAS_MOUSE_UP=9]="CANVAS_MOUSE_UP",u[u.CANVAS_TOUCH_DOWN=10]="CANVAS_TOUCH_DOWN",u[u.REQUEST_CANVAS_CHANGE=11]="REQUEST_CANVAS_CHANGE",u))(Ia||{}),qy;(e=>{function i(t){return Ia[t]}e.Action_toString=i})(qy||(qy={}));var Qu=(n=>(n[n.BOUNCING=0]="BOUNCING",n[n.CLAMPING=1]="CLAMPING",n[n.DEFAULT=2]="DEFAULT",n))(Qu||{});function wg(i){switch(i){case 2:case 4:return 0;case 1:case 3:case 5:return 1;default:return 2}}var al=class{createBallisticScrollSimulation(e,t,n,r,o,a){return null}applyOverscrollBehavior(e,t,n,r){return t}constructor(){}},cl=(r=>(r[r.FRICTION=0]="FRICTION",r[r.SPRING=1]="SPRING",r[r.FIXED=2]="FIXED",r[r.CURVE=3]="CURVE",r))(cl||{}),Ea=class{constructor(){this._startTime=0,this._startTime=ke.seconds()}endPos(){return new I(this._xSimulation().endPos(),this._ySimulation().endPos())}pos1(){return this.pos2(this.elapsed())}pos2(e){return new I(this._xSimulation().pos(e),this._ySimulation().pos(e))}dPos(e){return new I(this._xSimulation().dPos(e),this._ySimulation().dPos(e))}elapsed(){return ke.seconds()-this._startTime}isDone1(){return this.isDone2(this.elapsed())}isOverscrolled(){return!1}isDone2(e){return this._xSimulation().isDone(e)&&this._ySimulation().isDone(e)}xSimulation(e){return this._xSimulation().typeAt(e)}ySimulation(e){return this._ySimulation().typeAt(e)}},wc=class wc{static withDampingRatio(e,t,n){return new wc(e,t,n*2*Math.sqrt(e*t))}constructor(e,t,n){this.mass=e,this.stiffness=t,this.damping=n}};wc.DEFAULT_SPRING=wc.withDampingRatio(.5,100,1.1);var sl=wc,ll=class{constructor(e,t){this.velocity=e,this.distance=t}},Yy;(e=>{function i(t){return Qu[t]}e.ScrollPhysicsType_toString=i})(Yy||(Yy={}));var Xy;(e=>{function i(t){return cl[t]}e.SimulationType_toString=i})(Xy||(Xy={}));function xg(){return typeof window<"u"&&typeof rr()=="number"?new ll(1/(.05*rr()),1/rr()):new ll(1/.05,1)}var dl=class{constructor(){if(arguments.length==2){let e=arguments[0],t=arguments[1];this._pos=0,this._velocity=0,this._vSign=0,this._duration=0,this._distance=0,this._friction=.015,this._initialVelocityPenetration=3.065,this._decelerationRate=Math.log(.78)/Math.log(.9),this._pos=e,this._velocity=t,this._vSign=Math.abs(this._velocity)/this._velocity|0,this._duration=this._flingDuration(t),this._distance=Math.abs(t*this._duration/this._initialVelocityPenetration)}else if(arguments.length==3){let e=arguments[0],t=arguments[1],n=arguments[2];this._pos=0,this._velocity=0,this._vSign=0,this._duration=0,this._distance=0,this._friction=.015,this._initialVelocityPenetration=3.065,this._decelerationRate=Math.log(.78)/Math.log(.9),this._pos=e,this._velocity=t,this._vSign=Math.abs(this._velocity)/this._velocity|0,this._duration=n,this._distance=Math.abs(t*this._duration/this._initialVelocityPenetration)}}duration(){return this._duration}pos(e){if(this._duration==0)return this._pos;let t=un.Math_clamp1(e/this._duration,0,1);return this._pos+this._distance*this._flingDistancePenetration(t)*this._vSign}dPos(e){if(this._duration==0)return this._velocity;let t=un.Math_clamp1(e/this._duration,0,1);return this._distance*this._flingVelocityPenetration(t)*this._vSign/this._duration}isDone(e){return e>=this._duration}endPos(){return this._pos+this._distance}_decelerationForFriction(e){return e*61774.04968}_flingDuration(e){let t=this._friction*this._decelerationForFriction(.84),n=Math.log(.35*Math.abs(e)/t);return Math.exp(n/(this._decelerationRate-1))}_flingDistancePenetration(e){return 1.2*e*e*e-3.27*e*e+this._initialVelocityPenetration*e}_flingVelocityPenetration(e){return 3.6*e*e-6.54*e+this._initialVelocityPenetration}},xc=class{constructor(){if(arguments.length==4){let e=arguments[0],t=arguments[1],n=arguments[2],r=arguments[3];this._drag=0,this._dragLog=0,this._p=0,this._v=0,this._tolerance=null,this._drag=e,this._dragLog=Math.log(e),this._p=t,this._v=n,this._tolerance=r}else if(arguments.length==3){let e=arguments[0],t=arguments[1],n=arguments[2];this._drag=0,this._dragLog=0,this._p=0,this._v=0,this._tolerance=null,this._drag=e,this._dragLog=Math.log(e),this._p=t,this._v=n,this._tolerance=xg()}}pos(e){return this._p+this._v*Math.pow(this._drag,e)/this._dragLog-this._v/this._dragLog}dPos(e){return this._v*Math.pow(this._drag,e)}endPos(){return this._p-this._v/this._dragLog}timeAtPos(e){if(e==this._p)return 0;let t=this.endPos();return this._v==0||(this._v>0?e<this._p||e>t:e>this._p||e<t)?1/0:Math.log(this._dragLog*(e-this._p)/this._v+1)/this._dragLog}isDone(e){return Math.abs(this.dPos(e))<this._tolerance.velocity}},Ca=class{constructor(){if(arguments.length==5){let e=arguments[0],t=arguments[1],n=arguments[2],r=arguments[3],o=arguments[4];this._r1=0,this._r2=0,this._c1=0,this._c2=0,this._end=0,this._tolerance=null;let a=t-n,s=e.damping*e.damping-4*e.mass*e.stiffness;this._r1=(-e.damping-Math.sqrt(s))/(2*e.mass),this._r2=(-e.damping+Math.sqrt(s))/(2*e.mass),this._c2=(-(a*this._r1)+r)/(this._r2-this._r1),this._c1=a-this._c2,this._end=n,this._tolerance=o}else if(arguments.length==4){let e=arguments[0],t=arguments[1],n=arguments[2],r=arguments[3];this._r1=0,this._r2=0,this._c1=0,this._c2=0,this._end=0,this._tolerance=null;let o=t-n,a=e.damping*e.damping-4*e.mass*e.stiffness;this._r1=(-e.damping-Math.sqrt(a))/(2*e.mass),this._r2=(-e.damping+Math.sqrt(a))/(2*e.mass),this._c2=(-(o*this._r1)+r)/(this._r2-this._r1),this._c1=o-this._c2,this._end=n,this._tolerance=xg()}}endPos(){return this._end}pos(e){return this._end+this._c1*Math.pow(Math.E,this._r1*e)+this._c2*Math.pow(Math.E,this._r2*e)}dPos(e){return this._c1*this._r1*Math.pow(Math.E,this._r1*e)+this._c2*this._r2*Math.pow(Math.E,this._r2*e)}isDone(e){return Math.abs(this.pos(e)-this._end)<=this._tolerance.distance&&Math.abs(this.dPos(e))<=this._tolerance.velocity}},_s=class{pos(e){return this._c}dPos(e){return 0}isDone(e){return!0}endPos(){return this._c}constructor(e){this._c=e}};var Pc=class{applyOverscrollBehavior(e,t,n,r){let o=e.subtract1(n),s=e.subtract1(t).divide1(r).makeAbs(),l=this._frictionFactor2(s);return n.add1(l.multiply1(o))}_frictionFactor1(e){return e==0?1:.52*Math.pow(1-e,2)}_frictionFactor2(e){return new I(this._frictionFactor1(e.x()),this._frictionFactor1(e.y()))}createBallisticScrollSimulation(e,t,n,r,o,a){return new ul(e,t,n,r,o,a)}constructor(){}},ul=class extends Ea{constructor(t,n,r,o,a,s){super();this._xSim=null,this._ySim=null;let l=sl.DEFAULT_SPRING;this._xSim=new Ku(t.x(),n.x(),r,o,l),this._ySim=new Ku(t.y(),n.y(),a,s,l)}_xSimulation(){return this._xSim}_ySimulation(){return this._ySim}isOverscrolled(){return this._xSimulation().typeAt(this.elapsed())==1||this._ySimulation().typeAt(this.elapsed())==1}},Ku=class{constructor(e,t,n,r,o){if(this._frictionSimulationIOS=null,this._springSimulation=null,this._fixedSolution=null,this._startTime=0,this._springTime=0,this._timeOffset=0,e<n)this._springSimulation=new Ca(o,e,n,t),this._springTime=-1/0;else if(e>r)this._springSimulation=new Ca(o,e,r,t),this._springTime=-1/0;else if(t==0)this._fixedSolution=new _s(e);else{this._frictionSimulationIOS=new xc(kC,e,t);let a=this._frictionSimulationIOS.endPos();t>0&&a>r?(this._springTime=this._frictionSimulationIOS.timeAtPos(r),this._springSimulation=new Ca(o,r,r,Math.min(this._frictionSimulationIOS.dPos(this._springTime),Jy))):t<0&&a<n?(this._springTime=this._frictionSimulationIOS.timeAtPos(n),this._springSimulation=new Ca(o,n,n,Math.min(this._frictionSimulationIOS.dPos(this._springTime),Jy))):this._springTime=1/0}}_simulation(e){return this._fixedSolution!=null?this._fixedSolution:e>this._springTime?(this._timeOffset=isFinite(this._springTime)?this._springTime:0,this._springSimulation):(this._timeOffset=0,this._frictionSimulationIOS)}typeAt(e){return this._fixedSolution!=null?2:e<=this._springTime?0:1}endPos(){return this._fixedSolution!=null?this._fixedSolution.pos(0):isFinite(this._springTime)||this._springTime<0?this._springSimulation.endPos():this._frictionSimulationIOS.endPos()}pos(e){return this._simulation(e).pos(e-this._timeOffset)}dPos(e){return this._simulation(e).dPos(e-this._timeOffset)}isDone(e){return this._simulation(e).isDone(e-this._timeOffset)}},Jy=5e3,kC=.135;var Fc=class{createBallisticScrollSimulation(e,t,n,r,o,a){return new Pg(e,t,n,r,o,a)}applyOverscrollBehavior(e,t,n,r){return t}constructor(){}},Pg=class extends Ea{constructor(t,n,r,o,a,s){super();if(this._xSim=null,this._ySim=null,Math.abs(n.x())>Math.abs(n.y())){this._xSim=new pl(t.x(),n.x(),r,o);let l=Math.abs(n.y())>=jy?n.y():0;this._ySim=new pl(t.y(),l,a,s,this._xSimulation().duration())}else{this._ySim=new pl(t.y(),n.y(),a,s);let l=Math.abs(n.x())>=jy?n.x():0;this._xSim=new pl(t.x(),l,r,o,this._ySimulation().duration())}}_xSimulation(){return this._xSim}_ySimulation(){return this._ySim}},pl=class{constructor(){if(arguments.length==4){let e=arguments[0],t=arguments[1],n=arguments[2],r=arguments[3];this._startTime=0,this._simulation=null,this._min=0,this._max=0,this._duration=-1/0,this._min=n,this._max=r,t==0?this._simulation=new _s(e):(this._simulation=new dl(e,t),this._duration=this._simulation.duration()),this._startTime=ke.seconds()}else if(arguments.length==5){let e=arguments[0],t=arguments[1],n=arguments[2],r=arguments[3],o=arguments[4];this._startTime=0,this._simulation=null,this._min=0,this._max=0,this._duration=-1/0,this._min=n,this._max=r,t==0?this._simulation=new _s(e):this._simulation=new dl(e,t,o),this._startTime=ke.seconds()}}duration(){return this._duration}pos(e){let t=this._simulation.pos(e);return t<=this._min?this._min:t>=this._max?this._max:t}dPos(e){return this._simulation.dPos(e)}endPos(){return this._simulation.endPos()}isDone(e){if(this._simulation.isDone(e))return!0;let t=this.pos(e);return t>=this._max||t<=this._min}elapsed(){return ke.seconds()-this._startTime}typeAt(e){return 0}},jy=50;var Dc=class extends Ea{constructor(t,n,r,o){super();this._xSim=null,this._ySim=null,this._xSim=new qu(t.x(),n.x(),r,o),this._ySim=new qu(t.y(),n.y(),r,o)}_xSimulation(){return this._xSim}_ySimulation(){return this._ySim}},qu=class{constructor(e,t,n,r){this._begin=0,this._end=0,this._duration=0,this._curve=null,this._begin=e,this._end=t,this._duration=n,this._curve=r}pos(e){let t=un.Math_clamp1(e/this._duration,0,1);return t==0?this._begin:t==1?this._end:this._begin+(this._end-this._begin)*this._curve.get(t)}dPos(e){return(this.pos(e+.001)-this.pos(e-.001))/(2*.001)}endPos(){return this._end}isDone(e){return e>this._duration}typeAt(e){return 3}};var UC=new Map([["http:",80],["https:",443]]);function GC(i){return i==="http:"||i==="https:"}function HC(i){if(GC(i.protocol)){let e=i.port?parseInt(i.port):UC.get(i.protocol);return{scheme:i.protocol,hostname:i.hostname,port:e}}else return"INVALID_ORIGIN"}function zC(i,e){return e.scheme==="ALL"||e.scheme.scheme===i}function WC(i,e){return e.hostname==="ALL"||e.hostname.hostname===i}function QC(i,e){return e.port==="ALL"||e.port.port===i}function KC(i,e){return zC(i.scheme,e)&&WC(i.hostname,e)&&QC(i.port,e)?"ALLOWED":"DENIED"}var qC={scheme:"ALL",hostname:{hostname:"localhost"},port:"ALL"},YC={scheme:"ALL",hostname:{hostname:"127.0.0.1"},port:"ALL"},XC={scheme:{scheme:"https:"},hostname:"ALL",port:"ALL"},JC=[qC,YC,XC];function jC(i){for(let e of JC)if(KC(i,e)==="ALLOWED")return"ALLOWED";return"DENIED"}function Yu(i){let e;try{e=new URL(i)}catch{return"DENIED"}let t=HC(e);return t==="INVALID_ORIGIN"?"DENIED":jC(t)}var Ze;(Tt=>{function i(de){try{if(t(de))return de.toString();if(n(de))return _(de).toString();if(r(de))return m(de).toString();if(a(de))return Bn.string_toString(de);if(de instanceof Array)return de.length===0?"[]":"toString"in de[0]?"["+de.map(yt=>yt.toString()).join(", ")+"]":"[...]";if("toString"in de)return de.toString()}catch{}return"?"}Tt.toString=i;function e(de,yt){return t(de)&&t(yt)?de.equals1(yt):s(de)&&s(yt)?de.equals(yt):(n(de)||r(de)||a(de)||Ps(de),de==yt)}Tt.equals=e;function t(de){return de instanceof ne}Tt.isAffineTransform=t;function n(de){return typeof de=="boolean"}Tt.isBool=n;function r(de){return typeof de=="number"}Tt.isDouble=r;function o(de){return de.guid!==void 0&&de.ref!==void 0}Tt.isStyleId=o;function a(de){return typeof de=="string"}Tt.isString=a;function s(de){return de instanceof I}Tt.isVector=s;function l(de){return de instanceof Array}Tt.isList=l;function d(de){return de instanceof Gn}Tt.isParentIndex=d;function c(de){return typeof de=="string"}Tt.isGUID=c;function p(de){return typeof de=="string"}Tt.isScrollDirection=p;function u(de){return typeof de=="string"}Tt.isPosition=u;function h(de){return typeof de=="string"}Tt.isScrollBehavior=h;function f(de){return typeof de=="string"}Tt.isNavigationType=f;function y(de){return typeof de=="string"}Tt.isOverlayPositionType=y;function g(de){return typeof de=="string"}Tt.isOverlayBackgroundInteraction=g;function A(de){return typeof de=="string"}Tt.isShapeWithTextType=A;function T(de){return de.autoplay!==void 0&&de.mediaLoop!==void 0&&de.muted!==void 0}Tt.isVideoPlayback=T;function b(de){return de}Tt.asAffineTransform=b;function _(de){return!!de}Tt.asBool=_;function m(de){return+de}Tt.asDouble=m;function S(de){return de}Tt.asStyleId=S;function v(de){return de}Tt.asInt=v;function C(de){return de}Tt.asString=C;function N(de,yt){return a(de)?de:yt}Tt.asStringEnum=N;function x(de){return de}Tt.asVector=x;function z(de){return de}Tt.asPaintList=z;function $(de){return de}Tt.asPaintData=$;function q(de){return de}Tt.asEffectList=q;function K(de){return de}Tt.asExportSettingsList=K;function F(de){return de}Tt.asParentIndex=F;function P(de){return de}Tt.asGUID=P;function k(de){return de}Tt.asScrollDirection=k;function H(de){return de}Tt.asPosition=H;function L(de){return de}Tt.asScrollBehavior=L;function Q(de){return de}Tt.asNavigationType=Q;function X(de){return de}Tt.asOverlayPositionType=X;function M(de){return de}Tt.asOverlayBackgroundInteraction=M;function te(de){return de}Tt.asArcData=te;function J(de){return de}Tt.asShapeWithTextType=J;function oe(de){return de}Tt.asVideoPlayback=oe,Tt.ZERO_VECTOR=Ie.FrozenVector_new1(),Tt.IDENTITY_TRANSFORM=vt.FrozenAffineTransform_new1(),Tt.EMPTY_PAINT_LIST=[],Tt.EMPTY_EFFECT_LIST=[],Tt.DEFAULT_ARC_DATA={startingAngle:0,endingAngle:2*Math.PI,innerRadius:0}})(Ze||(Ze={}));var qt=class i{static getEventEmitter(){return i._eventEmitter||(i._eventEmitter=new i),i._eventEmitter}constructor(){this._callbacks=new Map,this.on=(e,t)=>{ue.List_appendOne(this._list(e),t)},this.off=(e,t)=>{ue.List_removeOne(this._list(e),t)},this.trigger=(e,t)=>{let n=this._list(e).slice();for(let r of n)r(t)}}_list(e){return this._callbacks.has(e)?this._callbacks.get(e):(this._callbacks.set(e,[]),this._callbacks.get(e))}};(t=>{class i{constructor(){this._emitter=t.getEventEmitter()}handleAction(r,o){switch(r){case 5:{this._emitter.trigger("mirror-tap",null);break}case 6:{this._emitter.trigger("canvasMouseDown",Ze.asVector(o).toJSON());break}case 7:{this._emitter.trigger("canvasMouseMove",Ze.asVector(o).toJSON());break}case 8:{this._emitter.trigger("canvasMouseDrag",Ze.asVector(o).toJSON());break}case 9:{this._emitter.trigger("canvasMouseUp",Ze.asVector(o).toJSON());break}case 10:{this._emitter.trigger("canvasTouchDown",Ze.asVector(o).toJSON());break}}}}t.ActionHandler=i;class e{constructor(r){this._emitter=t.getEventEmitter();this._state=r,this._visible=!1}onFrame(){let r=this._state.baseScreenNode()!=null;this._visible!=r&&(this._visible=r,this._emitter.trigger("baseScreenVisibilityChange",this._visible))}}t.AppHandler=e})(qt||(qt={}));var sr;(r=>{function i(o){return o!="NONE"}r.hasOverflow=i;function e(o){return o=="HORIZONTAL"||o=="BOTH"}r.scrollsHorizontally=e;function t(o){return o=="VERTICAL"||o=="BOTH"}r.scrollsVertically=t;function n(o,a){switch(o){case"VERTICAL":return Math.abs(a.y());case"HORIZONTAL":return Math.abs(a.x());case"BOTH":return Math.abs(a.length());default:break}return 0}r.getDirectionSimilarity=n})(sr||(sr={}));var Fg;(e=>{function i(t){let n=t,r=t.parent(),o=new I(0,0);for(;r!=null&&r.type()!="CANVAS";){let a=r.scrollDirection()!="NONE"&&r.hasNodeProperty(88),s=n.isFixed();a&&!s&&o.addUpdate1(r.scrollOffset()),n=r,r=r.parent()}return o}e.cumulativeScrollOffsetOfAncestors=i})(Fg||(Fg={}));function Zy(i){switch(i){case"VERTICAL":return new I(0,1);case"HORIZONTAL":return new I(1,0);case"BOTH":{let e=new I(1,1);return e.divide(e.length())}default:break}return I.new2()}var Ra;(a=>{function i(s,l,d,c,p){let u=s.stickyNodeInitialTopPosition,h=s.overflowingAncestorInitialTopPosition,f=u-h;if(c)return d.y()>f?Ie.FrozenVector_new4(d.x(),f):d;{if(p)return Ie.FrozenVector_new4(0,0);let y=l(),g=s.stickyNodeHeight,A=s.parentNodeHeight,T=s.parentNodeInitialTopPosition,_=u-T+g,m=A-_,S=y.y()>f&&y.y()<=f+m,v=y.y()>f+m;return S?Ie.FrozenVector_new4(0,f-y.y()):v?Ie.FrozenVector_new4(0,-m):Ie.FrozenVector_new4(0,0)}}a.getRelativeScrollTranslationOfStickyScrollingNodeFromBounds=i;function e(s){let l=s.parent();if(l==null)return Ie.FrozenVector_new4(0,0);let d=l.isFixed()&&l.parent()!=null&&l.parent().hasNodeProperty(88);if(s.isStandardScrolling()&&l.hasNodeProperty(88))return l.scrollOffset();if(s.isStickyScrolling()){let c=s.parent(),p=!0;for(;c!=null&&!c.hasNodeProperty(88);)p=!1,c=c.parent();if(c==null)return Ie.FrozenVector_new4(0,0);let u=s.absoluteTransform().m12(),h=s.size().y(),f=l.absoluteTransform().m12(),y=l.size().y(),g=c.absoluteTransform().m12(),A=new o(u,h,f,y,g);return i(A,()=>n(l),l.scrollOffset(),p,d)}return Ie.FrozenVector_new4(0,0)}a.getScrollTranslationOfNodeRelativeToParent1=e;function t(s){let l=s.parent();if(l==null)return Ie.FrozenVector_new4(0,0);let d=p=>p.scrollDirection()!="NONE"&&p.hasOverflowingContentInScrollDirection(),c=l.isFixed()&&l.parent()!=null&&d(l.parent());if(s.isStandardScrolling()&&d(l))return l.scrollOffset();if(s.isStickyScrolling()){let p=s.parent(),u=!0;for(;p!=null&&!d(p);)u=!1,p=p.parent();if(p==null)return Ie.FrozenVector_new4(0,0);let h=s.absoluteTransform().m12(),f=s.size().y(),y=l.absoluteTransform().m12(),g=l.size().y(),A=p.absoluteTransform().m12(),T=new o(h,f,y,g,A);return i(T,()=>r(l),l.scrollOffset(),u,c)}return Ie.FrozenVector_new4(0,0)}a.getScrollTranslationOfNodeRelativeToParent2=t;function n(s){let l=Ie.FrozenVector_new4(0,0),d=s;for(;d!=null&&(!d.hasNodeProperty(88)||d==s);){let c=e(d);l=l.add1(c),d=d.parent()}return l}a.getScrollTranslationOfNodeRelativeToOverflowingAncestor1=n;function r(s){let l=p=>p.scrollDirection()!="NONE"&&p.hasOverflowingContentInScrollDirection(),d=Ie.FrozenVector_new4(0,0),c=s;for(;c!=null&&(!l(c)||c==s);){let p=t(c);d=d.add1(p),c=c.parent()}return d}a.getScrollTranslationOfNodeRelativeToOverflowingAncestor2=r;class o{constructor(l,d,c,p,u){this.stickyNodeInitialTopPosition=l,this.stickyNodeHeight=d,this.parentNodeInitialTopPosition=c,this.parentNodeHeight=p,this.overflowingAncestorInitialTopPosition=u}}a.StickyScrollBounds=o})(Ra||(Ra={}));var Ii=(t=>(t[t.APPLY_SCROLLING_AND_CLIPPING=0]="APPLY_SCROLLING_AND_CLIPPING",t[t.APPLY_SCROLLING=1]="APPLY_SCROLLING",t))(Ii||{}),Lc=(n=>(n[n.BASE_SCREEN=0]="BASE_SCREEN",n[n.OVERLAY_OR_SUBLAYER=1]="OVERLAY_OR_SUBLAYER",n[n.DETERMINE_USING_NODE_FIELDS=2]="DETERMINE_USING_NODE_FIELDS",n))(Lc||{}),Xu=class{constructor(e){this._node=null,this._overrideRole=null,this._node=e}overrideRole(e){this._overrideRole=new _e(e)}clearRoleOverride(){this._overrideRole=null}_role(){return this._overrideRole!=null?this._overrideRole.value:2}canvasSpaceContentBounds(){return this.scrollDirection()=="NONE"?this._node.canvasSpaceRenderedBounds():this._scrollableContentBounds()}defaultScrollOffset(){return this._node.canvasSpaceBoundingBox().topLeft().subtract1(this.canvasSpaceContentBounds().topLeft())}minScrollOffsetX(){return-this.defaultScrollOffset().x()}minScrollOffsetY(){return-this.defaultScrollOffset().y()}maxScrollOffsetX(){return Math.max(this.minScrollOffsetX(),this.canvasSpaceContentBounds().right()-this._node.canvasSpaceBoundingBox().right())}maxScrollOffsetY(){return Math.max(this.minScrollOffsetY(),this.canvasSpaceContentBounds().bottom()-this._node.canvasSpaceBoundingBox().bottom())}hasOverflowingContentInXDirection(){return sr.scrollsHorizontally(this.scrollDirection())&&this.canvasSpaceContentBounds().width()>this._node.canvasSpaceBoundingBox().width()}hasOverflowingContentInYDirection(){return sr.scrollsVertically(this.scrollDirection())&&this.canvasSpaceContentBounds().height()>this._node.canvasSpaceBoundingBox().height()}shouldResizeToFitViewport(){return(this._role()==2?this._node.isTopLevel():this._role()==0)&&!this._node.isTooRotatedToScroll()}nodeSize(){if(this.shouldResizeToFitViewport()){let e=this._node.findContainingCanvasOrParent(),t=e.prototypeDevice(),n=e.currentViewportSize(),r=t.type=="NONE"||t.type=="PRESENTATION"?n:t.size();return new I(Math.min(this._node.fullSize().x(),r.x()),Math.min(this._node.fullSize().y(),r.y()))}else return this._node.fullSize()}nodeSpaceScrollableContentBounds(){let e=this._node.fullSize(),t=G.new2();if((this._role()==2?this._node.isTopLevel():this._role()==0)?!sr.hasOverflow(this._node.overflowDirection()):!this._node.isFrameMaskDisabled()&&this.scrollDirection()=="NONE")t.setTo1(0,0,e.x(),e.y());else{let o=this._node.canvasSpaceBoundingBox().topLeft();t.setTo1(o.x(),o.y(),e.x(),e.y());for(let a=0,s=this._node.childCount();a<s;a=a+1){let l=this._node.childAt1(a);l.isFixed()||(Lr?t.expandToInclude(l.canvasSpaceBoundingBox()):t.expandToInclude(l.canvasSpaceScrollingBounds()))}t.setX(t.x()-o.x()),t.setY(t.y()-o.y()),this._node.overflowDirection()=="VERTICAL"?(t.setX(0),t.setWidth(e.x())):this._node.overflowDirection()=="HORIZONTAL"?(t.setY(0),t.setHeight(e.y())):this._node.overflowDirection()=="BOTH"}return t}_scrollableContentBounds(){let e=this.nodeSpaceScrollableContentBounds();return e.transformInto1(e,this._node.absoluteTransform()),e}scrollDirection(){let e=this._role()==2?Ze.asBool(this._node.get1(89,!1)):this._role()==0;return this._node.constrainsAnchoredChildren()?this._node.isTopLevel()&&e?"BOTH":this._node.overflowDirection():"NONE"}scrollDirectionWithScrollableContent(){let e=this.scrollDirection(),t=this.canvasSpaceContentBounds(),n=this._node.canvasSpaceBoundingBox(),r=sr.scrollsVertically(e)&&t.height()>n.height(),o=sr.scrollsHorizontally(e)&&t.width()>n.width();return r&&o?"BOTH":r?"VERTICAL":o?"HORIZONTAL":"NONE"}hasScrollableParent(){let e=this._node.parent();return!(e==null||e.overflowDirection()=="NONE"&&!(e.isTopLevel()&&e.type()=="FRAME"))}isFixed(){return this.hasScrollableParent()?this._node.scrollBehavior()=="FIXED_WHEN_CHILD_OF_SCROLLING_FRAME":!1}isStickyScrolling(){return this._node.scrollBehavior()=="STICKY_SCROLLS"}isStandardScrolling(){return!this.isFixed()&&!this.isStickyScrolling()}scrollAndClipBoundsBySelfAndAncestors(e,t){let n=e.clone(),r=this._node;for(;r.parent()!=null;){let o=Ra.getScrollTranslationOfNodeRelativeToParent1(r);n.translate2(o.negative());let a=r.parent();a.clipsToBoundingRectangle()&&t==0&&n.intersectWith(a.canvasSpaceBoundingBox()),r=a}return n}canvasSpaceScrolledBounds(e){return this.scrollAndClipBoundsBySelfAndAncestors(this._node.canvasSpaceBoundingBox(),e)}canvasSpaceScrolledInteractiveBounds(e){let t=this._node.canvasSpaceInteractiveBounds();return this.scrollAndClipBoundsBySelfAndAncestors(t,e)}scrollsInPreferredDirection(e){switch(e){case"HORIZONTAL":return sr.scrollsHorizontally(this.scrollDirection());case"VERTICAL":return sr.scrollsVertically(this.scrollDirection());case"BOTH":return this.scrollDirection()!="NONE"}return!1}hasOverflowingContentInScrollDirection(){let e=this.canvasSpaceContentBounds(),t=this._node.canvasSpaceBoundingBox();return sr.scrollsHorizontally(this.scrollDirection())&&e.width()>t.width()||sr.scrollsVertically(this.scrollDirection())&&e.height()>t.height()}},$y;(e=>{function i(t){return Ii[t]}e.BoundsTransformationStrategy_toString=i})($y||($y={}));var eb;(e=>{function i(t){return Lc[t]}e.FrameRole_toString=i})(eb||(eb={}));var Mc;(a=>{function i(s,l,d){s.set(l,d)}a.Map_set1=i;function e(s,l){return s.get(l)}a.Map_get1=e;function t(s,l,d){let c=s.get(l);return c!==void 0?c:d}a.Map_getOrDefault=t;function n(s){return Array.from(s.keys())}a.Map_keys=n;function r(s){return Array.from(s.values())}a.Map_values=r;function o(s,l){let d=new Map;for(let c=0,p=s.length;c<p;c=c+1)d.set(s[c],l[c]);return d}a.Map_new1=o})(Mc||(Mc={}));var tb;(n=>{function i(r,o){return r.get(o)}n.WeakMap_get1=i;function e(r,o,a){r.set(o,a)}n.WeakMap_set1=e;function t(r,o){let a=new WeakMap;for(let s=0,l=r.length;s<l;s=s+1)a.set(r[s],o[s]);return a}n.WeakMap_new1=t})(tb||(tb={}));var Ar=class i{add(e){this._hash.set(e,!0)}_in(e){return this._hash.has(e)}remove(e){this._hash.delete(e)}count(){return this._hash.size}asList(){return Array.from(this._hash.keys())}each(e){Array.from(this._hash.keys()).forEach(e)}map(e){return Array.from(this._hash.keys()).map(e)}equals(e){if(e==null||this.count()!=e.count())return!1;for(let t of Array.from(this._hash.keys()))if(!e._in(t))return!1;return!0}static fromList(e){let t=new i;for(let n of e)t.add(n);return t}constructor(){this._hash=new Map}};var Sn;(t=>{let i;(l=>(l[l.NON_RENDERABLE=0]="NON_RENDERABLE",l[l.RENDERABLE_GEOMETRY=1]="RENDERABLE_GEOMETRY",l[l.RENDERABLE_TEXT=2]="RENDERABLE_TEXT",l[l.RENDERABLE_GROUP=3]="RENDERABLE_GROUP",l[l.CUSTOM_RENDER_TREE=4]="CUSTOM_RENDER_TREE"))(i=t.RenderableContentType||(t.RenderableContentType={}));let e;(r=>{function n(o){return t.RenderableContentType[o]}r.RenderableContentType_toString=n})(e=t.in_RenderableContentType||(t.in_RenderableContentType={}))})(Sn||(Sn={}));var Dg;(e=>{function i(){return new Map}e._new=i})(Dg||(Dg={}));var As=class{toString(){return this.name+" "+this.relativeChildIndex.toString()}toStringWithPrefix(e){let t=e?this.name.split("/")[0]:this.name;return t=t.trim(),t+" "+this.relativeChildIndex.toString()}constructor(e,t){this.name=e,this.relativeChildIndex=t}},Ju=class i{getData(e,t){let n=this.getAllDataForNode(e);return n!=null&&n.has(t)?n.get(t):null}getAllDataForNode(e){let t=this.getSubTrie(e);return t!=null?t.cache:null}insert(e,t,n){if(e.length==0){this.cache.set(t,n);return}let r=e[0].toString(),o=e.slice(1,e.length);this.children.has(r)||this.children.set(r,new i),this.children.get(r).insert(o,t,n)}remove(e,t){if(e.length==0){this.cache.delete(t);return}let n=e[0].toString(),r=e.slice(1,e.length);this.children.has(n)||this.children.set(n,new i),this.children.get(n).remove(r,t)}forEach(e){for(let t of Array.from(this.cache.keys()))e(this.cache.get(t));for(let t of Array.from(this.children.keys()))this.children.get(t).forEach(e)}getSubTrie(e){if(e.length==0)return this;let t=e[0].toString();return this.children.has(t)?this.children.get(t).getSubTrie(e.slice(1,e.length)):null}uninitialize1(){this.uninitialize2(null)}uninitialize2(e){for(let t of Array.from(this.cache.keys()))e!=null&&e(this.cache.get(t));for(let t of Array.from(this.children.keys()))this.children.get(t).uninitialize2(e),this.children.delete(t)}toString1(){return this.toString2(null)}toString2(e){let t=this.toStringHelper(e),n="";for(let r of t)n=n+`${r}
`;return n}toStringHelper(e){let t=[];for(let n of Array.from(this.cache.keys()))t.push(e==null?n:`${n}: ${e(this.cache.get(n))}`);for(let n of Array.from(this.children.keys())){let r=this.children.get(n).toStringHelper(e);for(let o of r)t.push(`${n}/${o}`)}return t}constructor(){this.cache=Dg._new(),this.children=new Map}},Na=class{getData(e,t){if(e.length==0)return null;let n=this._shouldUseTLFStorage(e)?this._getSSTDataCacheFromTLFStorage(e):this._getSSTDataCacheFromLowerNodeStorage(this._getNodesToTraverse(e));return n!=null&&n.has(t)?n.get(t):null}getAllDataForNode(e){return e.length==0?null:this._shouldUseTLFStorage(e)?this._getSSTDataCacheFromTLFStorage(e):this._getSSTDataCacheFromLowerNodeStorage(this._getNodesToTraverse(e))}_getSSTDataCacheFromTLFStorage(e){let t=e[0].toString();return this.tlfNodeStorage.has(t)?this.tlfNodeStorage.get(t).getAllDataForNode([]):null}_getSSTDataCacheFromLowerNodeStorage(e){let t=this._getFirstNodeName(e);return this.lowerNodeStorage.has(t)?this.lowerNodeStorage.get(t).getAllDataForNode(e.slice(1,e.length)):null}insert(e,t,n){e.length!=0&&(this._shouldUseTLFStorage(e)?this._insertIntoTLFStorage(e,t,n):this._insertIntoLowerNodeStorage(this._getNodesToTraverse(e),t,n))}remove(e,t){e.length!=0&&(this._shouldUseTLFStorage(e)?this._deleteFromTLFStorage(e,t):this._deleteFromLowerNodeStorage(this._getNodesToTraverse(e),t))}_deleteFromTLFStorage(e,t){let n=e[0].toString();this.tlfNodeStorage.has(n)&&this.tlfNodeStorage.get(n).remove(e.slice(1,e.length),t)}_deleteFromLowerNodeStorage(e,t){let n=this._getFirstNodeName(e);this.lowerNodeStorage.has(n)&&this.lowerNodeStorage.get(n).remove(e.slice(1,e.length),t)}_insertIntoTLFStorage(e,t,n){let r=e[0].toString();this.tlfNodeStorage.has(r)||this.tlfNodeStorage.set(r,new Ju),this.tlfNodeStorage.get(r).insert(e.slice(1,e.length),t,n)}_insertIntoLowerNodeStorage(e,t,n){let r=this._getFirstNodeName(e);this.lowerNodeStorage.has(r)||this.lowerNodeStorage.set(r,new Ju),this.lowerNodeStorage.get(r).insert(e.slice(1,e.length),t,n)}forEach(e){for(let t of Array.from(this.tlfNodeStorage.keys()))this.tlfNodeStorage.get(t).forEach(e);for(let t of Array.from(this.lowerNodeStorage.keys()))this.lowerNodeStorage.get(t).forEach(e)}getSubTrie(e){if(e.length==0)return this;if(this._shouldUseTLFStorage(e))return this.tlfNodeStorage.has(e[0].toString())?this.tlfNodeStorage.get(e[0].toString()):null;let t=this._getNodesToTraverse(e),n=this._getFirstNodeName(t);return this.lowerNodeStorage.has(n)?this.lowerNodeStorage.get(n).getSubTrie(t.slice(1,t.length)):null}uninitialize1(){this.uninitialize2(null)}uninitialize2(e){for(let t of Array.from(this.tlfNodeStorage.keys()))this.tlfNodeStorage.get(t).uninitialize2(e),this.tlfNodeStorage.delete(t);for(let t of Array.from(this.lowerNodeStorage.keys()))this.lowerNodeStorage.get(t).uninitialize2(e),this.lowerNodeStorage.delete(t)}toString1(){return this.toString2(null)}toString2(e){let t=this._toStringHelper(e),n="";for(let r of t)n=n+`${r}
`;return n}_toStringHelper(e){let t=[];for(let n of Array.from(this.lowerNodeStorage.keys())){let r=this.lowerNodeStorage.get(n).toStringHelper(e);for(let o of r)t.push(`*/${n}/${o}`)}for(let n of Array.from(this.tlfNodeStorage.keys())){let r=this.tlfNodeStorage.get(n).toStringHelper(e);for(let o of r)t.push(`[TLF]/${n}/${o}`)}return t}_shouldUseTLFStorage(e){return!Y.getFeatureFlags().prototype_state_management&&e.length==1}_getFirstNodeName(e){return e.length==1||!Y.getFeatureFlags().prototype_state_management?e[0].toStringWithPrefix(Y.getFeatureFlags().prototype_state_management):Lg.SemanticStorageTrie_UNIVERSAL_TLF_NAME_FOR_MATCHING}_getNodesToTraverse(e){return Y.getFeatureFlags().prototype_state_management?e:e.slice(1,e.length)}constructor(){this.lowerNodeStorage=new Map,this.tlfNodeStorage=new Map}},Cn;(l=>{function i(){l._cachedNodePaths.clear()}l.clearCachedNodePaths=i;function e(d){if(d==null)return[];if(l._cachedNodePaths.has(d.uniqueIdentifier()))return l._cachedNodePaths.get(d.uniqueIdentifier());let c=d.getSemanticNodePath();return l._cachedNodePaths.set(d.uniqueIdentifier(),c),c}l.getSemanticNodePath=e;function t(d){return d.type()=="FRAME"||d.type()=="INSTANCE"}l._isValidTLFType=t;function n(d){return d.isTopLevel()&&t(d)}l._isValidSemanticTLF=n;function r(d){if(d.isTopLevel()&&!t(d))return[];let c=[],p=!0;for(let u=d.clone();p&&u!=null;u=u.parent())c.splice(0,0,new As(u.name(),Y.getFeatureFlags().prototype_state_management?o(u):0)),n(u)&&(p=!1);return c}l.getSemanticNodePathHelper=r;function o(d){if(n(d)||d.parent()==null)return 0;let c=d.parent().clone(),p=[],u=c.childCount();for(let h=0;h<u;h=h+1){let f=c.clone();f.moveToChildAt(h),f.name()==d.name()&&p.push(f.uniqueIdentifier())}return p.indexOf(d.uniqueIdentifier())}l.getRelativeChildIndex=o,l.DEFAULT_STORAGE_KEY="storage_key",l._cachedNodePaths=new Map})(Cn||(Cn={}));var nb;(l=>{function i(d){return d}l.SSTDataCache_asMap=i;function e(d){return Array.from(d.keys())}l.SSTDataCache_keys=e;function t(d,c){return d.has(c)}l.SSTDataCache_has=t;function n(d){return d.size}l.SSTDataCache_size=n;function r(d,c){d.delete(c)}l.remove=r;function o(d,c){return d.get(c)}l.SSTDataCache_get=o;function a(d,c,p){d.set(c,p)}l.SSTDataCache_set=a;function s(d,c){d.forEach(c)}l.SSTDataCache_forEach=s})(nb||(nb={}));var Lg;(e=>e.SemanticStorageTrie_UNIVERSAL_TLF_NAME_FOR_MATCHING="TLF Placeholder")(Lg||(Lg={}));var jt=class i{constructor(){if(arguments.length==1){let e=arguments[0];this.node=null,this._overlayRenderData=null,this.node=e}else if(arguments.length==2){let e=arguments[0],t=arguments[1];this.node=null,this._overlayRenderData=null,this.node=e,this._overlayRenderData=t}}clone(){return new i(this.node,this.overlayRenderData())}setNode(e){this.node=e}moveToChildAt(e){this.node=this.node.childAt2(e,!0)}moveToParent(){this.node=this.node.parent()}isRoot(){return this.node.parent()==null}indexInParent(){return this.node.indexInParent()}renderableContentType(){switch(this.node.type()){case"NONE":case"DOCUMENT":case"SLICE":case"INTERACTIVE_SLIDE_ELEMENT":return Sn.RenderableContentType.NON_RENDERABLE;case"CANVAS":case"GROUP":case"FRAME":case"SYMBOL":case"INSTANCE":case"STICKY":case"CODE_BLOCK":case"MEDIA":case"SECTION_OVERLAY":case"WIDGET":case"SHAPE_WITH_TEXT":case"CONNECTOR":case"SECTION":case"TABLE":case"TABLE_CELL":case"SLIDE":return Sn.RenderableContentType.RENDERABLE_GROUP;case"BOOLEAN_OPERATION":case"ELLIPSE":case"LINE":case"RECTANGLE":case"REGULAR_POLYGON":case"ROUNDED_RECTANGLE":case"STAR":case"VECTOR":case"HIGHLIGHT":case"STAMP":case"WASHI_TAPE":return Sn.RenderableContentType.RENDERABLE_GEOMETRY;case"TEXT":return Sn.RenderableContentType.RENDERABLE_TEXT}return Ve("Unhandled scene node type while getting cursor renderable content type"),Sn.RenderableContentType.NON_RENDERABLE}isFrameLike(){return Jt.isFrameLike(this.type())}isTopLevel(){return this.node.isTopLevel()}willChange(){return 0}shouldOptimizeShadowForAnimation(e){return!1}paintsDebugString(){return`SceneCursor ${this.node.paintsDebugString()}`}customRenderTree(e){return null}name(){return this.node.name()}scene(){return this.node.scene()}parent(){return this.node.parent()!=null?new i(this.node.parent()):null}blendMode(){return this.node.blendMode()}opacity(){return this.node.opacity()}visible(){return this.node.visible()}isVisibleMask(){return this.node.visible()&&this.node.isMask()}maskType(){return this.node.maskType()}isSpreadEligibleNode(){return this.node.isSpreadEligibleNode()}type(){return this.node.type()}childCount(){return this.node.childCount()}absoluteTransform(){return this.node!=null?this.node.absoluteTransform():vt.FrozenAffineTransform_IDENTITY}maxTransformScale(){return 1}clipsChildren(){return this.node.clipsToBoundingRectangle()}stopsMaskPropagation(){return this.node.isMask()||this.node.clipsToBoundingRectangle()}arcData(){return this.node.arcData()}roundedRectInfo(){return this.node.roundedRectInfo()}fillGeometry(){return this.node.fillGeometry()}strokeGeometry(){return this.node.strokeGeometry()}fillGeometryForSpread(e,t,n){return this.node.fillGeometryForSpread(e,t,n)}strokeGeometryForSpread(e,t,n,r){return this.node.strokeGeometryForSpread(e,t,n,r)}size(){return this.node.size()}strokeAlign(){return this.node.strokeAlign()}strokeWeight(){return this.node.strokeWeight()}id(){return this.node.id()}uniqueIdentifier(){return this.node.id()}isInsideOutlineMask(){return this.node.isInsideOutlineMask()}textData(){return this.node.textData()}derivedTextData(){return this.node.derivedTextData()}textGeometry(){return this.node.textGeometry()}getCachedRenderTree(){return this.node.getCachedRenderTree()}renderTree(){return this.node.renderTree1()}renderTreeWithoutBackgroundBlurs(){return this.node.renderTreeWithoutBackgroundBlurs()}renderTreeForShadowRoot(){return this.node.renderTreeForShadowRoot1()}renderTreeForShadowDescendant(){return this.node.renderTreeForShadowDescendant1()}renderTreeForKnockoutShadowRoot(){return this.node.renderTreeForKnockoutShadowRoot1()}renderTreeForKnockoutShadowDescendant(){return this.node.renderTreeForKnockoutShadowDescendant1()}isFixed(){return this.node.isFixed()}isStandardScrolling(){return this.node.isStandardScrolling()}isStickyScrolling(){return this.node.isStickyScrolling()}scrollOffset(){return this.node.scrollOffset()}scrollDirection(){return this.node.scrollDirection()}hasOverflowingContentInScrollDirection(){return this.node.hasOverflowingContentInScrollDirection()}effects(){return this.node.effects()}fillPaints(){return this.node.fillPaints()}strokePaints(){return this.node.strokePaints()}fillPaintsToRender(){return this.node.fillPaintsToRender()}videoPlayback(){return this.node.videoPlayback()}containerSupportsFillStrokeAndCorners(){return this.node.containerSupportsFillStrokeAndCorners()}isGroup(){return this.node.isGroup()}hasNonZeroStrokeWeight(){return this.node.hasNonZeroStrokeWeight()}hasPerRegionFillPaints(){return this.node.hasPerRegionFillPaints()}forEachRegionWithFillPaintBatch(e){this.node.forEachRegionWithFillPaintBatch(e)}overrideKey(){return this.node.overrideKey()}getSemanticNodePath(){return Cn.getSemanticNodePathHelper(this)}hasBackgroundBlurs(){return this.node.hasBackgroundBlurs()}overlayRenderData(){return this._overlayRenderData}};var Zi=class i{startAnimation(e,t){this._animationCurve=e,this._animationStartTime=ke.seconds(),this._animationEndTime=this._animationStartTime+t}animationProgress(){let e=(ke.seconds()-this._animationStartTime)/(this._animationEndTime-this._animationStartTime);return this._animationCurve==i.Curve.EASE_IN_OUT?e*=e*e*(e*(e*6-15)+10):(e=1-e,e=1-e*e*e*e*e),Math.min(e,1)}constructor(){this._animationCurve=i.Curve.EASE_IN_OUT,this._animationStartTime=0,this._animationEndTime=0}};(t=>{let i;(o=>(o[o.EASE_IN_OUT=0]="EASE_IN_OUT",o[o.DECAY=1]="DECAY"))(i=t.Curve||(t.Curve={}));let e;(r=>{function n(o){return t.Curve[o]}r.Curve_toString=n})(e=t.in_Curve||(t.in_Curve={}))})(Zi||(Zi={}));var Bc=(t=>(t[t.NOT_ANIMATED=0]="NOT_ANIMATED",t[t.ANIMATED=1]="ANIMATED",t))(Bc||{}),ab=(t=>(t[t.SNAP_VIEWPORT_TO_PIXEL_VIEW_SPACE=0]="SNAP_VIEWPORT_TO_PIXEL_VIEW_SPACE",t[t.DISABLE_VIEWPORT_PIXEL_ADJUSTMENT=1]="DISABLE_VIEWPORT_PIXEL_ADJUSTMENT",t))(ab||{}),Vc=(t=>(t[t.RESET=0]="RESET",t[t.PRESERVE=1]="PRESERVE",t))(Vc||{}),ho=class ho{zoomScale(){return this._boundsMapping.viewPixelsPerCanvasPixel()}viewSpaceBounds(){return this._boundsMapping.viewSpaceBounds()}resetStateForTests(){this._boundsMapping=new ju,this._useClamping=!1,this._alreadySetAnimationClamp=!1,this._dummyOffset=I.new2(),this._isInvalid=!0,this._scrollPadding=[0,0,0,0],this._boundsOfDevicePreview=G.new2(),this._minZoom=0,this._isAnimating=!1,this._animationOffsetStart=null,this._animationOffsetEnd=null,this._clampedAnimationOffsetEnd=I.new2(),this._animationZoomScaleStart=1,this._animationZoomScaleEnd=1,this._animationEndBounds=G.new2()}pixelSpaceBounds(e){let t=this.viewSpaceBounds();return new G(t.left()*e,t.top()*e,t.width()*e,t.height()*e)}_clampingBoundsForCanvasSpaceOffset(){return this._boundsMapping.clampingBoundsForCanvasSpaceOffset()}copyFrom(e){this._boundsMapping=e._boundsMapping.clone(),this._boundsOfDevicePreview.copyFrom(e._boundsOfDevicePreview),this._isInvalid=e._isInvalid,this._minZoom=e._minZoom,this._scrollPadding=e._scrollPadding}offsetX(){return this.offset().x()}offsetY(){return this.offset().y()}offset(){return this._boundsMapping.canvasSpaceOrigin().negative()}_setCanvasSpaceOffsetTo(e){this._boundsMapping.setCanvasSpaceOriginTo(e.negative())}canvasSpaceToViewSpace1(){return Y.isInlinePreview()?this.canvasSpaceToViewSpace2(1):this.canvasSpaceToViewSpace2(0)}canvasSpaceToViewSpace2(e){return this._boundsMapping.canvasSpaceToViewSpace(e)}viewSpaceToCanvasSpace1(){return Y.isInlinePreview()?this._boundsMapping.viewSpaceToCanvasSpace(1):this._boundsMapping.viewSpaceToCanvasSpace(0)}viewSpaceToCanvasSpace2(e){return this._boundsMapping.viewSpaceToCanvasSpace(e)}viewSpaceToClipSpace(){let e=ne.new2().copyFrom(vt.FrozenAffineTransform_IDENTITY);return e.copyFrom(vt.FrozenAffineTransform_IDENTITY),e.scale4(1,-1),e.translate2(-1,-1),e.scale4(2/this.viewSpaceBounds().width(),2/this.viewSpaceBounds().height()),e}canvasSpaceToClipSpace1(){return Y.isInlinePreview()?this.canvasSpaceToClipSpace2(1):this.canvasSpaceToClipSpace2(0)}canvasSpaceToClipSpace2(e){let t=this.viewSpaceToClipSpace();return t.multipliedBy2(this.canvasSpaceToViewSpace2(e)),t}computeCanvasSpaceBounds1(e){Y.isInlinePreview()?this.computeCanvasSpaceBounds2(e,1):this.computeCanvasSpaceBounds2(e,0)}computeCanvasSpaceBounds2(e,t){this._boundsMapping.computeCanvasSpaceBounds(e,t)}isInvalid(){return this._isInvalid}invalidate(){this._isInvalid=!0}setBounds(e){(this.viewSpaceBounds()==null||!this.viewSpaceBounds().equals(e))&&(this._boundsMapping.setViewSpaceBounds(e),this._isInvalid=!0)}_setCamera1(e,t,n,r){e==1?this._setCameraWithAnimation(t,n,Zi.Curve.EASE_IN_OUT,r):(this._isAnimating=!1,(!this.offset().equals(t)||this.zoomScale()!=n)&&(this._setCanvasSpaceOffsetTo(t),this._boundsMapping.setViewPixelsPerCanvasPixel(n),this._isInvalid=!0))}_setCamera2(e,t,n){this._setCamera1(e,t,n,ho.ANIMATION_DURATION)}_setCameraWithAnimation(e,t,n,r){this._animationManager.startAnimation(n,r),this._animationOffsetStart=this.offset().clone(),this._animationOffsetEnd=e.clone(),this._animationZoomScaleStart=this.zoomScale(),this._animationZoomScaleEnd=this._clampedZoomScale(t),this._calculateBoundsForClamping(this._animationZoomScaleEnd,this._animationEndBounds),this._clampedAnimationOffsetEnd.setTo(un.Math_clamp1(e.x(),this._animationEndBounds.left(),this._animationEndBounds.right()),un.Math_clamp1(e.y(),this._animationEndBounds.top(),this._animationEndBounds.bottom())),this._isAnimating=!0,this._isInvalid=!0}_clampCameraOffset(){if(!this._useClamping)return;this._dummyOffset.copyFrom(this.offset()),this._updateBoundsForClamping(),this._setCanvasSpaceOffsetTo(this._dummyOffset);let e=un.Math_clamp1(this.offsetX(),this._clampingBoundsForCanvasSpaceOffset().left(),this._clampingBoundsForCanvasSpaceOffset().right()),t=un.Math_clamp1(this.offsetY(),this._clampingBoundsForCanvasSpaceOffset().top(),this._clampingBoundsForCanvasSpaceOffset().bottom()),n=1e-6;if(Math.abs(this.offsetX()-e)>n||Math.abs(this.offsetY()-t)>n)if(this._isAnimating&&this._animationZoomScaleStart==this._animationZoomScaleEnd)this.offsetX()!=e&&(this._animationOffsetStart=new I(e,this._animationOffsetStart.y()),this._animationOffsetEnd=new I(e,this._animationOffsetEnd.y()),this._setCanvasSpaceOffsetTo(new I(e,this.offset().y()))),this.offsetY()!=t&&(this._animationOffsetStart=new I(this._animationOffsetStart.x(),t),this._animationOffsetEnd=new I(this._animationOffsetEnd.x(),t),this._setCanvasSpaceOffsetTo(new I(this.offset().x(),t))),this._animationOffsetStart.equals(this._animationOffsetEnd)&&(this._isAnimating=!1);else if(this._isAnimating){if(this._alreadySetAnimationClamp)return;this._animationOffsetStart=this.offset(),this._animationOffsetEnd=this._clampedAnimationOffsetEnd,this._alreadySetAnimationClamp=!0}else this._setCamera2(0,new I(e,t),this.zoomScale());this.zoomScale()<this._minZoom&&this._boundsMapping.setViewPixelsPerCanvasPixel(this._minZoom)}setCameraZoom(e,t){let n=e==1&&this._isAnimating;this._setCamera2(e,n?this._animationOffsetEnd:this.offset(),t)}adjustCameraZoom1(e,t){let n=e==1&&this._isAnimating;this._setCamera2(e,n?this._animationOffsetEnd:this.offset(),(n?this._animationZoomScaleEnd:this.zoomScale())*t)}adjustCameraZoom2(e,t,n){let r=e==1&&this._isAnimating;this._setCamera1(e,r?this._animationOffsetEnd:this.offset(),(r?this._animationZoomScaleEnd:this.zoomScale())*t,n)}adjustCameraZoomRounded(e,t){let n=e==1&&this._isAnimating;this.setCameraZoom(1,Math.pow(2,Math.round(Math.log((n?this._animationZoomScaleEnd:this.zoomScale())*t)/Math.log(2))))}setCameraOffset1(e,t){this.setCameraOffset2(e,t,ho.ANIMATION_DURATION)}setCameraOffset2(e,t,n){let r=e==1&&this._isAnimating;this._setCamera1(e,t,r?this._animationZoomScaleEnd:this.zoomScale(),n),this._clampCameraOffset()}panCamera(e){this._setCamera2(0,this.offset().add1(e.divide(this.zoomScale())),this.zoomScale()),this._clampCameraOffset()}flingCameraOffset(e,t){this._setCameraWithAnimation((this._isAnimating?this._animationOffsetEnd:this.offset()).add1(e.divide(this.zoomScale())),this._isAnimating?this._animationZoomScaleEnd:this.zoomScale(),Zi.Curve.DECAY,t),this._clampCameraOffset()}adjustCameraZoomWithPin(e,t){let n=this._clampedZoomScale(this.zoomScale()*e);this._setCamera2(0,this.offset().add1(t.subtract1(this.viewSpaceBounds().size().divide(2)).multiply(1/n-1/this.zoomScale())),n),this._clampCameraOffset()}adjustCameraZoomAndOffset(e,t,n){let r=this._clampedZoomScale(this.zoomScale()*e);this._setCamera2(0,this.offset().add1(n.subtract1(this.viewSpaceBounds().size().divide(2)).divide(r)).subtract1(t.subtract1(this.viewSpaceBounds().size().divide(2)).divide(this.zoomScale())),r),this._clampCameraOffset()}zoomToFit1(e,t,n){this._zoomToFit(e,t,ho.ZOOM_TO_FIT_PADDING,n)}zoomToFit2(e,t){this._zoomToFit(e,t,ho.ZOOM_TO_FIT_PADDING,ho.ANIMATION_DURATION)}zoomToFitExactly(e,t){this._zoomToFit(e,t,0,ho.ANIMATION_DURATION)}_zoomToFit(e,t,n,r){t.isEmpty()||(this._setCamera1(e,t.center().negative(),this.viewSpaceBounds().size().subtract(2*n).divide1(t.size()).min1(),r),this._clampCameraOffset())}prepareForRendering(){if(this._isAnimating){let e=this._animationManager.animationProgress();e>=1?(this._setCanvasSpaceOffsetTo(this._animationOffsetEnd.clone()),this._boundsMapping.setViewPixelsPerCanvasPixel(this._animationZoomScaleEnd),this._isAnimating=!1,this._alreadySetAnimationClamp=!1):(this._boundsMapping.setViewPixelsPerCanvasPixel(1/(1/this._animationZoomScaleStart+(1/this._animationZoomScaleEnd-1/this._animationZoomScaleStart)*e)),this._setCanvasSpaceOffsetTo(this._animationOffsetEnd.subtract1(this._animationOffsetStart).multiply(e).add1(this._animationOffsetStart)))}this._isInvalid=this._isAnimating}getScaleFactorForCurrentTlf(e,t,n){let r=Br.canvasSpaceContentSize(e,n);if(r.x()===0||r.y()===0)return 1;switch(t){case 5:return r.x()>this.viewSpaceBounds().width()?this.viewSpaceBounds().width()/r.x():1;case 6:return this.viewSpaceBounds().width()/r.x();case 2:case 1:{let o=1/Math.max(r.x()/this.viewSpaceBounds().width(),r.y()/this.viewSpaceBounds().height());return t==2&&(o=Math.min(o,1)),o=Math.ceil(o*e.y())/e.y(),o}case 3:return 1;case 0:return 1;case 4:return 0;default:return 1}}_clampedZoomScale(e){let t=Math.max(this._minZoom,ho.ZOOM_MIN);return Math.max(t,Math.min(e,ho.ZOOM_MAX))}setScrollPadding(e){this._scrollPadding=e}previewBoundsIncludingDeviceFrame(e,t,n){return n!=null&&Aa.hasDevice(n.type)?Br.adjustNodeBoundsForDevice(e,n):Y.isInlinePreview()?e:t}_snapOffsetToPixelGrid(e,t){let n=e.add1(t).multiply(this.zoomScale()*2);n.setX(Math.floor(n.x())),n.setY(Math.floor(n.y()));let r=n.divide(this.zoomScale()*2).subtract1(t);return t.add1(r.subtract1(e))}_calculateBoundsForClamping(e,t){let n=this._boundsOfDevicePreview.isInvalid()?G.new2():this._boundsOfDevicePreview,r=Math.min((this.viewSpaceBounds().width()/2-this._scrollPadding[2])/e,n.width()/2),o=Math.min((this.viewSpaceBounds().height()/2-this._scrollPadding[3])/e,n.height()/2),a=Math.min((this.viewSpaceBounds().width()/2-this._scrollPadding[0])/e,n.width()/2),s=Math.min((this.viewSpaceBounds().height()/2-this._scrollPadding[1])/e,n.height()/2),l=-n.right()+r,d=-n.bottom()+o,c=-n.left()-a,p=-n.top()-s,u=c-l,h=p-d;t.setTo1(l,d,u,h)}_updateBoundsForClamping(){let e=G.new2();this._calculateBoundsForClamping(this.zoomScale(),e),this._boundsMapping.setClampingBoundsForCanvasSpaceOffset(e)}updateForBaseScreen(e,t,n){this.updateForCurrentPreview(e==null?void 0:e.canvasSpaceBoundingBox(),e==null?void 0:e.canvasSpacePreviewBounds(),t,n)}updateForCurrentPreview(e,t,n,r){if(t==null||e==null){this._useClamping=!1;return}switch(this._boundsOfDevicePreview.copyFrom(this.previewBoundsIncludingDeviceFrame(e,t,r)),this._minZoom=this.getScaleFactorForCurrentTlf(t.size(),n,r),n){case 4:{this._useClamping=!1;break}case 3:case 5:case 0:case 6:{this._useClamping=!0,this._updateBoundsForClamping(),this._clampCameraOffset();let o=r!=null&&r.type!="NONE";Ss.FitMode_userCanManuallyZoom(n,o)||this.setCameraZoom(0,this._minZoom);break}case 1:case 2:{this._useClamping=!0;let o=this._snapOffsetToPixelGrid(t.topLeft(),this._boundsOfDevicePreview.center().negative());this._boundsMapping.setClampingBoundsForCanvasSpaceOffset(new G(o.x(),o.y(),0,0)),this._setCamera2(0,o,this._minZoom);break}}}constructor(){this._boundsMapping=new ju,this._useClamping=!1,this._alreadySetAnimationClamp=!1,this._boundsOfDevicePreview=G.new2(),this._dummyOffset=I.new2(),this._isInvalid=!0,this._scrollPadding=[0,0,0,0],this._minZoom=0,this._animationManager=new Zi,this._isAnimating=!1,this._animationOffsetStart=null,this._animationOffsetEnd=null,this._clampedAnimationOffsetEnd=I.new2(),this._animationZoomScaleStart=1,this._animationZoomScaleEnd=1,this._animationEndBounds=G.new2()}};ho.ZOOM_MIN=Math.pow(2,-6),ho.ZOOM_MAX=Math.pow(2,8),ho.ZOOM_TO_FIT_PADDING=50,ho.ANIMATION_DURATION=.2;var $o=ho,ju=class i{canvasSpaceOrigin(){return this._defaultCanvasSpaceOrigin().add1(this._canvasSpaceOriginDelta)}setCanvasSpaceOriginTo(e){this._canvasSpaceOriginDelta=e.subtract1(this._defaultCanvasSpaceOrigin())}viewSpaceBounds(){return this._viewSpaceBounds}setViewSpaceBounds(e){this._viewSpaceBounds=e}viewPixelsPerCanvasPixel(){return this._viewPixelsPerCanvasPixel}setViewPixelsPerCanvasPixel(e){this._viewPixelsPerCanvasPixel=e}clampingBoundsForCanvasSpaceOffset(){return this._clampingBoundsForCanvasSpaceOffset}setClampingBoundsForCanvasSpaceOffset(e){this._clampingBoundsForCanvasSpaceOffset.copyFrom(e)}canvasSpaceToViewSpace(e){let t=po.new2().translatedBy2(this._viewSpaceBounds.width()/2,this._viewSpaceBounds.height()/2).scaledBy(this._viewPixelsPerCanvasPixel).translatedBy1(this.canvasSpaceOrigin().negative()),n=po.new2();if(e==0){let r=I.new3(this.canvasSpaceOrigin()).rounded(),o=t.transformPoint(r),a=-(o.x()-Math.floor(o.x())),s=-(o.y()-Math.floor(o.y()));n.translate1(a,s)}return n.multiply(t),n}viewSpaceToCanvasSpace(e){let t=this.canvasSpaceToViewSpace(e).clone();return t.invert(),t}computeCanvasSpaceBounds(e,t){this._viewSpaceBounds.transformInto2(e,this.viewSpaceToCanvasSpace(t))}_defaultCanvasSpaceOrigin(){return this._clampingBoundsForCanvasSpaceOffset!=null?this._clampingBoundsForCanvasSpaceOffset.bottomRight().negative():Ie.FrozenVector_ZERO}clone(){let e=new i;return e._canvasSpaceOriginDelta=this._canvasSpaceOriginDelta.clone(),e._viewPixelsPerCanvasPixel=this._viewPixelsPerCanvasPixel,e._viewSpaceBounds=this._viewSpaceBounds.clone(),e._clampingBoundsForCanvasSpaceOffset=this._clampingBoundsForCanvasSpaceOffset.clone(),e}constructor(){this._canvasSpaceOriginDelta=I.new2(),this._viewPixelsPerCanvasPixel=1,this._viewSpaceBounds=null,this._clampingBoundsForCanvasSpaceOffset=G.new2()}},rb;(e=>{function i(t){return Bc[t]}e.ViewportUpdateType_toString=i})(rb||(rb={}));var ob;(e=>{function i(t){return ab[t]}e.ViewportPixelAdjustment_toString=i})(ob||(ob={}));var ib;(e=>{function i(t){return Vc[t]}e.StatePreserveType_toString=i})(ib||(ib={}));var kc=class i{static getStateGroupID(e){var r;let t=e!=null?e.scene().findNode1(e==null?void 0:e.symbolID()):null,n=(r=t==null?void 0:t.findContainingStateGroupOrSelf())==null?void 0:r.id();return n??ee.invalid()}constructor(e,t,n){this._appState=null,this._prototypeState=null,this._semanticChangeHistoryStorage=new Na,this._stateGroupsInteracted=new Set,this._semanticPathInteracted=new Set,this._swapStateCallback=null,this._appState=e,this._prototypeState=t,this._swapStateCallback=n,Y.getFeatureFlags().prototype_state_management&&(this._prototypeState.addObserver(this),this._prototypeState.addHsmObserver(this))}getComponentHistory(e,t){if(e.length==0)return[];let n=this._semanticChangeHistoryStorage.getData(e,t);return n??[]}setComponentHistory(e,t,n){this._semanticChangeHistoryStorage.insert(e,t,n)}handleStateChangeCommitted(e,t){}_transferChildComponentStates(e){e!=null&&e.forEachChild(t=>{this._setInstanceChangeHistory(t),this._transferChildComponentStates(t)})}_hasStateToTranfer(e,t){return t.length>0&&e.symbolID()!=ue.List_last(t).newStateId()}_setInstanceChangeHistory(e){if(e!=null&&this._isInteractiveComponent(e)&&this._nodeHasBeenInteractedWith(e)){let t=Cn.getSemanticNodePath(new jt(e)),n=this.getComponentHistory(t,i.getStateGroupID(e)),r=this._prototypeState.getStateMachineOrNull(e.stablePath());r!=null&&this._hasStateToTranfer(e,n)&&!this._stateAlreadyManagedByVariables(e)&&(r.setChangeHistory(n),this._swapStateCallback(e.stablePath(),ue.List_last(n).newStateId(),0),Pe.trackDefinedEvent("prototype.viewer_interaction_state_transferred",{}))}}_resetChildComponentStates(e,t){e!=null&&e.forEachChild(n=>{this._clearInstanceChangeHistory(n,t),this._resetChildComponentStates(n,t)})}_nodeIsInstance(e){return e!=null&&e.type()=="INSTANCE"}_nodeHasStoredState(e,t){let n=D();return!t&&n!=null&&this._nodeIsInstance(e)?n.nodeHasLocalSymbolChanges(e.id()):!1}_clearInstanceChangeHistory(e,t){var n,r;if(e!=null&&(this._isInteractiveComponent(e)||this._nodeHasStoredState(e,t))&&!this._stateAlreadyManagedByVariables(e)){Pe.trackDefinedEvent("prototype.viewer_interaction_state_reset",{}),t?(n=D())==null||n.resetLocalNestedInstanceChanges([e.id()]):(r=D())==null||r.resetLocalInstanceChanges([e.id()]);let o=Cn.getSemanticNodePath(new jt(e));this._semanticChangeHistoryStorage.remove(o,i.getStateGroupID(e))}}_hasStateToStore(e,t,n){if(t==null||t.length==0)return!1;if(n==null||n.length==0)return!0;let r=ue.List_last(n);return e.symbolID()!=r.newStateId()}_storeChangeHistory(e){if(e!=null&&this._isInteractiveComponent(e)&&this._nodeHasBeenInteractedWith(e)){let t=this._prototypeState.getStateMachineOrNull(e.stablePath());if(t!=null){let n=Cn.getSemanticNodePath(new jt(e)),r=i.getStateGroupID(e),o=this.getComponentHistory(n,r),a=t.changeHistory();this._hasStateToStore(e,a,o)&&!this._stateAlreadyManagedByVariables(e)&&this.setComponentHistory(n,r,a)}}}_storeChangeHistoryForChildren(e){e!=null&&e.forEachChild(t=>{this._storeChangeHistory(t),this._storeChangeHistoryForChildren(t)})}_semanticPathToString(e){let t=Cn.getSemanticNodePath(new jt(e)),n=":/:",r=i.getStateGroupID(e);return t.length==1?t[0].toStringWithPrefix(!0):t.reduce((o,a,s)=>s==0?o:o+a.toString()+n,"")+n+r}_recordInteraction(e,t){if(t.transitionParameters.navigationType=="SWAP_STATE"&&!Ut.TransitionAction_isTransientAction(t.cause)){let n=this._appState.scene().findNode3(e);if(n==null)return;let r=this._semanticPathToString(n);this._semanticPathInteracted.add(r)}}_semanticPathHasBeenInteractedWith(e){return this._semanticPathInteracted.has(this._semanticPathToString(e))}_nodeHasBeenInteractedWith(e){return i.getStateGroupID(e)!=ee.invalid()?this._semanticPathHasBeenInteractedWith(e):!1}_isInteractiveComponent(e){return this._nodeIsInstance(e)?i.getStateGroupID(e)!=ee.invalid():!1}_stateAlreadyManagedByVariables(e){return e!=null&&e.getBoundVariables().componentProperties}handleStateChangeAborted(e){}handleStateChangeInitiated(e){if(e.stateManagementVersion()==1){let t=e.oldStateAndOverlays.topId(),n=e.newStateAndOverlays.topId(),r=this._appState.scene().findNode1(t),o=this._appState.scene().findNode1(n);this._storeChangeHistory(r),this._storeChangeHistoryForChildren(r),e.resetInteractiveComponents()==0?(this._clearInstanceChangeHistory(o,!1),this._resetChildComponentStates(o,!1)):(this._setInstanceChangeHistory(o),this._transferChildComponentStates(o))}}handleStateChangeRequested(e){}handleFitModeChange(e,t){}handleRestartPrototype(){this._semanticChangeHistoryStorage.uninitialize1(),this._stateGroupsInteracted=new Set,this._semanticPathInteracted=new Set}handleHsmAborted(e,t){}handleHsmCommitted(e,t,n){t.stateManagementVersion()==1&&this._recordInteraction(e,t)}handleHsmRequested(e,t){if(t.stateManagementVersion()==1){let n=this._appState.scene().findNode3(e);this._storeChangeHistoryForChildren(n)}}handleHsmInitiated(e,t){if(t.stateManagementVersion()==1){let n=this._appState.scene().findNode3(e);t.resetInteractiveComponents()!=0?this._transferChildComponentStates(n):this._resetChildComponentStates(n,!0)}}debugString(){return this._semanticChangeHistoryStorage.toString2(e=>{let t="",n=Math.max(e.length-4,0);n!=0&&(t="..., ");for(let r=n,o=e.length;r<o;r=r+1){let a=e[r];t+=`${(a==null?void 0:a.oldStateId())??"null"}->${a==null?void 0:a.newStateId()}`,r!=e.length-1&&(t+=", ")}return t})}};var pn;(p=>{function i(u,h){let f=l();for(let y=0,g=u.length;y<g;y=y+1)n(f,u[y],h[y]);return f}p.new1=i;function e(u,h){return u.has(Ct[h])}p._in=e;function t(u,h){return Be.StringMap_get(u,Ct[h],null)}p.get1=t;function n(u,h,f){let y=Ct[h];p._remapKey.set(y,h),u.set(y,f)}p.set=n;function r(u,h,f){return Be.StringMap_get(u,Ct[h],f)}p.get=r;function o(u,h){u.delete(Ct[h])}p.remove=o;function a(u,h){Be.StringMap_each(u,(f,y)=>{h(p._remapKey.get(f),y)})}p.each=a;function s(u){let h=[];return Be.StringMap_each(u,(f,y)=>{h.push(`${f}=${Ze.toString(y)}`)}),`{${h.join(", ")}}`}p.toString=s;function l(){return new Map}p._new=l,p._remapKey=new Map,p.EMPTY=l()})(pn||(pn={}));var Ko;(o=>{function i(a,s){return pn._in(a,s)}o._in=i;function e(a,s){return pn.get1(a,s)}o.get1=e;function t(a,s,l){return pn.get(a,s,l)}o.get=t;function n(a,s){pn.each(a,s)}o.each=n;function r(a){return pn.toString(a)}o.toString=r})(Ko||(Ko={}));var Zu;(L=>{function i(Q,X){L._p.setTo(0,0);for(let M=Q.start();Ye.Command.isValid(M,Q);M=Ye.Command.next(M,Q)){switch(Ye.Command.kind(M,Q)){case Ye.Command.Kind.CLOSE:break;case Ye.Command.Kind.MOVE_TO:{L._p3.setTo(Ye.Command.moveToX(M,Q),Ye.Command.moveToY(M,Q)),L._p.copyFrom(L._p3);break}case Ye.Command.Kind.LINE_TO:{L._p3.setTo(Ye.Command.lineToX(M,Q),Ye.Command.lineToY(M,Q)),u(X,L._p,L._p0,L._p3);break}case Ye.Command.Kind.QUADRATIC_TO:{let te=L._p0.x(),J=L._p0.y(),oe=Ye.Command.quadraticToFirstX(M,Q),le=Ye.Command.quadraticToFirstY(M,Q),tt=Ye.Command.quadraticToX(M,Q),nt=Ye.Command.quadraticToY(M,Q);L._p1.setTo(oe+(te-oe)/3,le+(J-le)/3),L._p2.setTo(oe+(tt-oe)/3,le+(nt-le)/3),L._p3.setTo(tt,nt),u(X,L._p,L._p0,L._p3),s(X,L._p0,L._p1,L._p2,L._p3,0,0);break}case Ye.Command.Kind.CUBIC_TO:{L._p1.setTo(Ye.Command.cubicToFirstX(M,Q),Ye.Command.cubicToFirstY(M,Q)),L._p2.setTo(Ye.Command.cubicToSecondX(M,Q),Ye.Command.cubicToSecondY(M,Q)),L._p3.setTo(Ye.Command.cubicToX(M,Q),Ye.Command.cubicToY(M,Q)),u(X,L._p,L._p0,L._p3),s(X,L._p0,L._p1,L._p2,L._p3,0,0);break}default:break}L._p0.copyFrom(L._p3)}}L.compile=i;function e(Q){return Math.abs(Q)<L._EPSILON?0:Q}L._roundToZero=e;function t(Q,X){return Q.squaredDistanceTo(X)<L._EPSILON*L._EPSILON}L._approxEqual=t;function n(Q,X,M){let te=(M.x()-X.x())*(X.y()-Q.y())-(M.y()-X.y())*(X.x()-Q.x());return te<0?-1:te>0?1:0}L._orientation=n;function r(Q,X,M,te){return n(Q,X,M)!=n(Q,X,te)&&n(M,te,Q)!=n(M,te,X)}L._linesIntersect=r;function o(Q,X,M,te){let J=te.x()-X.x(),oe=te.y()-X.y(),le=M.x()-X.x(),tt=M.y()-X.y(),nt=Q.x()-X.x(),At=Q.y()-X.y(),Lt=J*J+oe*oe,Tt=J*le+oe*tt,de=J*nt+oe*At,yt=le*le+tt*tt,er=le*nt+tt*At,Wt=Lt*yt-Tt*Tt;if(Wt==0)return!1;let cn=1/Wt,Ot=(yt*de-Tt*er)*cn,st=(Lt*er-Tt*de)*cn,ut=1e-4;return Ot>=-ut&&st>=-ut&&Ot+st<=1+ut}L._pointInTriangle=o;function a(Q,X,M){return Q.x*(X.y*M.z-X.z*M.y)+Q.y*(X.z*M.x-X.x*M.z)+Q.z*(X.x*M.y-X.y*M.x)}L._dotCross=a;function s(Q,X,M,te,J,oe,le){if(oe==0||le<4){let Ot=J.x()-X.x(),st=J.y()-X.y(),ut=(M.x()-X.x())*st-(M.y()-X.y())*Ot,Ge=(te.x()-X.x())*st-(te.y()-X.y())*Ot,bt=3*ut-3*Ge,kt=-4*ut+2*Ge,xe=ut,wt=kt*kt-4*xe*bt;if(wt>0){let fn=-kt/(2*bt),_n=Math.sqrt(wt)/(2*bt),Gt=fn+_n,In=fn-_n;if(0<Gt&&Gt<1&&0<In&&In<1){let Qt=(Gt+In)/2;for(let W=0;W<10;W=W+1){let j=ut-Ge,se=Ge-2*ut,he=Qt*(Qt*(Qt*j+se)+ut),ve=Qt*(3*Qt*j+2*se)+ut;Qt-=he/ve}let ln=X.mixedWith(M,Qt),tr=M.mixedWith(te,Qt),lt=te.mixedWith(J,Qt),O=ln.mixedWith(tr,Qt),R=tr.mixedWith(lt,Qt),V=O.mixedWith(R,Qt);s(Q,X,ln,O,V,1,le+1),s(Q,V,R,lt,J,1,le+1),u(Q,X,V,J);return}}}L._b0.setTo(X.x(),X.y(),1),L._b1.setTo(M.x(),M.y(),1),L._b2.setTo(te.x(),te.y(),1),L._b3.setTo(J.x(),J.y(),1);let tt=a(L._b0,L._b3,L._b2),nt=a(L._b1,L._b0,L._b3),At=a(L._b2,L._b1,L._b0),Lt=tt-2*nt+3*At,Tt=-nt+3*At,de=3*At,yt=1/Math.sqrt(Lt*Lt+Tt*Tt+de*de);Lt*=yt,Tt*=yt,de*=yt;let er=3*Tt*Tt-4*Lt*de,Wt=Lt*Lt*er;switch(Lt=e(Lt),Tt=e(Tt),de=e(de),Wt=e(Wt),t(L._b0,L._b1)&&t(L._b0,L._b2)&&t(L._b0,L._b3)?0:Wt<0?4:Wt>0?5:Lt==0&&Tt==0?de==0?1:2:Lt==0?3:er<0?4:5){case 5:{let Ot=Math.sqrt(Math.max(0,9*Tt*Tt-12*Lt*de)),st=3*Tt-Ot,ut=6*Lt,Ge=3*Tt+Ot,bt=ut,kt=ut-st,xe=bt-Ge;d(Q,X,st*Ge,st*st*st,Ge*Ge*Ge,M,(3*st*Ge-st*bt-ut*Ge)/3,st*st*(st-ut),Ge*Ge*(Ge-bt),te,(ut*(bt-2*Ge)+st*(3*Ge-2*bt))/3,kt*kt*st,xe*xe*Ge,J,kt*xe,-kt*kt*kt,-xe*xe*xe);break}case 4:{let Ot=Math.sqrt(Math.max(0,4*Lt*de-3*Tt*Tt)),st=Tt-Ot,ut=2*Lt,Ge=Tt+Ot,bt=ut;if(oe!=2||le<4){let wt=st/ut,fn=Ge/bt,_n=L._EPSILON<wt&&wt<1-L._EPSILON,Gt=L._EPSILON<fn&&fn<1-L._EPSILON;if(_n&&Gt){l(Q,X,M,te,J,Math.min(wt,fn),Math.max(wt,fn),le+1);return}if(_n){l(Q,X,M,te,J,wt,-1,le+1);return}if(Gt){l(Q,X,M,te,J,fn,-1,le+1);return}}let kt=ut-st,xe=bt-Ge;d(Q,X,st*Ge,st*st*Ge,st*Ge*Ge,M,(-st*bt-ut*Ge+3*st*Ge)/3,-st*(st*(bt-3*Ge)+2*ut*Ge)/3,-Ge*(st*(2*bt-3*Ge)+ut*Ge)/3,te,(ut*(bt-2*Ge)+st*(3*Ge-2*bt))/3,(ut-st)*(st*(2*bt-3*Ge)+ut*Ge)/3,(bt-Ge)*(st*(bt-3*Ge)+2*ut*Ge)/3,J,kt*xe,-kt*kt*xe,-kt*xe*xe);break}case 3:{let Ot=de,st=3*Tt,ut=Ot-st;d(Q,X,Ot,Ot*Ot*Ot,1,M,Ot-st/3,Ot*Ot*ut,1,te,Ot-st*(2/3),ut*ut*Ot,1,J,ut,ut*ut*ut,1);break}case 2:{d(Q,X,0,0,0,M,1/3,0,1/3,te,2/3,1/3,2/3,J,1,1,1);break}}}L._compileCubic=s;function l(Q,X,M,te,J,oe,le,tt){let nt=X.mixedWith(M,oe),At=M.mixedWith(te,oe),Lt=te.mixedWith(J,oe),Tt=nt.mixedWith(At,oe),de=At.mixedWith(Lt,oe),yt=Tt.mixedWith(de,oe);if(u(Q,X,yt,J),s(Q,X,nt,Tt,yt,2,tt+1),le==-1){s(Q,yt,de,Lt,J,2,tt+1);return}let er=yt,Wt=de,cn=Lt,Ot=J,st=(le-oe)/(1-oe),ut=er.mixedWith(Wt,st),Ge=Wt.mixedWith(cn,st),bt=cn.mixedWith(Ot,st),kt=ut.mixedWith(Ge,st),xe=Ge.mixedWith(bt,st),wt=kt.mixedWith(xe,st);s(Q,er,ut,kt,wt,2,tt+1),s(Q,wt,xe,bt,Ot,2,tt+1)}L._compileSubdividedCubic=l;function d(Q,X,M,te,J,oe,le,tt,nt,At,Lt,Tt,de,yt,er,Wt,cn){L._v0.set(X,M,te,J),L._v1.set(oe,le,tt,nt),L._v2.set(At,Lt,Tt,de),L._v3.set(yt,er,Wt,cn);let Ot=(M+er)*(.9/2)+(le+Lt)*(.1/2),st=(te+Wt)*(.9/2)+(tt+Tt)*(.1/2),ut=(J+cn)*(.9/2)+(nt+de)*(.1/2),Ge=Ot*Ot*Ot-st*ut>0,bt=0,kt=0;for(let _n=0;_n<4;_n=_n+1){let Gt=ht.int_remainder(_n+1,4),In=ht.int_remainder(_n+2,4),Qt=ht.int_remainder(_n+3,4),ln=L._v[Gt].xy,tr=L._v[In].xy,lt=L._v[Qt].xy,O=ln.distanceTo(tr),R=tr.distanceTo(lt),V=lt.distanceTo(ln),W=(O+R+V)/2,j=W*(W-O)*(W-R)*(W-V);j>bt&&(bt=j,kt=_n)}let xe=ht.int_remainder(kt+1,4),wt=ht.int_remainder(kt+2,4),fn=ht.int_remainder(kt+3,4);if(o(L._v[kt].xy,L._v[xe].xy,L._v[wt].xy,L._v[fn].xy)){h(Q,L._v[xe],L._v[wt],L._v[fn],Ge);return}r(X,At,oe,yt)?X.squaredDistanceTo(At)<oe.squaredDistanceTo(yt)?(h(Q,L._v0,L._v1,L._v2,Ge),h(Q,L._v0,L._v2,L._v3,Ge)):(h(Q,L._v0,L._v1,L._v3,Ge),h(Q,L._v1,L._v2,L._v3,Ge)):r(X,yt,oe,At)?X.squaredDistanceTo(yt)<oe.squaredDistanceTo(At)?(h(Q,L._v0,L._v1,L._v3,!Ge),h(Q,L._v0,L._v3,L._v2,Ge)):(h(Q,L._v0,L._v1,L._v2,Ge),h(Q,L._v2,L._v1,L._v3,Ge)):X.squaredDistanceTo(oe)<At.squaredDistanceTo(yt)?(h(Q,L._v0,L._v2,L._v1,Ge),h(Q,L._v0,L._v1,L._v3,Ge)):(h(Q,L._v0,L._v2,L._v3,Ge),h(Q,L._v3,L._v2,L._v1,Ge))}L._appendQuad=d;function c(Q,X,M){return Q.equals(X)||Q.equals(M)||X.equals(M)}L._isEmptyTriangle=c;function p(Q,X,M,te,J,oe){Q.appendFloat(X).appendFloat(M),Q.appendFloat(te).appendFloat(J).appendFloat(oe)}L._appendVertex=p;function u(Q,X,M,te){c(X,M,te)||(p(Q,X.x(),X.y(),.5,.5,.5),p(Q,M.x(),M.y(),.5,.5,.5),p(Q,te.x(),te.y(),.5,.5,.5))}L._appendTriangle1=u;function h(Q,X,M,te,J){if(!c(X.xy,M.xy,te.xy)){let oe=J?-1:1;p(Q,X.xy.x(),X.xy.y(),X.k*oe,X.l*oe,X.m),p(Q,M.xy.x(),M.xy.y(),M.k*oe,M.l*oe,M.m),p(Q,te.xy.x(),te.xy.y(),te.k*oe,te.l*oe,te.m)}}L._appendTriangle2=h;class f{setTo(X,M,te){this.x=X,this.y=M,this.z=te}squaredDistanceTo(X){let M=this.x-X.x,te=this.y-X.y,J=this.z-X.z;return M*M+te*te+J*J}constructor(){this.x=0,this.y=0,this.z=0}}L.Vector3=f;class y{set(X,M,te,J){this.xy=X,this.k=M,this.l=te,this.m=J}constructor(){this.xy=null,this.k=0,this.l=0,this.m=0}}L.Vector5=y;let g;(te=>(te[te.INITIAL=0]="INITIAL",te[te.SUBDIVIDED_BECAUSE_OF_CROSSING=1]="SUBDIVIDED_BECAUSE_OF_CROSSING",te[te.SUBDIVIDED_BECAUSE_OF_LOOP=2]="SUBDIVIDED_BECAUSE_OF_LOOP"))(g=L.CompileState||(L.CompileState={}));let A;(le=>(le[le.POINT=0]="POINT",le[le.LINE=1]="LINE",le[le.QUADRATIC=2]="QUADRATIC",le[le.CUSP=3]="CUSP",le[le.LOOP=4]="LOOP",le[le.SERPENTINE=5]="SERPENTINE"))(A=L.SegmentClass||(L.SegmentClass={}));let T;(X=>{function Q(M){return g[M]}X.CompileState_toString=Q})(T=L.in_CompileState||(L.in_CompileState={}));let b;(X=>{function Q(M){return A[M]}X.SegmentClass_toString=Q})(b=L.in_SegmentClass||(L.in_SegmentClass={})),L._EPSILON=5e-4,L._p=I.new2(),L._p0=I.new2(),L._p1=I.new2(),L._p2=I.new2(),L._p3=I.new2(),L._b0=new f,L._b1=new f,L._b2=new f,L._b3=new f,L._v0=new y,L._v1=new y,L._v2=new y,L._v3=new y,L._v=[L._v0,L._v1,L._v2,L._v3]})(Zu||(Zu={}));var $u=class{constructor(e,t){this.key=e,this.value=t}},Ei=class{each(e){Ht.IntMap_each(this._buckets,(t,n)=>{for(let r of n)e(r.key,r.value)})}getOrInsertFallback(e){let t=this._hash(e),n=Ht.IntMap_get(this._buckets,t,null);if(n!=null){for(let o of n)if(this._equals(e,o.key))return o.value}else n=[],this._buckets.set(t,n);let r=this._fallback(e);return n.push(new $u(e,r)),r}get(e,t){let n=this._hash(e),r=Ht.IntMap_get(this._buckets,n,null);if(r!=null){for(let o of r)if(this._equals(e,o.key))return o.value}return t}set(e,t){let n=this._hash(e),r=Ht.IntMap_get(this._buckets,n,null);r==null&&(r=[],this._buckets.set(n,r));for(let o of r)if(this._equals(e,o.key)){o.value=t;return}r.push(new $u(e,t))}remove(e){let t=this._hash(e),n=Ht.IntMap_get(this._buckets,t,null);if(n!=null){for(let r=0,o=n.length;r<o;r=r+1)if(this._equals(e,n[r].key)){n.splice(r,1),n.length==0&&this._buckets.delete(t);break}}}constructor(e,t,n){this._buckets=new Map,this._hash=e,this._equals=t,this._fallback=n}};var qo=class qo{constructor(e,t,n){this.center=null,this.xRadius=0,this.yRadius=0,this._hash=0,this._cachedBezier=null,this.center=e,this.xRadius=t,this.yRadius=n,qo.hasher.reset(),qo.hasher.hash1(this.center.x()),qo.hasher.hash1(this.center.y()),qo.hasher.hash1(this.xRadius),qo.hasher.hash1(this.yRadius),this._hash=qo.hasher.value()}bounds(){return new G(this.center.x()-this.xRadius,this.center.y()-this.yRadius,this.xRadius*2,this.yRadius*2)}equals2(e){return e instanceof qo?this.equals1(e):!1}equals1(e){return this.center.equals(e.center)&&this.xRadius==e.xRadius&&this.yRadius==e.yRadius}clone(){return new qo(this.center.clone(),this.xRadius,this.yRadius)}hash(){return this._hash}isRect(){return!1}canBeAnalyticallyAntialiased(){return w.supportsWebGLExtensionOESStandardDerivatives()}toBezierPath(){return this._cachedBezier==null&&(this._cachedBezier=Et.forEllipse(this.bounds())),this._cachedBezier}asRoundedRectPath(){return null}static fromBounds(e){return new qo(e.center(),e.width()/2,e.height()/2)}};qo.hasher=new so;var $i=qo;var Dt=class{static didEncounterEasingFunctionInstantiation(){this.encounteredEasingFunctionInstantiation||(this.encounteredEasingFunctionInstantiation=!0),this.logIfWithinLoggingTimeFrame()}static didEncounterNestedBBInvisible(){this.encounteredNestedBBInvisible||(this.encounteredNestedBBInvisible=!0),this.logIfWithinLoggingTimeFrame()}static didEncounterNestedBBNotInDirtyNodes(){this.encounteredNestedBBNotInDirtyNodes||(this.encounteredNestedBBNotInDirtyNodes=!0),this.logIfWithinLoggingTimeFrame()}static didEncounterStaticRenderTreeAnimationOpt(){this.encounteredStaticRenderTreeAnimationOpt||(this.encounteredStaticRenderTreeAnimationOpt=!0),this.logIfWithinLoggingTimeFrame()}static didEncounterRoundedRectOptimization(){this.encounteredRoundedRectOptimization||(this.encounteredRoundedRectOptimization=!0),this.logIfWithinLoggingTimeFrame()}static didEncounterDebounceScrollHover(){this.encounteredDebounceScrollHover||(this.encounteredDebounceScrollHover=!0),this.logIfWithinLoggingTimeFrame()}static didEncounterFramebufferSwitchBudget(){this.encounteredFramebufferSwitchBudget||(this.encounteredFramebufferSwitchBudget=!0),this.logIfWithinLoggingTimeFrame()}static didEncounterSmartAnimateCacheTransform(){this.encounteredSmartAnimateCacheTransform||(this.encounteredSmartAnimateCacheTransform=!0),this.logIfWithinLoggingTimeFrame()}static didEncounterCullTreesDuringTilePrioritization(){this.encounteredCullTreesDuringTilePrioritization||(this.encounteredCullTreesDuringTilePrioritization=!0),this.logIfWithinLoggingTimeFrame()}static didEncounterBackgroundBlurBoundsOpt(){this.encounteredBackgroundBlurBoundsOpt||(this.encounteredBackgroundBlurBoundsOpt=!0),this.logIfWithinLoggingTimeFrame()}static didEncounterCTGEqualWithinBounds(){this.encounteredCTGEqualWithinBounds||(this.encounteredCTGEqualWithinBounds=!0),this.logIfWithinLoggingTimeFrame()}static didEncounterTimeSlicedIFLMessage(){this.encounteredTimeSlicedIFLMessage||(this.encounteredTimeSlicedIFLMessage=!0),this.logIfWithinLoggingTimeFrame()}static didEncounterLargeTilesForDrawToScreen(){this.encounteredLargeTilesForDrawToScreen||(this.encounteredLargeTilesForDrawToScreen=!0),this.logIfWithinLoggingTimeFrame()}static logIfWithinLoggingTimeFrame(){Y.optimizationExposureLogging()&&Date.now()-this.MIN_LOG_PERIODICITY_MS>this.lastLoggedTimeMs&&this.logAndClearEventFlags()}static logAndClearEventFlags(){let e=new Map;this.encounteredRoundedRectOptimization&&e.set("rndMask",Y.roundedMaskOptimization()),this.encounteredDebounceScrollHover&&e.set("dbnce",Y.debounceMouseMoveScrolling()),this.encounteredFramebufferSwitchBudget&&e.set("framebuffer",Y.enableFramebufferSwitchBudget()),this.encounteredSmartAnimateCacheTransform&&e.set("abstransform",Y.smartAnimateCacheTransform()),this.encounteredCullTreesDuringTilePrioritization&&e.set("culltrees",Y.cullTreesDuringTilePrioritization()),this.encounteredNestedBBNotInDirtyNodes&&e.set("nestedBBNotDirty",Y.viewerSkipNotDirtyTreeOpt()),this.encounteredNestedBBInvisible&&e.set("nestedBBInvis",Y.viewerSkipInvisibleTreeOpt()),this.encounteredBackgroundBlurBoundsOpt&&e.set("bblurbounds",Y.backgroundBlurBoundsOpt()),this.encounteredEasingFunctionInstantiation&&e.set("easingCache",Y.viewerAnimationEasingCache()),this.encounteredCTGEqualWithinBounds&&e.set("ctgequal",Y.compositeTileGridEqualWithinBounds()),this.encounteredStaticRenderTreeAnimationOpt&&e.set("staticTree",Y.useStaticRenderTreeIfNonAnimatingSubtree()),this.encounteredTimeSlicedIFLMessage&&e.set("timeSliceIFL",Y.prototypeIFLTimeSlice()),this.encounteredLargeTilesForDrawToScreen&&e.set("largeTiles",Y.viewerLargeTilesDrawToScreen()),qt.getEventEmitter().trigger("optimExpos",e),this.encounteredRoundedRectOptimization=!1,this.encounteredDebounceScrollHover=!1,this.encounteredFramebufferSwitchBudget=!1,this.encounteredSmartAnimateCacheTransform=!1,this.encounteredCullTreesDuringTilePrioritization=!1,this.encounteredNestedBBNotInDirtyNodes=!1,this.encounteredNestedBBInvisible=!1,this.encounteredBackgroundBlurBoundsOpt=!1,this.encounteredEasingFunctionInstantiation=!1,this.encounteredCTGEqualWithinBounds=!1,this.encounteredStaticRenderTreeAnimationOpt=!1,this.encounteredTimeSlicedIFLMessage=!1,this.encounteredLargeTilesForDrawToScreen=!1,this.lastLoggedTimeMs=Date.now()}};Dt.MIN_LOG_PERIODICITY_MS=15e3,Dt.lastLoggedTimeMs=-1,Dt.encounteredRoundedRectOptimization=!1,Dt.encounteredDebounceScrollHover=!1,Dt.encounteredFramebufferSwitchBudget=!1,Dt.encounteredSmartAnimateCacheTransform=!1,Dt.encounteredCullTreesDuringTilePrioritization=!1,Dt.encounteredNestedBBNotInDirtyNodes=!1,Dt.encounteredNestedBBInvisible=!1,Dt.encounteredBackgroundBlurBoundsOpt=!1,Dt.encounteredEasingFunctionInstantiation=!1,Dt.encounteredCTGEqualWithinBounds=!1,Dt.encounteredStaticRenderTreeAnimationOpt=!1,Dt.encounteredTimeSlicedIFLMessage=!1,Dt.encounteredLargeTilesForDrawToScreen=!1;var Mg=class{constructor(e,t,n,r){this.key=e,this.value=t,this.prev=n,this.next=r,this.lastUsedGeneration=0}},hl=class{constructor(){if(arguments.length==1){let e=arguments[0];this._nodeByKey=new Map,this._maxElements=0,this._size=0,this._head=null,this._tail=null,this._afterEvict=null,this._generation=1,this._maxElements=e}else if(arguments.length==2){let e=arguments[0],t=arguments[1];this._nodeByKey=new Map,this._maxElements=0,this._size=0,this._head=null,this._tail=null,this._afterEvict=null,this._generation=1,this._maxElements=e,this._afterEvict=t}}maximumCapacity(){return this._maxElements}atMaximumCapacity(){return this._size==this._maxElements}increaseCapacity(e){this._maxElements=this._maxElements+e}capacityUsedForGeneration(){return this.atMaximumCapacity()?this._tail.lastUsedGeneration==this._generation:!1}incrementGeneration(){if(this._generation===Number.MAX_SAFE_INTEGER-1){this._generation=1;for(let e of Array.from(this._nodeByKey.keys()))this._nodeByKey.get(e).lastUsedGeneration=0}else this._generation=this._generation+1}keys(){return Array.from(this._nodeByKey.keys())}_in(e){return this._nodeByKey.has(e)?(this._moveElemToHead(this._nodeByKey.get(e)),!0):!1}count(){return this._size}get1(e){return this._moveElemToHead(this._nodeByKey.get(e)),this._nodeByKey.get(e).value}get(e,t){let n=Be.StringMap_get(this._nodeByKey,e,null);return n==null?t:(this._moveElemToHead(n),n.value)}tailElement(){return this._tail.value}set(e,t){let n=Be.StringMap_get(this._nodeByKey,e,null);if(n!=null)this._moveElemToHead(n),n.value=t;else if(n=new Mg(e,t,null,null),this._addElemAsHead(n),this._nodeByKey.set(e,n),this._size=this._size+1,this._size>this._maxElements){let r=this._tail.value,o=this._tail.key;this.remove(this._tail.key),this._afterEvict!=null&&this._afterEvict(o,r)}}remove(e){let t=Be.StringMap_get(this._nodeByKey,e,null);t!=null&&(this._nodeByKey.delete(t.key),this._removeFromList(t),this._size=this._size-1)}removeValue(e){let t=[];Be.StringMap_each(this._nodeByKey,(n,r)=>{r.value==e&&t.push(n)}),t.forEach(n=>{this.remove(n)})}makeLeastRecent(e){let t=Be.StringMap_get(this._nodeByKey,e,null);t!=null&&(this._removeFromList(t),this._addElemAsTail(t))}_moveElemToHead(e){this._removeFromList(e),this._addElemAsHead(e)}_removeFromList(e){let t=e.prev,n=e.next;t!=null&&(t.next=n),n!=null&&(n.prev=t),e==this._tail&&(this._tail=t),e==this._head&&(this._head=n),e.next=e.prev=null}_addElemAsHead(e){this._head==null?this._head=this._tail=e:(e.prev=null,e.next=this._head,e.next.prev=e,this._head=e),this._head.lastUsedGeneration=this._generation}_addElemAsTail(e){this._tail==null?this._tail=this._head=e:(e.next=null,e.prev=this._tail,e.prev.next=e,this._tail=e),this._tail.lastUsedGeneration=0}};var mo=class mo{static numInitialTextures(){return Je.isMobile(Je.current())||Je.current()==4&&navigator.maxTouchPoints>0||Rt.forceMobileOptimizations()?3:6}static numInitialTiles(e){return mo.numInitialTextures()*e*e}_createNewTexture(){let e=w.in_Context.Context_createTexture1(this._context,w.TextureFormat.RGBA_LINEAR_MIN_NEAREST_MAG_CLAMP,this._tilesPerSide*mo.TILE_SIZE,this._tilesPerSide*mo.TILE_SIZE,"TileAtlas"),t=this._context.createFramebuffer(e,null,"Tile Atlas");this._tileCacheFramebuffers.push(t)}allocateTile(){let e=`tile${this._tileIdCounter}`;this._tileIdCounter=this._tileIdCounter+1,this._tilesLRU.capacityUsedForGeneration()&&(this._createNewTexture(),this._tilesLRU.increaseCapacity(this._tilesPerSide*this._tilesPerSide),console.warn("allocated new texture in the atlas to handle demand for current frame"));let t=this._tilesLRU.atMaximumCapacity()?this._tilesLRU.tailElement().tileIndex:this._tilesLRU.count();return this._tilesLRU.set(e,new mo.CachedTileMetadata(t,!1,this._context.maxTextureSize())),e}maximumCapacity(){return this._tilesLRU.maximumCapacity()}prepareForNewFrame(){this._tilesLRU.incrementGeneration()}totalVRAM(){let e=0;for(let t of this._tileCacheFramebuffers)e=e+w.in_Texture.Texture_totalVRAM(t.colorTexture());return e}tilesPerTexture(){return this._tilesPerSide*this._tilesPerSide}tileIsStillValid(e){return this._tilesLRU._in(e)}framebufferForTile(e){let t=this._tilesLRU.get1(e).tileIndex;return this._tileCacheFramebuffers[t/(this._tilesPerSide*this._tilesPerSide)|0]}devalueTile(e){this._tilesLRU.makeLeastRecent(e)}getTexture(e){return this._tileCacheFramebuffers[e].colorTexture()}viewportForTile(e,t){let n=this._tilesLRU.get1(e).tileIndex,r=ht.int_remainder(n,this._tilesPerSide),o=ht.int_remainder(n/this._tilesPerSide|0,this._tilesPerSide);t.setTo1(r*mo.TILE_SIZE,o*mo.TILE_SIZE,mo.TILE_SIZE,mo.TILE_SIZE)}clearCache(){let t=this._tileCacheFramebuffers.length*this._tilesPerSide*this._tilesPerSide;this._tilesLRU=new hl(t,this._afterEvictOrNull)}constructor(e,t){this._afterEvictOrNull=null,this._tileIdCounter=0,this._tilesLRU=null,this._tilesPerSide=0,this._tileCacheFramebuffers=[],this._context=null,this._afterEvictOrNull=t,this._tilesPerSide=e.maxTextureSize()/mo.TILE_SIZE|0,this._tilesLRU=new hl(mo.numInitialTiles(this._tilesPerSide),this._afterEvictOrNull),e.addContextResetHandler(()=>{this.clearCache()}),this._context=e;for(let n=0,r=mo.numInitialTextures();n<r;n=n+1)this._createNewTexture()}};mo.TILE_SIZE=512;var yn=mo;(e=>{class i{cacheViewport(){let n=this.maxTextureSize/e.TILE_SIZE|0,r=ht.int_remainder(this.tileIndex,n),o=ht.int_remainder(this.tileIndex/n|0,n);return new G(r*e.TILE_SIZE,o*e.TILE_SIZE,e.TILE_SIZE,e.TILE_SIZE)}constructor(n,r,o){this.tileIndex=0,this.isValid=!1,this.includesBackgroundColor=!1,this.maxTextureSize=0,this.tileIndex=n,this.includesBackgroundColor=r,this.isValid=!0,this.maxTextureSize=o}}e.CachedTileMetadata=i})(yn||(yn={}));var Ub=Wa(sb());var $C=["APPLE_IPHONE_14_PRO","APPLE_IPHONE_14_PLUS","APPLE_IPHONE_15","APPLE_WATCH_45MM"],lb=i=>$C.some(e=>i.startsWith(e));var Uc=class{constructor(e,t,n,r){this._delayFrames=0,this._onChange=null,this._equals=null,this._nextUpdateAfterFrameCount=-1,this._value=null,this._queuedValue=null,this._delayFrames=t,this._equals=n,this._onChange=r,e(this)}onFrame(){this._nextUpdateAfterFrameCount>0&&(this._nextUpdateAfterFrameCount=this._nextUpdateAfterFrameCount-1,this._nextUpdateAfterFrameCount<=0&&(this._value=this._queuedValue,this._queuedValue=null,this._nextUpdateAfterFrameCount=-1,this._onChange()))}_updateQueuedValue(e){this._queuedValue=new _e(e),this._nextUpdateAfterFrameCount=this._delayFrames}hasQueuedValue(){return this._queuedValue!=null}queueValue(e){if(this._value==null){this._value=new _e(e),this._onChange();return}if(this._queuedValue!=null){if(this._equals(this._queuedValue.value,e))return;this._updateQueuedValue(e);return}else this._equals(this._value.value,e)||this._updateQueuedValue(e)}getValue(){return this._value.value}clear(){this._value=null,this._queuedValue=null,this._nextUpdateAfterFrameCount=-1}unregister(e){e(this)}};function Gc(i,e){let t=new WeakMap,n=null;return r=>{let o=e(r);if(o===null)return n==null&&(n=new _e(i(r))),n.value;if(t.has(o))return t.get(o);let a=i(r);return t.set(o,a),a}}function kg(i){return Gc(i,e=>e)}function e1(i,e,t){let n=Gc(r=>Gc(o=>i(r,o),t),e);return(r,o)=>n(r)(o)}function cb(i,e,t,n){let r=e1((o,a)=>Gc(s=>i(o,a,s),n),e,t);return(o,a,s)=>r(o,a)(s)}function ep(i,e,t,n,r){let o=cb((a,s,l)=>Gc(d=>i(a,s,l,d),r),e,t,n);return(a,s,l,d)=>o(a,s,l)(d)}var tp=class{constructor(e,t){this._context=null,this._bufferPool=null,this._deviceImageManager=new Br,this._deviceFrameMaterial=null,this._deviceFrameQuad=null,this._hasPendingFrame=!1,this._context=e,this._bufferPool=t,this._materialStrings=Fn.instance();let n=new Uint8Array(new Float32Array([0,0,0,1,0,1,0,0,1,0,1,1,1,1,1,0]).buffer);this._deviceFrameQuad=this._bufferPool.allocate(w.VertexFormat.getPositionF4(),n),this._deviceFrameMaterial=this._context.createMaterial("deviceFrame",w.VertexFormat.getPositionF4(),this._materialStrings.GLSLX_SOURCE_RENDER_DEVICE_FRAME_VERTEX,this._materialStrings.GLSLX_SOURCE_RENDER_DEVICE_FRAME_FRAGMENT)}clearOnContextReset(){this._hasPendingFrame=!1,this._deviceImageManager.clearOnContextReset()}flush(){this._hasPendingFrame&&(w.in_Context.Context_setPremultipliedBlendState(this._context),this._context.draw(w.Primitive.TRIANGLE_STRIP,this._deviceFrameMaterial,this._deviceFrameQuad),this._hasPendingFrame=!1)}isWaitingForDeviceFrameToLoad(e){let t=Br.infoForDevice(e);if(t==null)return!1;let n=this._deviceImageManager.getImage(t,this._context);return!n.isDecoded()&&!n.loadDidFail()}canRenderDeviceFrame(e){let t=Br.infoForDevice(e);return t==null?!1:this._deviceImageManager.getImage(t,this._context).isDecoded()}pixelAtPosition(e,t,n){if(t==null)return E.TRANSPARENT;let r=Br.infoForDevice(n);if(r==null)return E.TRANSPARENT;let o=this._deviceImageManager.getImage(r,this._context);if(!o.isDecoded()||o.width()<=0||o.height()<=0)return E.TRANSPARENT;let a=o.decodedData(),s=n.canvasSpaceTopLeftOffset(r),l=t.topLeft().subtract1(s),d=n.canvasSpaceImageSize(r),c=e.subtract1(l).divide1(d);switch(n.rotation){case"NONE":break;case"CCW_90":{c=new I(1-c.y(),c.x());break}default:break}let p=c.x()*r.nonRotatedImageSize.x()|0,u=c.y()*r.nonRotatedImageSize.y()|0;return a.pixelAtIndex(p,u)}drawPrototypeDeviceIfAny(e,t,n,r){if(n==null)return;let o=Br.infoForDevice(t);if(o==null)return;let a=this._deviceImageManager.getImage(o,this._context);if(!a.isDecoded()&&!a.loadDidFail()){e.invalidate();return}if(a.width()<=0||a.height()<=0)return;let s=a.texture().width()/o.scaleFactor,l=a.texture().height()/o.scaleFactor,d=o.nonRotatedOffset,c=n.topLeft().subtract1(d),p=G.new2();p.setTo1(c.x(),c.y(),s,l);let u=ne.new2();u.copyFrom(r),u.translate2(p.x(),p.y()),t.rotation=="CCW_90"&&(u.translate1(o.nonRotatedOffset),u.rotate(-Math.PI/2),u.translate1(o.nonRotatedOffset.negative()),u.translate2(-o.nonRotatedFramePresetSize.x(),0)),u.scale4(p.width(),p.height()),w.in_Material.Material_setUniformMat32(this._deviceFrameMaterial,this._materialStrings.GLSLX_NAME_U_VERTEX_TRANSFORM,u),this._deviceFrameMaterial.setUniformSampler(this._materialStrings.GLSLX_NAME_U_TEXTURE0,a.texture(),0),this._hasPendingFrame=!0}};var Hc=class{constructor(e){this._dirtyNewBoundsBuilder=new _t,this._dirtyOldBoundsBuilder=new _t,this._onBoundsInvalidate=null,this._cachedCanvasSpaceBounds=new Map,this._dirtyNodes=new Map,this._canvasSpaceDirtyNewBounds=G.new2(),this._canvasSpaceDirtyOldBounds=G.new2(),this._onBoundsInvalidate=e}initCanvas(e){this._dirtyNodes=new Map,this._cachedCanvasSpaceBounds=new Map,e!=null&&this._initCachedBounds(e)}handleSceneGraphEvent(e){switch(e.property){case 62:case 26:case 70:case 28:case 48:case 16:case 29:case 69:case 46:case 71:case 17:case 47:case 27:case 30:case 88:break;case 20:case 21:case 34:case 66:{this.dirtyNode(e.node);break}default:{this.dirtyNode(e.node);break}}}handleImageLoaded(e){this.dirtyNode(e)}dirtyNode(e){this._dirtyNodes.set(e.id(),e.id())}invalidateDirtyTiles(e,t){if(e==null||this._dirtyNodes.size==0)return;let n=[],r=new Map;this._dirtyOldBoundsBuilder.reset(),this._dirtyNewBoundsBuilder.reset(),Be.StringMap_each(this._dirtyNodes,(o,a)=>{let s=e.scene().findNode1(a);if(s!=null&&s.type()=="CANVAS"){this._onBoundsInvalidate(null);return}let l=s==null?void 0:s.topLevelAncestor();if(l!=null){if(!l.hasBeenLoaded())return;r.set(l.id(),!0)}let d=Be.StringMap_get(this._cachedCanvasSpaceBounds,o,null),c=s==null?void 0:s.canvasSpaceRenderedBounds();if(d!=null&&this._dirtyOldBoundsBuilder.include3(d),c!=null?(this._dirtyNewBoundsBuilder.include3(c),this._cachedCanvasSpaceBounds.set(o,c)):this._cachedCanvasSpaceBounds.delete(o),t.overlayRenderData()!=null){let p=t.overlayRenderData();if(p!=null)for(let u of p.keys()){let h=p.get2(u),f=d!=null&&d.overlaps(h.bounds),y=c!=null&&c.overlaps(h.bounds);(f||y)&&r.set(h.overlayId,!0)}}}),Pe.appTimerStart("invalidateNestedBackgroundBlurRenderTrees"),e.invalidateNestedBackgroundBlurRenderTrees(r,n),Pe.appTimerStop("invalidateNestedBackgroundBlurRenderTrees");for(let o=0,a=n.length;o<a;o=o+1){let s=n[o];this._dirtyOldBoundsBuilder.include3(s)}this._dirtyOldBoundsBuilder.isValid()&&(this._dirtyOldBoundsBuilder.buildTo(this._canvasSpaceDirtyOldBounds),this._onBoundsInvalidate(this._canvasSpaceDirtyOldBounds)),this._dirtyNewBoundsBuilder.isValid()&&(this._dirtyNewBoundsBuilder.buildTo(this._canvasSpaceDirtyNewBounds),this._onBoundsInvalidate(this._canvasSpaceDirtyNewBounds)),this._dirtyNodes=new Map}_initCachedBounds(e){for(let t=0,n=e.childCount();t<n;t=t+1){let r=e.childAt1(t);this._cachedCanvasSpaceBounds.set(r.id(),r.canvasSpaceRenderedBounds()),this._initCachedBounds(r)}}};var np=class{constructor(e,t,n,r){this.ax=0,this.bx=0,this.cx=0,this.cy=0,this.by=0,this.ay=0,this.cx=3*e,this.bx=3*(n-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(r-t)-this.cy,this.ay=1-this.cy-this.by}_sampleCurveX(e){return((this.ax*e+this.bx)*e+this.cx)*e}_sampleCurveY(e){return((this.ay*e+this.by)*e+this.cy)*e}_sampleCurveDerivativeX(e){return(3*this.ax*e+2*this.bx)*e+this.cx}_sampleCurveDerivativeY(e){return(3*this.ay*e+2*this.by)*e+this.cy}_solveCurveX(e,t){let n=0,r=0,o=0,a=0,s=0;o=e;for(let l=0;l<8;l=l+1){if(a=this._sampleCurveX(o)-e,Math.abs(a)<t)return o;if(s=this._sampleCurveDerivativeX(o),Math.abs(s)<1e-6)break;o=o-a/s}if(n=0,r=1,o=e,o<n)return n;if(o>r)return r;for(;n<r;){if(a=this._sampleCurveX(o),Math.abs(a-e)<t)return o;e>a?n=o:r=o,o=(r-n)*.5+n}return o}solve(e,t){return this._sampleCurveY(this._solveCurveX(e,t))}getYDerivativeForXValue(e,t){let n=this._solveCurveX(e,t),r=this._sampleCurveDerivativeX(n);return Math.abs(r)>0?this._sampleCurveDerivativeY(n)/r:this._sampleCurveDerivativeY(n)}},rp=class{constructor(e,t){this._bezier=null,this._bezierInverse=null,this._durationSeconds=0,this._bezier=this.bezierForEasingFunction(e),this._bezierInverse=this.inverseBezierForEasingFunction(e),this._durationSeconds=t}bezierForEasingFunction(e){return e==null||e.length!=4?null:new np(e[0],e[1],e[2],e[3])}inverseBezierForEasingFunction(e){return e==null||e.length!=4?null:new np(e[1],e[0],e[3],e[2])}_solveEpsilon(e){return 1/(200*e)}getYValueForXValue(e){if(this._bezier==null)return e;let t=this._solveEpsilon(this._durationSeconds);return this._bezier.solve(e,t)}getDerivative(e,t){if(this._bezier==null)return 1;let n=this._solveEpsilon(this._durationSeconds);return this._bezier.getYDerivativeForXValue(e,n)}invert(e){if(this._bezier==null)return e;let t=this._solveEpsilon(this._durationSeconds);return this._bezierInverse.solve(e,t)}};var Ug=class{constructor(e,t,n,r){this.m_w0=0,this.m_zeta=0,this.m_wd=0,this.m_A=0,this.m_B=0,this.m_w0=Math.sqrt(t/e),this.m_zeta=n/(2*Math.sqrt(t*e)),this.m_zeta<1?(this.m_wd=this.m_w0*Math.sqrt(1-this.m_zeta*this.m_zeta),this.m_A=1,this.m_B=(this.m_zeta*this.m_w0+-r)/this.m_wd):(this.m_A=1,this.m_B=-r+this.m_w0)}solve(e){return this.m_zeta<1?e=Math.exp(-e*this.m_zeta*this.m_w0)*(this.m_A*Math.cos(this.m_wd*e)+this.m_B*Math.sin(this.m_wd*e)):e=(this.m_A+this.m_B*e)*Math.exp(-e*this.m_w0),1-e}solveInverse(e){let t=0,n=0,r=Math.PI/this.m_w0,o=this.solve(r),a=0,s=.001,l=15;for(let d=0;d<l;d=d+1){a=(e-n)/(o-n)*(r-t)+t;let c=this.solve(a);if(Math.abs(c-e)<s)return a;c>e?(t=a,n=c):(r=a,o=c)}return a}},op=class{constructor(e,t){this._spring=null,this._durationSeconds=0,this._spring=this.convertFunctionToUnitSpring(e),this._durationSeconds=t}convertFunctionToUnitSpring(e){return e==null||e.length!=4?null:new Ug(e[0],e[1],e[2],e[3])}getYValueForXValue(e){if(this._spring==null)return e;let t=e*this._durationSeconds;return this._spring.solve(t)}getDerivative(e,t){return this._spring==null?1:t}invert(e){return this._spring==null?e:this._spring.solveInverse(e)/this._durationSeconds}};var ub=(t=>(t[t.BEZIER=0]="BEZIER",t[t.SPRING=1]="SPRING",t))(ub||{}),Nr=class Nr{static easingFunctionCallbackCleanup(e){Nr.easingFunctionCache.delete(e)}static cleanCache(){for(var e of Nr.easingFunctionCache.entries())e[1].deref()===void 0&&(Nr.easingFunctionCache.delete(e[0]),Nr.easingFunctionCacheFinalizer.unregister(e[1]))}static makeEasingFunctionWithEasingType(e,t,n,r=!0){var s;Nr.cleanCache(),(s=Y)!=null&&s.optimizationExposureLogging()&&Dt.didEncounterEasingFunctionInstantiation();let o=null;if(r){o=this.createCacheKey(e,t,this.getAnimationType(n));let l=Nr.easingFunctionCache.get(o);if(l!==void 0)return l.deref()}let a=new Nr(e,t,n);if(r){let l=new WeakRef(a);Nr.easingFunctionCache.set(o,l),Nr.easingFunctionCacheFinalizer.register(a,o,l)}return a}static makeEasingFunction(e,t,n=!0){return Nr.makeEasingFunctionWithEasingType(e,t,null,n)}static createCacheKey(e,t,n){let r=[];for(var o of e)r.push(o.toFixed(2));return r.push(";"),r.push(t.toFixed(2)),r.push(n),r.join()}static getAnimationType(e){return e=="GENTLE_SPRING"||e=="SPRING_PRESET_ONE"||e=="SPRING_PRESET_TWO"||e=="SPRING_PRESET_THREE"||e=="CUSTOM_SPRING"?1:0}constructor(e,t,n){this._easingFunction=e,this._animationType=Nr.getAnimationType(n),this._durationSeconds=t,this._createAnimationUnit(this._easingFunction),this.bounds=Nr.boundsForEasingFunction(this._easingFunction)}_createAnimationUnit(e){this._animationType==0?this._animationFunction=new rp(e,this._durationSeconds):this._animationType==1&&(this._animationFunction=new op(e,this._durationSeconds))}get(e){return this._animationFunction.getYValueForXValue(e)}getDerivative(e,t){return this._animationFunction.getDerivative(e,t)}invert(e){return this._animationFunction.invert(e)}static boundsForEasingFunction(e){if(e==null)return Kn.FrozenRect_new3(G.fromMinAndMax(0,0,1,1));let t=Ie.FrozenVector_new4(0,0),n=Ie.FrozenVector_new4(e[0],e[1]),r=Ie.FrozenVector_new4(e[2],e[3]),o=Ie.FrozenVector_new4(1,1),a=t.clone(),s=o.clone(),l=t.negative().add1(n),d=t.subtract1(n.multiply(2)).add1(r),c=t.negative().add1(n.multiply(3)).subtract1(r.multiply(3)).add1(o),p=d.multiply1(d).subtract1(c.multiply1(l));if(p.x()>0){p.setX(Math.sqrt(p.x()));for(let u of[(-d.x()-p.x())/c.x(),(-d.x()+p.x())/c.x()])if(u>0&&u<1){let h=1-u,f=h*h*h*t.x()+3*h*h*u*n.x()+3*h*u*u*r.x()+u*u*u*o.x();a.setX(Math.min(a.x(),f)),s.setX(Math.max(s.x(),f))}}if(p.y()>0){p.setY(Math.sqrt(p.y()));for(let u of[(-d.y()-p.y())/c.y(),(-d.y()+p.y())/c.y()])if(u>0&&u<1){let h=1-u,f=h*h*h*t.y()+3*h*h*u*n.y()+3*h*u*u*r.y()+u*u*u*o.y();a.setY(Math.min(a.y(),f)),s.setY(Math.max(s.y(),f))}}return G.fromMinAndMax(a.x(),a.y(),s.x(),s.y())}static easingValuesForPreset(e){switch(e){case"IN_CUBIC":return[.42,0,1,1];case"OUT_CUBIC":return[0,0,.58,1];case"INOUT_CUBIC":return[.42,0,.58,1];case"LINEAR":return[0,0,1,1];case"IN_BACK_CUBIC":return[.3,-.05,.7,-.5];case"OUT_BACK_CUBIC":return[.45,1.45,.8,1];case"INOUT_BACK_CUBIC":return[.7,-.4,.4,1.4];case"CUSTOM_CUBIC":return[0,0,.58,1];case"GENTLE_SPRING":return[1,100,15,0];case"SPRING_PRESET_ONE":return[1,300,20,0];case"SPRING_PRESET_TWO":return[1,600,15,0];case"SPRING_PRESET_THREE":return[1,80,20,0];case"CUSTOM_SPRING":return[1,100,15,0]}return[0,0,.58,1]}};Nr.easingFunctionCache=new Map,Nr.easingFunctionCacheFinalizer=new FinalizationRegistry(Nr.easingFunctionCallbackCleanup);var Ur=Nr,db;(e=>{function i(t){return ub[t]}e.AnimationType_toString=i})(db||(db={}));var ip=class{onClick(){this._timeOfLastClick=ke.seconds()}getOpacity(){let e=ke.seconds()-this._timeOfLastClick;return e<this._animationDuration?1-this._easingFunction.get(e):0}constructor(){var e;this._animationDuration=.7,this._easingFunction=Ur.makeEasingFunction([0,0,.58,1],.7,(e=Y)==null?void 0:e.viewerAnimationEasingCache()),this._timeOfLastClick=0}},ap=class{constructor(e,t){this._hotspotMaterial=null,this._hotspotQuad=null,this._context=null,this._context=e,this._materialStrings=Fn.instance(),this._hotspotMaterial=this._context.createMaterial("hotspot",w.VertexFormat.getPositionF4(),this._materialStrings.GLSLX_SOURCE_RENDER_HOTSPOT_VERTEX,this._materialStrings.GLSLX_SOURCE_RENDER_HOTSPOT_FRAGMENT);let n=new Uint8Array(new Float32Array([0,0,0,1,0,1,0,0,1,0,1,1,1,1,1,0]).buffer);this._hotspotQuad=t.allocate(w.VertexFormat.getPositionF4(),n)}draw(e,t,n,r,o){if(r<=0)return;let a=e;for(let s of n){let l=ne.new2();l.copyFrom(a);let d=s.canvasSpaceBounds;l.translate2(d.x(),d.y()),l.scale4(d.width(),d.height());let c=G.new2();s.canvasSpaceClipBounds.transformInto1(c,a);let p=new I(2/d.width(),2/d.height());p.divideUpdate(t*o),w.in_Material.Material_setUniformMat32(this._hotspotMaterial,this._materialStrings.GLSLX_NAME_U_VERTEX_TRANSFORM,l),w.in_Material.Material_setUniformVec22(this._hotspotMaterial,this._materialStrings.GLSLX_NAME_U_STROKE_PROPORTION,p),this._hotspotMaterial.setUniformVec41(this._materialStrings.GLSLX_NAME_U_UV_HOTSPOT_CLIPPING_RECT,c.x(),c.y(),c.width(),c.height()),this._hotspotMaterial.setUniformFloat(this._materialStrings.GLSLX_NAME_U_HOTSPOT_OPACITY,r),w.in_Context.Context_setUnpremultipliedBlendState(this._context),this._context.draw(w.Primitive.TRIANGLE_STRIP,this._hotspotMaterial,this._hotspotQuad)}}},zc=class{constructor(e,t){this.canvasSpaceBounds=e,this.canvasSpaceClipBounds=t}},sp=class{constructor(){this.backgroundColor=0,this.hotspots=null,this.hotspotOpacity=0,this.particles=null,this.mouse=null,this.renderDots=!1}};var lr=class lr{count(){return this._heap.length}peek(){if(this.count()==0)throw new Error("Peeking on an empty queue");return this._heap[lr.ROOT_INDEX].value}insertOrUpdate(e,t){if(this._indexByElement.has(e)){this.remove(e),this.insertOrUpdate(e,t);return}let n=new lr.Element(e,t);this._heap.push(n),this._indexByElement.set(n.value,this.count()-1),this._siftUp(this.count()-1)}getPriority(e){if(!this._indexByElement.has(e))return null;let t=this._indexByElement.get(e),n=this._heap[t];return new _e(n.priority)}remove(e){if(!this._indexByElement.has(e))return;let t=this._indexByElement.get(e),n=this.count()-1;n>t&&this._swap(t,n);let r=this._heap.pop();this._indexByElement.delete(r.value),t!=n&&(this._siftDown(t),this._siftUp(t))}allValues(){return this._heap.map(e=>e.value)}maxPriority(){if(this.count()==0)throw new Error("Calling maxPriority on an empty queue");return this._heap[lr.ROOT_INDEX].priority}pop(){if(this.count()==0)throw new Error("Popping an empty queue");let e=this.peek();return this.remove(e),e}_isGreater(e,t){return this._compare(this._heap[e].priority,this._heap[t].priority)>0}_swap(e,t){let n=this._heap[e];this._heap[e]=this._heap[t],this._heap[t]=n,this._indexByElement.set(this._heap[e].value,e),this._indexByElement.set(this._heap[t].value,t)}_siftUp(e){let t=e;for(;t>lr.ROOT_INDEX&&this._isGreater(t,lr.indexOfParent(t));)this._swap(t,lr.indexOfParent(t)),t=lr.indexOfParent(t)}_siftDown(e){let t=e;for(;lr.indexOfLeftChild(t)<this.count()&&this._isGreater(lr.indexOfLeftChild(t),t)||lr.indexOfRightChild(t)<this.count()&&this._isGreater(lr.indexOfRightChild(t),t);){let n=lr.indexOfRightChild(t)<this.count()&&this._isGreater(lr.indexOfRightChild(t),lr.indexOfLeftChild(t))?lr.indexOfRightChild(t):lr.indexOfLeftChild(t);this._swap(t,n),t=n}}static indexOfParent(e){return((e+1)/2|0)-1}static indexOfLeftChild(e){return e*2+1}static indexOfRightChild(e){return(e+1)*2}constructor(e){this._heap=[],this._indexByElement=new Map,this._compare=e}};lr.ROOT_INDEX=0;var ea=lr;(e=>{class i{constructor(n,r){this.value=n,this.priority=r}}e.Element=i})(ea||(ea={}));var ml=class ml{texture(e){return this._texture==null&&(this._texture=e.createTexture2(w.TextureFormat.RGBA_LINEAR_CLAMP,ml.WIDTH,ml.HEIGHT,this.pixels,"GradientData")),this._texture}totalVRAM(){return this._texture!=null?w.in_Texture.Texture_totalVRAM(this._texture):0}constructor(e){this.pixels=e,this._texture=null}};ml.WIDTH=1024,ml.HEIGHT=2;var wa=ml,Wc=class i{constructor(){this._table=null;let e=new so;this._table=new Ei(t=>i._hashGradient(e,t),(t,n)=>t.equals2(n),t=>i._evaluateGradient(t))}allocate(e){return this._table.getOrInsertFallback(e)}totalVRAM(){let e=0;return this._table.each((t,n)=>{e=e+n.totalVRAM()}),e}static _hashGradient(e,t){let n=t.colorStops(),r=n.length;e.hash2(us.shouldWrap(t.type())?1:0),e.hash2(r);for(let o=0,a=r;o<a;o=o+1){let s=n[o];e.hash2(s.color),e.hash1(s.position)}return e.value()}static _evaluateGradient(e){let t=new Uint8Array(wa.WIDTH*wa.HEIGHT*4),n=e.flattenedStops(),r=n.length;if(r!=0){let o=1,a=n[0],s=a,l=0;for(let d=0;d<wa.WIDTH;d=d+1){let c=d/(wa.WIDTH-1);for(;a.position<c&&o<r;)s=a,a=n[o],o=o+1;let p=s.position,u=a.position,h=c<p?0:c>u?1:p<u?(c-p)/(u-p):0,f=s.color,y=a.color,g=((f>>>24)+((y>>>24)-(f>>>24))*h)/255;for(let A=0;A<4;A=A+1){let T=f&255,b=y&255,_=T+(b-T)*h,m=.5+257*(A<3?_*g:_)|0;t[l]=m>>8,t[l+wa.WIDTH*4]=m,f>>=8,y>>=8,l=l+1}}}return new wa(t)}};var xt=class xt{static SUPERSAMPLE_COUNT(){return this._CACHED_SUPERSAMPLE_COUNT==null&&(this._CACHED_SUPERSAMPLE_COUNT=Y.useSSAA()?4:2),this._CACHED_SUPERSAMPLE_COUNT}static SSAA_SIZE(){return yn.TILE_SIZE*xt.SUPERSAMPLE_COUNT()}constructor(e,t,n){this._delegate=null,this._context=null,this._bufferPool=null,this._quadArea=null,this._solidColorMaterial=null,this._gradientPaintMaterial=null,this._lerpGradientPaintMaterial=null,this._stencilMaterial=null,this._imageMaterial=null,this._lerpImageMaterial=null,this._imageColorAdjustMaterial=null,this._lerpImageColorAdjustMaterial=null,this._aaaShapeSolidColorMaterial=null,this._aaaShapeGradientPaintMaterial=null,this._aaaShapeLerpGradientPaintMaterial=null,this._aaaShapeImageMaterial=null,this._aaaShapeLerpImageMaterial=null,this._aaaShapeImageColorAdjustMaterial=null,this._aaaShapeLerpImageColorAdjustMaterial=null,this._gradientDataCache=new Map,this._gradientPool=new Wc,this._batchAntialiasing=null,this._currentBatchScissorBuilder=new _t,this._shouldFlushAfterStencilCover=!1,this._materialStrings=Fn.instance(),this.computeStates=new Map([["ODD",new w.StencilState(new w.StencilFaceState(0,w.Comparison.ALWAYS,1,1,w.StencilOperation.KEEP,w.StencilOperation.INVERT,w.StencilOperation.INVERT))],["NONZERO",new w.StencilState(new w.StencilFaceState(0,w.Comparison.ALWAYS,xt.WINDING_MASK,xt.WINDING_MASK,w.StencilOperation.KEEP,w.StencilOperation.INCREMENT_WRAP,w.StencilOperation.INCREMENT_WRAP),new w.StencilFaceState(0,w.Comparison.ALWAYS,xt.WINDING_MASK,xt.WINDING_MASK,w.StencilOperation.KEEP,w.StencilOperation.DECREMENT_WRAP,w.StencilOperation.DECREMENT_WRAP))]]),this.useStates=new Map([["ODD",new w.StencilState(new w.StencilFaceState(0,w.Comparison.NOT_EQUAL,1,0,w.StencilOperation.KEEP,w.StencilOperation.KEEP,w.StencilOperation.KEEP))],["NONZERO",new w.StencilState(new w.StencilFaceState(0,w.Comparison.NOT_EQUAL,xt.WINDING_MASK,0,w.StencilOperation.KEEP,w.StencilOperation.KEEP,w.StencilOperation.KEEP))]]),this.clearStates=new Map([["ODD",new w.StencilState(new w.StencilFaceState(0,w.Comparison.NOT_EQUAL,1,xt.WINDING_MASK,w.StencilOperation.ZERO,w.StencilOperation.ZERO,w.StencilOperation.ZERO))],["NONZERO",new w.StencilState(new w.StencilFaceState(0,w.Comparison.NOT_EQUAL,xt.WINDING_MASK,xt.WINDING_MASK,w.StencilOperation.ZERO,w.StencilOperation.ZERO,w.StencilOperation.ZERO))]]),this.setFillStates=new Map([["ODD",new w.StencilState(new w.StencilFaceState(xt.FILL,w.Comparison.NOT_EQUAL,1,xt.NOT_STROKE,w.StencilOperation.KEEP,w.StencilOperation.REPLACE,w.StencilOperation.REPLACE))],["NONZERO",new w.StencilState(new w.StencilFaceState(xt.FILL,w.Comparison.NOT_EQUAL,xt.WINDING_MASK,xt.NOT_STROKE,w.StencilOperation.KEEP,w.StencilOperation.REPLACE,w.StencilOperation.REPLACE))]]),this.setStrokeStates=new Map([["ODD",new w.StencilState(new w.StencilFaceState(xt.STROKE,w.Comparison.NOT_EQUAL,1,xt.NOT_FILL,w.StencilOperation.KEEP,w.StencilOperation.REPLACE,w.StencilOperation.REPLACE))],["NONZERO",new w.StencilState(new w.StencilFaceState(xt.STROKE,w.Comparison.NOT_EQUAL,xt.WINDING_MASK,xt.NOT_FILL,w.StencilOperation.KEEP,w.StencilOperation.REPLACE,w.StencilOperation.REPLACE))]]),this.compoundUseStates=new Map([[0,new w.StencilState(new w.StencilFaceState(xt.FILL_AND_STROKE,w.Comparison.EQUAL,xt.FILL_AND_STROKE,0,w.StencilOperation.KEEP,w.StencilOperation.KEEP,w.StencilOperation.KEEP))],[1,new w.StencilState(new w.StencilFaceState(xt.STROKE,w.Comparison.EQUAL,xt.FILL_AND_STROKE,0,w.StencilOperation.KEEP,w.StencilOperation.KEEP,w.StencilOperation.KEEP))]]),this.compoundClearStates=new Map([[0,new w.StencilState(new w.StencilFaceState(xt.FILL_AND_STROKE,w.Comparison.EQUAL,xt.FILL_AND_STROKE,-1,w.StencilOperation.ZERO,w.StencilOperation.ZERO,w.StencilOperation.ZERO))],[1,new w.StencilState(new w.StencilFaceState(xt.STROKE,w.Comparison.EQUAL,xt.FILL_AND_STROKE,-1,w.StencilOperation.ZERO,w.StencilOperation.ZERO,w.StencilOperation.ZERO))]]),this._delegate=e,this._context=t,this._bufferPool=n,this._solidColorMaterial=this._context.createMaterial("solidColor",w.VertexFormat.getPositionF2CoordF3(),this._materialStrings.GLSLX_SOURCE_SOLID_COLOR_PAINT_VERTEX,this._materialStrings.GLSLX_SOURCE_SOLID_COLOR_PAINT_FRAGMENT),this._gradientPaintMaterial=this._context.createMaterial("gradientPaint",w.VertexFormat.getPositionF2CoordF3(),this._materialStrings.GLSLX_SOURCE_NON_SOLID_COLOR_PAINT_VERTEX,this._materialStrings.GLSLX_SOURCE_GRADIENT_FRAGMENT),this._lerpGradientPaintMaterial=this._context.createMaterial("lerpGradientPaint",w.VertexFormat.getPositionF2CoordF3(),this._materialStrings.GLSLX_SOURCE_NON_SOLID_COLOR_PAINT_VERTEX,this._materialStrings.GLSLX_SOURCE_LERP_GRADIENT_FRAGMENT),this._stencilMaterial=this._context.createMaterial("stencil",w.VertexFormat.getPositionF2CoordF3(),this._materialStrings.GLSLX_SOURCE_LOOP_BLINN_VERTEX,this._materialStrings.GLSLX_SOURCE_LOOP_BLINN_FRAGMENT),this._imageMaterial=this._context.createMaterial("image",w.VertexFormat.getPositionF2CoordF3(),this._materialStrings.GLSLX_SOURCE_NON_SOLID_COLOR_PAINT_VERTEX,this._materialStrings.GLSLX_SOURCE_IMAGE_FRAGMENT),this._lerpImageMaterial=this._context.createMaterial("lerpImage",w.VertexFormat.getPositionF2CoordF3(),this._materialStrings.GLSLX_SOURCE_TWO_NON_SOLID_COLOR_PAINT_VERTEX,this._materialStrings.GLSLX_SOURCE_LERP_IMAGE_FRAGMENT),this._imageColorAdjustMaterial=this._context.createMaterial("imageColorAdjust",w.VertexFormat.getPositionF2CoordF3(),this._materialStrings.GLSLX_SOURCE_NON_SOLID_COLOR_PAINT_VERTEX,this._materialStrings.GLSLX_SOURCE_IMAGE_COLOR_ADJUST_FRAGMENT),this._lerpImageColorAdjustMaterial=this._context.createMaterial("lerpImageColorAdjust",w.VertexFormat.getPositionF2CoordF3(),this._materialStrings.GLSLX_SOURCE_TWO_NON_SOLID_COLOR_PAINT_VERTEX,this._materialStrings.GLSLX_SOURCE_LERP_IMAGE_COLOR_ADJUST_FRAGMENT),w.supportsWebGLExtensionOESStandardDerivatives()&&(this._aaaShapeSolidColorMaterial=this._context.createMaterial("aaaShapeSolidColor",w.VertexFormat.getPositionF2CoordF3(),this._materialStrings.GLSLX_SOURCE_AAA_SHAPE_SOLID_COLOR_PAINT_VERTEX,this._materialStrings.GLSLX_SOURCE_AAA_SHAPE_SOLID_COLOR_PAINT_FRAGMENT),this._aaaShapeGradientPaintMaterial=this._context.createMaterial("aaaShapeGradientPaint",w.VertexFormat.getPositionF2CoordF3(),this._materialStrings.GLSLX_SOURCE_AAA_SHAPE_NON_SOLID_COLOR_PAINT_VERTEX,this._materialStrings.GLSLX_SOURCE_AAA_SHAPE_GRADIENT_FRAGMENT),this._aaaShapeLerpGradientPaintMaterial=this._context.createMaterial("aaaShapeLerpGradientPaint",w.VertexFormat.getPositionF2CoordF3(),this._materialStrings.GLSLX_SOURCE_AAA_SHAPE_NON_SOLID_COLOR_PAINT_VERTEX,this._materialStrings.GLSLX_SOURCE_AAA_SHAPE_LERP_GRADIENT_FRAGMENT),this._aaaShapeImageMaterial=this._context.createMaterial("aaaShapeImage",w.VertexFormat.getPositionF2CoordF3(),this._materialStrings.GLSLX_SOURCE_AAA_SHAPE_NON_SOLID_COLOR_PAINT_VERTEX,this._materialStrings.GLSLX_SOURCE_AAA_SHAPE_IMAGE_FRAGMENT),this._aaaShapeLerpImageMaterial=this._context.createMaterial("aaaShapeLerpImage",w.VertexFormat.getPositionF2CoordF3(),this._materialStrings.GLSLX_SOURCE_AAA_SHAPE_TWO_NON_SOLID_COLOR_PAINT_VERTEX,this._materialStrings.GLSLX_SOURCE_AAA_SHAPE_LERP_IMAGE_FRAGMENT),this._aaaShapeImageColorAdjustMaterial=this._context.createMaterial("aaaShapeImageColorAdjust",w.VertexFormat.getPositionF2CoordF3(),this._materialStrings.GLSLX_SOURCE_AAA_SHAPE_NON_SOLID_COLOR_PAINT_VERTEX,this._materialStrings.GLSLX_SOURCE_AAA_SHAPE_IMAGE_COLOR_ADJUST_FRAGMENT),this._aaaShapeLerpImageColorAdjustMaterial=this._context.createMaterial("aaaShapeLerpImageColorAdjust",w.VertexFormat.getPositionF2CoordF3(),this._materialStrings.GLSLX_SOURCE_AAA_SHAPE_TWO_NON_SOLID_COLOR_PAINT_VERTEX,this._materialStrings.GLSLX_SOURCE_AAA_SHAPE_LERP_IMAGE_COLOR_ADJUST_FRAGMENT)),this._quadArea=this._bufferPool.allocate(w.VertexFormat.getPositionF2CoordF3(),new Uint8Array(new Float32Array([0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,1,1,0,0,0]).buffer)),this._shouldFlushAfterStencilCover=this._checkShouldFlushAfterStencilCover()}totalVRAM(){return this._gradientPool.totalVRAM()}clearGradientCache(){this._gradientDataCache=new Map,this._gradientPool=new Wc}canSkipStencil(e,t,n){return t.hasNoCurves?!!(t.hasNoOverlaps||e=="NONZERO"&&t.hasNoCurvesAndSameOrientation&&!Ne.containsAtLeastOneNonOpaquePaint(n)):!1}currentBatchAA(){return this._batchAntialiasing}currentBatchScissor(){return this._currentBatchScissorBuilder.build()}includeBoundsInBatchScissor(e){this._currentBatchScissorBuilder.include3(e)}beginBatch(e){this._batchAntialiasing=new _e(e),this._batchAntialiasing.value==2&&this._delegate.pushSSAARenderState(null)}finishBatch(){if(this._delegate.supersampleState().level==1&&this._delegate.supersampleState().mode==0&&this._batchAntialiasing.value==2){let e=this.currentBatchScissor();this._delegate.currentTile().pushScissor2(e)}this._currentBatchScissorBuilder.reset(),this._batchAntialiasing.value==2&&this._delegate.popSSAARenderState(),this._batchAntialiasing=null}renderStencilQuad(e,t,n){let r=this._solidColorMaterial,o=ne.new3(e).translatedBy1(t.topLeft()).scaledBy1(t.size());w.in_Material.Material_setUniformMat32(r,this._materialStrings.GLSLX_NAME_U_VERTEX_TRANSFORM,o),this._context.setStencilState(n),w.in_Context.Context_setKeepBlendState(this._context),this._delegate.drawToCurrentTile(w.Primitive.TRIANGLE_STRIP,r,this._quadArea),this._delegate.markDidDraw()}renderFill(e,t){if(t.geometry.paints.length==0)return;let n=t.geometry.type==ei.PaintedGeometryType.DYNAMIC?t.geometry.path().bounds().size():t.paintSize,r=ne.new2().translatedBy2(-1,-1).scaledBy2(2).multipliedBy1(e).multipliedBy1(t.transform),o=this._delegate.currentTile(),a=o.tileSize(),s=ne.new2().scaledBy2(a).multipliedBy1(e).multipliedBy1(t.transform),l=w.FrozenScissors.isEmpty(o.scissors())?new G(0,0,a,a):w.FrozenScissors.last(o.scissors()),d=G.new3(t.geometry.path().bounds());if(s.transformRect(d),d.intersectWith(l),this.includeBoundsInBatchScissor(d),t.geometry.canBeAnalyticallyAntialiased()){w.in_Context.Context_setPremultipliedBlendState(this._context),this.renderAAAShape(r,t.geometry,n,a);return}let c=t.geometry.path().windingRule(),p=t.geometry.path().triangles(this._bufferPool,w.VertexFormat.getPositionF2CoordF3()),u=!0;for(let h=0,f=p.length;h<f;h=h+1)if(!this.canSkipStencil(c,p[h],t.geometry.paints)){u=!1;break}u?(w.in_Context.Context_setPremultipliedBlendState(this._context),this.renderGeometryDirectly(r,t.geometry,n,a)):(this.renderStencilGeometry(r,t.geometry,this.computeStates.get(c)),w.in_Context.Context_setPremultipliedBlendState(this._context),this.renderCoverQuad(r,t.geometry,n,this.useStates.get(c),this.clearStates.get(c),a),this._context.setStencilState(w.StencilState.NONE))}renderFillStroke(e,t){let n=this._delegate.currentTile(),r=n.tileSize(),o=ne.new2().scaledBy2(r).multipliedBy1(e).multipliedBy1(t.transform),a=w.FrozenScissors.isEmpty(n.scissors())?new G(0,0,r,r):w.FrozenScissors.last(n.scissors()),s=ne.new2().translatedBy2(-1,-1).scaledBy2(2).multipliedBy1(e).multipliedBy1(t.transform);for(let l=0,d=t.fillGeometries.length;l<d;l=l+1){let c=t.fillGeometries[l],p=G.new3(c.path().bounds());o.transformRect(p),this.includeBoundsInBatchScissor(p.intersectedWith(a));let u=c.path().windingRule();this.renderStencilGeometry(s,c,this.computeStates.get(u)),w.in_Context.Context_setPremultipliedBlendState(this._context),this.renderCoverQuad(s,c,t.paintSize,this.useStates.get(u),this.setFillStates.get(u),r)}for(let l=0,d=t.strokeGeometries.length;l<d;l=l+1){let c=t.strokeGeometries[l],p=G.new3(c.path().bounds());o.transformRect(p),this.includeBoundsInBatchScissor(p.intersectedWith(a));let u=c.path().windingRule();this.renderStencilGeometry(s,c,this.computeStates.get(u)),this.renderStencilQuad(s,c.path().bounds(),this.setStrokeStates.get(u)),w.in_Context.Context_setPremultipliedBlendState(this._context),this.renderCoverQuad(s,c,t.paintSize,this.compoundUseStates.get(t.mode),this.compoundClearStates.get(t.mode),r)}if(t.strokeGeometries.length!=0){let l=ue.List_last(t.strokeGeometries).path().bounds(),d=ue.List_last(t.fillGeometries).path().bounds();l.contains1(d)||this.renderStencilQuad(s,d,this.compoundClearStates.get(t.mode))}this._context.setStencilState(w.StencilState.NONE)}uvTransformFromBounds(e,t){let n=ne.new2();return n.scale4(1/t.x(),1/t.y()),n.translate1(e.topLeft()),n.scale3(e.size()),n}canSkipPaint(e,t,n,r){let o=n.asSinglePaint();if(o==null)return!1;if((o.type()=="GRADIENT_RADIAL"||o.type()=="GRADIENT_DIAMOND")&&o.lastStopIsTransparent()){let a=ne.new3(o.transform());if(a.multiply(t),a.invert()){let s=ue.List_last(o.colorStops()).position*.5,l=new I(.5,.5),d=G.new4(l.subtract(s),l.add(s));return ne.new3(e).translatedBy1(r.topLeft()).scaledBy1(r.size()).multipliedBy1(a).transformRect(d),!G.CLIP.overlaps(d)}}return!1}_findOrCreateGradientData(e){let t=Ht.IntMap_get(this._gradientDataCache,e.id(),null);return t==null&&(t=this._gradientPool.allocate(e),this._gradientDataCache.set(e.id(),t)),t}_setAaaShapeUniforms(e,t,n){if(e.setUniformVec21(this._materialStrings.GLSLX_NAME_U_UV_SCALE,n.x(),n.y()),w.in_Material.Material_setUniformVec22(e,this._materialStrings.GLSLX_NAME_U_PATH_SIZE,t.bounds().size()),t instanceof $i){let r=t;e.setUniformInt(this._materialStrings.GLSLX_NAME_U_SHAPE_TYPE,cp.ELLIPSE),w.in_Material.Material_setUniformVec22(e,this._materialStrings.GLSLX_NAME_U_ELLIPSE_CENTER,r.center.subtract1(r.bounds().topLeft())),e.setUniformVec21(this._materialStrings.GLSLX_NAME_U_ELLIPSE_RADII,r.xRadius,r.yRadius)}else if(t instanceof Nt){let r=t;e.setUniformInt(this._materialStrings.GLSLX_NAME_U_SHAPE_TYPE,cp.ROUNDED_RECT),w.in_Material.Material_setUniformVec43(e,this._materialStrings.GLSLX_NAME_U_RECT,t.bounds().translatedBy(t.bounds().topLeft())),e.setUniformVec41(this._materialStrings.GLSLX_NAME_U_CORNER_RADII,Math.max(r.radii().topLeft,0),Math.max(r.radii().topRight,0),Math.max(r.radii().bottomRight,0),Math.max(r.radii().bottomLeft,0))}else throw new Error("Unxpected path type")}renderAAAShape(e,t,n,r){let o=t.paints,a=t.path().bounds(),s=e.clone(),l=s.invert(),d=2/r,c=s.scale1().x()*d,p=a.clone().expandedBy1(c),u=ne.new3(e).translatedBy1(p.topLeft()).scaledBy1(p.size()),h=this.uvTransformFromBounds(a,n),f=new I(p.width()/a.width(),p.height()/a.height()),y=t.path().path();for(let g=0,A=o.length;g<A;g=g+1){let T=o[g];if(!this.canSkipPaint(e,h,T,a))if(T.type()=="SOLID"){let b=this._aaaShapeSolidColorMaterial;this._setAaaShapeUniforms(b,y,f),w.in_Material.Material_setUniformMat32(b,this._materialStrings.GLSLX_NAME_U_VERTEX_TRANSFORM,u),w.in_Material.Material_setUniformVec42(b,this._materialStrings.GLSLX_NAME_U_COLOR,E.premultiplied(T.color())),b.setUniformFloat(this._materialStrings.GLSLX_NAME_U_OPACITY,T.opacity()),this._delegate.drawToCurrentTile(w.Primitive.TRIANGLE_STRIP,b,this._quadArea),this._delegate.markDidDraw()}else if(us.isGradient(T.type())){let b=ne.new3(T.transform()).multipliedBy1(h),_=null,m=T.asVolatilePaint();if(m!=null){_=this._aaaShapeLerpGradientPaintMaterial;let S=this._findOrCreateGradientData(m.from()).texture(this._context),v=this._findOrCreateGradientData(m.to()).texture(this._context);S.setFormat(w.TextureFormat.RGBA_LINEAR_CLAMP),v.setFormat(w.TextureFormat.RGBA_LINEAR_CLAMP),_.setUniformSampler(this._materialStrings.GLSLX_NAME_U_TEXTURE0,S,0),_.setUniformSampler(this._materialStrings.GLSLX_NAME_U_TEXTURE1,v,1),_.setUniformFloat(this._materialStrings.GLSLX_NAME_U_PROGRESS,m.t())}else{let S=T.asSinglePaint();_=this._aaaShapeGradientPaintMaterial;let v=this._findOrCreateGradientData(S).texture(this._context);v.setFormat(w.TextureFormat.RGBA_LINEAR_CLAMP),_.setUniformSampler(this._materialStrings.GLSLX_NAME_U_TEXTURE0,v,0)}this._setAaaShapeUniforms(_,y,f),w.in_Material.Material_setUniformMat32(_,this._materialStrings.GLSLX_NAME_U_VERTEX_TRANSFORM,u),w.in_Material.Material_setUniformMat32(_,this._materialStrings.GLSLX_NAME_U_PAINT_TRANSFORM0,b),_.setUniformInt(this._materialStrings.GLSLX_NAME_U_TYPE,lp.get(T.type())),_.setUniformFloat(this._materialStrings.GLSLX_NAME_U_OPACITY,T.opacity()),this._delegate.drawToCurrentTile(w.Primitive.TRIANGLE_STRIP,_,this._quadArea),this._delegate.markDidDraw()}else if(T.type()=="IMAGE"||T.type()=="VIDEO"){let b=ne.new3(h).scaledBy3(1/a.size().x(),1/a.size().y()),_=!0,m=T.asVolatilePaint();if(m!=null){let S=this.getImageToDraw(m.from(),n,e,b,m.from().imageScaleMode(),r);if(S!=null){let v=ne.new2(),C=null;if(m.from().image()==m.to().image()&&!(m.from().imageScaleMode()=="TILE"||m.to().imageScaleMode()=="TILE"))C=this._aaaShapeImageMaterial,m.colorAdjustIsActive()&&(C=this._aaaShapeImageColorAdjustMaterial,m.colorAdjustSetData(C)),v=this.allocateObjectSpaceToNormalizedImageSpaceTransform(m,n,h);else{C=this._aaaShapeLerpImageMaterial,m.colorAdjustIsActive()&&(C=this._aaaShapeLerpImageColorAdjustMaterial,m.colorAdjustSetData(C)),v=this.allocateObjectSpaceToNormalizedImageSpaceTransform(m.from(),n,h);let x=this.getImageToDraw(m.to(),n,e,b,m.to().imageScaleMode(),r);if(x==null)_=!1;else{let z=this.getOrCreateVideoTexture(m.to());z==null&&(z=this._delegate.getOrCreateImageTexture(x));let $=this.allocateObjectSpaceToNormalizedImageSpaceTransform(m.to(),n,h);w.in_Material.Material_setUniformMat32(C,this._materialStrings.GLSLX_NAME_U_PAINT_TRANSFORM1,$),z!=null&&z.setFormat(w.TextureFormat.RGBA_NEAREST_CLAMP),C.setUniformSampler(this._materialStrings.GLSLX_NAME_U_TEXTURE1,z,1),C.setUniformFloat(this._materialStrings.GLSLX_NAME_U_PROGRESS,Xt.double_clamp(m.t(),0,1))}}C.setUniformFloat(this._materialStrings.GLSLX_NAME_U_PIXEL_RATIO,window.devicePixelRatio*this._delegate.canvasSpaceToViewSpaceScale());let N=this.getOrCreateVideoTexture(m.from());N==null&&(N=this._delegate.getOrCreateImageTexture(S)),_&&N!=null&&(N!=null&&N.setFormat(w.TextureFormat.RGBA_NEAREST_CLAMP),this._setupRepeatingForImage(T,C),w.in_Material.Material_setUniformMat32(C,this._materialStrings.GLSLX_NAME_U_VERTEX_TRANSFORM,u),w.in_Material.Material_setUniformMat32(C,this._materialStrings.GLSLX_NAME_U_PAINT_TRANSFORM0,v),C.setUniformFloat(this._materialStrings.GLSLX_NAME_U_OPACITY,m.opacity()),C.setUniformSampler(this._materialStrings.GLSLX_NAME_U_TEXTURE0,N,0),this._setAaaShapeUniforms(C,y,f),this._delegate.drawToCurrentTile(w.Primitive.TRIANGLE_STRIP,C,this._quadArea),this._delegate.markDidDraw())}}else{let S=T.asSinglePaint(),v=null;if(v=this.getOrCreateVideoTexture(S),v==null){let C=this.getImageToDraw(S,n,e,b,S.imageScaleMode(),r);C!=null&&(v=this._delegate.getOrCreateImageTexture(C))}if(v!=null){let C=this._aaaShapeImageMaterial;S.colorAdjustIsActive()&&(C=this._aaaShapeImageColorAdjustMaterial,S.colorAdjustSetData(C));let N=this.allocateObjectSpaceToNormalizedImageSpaceTransform(S,n,h);v.setFormat(w.TextureFormat.RGBA_NEAREST_CLAMP),this._setupRepeatingForImage(T,C),w.in_Material.Material_setUniformMat32(C,this._materialStrings.GLSLX_NAME_U_VERTEX_TRANSFORM,u),w.in_Material.Material_setUniformMat32(C,this._materialStrings.GLSLX_NAME_U_PAINT_TRANSFORM0,N),C.setUniformFloat(this._materialStrings.GLSLX_NAME_U_OPACITY,S.opacity()),C.setUniformSampler(this._materialStrings.GLSLX_NAME_U_TEXTURE0,v,0),C.setUniformFloat(this._materialStrings.GLSLX_NAME_U_PIXEL_RATIO,window.devicePixelRatio*this._delegate.canvasSpaceToViewSpaceScale()),this._setAaaShapeUniforms(C,y,f),this._delegate.drawToCurrentTile(w.Primitive.TRIANGLE_STRIP,C,this._quadArea),this._delegate.markDidDraw()}}}else T.type()=="EMOJI"&&Ve("Emoji should always be rendered by renderGeometryDirectly")}}renderGeometryDirectly(e,t,n,r){let o=t.path().triangles(this._bufferPool,w.VertexFormat.getPositionF2CoordF3()),a=t.paints,s=t.path().bounds(),l=this.uvTransformFromBounds(s,n),d=null;for(let c=0,p=a.length;c<p;c=c+1){let u=a[c];if(!this.canSkipPaint(e,l,u,s))switch(u.type()){case"SOLID":{d=this._solidColorMaterial,w.in_Material.Material_setUniformMat32(d,this._materialStrings.GLSLX_NAME_U_VERTEX_TRANSFORM,e),w.in_Material.Material_setUniformVec42(d,this._materialStrings.GLSLX_NAME_U_COLOR,E.premultiplied(u.color())),d.setUniformFloat(this._materialStrings.GLSLX_NAME_U_OPACITY,u.opacity());for(let h=0,f=o.length;h<f;h=h+1)o[h].bufferArea!=null&&(this._delegate.drawToCurrentTile(w.Primitive.TRIANGLES,d,o[h].bufferArea),this._delegate.markDidDraw());break}case"GRADIENT_LINEAR":case"GRADIENT_RADIAL":case"GRADIENT_ANGULAR":case"GRADIENT_DIAMOND":{let h=ne.new3(u.transform()).scaledBy3(1/n.x(),1/n.y()),f=u.asVolatilePaint();if(f!=null){d=this._lerpGradientPaintMaterial;let y=this._findOrCreateGradientData(f.from()).texture(this._context),g=this._findOrCreateGradientData(f.to()).texture(this._context);y.setFormat(w.TextureFormat.RGBA_LINEAR_CLAMP),g.setFormat(w.TextureFormat.RGBA_LINEAR_CLAMP),d.setUniformSampler(this._materialStrings.GLSLX_NAME_U_TEXTURE0,y,0),d.setUniformSampler(this._materialStrings.GLSLX_NAME_U_TEXTURE1,g,1),d.setUniformFloat(this._materialStrings.GLSLX_NAME_U_PROGRESS,f.t())}else{let y=u.asSinglePaint();d=this._gradientPaintMaterial;let g=this._findOrCreateGradientData(y).texture(this._context);g.setFormat(w.TextureFormat.RGBA_LINEAR_CLAMP),d.setUniformSampler(this._materialStrings.GLSLX_NAME_U_TEXTURE0,g,0)}w.in_Material.Material_setUniformMat32(d,this._materialStrings.GLSLX_NAME_U_VERTEX_TRANSFORM,e),w.in_Material.Material_setUniformMat32(d,this._materialStrings.GLSLX_NAME_U_PAINT_TRANSFORM0,h),d.setUniformInt(this._materialStrings.GLSLX_NAME_U_TYPE,lp.get(u.type())),d.setUniformFloat(this._materialStrings.GLSLX_NAME_U_OPACITY,u.opacity());for(let y=0,g=o.length;y<g;y=y+1)o[y].bufferArea!=null&&(this._delegate.drawToCurrentTile(w.Primitive.TRIANGLES,d,o[y].bufferArea),this._delegate.markDidDraw());break}case"IMAGE":case"VIDEO":{let h=ne.new2().scaledBy3(1/n.x(),1/n.y()),f=u.asVolatilePaint();if(f!=null){let y=this.getImageToDraw(f.from(),n,e,h,f.from().imageScaleMode(),r);if(y!=null){let g=ne.new2(),A=!0;if(f.from().image()==f.to().image()&&!(f.from().imageScaleMode()=="TILE"||f.to().imageScaleMode()=="TILE"))d=this._imageMaterial,f.colorAdjustIsActive()&&(d=this._imageColorAdjustMaterial,f.colorAdjustSetData(d)),g=this.allocateObjectSpaceToNormalizedImageSpaceTransform(f,n,h);else{let b=this.getImageToDraw(f.to(),n,e,h,f.to().imageScaleMode(),r);if(b==null)A=!1;else{d=this._lerpImageMaterial,f.colorAdjustIsActive()&&(d=this._lerpImageColorAdjustMaterial,f.colorAdjustSetData(d)),g=this.allocateObjectSpaceToNormalizedImageSpaceTransform(f.from(),n,h);let _=this._delegate.getOrCreateImageTexture(b),m=this.allocateObjectSpaceToNormalizedImageSpaceTransform(f.to(),n,h);w.in_Material.Material_setUniformMat32(d,this._materialStrings.GLSLX_NAME_U_PAINT_TRANSFORM1,m),this._setupClampingForImageOrGIF(b.image,_),d.setUniformSampler(this._materialStrings.GLSLX_NAME_U_TEXTURE1,_,1),d.setUniformFloat(this._materialStrings.GLSLX_NAME_U_PROGRESS,Xt.double_clamp(f.t(),0,1))}}let T=this._delegate.getOrCreateImageTexture(y);if(A&&T!=null){w.in_Material.Material_setUniformMat32(d,this._materialStrings.GLSLX_NAME_U_VERTEX_TRANSFORM,e),w.in_Material.Material_setUniformMat32(d,this._materialStrings.GLSLX_NAME_U_PAINT_TRANSFORM0,g),d.setUniformFloat(this._materialStrings.GLSLX_NAME_U_OPACITY,f.opacity()),this._setupRepeatingForImage(u,d),this._setupClampingForImageOrGIF(y.image,T),d.setUniformSampler(this._materialStrings.GLSLX_NAME_U_TEXTURE0,T,0);for(let b=0,_=o.length;b<_;b=b+1)o[b].bufferArea!=null&&(this._delegate.drawToCurrentTile(w.Primitive.TRIANGLES,d,o[b].bufferArea),this._delegate.markDidDraw())}}}else{let y=u.asSinglePaint(),g=null;if(g=this.getOrCreateVideoTexture(y),g==null){let A=this.getImageToDraw(y,n,e,h,y.imageScaleMode(),r);A!=null&&(g=this._delegate.getOrCreateImageTexture(A),g!=null&&this._setupClampingForImageOrGIF(A.image,g))}if(g!=null){let A=this.allocateObjectSpaceToNormalizedImageSpaceTransform(y,n,h);d=this._imageMaterial,y.colorAdjustIsActive()&&(d=this._imageColorAdjustMaterial,y.colorAdjustSetData(d)),w.in_Material.Material_setUniformMat32(d,this._materialStrings.GLSLX_NAME_U_VERTEX_TRANSFORM,e),w.in_Material.Material_setUniformMat32(d,this._materialStrings.GLSLX_NAME_U_PAINT_TRANSFORM0,A),d.setUniformFloat(this._materialStrings.GLSLX_NAME_U_OPACITY,y.opacity()),this._setupRepeatingForImage(u,d),d.setUniformSampler(this._materialStrings.GLSLX_NAME_U_TEXTURE0,g,0);for(let T=0,b=o.length;T<b;T=T+1)o[T].bufferArea!=null&&(this._delegate.drawToCurrentTile(w.Primitive.TRIANGLES,d,o[T].bufferArea),this._delegate.markDidDraw())}}break}case"EMOJI":{let h=u.asSinglePaint();if(h==null)continue;let f=this._delegate.getOrCreateImageTexture(new Ci(h.image(),2));if(h.decodedImageIsReady()||(f=null),f!=null){let y=f;d=this._imageMaterial;let g=ne.new2().scaledBy3(1/s.width(),1/s.height()).translatedBy2(-s.left(),-s.top());w.in_Material.Material_setUniformMat32(d,this._materialStrings.GLSLX_NAME_U_VERTEX_TRANSFORM,e),w.in_Material.Material_setUniformMat32(d,this._materialStrings.GLSLX_NAME_U_PAINT_TRANSFORM0,g),d.setUniformFloat(this._materialStrings.GLSLX_NAME_U_OPACITY,h.opacity()),d.setUniformSampler(this._materialStrings.GLSLX_NAME_U_TEXTURE0,y,0),y!=null&&y.setFormat(w.TextureFormat.RGBA_NEAREST_CLAMP);for(let A=0,T=o.length;A<T;A=A+1)o[A].bufferArea!=null&&(this._delegate.drawToCurrentTile(w.Primitive.TRIANGLES,d,o[A].bufferArea),this._delegate.markDidDraw())}break}}}}_setupRepeatingForImage(e,t){let n=!1,r=e.asVolatilePaint();r!=null?r.eitherPaint(o=>o.imageScaleMode()=="TILE")&&(n=!0):e.asSinglePaint()!=null&&(n=e.asSinglePaint().imageScaleMode()=="TILE"),t.setUniformInt(this._materialStrings.GLSLX_NAME_U_EMULATE_WRAP_ADDRESS,n?1:0),t.setUniformInt(this._materialStrings.GLSLX_NAME_U_EMULATE_BORDER_ADDRESS,n?0:1)}_setupClampingForImageOrGIF(e,t){e.isGIF()?t.setFormat(w.TextureFormat.RGBA_LINEAR_CLAMP):t.setFormat(w.TextureFormat.RGBA_NEAREST_CLAMP)}renderStencilGeometry(e,t,n){let r=t.path().triangles(this._bufferPool,w.VertexFormat.getPositionF2CoordF3()),o=this._stencilMaterial;w.in_Material.Material_setUniformMat32(o,this._materialStrings.GLSLX_NAME_U_VERTEX_TRANSFORM,e),this._context.setStencilState(n),w.in_Context.Context_setKeepBlendState(this._context);for(let a=0,s=r.length;a<s;a=a+1)r[a].bufferArea!=null&&(this._delegate.drawToCurrentTile(w.Primitive.TRIANGLES,o,r[a].bufferArea),this._delegate.markDidDraw())}_checkShouldFlushAfterStencilCover(){return!!Y.shouldFlushAfterStencilCover()}renderCoverQuad(e,t,n,r,o,a){let s=t.paints;if(s.length==0){this.renderStencilQuad(e,t.path().bounds(),o),this._shouldFlushAfterStencilCover&&this._context.flush();return}let l=t.path().bounds(),d=ne.new3(e).translatedBy1(l.topLeft()).scaledBy1(l.size()),c=this.uvTransformFromBounds(l,n),p=null;for(let u=0,h=s.length;u<h;u=u+1){let f=s[u],y=u+1==h;if(!(!y&&this.canSkipPaint(e,c,f,l)))switch(this._context.setStencilState(y?o:r),f.type()){case"SOLID":{p=this._solidColorMaterial,w.in_Material.Material_setUniformMat32(p,this._materialStrings.GLSLX_NAME_U_VERTEX_TRANSFORM,d),w.in_Material.Material_setUniformVec42(p,this._materialStrings.GLSLX_NAME_U_COLOR,E.premultiplied(f.color())),p.setUniformFloat(this._materialStrings.GLSLX_NAME_U_OPACITY,f.opacity()),this._delegate.drawToCurrentTile(w.Primitive.TRIANGLE_STRIP,p,this._quadArea),this._delegate.markDidDraw();break}case"GRADIENT_LINEAR":case"GRADIENT_RADIAL":case"GRADIENT_ANGULAR":case"GRADIENT_DIAMOND":{let g=ne.new3(f.transform()).multipliedBy1(c),A=f.asVolatilePaint();if(A!=null){p=this._lerpGradientPaintMaterial;let T=this._findOrCreateGradientData(A.from()).texture(this._context),b=this._findOrCreateGradientData(A.to()).texture(this._context);T.setFormat(w.TextureFormat.RGBA_LINEAR_CLAMP),b.setFormat(w.TextureFormat.RGBA_LINEAR_CLAMP),p.setUniformSampler(this._materialStrings.GLSLX_NAME_U_TEXTURE0,T,0),p.setUniformSampler(this._materialStrings.GLSLX_NAME_U_TEXTURE1,b,1),p.setUniformFloat(this._materialStrings.GLSLX_NAME_U_PROGRESS,A.t())}else{let T=f.asSinglePaint();p=this._gradientPaintMaterial;let b=this._findOrCreateGradientData(T).texture(this._context);b.setFormat(w.TextureFormat.RGBA_LINEAR_CLAMP),p.setUniformSampler(this._materialStrings.GLSLX_NAME_U_TEXTURE0,b,0)}w.in_Material.Material_setUniformMat32(p,this._materialStrings.GLSLX_NAME_U_VERTEX_TRANSFORM,d),w.in_Material.Material_setUniformMat32(p,this._materialStrings.GLSLX_NAME_U_PAINT_TRANSFORM0,g),p.setUniformInt(this._materialStrings.GLSLX_NAME_U_TYPE,lp.get(f.type())),p.setUniformFloat(this._materialStrings.GLSLX_NAME_U_OPACITY,f.opacity()),this._delegate.drawToCurrentTile(w.Primitive.TRIANGLE_STRIP,p,this._quadArea),this._delegate.markDidDraw();break}case"IMAGE":case"VIDEO":{let g=ne.new3(c).scaledBy3(1/l.size().x(),1/l.size().y()),A=!0,T=!1,b=f.asVolatilePaint();if(b!=null){let _=this.getImageToDraw(b.from(),n,e,g,b.from().imageScaleMode(),a);if(_!=null){let m=ne.new2();if(b.from().image()==b.to().image()&&!(b.from().imageScaleMode()=="TILE"||b.to().imageScaleMode()=="TILE"))p=this._imageMaterial,b.colorAdjustIsActive()&&(p=this._imageColorAdjustMaterial,b.colorAdjustSetData(p)),m=this.allocateObjectSpaceToNormalizedImageSpaceTransform(b,n,c);else{p=this._lerpImageMaterial,b.colorAdjustIsActive()&&(p=this._lerpImageColorAdjustMaterial,b.colorAdjustSetData(p)),m=this.allocateObjectSpaceToNormalizedImageSpaceTransform(b.from(),n,c);let v=this.getImageToDraw(b.to(),n,e,g,b.to().imageScaleMode(),a);if(v==null)A=!1;else{let C=this._delegate.getOrCreateImageTexture(v),N=this.allocateObjectSpaceToNormalizedImageSpaceTransform(b.to(),n,c);w.in_Material.Material_setUniformMat32(p,this._materialStrings.GLSLX_NAME_U_PAINT_TRANSFORM1,N),C!=null&&C.setFormat(w.TextureFormat.RGBA_NEAREST_CLAMP),p.setUniformSampler(this._materialStrings.GLSLX_NAME_U_TEXTURE1,C,1),p.setUniformFloat(this._materialStrings.GLSLX_NAME_U_PROGRESS,Xt.double_clamp(b.t(),0,1))}}let S=this._delegate.getOrCreateImageTexture(_);A&&S!=null&&(S!=null&&S.setFormat(w.TextureFormat.RGBA_NEAREST_CLAMP),this._setupRepeatingForImage(f,p),w.in_Material.Material_setUniformMat32(p,this._materialStrings.GLSLX_NAME_U_VERTEX_TRANSFORM,d),w.in_Material.Material_setUniformMat32(p,this._materialStrings.GLSLX_NAME_U_PAINT_TRANSFORM0,m),p.setUniformFloat(this._materialStrings.GLSLX_NAME_U_OPACITY,b.opacity()),p.setUniformSampler(this._materialStrings.GLSLX_NAME_U_TEXTURE0,S,0),this._delegate.drawToCurrentTile(w.Primitive.TRIANGLE_STRIP,p,this._quadArea),this._delegate.markDidDraw(),T=!0)}}else{let _=f.asSinglePaint(),m=null;if(m=this.getOrCreateVideoTexture(_),m==null){let S=this.getImageToDraw(_,n,e,g,_.imageScaleMode(),a);S!=null&&(m=this._delegate.getOrCreateImageTexture(S))}if(m!=null){p=this._imageMaterial,_.colorAdjustIsActive()&&(p=this._imageColorAdjustMaterial,_.colorAdjustSetData(p));let S=this.allocateObjectSpaceToNormalizedImageSpaceTransform(_,n,c);m.setFormat(w.TextureFormat.RGBA_NEAREST_CLAMP),this._setupRepeatingForImage(f,p),w.in_Material.Material_setUniformMat32(p,this._materialStrings.GLSLX_NAME_U_VERTEX_TRANSFORM,d),w.in_Material.Material_setUniformMat32(p,this._materialStrings.GLSLX_NAME_U_PAINT_TRANSFORM0,S),p.setUniformFloat(this._materialStrings.GLSLX_NAME_U_OPACITY,_.opacity()),p.setUniformSampler(this._materialStrings.GLSLX_NAME_U_TEXTURE0,m,0),this._delegate.drawToCurrentTile(w.Primitive.TRIANGLE_STRIP,p,this._quadArea),this._delegate.markDidDraw(),T=!0}}y&&!T&&(w.in_Material.Material_setUniformMat32(this._solidColorMaterial,this._materialStrings.GLSLX_NAME_U_VERTEX_TRANSFORM,d),w.in_Material.Material_setUniformVec42(this._solidColorMaterial,this._materialStrings.GLSLX_NAME_U_COLOR,E.TRANSPARENT),this._solidColorMaterial.setUniformFloat(this._materialStrings.GLSLX_NAME_U_OPACITY,0),this._delegate.drawToCurrentTile(w.Primitive.TRIANGLE_STRIP,this._solidColorMaterial,this._quadArea),this._delegate.markDidDraw());break}case"EMOJI":{Ve("Emoji should always be rendered by renderGeometryDirectly");break}}}this._shouldFlushAfterStencilCover&&this._context.flush()}allocateObjectSpaceToNormalizedImageSpaceTransform(e,t,n){let r=e.allocateImageTransformForGeometrySize(t);return ne.new2().multipliedBy1(r).multipliedBy1(n)}getImageToDraw(e,t,n,r,o,a){if(e.image()==null&&e.imageThumbnail()==null)return null;e.imageThumbnail()!=null&&this._delegate.getOrCreateImageTexture(new Ci(e.imageThumbnail(),1)),e.image()!=null&&e.image().isGIF()&&this._delegate.getOrCreateImageTexture(new Ci(e.image(),0));let s=e.decodedImageThumbnailIsReady()?e.decodedImageThumbnail():null,l=!1;if(e.imageThumbnail()==null)l=!0;else if(s!=null){let d=this.allocateObjectSpaceToNormalizedImageSpaceTransform(e,t,r),c=ne.new3(d);c.invert();let p=ne.new2().scaledBy2(a).multipliedBy1(n).multipliedBy1(c).scaledBy3(1/s.width(),1/s.height()),u=p.axisX().length(),h=p.axisY().length();l=Math.max(h,u)>1||e.image()!=null&&e.image().isGIF(),o=="TILE"&&(l=!0)}if(l&&(this._delegate.getOrCreateImageTexture(new Ci(e.image(),0)),e.decodedImageIsReady())){let d=e.decodedImage();if(d!=null)return new Ci(d,0)}if(s!=null)return new Ci(s,1);if(e.decodedImageIsReady()){let d=e.decodedImage();if(d!=null)return new Ci(d,0)}return null}getOrCreateVideoTexture(e){var t;return(t=e==null?void 0:e.video())==null?void 0:t.getOrCreateTexture(e,this._context,w.TextureFormat.RGBA_NEAREST_CLAMP)}};xt.FILL=128,xt.STROKE=64,xt.NOT_FILL=255^xt.FILL,xt.NOT_STROKE=255^xt.STROKE,xt.FILL_AND_STROKE=xt.FILL|xt.STROKE,xt.WINDING_MASK=255^xt.FILL_AND_STROKE,xt._CACHED_SUPERSAMPLE_COUNT=null;var cr=xt,dp=(n=>(n[n.NONE=0]="NONE",n[n.ANALYTICAL=1]="ANALYTICAL",n[n.SSAA=2]="SSAA",n))(dp||{}),cp;(t=>(t.ELLIPSE=0,t.ROUNDED_RECT=1))(cp||(cp={}));var pb;(e=>{function i(t){return dp[t]}e.PathAntialiasing_toString=i})(pb||(pb={}));var up=class{activate(e){this.reset(),this._isEnabled=!0,this._invalidateFn=e}deactivate(){this.isEnabled()&&(this._invalidateFn(),this.reset())}isEnabled(){return this._isEnabled}reset(){this._isPlaying=!1,this._isEnabled=!1,this._maxLayersToRender=1,this._totalLayersInRenderTree=0,this._framesUntilUpdate=this._frameDelay,this._filteredTree=null,this._invalidateFn=null,this._frameDelay=this._defaultFrameDelay}play(){this.isEnabled()&&(this._isPlaying=!0,this._invalidateFn())}pause(){this.isEnabled()&&(this._isPlaying=!1)}forward(){this.isEnabled()&&(this._maxLayersToRender=Math.min(this._maxLayersToRender+1,this._totalLayersInRenderTree),this._invalidateFn())}backward(){this.isEnabled()&&(this._maxLayersToRender=Math.max(this._maxLayersToRender-1,1),this._invalidateFn())}rewind(){this.isEnabled()&&(this._maxLayersToRender=1,this._invalidateFn())}increaseSpeed(){this.isEnabled()&&(this._frameDelay=Math.max(this._minFrameDelay,this._frameDelay-5))}decreaseSpeed(){this.isEnabled()&&(this._frameDelay=Math.min(this._maxFrameDelay,this._frameDelay+5))}finishLayerByLayerDrawToScreen(){this.isEnabled()&&this._isPlaying&&(this._maxLayersToRender>=this._totalLayersInRenderTree||(this._invalidateFn(),this._framesUntilUpdate=this._framesUntilUpdate-1,this._framesUntilUpdate<=0&&(this._maxLayersToRender=this._maxLayersToRender+1,this._framesUntilUpdate=this._frameDelay)))}_filterCompositeTileGridNodes(e){switch(e.op()){case 0:{let t=e;return new xa(this._filterCompositeTileGridNodes(t.child),t.flags)}case 2:{let t=e;return new Yo(this._filterCompositeTileGridNodes(t.child))}case 1:{let t=e,n=[];for(let r=0,o=t.children.length;r<o;r=r+1){let a=this._filterCompositeTileGridNodes(t.children[r]);n.push(a)}return new ze(n,t.isFirstChildSolidBackground())}case 3:case 4:return e;case 5:{let t=e,n=this._filterCompositeTileGridNodes(t.alpha),r=this._filterCompositeTileGridNodes(t.color);return new Or(n,r,t.type,t.innerShadowFill,t.innerShadowAlphaRequiresHardMask)}case 6:{let t=e;return new Jr(t.radius,this._filterCompositeTileGridNodes(t.child),t.clamp)}case 7:{let t=e;return new jr(t.blendMode,t.opacity,this._filterCompositeTileGridNodes(t.child))}case 9:{let t=e;return new go(this._filterCompositeTileGridNodes(t.alpha),t.color)}case 8:{let t=e;return this._filterCompositeTileGridNodes(t.tree)}case 10:{let t=e;return new at(this._filterCompositeTileGridNodes(t.child),t.id,t.property,t.getter)}case 11:{let t=e;return new wr(this._filterCompositeTileGridNodes(t.child),t.transform)}case 12:{let t=e,n=this._filterCompositeTileGridNodes(t.startChild),r=this._filterCompositeTileGridNodes(t.endChild);return new dr(n,r,t.id,t.progressFn)}default:throw new Error(`Unhandled node op ${Sr[e.op()]}`)}return null}_renderTreeWithNLayers(e,t){let n=(a,s)=>new ar(a,s);if(t<=0)return n(null,0);let r=[];switch(e.op()){case 0:{let a=e;r.push(a.child);break}case 2:{let a=e;r.push(a.child);break}case 1:{let a=e;for(let s=0,l=a.children.length;s<l;s=s+1){let d=a.children[s];r.push(d)}break}case 3:case 4:return n(e,t-1);case 5:{let a=e;r.push(a.color),r.push(a.alpha);break}case 6:{let a=e;r.push(a.child);break}case 7:{let a=e;r.push(a.child);break}case 9:{let a=e;r.push(a.alpha);break}case 8:{let a=e;r.push(a.tree);break}case 10:{let a=e;r.push(a.child);break}case 11:{let a=e;r.push(a.child);break}case 12:{let a=e;r.push(a.startChild),r.push(a.endChild);break}default:throw new Error(`Unhandled node op ${Sr[e.op()]}`)}let o=[];for(let a=0,s=r.length;a<s;a=a+1){let l=r[a],d=this._renderTreeWithNLayers(l,t);if(t=d.b,o.push(d.a),t<=0)return n(new ze(o).optimized(),0)}return this._isRenderableLayer(e)?t>0?n(e,t-1):n(new ze(o).optimized(),0):n(e,t)}_isRenderableLayer(e){switch(e.op()){case 8:case 1:case 0:return!1}return!0}_countLayers(e){let t=0;switch(e.op()){case 0:{let n=e;t=t+this._countLayers(n.child);break}case 2:{let n=e;t=t+this._countLayers(n.child);break}case 1:{let n=e;for(let r=0,o=n.children.length;r<o;r=r+1){let a=n.children[r];t=t+this._countLayers(a)}break}case 3:case 4:break;case 5:{let n=e;t=t+this._countLayers(n.alpha),t=t+this._countLayers(n.color);break}case 6:{let n=e;t=t+this._countLayers(n.child);break}case 7:{let n=e;t=t+this._countLayers(n.child);break}case 9:{let n=e;t=t+this._countLayers(n.alpha);break}case 8:{let n=e;t=t+this._countLayers(n.tree);break}case 10:{let n=e;t=t+this._countLayers(n.child);break}case 11:{let n=e;t=t+this._countLayers(n.child);break}case 12:{let n=e;t=t+this._countLayers(n.startChild),t=t+this._countLayers(n.endChild);break}default:throw new Error(`Unhandled node op ${Sr[e.op()]}`)}return this._isRenderableLayer(e)&&(t=t+1),t}treeToRender(e){if(!this.isEnabled())return e;e!=this._originalTree&&(this._totalLayersInRenderTree=this._countLayers(e),this._filteredTree=this._filterCompositeTileGridNodes(e),this._originalTree=e);let t=this._renderTreeWithNLayers(this._filteredTree,this._maxLayersToRender).a;return t!=this._lastTreeToRender&&console.log(`LayerByLayerRendering: rendering ${this._maxLayersToRender} instructions out of ${this._totalLayersInRenderTree}
`+t.debugString1()),this._lastTreeToRender=t,t}constructor(){this._isEnabled=!1,this._maxLayersToRender=1,this._totalLayersInRenderTree=0,this._maxFrameDelay=60,this._defaultFrameDelay=45,this._minFrameDelay=5,this._frameDelay=60,this._framesUntilUpdate=0,this._filteredTree=null,this._originalTree=null,this._invalidateFn=null,this._isPlaying=!1,this._lastTreeToRender=null}};var Qc=(n=>(n[n.FULL_SIZE=0]="FULL_SIZE",n[n.THUMBNAIL=1]="THUMBNAIL",n[n.EMOJI=2]="EMOJI",n))(Qc||{}),Ci=class{hash(){return`${this.image.objectHash()}:${Qc[this.purpose]}`}constructor(e,t){this.image=e,this.purpose=t}},_b=(t=>(t[t.TILE_WAS_EMPTY=0]="TILE_WAS_EMPTY",t[t.HAS_CONTENT=1]="HAS_CONTENT",t))(_b||{}),Kc;(r=>{function i(){return new Map}r._new=i;function e(o,a){o.set(a.hash(),a)}r.add=e;function t(o){let a=o;return Array.from(a.values())}r.asList=t;function n(o,a){let s=a,l=o;Be.StringMap_each(s,(d,c)=>{l.set(d,c)})}r.addAllImagesInSet=n})(Kc||(Kc={}));var Hg=class{needsMultipleAAPasses(){return this.status==1}constructor(e,t,n){this.includesBackgroundColor=e,this.status=t,this.neededImagesOrNull=n}};function Ab(){return cr.SSAA_SIZE()}var Ri=class i{context(){return this._context}bufferPool(){return this._bufferPool}totalVRAM(){let e=0;return e=e+this._pathRasterizer.totalVRAM(),e=e+this._tileStack.totalVRAM(),e}upscaleRectForSSAA(e){let t=cr.SSAA_SIZE()/yn.TILE_SIZE|0;return e.scaledBy1(t)}downscaleRectForSSAA(e){let t=yn.TILE_SIZE/cr.SSAA_SIZE();return e.scaledBy1(t)}setBackgroundEnabled(e){this._backgroundEnabled=e}currentTextureSize(){return this._currentTile1().tileSize()}markDidDraw(){this._didDraw=!0}pushSSAARenderState(e){if(this._shouldDisableAllAntialiasing){Ve("Pushing SSAA state during final composite");return}if(this._ssaaState.level==0){this._tileStack.setSSAARenderState(),this._ssaaState.mode=e==null?0:1;let t=null;this._tileStack.isEmpty()||(t=this.upscaleRectForSSAA(w.FrozenScissors.last(this._currentTile1().scissors()).clone())),e!=null&&this._needsBackgroundColor(e)?(this.duplicateTile1(t),this._downsampleNeedsBlend=!0):(this._downsampleNeedsBlend=!1,this._tileStack.pushTileWithScissors1(t))}this._ssaaState!=null&&(this._ssaaState.level+=1)}popSSAARenderState(){if(this._shouldDisableAllAntialiasing){Ve("Popping SSAA state during final composite");return}if(this._ssaaState!=null&&(this._ssaaState.level-=1),this._ssaaState.level==0){let e=this._tileStack.popTile();this._tileStack.unsetSSAARenderState(),this._downsampleNeedsBlend?w.in_Context.Context_setCopyBlendState(this._context):w.in_Context.Context_setPremultipliedBlendState(this._context),this.downsampleSuperSSAATile(e),this._tileStack.freeTileToPool(e)}}supersampleState(){return this._ssaaState}currentTile(){return this._currentTile1()}computeTileTransform(){return ne.new2().scaledBy2(1/this._canvasSpaceTileBounds.size().x()).translatedBy1(new I(-this._canvasSpaceTileBounds.x(),-this._canvasSpaceTileBounds.y()))}canvasSpaceToViewSpaceScale(){return this._tileSize/this._canvasSpaceTileBounds.size().x()}drawTile(e,t,n,r,o,a){return this._context.annotateAndReturn(`Draw tile (${t}, ${n})`,()=>{let s=o.colorTexture().format(),l=a.shouldRenderDirectlyToOutputTexture;a.useLargeTilesForDrawToScreen&&this._tileStack.setDrawToScreenLargeTileState(),l&&(a.shouldDisableAllAntialiasing,s!=w.TextureFormat.RGBA_LINEAR_CLAMP&&o.colorTexture().setFormat(w.TextureFormat.RGBA_LINEAR_CLAMP)),this._requestImage=a.requestImage,this._boundsCache=a.boundsCache,this._canvasSpaceTileBounds=new G(t,n,r,r),this._tileSize=a.useLargeTilesForDrawToScreen?cr.SSAA_SIZE():yn.TILE_SIZE,this._shouldDisableAllAntialiasing=a.shouldDisableAllAntialiasing,this._neededImagesOrNull=a.shouldCollectNeededImages?Kc._new():null;let d=this.computeTileTransform(),c=a.renderTree,p=new zg(c,d,a.backgroundClearColor);if(this._didDraw=!1,this._includesBackgroundColor=!1,this._includesBackgroundColor=c!=null&&this.nodeNeedsBackgroundColor(c,d),this._includesBackgroundColor){let h=E.premultiplied(a.backgroundClearColor);l?this._tileStack.pushTileBackedByExistingFramebufferAndClearToColor(o,e,a,h):this._tileStack.pushTileAndClearToColor(h)}else l?this._tileStack.pushTileBackedByExistingFramebuffer(o,e,a):this._tileStack.pushTile1();if(c!=null){let h=this.allocateAndComputeTileScissor(d,this.bounds(c));this._tileStack.last().pushScissor2(h);let f=ne.new2();this.visit(c,ne.new3(d),f),this._tileStack.popScissorFromCurrentTile()}let u=this.drawTileFinish(p,e,o,l);return l&&s!=w.TextureFormat.RGBA_LINEAR_CLAMP&&o.colorTexture().setFormat(s),a.useLargeTilesForDrawToScreen&&this._tileStack.unsetDrawToScreenLargeTileState(),u})}setCanvas(e){this._canvas!=e&&(this._canvas=e,this._pathRasterizer.clearGradientCache())}drawToCurrentTile(e,t,n){let r=this._currentTile1().needsColorClear(),o=this._context.currentStencilState().isEnabled&&this._currentTile1().needsDepthStencilClear();if(r||o){let a=this._context.currentStencilState(),s=this._context.currentBlendState();this._context.setStencilState(w.StencilState.NONE),w.in_Context.Context_setCopyBlendState(this._context);let l=r&&o?w.Clear.ALL:r?w.Clear.COLOR:w.Clear.DEPTH_STENCIL;this._currentTile1().doDeferredClear(l),this._context.setStencilState(a),this._context.setBlendState(s)}this._context.draw(e,t,n),this._currentTile1().setIsColorClear(!1)}clear(e,t){this._context.setFramebuffer(t),this._context.clear2(w.Clear.COLOR,e)}_currentTile1(){return this._tileStack.last()}_currentTile2(e){return this._tileStack.get(this._tileStack.count()-e-1)}_needsBackgroundColor(e){return e.hasNonIsolatedBlends()||e.hasBackgroundBlurs()}bounds(e){return e.currentBounds(this._boundsCache)}nodeNeedsBackgroundColor(e,t){let n=G.new3(this.bounds(e));t.transformRect(n);let r=G.UNIT.overlaps(n);if(e==null||!this._needsBackgroundColor(e)||!r)return!1;if(e.op()==1){let o=e;for(let a of o.children){let s=G.new3(this.bounds(a)),l=G.UNIT.overlaps(t.transformRect(s));if(this._needsBackgroundColor(a)&&l)return!0}return!1}return!0}drawTileFinish(e,t,n,r){this._includesBackgroundColor&&!this._didDraw&&(this._tileStack.last().clearToColor(E.TRANSPARENT),this._includesBackgroundColor=!1),this._currentTile1().needsColorClear()&&this._currentTile1().doDeferredClear(w.Clear.COLOR);let o=this._tileStack.popTile();return r||(this._context.setFramebuffer(n),this._context.setViewport(t.x()|0,t.y()|0,t.width()|0,t.height()|0),w.in_Context.Context_setCopyBlendState(this._context),this._blendTextureMaterial.setUniformFloat(this._materialStrings.GLSLX_NAME_U_OPACITY,1),this._blendTextureMaterial.setUniformSampler(this._materialStrings.GLSLX_NAME_U_TEXTURE0,o.colorTextureForSampling(),0),this._context.draw(w.Primitive.TRIANGLE_STRIP,this._blendTextureMaterial,this._quadArea),this._tileStack.freeTileToPool(o)),this._tileStack.assertPoolAfterRender(),new Hg(this._includesBackgroundColor,this._didDraw?1:0,this._neededImagesOrNull)}visit(e,t,n){let r=G.new3(G.UNIT),o=ne.new3(t);o.invert();let a=o.transformRect(r);this.visitWithCanvasSpaceTileBounds(e,t,a,n)}visitWithCanvasSpaceTileBounds(e,t,n,r){this._context.annotateProfile(e.opProfileString(),()=>{this._visitWithCanvasSpaceTileBounds(e,t,n,r)})}_visitWithCanvasSpaceTileBounds(e,t,n,r){var o;if(n.overlaps(this.bounds(e))&&!w.FrozenScissors.isEmpty(this._currentTile1().scissors()))switch(e.op()){case 0:{let a=e;this.visitWithCanvasSpaceTileBounds(a.child,t,n,r);break}case 2:{let a=e;this._shouldDisableAllAntialiasing?this.visitWithCanvasSpaceTileBounds(a.child,t,n,r):(this.pushSSAARenderState(a.child),this.visitWithCanvasSpaceTileBounds(a.child,t,n,r),this.popSSAARenderState());break}case 1:{let a=e;this.visitGroupHelper(a,t,n,r);break}case 3:{let a=e,s=this._shouldDisableAllAntialiasing?0:a.desiredAntialiasing();this._pathRasterizer.beginBatch(s),this._pathRasterizer.renderFill(t,a),this._pathRasterizer.finishBatch();break}case 4:{let a=e,s=this._shouldDisableAllAntialiasing?0:a.desiredAntialiasing();this._pathRasterizer.beginBatch(s),this._pathRasterizer.renderFillStroke(t,a),this._pathRasterizer.finishBatch();break}case 5:{let a=e,s=(a.type==0||a.type==4||a.type==1)&&a.hasNonIsolatedBlends(),l=this.allocateAndComputeTileScissor(t,this.bounds(a.color)),d=a.type==0&&!a.hasNonIsolatedBlends()&&a.alpha.isAxisAlignedRectFill()&&a.alpha.op()==3&&Ne.containsAtLeastOneVisibleOpaquePaint(a.alpha.geometry.paints),c=d?a.alpha.geometryBounds():this.bounds(a.alpha),p=a.type==2||Re.emulateFullscreenRenderingBugs&&a.type==3?this.allocateAndComputeTileScissor(t,c):a.type==4?l:this.allocateAndComputeTileScissor(t,c).intersectedWith(l);if(d){let y=this._tileStack.takeScissorFromCurrentTile();p.intersectWith(y),this._tileStack.pushScissor(p),this.visitWithCanvasSpaceTileBounds(a.color,t,n,r),this._tileStack.popScissorFromCurrentTile(),this._tileStack.pushScissor(y);return}let u=G.new3(w.FrozenScissors.last(this._currentTile1().scissors())).intersectedWith(p);if(u.isEmpty())return;s?(this.duplicateTile1(u),this.duplicateTile1(u)):a.type==3?(this._tileStack.pushTileAndClearToColor(E.premultiplied(this._canvas.computedBackgroundColor())),this._tileStack.pushScissor(u)):this._tileStack.pushTileWithScissors1(u),this.visitWithCanvasSpaceTileBounds(a.color,t,n,r),this._tileStack.pushTileWithScissors1(u),this.visitWithCanvasSpaceTileBounds(a.alpha,t,n,r);let h=this._tileStack.popTile(),f=this._tileStack.popTile();switch(a.type){case 0:{if(s){let y=this._tileStack.popTile();this.maskTilePassThrough(y,h,f,u),this._tileStack.freeTileToPool(y)}else this.maskTile(h,f,u);break}case 1:{if(s){let y=this._tileStack.popTile();this.maskTileLuminancePassThrough(y,h,f,u),this._tileStack.freeTileToPool(y)}else this.maskTileLuminance(h,f,u);break}case 4:{if(s){let y=this._tileStack.popTile();this.maskKnockoutShadowTilePassThrough(y,h,f,u),this._tileStack.freeTileToPool(y)}else this.maskKnockoutShadowTile(h,f,u);break}case 3:{this.maskBackgroundBlurTile(h,f,u);break}case 2:{this.maskInnerShadowTile(h,f,u,a.innerShadowFill,a.innerShadowAlphaRequiresHardMask);break}}this._tileStack.freeTileToPool(h),this._tileStack.freeTileToPool(f);break}case 9:{let a=e,s=this.allocateAndComputeTileScissor(t,this.bounds(a.alpha)),l=G.new3(w.FrozenScissors.last(this._currentTile1().scissors())).intersectedWith(s);if(l.isEmpty())return;this._tileStack.pushTileWithScissors1(l),this.visitWithCanvasSpaceTileBounds(a.alpha,t,n,r);let d=this._tileStack.popTile();this.hardMaskTileWithColor(d,a.color,l),this._tileStack.freeTileToPool(d);break}case 6:{let a=e,s=G.new3(this.bounds(a));t.transformRect(s),s.scaledBy1(this.currentTextureSize());let l=a.radius*t.scale1().max1(),d=G.new3(w.FrozenScissors.last(this._currentTile1().scissors())).intersectedWith(s);if(d.isEmpty())return;if(l<1/this.currentTextureSize()){this.visitWithCanvasSpaceTileBounds(a.child,t,n,r);return}let c=yb(a.child),p=c.a,u=c.b??vt.FrozenAffineTransform_IDENTITY,h=p.isRectFill()?p:null;if(h!=null&&a.clamp.isInvalid()){let y=Ne.onlySolidPaintOrNull(h.geometry.paints);if(y!=null){let g=ne.new2().translatedBy2(-1,-1).scaledBy2(2).multipliedBy1(t).multipliedBy1(u).multipliedBy1(h.transform);this.renderBlurredRectangle(g,h.geometry.path().bounds(),E.multiplyOpacity(y.color(),y.opacity()),a.radius);return}}let f=p.isRoundedRectFill()?p:null;if(f!=null&&a.clamp.isInvalid()){let y=f.geometry.path().path(),g=y.radii();if(g.isUniform()){let A=Ne.onlySolidPaintOrNull(f.geometry.paints);if(A!=null){let T=g.topLeft,b=ne.new2().translatedBy2(-1,-1).scaledBy2(2).multipliedBy1(t).multipliedBy1(u).multipliedBy1(f.transform);this.renderBlurredRoundedRectangle(b,y.bounds(),T,E.multiplyOpacity(A.color(),A.opacity()),a.radius);return}}}this.renderBlur(e,t,l,d,r,a.clamp);break}case 7:{let a=e,s=this.allocateAndComputeTileScissor(t,this.bounds(a.child)),l=n1(a.blendMode)&&(this._currentTile1().isColorClear()||this._currentTile1().needsColorClear())&&a.opacity==1,d=G.new3(w.FrozenScissors.last(this._currentTile1().scissors())).intersectedWith(s);if(d.isEmpty())return;l?this._currentTile1().pushScissor2(d.clone()):a.blendMode=="PASS_THROUGH"?this.duplicateTile1(d):this._tileStack.pushTileWithScissors1(d),this.visitWithCanvasSpaceTileBounds(a.child,t,n,r),l&&this._currentTile1().popScissor(),l||this.blendAndPopTile(a.blendMode,a.opacity);break}case 8:{let a=e;this.visitCompositeChildWithOpacity(a,1,t,n);break}case 10:{let a=e;switch(a.property){case 2:{let s=ne.new3(t);s.multipliedBy1(a.transform());let l=ne.new3(a.transform());l.invert()||l.copyFrom(vt.FrozenAffineTransform_IDENTITY),l.multipliedBy1(r),this.visit(a.child,s,l);break}case 1:{let s=ne.new2();this.visitWithCanvasSpaceTileBounds(a.child,t,n,s);break}case 0:{let s=ne.new2(),l=ne.new2();s.copyFrom(t).multipliedBy1(r),this.visit(a.child,s,l);break}case 4:{let s=a.opacity(),l=!1;if(s==1)this.visitWithCanvasSpaceTileBounds(a.child,t,n,r),l=!0;else if(s==0)l=!0;else if(a.child.op()==3){let d=a.child,c=(o=Ne.onlyPaintOrNull(d.geometry.paints))==null?void 0:o.asSinglePaint();if(c!=null){let p=c.cloneAsSinglePaint();p.setOpacity(p.opacity()*s),this.visitWithCanvasSpaceTileBounds(d.withPaints([p]),t,n,r),l=!0}}else if(a.child.op()==8){let d=a.child;this.visitCompositeChildWithOpacity(d,s,t,n),l=!0}if(!l){let d=this.allocateAndComputeTileScissor(t,this.bounds(a.child)),c=G.new3(w.FrozenScissors.last(this._currentTile1().scissors())).intersectedWith(d);a.child.hasNonIsolatedBlends()?this.duplicateTile1(c):this._tileStack.pushTileWithScissors1(c),this.visitWithCanvasSpaceTileBounds(a.child,t,n,r),a.child.hasNonIsolatedBlends()?this.blendAndPopTile("PASS_THROUGH",s):this.blendAndPopTile("NORMAL",s)}break}case 3:{this.visitWithCanvasSpaceTileBounds(a.child,t,n,r);break}case 5:{this.visitWithCanvasSpaceTileBounds(a.child,t,n,r);break}default:throw new Error(`Unhandled VolatileProperty value ${Pa.VolatileProperty_toString(a.property)}`)}break}case 11:{let a=e,s=ne.new3(t);s.multipliedBy1(a.transform);let l=ne.new3(a.transform);l.invert()||l.copyFrom(vt.FrozenAffineTransform_IDENTITY),l.multipliedBy1(r),this.visit(a.child,s,l);break}case 12:{let a=e,s=this.allocateAndComputeTileScissor(t,this.bounds(a.startChild)),l=this.allocateAndComputeTileScissor(t,this.bounds(a.endChild)),d=G.new2();d.copyFrom(w.FrozenScissors.last(this._currentTile1().scissors())).intersectedWith(s);let c=d.clone().scaledBy1(1/this.currentTextureSize());a.startChild.hasNonIsolatedBlends()?this.duplicateTile1(d):this._tileStack.pushTileWithScissors1(d),this.visitWithCanvasSpaceTileBounds(a.startChild,t,n,r);let p=this._tileStack.popTile();d.copyFrom(w.FrozenScissors.last(this._currentTile1().scissors())).intersectedWith(l);let u=d.clone().scaledBy1(1/this.currentTextureSize());a.endChild.hasNonIsolatedBlends()?this.duplicateTile1(d):this._tileStack.pushTileWithScissors1(d),this.visitWithCanvasSpaceTileBounds(a.endChild,t,n,r);let h=this._tileStack.popTile();this._lerpTileMaterial.setUniformSampler(this._materialStrings.GLSLX_NAME_U_TEXTURE0,p.colorTextureForSampling(),0),this._lerpTileMaterial.setUniformSampler(this._materialStrings.GLSLX_NAME_U_TEXTURE1,h.colorTextureForSampling(),1),w.in_Material.Material_setUniformVec43(this._lerpTileMaterial,this._materialStrings.GLSLX_NAME_U_TEXTURE0_UV_SPACE_SCISSOR,c),w.in_Material.Material_setUniformVec43(this._lerpTileMaterial,this._materialStrings.GLSLX_NAME_U_TEXTURE1_UV_SPACE_SCISSOR,u),this._lerpTileMaterial.setUniformFloat(this._materialStrings.GLSLX_NAME_U_OPACITY,Xt.double_clamp(a.progress(),0,1)),w.in_Context.Context_setPremultipliedBlendState(this._context);let f=this.allocateAndComputeTileScissor(t,this.bounds(e));this._tileStack.pushScissor(f),this.drawToCurrentTile(w.Primitive.TRIANGLE_STRIP,this._lerpTileMaterial,this._quadArea),this._tileStack.popScissorFromCurrentTile(),this._tileStack.freeTileToPool(h),this._tileStack.freeTileToPool(p);break}}}visitCompositeChildWithOpacity(e,t,n,r){let o=ne.new2().translatedBy2(-1,-1).scaledBy2(2).multipliedBy1(n),a=this.allocateAndComputeTileScissor(n,this.bounds(e));this._tileStack.pushScissor(a),e.forEachTileWithinBounds(1,r,s=>{let l=s.textureRegionOrNull();if(l!=null&&(this.drawTextureRegion2(l,s.canvasSpaceBounds(),o,1,t),s.neededImagesOrNull!=null)){let d=Kc.asList(s.neededImagesOrNull);for(let c of d)this.getOrCreateImageTexture(c)}}),this._tileStack.popScissorFromCurrentTile()}visitGroupHelper(e,t,n,r){for(let o of e.children)this.visitGroupChildWithSSAA(o,t,n,r);this._pathRasterizer.currentBatchAA()!=null&&this._pathRasterizer.finishBatch()}visitGroupChildWithSSAA(e,t,n,r){if(!w.FrozenScissors.last(this._currentTile1().scissors()).overlaps(this.allocateAndComputeTileScissor(t,this.bounds(e))))return;let a=this._pathRasterizer.currentBatchAA()!=null&&this._pathRasterizer.currentBatchAA().value==2,s=e.desiredAntialiasing()==2&&!this._shouldDisableAllAntialiasing;s&&!a?this._pathRasterizer.beginBatch(2):!s&&a&&this._pathRasterizer.finishBatch(),s?e.op()==3?this._pathRasterizer.renderFill(t,e):e.op()==4&&this._pathRasterizer.renderFillStroke(t,e):this.visitWithCanvasSpaceTileBounds(e,t,n,r)}allocateAndComputeTileScissor(e,t){let n=G.new3(t);e.transformRect(n);let r=n.scaledBy1(this.currentTextureSize());return Y.useIntBoundariesForScissor()?r.expandToInts():r.round(),r}renderBlurredRectangle(e,t,n,r){E.alpha(n)!=0&&(w.in_Material.Material_setUniformMat32(this._rectangleBlurMaterial,this._materialStrings.GLSLX_NAME_U_VERTEX_TRANSFORM,e),w.in_Material.Material_setUniformVec42(this._rectangleBlurMaterial,this._materialStrings.GLSLX_NAME_U_COLOR,E.premultiplied(n)),w.in_Material.Material_setUniformVec43(this._rectangleBlurMaterial,this._materialStrings.GLSLX_NAME_U_QUAD,t),this._rectangleBlurMaterial.setUniformFloat(this._materialStrings.GLSLX_NAME_U_BLUR_RADIUS,r),w.in_Context.Context_setPremultipliedBlendState(this._context),this.drawToCurrentTile(w.Primitive.TRIANGLE_STRIP,this._rectangleBlurMaterial,this._quadArea),this._didDraw=!0)}renderBlurredRoundedRectangle(e,t,n,r,o){E.alpha(r)!=0&&(w.in_Material.Material_setUniformMat32(this._roundedRectangleBlurMaterial,this._materialStrings.GLSLX_NAME_U_VERTEX_TRANSFORM,e),w.in_Material.Material_setUniformVec42(this._roundedRectangleBlurMaterial,this._materialStrings.GLSLX_NAME_U_COLOR,E.premultiplied(r)),w.in_Material.Material_setUniformVec43(this._roundedRectangleBlurMaterial,this._materialStrings.GLSLX_NAME_U_QUAD,t),this._roundedRectangleBlurMaterial.setUniformFloat(this._materialStrings.GLSLX_NAME_U_CORNER_RADIUS_OVER_BLUR_RADIUS,n/o),w.in_Material.Material_setUniformVec22(this._roundedRectangleBlurMaterial,this._materialStrings.GLSLX_NAME_U_HALF_SIZE_OVER_BLUR_RADIUS,t.size().divide(2*o)),this._roundedRectangleBlurMaterial.setUniformFloat(this._materialStrings.GLSLX_NAME_U_BLUR_RADIUS,o),w.in_Context.Context_setPremultipliedBlendState(this._context),this.drawToCurrentTile(w.Primitive.TRIANGLE_STRIP,this._roundedRectangleBlurMaterial,this._quadArea),this._didDraw=!0)}renderBlur(e,t,n,r,o,a){let s=e,l=32,d=.5,c=1/(1+2*n),p=Math.min(l,c*n*this.currentTextureSize()),u=p/this.currentTextureSize(),h=u/n;h>2/d/this.currentTextureSize()&&(h=Math.round(h*(this.currentTextureSize()*d))/(this.currentTextureSize()*d),p=Math.min(l/d,h*n*this.currentTextureSize()),u=p/this.currentTextureSize());let f=ne.new2().translatedBy2(.5,.5).scaledBy2(h).translatedBy2(-.5,-.5),y=G.new3(r).scaledBy1(1/this.currentTextureSize());f.transformRect(y);let g=G.new3(y).expandedBy2(0,u),A=G.new3(g).expandedBy2(u,0),T=f.multipliedBy1(t),b=null;if(!a.isInvalid()){b=T.transformRect(a.clone()),b.scaledBy1(this.currentTextureSize());let v=Math.ceil(b.left()-.5)+.5,C=Math.ceil(b.top()-.5)+.5,N=Math.floor(b.right()+.5)-.5,x=Math.floor(b.bottom()+.5)-.5;b=new G(v,C,N-v,x-C),b.scaledBy1(1/this.currentTextureSize())}let _=p>4,m=_&&s.child.op()==9;if(this._tileStack.pushTileWithScissors1(G.new3(A).scaledBy1(this.currentTextureSize()).expandedBy1(1).rounded()),m){let v=s.child;this.visit(v.alpha,T,o)}else this.visit(s.child,T,o);let S=!1;if(_){let v=p*d,C=G.new3(A).scaledBy1(d),N=G.new3(g).scaledBy1(d),x=G.new3(y).scaledBy1(d),z=null;if(b!=null){z=G.new3(b).scaledBy1(d),z.scaledBy1(this.currentTextureSize());let L=Math.ceil(z.left()-.5)+.5,Q=Math.ceil(z.top()-.5)+.5,X=Math.floor(z.right()+.5)-.5,M=Math.floor(z.bottom()+.5)-.5;z=new G(L,Q,X-L,M-Q),z.scaledBy1(1/this.currentTextureSize())}let $=this._tileStack.popTile(),q=G.new3(C).scaledBy1(this.currentTextureSize()).expandedBy1(1).rounded();if(this._tileStack.pushTileWithScissors2(q,S),m){let L=s.child;this.hardMaskWithColorAndDownscaleTile($,L.color,C,A)}else this.downscaleTile($,C,A);this._tileStack.freeTileToPool($);let K=this._tileStack.popTile(),F=G.new3(N).scaledBy1(this.currentTextureSize()).expandedBy1(1).rounded();this._tileStack.pushTileWithScissors2(F,S),this.blurTile(K,1/this.currentTextureSize(),0,G.new3(F).scaledBy1(1/this.currentTextureSize()),v,z),this._tileStack.freeTileToPool(K);let P=this._tileStack.popTile(),k=G.new3(x).scaledBy1(this.currentTextureSize()).expandedBy1(1).rounded();this._tileStack.pushTileWithScissors2(k,S),this.blurTile(P,0,1/this.currentTextureSize(),G.new3(k).scaledBy1(1/this.currentTextureSize()),v,z),this._tileStack.freeTileToPool(P);let H=this._tileStack.popTile();this.upscaleTile(H,r.scaledBy1(1/this.currentTextureSize()),x),this._tileStack.freeTileToPool(H)}else{let v=this._tileStack.popTile(),C=G.new3(g).scaledBy1(this.currentTextureSize()).expandedBy1(1).rounded();this._tileStack.pushTileWithScissors2(C,S),this.blurTile(v,1/this.currentTextureSize(),0,G.new3(C).scaledBy1(1/this.currentTextureSize()),p,b),this._tileStack.freeTileToPool(v);let N=this._tileStack.popTile(),x=G.new3(y).scaledBy1(this.currentTextureSize()).expandedBy1(1).rounded();this._tileStack.pushTileWithScissors2(x,S),this.blurTile(N,0,1/this.currentTextureSize(),G.new3(x).scaledBy1(1/this.currentTextureSize()),p,b),this._tileStack.freeTileToPool(N);let z=this._tileStack.popTile();this.upscaleTile(z,r.scaledBy1(1/this.currentTextureSize()),y),this._tileStack.freeTileToPool(z)}}hardMaskTileWithColor(e,t,n){let r=G.new3(n);w.in_Material.Material_setUniformVec43(this._hardMaskTileWithColorMaterial,this._materialStrings.GLSLX_NAME_U_QUAD,this.scissorQuad(r)),w.in_Material.Material_setUniformVec42(this._hardMaskTileWithColorMaterial,this._materialStrings.GLSLX_NAME_U_COLOR,E.premultiplied(t)),e.colorTextureForSampling().setFormat(w.TextureFormat.RGBA_NEAREST_CLAMP),this._hardMaskTileWithColorMaterial.setUniformSampler(this._materialStrings.GLSLX_NAME_U_TEXTURE0,e.colorTextureForSampling(),0),w.in_Context.Context_setPremultipliedBlendState(this._context),this.drawToCurrentTile(w.Primitive.TRIANGLE_STRIP,this._hardMaskTileWithColorMaterial,this._quadArea),this._didDraw=!0,e.colorTextureForSampling().setFormat(w.TextureFormat.RGBA_LINEAR_CLAMP)}blurTile(e,t,n,r,o,a){let s=null;a==null?s=this._unclampedBlurMaterial:(s=this._clampedBlurMaterial,w.in_Material.Material_setUniformVec43(s,this._materialStrings.GLSLX_NAME_U_BLUR_CLAMP,a)),w.in_Material.Material_setUniformVec43(s,this._materialStrings.GLSLX_NAME_U_QUAD,r),s.setUniformFloat(this._materialStrings.GLSLX_NAME_U_COUNT,o),s.setUniformVec21(this._materialStrings.GLSLX_NAME_U_BLUR_DELTA,t,n),s.setUniformSampler(this._materialStrings.GLSLX_NAME_U_TEXTURE0,e.colorTextureForSampling(),0),w.in_Context.Context_setCopyBlendState(this._context),this.drawToCurrentTile(w.Primitive.TRIANGLE_STRIP,s,this._quadArea),this._didDraw=!0}scissorQuad(e){return e.scaledBy1(1/this.currentTextureSize())}blendAndPopTile(e,t){if(e=="PASS_THROUGH"||e=="NORMAL"||e=="SCREEN"){let n=this._tileStack.popTile(),r=this.scissorQuad(G.new3(w.FrozenScissors.last(n.scissors())));w.in_Material.Material_setUniformVec43(this._blendTileSimpleMaterial,this._materialStrings.GLSLX_NAME_U_QUAD,r),e=="PASS_THROUGH"?(this._blendTileSimpleMaterial.setUniformFloat(this._materialStrings.GLSLX_NAME_U_OPACITY,1),w.in_Context.Context_setInterpolateBlendState(this._context,t)):(this._blendTileSimpleMaterial.setUniformFloat(this._materialStrings.GLSLX_NAME_U_OPACITY,t),e=="SCREEN"?w.in_Context.Context_setScreenBlendState(this._context):w.in_Context.Context_setPremultipliedBlendState(this._context)),n.colorTextureForSampling().setFormat(w.TextureFormat.RGBA_NEAREST_CLAMP),this._blendTileSimpleMaterial.setUniformSampler(this._materialStrings.GLSLX_NAME_U_TEXTURE0,n.colorTextureForSampling(),0),this.drawToCurrentTile(w.Primitive.TRIANGLE_STRIP,this._blendTileSimpleMaterial,this._quadArea),this._didDraw=!0,n.colorTextureForSampling().setFormat(w.TextureFormat.RGBA_LINEAR_CLAMP),this._tileStack.freeTileToPool(n)}else{this.duplicateTile2(w.FrozenScissors.last(this._currentTile1().scissors()),1);let n=this._tileStack.popTile(),r=this._tileStack.popTile(),o=this.scissorQuad(G.new3(w.FrozenScissors.last(r.scissors())));w.in_Material.Material_setUniformVec43(this._blendTileCustomMaterial,this._materialStrings.GLSLX_NAME_U_QUAD,o),this._blendTileCustomMaterial.setUniformInt(this._materialStrings.GLSLX_NAME_U_TYPE,r1.get(e)),this._blendTileCustomMaterial.setUniformFloat(this._materialStrings.GLSLX_NAME_U_OPACITY,t),r.colorTextureForSampling().setFormat(w.TextureFormat.RGBA_NEAREST_CLAMP),n.colorTextureForSampling().setFormat(w.TextureFormat.RGBA_NEAREST_CLAMP),this._blendTileCustomMaterial.setUniformSampler(this._materialStrings.GLSLX_NAME_U_TEXTURE0,r.colorTextureForSampling(),0),this._blendTileCustomMaterial.setUniformSampler(this._materialStrings.GLSLX_NAME_U_TEXTURE1,n.colorTextureForSampling(),1),w.in_Context.Context_setCopyBlendState(this._context),this.drawToCurrentTile(w.Primitive.TRIANGLE_STRIP,this._blendTileCustomMaterial,this._quadArea),this._didDraw=!0,n.colorTextureForSampling().setFormat(w.TextureFormat.RGBA_LINEAR_CLAMP),r.colorTextureForSampling().setFormat(w.TextureFormat.RGBA_LINEAR_CLAMP),this._tileStack.freeTileToPool(n),this._tileStack.freeTileToPool(r)}}upscaleTile(e,t,n){w.in_Material.Material_setUniformVec43(this._upscaleTileMaterial,this._materialStrings.GLSLX_NAME_U_QUAD,t),w.in_Material.Material_setUniformVec43(this._upscaleTileMaterial,this._materialStrings.GLSLX_NAME_U_SOURCE,n),this._upscaleTileMaterial.setUniformSampler(this._materialStrings.GLSLX_NAME_U_TEXTURE0,e.colorTextureForSampling(),0),w.in_Context.Context_setPremultipliedBlendState(this._context),this.drawToCurrentTile(w.Primitive.TRIANGLE_STRIP,this._upscaleTileMaterial,this._quadArea),this._didDraw=!0}downscaleTile(e,t,n){w.in_Material.Material_setUniformVec43(this._downscaleTileMaterial,this._materialStrings.GLSLX_NAME_U_QUAD,t),w.in_Material.Material_setUniformVec43(this._downscaleTileMaterial,this._materialStrings.GLSLX_NAME_U_SOURCE,n),this._downscaleTileMaterial.setUniformSampler(this._materialStrings.GLSLX_NAME_U_TEXTURE0,e.colorTextureForSampling(),0),w.in_Context.Context_setCopyBlendState(this._context),this.drawToCurrentTile(w.Primitive.TRIANGLE_STRIP,this._downscaleTileMaterial,this._quadArea),this._didDraw=!0}hardMaskWithColorAndDownscaleTile(e,t,n,r){w.in_Material.Material_setUniformVec43(this._hardMaskWithColorAndDownscaleTileMaterial,this._materialStrings.GLSLX_NAME_U_QUAD,n),w.in_Material.Material_setUniformVec43(this._hardMaskWithColorAndDownscaleTileMaterial,this._materialStrings.GLSLX_NAME_U_SOURCE,r),this._hardMaskWithColorAndDownscaleTileMaterial.setUniformSampler(this._materialStrings.GLSLX_NAME_U_TEXTURE0,e.colorTextureForSampling(),0),w.in_Material.Material_setUniformVec42(this._hardMaskWithColorAndDownscaleTileMaterial,this._materialStrings.GLSLX_NAME_U_COLOR,E.premultiplied(t)),this._hardMaskWithColorAndDownscaleTileMaterial.setUniformFloat(this._materialStrings.GLSLX_NAME_U_TEXTURE_SIZE,this.currentTextureSize()),this._hardMaskWithColorAndDownscaleTileMaterial.setUniformFloat(this._materialStrings.GLSLX_NAME_U_TEXTURE_PX,1/this.currentTextureSize()),w.in_Context.Context_setCopyBlendState(this._context),this.drawToCurrentTile(w.Primitive.TRIANGLE_STRIP,this._hardMaskWithColorAndDownscaleTileMaterial,this._quadArea),this._didDraw=!0}_advanceGIFAndUpload(e,t){let n=e.gif().nextFrameIfNecessary();n!=null&&w.in_Texture.Texture_resize3(t,e.width(),e.height(),new mn(0,e.width(),e.height(),n))}getOrCreateImageTexture(e){var o,a;if((e==null?void 0:e.image)==null)return null;this._neededImagesOrNull!=null&&Kc.add(this._neededImagesOrNull,e);let t=e.image,n=e.purpose,r=t.texture();return r!=null?t.gif()!=null&&this._advanceGIFAndUpload(t,r):(((o=t.decodedData())==null?void 0:o.pixels)!=null||t.gif()!=null)&&(r=w.in_Context.Context_createTexture1(this._context,w.TextureFormat.RGBA_NEAREST_CLAMP,t.width(),t.height(),"Image"),r.setShouldUnloadImageBuffer(Je.isMobile(Je.current())||Je.current()==4&&navigator.maxTouchPoints>0||Rt.forceMobileOptimizations()),t.setTexture(r),((a=t.decodedData())==null?void 0:a.pixels)!=null?(w.in_Texture.Texture_resize3(t.texture(),t.width(),t.height(),t.decodedData()),(Je.isMobile(Je.current())||Je.current()==4&&navigator.maxTouchPoints>0||Rt.forceMobileOptimizations())&&t.freeMemoryForDecodedData()):t.gif()!=null&&this._advanceGIFAndUpload(t,r)),t.state()==0&&this._requestImage(t,n),r}duplicateTile1(e){this.duplicateTile2(e,0)}duplicateTile2(e,t){let n=this._currentTile2(t),r=n.isColorClear()||n.needsColorClear(),o=r;this._tileStack.pushTile2(o);let a=this._currentTile1();if(this._tileStack.pushScissor(e),a.bind(),r)return;let s=n.colorTextureForSampling();s.setFormat(w.TextureFormat.RGBA_NEAREST_CLAMP);let l=n.uvSpaceRect(),d=this.scissorQuad(G.new3(e)),c=new G(l.x()+l.width()*d.x(),l.y()+l.height()*d.y(),l.width()*d.width(),l.height()*d.height()),p=new G(-1+2*d.x(),-1+2*d.y(),2*d.width(),2*d.height());this.drawTexture1(s,c,null,p,0),s.setFormat(w.TextureFormat.RGBA_LINEAR_CLAMP)}maskBackgroundBlurTile(e,t,n){Re.flushBeforeMasks()&&this._context.flush();let r=G.new3(n);w.in_Material.Material_setUniformVec43(this._maskBackgroundBlurTileMaterial,this._materialStrings.GLSLX_NAME_U_QUAD,this.scissorQuad(r)),t.colorTextureForSampling().setFormat(w.TextureFormat.RGBA_NEAREST_CLAMP),e.colorTextureForSampling().setFormat(w.TextureFormat.RGBA_NEAREST_CLAMP),this._maskBackgroundBlurTileMaterial.setUniformSampler(this._materialStrings.GLSLX_NAME_U_TEXTURE0,t.colorTextureForSampling(),0),this._maskBackgroundBlurTileMaterial.setUniformSampler(this._materialStrings.GLSLX_NAME_U_TEXTURE1,e.colorTextureForSampling(),1),w.in_Context.Context_setCopyBlendState(this._context),this.drawToCurrentTile(w.Primitive.TRIANGLE_STRIP,this._maskBackgroundBlurTileMaterial,this._quadArea),this._didDraw=!0,e.colorTextureForSampling().setFormat(w.TextureFormat.RGBA_LINEAR_CLAMP),t.colorTextureForSampling().setFormat(w.TextureFormat.RGBA_LINEAR_CLAMP)}maskInnerShadowTile(e,t,n,r,o){Re.flushBeforeMasks()&&this._context.flush();let a=G.new3(n),s=o?this._maskInnerShadowTileAndFirstHardMaskAlpha:this._maskInnerShadowTileMaterial;w.in_Material.Material_setUniformVec43(s,this._materialStrings.GLSLX_NAME_U_QUAD,this.scissorQuad(a)),w.in_Material.Material_setUniformVec42(s,this._materialStrings.GLSLX_NAME_U_COLOR,E.premultiplied(r)),t.colorTextureForSampling().setFormat(w.TextureFormat.RGBA_NEAREST_CLAMP),e.colorTextureForSampling().setFormat(w.TextureFormat.RGBA_NEAREST_CLAMP),s.setUniformSampler(this._materialStrings.GLSLX_NAME_U_TEXTURE0,t.colorTextureForSampling(),0),s.setUniformSampler(this._materialStrings.GLSLX_NAME_U_TEXTURE1,e.colorTextureForSampling(),1),w.in_Context.Context_setPremultipliedBlendState(this._context),this.drawToCurrentTile(w.Primitive.TRIANGLE_STRIP,s,this._quadArea),e.colorTextureForSampling().setFormat(w.TextureFormat.RGBA_LINEAR_CLAMP),t.colorTextureForSampling().setFormat(w.TextureFormat.RGBA_LINEAR_CLAMP),this._didDraw=!0}maskTile(e,t,n){Re.flushBeforeMasks()&&this._context.flush();let r=G.new3(n);w.in_Material.Material_setUniformVec43(this._maskTileMaterial,this._materialStrings.GLSLX_NAME_U_QUAD,this.scissorQuad(r)),t.colorTextureForSampling().setFormat(w.TextureFormat.RGBA_NEAREST_CLAMP),e.colorTextureForSampling().setFormat(w.TextureFormat.RGBA_NEAREST_CLAMP),this._maskTileMaterial.setUniformSampler(this._materialStrings.GLSLX_NAME_U_TEXTURE0,t.colorTextureForSampling(),0),this._maskTileMaterial.setUniformSampler(this._materialStrings.GLSLX_NAME_U_TEXTURE1,e.colorTextureForSampling(),1),w.in_Context.Context_setPremultipliedBlendState(this._context),this.drawToCurrentTile(w.Primitive.TRIANGLE_STRIP,this._maskTileMaterial,this._quadArea),e.colorTextureForSampling().setFormat(w.TextureFormat.RGBA_LINEAR_CLAMP),t.colorTextureForSampling().setFormat(w.TextureFormat.RGBA_LINEAR_CLAMP),this._didDraw=!0}maskTileLuminance(e,t,n){Re.flushBeforeMasks()&&this._context.flush();let r=G.new3(n);w.in_Material.Material_setUniformVec43(this._maskTileLuminanceMaterial,this._materialStrings.GLSLX_NAME_U_QUAD,this.scissorQuad(r)),t.colorTextureForSampling().setFormat(w.TextureFormat.RGBA_NEAREST_CLAMP),e.colorTextureForSampling().setFormat(w.TextureFormat.RGBA_NEAREST_CLAMP),this._maskTileLuminanceMaterial.setUniformSampler(this._materialStrings.GLSLX_NAME_U_TEXTURE0,t.colorTextureForSampling(),0),this._maskTileLuminanceMaterial.setUniformSampler(this._materialStrings.GLSLX_NAME_U_TEXTURE1,e.colorTextureForSampling(),1),w.in_Context.Context_setPremultipliedBlendState(this._context),this.drawToCurrentTile(w.Primitive.TRIANGLE_STRIP,this._maskTileLuminanceMaterial,this._quadArea),e.colorTextureForSampling().setFormat(w.TextureFormat.RGBA_LINEAR_CLAMP),t.colorTextureForSampling().setFormat(w.TextureFormat.RGBA_LINEAR_CLAMP),this._didDraw=!0}maskTileLuminancePassThrough(e,t,n,r){Re.flushBeforeMasks()&&this._context.flush();let o=G.new3(r);w.in_Material.Material_setUniformVec43(this._maskTileLuminancePassThroughMaterial,this._materialStrings.GLSLX_NAME_U_QUAD,this.scissorQuad(o)),n.colorTextureForSampling().setFormat(w.TextureFormat.RGBA_NEAREST_CLAMP),t.colorTextureForSampling().setFormat(w.TextureFormat.RGBA_NEAREST_CLAMP),this._maskTileLuminancePassThroughMaterial.setUniformSampler(this._materialStrings.GLSLX_NAME_U_TEXTURE0,n.colorTextureForSampling(),0),this._maskTileLuminancePassThroughMaterial.setUniformSampler(this._materialStrings.GLSLX_NAME_U_TEXTURE1,e.colorTextureForSampling(),1),this._maskTileLuminancePassThroughMaterial.setUniformSampler(this._materialStrings.GLSLX_NAME_U_MASK_TEXTURE,t.colorTextureForSampling(),2),w.in_Context.Context_setCopyBlendState(this._context),this.drawToCurrentTile(w.Primitive.TRIANGLE_STRIP,this._maskTileLuminancePassThroughMaterial,this._quadArea),t.colorTextureForSampling().setFormat(w.TextureFormat.RGBA_LINEAR_CLAMP),n.colorTextureForSampling().setFormat(w.TextureFormat.RGBA_LINEAR_CLAMP),this._didDraw=!0}maskTilePassThrough(e,t,n,r){Re.flushBeforeMasks()&&this._context.flush();let o=G.new3(r);w.in_Material.Material_setUniformVec43(this._maskTilePassThroughMaterial,this._materialStrings.GLSLX_NAME_U_QUAD,this.scissorQuad(o)),n.colorTextureForSampling().setFormat(w.TextureFormat.RGBA_NEAREST_CLAMP),t.colorTextureForSampling().setFormat(w.TextureFormat.RGBA_NEAREST_CLAMP),this._maskTilePassThroughMaterial.setUniformSampler(this._materialStrings.GLSLX_NAME_U_TEXTURE0,n.colorTextureForSampling(),0),this._maskTilePassThroughMaterial.setUniformSampler(this._materialStrings.GLSLX_NAME_U_TEXTURE1,e.colorTextureForSampling(),1),this._maskTilePassThroughMaterial.setUniformSampler(this._materialStrings.GLSLX_NAME_U_MASK_TEXTURE,t.colorTextureForSampling(),2),w.in_Context.Context_setCopyBlendState(this._context),this.drawToCurrentTile(w.Primitive.TRIANGLE_STRIP,this._maskTilePassThroughMaterial,this._quadArea),t.colorTextureForSampling().setFormat(w.TextureFormat.RGBA_LINEAR_CLAMP),n.colorTextureForSampling().setFormat(w.TextureFormat.RGBA_LINEAR_CLAMP),this._didDraw=!0}maskKnockoutShadowTile(e,t,n){Re.flushBeforeMasks()&&this._context.flush();let r=G.new3(n);w.in_Material.Material_setUniformVec43(this._maskKnockoutShadowTileMaterial,this._materialStrings.GLSLX_NAME_U_QUAD,this.scissorQuad(r)),t.colorTextureForSampling().setFormat(w.TextureFormat.RGBA_NEAREST_CLAMP),e.colorTextureForSampling().setFormat(w.TextureFormat.RGBA_NEAREST_CLAMP),this._maskKnockoutShadowTileMaterial.setUniformSampler(this._materialStrings.GLSLX_NAME_U_TEXTURE0,t.colorTextureForSampling(),0),this._maskKnockoutShadowTileMaterial.setUniformSampler(this._materialStrings.GLSLX_NAME_U_TEXTURE1,e.colorTextureForSampling(),1),w.in_Context.Context_setPremultipliedBlendState(this._context),this.drawToCurrentTile(w.Primitive.TRIANGLE_STRIP,this._maskKnockoutShadowTileMaterial,this._quadArea),e.colorTextureForSampling().setFormat(w.TextureFormat.RGBA_LINEAR_CLAMP),t.colorTextureForSampling().setFormat(w.TextureFormat.RGBA_LINEAR_CLAMP),this._didDraw=!0}maskKnockoutShadowTilePassThrough(e,t,n,r){Re.flushBeforeMasks()&&this._context.flush();let o=G.new3(r);w.in_Material.Material_setUniformVec43(this._maskKnockoutShadowTilePassThroughMaterial,this._materialStrings.GLSLX_NAME_U_QUAD,this.scissorQuad(o)),n.colorTextureForSampling().setFormat(w.TextureFormat.RGBA_NEAREST_CLAMP),t.colorTextureForSampling().setFormat(w.TextureFormat.RGBA_NEAREST_CLAMP),this._maskKnockoutShadowTilePassThroughMaterial.setUniformSampler(this._materialStrings.GLSLX_NAME_U_TEXTURE0,n.colorTextureForSampling(),0),this._maskKnockoutShadowTilePassThroughMaterial.setUniformSampler(this._materialStrings.GLSLX_NAME_U_TEXTURE1,e.colorTextureForSampling(),1),this._maskKnockoutShadowTilePassThroughMaterial.setUniformSampler(this._materialStrings.GLSLX_NAME_U_MASK_TEXTURE,t.colorTextureForSampling(),2),w.in_Context.Context_setCopyBlendState(this._context),this.drawToCurrentTile(w.Primitive.TRIANGLE_STRIP,this._maskKnockoutShadowTilePassThroughMaterial,this._quadArea),t.colorTextureForSampling().setFormat(w.TextureFormat.RGBA_LINEAR_CLAMP),n.colorTextureForSampling().setFormat(w.TextureFormat.RGBA_LINEAR_CLAMP),this._didDraw=!0}downsampleSuperSSAATile(e){let t=this.downscaleRectForSSAA(w.FrozenScissors.last(e.scissors()).clone());t.expand1(1),t.round(),this._tileStack.pushScissor(t);let n=null;switch(cr.SUPERSAMPLE_COUNT()){case 4:{n=this._superSSAA4x4DownsampleMaterial;break}case 2:{n=this._blendTextureMaterial;break}default:throw new Error(`Unrecognized SUPERSAMPLE_COUNT (${cr.SUPERSAMPLE_COUNT()}) when downsampling`)}n.setUniformFloat(this._materialStrings.GLSLX_NAME_U_OPACITY,1),n.setUniformSampler(this._materialStrings.GLSLX_NAME_U_TEXTURE0,e.colorTextureForSampling(),0),this.drawToCurrentTile(w.Primitive.TRIANGLE_STRIP,n,this._quadArea),this._tileStack.popScissorFromCurrentTile()}drawTextureRegion1(e,t,n){this.drawTextureRegion2(e,t,vt.FrozenAffineTransform_IDENTITY,n,1)}drawTextureRegion2(e,t,n,r,o){let a=e.uvSpaceRect,s=null;if(e.texture.format().minFilter==w.PixelFilter.LINEAR||e.texture.format().magFilter==w.PixelFilter.LINEAR){s=a.clone();let l=1/e.texture.width();s.contract(l/2)}this.drawTexture2(e.texture,e.uvSpaceRect,s,t,n,r,o)}drawTexture1(e,t,n,r,o){this.drawTexture2(e,t,n,r,vt.FrozenAffineTransform_IDENTITY,o,1)}drawTexture2(e,t,n,r,o,a,s){this._setupDrawTextureState(e,t,n,r,o,a,s),this.drawToCurrentTile(w.Primitive.TRIANGLE_STRIP,this._drawTextureMaterial,this._quadArea),this._didDraw=!0}drawTextureToCurrentFramebuffer(e,t,n,r,o,a,s){this._setupDrawTextureState(e,t,n,r,o,a,s),this._context.draw(w.Primitive.TRIANGLE_STRIP,this._drawTextureMaterial,this._quadArea)}_setupDrawTextureState(e,t,n,r,o,a,s){switch(a){case 0:{w.in_Context.Context_setCopyBlendState(this._context);break}case 1:{w.in_Context.Context_setPremultipliedBlendState(this._context);break}}w.in_Material.Material_setUniformVec43(this._drawTextureMaterial,this._materialStrings.GLSLX_NAME_U_UV_SPACE_CLAMPING_RECT,n??t),w.in_Material.Material_setUniformVec43(this._drawTextureMaterial,this._materialStrings.GLSLX_NAME_U_UV_SPACE_SOURCE_RECT,t),w.in_Material.Material_setUniformMat32(this._drawTextureMaterial,this._materialStrings.GLSLX_NAME_U_TO_CLIP_SPACE_TRANSFORM,o),w.in_Material.Material_setUniformVec43(this._drawTextureMaterial,this._materialStrings.GLSLX_NAME_U_DESTINATION_RECT,r),this._drawTextureMaterial.setUniformFloat(this._materialStrings.GLSLX_NAME_U_OPACITY,s),this._drawTextureMaterial.setUniformSampler(this._materialStrings.GLSLX_NAME_U_TEXTURE0,e,0)}constructor(e,t){this._canvas=null,this._backgroundEnabled=!0,this._didDraw=!1,this._includesBackgroundColor=!1,this._boundsCache=null,this._canvasSpaceTileBounds=null,this._neededImagesOrNull=null,this._context=null,this._quadArea=null,this._bufferPool=null,this._transparentClearTexture=null,this._tileStack=null,this._ssaaState=new Wg,this._downsampleNeedsBlend=!1,this._shouldDisableAllAntialiasing=!1,this._clampedBlurMaterial=null,this._unclampedBlurMaterial=null,this._rectangleBlurMaterial=null,this._roundedRectangleBlurMaterial=null,this._upscaleTileMaterial=null,this._downscaleTileMaterial=null,this._hardMaskWithColorAndDownscaleTileMaterial=null,this._blendTextureMaterial=null,this._lerpTileMaterial=null,this._blendTileSimpleMaterial=null,this._blendTileCustomMaterial=null,this._maskInnerShadowTileMaterial=null,this._maskInnerShadowTileAndFirstHardMaskAlpha=null,this._maskBackgroundBlurTileMaterial=null,this._maskTileMaterial=null,this._maskTileLuminanceMaterial=null,this._maskTileLuminancePassThroughMaterial=null,this._maskTilePassThroughMaterial=null,this._maskKnockoutShadowTileMaterial=null,this._maskKnockoutShadowTilePassThroughMaterial=null,this._hardMaskTileWithColorMaterial=null,this._drawTextureMaterial=null,this._clearOnWindowsMaterial=null,this._superSSAA4x4DownsampleMaterial=null,this._requestImage=null,this._pathRasterizer=null,this._layerByLayerRendering=new up,this._context=e,this._bufferPool=t,this._materialStrings=Fn.instance(),this._quadArea=this._bufferPool.allocate(w.VertexFormat.getPositionF2CoordF3(),new Uint8Array(new Float32Array([0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,1,1,0,0,0]).buffer)),this._transparentClearTexture=e.createTexture2(w.TextureFormat.RGBA_LINEAR_CLAMP,1,1,new Uint8Array([0,0,0,0]),"Transparent clear texture"),this._tileStack=new i.TileStack(e,(r,o)=>{this.clear(r,o)},this._transparentClearTexture),this._pathRasterizer=new cr(this,this._context,this._bufferPool);let n=this._context.graphicsCardName();Re.setFlushBeforeMasks(n.indexOf("NVIDIA")!=-1&&n.indexOf("Direct3D11")!=-1||Y.getFeatureFlags().flush_before_masks),this._clampedBlurMaterial=this._context.createMaterial("clampedBlur",w.VertexFormat.getPositionF2CoordF3(),this._materialStrings.GLSLX_SOURCE_TILE_VERTEX,this._materialStrings.GLSLX_SOURCE_CLAMPED_BLUR_TILE_FRAGMENT),this._unclampedBlurMaterial=this._context.createMaterial("unclampedBlur",w.VertexFormat.getPositionF2CoordF3(),this._materialStrings.GLSLX_SOURCE_TILE_VERTEX,this._materialStrings.GLSLX_SOURCE_UNCLAMPED_BLUR_TILE_FRAGMENT),this._rectangleBlurMaterial=this._context.createMaterial("rectangleBlur",w.VertexFormat.getPositionF2CoordF3(),this._materialStrings.GLSLX_SOURCE_RECTANGLE_BLUR_VERTEX,this._materialStrings.GLSLX_SOURCE_RECTANGLE_BLUR_FRAGMENT),this._roundedRectangleBlurMaterial=this._context.createMaterial("roundedRectangleBlur",w.VertexFormat.getPositionF2CoordF3(),this._materialStrings.GLSLX_SOURCE_ROUNDED_RECTANGLE_BLUR_VERTEX,this._materialStrings.GLSLX_SOURCE_ROUNDED_RECTANGLE_BLUR_FRAGMENT),this._upscaleTileMaterial=this._context.createMaterial("upscaleTile",w.VertexFormat.getPositionF2CoordF3(),this._materialStrings.GLSLX_SOURCE_UPSAMPLE_TILE_VERTEX,this._materialStrings.GLSLX_SOURCE_UPSAMPLE_TILE_FRAGMENT),this._downscaleTileMaterial=this._context.createMaterial("downscaleTile",w.VertexFormat.getPositionF2CoordF3(),this._materialStrings.GLSLX_SOURCE_DOWNSAMPLE_TILE_VERTEX,this._materialStrings.GLSLX_SOURCE_DOWNSAMPLE_TILE_FRAGMENT),this._hardMaskWithColorAndDownscaleTileMaterial=this._context.createMaterial("hardMaskWithColorAndDownscaleTile",w.VertexFormat.getPositionF2CoordF3(),this._materialStrings.GLSLX_SOURCE_DOWNSAMPLE_TILE_VERTEX,this._materialStrings.GLSLX_SOURCE_HARD_MASK_WITH_COLOR_AND_DOWNSAMPLE_TILE_FRAGMENT),this._blendTextureMaterial=this._context.createMaterial("blendTexture",w.VertexFormat.getPositionF2CoordF3(),this._materialStrings.GLSLX_SOURCE_CLIP_SPACE_QUAD_VERTEX,this._materialStrings.GLSLX_SOURCE_BLEND_TEXTURE_FRAGMENT),this._lerpTileMaterial=this._context.createMaterial("lerpTexture",w.VertexFormat.getPositionF2CoordF3(),this._materialStrings.GLSLX_SOURCE_CLIP_SPACE_QUAD_VERTEX,this._materialStrings.GLSLX_SOURCE_LERP_TILE_FRAGMENT),this._clearOnWindowsMaterial=this._context.createMaterial("clearOnWindows",w.VertexFormat.getPositionF2CoordF3(),this._materialStrings.GLSLX_SOURCE_CLIP_SPACE_QUAD_VERTEX,this._materialStrings.GLSLX_SOURCE_SOLID_COLOR_PAINT_FRAGMENT),this._blendTileSimpleMaterial=this._context.createMaterial("blendTileSimple",w.VertexFormat.getPositionF2CoordF3(),this._materialStrings.GLSLX_SOURCE_TILE_VERTEX,this._materialStrings.GLSLX_SOURCE_BLEND_TEXTURE_FRAGMENT),this._blendTileCustomMaterial=this._context.createMaterial("blendTileCustom",w.VertexFormat.getPositionF2CoordF3(),this._materialStrings.GLSLX_SOURCE_TILE_VERTEX,this._materialStrings.GLSLX_SOURCE_BLEND_MODE_FRAGMENT),this._maskInnerShadowTileMaterial=this._context.createMaterial("maskInnerShadowTile",w.VertexFormat.getPositionF2CoordF3(),this._materialStrings.GLSLX_SOURCE_TILE_VERTEX,this._materialStrings.GLSLX_SOURCE_MASK_INNER_SHADOW_TILE_FRAGMENT),this._maskInnerShadowTileAndFirstHardMaskAlpha=this._context.createMaterial("maskInnerShadowTileAndFirstHardMaskAlpha",w.VertexFormat.getPositionF2CoordF3(),this._materialStrings.GLSLX_SOURCE_TILE_VERTEX,this._materialStrings.GLSLX_SOURCE_MASK_INNER_SHADOW_TILE_AND_FIRST_HARD_MASK_ALPHA_FRAGMENT),this._maskBackgroundBlurTileMaterial=this._context.createMaterial("maskBackgroundBlurTile",w.VertexFormat.getPositionF2CoordF3(),this._materialStrings.GLSLX_SOURCE_TILE_VERTEX,this._materialStrings.GLSLX_SOURCE_MASK_BACKGROUND_BLUR_TILE_FRAGMENT),this._maskTileMaterial=this._context.createMaterial("maskTile",w.VertexFormat.getPositionF2CoordF3(),this._materialStrings.GLSLX_SOURCE_TILE_VERTEX,this._materialStrings.GLSLX_SOURCE_MASK_TILE_FRAGMENT),this._maskTileLuminanceMaterial=this._context.createMaterial("maskTileLuminance",w.VertexFormat.getPositionF2CoordF3(),this._materialStrings.GLSLX_SOURCE_TILE_VERTEX,this._materialStrings.GLSLX_SOURCE_MASK_TILE_LUMINANCE_FRAGMENT),this._maskTileLuminancePassThroughMaterial=this._context.createMaterial("maskTileLuminancePassThrough",w.VertexFormat.getPositionF2CoordF3(),this._materialStrings.GLSLX_SOURCE_TILE_VERTEX,this._materialStrings.GLSLX_SOURCE_MASK_TILE_LUMINANCE_PASS_THROUGH_FRAGMENT),this._maskTilePassThroughMaterial=this._context.createMaterial("maskTilePassThrough",w.VertexFormat.getPositionF2CoordF3(),this._materialStrings.GLSLX_SOURCE_TILE_VERTEX,this._materialStrings.GLSLX_SOURCE_MASK_TILE_PASS_THROUGH_FRAGMENT),this._maskKnockoutShadowTileMaterial=this._context.createMaterial("maskKnockoutShadowTile",w.VertexFormat.getPositionF2CoordF3(),this._materialStrings.GLSLX_SOURCE_TILE_VERTEX,this._materialStrings.GLSLX_SOURCE_MASK_KNOCKOUT_SHADOW_TILE_FRAGMENT),this._maskKnockoutShadowTilePassThroughMaterial=this._context.createMaterial("maskKnockoutShadowTile",w.VertexFormat.getPositionF2CoordF3(),this._materialStrings.GLSLX_SOURCE_TILE_VERTEX,this._materialStrings.GLSLX_SOURCE_MASK_KNOCKOUT_SHADOW_TILE_PASS_THROUGH_FRAGMENT),this._hardMaskTileWithColorMaterial=this._context.createMaterial("hardMaskWithColor",w.VertexFormat.getPositionF2CoordF3(),this._materialStrings.GLSLX_SOURCE_TILE_VERTEX,this._materialStrings.GLSLX_SOURCE_HARD_MASK_TILE_WITH_COLOR_FRAGMENT),this._drawTextureMaterial=this._context.createMaterial("drawTexture",w.VertexFormat.getPositionF2CoordF3(),this._materialStrings.GLSLX_SOURCE_DRAW_TEXTURE_VERTEX,this._materialStrings.GLSLX_SOURCE_DRAW_TEXTURE_FRAGMENT),this._superSSAA4x4DownsampleMaterial=this._context.createMaterial("superSSAA4x4Downsample",w.VertexFormat.getPositionF2CoordF3(),this._materialStrings.GLSLX_SOURCE_CLIP_SPACE_QUAD_VERTEX,this._materialStrings.GLSLX_SOURCE_SUPER_SSAA4X4_DOWNSAMPLE_TEXTURE_FRAGMENT)}renderLayerByLayerActivate(e){this._layerByLayerRendering.activate(e)}renderLayerByLayerDeactivate(){this._layerByLayerRendering.deactivate()}finishLayerByLayerDrawToScreen(){this._layerByLayerRendering.finishLayerByLayerDrawToScreen()}isLayerByLayerRenderingEnabled(){return this._layerByLayerRendering.isEnabled()}treeToRender(e){return this._layerByLayerRendering.treeToRender(e)}renderLayerByLayerPlay(){this._layerByLayerRendering.play()}renderLayerByLayerPause(){this._layerByLayerRendering.pause()}renderLayerByLayerForward(){this._layerByLayerRendering.forward()}renderLayerByLayerBackward(){this._layerByLayerRendering.backward()}renderLayerByLayerRewind(){this._layerByLayerRendering.rewind()}renderLayerByLayerIncreaseSpeed(){this._layerByLayerRendering.increaseSpeed()}renderLayerByLayerDecreaseSpeed(){this._layerByLayerRendering.decreaseSpeed()}};(n=>{class i{constructor(o,a,s,l,d,c,p,u,h,f){this.renderTree=o,this.isRenderingWholeCanvas=a,this.backgroundClearColor=s,this.shouldCollectNeededImages=l,this.boundsCache=d,this.requestImage=c,this.shouldDisableAllAntialiasing=p,this.shouldRenderDirectlyToOutputTexture=u,this.outputTextureNeedsClear=h,this.useLargeTilesForDrawToScreen=f}}n.Options=i;class e{constructor(o,a,s){this._context=null,this._clear=null,this._transparentClearTexture=null,this._tilePools=new Map([[yn.TILE_SIZE,[]],[cr.SSAA_SIZE(),[]]]),this._stack=[],this._tileSizeState=n.TileStack.TileSizeState.REGULAR,this._liveTileCount=new Map([[yn.TILE_SIZE,0],[cr.SSAA_SIZE(),0]]),this._sharedStencilTexture=null,this._sharedSSAAStencilTexture=null,this._context=o,this._clear=a,this._transparentClearTexture=s}setSSAARenderState(){this._tileSizeState=n.TileStack.TileSizeState.SUPERSAMPLING}unsetSSAARenderState(){this._tileSizeState=n.TileStack.TileSizeState.REGULAR}setDrawToScreenLargeTileState(){this._tileSizeState=n.TileStack.TileSizeState.DRAW_TO_SCREEN_LARGE_TILES}unsetDrawToScreenLargeTileState(){this._tileSizeState=n.TileStack.TileSizeState.REGULAR}isEmpty(){return this._stack.length==0}count(){return this._stack.length}get(o){return this._stack[o]}last(){return this._stack.length==0?null:ue.List_last(this._stack)}assertPoolAfterRender(){}popScissorFromCurrentTile(){ue.List_last(this._stack).popScissor()}takeScissorFromCurrentTile(){return ue.List_last(this._stack).takeScissor()}freeTileToPool(o){o.clearScissors(),o.setIsColorClear(!1),o.setNeedsColorClear(!0),o.setNeedsDepthStencilClear(!0),o.tileSize()==cr.SSAA_SIZE()?this._tilePools.get(cr.SSAA_SIZE()).push(o):this._tilePools.get(yn.TILE_SIZE).push(o)}pushScissor(o){ue.List_last(this._stack).pushScissor2(o.clone())}pushTileWithScissors1(o){this.pushTileWithScissors2(o,!0)}pushTileWithScissors2(o,a){this.pushTile2(a),this.pushScissor(o)}pushTile1(){this.pushTile2(!0)}pushTile2(o){let a=this._allocateTileFromPool();this._stack.push(a),a.bind(),o||a.setNeedsColorClear(!1),a.backingColorTexture().hasContentBeenInitialized()||a.setNeedsColorClear(!0),a.backingDepthStencilTexture()!=null&&!a.backingDepthStencilTexture().hasContentBeenInitialized()&&a.setNeedsDepthStencilClear(!0)}pushTileAndClearToColor(o){this.pushTile1(),o!=E.TRANSPARENT&&ue.List_last(this._stack).clearToColor(o)}pushTileBackedByExistingFramebuffer(o,a,s){let l=s.outputTextureNeedsClear,d=s.useLargeTilesForDrawToScreen?cr.SSAA_SIZE():yn.TILE_SIZE,c=!l,p=new n.TileStackTile(1,d,this._context,o,a,this._clear,c,this._transparentClearTexture);this._stack.push(p),p.bind(),p.setNeedsColorClear(l),p.setNeedsDepthStencilClear(l)}pushTileBackedByExistingFramebufferAndClearToColor(o,a,s,l){this.pushTileBackedByExistingFramebuffer(o,a,s),l!=E.TRANSPARENT&&ue.List_last(this._stack).clearToColor(l)}popTile(){let o=this._stack.pop(),a=this.last();return a!=null?a.bind():this._context.setFramebuffer(null),o}totalVRAM(){let o=0;this._sharedStencilTexture!=null&&(o=o+w.in_Texture.Texture_totalVRAM(this._sharedStencilTexture));for(let a of this._tilePools.get(yn.TILE_SIZE))o=o+w.in_Texture.Texture_totalVRAM(a.backingColorTexture());for(let a of this._tilePools.get(cr.SSAA_SIZE()))o=o+w.in_Texture.Texture_totalVRAM(a.backingColorTexture());for(let a of this._stack)o=o+w.in_Texture.Texture_totalVRAM(a.backingColorTexture());return o}_pool(){return this._tileSizeState==n.TileStack.TileSizeState.REGULAR?this._tilePools.get(yn.TILE_SIZE):this._tilePools.get(cr.SSAA_SIZE())}_size(){return this._tileSizeState==n.TileStack.TileSizeState.REGULAR?yn.TILE_SIZE:cr.SSAA_SIZE()}_purpose(){return this._tileSizeState==n.TileStack.TileSizeState.REGULAR?"TileStack":this._tileSizeState==n.TileStack.TileSizeState.SUPERSAMPLING?"SSAATileStack":"DrawToScreenLargeTiles"}_sizeState(){return this._tileSizeState}_allocateTileFromPool(){let o=this._pool(),a=this._size(),s=this._purpose(),l=this._sizeState(),d=null;if(o!=null&&o.length!=0)d=o.pop();else{this._liveTileCount.set(a,this._liveTileCount.get(a)+1);let c=null;l==n.TileStack.TileSizeState.REGULAR?(this._sharedStencilTexture==null&&(this._sharedStencilTexture=w.in_Context.Context_createTexture1(this._context,w.TextureFormat.STENCIL,a,a,s)),c=this._sharedStencilTexture):(l==n.TileStack.TileSizeState.SUPERSAMPLING||l==n.TileStack.TileSizeState.DRAW_TO_SCREEN_LARGE_TILES)&&(this._sharedSSAAStencilTexture==null&&(this._sharedSSAAStencilTexture=w.in_Context.Context_createTexture1(this._context,w.TextureFormat.STENCIL,a,a,s)),c=this._sharedSSAAStencilTexture),d=new n.TileStackTile(0,a,s,c,this._context,this._clear,this._transparentClearTexture)}return d}_isAllocatedUnusedTile(o){return o!=null&&o!=this.last()&&this._stack.indexOf(o)==-1&&this._tilePools.get(yn.TILE_SIZE).indexOf(o)==-1&&this._tilePools.get(cr.SSAA_SIZE()).indexOf(o)==-1}}n.TileStack=e,(a=>{let r;(c=>(c[c.REGULAR=0]="REGULAR",c[c.SUPERSAMPLING=1]="SUPERSAMPLING",c[c.DRAW_TO_SCREEN_LARGE_TILES=2]="DRAW_TO_SCREEN_LARGE_TILES"))(r=a.TileSizeState||(a.TileSizeState={}));let o;(l=>{function s(d){return n.TileStack.TileSizeState[d]}l.TileSizeState_toString=s})(o=a.in_TileSizeState||(a.in_TileSizeState={}))})(e=n.TileStack||(n.TileStack={}));class t{constructor(){if(arguments[0]==0){let[,o,a,s,l,d,c]=arguments;this._context=null,this._clear=null,this._framebuffer=null,this._isBackedBySingleTileTexture=!1,this._transparentClearTexture=null,this._isColorClear=!1,this._needsColorClear=!1,this._needsDepthStencilClear=!1,this._context=l,this._clear=d,this._framebuffer=this._context.createFramebuffer(w.in_Context.Context_createTexture1(this._context,w.TextureFormat.RGBA_LINEAR_CLAMP,o,o,a),s,a),this._framebuffer.setViewport(0,0,o,o),this._isBackedBySingleTileTexture=!0,this._transparentClearTexture=c,this._isColorClear=!0}else if(arguments[0]==1){let[o,a,s,l,d,c,p,u]=arguments;this._context=null,this._clear=null,this._framebuffer=null,this._isBackedBySingleTileTexture=!1,this._transparentClearTexture=null,this._isColorClear=!1,this._needsColorClear=!1,this._needsDepthStencilClear=!1,this._context=s,this._clear=c,this._framebuffer=l,this._framebuffer.setViewport(d.x()|0,d.y()|0,a,a),this._isBackedBySingleTileTexture=!1,this._transparentClearTexture=u,this._isColorClear=p}}uvSpaceRect(){if(this._isBackedBySingleTileTexture)return G.UNIT;{let o=this._framebuffer.viewport(),a=this._framebuffer.colorTexture();return new G(o.x()/a.width(),o.y()/a.height(),o.width()/a.width(),o.height()/a.height())}}tileSize(){return this._framebuffer.viewport().width()|0}colorTextureForSampling(){return this._isColorClear||this._needsColorClear?this._transparentClearTexture:this._framebuffer.colorTexture()}backingColorTexture(){return this._framebuffer.colorTexture()}backingDepthStencilTexture(){return this._framebuffer.depthStencilTexture()}context(){return this._context}framebuffer(){return this._framebuffer}isBackedBySingleTileTexture(){return this._isBackedBySingleTileTexture}deleteTexture(){this._framebuffer.deleteTexture()}popScissor(){this._framebuffer.popScissor()}takeScissor(){let o=this._framebuffer.takeScissor();if(this._isBackedBySingleTileTexture)return o;let a=this._framebuffer.viewport();return o.setX(o.x()-a.x()),o.setY(o.y()-a.y()),o}scissors(){let o=this._framebuffer.scissors();if(this._isBackedBySingleTileTexture)return o;let a=[],s=this._framebuffer.viewport();for(let l=0,d=w.FrozenScissors.count(o);l<d;l=l+1){let c=G.new3(w.FrozenScissors.get(o,l));c.setX(c.x()-s.x()),c.setY(c.y()-s.y()),a.push(c)}return a}pushScissor1(o,a,s,l){if(this._isBackedBySingleTileTexture)this._framebuffer.pushScissor1(o,a,s,l);else{let d=this._framebuffer.viewport();this._framebuffer.pushScissor1((d.x()|0)+o,(d.y()|0)+a,s,l)}}pushScissor2(o){this.pushScissor1(o.x()|0,o.y()|0,o.width()|0,o.height()|0)}clearScissors(){this._framebuffer.clearScissors()}updateScissor(){this._framebuffer.updateScissor()}bind(){this._context.setFramebuffer(this._framebuffer)}clearToColor(o){if(this.needsColorClear()||this.needsDepthStencilClear()){let s=this.needsColorClear()&&this.needsDepthStencilClear()?w.Clear.ALL:this.needsColorClear()?w.Clear.COLOR:w.Clear.DEPTH_STENCIL;this.doDeferredClear(s)}if(o==E.TRANSPARENT&&this.isColorClear())return;let a=this._framebuffer.takeAllScissors();if(!this._isBackedBySingleTileTexture){let s=this._framebuffer.viewport();this._framebuffer.pushScissor1(s.x()|0,s.y()|0,s.width()|0,s.height()|0)}this._clear(o,this._framebuffer),this._isBackedBySingleTileTexture||this._framebuffer.popScissor(),this._framebuffer.replaceAllScissors(a),this._isColorClear=o==E.TRANSPARENT}doDeferredClear(o){let a=this._framebuffer.takeAllScissors();if(!this._isBackedBySingleTileTexture){let s=this._framebuffer.viewport();this._framebuffer.pushScissor1(s.x()|0,s.y()|0,s.width()|0,s.height()|0)}w.in_Context.Context_clear1(this._context,o),this._isBackedBySingleTileTexture||this._framebuffer.popScissor(),this._framebuffer.replaceAllScissors(a),(o==w.Clear.ALL||o==w.Clear.COLOR)&&(this._needsColorClear=!1,this._isColorClear=!0),(o==w.Clear.ALL||o==w.Clear.DEPTH_STENCIL)&&(this._needsDepthStencilClear=!1)}setNeedsColorClear(o){this._needsColorClear=o}needsColorClear(){return this._needsColorClear}setNeedsDepthStencilClear(o){this._needsDepthStencilClear=o}needsDepthStencilClear(){return this._needsDepthStencilClear}setIsColorClear(o){this._isColorClear=o}isColorClear(){return this._isColorClear}}n.TileStackTile=t})(Ri||(Ri={}));var zg=class{constructor(e,t,n){this.node=e,this.transform=t,this.backgroundColor=n}},Qg=(t=>(t[t.REPLACE=0]="REPLACE",t[t.BLEND=1]="BLEND",t))(Qg||{}),Gg=(t=>(t[t.PATHS_ONLY=0]="PATHS_ONLY",t[t.GROUP=1]="GROUP",t))(Gg||{}),Wg=class{constructor(){this.level=0,this.mode=0}},hb;(e=>{function i(t){return Qc[t]}e.ImagePurpose_toString=i})(hb||(hb={}));var mb;(e=>{function i(t){return _b[t]}e.DrawTileWorkStatus_toString=i})(mb||(mb={}));var gb;(e=>{function i(t){return Qg[t]}e.CompositeMode_toString=i})(gb||(gb={}));var fb;(e=>{function i(t){return Gg[t]}e.SupersampleMode_toString=i})(fb||(fb={}));function pp(i,e,t){return t==null?E.BLACK:i!=null?e==4?t.computedBackgroundColor():Y.prototypeBackgroundColorOverride!=null&&Y.prototypeBackgroundColorOverride.value!=E.TRANSPARENT?E.rgbaToRgb(Y.prototypeBackgroundColorOverride.value):t.prototypeBackgroundColor()!=E.TRANSPARENT?E.rgbaToRgb(t.prototypeBackgroundColor()):E.BLACK:t.computedBackgroundColor()}function n1(i){switch(i){case"PASS_THROUGH":case"NORMAL":case"DARKEN":case"MULTIPLY":case"LINEAR_BURN":case"COLOR_BURN":case"LIGHTEN":case"SCREEN":case"LINEAR_DODGE":case"COLOR_DODGE":case"OVERLAY":case"SOFT_LIGHT":case"HARD_LIGHT":case"DIFFERENCE":case"EXCLUSION":case"HUE":case"SATURATION":case"COLOR":case"LUMINOSITY":return!0;default:break}return!1}var r1=new Map([["PASS_THROUGH",0],["NORMAL",1],["DARKEN",2],["MULTIPLY",3],["LINEAR_BURN",4],["COLOR_BURN",5],["LIGHTEN",6],["SCREEN",7],["LINEAR_DODGE",8],["COLOR_DODGE",9],["OVERLAY",10],["SOFT_LIGHT",11],["HARD_LIGHT",12],["DIFFERENCE",13],["EXCLUSION",14],["HUE",15],["SATURATION",16],["COLOR",17],["LUMINOSITY",18]]),lp=new Map([["SOLID",0],["GRADIENT_LINEAR",1],["GRADIENT_RADIAL",2],["GRADIENT_ANGULAR",3],["GRADIENT_DIAMOND",4],["IMAGE",5],["EMOJI",6],["VIDEO",7]]);var gl=(o=>(o[o.OTHER=0]="OTHER",o[o.PRERENDER_FULLSIZE=1]="PRERENDER_FULLSIZE",o[o.PRERENDER_THUMB=2]="PRERENDER_THUMB",o[o.ON_SCREEN_FULLSIZE=3]="ON_SCREEN_FULLSIZE",o[o.ON_SCREEN_THUMB=4]="ON_SCREEN_THUMB",o))(gl||{}),ti=class ti{compare(e){let t=ht.int_compare(this.type,e.type);return t!=0?t:ht.int_compare(this.generation,e.generation)}toString(){return`${gl[this.type]}:${this.generation}`}static advanceGeneration(){ti._generation=ti._generation+1}static forType(e){return new ti(e,ti._generation)}static forOnScreenPurpose(e){let t=Fa.ImagePriorityType_forOnScreenPurpose(e);return ti.forType(t)}static forPrerenderPurpose(e){let t=Fa.ImagePriorityType_forPrerenderPurpose(e);return ti.forType(t)}static max(e,t){return e.compare(t)>0?e:t}constructor(e,t){this.type=e,this.generation=t}};ti.OTHER=new ti(0,0),ti._generation=0;var yr=ti,hp=class{insertOrUpdate(e,t){let n=this._queue.getPriority(e);(n==null||t.compare(n.value)>0)&&this._queue.insertOrUpdate(e,t)}peek(){return this._queue.peek()}getPriority(e){let t=this._queue.getPriority(e);return t!=null?new _e(t.value):null}maxPriority(){return this._queue.count()==0?null:new _e(this._queue.maxPriority())}remove(e){this._queue.remove(e)}clear(){this._queue=new ea((e,t)=>e.compare(t))}allImages(){return this._queue.allValues()}count(){return this._queue.count()}isEmpty(){return this.count()==0}takeFirst(){return this._queue.pop()}constructor(){this._queue=new ea((e,t)=>e.compare(t))}},Fa;(o=>{function i(a){return a==3||a==4}o.ImagePriorityType_isOnScreen=i;function e(a){return a==1||a==2}o.ImagePriorityType_isPrerender=e;function t(a){switch(a){case 0:return 3;case 1:case 2:return 4}throw new Error("Unhandled case")}o.ImagePriorityType_forOnScreenPurpose=t;function n(a){switch(a){case 0:return 1;case 1:case 2:return 2}throw new Error("Unhandled case")}o.ImagePriorityType_forPrerenderPurpose=n;function r(a){return gl[a]}o.ImagePriorityType_toString=r})(Fa||(Fa={}));var qc=class i{constructor(e,t,n,r,o,a,s){this.id=null,this.overlayDataModelId=null,this.openingHotspotStablePath=null,this.openingInteractionId=null,this.openingTransition=null,this.oldOverlayDerivedModes=null,this.newOverlayExplicitModes=null,this.id=e,this.overlayDataModelId=t,this.openingHotspotStablePath=n,this.openingInteractionId=r,this.openingTransition=o,this.oldOverlayDerivedModes=a,this.newOverlayExplicitModes=s}cloneWithId(e,t){return new i(e,this.overlayDataModelId,this.openingHotspotStablePath,this.openingInteractionId,this.openingTransition,t)}openingTransitionType(){return this.openingTransition.transitionType}},fl=class{constructor(e,t,n,r,o,a,s,l){this.overlayId=e,this.overlayNode=t,this.bounds=n,this.baseTlfCursor=r,this.backgroundAppearance=o,this.backgroundTransitionProgress=a,this.transform=s,this.animationTransform=l}},ta=class{constructor(){if(arguments.length==0)this._multiOverlayMap=null,this._hasTransitionComputed=!1,this._hasTransition=!1,this._multiOverlayMap=new Map;else if(arguments.length==1){let e=arguments[0];this._multiOverlayMap=null,this._hasTransitionComputed=!1,this._hasTransition=!1,this._multiOverlayMap=e}}hasTransition(){if(this._hasTransitionComputed)return this._hasTransition;for(let e of Array.from(this._multiOverlayMap.keys()))if(this._multiOverlayMap.get(e).backgroundTransitionProgress!=null||this._multiOverlayMap.get(e).transform!=null||this._multiOverlayMap.get(e).animationTransform!=null){this._hasTransition=!0,this._hasTransitionComputed=!0;break}return this._hasTransition}count(){return this._multiOverlayMap.size}addEntry(e,t){this._multiOverlayMap.set(e,t),this._hasTransitionComputed=!1}removeEntry(e){this._multiOverlayMap.delete(e),this._hasTransitionComputed=!1}get1(e){return Be.StringMap_get(this._multiOverlayMap,e,null)}get2(e){return Be.StringMap_get(this._multiOverlayMap,e,null)}keys(){return Array.from(this._multiOverlayMap.keys())}overlayCacheKey(){let e=[];for(let t of this.keys())e.push(t);return new Mt(e)}},Yc=class{id(){return this._data.id}overlayDataModelId(){return this._data.overlayDataModelId}openingHotspotStablePath(){return this._data.openingHotspotStablePath}previousOverlay(){return this._previousOverlay}openingTransitionType(){return this._data.openingTransitionType()}node(){return this.scene.findNode1(this.id())}backgroundInteraction(){let e=this.scene.findNode1(this._data.overlayDataModelId);return e==null?"NONE":e.overlayBackgroundInteraction()}backgroundAppearance(){let e=this.scene.findNode1(this._data.overlayDataModelId);return e==null?new ni:e.overlayBackgroundAppearance()}positionType(){let e=this.scene.findNode1(this._data.overlayDataModelId);return e==null?"CENTER":e.overlayPositionType()}relativePosition(){return this._data.openingTransition.overlayRelativePosition}renderedOrigin(e){let t=this.node();if(t==null)return Ie.FrozenVector_new1();let n=null;if(this.positionType()=="MANUAL"){if(this._stackPosition>0){let o=this.scene.findNode1(this._previousOverlay.id()).canvasSpaceBoundingBox(),a=this._previousOverlay.renderedOrigin(e),s=this.scene.findNode3(this.openingHotspotStablePath());s!=null&&(n=s.canvasSpaceScrolledBounds(1).topLeft().add1(a.subtract1(o.topLeft())))}if(n==null){let r=this.scene.findNode3(this.openingHotspotStablePath());r!=null&&(n=r.canvasSpaceScrolledBounds(1).topLeft())}if(n==null)return Ie.FrozenVector_new1()}return Xc.BoundOverlay_computeOrigin(t,e,this._data.openingTransition,n,this.positionType())}renderedBounds(e){let t=this.scene.findNode1(this._data.id);if(t==null)return Kn.FrozenRect_new1();let n=t.canvasSpaceBoundingBox().size(),r=this.renderedOrigin(e);return Kn.FrozenRect_new4(r.x(),r.y(),n.x(),n.y())}deltaFromRenderedPositionToCanvasSpacePosition(e){let t=this.scene.findNode1(this._data.id);return t==null?new I(0,0):this.renderedOrigin(e).subtract1(t.canvasSpaceBoundingBox().topLeft())}baseTlfSpaceToOverlaySpace1(e,t){let n=this.scene.findNode1(this._data.id);if(n==null||t==null||e==null)return Ie.FrozenVector_ZERO;let r=this.renderedOrigin(e),o=n.canvasSpaceBoundingBox().topLeft();return t.add1(o).subtract1(r)}baseTlfSpaceToOverlaySpace2(e,t){return G.new4(this.baseTlfSpaceToOverlaySpace1(e,t.topLeft()),t.size())}overlaySpaceToBaseTlfSpace1(e,t){let n=this.baseTlfSpaceToOverlaySpace1(e,t);return t.add1(t.subtract1(n))}overlaySpaceToBaseTlfSpace2(e,t){return G.new4(this.overlaySpaceToBaseTlfSpace1(e,t.topLeft()),t.size())}constructor(e,t,n,r){this.scene=e,this._data=t,this._previousOverlay=n,this._stackPosition=r}},Xc;(t=>{function i(n,r,o,a,s){if(n==null)return I.new2();let l=n.canvasSpaceBoundingBox().size();if(s=="MANUAL")return new I(a.x()+o.overlayRelativePosition.x(),a.y()+o.overlayRelativePosition.y());{let d=r.canvasSpaceBoundingBox(),c=d.topLeft(),p=d.size(),u=c.x();switch(s){case"TOP_LEFT":case"BOTTOM_LEFT":break;case"TOP_CENTER":case"CENTER":case"BOTTOM_CENTER":{u+=p.x()/2-l.x()/2;break}case"TOP_RIGHT":case"BOTTOM_RIGHT":{u+=p.x()-l.x();break}}let h=c.y();switch(s){case"TOP_LEFT":case"TOP_CENTER":case"TOP_RIGHT":break;case"CENTER":{h+=p.y()/2-l.y()/2;break}case"BOTTOM_LEFT":case"BOTTOM_CENTER":case"BOTTOM_RIGHT":{h+=p.y()-l.y();break}}return new I(u,h)}}t.BoundOverlay_computeOrigin=i;function e(n,r,o,a,s){let l=n.canvasSpaceBoundingBox().size(),d=i(n,r,o,a,s);return Kn.FrozenRect_new4(d.x(),d.y(),l.x(),l.y())}t.BoundOverlay_computeNewBounds=e})(Xc||(Xc={}));var mp=class i{opacity1(){return this._opacity}translation1(){return this._translation}transform1(){return this._transform}scaling1(){return this._scaling}transformOrigin1(){return this._transformOrigin}fillPaints1(){return this._fillPaints}strokePaints1(){return this._strokePaints}cornerRadii1(){return this._cornerRadii}rectangleSize1(){return this._rectangleSize}clone(){var t,n;let e=new i;return e._opacity=this._opacity,e._translation=this._translation.clone(),e._transform=this._transform.clone(),e._scaling=this._scaling,e._transformOrigin=(t=this._transformOrigin)==null?void 0:t.clone(),e._fillPaints=this._fillPaints,e._strokePaints=this._strokePaints,e._cornerRadii=this._cornerRadii,e._rectangleSize=(n=this._rectangleSize)==null?void 0:n.clone(),e}_areVectorsEqual(e,t){return e==null&&t==null?!0:e==null||t==null?!1:e.equals(t)}equals(e){return this._opacity==e.opacity1()&&this._transform.equals1(e.transform1())&&this._scaling.equals(e.scaling1())&&this._areVectorsEqual(this._transformOrigin,e.transformOrigin1())&&this.translation1().equals(e.translation1())&&en.FrozenList_equals(this._fillPaints,e.fillPaints1(),(t,n)=>t.equals1(n))&&en.FrozenList_equals(this._strokePaints,e.strokePaints1(),(t,n)=>t.equals1(n))&&this._cornerRadii.equals(e.cornerRadii1())&&this._areVectorsEqual(this._rectangleSize,e.rectangleSize1())}equalTransformsUpToTranslation(e,t){return this.equalTransformsUpToTranslationAndScaling(e,t)&&this._scaling.equals(e.scaling1())}equalTransformsUpToTranslationAndScaling(e,t){let n=Yr.from(this.transform1()),r=Yr.from(e.transform1()),o=Math.abs(n.angleDegrees-r.angleDegrees)<=t,a=Math.abs(n.m00-r.m00)<=t&&Math.abs(n.m01-r.m01)<=t&&Math.abs(n.m10-r.m10)<=t&&Math.abs(n.m11-r.m11)<=t;return o&&a}opacity2(e){return this._opacity=e,this}translation2(e){return this._translation=e,this}transform2(e){return e!=null,this._transform=e,this}scaling2(e){return this._scaling=e,this}transformOrigin2(e){return this._transformOrigin=e,this}fillPaints2(e){return this._fillPaints=e,this}strokePaints2(e){return this._strokePaints=e,this}cornerRadii2(e){return this._cornerRadii=e,this}rectangleSize2(e){return this._rectangleSize=e,this}withScaledTranslation(e){return this.clone().translation2(this._translation.multiply1(e))}constructor(){this._opacity=1,this._translation=I.new2(),this._transform=vt.FrozenAffineTransform_new1(),this._scaling=I.new2().withOnesForZeros(),this._transformOrigin=null,this._fillPaints=[],this._strokePaints=[],this._cornerRadii=lo.ZEROS,this._rectangleSize=null}},ur=class i{constructor(){if(arguments.length==0)this._from=null,this._to=null,this._shouldDoLegacyImageRectSizeTransition=!1,this._shouldTransitionGeometryForRoundedRectangles=!1,this._isTransformEqual=!1,this._from=new mp,this._to=new mp,this._isTransformEqual=!0;else if(arguments.length==1){let e=arguments[0];this._from=null,this._to=null,this._shouldDoLegacyImageRectSizeTransition=!1,this._shouldTransitionGeometryForRoundedRectangles=!1,this._isTransformEqual=!1,this._from=e._from.clone(),this._to=e._to.clone(),this._shouldDoLegacyImageRectSizeTransition=e._shouldDoLegacyImageRectSizeTransition,this._shouldTransitionGeometryForRoundedRectangles=e._shouldTransitionGeometryForRoundedRectangles,this._isTransformEqual=e._isTransformEqual}}from(){return this._from}to(){return this._to}opacity(e,t){return this._from.opacity2(e),this._to.opacity2(t),this}translation(e,t){return this._from.translation2(e),this._to.translation2(t),this}transform(e,t){return this._isTransformEqual=e.equals2(t,1e-6),this._from.transform2(e),this._to.transform2(t),this}scaling(e,t){return this._from.scaling2(e),this._to.scaling2(t),this}shouldDoLegacyImageRectSizeTransition(e){return this._shouldDoLegacyImageRectSizeTransition=e,this}transitionGeometryForRoundedRectangles(e,t,n,r){return this._from.rectangleSize2(e),this._from.cornerRadii2(t),this._to.rectangleSize2(n),this._to.cornerRadii2(r),this._shouldTransitionGeometryForRoundedRectangles=!0,this}transformOrigin(e,t){return this._from.transformOrigin2(e),this._to.transformOrigin2(t),this}fillPaints1(e,t){return this._from.fillPaints2(e),this._to.fillPaints2(t),this}strokePaints1(e,t){return this._from.strokePaints2(e),this._to.strokePaints2(t),this}_getPaints(e,t,n){let r=[];for(let o=0,a=t.length;o<a;o=o+1){let s=t[o],l=n[o];if(s.equals2(l))r.push(s);else{let d=s,c=l;d.opacity()==0&&(d=l.cloneAsSinglePaint(),d.setOpacity(0)),c.opacity()==0&&(c=s.cloneAsSinglePaint(),c.setOpacity(0)),r.push(_c.create(d,c,this._from.transformOrigin1().multiply(2),this._to.transformOrigin1().multiply(2),e))}}return r}fillGeometryForRoundedRectangles(e,t){if(!this._shouldTransitionGeometryForRoundedRectangles||this._from.rectangleSize1()==null||this._to.rectangleSize1()==null)return null;let n=Math.max(1-t.top(),t.bottom(),1),r=G.new4(Ie.FrozenVector_ZERO,this._from.rectangleSize1().multiply(n).max2(this._to.rectangleSize1().multiply(n))),o=new Jc("NONZERO",0,()=>{let a=I.lerp(this._from.rectangleSize1(),this._to.rectangleSize1(),e()),s=this._from.cornerRadii1().toList(),l=this._to.cornerRadii1().toList(),d=[];for(let c=0;c<4;c=c+1)d.push(Math.max(Xt.double_lerp(s[c],l[c],e()),0));return new Nt(new G(0,0,Math.abs(a.x()),Math.abs(a.y())),lo.fromList(d))},r);return new Vn([o],[],r,null)}fillGeometryForSpreadDynamic(e,t,n,r,o,a){if(!this._shouldTransitionGeometryForRoundedRectangles||this._from.rectangleSize1()==null||this._to.rectangleSize1()==null)return null;let s=this._from.rectangleSize1().add(2*t),l=this._to.rectangleSize1().add(2*t),d=Math.max(1-a.top(),a.bottom(),1),c=G.new4(Ie.FrozenVector_ZERO,this._from.rectangleSize1().multiply(d).max2(this._to.rectangleSize1().multiply(d))).expandedBy1(t),p=this._from.cornerRadii1().toList(),u=this._to.cornerRadii1().toList();for(let f=0;f<4;f=f+1)p[f]=p[f]==0?0:p[f]+t,u[f]=u[f]==0?0:u[f]+t;let h=new Jc("NONZERO",0,()=>{let f=I.lerp(s,l,n()),y=[];for(let g=0;g<4;g=g+1)y.push(Math.max(Xt.double_lerp(p[g],u[g],n()),0));return new Nt(new G(-t,-t,Math.abs(f.x()),Math.abs(f.y())),lo.fromList(y))},c);return new _l(()=>new Pt(h.path(),h.windingRule),r,h.bounds(),It.forDynamicGeometry(o))}fillPaints2(e){return this._getPaints(e,this._from.fillPaints1(),this._to.fillPaints1())}strokePaints2(e){return this._getPaints(e,this._from.strokePaints1(),this._to.strokePaints1())}hasTransitioningPaints(){return this._to.fillPaints1().length!=0&&this._from.fillPaints1().length!=0||this._to.strokePaints1().length!=0&&this._from.strokePaints1().length!=0}hasLegacyTransitioningSizesForImageRect(){return this._shouldDoLegacyImageRectSizeTransition}hasTransitioningGeometryForRoundedRectangles(){return this._shouldTransitionGeometryForRoundedRectangles}hasTransitioningTranslation(){return this._from.translation1()==null&&this._to.translation1()==null?!1:this._from.translation1()==null||this.to().translation1()==null?!0:!this._from.translation1().equals(this.to().translation1())}hasTransitioningTransform(){return this._from.transform1()==null&&this._to.transform1()==null?!1:this._from.transform1()==null||this.to().transform1()==null?!0:!this._from.transform1().equals1(this.to().transform1())}hasTransitioningScaling(){return this._from.scaling1()==null&&this._to.scaling1()==null?!1:this._from.scaling1()==null||this.to().scaling1()==null?!0:!this._from.scaling1().equals(this.to().scaling1())}hasTransitioningTransformOrigin(){return this._from.transformOrigin1()==null&&this._to.transformOrigin1()==null?!1:this._from.transformOrigin1()==null||this.to().transformOrigin1()==null?!0:!this._from.transformOrigin1().equals(this.to().transformOrigin1())}interpolateOpacity(e){return Xt.double_clamp(Xt.double_lerp(this.from().opacity1(),this.to().opacity1(),e),0,1)}interpolateTranslation(e){return I.lerp(this.from().translation1(),this.to().translation1(),e)}interpolateTransform(e){let t=this.from().transform1(),n=this.to().transform1();if(t.toAngle()!=n.toAngle()&&this.from().transformOrigin1()!=null&&this.to().transformOrigin1()!=null){let r=t.clone().translatedBy1(this.from().transformOrigin1()),o=n.clone().translatedBy1(this.to().transformOrigin1()),a=Yr.lerp1(r,o,e),s=I.lerp(this.from().transformOrigin1(),this.to().transformOrigin1(),e),l=ne.new2().translatedBy1(s.negative());return a.multiply(l),a}else return this._isTransformEqual?t:Yr.lerp1(t,n,e)}interpolateScaling(e){return I.lerp(this.from().scaling1(),this.to().scaling1(),e)}clone(){return new i(this)}withScaledTranslation(e){let t=this.clone();return t._from=t._from.withScaledTranslation(e),t._to=t._to.withScaledTranslation(e),t}},Ae=class Ae{constructor(){if(arguments.length==0)this._enteringFrameTransition=null,this._exitingFrameTransition=null,this._drawsEnteringFrameOnTopOfExitingFrame=!1,this._isDissolve=!1,this._reversed=null,this._enteringFrameTransition=new ur,this._exitingFrameTransition=new ur,this._drawsEnteringFrameOnTopOfExitingFrame=!0,this._isDissolve=!1;else if(arguments.length==4){let e=arguments[0],t=arguments[1],n=arguments[2],r=arguments[3];this._enteringFrameTransition=null,this._exitingFrameTransition=null,this._drawsEnteringFrameOnTopOfExitingFrame=!1,this._isDissolve=!1,this._reversed=null,this._enteringFrameTransition=e,this._exitingFrameTransition=t,this._drawsEnteringFrameOnTopOfExitingFrame=n,this._isDissolve=r}}enteringFrameTransition(){return this._enteringFrameTransition}exitingFrameTransition(){return this._exitingFrameTransition}drawsEnteringFrameOnTopOfExitingFrame(){return this._drawsEnteringFrameOnTopOfExitingFrame}isDissolve(){return this._isDissolve}enteringFrameTranslation(e,t){return this._enteringFrameTransition.translation(e,t),this._reversed=null,this}enteringFrameOpacity(e,t){return this._enteringFrameTransition.opacity(e,t),this._reversed=null,this}exitingFrameTranslation(e,t){return this._exitingFrameTransition.translation(e,t),this._reversed=null,this}exitingFrameOpacity(e,t){return this._exitingFrameTransition.opacity(e,t),this._reversed=null,this}drawExitingFrameOnTopOfEnteringFrame(){return this._drawsEnteringFrameOnTopOfExitingFrame=!1,this._reversed=null,this}dissolve(){return this._isDissolve=!0,this._reversed=null,this}freeze(){return this}clone(){return new Ae(this._enteringFrameTransition.clone(),this._exitingFrameTransition.clone(),this._drawsEnteringFrameOnTopOfExitingFrame,this._isDissolve)}reversed(){if(this._reversed==null){let e=new Ae().enteringFrameTranslation(this.exitingFrameTransition().to().translation1(),this.exitingFrameTransition().from().translation1()).enteringFrameOpacity(this.exitingFrameTransition().to().opacity1(),this.exitingFrameTransition().from().opacity1()).exitingFrameTranslation(this.enteringFrameTransition().to().translation1(),this.enteringFrameTransition().from().translation1()).exitingFrameOpacity(this.enteringFrameTransition().to().opacity1(),this.enteringFrameTransition().from().opacity1());this.isDissolve()&&e.dissolve(),this.drawsEnteringFrameOnTopOfExitingFrame()&&e.drawExitingFrameOnTopOfEnteringFrame(),this._reversed=e}return this._reversed}withScaledTranslation(e){return new Ae(this._enteringFrameTransition.withScaledTranslation(e),this._exitingFrameTransition.withScaledTranslation(e),this._drawsEnteringFrameOnTopOfExitingFrame,this._isDissolve)}static get(e){switch(e){case"INSTANT_TRANSITION":return Ae.INSTANT_TRANSITION;case"DISSOLVE":return Ae.DISSOLVE;case"SMART_ANIMATE":return Ae.DISSOLVE;case"SLIDE_FROM_LEFT":return Ae.SLIDE_FROM_LEFT;case"SLIDE_FROM_RIGHT":return Ae.SLIDE_FROM_RIGHT;case"SLIDE_FROM_TOP":return Ae.SLIDE_FROM_TOP;case"SLIDE_FROM_BOTTOM":return Ae.SLIDE_FROM_BOTTOM;case"PUSH_FROM_LEFT":return Ae.PUSH_FROM_LEFT;case"PUSH_FROM_RIGHT":return Ae.PUSH_FROM_RIGHT;case"PUSH_FROM_TOP":return Ae.PUSH_FROM_TOP;case"PUSH_FROM_BOTTOM":return Ae.PUSH_FROM_BOTTOM;case"MOVE_FROM_LEFT":return Ae.MOVE_FROM_LEFT;case"MOVE_FROM_RIGHT":return Ae.MOVE_FROM_RIGHT;case"MOVE_FROM_TOP":return Ae.MOVE_FROM_TOP;case"MOVE_FROM_BOTTOM":return Ae.MOVE_FROM_BOTTOM;case"SLIDE_OUT_TO_LEFT":return Ae.SLIDE_OUT_TO_LEFT;case"SLIDE_OUT_TO_RIGHT":return Ae.SLIDE_OUT_TO_RIGHT;case"SLIDE_OUT_TO_TOP":return Ae.SLIDE_OUT_TO_TOP;case"SLIDE_OUT_TO_BOTTOM":return Ae.SLIDE_OUT_TO_BOTTOM;case"MOVE_OUT_TO_LEFT":return Ae.MOVE_OUT_TO_LEFT;case"MOVE_OUT_TO_RIGHT":return Ae.MOVE_OUT_TO_RIGHT;case"MOVE_OUT_TO_TOP":return Ae.MOVE_OUT_TO_TOP;case"MOVE_OUT_TO_BOTTOM":return Ae.MOVE_OUT_TO_BOTTOM;case"FADE":return Ae.DISSOLVE;case"MAGIC_MOVE":return Ae.DISSOLVE}throw new Error(`Unhandled transition type ${e}`)}};Ae.SLIDE_BACK_FRAME_OPACITY_START=1,Ae.SLIDE_BACK_FRAME_OPACITY_END=.5,Ae.OFFSCREEN_LEFT=new I(-1,0),Ae.OFFSCREEN_RIGHT=new I(1,0),Ae.OFFSCREEN_TOP=new I(0,-1),Ae.OFFSCREEN_BOTTOM=new I(0,1),Ae.CENTER=I.new2(),Ae.INSTANT_TRANSITION=new Ae().freeze(),Ae.DISSOLVE=new Ae().dissolve().freeze(),Ae.SLIDE_FROM_LEFT=new Ae().enteringFrameTranslation(Ae.OFFSCREEN_LEFT,Ae.CENTER).exitingFrameTranslation(Ae.CENTER,Ae.OFFSCREEN_RIGHT.divide(4)).exitingFrameOpacity(Ae.SLIDE_BACK_FRAME_OPACITY_START,Ae.SLIDE_BACK_FRAME_OPACITY_END).freeze(),Ae.SLIDE_FROM_RIGHT=new Ae().enteringFrameTranslation(Ae.OFFSCREEN_RIGHT,Ae.CENTER).exitingFrameTranslation(Ae.CENTER,Ae.OFFSCREEN_LEFT.divide(4)).exitingFrameOpacity(Ae.SLIDE_BACK_FRAME_OPACITY_START,Ae.SLIDE_BACK_FRAME_OPACITY_END).freeze(),Ae.SLIDE_FROM_TOP=new Ae().enteringFrameTranslation(Ae.OFFSCREEN_TOP,Ae.CENTER).exitingFrameTranslation(Ae.CENTER,Ae.OFFSCREEN_BOTTOM.divide(4)).exitingFrameOpacity(Ae.SLIDE_BACK_FRAME_OPACITY_START,Ae.SLIDE_BACK_FRAME_OPACITY_END).freeze(),Ae.SLIDE_FROM_BOTTOM=new Ae().enteringFrameTranslation(Ae.OFFSCREEN_BOTTOM,Ae.CENTER).exitingFrameTranslation(Ae.CENTER,Ae.OFFSCREEN_TOP.divide(4)).exitingFrameOpacity(Ae.SLIDE_BACK_FRAME_OPACITY_START,Ae.SLIDE_BACK_FRAME_OPACITY_END).freeze(),Ae.SLIDE_OUT_TO_LEFT=Ae.SLIDE_FROM_RIGHT.reversed(),Ae.SLIDE_OUT_TO_RIGHT=Ae.SLIDE_FROM_LEFT.reversed(),Ae.SLIDE_OUT_TO_TOP=Ae.SLIDE_FROM_BOTTOM.reversed(),Ae.SLIDE_OUT_TO_BOTTOM=Ae.SLIDE_FROM_TOP.reversed(),Ae.PUSH_FROM_LEFT=new Ae().enteringFrameTranslation(Ae.OFFSCREEN_LEFT,Ae.CENTER).exitingFrameTranslation(Ae.CENTER,Ae.OFFSCREEN_RIGHT).freeze(),Ae.PUSH_FROM_RIGHT=Ae.PUSH_FROM_LEFT.reversed(),Ae.PUSH_FROM_TOP=new Ae().enteringFrameTranslation(Ae.OFFSCREEN_TOP,Ae.CENTER).exitingFrameTranslation(Ae.CENTER,Ae.OFFSCREEN_BOTTOM).freeze(),Ae.PUSH_FROM_BOTTOM=Ae.PUSH_FROM_TOP.reversed(),Ae.MOVE_FROM_LEFT=new Ae().enteringFrameTranslation(Ae.OFFSCREEN_LEFT,Ae.CENTER).freeze(),Ae.MOVE_FROM_RIGHT=new Ae().enteringFrameTranslation(Ae.OFFSCREEN_RIGHT,Ae.CENTER).freeze(),Ae.MOVE_FROM_TOP=new Ae().enteringFrameTranslation(Ae.OFFSCREEN_TOP,Ae.CENTER).freeze(),Ae.MOVE_FROM_BOTTOM=new Ae().enteringFrameTranslation(Ae.OFFSCREEN_BOTTOM,Ae.CENTER).freeze(),Ae.MOVE_OUT_TO_LEFT=Ae.MOVE_FROM_RIGHT.reversed(),Ae.MOVE_OUT_TO_RIGHT=Ae.MOVE_FROM_LEFT.reversed(),Ae.MOVE_OUT_TO_TOP=Ae.MOVE_FROM_BOTTOM.reversed(),Ae.MOVE_OUT_TO_BOTTOM=Ae.MOVE_FROM_TOP.reversed();var Rn=Ae;var xr=(t=>(t[t.FORWARD=0]="FORWARD",t[t.REVERSE=1]="REVERSE",t))(xr||{}),ri=(n=>(n[n.IGNORE=0]="IGNORE",n[n.REMEMBER=1]="REMEMBER",n[n.RESET=2]="RESET",n))(ri||{}),Al=class Al{constructor(e,t){this.hotspotStablePath=e,this.interactionId=t}};Al.EXTERNAL_INTERACTION_ID=ee._new(-1,-2),Al.EXTERNAL=new Al(null,Al.EXTERNAL_INTERACTION_ID);var fo=Al,Jn=class i{static getDefault(){let e=Y.getFeatureFlags().prototype_state_management?1:0;return new i("INSTANT_TRANSITION",0,null,!1,Ie.FrozenVector_new1(),"NAVIGATE",!1,Ie.FrozenVector_new1(),!1,!0,!1,!1,e)}static fromPrototypeAction(e,t){return e==null?i.getDefault():new i(e.transitionType(),e.transitionDuration(),e.easingFunction,e.transitionShouldSmartAnimate(),e.overlayRelativePosition(),e.navigationType(),e.transitionPreserveScroll(),e.extraScrollOffset(),e.transitionResetVideoPosition(),e.openUrlInNewTab(),e.transitionResetScrollPosition(),e.transitionResetInteractiveComponents(),t)}withTransitionPreserveScroll(e){return new i(this.transitionType,this.transitionDuration,this.easingFunction,this.transitionShouldSmartAnimate,this.overlayRelativePosition,this.navigationType,e,this.extraScrollOffset,this.transitionResetVideoPosition,this.openUrlInNewTab,this.transitionResetScrollPosition,this.transitionResetInteractiveComponents,this.stateManagementVersion)}withDefaultStateManagementSettings(){return new i(this.transitionType,this.transitionDuration,this.easingFunction,this.transitionShouldSmartAnimate,this.overlayRelativePosition,this.navigationType,this.transitionPreserveScroll,this.extraScrollOffset,!1,this.openUrlInNewTab,!1,!1,this.stateManagementVersion)}withStateManagementSettings(e){return e==null?this:new i(this.transitionType,this.transitionDuration,this.easingFunction,this.transitionShouldSmartAnimate,this.overlayRelativePosition,this.navigationType,this.transitionPreserveScroll,this.extraScrollOffset,e.transitionResetVideoPosition,this.openUrlInNewTab,e.transitionResetScrollPosition,e.transitionResetInteractiveComponents,e.stateManagementVersion)}constructor(e,t,n,r,o,a,s,l,d,c,p,u,h){this.transitionType=e,this.transitionDuration=t,this.easingFunction=n,this.transitionShouldSmartAnimate=r,this.overlayRelativePosition=o,this.navigationType=a,this.transitionPreserveScroll=s,this.extraScrollOffset=l,this.transitionResetVideoPosition=d,this.openUrlInNewTab=c,this.transitionResetScrollPosition=p,this.transitionResetInteractiveComponents=u,this.stateManagementVersion=h}},bn=class{topId(){return this.overlays.length>0?ue.List_last(this.overlays).id:this.stateId}debugString(e){let t=o=>{let a=e.findNode1(o);return`[nodeId.toString]: ${(a==null?void 0:a.name())??"null"}`},n="  ",r="[";for(let o=0,a=this.overlays.length;o<a;o=o+1){let s=this.overlays[o];r+=n+t(s.id),o!=this.overlays.length-1&&(r+=`,
`)}return r+="]",`PresentedState(
`+n+t(this.stateId)+`
`+n+`,
`+n+r+`
)`}statesAndOverlaysIncluded(){let e=new Ar;this.stateId!=null&&ee.isValid(this.stateId)&&e.add(this.stateId);for(let t of this.overlays)ee.isValid(t.id)&&e.add(t.id);return e}constructor(e,t){this.stateId=e,this.overlays=t}},Hn=class i{constructor(){if(arguments[0]==0){let[,e]=arguments;this.stablePath=null,this.oldStateAndOverlays=null,this.newStateAndOverlays=null,this.cause=0,this.canvasSpaceTriggerBoundsOrNull=null,this.direction=0,this.transitionParameters=Jn.getDefault(),this.interactionAddress=fo.EXTERNAL,this.stablePath=e,this.oldStateAndOverlays=new bn(null,[]),this.newStateAndOverlays=new bn(null,[])}else if(arguments[0]==1){let[,e,t,n]=arguments;this.stablePath=null,this.oldStateAndOverlays=null,this.newStateAndOverlays=null,this.cause=0,this.canvasSpaceTriggerBoundsOrNull=null,this.direction=0,this.transitionParameters=Jn.getDefault(),this.interactionAddress=fo.EXTERNAL,this.stablePath=e,this.oldStateAndOverlays=t,this.newStateAndOverlays=n}else if(arguments[0]==2){let[,e,t,n,r,o,a,s]=arguments;this.stablePath=null,this.oldStateAndOverlays=null,this.newStateAndOverlays=null,this.cause=0,this.canvasSpaceTriggerBoundsOrNull=null,this.direction=0,this.transitionParameters=Jn.getDefault(),this.interactionAddress=fo.EXTERNAL,this.stablePath=e,this.oldStateAndOverlays=new bn(t,[]),this.newStateAndOverlays=new bn(n,[]),this.direction=0,this.cause=s,this.interactionAddress=r,this.transitionParameters=a,this.canvasSpaceTriggerBoundsOrNull=o}else if(arguments[0]==3){let[,e,t,n,r,o,a,s,l]=arguments;this.stablePath=null,this.oldStateAndOverlays=null,this.newStateAndOverlays=null,this.cause=0,this.canvasSpaceTriggerBoundsOrNull=null,this.direction=0,this.transitionParameters=Jn.getDefault(),this.interactionAddress=fo.EXTERNAL,this.stablePath=e,this.oldStateAndOverlays=t,this.newStateAndOverlays=n,this.direction=s,this.cause=l,this.interactionAddress=r,this.transitionParameters=a,this.canvasSpaceTriggerBoundsOrNull=o}else if(arguments[0]==4){let[,e,t,n,r,o,a,s]=arguments;this.stablePath=null,this.oldStateAndOverlays=null,this.newStateAndOverlays=null,this.cause=0,this.canvasSpaceTriggerBoundsOrNull=null,this.direction=0,this.transitionParameters=Jn.getDefault(),this.interactionAddress=fo.EXTERNAL,this.stablePath=e,this.oldStateAndOverlays=t,this.newStateAndOverlays=n,this.interactionAddress=o,this.direction=a,this.transitionParameters=s,this.cause=r}}static forClosingTopNOverlays(e,t,n,r,o,a){let l=n[n.length-e].openingTransition.withTransitionPreserveScroll(!0).withDefaultStateManagementSettings();return new i(3,Po.ROOT_STABLE_PATH(),new bn(t,n),new bn(t,n.slice(0,n.length-e)),r,o,l,1,a)}oldStateId(){var e;return(e=this.oldStateAndOverlays)==null?void 0:e.stateId}newStateId(){var e;return(e=this.newStateAndOverlays)==null?void 0:e.stateId}oldOverlayData(){var e;return(e=this.oldStateAndOverlays)==null?void 0:e.overlays}newOverlayData(){var e;return(e=this.newStateAndOverlays)==null?void 0:e.overlays}oldOverlays(e){var t;return e.bindOverlays((t=this.oldStateAndOverlays)==null?void 0:t.overlays)}newOverlays(e){var t;return e.bindOverlays((t=this.newStateAndOverlays)==null?void 0:t.overlays)}isTransientChange(){let e=ee.equals(this.oldStateAndOverlays.stateId,this.newStateAndOverlays.stateId);switch(this.transitionParameters.navigationType){case"OVERLAY":case"SWAP":case"SCROLL_TO":return!0;default:break}return Ut.TransitionAction_isTransientAction(this.cause)||e}debugString(e){var t,n;return`${(t=this.oldStateAndOverlays)==null?void 0:t.debugString(e)}
=>
${(n=this.newStateAndOverlays)==null?void 0:n.debugString(e)}`}easingFunction(){return this.transitionParameters.easingFunction}preserveScroll(){return this.transitionParameters.transitionPreserveScroll?1:0}resetScroll(){return this.transitionParameters.transitionResetScrollPosition?0:1}resetInteractiveComponents(){return this.transitionParameters.transitionResetInteractiveComponents?0:1}stateManagementVersion(){return this.transitionParameters.stateManagementVersion}getFramePairTransition(){let e=Rn.get(this.transitionParameters.transitionType);return this.direction==1?e.reversed():e}getNewOrChangedFrameIds(){let e=[];!ee.equals(this.oldStateId(),this.newStateId())&&this.newStateId()!=null&&e.push(this.newStateId());for(let t=0,n=this.newOverlayData().length;t<n;t=t+1)(t>=this.oldOverlayData().length||!ee.equals(this.oldOverlayData()[t].id,this.newOverlayData()[t].id))&&e.push(this.newOverlayData()[t].id);return e}getInsertedFrameIds(){let e=[];!ee.equals(this.oldStateId(),this.newStateId())&&this.newStateId()!=null&&e.push(this.newStateId());let t=new Ar;this.oldOverlayData().forEach(n=>{t.add(n.id)});for(let n=0,r=this.newOverlayData().length;n<r;n=n+1){let o=this.newOverlayData()[n].id;t._in(o)||e.push(o)}return e}getRemovedFrameIds(){let e=[];!ee.equals(this.oldStateId(),this.newStateId())&&this.newStateId()!=null&&e.push(this.oldStateId());let t=new Ar;this.newOverlayData().forEach(n=>{t.add(n.id)});for(let n=0,r=this.oldOverlayData().length;n<r;n=n+1){let o=this.oldOverlayData()[n].id;t._in(o)||e.push(o)}return e}},Gr=class i{static getDefaultExternalExecution(){return new i(fo.EXTERNAL,Jn.getDefault(),null)}static forNoodle(e,t,n){let r=new fo(i.stablePathForHotspot(e),t.id()),o=t.action().value;if(n!=null)o=n;else for(let l of t.getAllValidTransitionActionsInInteraction()){o=l;break}let a=Jn.fromPrototypeAction(o,Y.getFeatureFlags().prototype_state_management?t.stateManagementVersion():0),s=t.event().interactionType()=="ON_HOVER"?e.canvasSpaceInteractiveBounds():null;return new i(r,a,s)}static forExternalOpenOverlay(e){let t=new fo(i.stablePathForHotspot(e),ee._new(-1,-2));return new i(t,Jn.getDefault(),null)}static stablePathForHotspot(e){let t=null;return t=e.stablePath(),t}constructor(e,t,n){this.interactionAddress=e,this.transitionParameters=t,this.canvasSpaceTriggerBoundsOrNull=n}},bb;(e=>{function i(t){return xr[t]}e.TransitionDirection_toString=i})(bb||(bb={}));var Tb;(e=>{function i(t){return ri[t]}e.HistoryPolicy_toString=i})(Tb||(Tb={}));var a1=-1,vb=!1,tn=class tn{addProperty(e){return this.transition=e(this.transition!=null?this.transition:new ur),this}dissolve(){return this.isDissolve=!0,this.transition=new ur().transform(this.transition.from().transform1(),this.transition.to().transform1()),this}static buildStrategy(e,t){let n=new tn;for(let r of tn.propertyFunctions)if(r(e,t,n),n.isDissolve)return n;return n}static forDiscreteProperties(e,t,n){return n=tn.nodeTypeToRenderSetMap.get(e.type())==tn.nodeTypeToRenderSetMap.get(t.type())?n:n.dissolve(),n=e.blendMode()==t.blendMode()?n:n.dissolve(),n=e.clipsToBoundingRectangle()==t.clipsToBoundingRectangle()?n:n.dissolve(),n=e.isFixed()==t.isFixed()?n:n.dissolve(),n}static forSizes(e,t,n){let r=e.size(),o=t.size();if(n.addProperty(l=>l.transformOrigin(r.divide(2),o.divide(2))),n.transition.hasLegacyTransitioningSizesForImageRect()||n.transition.hasTransitioningGeometryForRoundedRectangles()||e.type()=="ROUNDED_RECTANGLE"&&t.type()=="ROUNDED_RECTANGLE")return n;let a=t.isResizeToFit()||Jt.isFrameLike(t.type())&&!t.clipsToBoundingRectangle();return(e.isResizeToFit()||Jt.isFrameLike(e.type())&&!e.clipsToBoundingRectangle())&&tn._filterPaints3(e.fillPaintsToRender()).length==0&&a&&tn._filterPaints3(t.fillPaintsToRender()).length==0||r.equals(o)?n:n.dissolve()}static forOpacity(e,t,n){return n.addProperty(r=>r.opacity(e,t))}static forRelativeTransforms(e,t,n){return n.addProperty(r=>r.transform(e,t))}static forFillPaints(e,t,n){let r=tn._filterPaints2(e),o=tn._filterPaints2(t);return tn._maybeInterpolatePaints(r,o,n,a=>a.fillPaints1(r,o))}static forStrokePaints(e,t,n){let r=tn._filterPaints2(e),o=tn._filterPaints2(t);return tn._maybeInterpolatePaints(r,o,n,a=>a.strokePaints1(r,o))}static _filterPaints1(e){return tn._filterPaints2(e)}static _filterPaints2(e){return e.filter(t=>t.isEnabled())}static _filterPaints3(e){return tn._filterPaints2(e)}static _maybeInterpolatePaints(e,t,n,r){return!n.transition.hasTransitioningGeometryForRoundedRectangles()&&en.FrozenList_equals(e,t,(o,a)=>o.equals1(a))?n:en.FrozenList_equals(e,t,(o,a)=>o.type()==a.type()&&o.blendMode()==a.blendMode())?n.addProperty(r):n.dissolve()}static forGeometryAndPaints(e,t,n){var c,p;let r=e.supportsGeometry(),o=t.supportsGeometry();if(!r&&!o)return n;if(r!=o)return n.dissolve();let a=((c=e.fillGeometry())==null?void 0:c.regions)??[],s=((p=t.fillGeometry())==null?void 0:p.regions)??[],l=(Jt.isFrameLike(e.type())&&e.containerSupportsFillStrokeAndCorners()||["RECTANGLE","ROUNDED_RECTANGLE"].indexOf(e.type())!=-1)&&e.strokePaints().length==0&&a.length==1&&Nt.isRoundedRectSupported(e.roundedRectInfo()),d=(Jt.isFrameLike(t.type())&&t.containerSupportsFillStrokeAndCorners()||["RECTANGLE","ROUNDED_RECTANGLE"].indexOf(t.type())!=-1)&&t.strokePaints().length==0&&s.length==1&&Nt.isRoundedRectSupported(t.roundedRectInfo());if(l&&d){if(a.length!=0&&s.length!=0){let u=e.fillGeometry().regions[0].bounds().size(),h=t.fillGeometry().regions[0].bounds().size(),f=lo.fromRoundedRect(e.roundedRectInfo()),y=lo.fromRoundedRect(t.roundedRectInfo());(!f.equals(y)||!u.equals(h))&&n.addProperty(g=>g.transitionGeometryForRoundedRectangles(u,f,h,y))}}else{let u=!1;if(e.isAxisAlignedRectFill()&&t.isAxisAlignedRectFill())for(let h of[e.fillPaints(),t.fillPaints()]){for(let f=0,y=h.length;f<y;f=f+1)if(h[f].type()=="IMAGE"||h[f].type()=="VIDEO"){u=!0;break}if(u)break}if(u&&!e.fillOrTextGeometry().geometryEquals(t.fillOrTextGeometry())){let h=tn._filterPaints1(e.fillRegionPaints()[0]),f=tn._filterPaints1(t.fillRegionPaints()[0]);if(en.FrozenList_equals(h,f,(y,g)=>y.type()==g.type()))return n.addProperty(y=>y.fillPaints1(h,f)),n.addProperty(y=>y.shouldDoLegacyImageRectSizeTransition(!0)),n}n=tn._forGeometryStructure(e.fillOrTextGeometry(),t.fillOrTextGeometry(),n)}return n=tn._forGeometryPaints(e.fillRegionPaints(),t.fillRegionPaints(),n,(u,h,f)=>tn.forFillPaints(u,h,f)),n=tn._forGeometryStructure(e.strokeGeometry(),t.strokeGeometry(),n),n=tn._forGeometryPaints(e.strokeRegionPaints(),t.strokeRegionPaints(),n,(u,h,f)=>tn.forStrokePaints(u,h,f)),n}static forEffects(e,t,n){let r=e.filter(a=>a.isVisibleForRendering()),o=t.filter(a=>a.isVisibleForRendering());return ue.List_equalsWithComparison(r,o,(a,s)=>a.equals(s))?n:n.dissolve()}static _forGeometryStructure(e,t,n){return e!=null&&t!=null?e.geometryEquals(t)?n:n.dissolve():e==null&&t==null?n:n.dissolve()}static _forGeometryPaints(e,t,n,r){if(e.length==t.length){for(let o=0,a=e.length;o<a;o=o+1)if(n=r(e[o],t[o],n),n.isDissolve)return n;return n}return n.dissolve()}constructor(){this.isDissolve=!1,this.transition=new ur}};tn.propertyFunctions=[(e,t,n)=>{tn.forRelativeTransforms(e.relativeTransformAccountingForFixedOffset(),t.relativeTransformAccountingForFixedOffset(),n)},(e,t,n)=>{tn.forGeometryAndPaints(e,t,n)},(e,t,n)=>{tn.forSizes(e,t,n)},(e,t,n)=>{tn.forDiscreteProperties(e,t,n)},(e,t,n)=>{tn.forOpacity(e.opacity(),t.opacity(),n)},(e,t,n)=>{tn.forEffects(e.effects(),t.effects(),n)}],tn.nodeTypeToRenderSetMap=[["NONE","DOCUMENT","SLICE"],["CANVAS","GROUP","FRAME","SYMBOL","INSTANCE","CONNECTOR","STICKY","SHAPE_WITH_TEXT","CODE_BLOCK","MEDIA","SECTION_OVERLAY","TABLE","TABLE_CELL","SLIDE"],["ELLIPSE","LINE","RECTANGLE","REGULAR_POLYGON","ROUNDED_RECTANGLE","STAR","VECTOR","STAMP","WASHI_TAPE"],["BOOLEAN_OPERATION"],["TEXT"]].reduce((e,t,n)=>(t.forEach(r=>{e.set(r,n)}),e),new Map);var Sl=tn;var Fo=class i{constructor(e,t,n,r){this._lastInputTForAbsoluteTransform=-1;this._oldSceneNode=e,this._oldCanvasToRenderTreeTransform=t,this._newSceneNode=n,this._newCanvasToRenderTreeTransform=r,this._children=[],this._enabledTraits=a1,this._parent=null,this._transition=null,this._isDissolve=!1,this._scalesIndependentlyOfParent=!1,this._forceMask=!1,this._interpolateScalingToCachedAbsoluteTransform=new Map}get isDissolve(){return this._isDissolve}get scalesIndependentlyOfParent(){return this._scalesIndependentlyOfParent}get forceMask(){return this._forceMask}get enabledTraits(){return this._enabledTraits}get transition(){return this._transition}setTransition(e){this._transition=e,this._referenceTransitionForChildrenNodes=e}clearTransitionForDissolveRenderTrees(){let e=this.transition.clone().transform(ne.new2(),ne.new2());this._transition=e}get parent(){return this._parent}get children(){return this._children}static debugStringRecursive(e,t,n,r){var s,l;t.result+=t.indent,n||(t.result+=r?"\u2514\u2500":"\u251C\u2500");let o=t.indent.length;n||(t.indent+=r?"  ":"\u2502 "),t.result+=`${((s=e._oldSceneNode)==null?void 0:s.name())??"null"} -> ${((l=e._newSceneNode)==null?void 0:l.name())??"null"}`,e.forceMask&&(t.result+=" (.MASK)");let a=e.transition;if(a!=null){t.result+=e.isDissolve?" (dissolve)":"",t.result+=a.hasTransitioningPaints()&&4&e.enabledTraits?" (paints)":"",t.result+=a.hasTransitioningGeometryForRoundedRectangles()&&16&e.enabledTraits?" (geometry)":"";let d=a.from(),c=a.to();if((d.opacity1()!=1||d.opacity1()!=c.opacity1())&&(t.result+=` (opacity: ${d.opacity1()} -> ${c.opacity1()})`),d.translation1().equals(c.translation1())||(t.result+=` (translation: ${d.translation1()} -> ${c.translation1()})`),!d.transform1().equals1(c.transform1())){let p=Yr.from(d.transform1()),u=Yr.from(c.transform1());p.translation.approximatelyEquals(u.translation,1e-6)||(t.result+=` (translation: ${p.translation} -> ${u.translation})`),p.scale.approximatelyEquals(u.scale,1e-6)||(t.result+=` (scale: ${p.scale} -> ${u.scale})`),p.angleDegrees!=u.angleDegrees&&(t.result+=` (angle: ${p.angleDegrees} deg -> ${u.angleDegrees} deg)`)}}t.result+=`
`;for(let d=0,c=e.children.length;d<c;d=d+1)this.debugStringRecursive(e.children[d],t,!1,d==e.children.length-1);e.isDissolve&&(this.debugStringRecursive(e.forDissolveStart1(),t,!1,!1),this.debugStringRecursive(e.forDissolveEnd1(),t,!1,!0)),t.indent=t.indent.slice(0,o)}static _generatePlanForMatchedNodes(e,t,n,r,o,a){let s=Sl.buildStrategy(e,n);if(s.transition.hasLegacyTransitioningSizesForImageRect()){let p=s.transition;p.scaling(new I(1,1),n.size().divide1(e.size()));let u=new i(e,t,n,r);return u._isDissolve=!1,u.setTransition(p),u}let l=this.getMagicMovePlan1(e,t,n,r,o,null,e.isFixed()?Rn.DISSOLVE:a);return t.clone().multiply(e.absoluteTransform()),r.clone().multiply(n.absoluteTransform()),l._isDissolve=s.isDissolve,l.setTransition(s.transition),l}static _generatePlanForRemovedNode(e,t,n){let r=new i(e,t,null,null);if(n!=null&&n.isDissolve()){let o=new ur().opacity(e.opacity(),0);o.transform(e.relativeTransformAccountingForFixedOffset(),e.relativeTransformAccountingForFixedOffset()),r.setTransition(o)}else{let o=new ur().transform(e.relativeTransformAccountingForFixedOffset(),e.relativeTransformAccountingForFixedOffset());n!=null?(o.translation(n.exitingFrameTransition().from().translation1(),n.exitingFrameTransition().to().translation1()),o.opacity(e.opacity()*n.exitingFrameTransition().from().opacity1(),e.opacity()*n.exitingFrameTransition().to().opacity1())):o.opacity(e.opacity(),e.opacity()),r.setTransition(o)}return e.forEachChild(o=>{r._appendChild(this._generatePlanForRemovedNode(o,t,null))}),r}static _generatePlanForInsertedNode(e,t,n){let r=new i(null,null,e,t);if(n!=null&&n.isDissolve()){let o=new ur().opacity(0,e.opacity());o.transform(e.relativeTransformAccountingForFixedOffset(),e.relativeTransformAccountingForFixedOffset()),r.setTransition(o)}else{let o=new ur().transform(e.relativeTransformAccountingForFixedOffset(),e.relativeTransformAccountingForFixedOffset());n!=null?(o.translation(n.enteringFrameTransition().from().translation1(),n.enteringFrameTransition().to().translation1()),o.opacity(e.opacity()*n.enteringFrameTransition().from().opacity1(),e.opacity()*n.enteringFrameTransition().to().opacity1())):o.opacity(e.opacity(),e.opacity()),r.setTransition(o)}return e.forEachChild(o=>{r._appendChild(this._generatePlanForInsertedNode(o,t,null))}),r}static _matchKey(e){return e.name()}static _getNodeMatches(e,t,n,r){if(!r&&(e.type()=="BOOLEAN_OPERATION"||t.type()=="BOOLEAN_OPERATION"))return;let o=new Map;t.forEachChild(a=>{if(!a.visible())return;let s=this._matchKey(a),l=null;o.has(s)?l=o.get(s):(l=[],o.set(s,l)),l.push(a)}),e.forEachChild(a=>{if(!a.visible())return;let s=this._matchKey(a),l=Be.StringMap_get(o,s,null);if(l==null||l.length==0)return;let d=l.shift();n.set(a.id(),d),n.set(d.id(),a),this._getNodeMatches(a,d,n,r)})}static getNodeMatches(e,t){let n=new Map;return this._getNodeMatches(e,t,n,!1),n}static getMagicMovePlan1(e,t,n,r,o,a,s){a==null&&(a=new ur);let l=e.isTopLevel()&&n.isTopLevel(),d=new i(e,t,n,r);if(e.type()=="BOOLEAN_OPERATION"||n.type()=="BOOLEAN_OPERATION")return d;for(let p=0;p<n.childCount();p=p+1){let u=n.childAt2(p,!0),h=Be.StringMap_get(o,u.id(),null);h==null?d._appendChild(this._generatePlanForInsertedNode(u,r,s)):d._appendChild(this._generatePlanForMatchedNodes(h,t,u,r,o,s))}let c=0;for(;c<e.childCount();){let p=[],u=c,h=c;for(;c<e.childCount();){let b=e.childAt2(c,!0);if(o.has(b.id()))break;p.push(this._generatePlanForRemovedNode(b,t,s)),h=c,c=c+1}if(p.length==0){c=c+1;continue}let f=-1,y=d.children.length;if(u-1>=0){let b=e.childAt2(u-1,!0);if(b!=null){let _=Be.StringMap_get(o,b.id(),null);_!=null&&(f=d.indexOfSceneNodeInChildren(_))}}if(h+1<e.childCount()){let b=e.childAt2(h+1,!0);if(b!=null){let _=Be.StringMap_get(o,b.id(),null);_!=null&&(y=d.indexOfSceneNodeInChildren(_))}}let g=Math.min(f,y),A=Math.max(f,y),T=s.drawsEnteringFrameOnTopOfExitingFrame()?g+1:A;d.insertChildren(T,p)}if(l){d._enabledTraits&=-5,d._enabledTraits&=-9,d._enabledTraits&=-65,d._enabledTraits&=-3,d._enabledTraits&=-33,d._enabledTraits&=-129;let p=e.clipsToBoundingRectangle()&&e.containerSupportsFillStrokeAndCorners()||n.clipsToBoundingRectangle()&&n.containerSupportsFillStrokeAndCorners(),u=new i(e,t,n,r);u._enabledTraits=156,p&&(u._enabledTraits&=-9),u._isDissolve=!0,u.setTransition(new ur);let h=p;if(e.fillGeometry()!=null&&n.fillGeometry()!=null&&(h=h&&!e.fillGeometry().geometryEquals(n.fillGeometry())),h){let g=d,A=new i(e,t,n,r);A._enabledTraits=20,A.setTransition(new ur),A._forceMask=!0,A._isDissolve=!0,d=new i(e,t,n,r),d._enabledTraits=0,d._isDissolve=!1,d.setTransition(new ur),d._appendChild(A),d._appendChild(g)}else d._enabledTraits|=130;let f=[u,d];if(p){let g=new i(e,t,n,r);g._enabledTraits=24,g._isDissolve=!0,g.setTransition(new ur),f.push(g)}a.opacity(e.opacity(),n.opacity());let y=new i(e,t,n,r);return y._enabledTraits=224,y.insertChildren(0,f),y.setTransition(a),y}else return d}static getMagicMovePlanForStateSwapTransition(e,t){var s;let n=this.getNodeMatches(e,t),r=((s=t.parent())==null?void 0:s.absoluteTransform())??vt.FrozenAffineTransform_IDENTITY,o=this._generatePlanForMatchedNodes(e,vt.FrozenAffineTransform_IDENTITY,t,vt.FrozenAffineTransform_IDENTITY,n,Rn.DISSOLVE),a=o.transition;return o.setTransition(a.clone().transform(r.clone().multipliedBy1(a.from().transform1()),r.clone().multipliedBy1(a.to().transform1()))),vb&&(console.log("------------------------------"),console.log("getMagicMovePlanForStateSwapTransition between interactive component states"),console.log(o.debugString()),console.log("------------------------------")),o}static getMagicMovePlan2(e,t,n,r,o){let a=this.getNodeMatches(e,n),s=new ur().transform(t.clone().multipliedBy1(e.absoluteTransform()),r.clone().multipliedBy1(n.absoluteTransform()));return this.getMagicMovePlan1(e,t,n,r,a,s,o)}static renderTreeForMagicMove(e,t,n,r,o){let a=ne.new2().copyFrom(e.absoluteTransform());a.invert();let s=ne.new2();s.leftMultiply(a),s.leftMultiply(t.absoluteTransform());let l=vt.FrozenAffineTransform_IDENTITY,d=e.size().max2(t.size()),c=this.getMagicMovePlan2(e,s,t,l,o.withScaledTranslation(d)),p=!0,u=()=>p?0:n(),h=new Ni(c,null,u,r),f=Re.renderTreeWithPerfLogging1(h,"renderTreeForMagicMove");return vb&&(console.log("------------------------------"),console.log(`renderTreeForMagicMove between top-level frames ${e.id()} -> ${t.id()}`),console.log(c.debugString()),console.log(f.debugString1()),console.log("------------------------------")),p=!1,f}forDissolveStart1(){return this.forDissolveStart2(null)}forDissolveStart2(e){let t=new i(this._oldSceneNode,this._oldCanvasToRenderTreeTransform,null,null);t._enabledTraits=this._enabledTraits,t._forceMask=this._forceMask;let r=(Y.keepReferenceTransitionDissolve()?this._referenceTransitionForChildrenNodes:this._transition).clone().opacity(this._oldSceneNode.opacity(),this._oldSceneNode.opacity());return this._oldSceneNode!=null&&this._newSceneNode!=null&&(this._oldSceneNode.type()=="TEXT"||this._newSceneNode.type()=="TEXT"?this._maybeUpdateDissolveTransitionsForText(this._oldSceneNode,this._newSceneNode,o=>{r.scaling(Ie.FrozenVector_ONE,new I(o,o))},r.to().transform1(),o=>{r.transform(r.from().transform1(),o)}):r.hasTransitioningGeometryForRoundedRectangles()||r.scaling(Ie.FrozenVector_ONE,gp(this._newSceneNode).divide1(gp(this._oldSceneNode))),r.transformOrigin(this._oldSceneNode.size().divide(2),this._newSceneNode.size().divide(2))),t._isDissolve=!1,t.setTransition(r),e!=null&&(r.from().scaling1().divide1(r.to().scaling1()).equals(e.from().scaling1().divide1(e.to().scaling1()))||(t._scalesIndependentlyOfParent=!0)),this.children.forEach(o=>{o._oldSceneNode!=null&&t._appendChild(o.forDissolveStart2(r))}),t}forDissolveEnd1(){return this.forDissolveEnd2(null)}forDissolveEnd2(e){let t=new i(null,null,this._newSceneNode,this._newCanvasToRenderTreeTransform);t._enabledTraits=this._enabledTraits,t._forceMask=this._forceMask;let r=(Y.keepReferenceTransitionDissolve()?this._referenceTransitionForChildrenNodes:this._transition).clone().opacity(this._newSceneNode.opacity(),this._newSceneNode.opacity());return this._oldSceneNode!=null&&this._newSceneNode!=null&&(this._oldSceneNode.type()=="TEXT"||this._newSceneNode.type()=="TEXT"?this._maybeUpdateDissolveTransitionsForText(this._newSceneNode,this._oldSceneNode,o=>{r.scaling(new I(o,o),Ie.FrozenVector_ONE)},r.from().transform1(),o=>{r.transform(o,r.to().transform1())}):r.hasTransitioningGeometryForRoundedRectangles()||r.scaling(gp(this._oldSceneNode).divide1(gp(this._newSceneNode)),Ie.FrozenVector_ONE),r.transformOrigin(this._oldSceneNode.size().divide(2),this._newSceneNode.size().divide(2))),t._isDissolve=!1,t.setTransition(r),e!=null&&(r.from().scaling1().divide1(r.to().scaling1()).equals(e.from().scaling1().divide1(e.to().scaling1()))||(t._scalesIndependentlyOfParent=!0)),this.children.forEach(o=>{o._newSceneNode!=null&&t._appendChild(o.forDissolveEnd2(r))}),t}_maybeUpdateDissolveTransitionsForText(e,t,n,r,o){if(t.type()!="TEXT"||e.type()!="TEXT")return;let a=t.textGeometry(),s=e.textGeometry(),l=1;!t.textHasMixedFontSizes()&&!e.textHasMixedFontSizes()&&t.fontSize()>0&&e.fontSize()>0&&(l=t.fontSize()/e.fontSize(),n(l));let d=I.new2(),c=G.new4(t.relativeTransform().translation(),t.size()),p=G.new4(e.relativeTransform().translation(),e.size()),u=null,h=null,f=G.new2();switch(t.textAlignHorizontal()==e.textAlignHorizontal()?(u=a.bounds,h=s.bounds):(u=c,h=p),f.copyFrom(h).scaledBy1(l),e.textAlignHorizontal()){case"RIGHT":{d.setX(u.right()-h.right()-(f.right()-h.right()));break}case"CENTER":case"JUSTIFIED":{d.setX(u.center().x()-h.center().x()-(f.center().x()-h.center().x()));break}}switch(t.textAlignVertical()==e.textAlignVertical()?(u=a.bounds,h=s.bounds):(u=c,h=p),f.copyFrom(h).scaledBy1(l),e.textAlignVertical()){case"BOTTOM":{d.setY(u.bottom()-h.bottom()-(f.bottom()-h.bottom()));break}case"CENTER":{d.setY(u.center().y()-h.center().y()-(f.center().y()-h.center().y()));break}}if(!d.equals(I.new2())){let y=ne.new3(r);y.translate1(d),o(y)}}sceneNode(){return this._oldSceneNode??this._newSceneNode}isEverVisible(){return this._isSceneNodeEverVisible(this._oldSceneNode)||this._isSceneNodeEverVisible(this._newSceneNode)}_isSceneNodeEverVisible(e){return e!=null&&e.visible()&&e.opacity()>0}absoluteTransform1(e){return Y.smartAnimateCacheTransform()?this.absoluteTransform2WithCaching(e,1):this.absoluteTransform2(e,1)}invalidateCachedAbsoluteTransformsForSelf(){Y.smartAnimateCacheTransform()&&(this._lastInputTForAbsoluteTransform=-1,this._interpolateScalingToCachedAbsoluteTransform[0]=null,this._interpolateScalingToCachedAbsoluteTransform[1]=null)}absoluteTransform2WithCaching(e,t){return e!=this._lastInputTForAbsoluteTransform&&(this._lastInputTForAbsoluteTransform=e,this._interpolateScalingToCachedAbsoluteTransform[0]=null,this._interpolateScalingToCachedAbsoluteTransform[1]=null),this._interpolateScalingToCachedAbsoluteTransform[t]||(this._interpolateScalingToCachedAbsoluteTransform[t]=this.absoluteTransform2(e,t)),this._interpolateScalingToCachedAbsoluteTransform[t]}absoluteTransform2(e,t){let n=ne.new2();if(this._transition!=null){let r=this._transition.interpolateTranslation(e);n.translate1(r)}if(this._parent!=null&&n.multiply(this._parent.absoluteTransform2(e,0)),this._transition!=null){let r=this._transition.interpolateTransform(e);if(n.multiply(r),t){let o=this._transition.interpolateScaling(e);n.scale3(o)}}return n}rotatesOrScales1(){return this.rotatesOrScales2(!0)}rotatesOrScales2(e){let t=this._transition!=null;return e?t=t&&!this._transition.from().equalTransformsUpToTranslation(this._transition.to(),1e-10):t=t&&!this._transition.from().equalTransformsUpToTranslationAndScaling(this._transition.to(),1e-10),this._parent!=null&&(t=t||this._parent.rotatesOrScales2(!1)),t}_appendChild(e){e._parent=this,this._children.push(e)}insertChildren(e,t){for(let n of t)n._parent=this;g_(this._children,e,t)}removeChild(e){this._children.splice(e,1)}debugString(){let e=new Kg;return i.debugStringRecursive(this,e,!0,!0),e.result}indexOfSceneNodeInChildren(e){for(let t=0;t<this.children.length;t=t+1){let n=this.children[t];if(n._oldSceneNode==e||n._newSceneNode==e)return t}return-1}indexInParent(){return this._parent!=null?this._parent.children.indexOf(this):-1}},Kg=class{constructor(){this.result="",this.indent=""}},Ni=class i{constructor(){if(arguments.length==4){let e=arguments[0],t=arguments[1],n=arguments[2],r=arguments[3];this._planNode=null,this._node=null,this._sceneNodeCursor=null,this._getEasedT=null,this._easingFunction=null,this.initialize(e,t,n,r)}else if(arguments.length==3){let e=arguments[0],t=arguments[1],n=arguments[2];this._planNode=null,this._node=null,this._sceneNodeCursor=null,this._getEasedT=null,this._easingFunction=null,this.initialize(e,null,t,n)}}initialize(e,t,n,r){this._planNode=e,this._node=t,this._getEasedT=n,this._easingFunction=r,this._updateSceneNodeCursorForCurrentPlanNode()}clone(){return new i(this._planNode,this._node,this._getEasedT,this._easingFunction)}_updateSceneNodeCursorForCurrentPlanNode(){let e=this._planNode.sceneNode();if(e==null){this._sceneNodeCursor=null;return}this._sceneNodeCursor==null?this._sceneNodeCursor=new jt(e):this._sceneNodeCursor.setNode(e)}moveToChildAt(e){this._planNode=this._planNode.children[e],this._node=this._node!=null&&e<this._node.childCount()?this._node.childAt2(e,!0):null,this._updateSceneNodeCursorForCurrentPlanNode()}moveToParent(){this._planNode=this._planNode.parent,this._node=this._node!=null?this._node.parent():null,this._updateSceneNodeCursorForCurrentPlanNode()}isRoot(){return this._planNode.parent==null}hasTransitioningPaints(){return this._planNode.transition.hasTransitioningPaints()}indexInParent(){return this._planNode.indexInParent()}renderableContentType(){return this.hasCustomRenderTree()?Sn.RenderableContentType.CUSTOM_RENDER_TREE:16&this._planNode.enabledTraits?this._sceneNodeCursor!=null?this._sceneNodeCursor.renderableContentType():Sn.RenderableContentType.NON_RENDERABLE:Sn.RenderableContentType.RENDERABLE_GROUP}isFrameLike(){return this._planNode.isDissolve?!1:Jt.isFrameLike(this.type())}isTopLevel(){return!1}paintsDebugString(){return`AnimationPlanNode [from=${this._planNode._oldSceneNode.paintsDebugString()}] [to=${this._planNode._newSceneNode.paintsDebugString()}]`}subtreeWillChange(){var t,n;if(this._planNode.cachedSubtreeWillChange!==void 0)return this._planNode.cachedSubtreeWillChange;if(this._sceneNodeCursor.node!=null&&this._sceneNodeCursor.node.isTopLevel())return this._planNode.cachedSubtreeWillChange=!0,!0;if((t=this._planNode._oldSceneNode)!=null&&t.hasBackgroundBlurs()||(n=this._planNode._newSceneNode)!=null&&n.hasBackgroundBlurs())return this._planNode.cachedSubtreeWillChange=!0,!0;if(!this._planNode.isEverVisible())return this._planNode.cachedSubtreeWillChange=!1,!1;if(this.willChange()!==0)return this._planNode.cachedSubtreeWillChange=!0,!0;if(this._planNode.isDissolve||this._planNode.transition!=null&&(this._planNode.transition.hasTransitioningPaints()||this._planNode.transition.hasTransitioningGeometryForRoundedRectangles()))return this._planNode.cachedSubtreeWillChange=!0,!0;if(this.childCount()===0)return this._planNode.cachedSubtreeWillChange=!1,!1;for(let r=this.childCount()-1;r>=0;r=r-1){this.moveToChildAt(r);let o=this.subtreeWillChange();if(this.moveToParent(),o!=!1)return this._planNode.cachedSubtreeWillChange=!0,!0}return this._planNode.cachedSubtreeWillChange}willChange(){if(this._planNode.transition==null||!this._planNode.isEverVisible())return 0;let e=0;return this._planNode.transition.from().opacity1()!=this._planNode.transition.to().opacity1()&&(e|=2),(this._planNode.transition.hasTransitioningTranslation()||this._planNode.transition.hasTransitioningTransform()||this._planNode.transition.hasTransitioningScaling()||this._planNode.transition.hasTransitioningTransformOrigin())&&(e|=1),this._planNode.scalesIndependentlyOfParent&&(e|=1),e}size(){return this._planNode.sceneNode().size()}shouldOptimizeShadowForAnimation(e){return e==null||e.equals(Ie.FrozenVector_ZERO)?!1:this._planNode.rotatesOrScales1()}hasCustomRenderTree(){return this._planNode.isDissolve}customRenderTree(e){var t,n,r,o;if(this._planNode.isDissolve){let a=this._planNode.indexInParent(),s=this._planNode.forDissolveStart1();(t=this._planNode.parent)==null||t.insertChildren(a,[s]);let l=Re.generateRenderTree(new i(s,this._getEasedT,this._easingFunction),e);(n=this._planNode.parent)==null||n.removeChild(a);let d=null;if(this._node!=null&&this._node.hasBackgroundBlurs())d=Re.generateRenderTree(new jt(this._node),e);else{let p=this._planNode.forDissolveEnd1();(r=this._planNode.parent)==null||r.insertChildren(a,[p]),d=Re.generateRenderTree(new i(p,this._getEasedT,this._easingFunction),e),(o=this._planNode.parent)==null||o.removeChild(a)}let c=new dr(l,d,It.forAnimateableDissolve(this._planNode.sceneNode().id()),this._getEasedT);if(Y.keepReferenceTransitionDissolve())this._planNode.clearTransitionForDissolveRenderTrees();else{let p=this._planNode.transition.clone().transform(ne.new2(),ne.new2());this._planNode.setTransition(p)}return this._planNode.invalidateCachedAbsoluteTransformsForSelf(),this._planNode.cachedSubtreeWillChange=!0,c}throw new Error("Unhandled customRenderTree case")}opacity(){return 32&this._planNode.enabledTraits?this._planNode.transition!=null?this._planNode.transition.interpolateOpacity(this._getEasedT()):this._sceneNodeCursor.opacity():1}absoluteTransform(){return Dt.didEncounterSmartAnimateCacheTransform(),this._planNode.absoluteTransform1(this._getEasedT())}maxTransformScale(){let e=this._planNode.transition;if(e==null)return 1;let t=e.from().scaling1(),r=e.to().scaling1().divide1(t).min1();return Math.max(r,1)}scene(){return this._sceneNodeCursor.scene()}parent(){if(this._planNode.parent==null)return null;let e=this._node!=null?this._node.parent():null;return new i(this._planNode.parent,e,this._getEasedT,this._easingFunction)}blendMode(){return 32&this._planNode.enabledTraits?this._sceneNodeCursor.blendMode():"PASS_THROUGH"}visible(){return this._sceneNodeCursor.visible()}isVisibleMask(){return this._planNode.forceMask?!0:128&this._planNode.enabledTraits?this._sceneNodeCursor.isVisibleMask():!1}maskType(){return this._sceneNodeCursor.maskType()}isSpreadEligibleNode(){return this._sceneNodeCursor.isSpreadEligibleNode()}type(){return this._sceneNodeCursor.type()}childCount(){return this._planNode.children.length}clipsChildren(){return 2&this._planNode.enabledTraits?this._sceneNodeCursor.clipsChildren():!1}stopsMaskPropagation(){return this._planNode.forceMask?!0:128&this._planNode.enabledTraits?this._sceneNodeCursor.stopsMaskPropagation():!1}strokeAlign(){return this._sceneNodeCursor.strokeAlign()}strokeWeight(){return this._sceneNodeCursor.strokeWeight()}uniqueIdentifier(){return this._sceneNodeCursor.id()}isInsideOutlineMask(){return this._sceneNodeCursor.isInsideOutlineMask()}textData(){return this._sceneNodeCursor.textData()}derivedTextData(){return this._sceneNodeCursor.derivedTextData()}arcData(){return this._sceneNodeCursor.arcData()}roundedRectInfo(){return this._sceneNodeCursor.roundedRectInfo()}fillGeometry(){if(16&this._planNode.enabledTraits){if(this._planNode.transition!=null&&this._planNode.transition.hasTransitioningGeometryForRoundedRectangles())return this._planNode.transition.fillGeometryForRoundedRectangles(this._getEasedT,this._easingFunction.bounds)}else return null;return this._sceneNodeCursor.fillGeometry()}strokeGeometry(){return 16&this._planNode.enabledTraits?this._sceneNodeCursor.strokeGeometry():null}fillGeometryForSpread(e,t,n){return 16&this._planNode.enabledTraits&&this._planNode.transition!=null&&this._planNode.transition.hasTransitioningGeometryForRoundedRectangles()?this._planNode.transition.fillGeometryForSpreadDynamic(e,t,this._getEasedT,n,this.uniqueIdentifier(),this._easingFunction.bounds):this._sceneNodeCursor.fillGeometryForSpread(e,t,n)}strokeGeometryForSpread(e,t,n,r){return this._sceneNodeCursor.strokeGeometryForSpread(e,t,n,r)}textGeometry(){return 16&this._planNode.enabledTraits?this._sceneNodeCursor.textGeometry():null}getCachedRenderTree(){return null}getCachedBaseScreenRenderTree(){return null}renderTree(){if(Dt.didEncounterStaticRenderTreeAnimationOpt(),Y.useStaticRenderTreeIfNonAnimatingSubtree()&&this._sceneNodeCursor!=null&&!this.subtreeWillChange()){let t=this._planNode._oldCanvasToRenderTreeTransform,n=null;return this._sceneNodeCursor.node.getCachedRenderTreeForBaseScreen()!=null?n=this._sceneNodeCursor.node.renderTreeForBaseScreen1():n=this._sceneNodeCursor.renderTree(),n!=null&&t!=null?new wr(n,t):n}let e=new Re.GenerateArgs(Re.RenderMode.NORMAL);return Re.generateRenderTree(this.clone(),e)}renderTreeWithoutBackgroundBlurs(){if(Y.useStaticRenderTreeIfNonAnimatingSubtree()&&this._sceneNodeCursor!=null&&!this.subtreeWillChange()){let t=this._planNode._oldCanvasToRenderTreeTransform,n=this._sceneNodeCursor.renderTreeWithoutBackgroundBlurs();return n!=null&&t!=null?new wr(n,t):n}let e=new Re.GenerateArgs(Re.RenderMode.WITHOUT_BACKGROUND_BLURS);return Re.generateRenderTree(this.clone(),e)}renderTreeForShadowRoot(){if(Y.useStaticRenderTreeIfNonAnimatingSubtree()&&this._sceneNodeCursor!=null&&!this.subtreeWillChange()){let t=this._planNode._oldCanvasToRenderTreeTransform,n=this._sceneNodeCursor.renderTreeForShadowRoot();return n!=null&&t!=null?new wr(n,t):n}let e=new Re.GenerateArgs(Re.RenderMode.SHADOW,this.uniqueIdentifier());return Re.generateRenderTree(this.clone(),e)}renderTreeForShadowDescendant(){if(Y.useStaticRenderTreeIfNonAnimatingSubtree()&&this._sceneNodeCursor!=null&&!this.subtreeWillChange()){let t=this._planNode._oldCanvasToRenderTreeTransform,n=this._sceneNodeCursor.renderTreeForShadowDescendant();return n!=null&&t!=null?new wr(n,t):n}let e=new Re.GenerateArgs(Re.RenderMode.SHADOW);return Re.generateRenderTree(this.clone(),e)}renderTreeForKnockoutShadowRoot(){if(Y.useStaticRenderTreeIfNonAnimatingSubtree()&&this._sceneNodeCursor!=null&&!this.subtreeWillChange()){let t=this._planNode._oldCanvasToRenderTreeTransform,n=this._sceneNodeCursor.renderTreeForKnockoutShadowRoot();return n!=null&&t!=null?new wr(n,t):n}let e=new Re.GenerateArgs(Re.RenderMode.KNOCKOUT_SHADOW,this.uniqueIdentifier());return Re.generateRenderTree(this.clone(),e)}renderTreeForKnockoutShadowDescendant(){if(Y.useStaticRenderTreeIfNonAnimatingSubtree()&&this._sceneNodeCursor!=null&&!this.subtreeWillChange()){let t=this._planNode._oldCanvasToRenderTreeTransform,n=this._sceneNodeCursor.renderTreeForKnockoutShadowDescendant();return n!=null&&t!=null?new wr(n,t):n}let e=new Re.GenerateArgs(Re.RenderMode.KNOCKOUT_SHADOW);return Re.generateRenderTree(this.clone(),e)}isFixed(){return this._sceneNodeCursor.isFixed()}isStandardScrolling(){return this._sceneNodeCursor.isStandardScrolling()}isStickyScrolling(){return this._sceneNodeCursor.isStickyScrolling()}scrollOffset(){return 1&this._planNode.enabledTraits?this._sceneNodeCursor.scrollOffset():Ie.FrozenVector_ZERO}scrollDirection(){return 1&this._planNode.enabledTraits?this._sceneNodeCursor.scrollDirection():"NONE"}hasOverflowingContentInScrollDirection(){return 1&this._planNode.enabledTraits?this._sceneNodeCursor.hasOverflowingContentInScrollDirection():!1}effects(){return this._planNode.isDissolve||!(64&this._planNode.enabledTraits)?[]:this._sceneNodeCursor.effects()}fillPaints(){var t;if(!(4&this._planNode.enabledTraits))return Ne.EMPTY;if(this._planNode.forceMask)return[ie.createSolid(E.BLACK,1)];let e=((t=this._planNode.transition)==null?void 0:t.fillPaints2(this._getEasedT))??[];return e.length==0?this._sceneNodeCursor.fillPaints():e}strokePaints(){var t;if(!(8&this._planNode.enabledTraits))return Ne.EMPTY;let e=((t=this._planNode.transition)==null?void 0:t.strokePaints2(this._getEasedT))??[];return e.length==0?this._sceneNodeCursor.strokePaints():e}fillPaintsToRender(){return 4&this._planNode.enabledTraits?this._sceneNodeCursor.fillPaintsToRender():Ne.EMPTY}videoPlayback(){return this._sceneNodeCursor.videoPlayback()}containerSupportsFillStrokeAndCorners(){return this._sceneNodeCursor.containerSupportsFillStrokeAndCorners()}isGroup(){return this._sceneNodeCursor.isGroup()}hasNonZeroStrokeWeight(){return this._sceneNodeCursor.hasNonZeroStrokeWeight()}hasPerRegionFillPaints(){return this._sceneNodeCursor.hasPerRegionFillPaints()}forEachRegionWithFillPaintBatch(e){this._sceneNodeCursor.forEachRegionWithFillPaintBatch(e)}overrideKey(){return this._sceneNodeCursor.node.overrideKey()}name(){return this._sceneNodeCursor.node.name()}getSemanticNodePath(){return this._sceneNodeCursor.getSemanticNodePath()}hasBackgroundBlurs(){return this._sceneNodeCursor.hasBackgroundBlurs()}overlayRenderData(){return this._sceneNodeCursor.overlayRenderData()}};function gp(i){if(i.fillGeometry()!=null&&i.fillGeometry().regions.length!=0)return i.size();let e=i.size().x()<=.1,t=i.size().y()<=.1;if(e==t)return i.size();let n=Math.max(i.strokeWeight(),.1),r=I.new3(i.size());return e?r.setX(n):r.setY(n),r}var Dn;(a=>{function i(s){return s=="PUSH_FROM_LEFT"||s=="PUSH_FROM_RIGHT"||s=="PUSH_FROM_TOP"||s=="PUSH_FROM_BOTTOM"}a.isPush=i;function e(s){return s=="MOVE_FROM_LEFT"||s=="MOVE_FROM_RIGHT"||s=="MOVE_FROM_TOP"||s=="MOVE_FROM_BOTTOM"}a.isMove=e;function t(s){return s=="SLIDE_FROM_LEFT"||s=="SLIDE_FROM_RIGHT"||s=="SLIDE_FROM_TOP"||s=="SLIDE_FROM_BOTTOM"}a.isSlide=t;function n(s){return s=="MOVE_OUT_TO_LEFT"||s=="MOVE_OUT_TO_RIGHT"||s=="MOVE_OUT_TO_TOP"||s=="MOVE_OUT_TO_BOTTOM"}a.isMoveOut=n;function r(s){return s=="SLIDE_OUT_TO_LEFT"||s=="SLIDE_OUT_TO_RIGHT"||s=="SLIDE_OUT_TO_TOP"||s=="SLIDE_OUT_TO_BOTTOM"}a.isSlideOut=r;function o(s){return i(s)||e(s)||n(s)||t(s)||r(s)}a.supportsSmartAnimate=o})(Dn||(Dn={}));var _o=class i{constructor(){var e,t;if(arguments.length==3){let n=arguments[0],r=arguments[1],o=arguments[2];if(this._sceneCursor=null,this._planTrees=null,this._activeCursor=null,this._activeTransitionKey=null,this._activeTransitionIndexInParent=-1,this.transitionMap=null,this._planTrees=new Map,this.transitionMap=r,n.transitioningFrom!=null){let a=n.transitioningFrom.swappedStablePath.toString();this._activeTransitionKey=a;let s=this._getOrCreateSmartAnimatePlanTreeAt(n,this._activeTransitionKey);if(s!=null){let l=this.transitionMap.get(a).progress,d=this.transitionMap.get(a).change.transitionParameters;this._activeCursor=new Ni(s,n,l,d.easingFunction);return}}this._sceneCursor=new jt(n,o),this._activeCursor=this._sceneCursor}else if(arguments.length==1){let n=arguments[0];this._sceneCursor=null,this._planTrees=null,this._activeCursor=null,this._activeTransitionKey=null,this._activeTransitionIndexInParent=-1,this.transitionMap=null,this._sceneCursor=(e=n._sceneCursor)==null?void 0:e.clone(),this._planTrees=n._planTrees,n._activeCursor==n._sceneCursor?this._activeCursor=this._sceneCursor:this._activeCursor=(t=n._activeCursor)==null?void 0:t.clone(),this._activeTransitionKey=n._activeTransitionKey,this._activeTransitionIndexInParent=n._activeTransitionIndexInParent,this.transitionMap=n.transitionMap}}clone(){return new i(this)}_getOrCreateSmartAnimatePlanTreeAt(e,t){let n=this.transitionMap.get(t).change.transitionParameters;if(n.transitionType=="SMART_ANIMATE"||Dn.supportsSmartAnimate(n.transitionType)&&n.transitionShouldSmartAnimate){if(!this._planTrees.has(t)){let r=Fo.getMagicMovePlanForStateSwapTransition(e.transitioningFrom.exitingTransitionRoot,e);this._planTrees.set(t,r)}return this._planTrees.get(t)}return null}moveToChildAt(e){if(this._activeTransitionKey==null&&this._sceneCursor!=null){let t=this._sceneCursor.node.childAt2(e,!0);if(t.transitioningFrom!=null){this._activeTransitionIndexInParent=e;let n=t.transitioningFrom.swappedStablePath.toString();this._activeTransitionKey=n;let r=this._getOrCreateSmartAnimatePlanTreeAt(t,this._activeTransitionKey);if(r!=null){let o=this.transitionMap.get(n).progress,a=this.transitionMap.get(n).change.transitionParameters;this._sceneCursor.moveToChildAt(e),this._activeCursor=new Ni(r,t,o,a.easingFunction);return}}}this._activeCursor.moveToChildAt(e)}moveToParent(){this._activeCursor.isRoot()?(this._sceneCursor.moveToParent(),this._activeCursor=this._sceneCursor,this._activeTransitionIndexInParent=-1,this._activeTransitionKey=null):(this._activeCursor==this._sceneCursor&&(this._activeTransitionKey=null),this._activeCursor.moveToParent())}isRoot(){return this._activeCursor.isRoot()?this._sceneCursor==null||this._sceneCursor==this._activeCursor:!1}indexInParent(){return!this.isRoot()&&this._activeCursor.isRoot()?this._activeTransitionIndexInParent:this._activeCursor.indexInParent()}renderableContentType(){return this._activeCursor==this._sceneCursor&&this._sceneCursor.node.transitioningFrom!=null?Sn.RenderableContentType.CUSTOM_RENDER_TREE:this._activeCursor.renderableContentType()}isFrameLike(){return this._activeCursor==this._sceneCursor&&this._sceneCursor.node.transitioningFrom!=null?!1:this._activeCursor.isFrameLike()}isTopLevel(){return this._activeTransitionKey!=null||this._sceneCursor==null?!1:this._sceneCursor.node.isTopLevel()}paintsDebugString(){return`PlaybackCursor ${this._sceneCursor.node.paintsDebugString()}`}willChange(){return this._activeCursor.willChange()}shouldOptimizeShadowForAnimation(e){return this._activeCursor.shouldOptimizeShadowForAnimation(e)}customRenderTree(e){if(this._sceneCursor==this._activeCursor&&this._sceneCursor.node.transitioningFrom!=null){let t=this.transitionMap.get(this._activeTransitionKey).progress,n=this.transitionMap.get(this._activeTransitionKey).change,r=n.transitionParameters,o=Rn.get(r.transitionType);n.direction==1&&(o=o.reversed());let a=this._sceneCursor.node,s=a.transitioningFrom.exitingTransitionRoot,l=Re.generateRenderTree(new jt(a),e),d=Re.generateRenderTree(new jt(s),e),c=a.size().max2(s.size()),p=null;l!=null&&(p=at.forTransformIsolation(l)),p!=null?(p=at.forOpacity(p,It.forAnimateableOpacity(a.id()),()=>o.enteringFrameTransition().interpolateOpacity(t())),p=at.forTranslation(p,It.forAnimateableTranslation(a.id()),()=>c.multiply1(o.enteringFrameTransition().interpolateTranslation(t())))):p=new ze([]);let u=null;if(d!=null&&(u=at.forTransformIsolation(d)),u!=null?(u=at.forOpacity(u,It.forAnimateableOpacity(s.id()),()=>o.exitingFrameTransition().interpolateOpacity(t())),u=at.forTranslation(u,It.forAnimateableTranslation(s.id()),()=>c.multiply1(o.exitingFrameTransition().interpolateTranslation(t())))):u=new ze([]),o.isDissolve()){let h=It.forAnimateableDissolve(a.id());return new dr(u,p,h,t)}else return o.drawsEnteringFrameOnTopOfExitingFrame()?ze.wrap([u,p]):ze.wrap([p,u])}return this._activeCursor.customRenderTree(e)}name(){return this._activeCursor.name()}scene(){return this._activeCursor.scene()}parent(){if(this.isRoot())return null;let e=this.clone();return e.moveToParent(),e}blendMode(){return this._activeCursor.blendMode()}opacity(){return this._activeCursor.opacity()}visible(){return this._activeCursor.visible()}isVisibleMask(){return this._activeCursor.isVisibleMask()}maskType(){return this._activeCursor.maskType()}isSpreadEligibleNode(){return this._activeCursor.isSpreadEligibleNode()}type(){return this._activeCursor.type()}childCount(){return this._activeCursor.childCount()}absoluteTransform(){return this._activeCursor.absoluteTransform()}maxTransformScale(){return this._activeCursor.maxTransformScale()}clipsChildren(){return this._activeCursor.clipsChildren()}stopsMaskPropagation(){return this._activeCursor.stopsMaskPropagation()}arcData(){return this._activeCursor.arcData()}roundedRectInfo(){return this._activeCursor.roundedRectInfo()}fillGeometry(){return this._activeCursor.fillGeometry()}strokeGeometry(){return this._activeCursor.strokeGeometry()}fillGeometryForSpread(e,t,n){return this._activeCursor.fillGeometryForSpread(e,t,n)}strokeGeometryForSpread(e,t,n,r){return this._activeCursor.strokeGeometryForSpread(e,t,n,r)}size(){return this._activeCursor.size()}strokeAlign(){return this._activeCursor.strokeAlign()}strokeWeight(){return this._activeCursor.strokeWeight()}uniqueIdentifier(){return this._activeCursor.uniqueIdentifier()}isInsideOutlineMask(){return this._activeCursor.isInsideOutlineMask()}textData(){return this._activeCursor.textData()}derivedTextData(){return this._activeCursor.derivedTextData()}textGeometry(){return this._activeCursor.textGeometry()}getCachedRenderTree(){return this._activeCursor.getCachedRenderTree()}_shouldPreemptivelyMarkAsVolatile(){if(Y.shouldPreventVolatileCaching())return!1;let e=this._sceneCursor.node.canvas().parent().scene(),t=this._sceneCursor.node;if(!t.isInstance())return!1;let n=1;if(t.stablePath().guids.length>n+1)return!1;let r=e.findNode1(t.symbolID());return(r==null?void 0:r.parent())==null?!1:r.parent().isStateGroup()}renderTree(){if(this._sceneCursor==null){let e=new Re.GenerateArgs(Re.RenderMode.NORMAL);return Re.generateRenderTree(this.clone(),e)}else if(this._activeCursor==this._sceneCursor){let e=this._sceneCursor.node.renderTree2(this);return this._activeCursor.scene().interactiveComponentsEnabled()&&this._shouldPreemptivelyMarkAsVolatile()&&e!=null?at.forStateSwap(e):e}else{if(this._activeCursor.isRoot())return this._sceneCursor.node.renderTree2(this);{let e=new Re.GenerateArgs(Re.RenderMode.NORMAL);return Re.generateRenderTree(this.clone(),e)}}}renderTreeWithoutBackgroundBlurs(){return this._activeCursor.renderTreeWithoutBackgroundBlurs()}renderTreeForShadowRoot(){if(this._sceneCursor!=null&&(this._activeCursor==this._sceneCursor||this._activeCursor.isRoot()))return this._sceneCursor.node.renderTreeForShadowRoot2(this);{let e=new Re.GenerateArgs(Re.RenderMode.SHADOW,this.uniqueIdentifier());return Re.generateRenderTree(this.clone(),e)}}renderTreeForShadowDescendant(){if(this._sceneCursor!=null&&(this._activeCursor==this._sceneCursor||this._activeCursor.isRoot()))return this._sceneCursor.node.renderTreeForShadowDescendant2(this);{let e=new Re.GenerateArgs(Re.RenderMode.SHADOW);return Re.generateRenderTree(this.clone(),e)}}renderTreeForKnockoutShadowRoot(){if(this._sceneCursor!=null&&(this._activeCursor==this._sceneCursor||this._activeCursor.isRoot()))return this._sceneCursor.node.renderTreeForKnockoutShadowRoot2(this);{let e=new Re.GenerateArgs(Re.RenderMode.KNOCKOUT_SHADOW,this.uniqueIdentifier());return Re.generateRenderTree(this.clone(),e)}}renderTreeForKnockoutShadowDescendant(){if(this._sceneCursor!=null&&(this._activeCursor==this._sceneCursor||this._activeCursor.isRoot()))return this._sceneCursor.node.renderTreeForKnockoutShadowDescendant2(this);{let e=new Re.GenerateArgs(Re.RenderMode.KNOCKOUT_SHADOW);return Re.generateRenderTree(this.clone(),e)}}isFixed(){return this._activeCursor.isFixed()}isStandardScrolling(){return this._activeCursor.isStandardScrolling()}isStickyScrolling(){return this._activeCursor.isStickyScrolling()}scrollOffset(){return this._activeCursor.scrollOffset()}scrollDirection(){return this._activeCursor.scrollDirection()}hasOverflowingContentInScrollDirection(){return this._activeCursor.hasOverflowingContentInScrollDirection()}effects(){return this._activeCursor.effects()}fillPaints(){return this._activeCursor.fillPaints()}strokePaints(){return this._activeCursor.strokePaints()}fillPaintsToRender(){return this._activeCursor.fillPaintsToRender()}videoPlayback(){return this._activeCursor.videoPlayback()}containerSupportsFillStrokeAndCorners(){return this._activeCursor.containerSupportsFillStrokeAndCorners()}isGroup(){return this._activeCursor.isGroup()}hasNonZeroStrokeWeight(){return this._activeCursor.hasNonZeroStrokeWeight()}hasPerRegionFillPaints(){return this._activeCursor.hasPerRegionFillPaints()}forEachRegionWithFillPaintBatch(e){this._activeCursor.forEachRegionWithFillPaintBatch(e)}overrideKey(){return this._activeCursor.overrideKey()}getSemanticNodePath(){return Cn.getSemanticNodePathHelper(this)}hasBackgroundBlurs(){return this._activeCursor.hasBackgroundBlurs()}overlayRenderData(){return this._activeCursor.overlayRenderData()}};var qg=class{constructor(){this.numTransitions=0,this.numTransitionsWithAnimation=0,this.numNodesWithSmartAnimateTransitionType=0,this.numNodesWithSmartAnimateExtension=0,this.numSlidesPushesOrMovesWithPreserveScrollPosition=0,this.numDragTriggers=0}};var jc=class{constructor(e){this._noodleMap=new na,this._cachedCleanedUpTransitionMapByTlf=null,this._scene=null,this._appState=null,this.triggerPotentialTimedTransition=null,this.createVideoTriggerEventsForNodesInFrame=null,this.createVideoTriggerEventsForAllNodesOnscreen=null,this._topmostScreenChangeCounter=0,this._appState=e,this._appState.addAppObserver(this)}_setPrototypeInteractionsInNoodleMap(e,t){t.some(r=>r.isValid())?this._noodleMap.update(e,t):this._noodleMap.update(e,[])}_setHyperlinkInteractionInNoodleMap(e){if(Bt.isNodeInteractableBecauseOfHyperlinks(e)){let t=Bt.createFakeHyperlinkInteraction();this._setPrototypeInteractionsInNoodleMap(e,[t])}}cleanedUpInteractionMap(){return new na.CleanedMap(this._noodleMap,0,e=>{var n;let t=(n=this._scene)==null?void 0:n.findNode1(e);return Bt.cleanedInteractionsForNode(this._appState,t)})}cleanedUpTransitionMap(){return new na.CleanedMap(this._noodleMap,1,e=>{let t=[];return this.cleanedUpInteractionMap().getHotspotInteractions(e).forEach(n=>{n.interactionContainsTransitionAction()&&t.push(n)}),t})}cleanedUpTransitionMapByTLF(){if(this._cachedCleanedUpTransitionMapByTlf==null){let e=new Eo(t=>t);for(let t of this.cleanedUpTransitionMap().hotspots()){let n=this._scene.findNode1(t);if(n!=null){let r=null,o=n.topLevelAncestor();o!=null&&o.visible()&&(r=o.id()),r!=null&&(e._in(r)||e.set(r,[]),On(e.get1(r),this.cleanedUpTransitionMap().getHotspotInteractions(t).slice()))}}this._cachedCleanedUpTransitionMapByTlf=e}return this._cachedCleanedUpTransitionMapByTlf}transitionStats__DEPRECATED(){let e=new qg;for(let t of this.cleanedUpTransitionMap().hotspots())this.cleanedUpTransitionMap().getHotspotInteractions(t).forEach(n=>{e.numTransitions=e.numTransitions+1,n.event().interactionType()=="DRAG"&&(e.numDragTriggers=e.numDragTriggers+1);let r=n.action()!=null?n.action().value:null;if(r!=null){r.transitionDuration()>0&&(e.numTransitionsWithAnimation=e.numTransitionsWithAnimation+1),r.transitionType()=="SMART_ANIMATE"&&(e.numNodesWithSmartAnimateTransitionType=e.numNodesWithSmartAnimateTransitionType+1),Dn.supportsSmartAnimate(r.transitionType())&&r.transitionShouldSmartAnimate()&&(e.numNodesWithSmartAnimateExtension=e.numNodesWithSmartAnimateExtension+1);let o=Dn.isSlide(r.transitionType())||Dn.isPush(r.transitionType())||Dn.isMove(r.transitionType());r.transitionPreserveScroll()&&o&&(e.numSlidesPushesOrMovesWithPreserveScrollPosition=e.numSlidesPushesOrMovesWithPreserveScrollPosition+1)}});return e}rawInteractionMapForTests(){return new na.RawMapForTests(this._noodleMap)}rawNoodleMap(){return this._noodleMap}handleSceneChange(e,t){this._scene=t,e!=null&&e.removeObserver(this),t!=null&&t.addObserver(this)}handleActiveCanvasChange(e,t){this._noodleMap.noodleNodes.clear(),t!=null&&this._addConnectionsFromSubtree(t),this._cachedCleanedUpTransitionMapByTlf=null}handleActivePrototypeStartingPointChange(e,t){}_addConnectionsFromSubtree(e){this._setPrototypeInteractionsInNoodleMap(e,e.prototypeInteractions()),this._setHyperlinkInteractionInNoodleMap(e);for(let t=0,n=e.childCount();t<n;t=t+1){let r=e.childAt1(t);this._addConnectionsFromSubtree(r)}}_removeConnectionsFromSubtree(e){this._noodleMap.update(e,[]);for(let t=0,n=e.childCount();t<n;t=t+1)this._removeConnectionsFromSubtree(e.childAt1(t))}topmostScreenChangeCounter(){return this._topmostScreenChangeCounter}handleSceneGraphEvent(e){let t=!1;if((Zr.isInteractionProperty(e.property)||Zr.affects(e.property,82))&&(e.node.isRooted()&&(this._setPrototypeInteractionsInNoodleMap(e.node,e.node.prototypeInteractions()),this._setHyperlinkInteractionInNoodleMap(e.node),t=!0),ee.equals(this._appState.baseScreenId(),e.node.id())&&e.node.prototypeInteractions().forEach(n=>{this._topmostScreenChangeCounter=this._topmostScreenChangeCounter+1,n.event().interactionType()=="AFTER_TIMEOUT"?this.triggerPotentialTimedTransition!=null&&this.triggerPotentialTimedTransition():(n.event().interactionType()=="ON_MEDIA_HIT"||n.event().interactionType()=="ON_MEDIA_END")&&this.createVideoTriggerEventsForAllNodesOnscreen!=null&&this.createVideoTriggerEventsForAllNodesOnscreen()})),e.property==8||e.property==9||e.property==14||e.property==81)t=!0,this._noodleMap.invalidateBackRefsForDestinationAndChildren(e.node),this._noodleMap.invalidateHotspotAndChildren(e.node);else if(e.property==25){let n=e.oldVal!=null&&Ze.isParentIndex(e.oldVal)?Ze.asParentIndex(e.oldVal):null,r=e.newVal!=null&&Ze.isParentIndex(e.newVal)?Ze.asParentIndex(e.newVal):null,o=n!=null?e.node.scene().findNode1(n.id):null,a=r!=null?e.node.scene().findNode1(r.id):null,s=o!=null&&o.isRooted(),l=a!=null&&a.isRooted();s&&!l?(this._removeConnectionsFromSubtree(e.node),t=!0):!s&&l&&(this._addConnectionsFromSubtree(e.node),t=!0,this.createVideoTriggerEventsForNodesInFrame!=null&&this.createVideoTriggerEventsForNodesInFrame(e.node)),s&&l&&o.id()!=a.id()&&(t=!0),this._noodleMap.invalidateBackRefsForDestinationAndChildren(e.node)}t&&(this._cachedCleanedUpTransitionMapByTlf=null)}},Cb=(t=>(t[t.CLEANED_INTERACTIONS=0]="CLEANED_INTERACTIONS",t[t.CLEANED_TRANSITIONS=1]="CLEANED_TRANSITIONS",t))(Cb||{}),fp=class{invalidateCaches(){this.caches.set(0,null),this.caches.set(1,null)}constructor(){this.interactions=new zi(e=>e.id()),this.backReferences=new Eo(e=>e),this.caches=new Map([[0,null],[1,null]])}},na=class{update(e,t){var o,a;let n=((a=(o=this.noodleNodes.get(e.id(),null))==null?void 0:o.interactions)==null?void 0:a.asList())??[];for(let s=0,l=n.length;s<l;s=s+1){let d=n[s];this._eraseInteraction(e,d)}for(let s=0,l=t.length;s<l;s=s+1){let d=t[s];this._addInteraction(e,d)}let r=this.noodleNodes.get(e.id(),null);r!=null&&r.interactions.count()==0&&r.backReferences.count()==0&&this.noodleNodes.remove(e.id())}_addInteraction(e,t){let n=e.id(),r=this.noodleNodes.get(n,null)??new fp;this.noodleNodes.set(n,r),r.interactions.add(t);for(let o of t.allActions()){let a=o.transitionNodeID();if(Eb(a,o.connectionType())){let s=this.noodleNodes.get(a,null);s==null&&(s=new fp,this.noodleNodes.set(a,s)),s.backReferences.set(n,s.backReferences.get(n,0)+1)}}r.invalidateCaches()}_eraseInteraction(e,t){let n=e.id(),r=this.noodleNodes.get(n,null);r!=null&&r.interactions.remove(t);for(let o of t.allActions()){let a=o.transitionNodeID();if(Eb(a,o.connectionType())){let s=this.noodleNodes.get(a,null);s!=null&&(s.backReferences.set(n,s.backReferences.get1(n)-1),s.backReferences.get1(n)<=0&&s.backReferences.remove(n))}}r.invalidateCaches()}invalidateHotspotAndChildren(e){ye.forEachNode(e,t=>(this.noodleNodes._in(t.id())&&this.noodleNodes.get1(t.id()).invalidateCaches(),ye.Loop.CONTINUE))}invalidateBackRefsForDestinationAndChildren(e){ye.forEachNode(e,t=>(this.noodleNodes._in(t.id())&&this.noodleNodes.get1(t.id()).backReferences.each((r,o)=>{this.noodleNodes.get1(r).invalidateCaches()}),ye.Loop.CONTINUE))}constructor(){this.noodleNodes=new Eo(e=>e)}};(t=>{class i{_in(r){return this.noodleMap.noodleNodes._in(r)&&this.getHotspotInteractions(r).length!=0}hotspots(){return this.noodleMap.noodleNodes.keys().filter(r=>this.getHotspotInteractions(r).length!=0)}getHotspotInteractions(r){return this.noodleMap.noodleNodes.get1(r).interactions.asList()}constructor(r){this.noodleMap=r}}t.RawMapForTests=i;class e{_in(r){return this.noodleMap.noodleNodes._in(r)?this.getHotspotInteractions(r).length!=0:!1}hotspots(){return this.noodleMap.noodleNodes.keys().filter(r=>this.getHotspotInteractions(r).length!=0)}getHotspotInteractions(r){let o=this.noodleMap.noodleNodes.get1(r);return o.caches.get(this.cacheType)==null&&o.caches.set(this.cacheType,this.computeCacheForHotspot(r)),o.caches.get(this.cacheType)}constructor(r,o,a){this.noodleMap=r,this.cacheType=o,this.computeCacheForHotspot=a}}t.CleanedMap=e})(na||(na={}));var Ib;(e=>{function i(t){return Cb[t]}e.NoodleCache_toString=i})(Ib||(Ib={}));function Eb(i,e){return i!=null&&ee.isValid(i)&&(e=="INTERNAL_NODE"||e=="UPDATE_MEDIA_RUNTIME")}var Xo=class Xo{constructor(e,t,n,r,o){this._id=null,this._event=null,this._actions=null,this._allActions=null,this._isDeleted=!1,this._stateManagementVersion=0,this._hoverLastHandledFrameNum=-1,this._id=e,this._event=t,this._actions=n,this._isDeleted=r,this._stateManagementVersion=o,this._allActions=this.getAllActions()}getAllActions(){let e=[];for(let t of this.actions())if(e.push(t),t.connectionType()=="CONDITIONAL")for(let n of t.conditionalActions())for(let r of n.actions())e.push(r);return e}id(){return this._id!=null?this._id:ee.invalid()}event(){return this._event!=null?this._event:$r.createDefault()}action(){return this._actions!=null&&this._actions.length!=0?new _e(this._actions[0]):null}actions(){return this._actions!=null?this._actions:[]}allActions(){return this._allActions!=null?this._allActions:[]}isDeleted(){return this._isDeleted}stateManagementVersion(){return this._stateManagementVersion}withEvent(e){return new Xo(this._id,e,this._actions,this._isDeleted,this._stateManagementVersion)}withActions(e){return new Xo(this._id,this._event,e,this._isDeleted,this._stateManagementVersion)}withStateManagementVersion(e){return new Xo(this._id,this._event,this._actions,this._isDeleted,e)}isValid(){return this.event().interactionType()=="NONE"||this._actions==null||this._actions.length==0?!1:this.action()!=null&&this.action().value.connectionType()!="NONE"}apply(e){let t=this.action(),n=e.action(),r=[];t!=null&&n!=null?r=[t.value.apply(n.value)]:t!=null?r=[t.value]:n!=null&&(r=[n.value]);let o=this._event,a=e._event,s=null;return o!=null&&a!=null?s=o.apply(a):o!=null?s=o:a!=null&&(s=a),new Xo(this._id,s,r,e._isDeleted,e._stateManagementVersion)}setHoverLastHandledFrameNum(e){this._hoverLastHandledFrameNum=e}getHoverLastHandledFrameNum(){return this._hoverLastHandledFrameNum}toString(){let e="";return e+="PrototypeInteraction(",this._id!=null&&(e+=`id: ${this._id},`),this._event!=null&&(e+=`event: ${this._event.debugString()},`),this._actions!=null&&(e+=`actions: ${this._actions[0].debugString()},`),e+=`isDeleted: ${this._isDeleted},`,e+=")",e}getAllActionsWithSpecificConnectionType(e){let t=[];for(let n of this.actions())if(n.connectionType()==e)t.push(n);else if(n.connectionType()=="CONDITIONAL")for(let r of n.conditionalActions())for(let o of r.actions())n.connectionType()==e&&t.push(n);return t}getAllActionsWithSpecificTransitionType(e){let t=[];for(let n of this.actions())if(n.transitionType()==e)t.push(n);else if(n.connectionType()=="CONDITIONAL")for(let r of n.conditionalActions())for(let o of r.actions())n.transitionType()==e&&t.push(n);return t}getAllValidTransitionActionsInInteraction(){let e=[];for(let t of this.actions())if(ee.isValid(t.transitionNodeID())&&["INTERNAL_NODE","BACK","CLOSE"].indexOf(t.connectionType())!=-1)e.push(t);else if(t.connectionType()=="CONDITIONAL")for(let n of t.conditionalActions())for(let r of n.actions())ee.isValid(t.transitionNodeID())&&["INTERNAL_NODE","BACK","CLOSE"].indexOf(t.connectionType())!=-1&&e.push(t);return e}interactionContainsTransitionAction(){for(let e of this.actions()){if(ee.isValid(e.transitionNodeID())&&["INTERNAL_NODE","BACK","CLOSE"].indexOf(e.connectionType())!=-1)return!0;if(e.connectionType()=="CONDITIONAL"){for(let t of e.conditionalActions())for(let n of t.actions())if(ee.isValid(e.transitionNodeID())&&["INTERNAL_NODE","BACK","CLOSE"].indexOf(e.connectionType())!=-1)return!0}}return!1}interactionContainsSpecificConnectionTypeAction(e){for(let t of this.actions()){if(t.connectionType()==e)return!0;if(t.connectionType()=="CONDITIONAL"){for(let n of t.conditionalActions())for(let r of n.actions())if(t.connectionType()==e)return!0}}return!1}getFirstActionInInteractionWithSpecificNavigation(e){for(let t of this.actions())if(t.navigationType()==e)return t;return null}static createDefault(){return new Xo(ee.invalid(),$r.createDefault(),[],!1,0)}static equals(e,t){return e==null!=(t==null)?!1:e==null?!0:ee.equals(e._id,t._id)&&$r.equals(e._event,t._event)&&ue.List_equalsWithComparison(e._actions,t._actions,(n,r)=>jn.equals(n,r))&&e._isDeleted==t._isDeleted&&e._stateManagementVersion==t._stateManagementVersion}static applyInteractions(e,t){if(e==null&&t==null)return Xo.EMPTY_LIST;if(e==null)return t;if(t==null)return e;let n=e.slice();return t.forEach(r=>{let o=!1;for(let a=0,s=e.length;a<s;a=a+1){let l=e[a];if(ee.equals(l.id(),r.id())){n[a]=l.apply(r),o=!0;break}}o||n.push(r)}),n.filter(r=>!r._isDeleted)}static whichAncestorToSwapState(e,t,n){let r=e!=null?e.scene().findNode1(t):null,o=r==null?void 0:r.findContainingStateGroupOrSelf();if(o==null)return null;let a=e;for(;a!=null;){let s=null;a.type()=="INSTANCE"?s=e.scene().findNode1(a.symbolID()):n==Xo.StateSwapPolicy.INCLUDE_SYMBOLS&&a.type()=="SYMBOL"&&(s=a);let l=s==null?void 0:s.findContainingStateGroupOrSelf();if(o==l)return a;a=a.parent()}return null}static whichInstanceToSwap(e,t){return Xo.whichAncestorToSwapState(e,t,Xo.StateSwapPolicy.INSTANCES_ONLY)}};Xo.EMPTY_LIST=[];var Zt=Xo;(t=>{let i;(o=>(o[o.INCLUDE_SYMBOLS=0]="INCLUDE_SYMBOLS",o[o.INSTANCES_ONLY=1]="INSTANCES_ONLY"))(i=t.StateSwapPolicy||(t.StateSwapPolicy={}));let e;(r=>{function n(o){return t.StateSwapPolicy[o]}r.StateSwapPolicy_toString=n})(e=t.in_StateSwapPolicy||(t.in_StateSwapPolicy={}))})(Zt||(Zt={}));var ys=class ys{interactionType(){let e=this._interactionType!=null?this._interactionType:"ON_CLICK";return e=="NONE"?"ON_CLICK":e}interactionMaintained(){return this._interactionMaintained!=null?this._interactionMaintained.value:!1}interactionDuration(){return this._interactionDuration!=null&&this._interactionDuration.value>=0?this._interactionDuration.value:.3}keyTrigger(){return this._keyTrigger!=null?this._keyTrigger:{}}transitionTimeout(){return this._transitionTimeout!=null&&this._transitionTimeout.value>=0?this._transitionTimeout.value:.8}mediaHitTime(){return this._mediaHitTime!=null?this._mediaHitTime.value:0}withInteractionType(e){return new ys(e,this._interactionMaintained,this._interactionDuration,this._keyTrigger,this._transitionTimeout,this._mediaHitTime)}apply(e){let t=this._interactionType,n=this._interactionMaintained,r=this._interactionDuration,o=this._keyTrigger,a=this._transitionTimeout,s=this._mediaHitTime;return e._interactionType!=null&&(t=e._interactionType),e._interactionMaintained!=null&&(n=e._interactionMaintained),e._interactionDuration!=null&&(r=e._interactionDuration),e._keyTrigger!=null&&(o=e._keyTrigger),e._transitionTimeout!=null&&(a=e._transitionTimeout),e._mediaHitTime!=null&&(s=e._mediaHitTime),new ys(t,n,r,o,a,s)}debugString(){let e="";return e+="PrototypeEvent(",this._interactionType!=null&&(e+=`interactionType: ${this._interactionType},`),this._interactionMaintained!=null&&(e+=`interactionMaintained: ${this._interactionMaintained.value},`),this._interactionDuration!=null&&(e+=`interactionDuration: ${this._interactionDuration.value},`),this._keyTrigger!=null&&(e+=`keyTrigger: ${JSON.stringify(this._keyTrigger)},`),this._transitionTimeout!=null&&(e+=`transitionTimeout: ${this._transitionTimeout.value},`),this._mediaHitTime!=null&&(e+=`mediaHitTime: ${this._mediaHitTime.value},`),e+=")",e}static createDefault(){let e={};return e.keyCodes=[],e.triggerDevice="KEYBOARD",new ys("NONE",new _e(!1),new _e(0),e,new _e(0),new _e(0))}static equals(e,t){return e==null!=(t==null)?!1:e==null?!0:e._interactionType==t._interactionType&&_e.equals(e._interactionMaintained,t._interactionMaintained)&&_e.equals(e._interactionDuration,t._interactionDuration)&&Yg.equals(e._keyTrigger,t._keyTrigger)&&_e.equals(e._transitionTimeout,t._transitionTimeout)}constructor(e,t,n,r,o,a){this._interactionType=e,this._interactionMaintained=t,this._interactionDuration=n,this._keyTrigger=r,this._transitionTimeout=o,this._mediaHitTime=a}};ys.NULL_EVENT=new ys(null,null,null,null,null,null);var $r=ys,Zc=class Zc{constructor(){if(arguments.length==1){let e=arguments[0];this._actions=null,this._condition=null,this._actions=e,this._condition=""}else if(arguments.length==2){let e=arguments[0],t=arguments[1];this._actions=null,this._condition=null,this._actions=e,this._condition=t}}actions(){return this._actions}condition(){return this._condition}debugString(){let e="";return e+="ConditionalActions(",this._actions!=null&&(e+=`actions: ${this._actions[0].debugString()},`),e+=")",e}static createDefault(){return new Zc([])}static equals(e,t){if(e==null!=(t==null))return!1;if(e==null)return!0;let n=ue.List_equalsWithComparison(e._actions,t._actions,(o,a)=>jn.equals(o,a)),r=e._condition==t._condition;return n&&r}};Zc.NULL_CONDITIONAL_ACTIONS=new Zc(null);var $c=Zc,pr=class pr{constructor(e,t,n,r,o,a,s,l,d,c,p,u,h,f,y,g,A,T,b,_,m,S){this._transitionNodeID=null,this._transitionType=null,this._transitionDuration=null,this._easingType=null,this._easingFunctionValues=null,this._transitionShouldSmartAnimate=null,this._connectionType=null,this._connectionURL=null,this._overlayRelativePosition=null,this._navigationType=null,this._transitionPreserveScroll=null,this._extraScrollOffset=null,this._mediaAction=null,this._transitionResetVideoPosition=null,this._openUrlInNewTab=null,this._mediaSkipToTime=null,this._mediaSkipByAmount=null,this._transitionResetScrollPosition=null,this._conditionalActions=null,this._transitionResetInteractiveComponents=null,this._targetVariableID=null,this._targetVariableData=null,this.easingFunction=null,this._transitionNodeID=e,this._transitionType=t,this._transitionDuration=n,this._easingType=r,this._easingFunctionValues=o,this._transitionShouldSmartAnimate=a,this._connectionType=s,this._connectionURL=l,this._overlayRelativePosition=d,this._navigationType=c,this._transitionPreserveScroll=p,this.easingFunction=this.easingFunctionFromAction(),this._extraScrollOffset=u,this._mediaAction=h,this._transitionResetVideoPosition=f,this._openUrlInNewTab=y,this._mediaSkipToTime=g,this._mediaSkipByAmount=A,this._transitionResetScrollPosition=T,this._conditionalActions=b,this._transitionResetInteractiveComponents=_,this._targetVariableID=m,this._targetVariableData=S}transitionNodeID(){return this._connectionType==null||this.connectionType()=="INTERNAL_NODE"||this.connectionType()=="UPDATE_MEDIA_RUNTIME"?this._transitionNodeID!=null?this._transitionNodeID:ee.invalid():ee.invalid()}transitionType(){let e=this._transitionType!=null?this._transitionType:"INSTANT_TRANSITION";return this.navigationType()=="OVERLAY"&&(e=="FADE"||Dn.isPush(e)||Dn.isSlide(e))?"INSTANT_TRANSITION":e}transitionDuration(){return this.transitionType()=="INSTANT_TRANSITION"?0:this._transitionDuration!=null&&this._transitionDuration.value>=0?this._transitionDuration.value:.3}easingType(){return this._easingType!=null?this._easingType:"OUT_CUBIC"}easingFunctionValues(){switch(this.easingType()){case"CUSTOM_CUBIC":case"GENTLE_SPRING":case"SPRING_PRESET_ONE":case"SPRING_PRESET_TWO":case"SPRING_PRESET_THREE":case"CUSTOM_SPRING":return this._easingFunctionValues!=null?this._easingFunctionValues:Ur.easingValuesForPreset(this.easingType());default:break}return Ur.easingValuesForPreset(this.easingType())}transitionShouldSmartAnimate(){return this._transitionShouldSmartAnimate!=null?this._transitionShouldSmartAnimate.value:!1}connectionType(){return this._connectionType!=null?this._connectionType:"NONE"}connectionURL(){return this.connectionType()=="URL"?this._connectionURL:null}overlayRelativePosition(){return this._overlayRelativePosition!=null?this._overlayRelativePosition:I.new2()}navigationType(){return this._navigationType!=null?this._navigationType:"NAVIGATE"}mediaAction(){return this._mediaAction!=null?this._mediaAction:"PLAY"}transitionPreserveScroll(){return this.transitionType()=="SMART_ANIMATE"||Dn.supportsSmartAnimate(this.transitionType())&&this.transitionShouldSmartAnimate()?!0:Dn.isSlide(this.transitionType())||Dn.isPush(this.transitionType())||Dn.isMove(this.transitionType())?!1:this._transitionPreserveScroll!=null?this._transitionPreserveScroll.value:!1}transitionResetVideoPosition(){return this._transitionResetVideoPosition!=null?this._transitionResetVideoPosition.value:!1}transitionResetScrollPosition(){return this._transitionResetScrollPosition!=null?this._transitionResetScrollPosition.value:!1}transitionResetInteractiveComponents(){return this._transitionResetInteractiveComponents!=null?this._transitionResetInteractiveComponents.value:!1}openUrlInNewTab(){return this._openUrlInNewTab!=null?this._openUrlInNewTab.value:!0}extraScrollOffset(){return this._extraScrollOffset!=null?this._extraScrollOffset:I.new2()}mediaSkipToTime(){return this._mediaSkipToTime!=null&&this._mediaSkipToTime.value>=0?this._mediaSkipToTime.value:0}mediaSkipByAmount(){return this._mediaSkipByAmount!=null&&this._mediaSkipByAmount.value>=0?this._mediaSkipByAmount.value:5}conditionalActions(){return this._conditionalActions!=null?this._conditionalActions:[]}targetVariableID(){return this._targetVariableID}targetVariableData(){return this._targetVariableData}withTransitionNodeID(e){return new pr(e,this._transitionType,this._transitionDuration,this._easingType,this._easingFunctionValues,this._transitionShouldSmartAnimate,this._connectionType,this._connectionURL,this._overlayRelativePosition,this._navigationType,this._transitionPreserveScroll,this._extraScrollOffset,this._mediaAction,this._transitionResetVideoPosition,this._openUrlInNewTab,this._mediaSkipToTime,this._mediaSkipByAmount,this._transitionResetScrollPosition,this._conditionalActions,this._transitionResetInteractiveComponents,this._targetVariableID,this._targetVariableData)}withTransitionType(e){return new pr(this._transitionNodeID,e,this._transitionDuration,this._easingType,this._easingFunctionValues,this._transitionShouldSmartAnimate,this._connectionType,this._connectionURL,this._overlayRelativePosition,this._navigationType,this._transitionPreserveScroll,this._extraScrollOffset,this._mediaAction,this._transitionResetVideoPosition,this._openUrlInNewTab,this._mediaSkipToTime,this._mediaSkipByAmount,this._transitionResetScrollPosition,this._conditionalActions,this._transitionResetInteractiveComponents,this._targetVariableID,this._targetVariableData)}withTransitionShouldSmartAnimate(e){return new pr(this._transitionNodeID,this._transitionType,this._transitionDuration,this._easingType,this._easingFunctionValues,new _e(e),this._connectionType,this._connectionURL,this._overlayRelativePosition,this._navigationType,this._transitionPreserveScroll,this._extraScrollOffset,this._mediaAction,this._transitionResetVideoPosition,this._openUrlInNewTab,this._mediaSkipToTime,this._mediaSkipByAmount,this._transitionResetScrollPosition,this._conditionalActions,this._transitionResetInteractiveComponents,this._targetVariableID,this._targetVariableData)}withConnectionType(e){return new pr(this._transitionNodeID,this._transitionType,this._transitionDuration,this._easingType,this._easingFunctionValues,this._transitionShouldSmartAnimate,e,this._connectionURL,this._overlayRelativePosition,this._navigationType,this._transitionPreserveScroll,this._extraScrollOffset,this._mediaAction,this._transitionResetVideoPosition,this._openUrlInNewTab,this._mediaSkipToTime,this._mediaSkipByAmount,this._transitionResetScrollPosition,this._conditionalActions,this._transitionResetInteractiveComponents,this._targetVariableID,this._targetVariableData)}withConnectionURL(e){return new pr(this._transitionNodeID,this._transitionType,this._transitionDuration,this._easingType,this._easingFunctionValues,this._transitionShouldSmartAnimate,this._connectionType,e,this._overlayRelativePosition,this._navigationType,this._transitionPreserveScroll,this._extraScrollOffset,this._mediaAction,this._transitionResetVideoPosition,this._openUrlInNewTab,this._mediaSkipToTime,this._mediaSkipByAmount,this._transitionResetScrollPosition,this._conditionalActions,this._transitionResetInteractiveComponents,this._targetVariableID,this._targetVariableData)}withOverlayRelativePosition(e){return new pr(this._transitionNodeID,this._transitionType,this._transitionDuration,this._easingType,this._easingFunctionValues,this._transitionShouldSmartAnimate,this._connectionType,this._connectionURL,e,this._navigationType,this._transitionPreserveScroll,this._extraScrollOffset,this._mediaAction,this._transitionResetVideoPosition,this._openUrlInNewTab,this._mediaSkipToTime,this._mediaSkipByAmount,this._transitionResetScrollPosition,this._conditionalActions,this._transitionResetInteractiveComponents,this._targetVariableID,this._targetVariableData)}withNavigationType(e){return new pr(this._transitionNodeID,this._transitionType,this._transitionDuration,this._easingType,this._easingFunctionValues,this._transitionShouldSmartAnimate,this._connectionType,this._connectionURL,this._overlayRelativePosition,e,this._transitionPreserveScroll,this._extraScrollOffset,this._mediaAction,this._transitionResetVideoPosition,this._openUrlInNewTab,this._mediaSkipToTime,this._mediaSkipByAmount,this._transitionResetScrollPosition,this._conditionalActions,this._transitionResetInteractiveComponents,this._targetVariableID,this._targetVariableData)}withTransitionPreserveScroll(e){return new pr(this._transitionNodeID,this._transitionType,this._transitionDuration,this._easingType,this._easingFunctionValues,this._transitionShouldSmartAnimate,this._connectionType,this._connectionURL,this._overlayRelativePosition,this._navigationType,new _e(e),this._extraScrollOffset,this._mediaAction,this._transitionResetVideoPosition,this._openUrlInNewTab,this._mediaSkipToTime,this._mediaSkipByAmount,this._transitionResetScrollPosition,this._conditionalActions,this._transitionResetInteractiveComponents,this._targetVariableID,this._targetVariableData)}withMediaAction(e){return new pr(this._transitionNodeID,this._transitionType,this._transitionDuration,this._easingType,this._easingFunctionValues,this._transitionShouldSmartAnimate,this._connectionType,this._connectionURL,this._overlayRelativePosition,this._navigationType,new _e(this.transitionPreserveScroll()),this._extraScrollOffset,e,this._transitionResetVideoPosition,this._openUrlInNewTab,this._mediaSkipToTime,this._mediaSkipByAmount,this._transitionResetScrollPosition,this._conditionalActions,this._transitionResetInteractiveComponents,this._targetVariableID,this._targetVariableData)}withTransitionResetVideoPosition(e){return new pr(this._transitionNodeID,this._transitionType,this._transitionDuration,this._easingType,this._easingFunctionValues,this._transitionShouldSmartAnimate,this._connectionType,this._connectionURL,this._overlayRelativePosition,this._navigationType,this._transitionPreserveScroll,this._extraScrollOffset,this._mediaAction,new _e(e),this._openUrlInNewTab,this._mediaSkipToTime,this._mediaSkipByAmount,this._transitionResetScrollPosition,this._conditionalActions,this._transitionResetInteractiveComponents,this._targetVariableID,this._targetVariableData)}withOpenUrlInNewTab(e){return new pr(this._transitionNodeID,this._transitionType,this._transitionDuration,this._easingType,this._easingFunctionValues,this._transitionShouldSmartAnimate,this._connectionType,this._connectionURL,this._overlayRelativePosition,this._navigationType,this._transitionPreserveScroll,this._extraScrollOffset,this._mediaAction,this._transitionResetVideoPosition,new _e(e),this._mediaSkipToTime,this._mediaSkipByAmount,this._transitionResetScrollPosition,this._conditionalActions,this._transitionResetInteractiveComponents,this._targetVariableID,this._targetVariableData)}withTransitionResetInteractiveComponents(e){return new pr(this._transitionNodeID,this._transitionType,this._transitionDuration,this._easingType,this._easingFunctionValues,this._transitionShouldSmartAnimate,this._connectionType,this._connectionURL,this._overlayRelativePosition,this._navigationType,this._transitionPreserveScroll,this._extraScrollOffset,this._mediaAction,this._transitionResetVideoPosition,this._openUrlInNewTab,this._mediaSkipToTime,this._mediaSkipByAmount,this._transitionResetScrollPosition,this._conditionalActions,new _e(e),this._targetVariableID,this._targetVariableData)}withTransitionResetScrollPosition(e){return new pr(this._transitionNodeID,this._transitionType,this._transitionDuration,this._easingType,this._easingFunctionValues,this._transitionShouldSmartAnimate,this._connectionType,this._connectionURL,this._overlayRelativePosition,this._navigationType,this._transitionPreserveScroll,this._extraScrollOffset,this._mediaAction,this._transitionResetVideoPosition,this._openUrlInNewTab,this._mediaSkipToTime,this._mediaSkipByAmount,new _e(e),this._conditionalActions,this._transitionResetInteractiveComponents,this._targetVariableID,this._targetVariableData)}easingFunctionFromAction(){var e;return Ur.makeEasingFunctionWithEasingType(this.easingFunctionValues(),this.transitionDuration(),this._easingType,(e=Y)==null?void 0:e.viewerAnimationEasingCache())}apply(e){let t=this._transitionNodeID,n=this._transitionType,r=this._transitionDuration,o=this._easingType,a=this._easingFunctionValues,s=this._transitionShouldSmartAnimate,l=this._connectionType,d=this._connectionURL,c=this._overlayRelativePosition,p=this._navigationType,u=this._transitionPreserveScroll,h=this._extraScrollOffset,f=this._mediaAction,y=this._transitionResetVideoPosition,g=this._openUrlInNewTab,A=this._mediaSkipToTime,T=this._mediaSkipByAmount,b=this._transitionResetScrollPosition,_=this._conditionalActions,m=this._transitionResetInteractiveComponents,S=this._targetVariableID,v=this._targetVariableData;return e._transitionNodeID!=null&&(t=e._transitionNodeID),e._transitionType!=null&&(n=e._transitionType),e._transitionDuration!=null&&(r=e._transitionDuration),e._easingType!=null&&(o=e._easingType),e._easingFunctionValues!=null&&(a=e._easingFunctionValues),e._transitionShouldSmartAnimate!=null&&(s=e._transitionShouldSmartAnimate),e._connectionType!=null&&(l=e._connectionType),e._connectionURL!=null&&(d=e._connectionURL),e._overlayRelativePosition!=null&&(c=e._overlayRelativePosition),e._navigationType!=null&&(p=e._navigationType),e._transitionPreserveScroll!=null&&(u=e._transitionPreserveScroll),e._extraScrollOffset!=null&&(h=e._extraScrollOffset),e._mediaAction!=null&&(f=e._mediaAction),e._transitionResetVideoPosition!=null&&(y=e._transitionResetVideoPosition),e._openUrlInNewTab!=null&&(g=e._openUrlInNewTab),e._mediaSkipToTime!=null&&(A=e._mediaSkipToTime),e._mediaSkipByAmount!=null&&(T=e._mediaSkipByAmount),e._transitionResetScrollPosition!=null&&(b=e._transitionResetScrollPosition),e._conditionalActions!=null&&(_=e._conditionalActions),e._transitionResetInteractiveComponents!=null&&(m=e._transitionResetInteractiveComponents),e._targetVariableID!=null&&(S=e._targetVariableID),e._targetVariableData!=null&&(v=e._targetVariableData),new pr(t,n,r,o,a,s,l,d,c,p,u,h,f,y,g,A,T,b,_,m,S,v)}debugString(){let e="";return e+="PrototypeAction(",this._transitionNodeID!=null&&(e+=`transitionNodeID: ${this._transitionNodeID},`),this._transitionType!=null&&(e+=`transitionType: ${this._transitionType},`),this._transitionDuration!=null&&(e+=`transitionDuration: ${this._transitionDuration.value},`),this._easingType!=null&&(e+=`easingType: ${this._easingType},`),this._easingFunctionValues!=null&&(e+=`easingFunctionValues: ${this._easingFunctionValues.map(t=>t.toString()).join(",")},`),this._transitionShouldSmartAnimate!=null&&(e+=`transitionShouldSmartAnimate: ${this._transitionShouldSmartAnimate.value},`),this._connectionType!=null&&(e+=`connectionType: ${this._connectionType},`),this._connectionURL!=null&&(e+=`connectionURL: ${Bn.string_toString(this._connectionURL)},`),this._overlayRelativePosition!=null&&(e+=`overlayRelativePosition: ${this._overlayRelativePosition},`),this._navigationType!=null&&(e+=`navigationType: ${this._navigationType},`),this._transitionPreserveScroll!=null&&(e+=`transitionPreserveScroll: ${this._transitionPreserveScroll.value},`),this._extraScrollOffset!=null&&(e+=`extraScrollOffset: ${this._extraScrollOffset},`),this._mediaAction!=null&&(e+=`mediaAction: ${this._mediaAction},`),this._transitionResetVideoPosition!=null&&(e+=`transitionResetVideoPosition: ${this._transitionResetVideoPosition.value},`),this._openUrlInNewTab!=null&&(e+=`openUrlInNewTab: ${this._openUrlInNewTab.value},`),this._mediaSkipToTime!=null&&(e+=`mediaSkipToTime: ${this._mediaSkipToTime.value},`),this._mediaSkipByAmount!=null&&(e+=`mediaSkipByAmount: ${this._mediaSkipByAmount.value},`),this._transitionResetScrollPosition!=null&&(e+=`transitionResetScrollPosition: ${this._transitionResetScrollPosition.value},`),this._conditionalActions!=null&&(e+=`conditionalActions: ${this._conditionalActions[0].debugString()},`),this._transitionResetInteractiveComponents!=null&&(e+=`transitionResetInteractiveComponents: ${this._transitionResetInteractiveComponents.value},`),e+=")",e}static createDefault(){return new pr(ee.invalid(),"INSTANT_TRANSITION",new _e(0),"IN_CUBIC",Ur.easingValuesForPreset("IN_CUBIC"),new _e(!1),"NONE",null,new I(0,0),"NAVIGATE",new _e(!1),new I(0,0),"PLAY",new _e(!1),new _e(!0),new _e(0),new _e(5),new _e(!1),[],new _e(!1),null,null)}static equals(e,t){return e==null!=(t==null)?!1:e==null?!0:ee.equals(e._transitionNodeID,t._transitionNodeID)&&e._transitionType==t._transitionType&&_e.equals(e._transitionDuration,t._transitionDuration)&&e._easingType==t._easingType&&ue.List_equalsWithComparison(e._easingFunctionValues,t._easingFunctionValues,(n,r)=>Math.abs(n-r)<1e-6)&&_e.equals(e._transitionShouldSmartAnimate,t._transitionShouldSmartAnimate)&&e._connectionType==t._connectionType&&e._connectionURL==t._connectionURL&&I.equals_(e._overlayRelativePosition,t._overlayRelativePosition)&&e._navigationType==t._navigationType&&_e.equals(e._transitionPreserveScroll,t._transitionPreserveScroll)&&_e.equals(e._transitionResetVideoPosition,t._transitionResetVideoPosition)&&_e.equals(e._openUrlInNewTab,t._openUrlInNewTab)&&I.equals_(e._extraScrollOffset,t._extraScrollOffset)&&e._mediaAction==t._mediaAction&&_e.equals(e._mediaSkipToTime,t._mediaSkipToTime)&&_e.equals(e._mediaSkipByAmount,t._mediaSkipByAmount)&&_e.equals(e._transitionResetScrollPosition,t._transitionResetScrollPosition)&&ue.List_equalsWithComparison(e._conditionalActions,t._conditionalActions,(n,r)=>$c.equals(n,r))&&_e.equals(e._transitionResetInteractiveComponents,t._transitionResetInteractiveComponents)}};pr.NULL_ACTION=new pr(null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,[],null,null,null);var jn=pr,Yg;(e=>{function i(t,n){return t==null!=(n==null)?!1:t==null?!0:ue.List_equalsWithComparison(t.keyCodes,n.keyCodes,(r,o)=>r==o)&&t.triggerDevice==n.triggerDevice}e.equals=i})(Yg||(Yg={}));var bl=(t=>(t[t.ALL=0]="ALL",t[t.NESTED_ONLY=1]="NESTED_ONLY",t))(bl||{}),Do=class{constructor(){if(arguments.length==1){let e=arguments[0];this.node=null,this.hyperlink=null,this.node=e}else if(arguments.length==2){let e=arguments[0],t=arguments[1];this.node=null,this.hyperlink=null,this.node=e,this.hyperlink=t}}canvasSpaceScrolledInteractiveBounds(e){let t=this.node.canvasSpaceScrolledInteractiveBounds(e);return this.hyperlink!=null?Kn.FrozenRect_new4(this.hyperlink.bounds.x+t.x(),this.hyperlink.bounds.y+t.y(),this.hyperlink.bounds.w,this.hyperlink.bounds.h):t}},Oi=(t=>(t[t.NONLINEAR=0]="NONLINEAR",t[t.FRAME_LIST=1]="FRAME_LIST",t))(Oi||{}),yl=class{asScreen(){return null}asSmartAnimate(){return null}constructor(){}};yl.MAX_PRERENDER_JOB_COUNT=10;var Ln=class i extends yl{constructor(t,n,r,o,a){super();this.nodeId=t,this.role=n,this.overlayStackPosition=r,this.prototypeAction=o,this.precedingOverlays=a}asScreen(){return this}hash(){let t=`${this.nodeId}-${i.FrameRole[this.role]}`;return this.role==i.FrameRole.OVERLAY?t+`-${this.overlayStackPosition}`:t}static forBaseScreen(t){return new i(t,i.FrameRole.BASE_SCREEN,0,null,null)}static forOverlay(t,n,r,o){return new i(t,i.FrameRole.OVERLAY,n,r,o)}};(t=>{let i;(o=>(o[o.BASE_SCREEN=0]="BASE_SCREEN",o[o.OVERLAY=1]="OVERLAY"))(i=t.FrameRole||(t.FrameRole={}));let e;(r=>{function n(o){return t.FrameRole[o]}r.FrameRole1_toString=n})(e=t.in_FrameRole1||(t.in_FrameRole1={}))})(Ln||(Ln={}));var Xg=class extends yl{constructor(t,n,r,o,a){super();this.srcNodeId=t,this.dstNodeId=n,this.role=r,this.transitionType=o,this.easingFunction=a}asSmartAnimate(){return this}hash(){return`Smart animate ${this.srcNodeId} -> ${this.dstNodeId} w/ ${this.transitionType}`}},ed;(e=>{function i(t,n){if(n=="URL"){if(t!="ON_CLICK"&&t!="MOUSE_UP")return!1}else if(n=="BACK"&&(t=="ON_HOVER"||t=="ON_PRESS"))return!1;return!0}e.isValidForConnection=i})(ed||(ed={}));var Bt=class i{constructor(e){this._nodeTransitionTracker=null,this._appState=null,this._emitter=null,this._cachedPrerenderJobList=[],this._shouldNotifyTopLevelPrototypeNodesInvalidated=!1,this._appState=e,this._emitter=qt.getEventEmitter(),this._appState.addAppObserver(this),this._appState.prototypeState().addObserver(this),this._nodeTransitionTracker=new jc(e),this._appState.addFrameObserver(this)}nodeTransitionTracker(){return this._nodeTransitionTracker}handleSceneChange(e,t){e!=null&&e.removeObserver(this),t!=null&&t.addObserver(this),this._cachedPrerenderJobList=null,this._shouldNotifyTopLevelPrototypeNodesInvalidated=!0}handleActiveCanvasChange(e,t){this._cachedPrerenderJobList=null,this._shouldNotifyTopLevelPrototypeNodesInvalidated=!0}handleActivePrototypeStartingPointChange(e,t){this._cachedPrerenderJobList=null,this._shouldNotifyTopLevelPrototypeNodesInvalidated=!0}handleSceneGraphEvent(e){if(Zr.isPrototypeStructuralChange(e.property)||e.property==14||e.property==81||e.property==9||e.property==24){this._cachedPrerenderJobList=null;let t=this._appState.prototypeState();t.isApplyingStateChangeMutation()||t.isResettingStateChangeMutations()||(this._shouldNotifyTopLevelPrototypeNodesInvalidated=!0)}}onFrame(){this._shouldNotifyTopLevelPrototypeNodesInvalidated&&(this._emitter.trigger("topLevelFramesListInvalidated",null),this._emitter.trigger("navigationInfoInvalidated",null),this._shouldNotifyTopLevelPrototypeNodesInvalidated=!1)}handleStateChangeAborted(e){this._cachedPrerenderJobList=null}handleStateChangeCommitted(e,t){}handleStateChangeInitiated(e){this._cachedPrerenderJobList=null}handleStateChangeRequested(e){}handleFitModeChange(e,t){}handleRestartPrototype(){}_scene(){return this._appState.scene()}_baseScreenId(){return this._appState.prototypeState().getCurrentBaseScreenId()}getPrerenderingJobs(e){return this._cachedPrerenderJobList==null&&(this._cachedPrerenderJobList=this.computePrerenderJobsForStartNode(this._baseScreenId(),yl.MAX_PRERENDER_JOB_COUNT)),this._cachedPrerenderJobList}currentType(){return this._scene()==null||this._appState.getActiveCanvas()==null?1:this.topLevelPrototypeStartingPointNodeIdsSorted().length>0||Y.getViewerMode()==Y.ViewerMode.MIRROR?0:1}activePrototypeStartNodeOrDefault(){if(this._scene()==null)return null;if(this._appState.activePrototypeStartingPointNodeId()!=null){let t=this._scene().findNode1(this._appState.activePrototypeStartingPointNodeId());if(t!=null)return t}let[e]=this.topLevelPrototypeStartingPointNodeIdsSorted();return e?this._scene().findNode1(ee.fromString(e)):null}nodeToRestartPrototypeOn(e){if(e==null||e.type()!="CANVAS"&&e.type()!="SECTION")return null;let t=this.activePrototypeStartNodeOrDefault();if(t!=null)return t;let n=i.visuallySortedTopLevelFrames(e);return n.length>0?n[0]:null}getDestinationFrame(e){var n,r,o;let t=(n=this._scene())==null?void 0:n.findNode1(e);if(t==null)return null;if(t.type()=="SECTION"){let a=this._appState.prototypeState().getLastFrameOrSectionVisitedInSection(t.id()),s=(r=this._scene())==null?void 0:r.findNode1(a);if((s==null?void 0:s.type())=="SECTION")for(;s.type()!="FRAME";)a=this._appState.prototypeState().getLastFrameOrSectionVisitedInSection(a),s=(o=this._scene())==null?void 0:o.findNode1(a);return s}return t}validDestinationForPrototypeFromId(e){let t=this.getDestinationFrame(e);return t==null||!t.isTopLevel()||!t.isVisibleInCanvas()||t.isStateGroup()||t.isGroup()||Jt.isImmutableFrame(t.type())?null:t}topLevelPrototypeNodesInOrder(){return this.currentType()==1?i.visuallySortedTopLevelFrames(this._appState.getActiveCanvas()).map(e=>e.id()):this._appState.prototypeState().getTlfHistory()}topLevelPrototypeStartingPointNodeIdsSorted(){if(this._scene()==null)return console.error("topLevelPrototypeStartingPointNodeIdsSorted when we don't have a valid scene"),[];let e=this._appState.getActiveCanvas();return e==null||e.type()!="CANVAS"?[]:i.topLevelStartingPointFramesSorted(e).map(n=>n.id())}prototypeStartingPointsData(){let e=this._appState.getActiveCanvas();if(e==null||e.type()!="CANVAS")return null;let t=i.topLevelStartingPointFramesSorted(e),n=[];for(let r of t){if(r.type()=="SECTION")continue;let o={id:r.id(),name:r.prototypeStartingPoint().name,description:r.prototypeStartingPoint().description};n.push(o)}return n}prerenderJobsForBaseScreen(){return this.prerenderJobsAfter(Ln.forBaseScreen(this._baseScreenId()))}prerenderJobsAfter(e){var a;let t=(a=this._scene())==null?void 0:a.findNode1(e.nodeId);if(t==null)return[];let n=new Map,r=[],o=s=>{n.has(s.hash())||(n.set(s.hash(),!0),r.push(s))};if(e.role==0){let s=this.topLevelPrototypeNodesInOrder(),l=s.indexOf(e.nodeId);if(l!=-1){let d=l+1,c=null;d<s.length?c=ee.fromString(s[d]):this.currentType()==1?c=this._appState.prototypeState().getNextBaseScreenIdForFrameList():c=this._appState.prototypeState().getNextBaseScreenIdForPrototype(),c!=null&&o(Ln.forBaseScreen(c))}}return this.forTransitionInFrame(t,s=>{for(let l of s.allActions()){if(l==null||!ee.isValid(l.transitionNodeID()))return!0;let d=l.transitionType(),c=!1;if(l.navigationType()=="SWAP_STATE")return!0;if(e.role==0&&(d=="SMART_ANIMATE"||Dn.supportsSmartAnimate(d)&&l.transitionShouldSmartAnimate())&&(c=!0),e.role==1&&d=="SMART_ANIMATE"&&l.navigationType()=="SWAP"&&(c=!0),c&&o(new Xg(t.id(),l.transitionNodeID(),e.role,d,l.easingFunction)),l.navigationType()=="NAVIGATE"){o(Ln.forBaseScreen(l.transitionNodeID()));let p=this._scene().findNode1(l.transitionNodeID());p!=null&&p.setUsedAsBaseScreen(!0)}else if(l.navigationType()=="OVERLAY"){let p=e.precedingOverlays!=null?e.precedingOverlays.slice():[];p.push(l.transitionNodeID()),o(Ln.forOverlay(l.transitionNodeID(),e.overlayStackPosition+1,l,p));let u=this._scene().findNode1(l.transitionNodeID());u!=null&&u.setUsedAsBaseScreen(!1)}else if(l.navigationType()=="SWAP"){if(e.role==1){let p=e.precedingOverlays!=null?e.precedingOverlays.slice():null;p!=null&&(p[p.length-1]=l.transitionNodeID()),o(Ln.forOverlay(l.transitionNodeID(),e.overlayStackPosition,l,p))}else o(Ln.forBaseScreen(l.transitionNodeID()));this._scene().findNode1(l.transitionNodeID()).setUsedAsBaseScreen(e.role==0)}}return!0}),r}prerenderJobForPreviousNode(){return this.prerenderJobForNodeBefore(this._baseScreenId())}prerenderJobForNodeBefore(e){var o;if(((o=this._scene())==null?void 0:o.findNode1(e))==null)return null;let n=this.topLevelPrototypeNodesInOrder(),r=n.indexOf(e);if(r!=-1){let a=r-1;if(a>=0)return Ln.forBaseScreen(ee.fromString(n[a]))}return null}computePrerenderJobsForStartNode(e,t){if(e==null)return[];let n=[Ln.forBaseScreen(e)],r=[Ln.forBaseScreen(e)],o=new Map,a=0;for(o.set(n[0].hash(),!0);a<n.length;){let s=n[a],l=[],d=this.prerenderJobForNodeBefore(s.nodeId);if(d!=null&&l.push(d),On(l,this.prerenderJobsAfter(s)),l.forEach(c=>{if(r.length<t&&!o.has(c.hash())){let p=c.asScreen();p!=null&&n.push(p),r.push(c),o.set(c.hash(),!0)}}),n.length==t)break;a=a+1}return r}forTransitionInFrame(e,t){let n=this._nodeTransitionTracker.cleanedUpTransitionMapByTLF();if(n._in(e.id())){let r=n.get1(e.id());for(let o=0,a=r.length;o<a;o=o+1){let s=r[o];if(!t(s))return}}}forInteractionInFrame(e,t){this.forInteractionInFrames([e],t)}getInteractionsGroupedByType(e){let t=this._nodeTransitionTracker.cleanedUpInteractionMap(),n={};for(let r of t.hotspots()){let o=this._scene().findNode1(r);if(o!=null)for(let a of e)a!=null&&a.isAncestorOf(o)&&t.getHotspotInteractions(r).forEach(s=>{let l=s.event().interactionType().toString();n[l]||(n[l]=[]),n[l].push({node:o,interaction:s})})}return n}static getNodeInteractionPairs(e,t){if(t!==null&&(Y.prototypeMouseMovePerf()||Y.getFeatureFlags().prototype_new_mouse_perf))return t[e]||[]}forInteractionInFrames(e,t){let n=this._nodeTransitionTracker.cleanedUpInteractionMap();for(let r of n.hotspots()){let o=this._scene().findNode1(r);if(o!=null)for(let a of e)a!=null&&a.isAncestorOf(o)&&n.getHotspotInteractions(r).forEach(s=>{t(o,s)})}}forHotspotInMap(e,t){for(let n of Array.from(e.keys())){let r=this._scene().findNode2(n);if(r!=null){let o=!1;if(i.isNodeInteractableBecauseOfHyperlinks(r)){for(let a of e.get(n))for(let s of a.allActions())if(s.connectionURL()=="HYPERLINK"){for(let l of r.textHyperlinkBoxes())t(new Do(r,l)),o=!0;break}}o||t(new Do(r))}}}findPrototypeInteractionWithId(e,t){let n=this._scene().findNode2(e),r=i.cleanedInteractionsForNode(this._appState,n);for(let o=0,a=r.length;o<a;o=o+1){let s=r[o];if(s.id()==t)return s}return null}findPrototypeInteractionsWithTransition(e,t){let n=this._scene().findNode2(e),r=i.cleanedInteractionsForNode(this._appState,n),o=[];return r.forEach(a=>{for(let s of a.getAllValidTransitionActionsInInteraction())if(s!=null&&s.transitionNodeID()==t){o.push(a);break}}),o}findPrototypeInteractionsWithInteractionType(e,t){let n=i.cleanedInteractionsForNode(this._appState,e);if(n.length==0)return n;let r=[],o=[];return n.forEach(a=>{a.event().interactionType()==t&&(a.action()!=null&&a.action().value.navigationType()=="SWAP_STATE"?o.push(a):r.push(a))}),e.isInstanceSublayer()&&o.sort((a,s)=>{var c,p;let l=Zt.whichInstanceToSwap(e,(c=a.action())==null?void 0:c.value.transitionNodeID()).stablePath(),d=Zt.whichInstanceToSwap(e,(p=s.action())==null?void 0:p.value.transitionNodeID()).stablePath();return l.guids.length<d.guids.length?-1:1}),On(r,o),r}findHotspotsWithInteractionFilter(e,t,n,r){return this.findHotspotsWithNoodleFilter(e,t,(o,a)=>n(a),r)}findHotspotsWithInteractionFilterWithinMultipleNodes(e,t,n){return this.findHotspotsWithNoodleFilterWithinMultipleNodes(e,t,(r,o)=>n(o))}findHotspotsWithNoodleFilter(e,t,n,r){let o=[];return e==null?o:this.findHotspotsWithNoodleFilterWithinMultipleNodes(new Set([e]),t,n,r)}findHotspotsWithNoodleFilterWithinMultipleNodes(e,t,n,r){let o=[];if(e==null||e.size==0)return o;let a=new Map,s=(l,d)=>{!n(l,d)||!d.allActions().some(p=>ed.isValidForConnection(d.event().interactionType(),p.connectionType()))||(a.has(l.id())||a.set(l.id(),[]),a.get(l.id()).push(d))};if(r)for(let l of r)s(l.node,l.interaction);else this.forInteractionInFrames(Array.from(e.values()),s);return this.forHotspotInMap(a,l=>{(t==0||!e.has(l.node))&&o.push(l)}),o.sort((l,d)=>l.node.isAboveInLayerOrder(d.node)?-1:1),o}findHotspotsWithInteractionType(e,t,n,r){return this.findHotspotsWithInteractionFilter(e,t,o=>o.event().interactionType()==n,r)}findAllHotspots(e,t){return this.findHotspotsWithInteractionFilter(e,t,n=>!0)}hotspotOnPresentedNode(e,t,n,r){let o=n!="MOUSE_OUT"&&n!="MOUSE_LEAVE",a=this._appState.prototypeStructure().findHotspotsWithInteractionType(e,0,n,r),s=null;for(let l of a)l.canvasSpaceScrolledInteractiveBounds(0).contains2(t)==o&&(s==null||l.node.isAboveInLayerOrder(s.node))&&(s=l);return s}static createFakeHyperlinkInteraction(){let e=new $r("ON_CLICK",null,null,{},null,null),t=new jn(null,null,null,null,null,null,"URL","HYPERLINK",null,null,null,null,null,null,null,null,null,null,null,null,null,null);return new Zt(ee.invalid(),e,[t],!1,0)}static cleanedInteractionsForNode(e,t){let n=[];if(t==null)return n;let r=t.prototypeInteractions();for(let o=0,a=r.length;o<a;o=o+1){let s=r[o];if(s.actions()==null||s.actions().length==0)continue;let l=[];for(let d=0,c=s.actions().length;d<c;d=d+1){let p=s.actions()[d],u=null;if(ee.isValid(p.transitionNodeID())){let h=e.getActiveCanvas(),f=i.cleanedUpTransitionDestinationId(h,t==null?void 0:t.id(),p.transitionNodeID(),p.navigationType(),p.connectionType());f!==null&&f!=null&&(u=p.withTransitionNodeID(f)),p.navigationType()=="SWAP_STATE"&&!t.scene().interactiveComponentsEnabled()&&(u=null)}else t.isVisibleInCanvas()&&i.isPrototypeActionInteractableBecauseOfConnection(p)&&(u=p);u!=null&&l.push(u)}l.length!=0&&n.push(s.withActions(l))}return n.length==0&&i.isNodeInteractableBecauseOfHyperlinks(t)&&n.push(i.createFakeHyperlinkInteraction()),n}static cleanedUpTransitionDestinationId(e,t,n,r,o){return D().modules().prototype.cleanedUpTransitionDestination(e!=null?e.handle():-1,t,n,ye.schema.NavigationType[r],ye.schema.ConnectionType[o])}static visuallySortedTopLevelFrames(e){if(e==null)return[];let t=[];for(let o=0,a=e.childCount();o<a;o=o+1){let s=e.childAt1(o);s&&D().isOrContainsBaseScreen(s.id())&&t.push(s)}let n=i.visuallySortLayersLeftToRightAndTopToBottom1(t),r=[];for(let o=0,a=n.length;o<a;o=o+1){let s=n[o];s.type()=="SECTION"?On(r,i.visuallySortedTopLevelFrames(s)):r.push(s)}return r}static visuallySortLayersLeftToRightAndTopToBottom1(e){let t=e.slice();return t.sort((n,r)=>{let o=n.fullSizeCanvasSpaceBoundingBox(),a=r.fullSizeCanvasSpaceBoundingBox();return a.top()<=o.bottom()&&a.bottom()>=o.top()?o.x()==a.x()?Bn.string_compare(n.id(),r.id()):o.x()-a.x()|0:o.y()-a.y()|0}),t}static visuallySortLayersLeftToRightAndTopToBottom2(e,t){let n=[];for(let o of t){let a=e.findNode1(o);a!=null&&n.push(a)}return i.visuallySortLayersLeftToRightAndTopToBottom1(n).map(o=>o.id())}static adjacentBaseScreens(e,t){let n=t.scene(),r=new zi(s=>s),o=null,a=new Ar;return o=s=>{if(s==null||a._in(s.id())||!e._in(s.id()))return;a.add(s.id());let l=e.get1(s.id());for(let d=0,c=l.length;d<c;d=d+1){let p=l[d];for(let u of p.allActions()){if(u==null||!ee.isValid(u.transitionNodeID()))continue;let h=n.findNode1(u.transitionNodeID());if(h==null){Ve("null destination when finding reachable TLFs?");continue}let f=u.connectionType()!="UPDATE_MEDIA_RUNTIME"&&u.connectionType()!="SET_VARIABLE";u.navigationType()=="NAVIGATE"&&f||u.navigationType()=="SWAP"&&ee.equals(s.id(),t.id())?r.add(h.id()):(u.navigationType()=="OVERLAY"||u.navigationType()=="SWAP")&&o(h)}}},o(t),r}static topLevelStartingPointFramesInSection(e){let t=[],n=[];for(n.push(e);n.length>0;){let r=n.shift();for(let o=0,a=r.childCount();o<a;o=o+1){let s=r.childAt1(o);s.isTopLevel()&&td(s)&&t.push(s),s.type()=="SECTION"&&n.push(s)}}return t}static topLevelStartingPointFramesSorted(e){let t=[];for(let n=0,r=e.childCount();n<r;n=n+1){let o=e.childAt1(n);if(o.type()=="SECTION"){let a=i.topLevelStartingPointFramesInSection(o);On(t,a)}o.isTopLevel()&&td(o)&&t.push(o)}return t.sort((n,r)=>sn.compare(n.prototypeStartingPoint().position,r.prototypeStartingPoint().position)),t}static isNodeInteractableBecauseOfHyperlinks(e){return e.type()=="TEXT"&&e.textHyperlinkBoxes().length>0}static isPrototypeActionInteractableBecauseOfConnection(e){return e.connectionURL()!=null||e.connectionType()=="BACK"||e.connectionType()=="CLOSE"||e.connectionType()=="SET_VARIABLE"||e.connectionType()=="UPDATE_MEDIA_RUNTIME"||e.connectionType()=="CONDITIONAL"}},Rb;(e=>{function i(t){return bl[t]}e.HotspotPredicate_toString=i})(Rb||(Rb={}));var Nb;(e=>{function i(t){return Oi[t]}e.PrototypeType_toString=i})(Nb||(Nb={}));var Hr=class i{willStartTransitionWithDuration(e){this._durationSeconds=e,this._elapsedSeconds=0,this._timeOfLastTransitionFrame=ke.seconds(),this._timeOfTransitionStart=this._timeOfLastTransitionFrame,this.frameTimesMs.length=0,this._progressAtStart=0,this._lastProgress=0}transitionEnded(){this._lastProgress=-1,this._progressType=i.ProgressType.FORWARD,this._externalOnTickProgress=null;let e=this._externalOnTransitionEnded;return this._externalOnTransitionEnded=null,e!=null?e():i.TransitionEndedAction.COMMIT}isTransitionInProgress(){return this.isProgressControlledExternally()?!0:this._progressType==i.ProgressType.REVERSE?0<this._lastProgress&&this._lastProgress<=1:0<=this._lastProgress&&this._lastProgress<1}duration(){return this._durationSeconds}progress(){return this._lastProgress}isProgressControlledExternally(){return this._progressType==i.ProgressType.EXTERNAL}pinProgressToRealTimeWithDuration(e,t,n){this._progressAtStart=e,this._durationSeconds=t,this._progressType=n?i.ProgressType.REVERSE:i.ProgressType.FORWARD,this._elapsedSeconds=0,this._timeOfLastTransitionFrame=ke.seconds(),this._timeOfTransitionStart=this._timeOfLastTransitionFrame,this.frameTimesMs.length=0}pinProgressToExternalControl(e,t){this._externalOnTickProgress=e,this._externalOnTransitionEnded=t,this._progressType=i.ProgressType.EXTERNAL,this._timeOfTransitionStart=ke.seconds(),this.frameTimesMs.length=0}advanceToNextFrame(){if(this.isProgressControlledExternally())this._lastProgress=this._externalOnTickProgress();else if(this._durationSeconds>0){let e=ke.seconds(),t=e-this._timeOfLastTransitionFrame;this.frameTimesMs.push(1e3*t),t=Math.min(t,1/30),this._elapsedSeconds+=t,this._timeOfLastTransitionFrame=e;let n=this._progressType==i.ProgressType.REVERSE?-1:1;this._lastProgress=un.Math_clamp1(n*this._elapsedSeconds/this._durationSeconds+this._progressAtStart,0,1)}else this._lastProgress=this._progressType==i.ProgressType.REVERSE?0:1}constructor(){this._lastProgress=-1,this._durationSeconds=-1,this._elapsedSeconds=-1,this._timeOfLastTransitionFrame=-1,this._progressAtStart=0,this._timeOfTransitionStart=-1,this.frameTimesMs=[],this._progressType=i.ProgressType.FORWARD,this._externalOnTickProgress=null,this._externalOnTransitionEnded=null}};(r=>{let i;(l=>(l[l.FORWARD=0]="FORWARD",l[l.REVERSE=1]="REVERSE",l[l.EXTERNAL=2]="EXTERNAL"))(i=r.ProgressType||(r.ProgressType={}));let e;(s=>(s[s.ABORT=0]="ABORT",s[s.COMMIT=1]="COMMIT"))(e=r.TransitionEndedAction||(r.TransitionEndedAction={}));let t;(a=>{function o(s){return r.ProgressType[s]}a.ProgressType_toString=o})(t=r.in_ProgressType||(r.in_ProgressType={}));let n;(a=>{function o(s){return r.TransitionEndedAction[s]}a.TransitionEndedAction_toString=o})(n=r.in_TransitionEndedAction||(r.in_TransitionEndedAction={}))})(Hr||(Hr={}));var bs;(t=>{function i(n,r){n(r)}t.applyTo=i;function e(n){return n}t._new=e})(bs||(bs={}));var _p=class{constructor(e){this._dragToAnimateBehavior=null,this._canvasView=null,this._canvasView=e}clearDrag(e){this._dragToAnimateBehavior==e&&(this._canvasView.removeInteractionObserver(this._dragToAnimateBehavior),this._dragToAnimateBehavior=null)}removeFrom(e){this.clearDrag(this._dragToAnimateBehavior)}getTransitionMixin(e,t,n){let r=t.interactionAddress.hotspotStablePath!=null?e.findNode3(t.interactionAddress.hotspotStablePath):null;if(r==null)return null;switch(t.cause){case 5:{if(!n&&Ut.TransitionAction_getControlSource(t.cause)!=0){let o=hn.computeDragVector2(t,r,e);if(o!=null&&o.length()>0)return bs._new(a=>{this._dragToAnimateBehavior!=null&&this.clearDrag(this._dragToAnimateBehavior),this._dragToAnimateBehavior=new hn(this,o,a,t.easingFunction()),this._canvasView.addInteractionObserver(this._dragToAnimateBehavior)})}break}}return null}getTransitionMixinForStateSwap(e,t,n){switch(t.cause){case 5:{if(!n&&Ut.TransitionAction_getControlSource(t.cause)!=0){let r=hn.computeDragVectorForStateSwap(t,e);if(r!=null&&r.length()>0)return bs._new(o=>{this._dragToAnimateBehavior!=null&&this.clearDrag(this._dragToAnimateBehavior),this._dragToAnimateBehavior=new hn(this,r,o,t.easingFunction()),this._canvasView.addInteractionObserver(this._dragToAnimateBehavior)})}break}}return null}},wi=class wi{static computeOverlaySwipeDragVector(e,t,n){let r=n.size(),o=e.drawsEnteringFrameOnTopOfExitingFrame()?e.enteringFrameTransition():e.exitingFrameTransition();return r.multiply1(o.to().translation1().subtract1(o.from().translation1()))}static computeScreenSwipeDragVector(e,t,n){let r=t.size().max2(n.size()),o=e.drawsEnteringFrameOnTopOfExitingFrame()?e.enteringFrameTransition():e.exitingFrameTransition();return r.multiply1(o.to().translation1().subtract1(o.from().translation1()))}static computeSmartAnimateDragVector(e,t,n){if(t!=null&&n!=null&&e!=null){let r=Fo.getNodeMatches(t,n),o=Be.StringMap_get(r,e.id(),null);if(o!=null){let a=t.absoluteTransform().inverse().multipliedBy1(e.absoluteTransform()).transformPoint(e.size().divide(2));return n.absoluteTransform().inverse().multipliedBy1(o.absoluteTransform()).transformPoint(o.size().divide(2)).subtract1(a)}}return null}static computeDragVectorImpl(e,t,n,r,o,a,s){if(e==null)return null;if(t!=null&&n!=null){if(o=="SMART_ANIMATE"||Dn.supportsSmartAnimate(o)&&s){let c=wi.computeSmartAnimateDragVector(e,t,n);if(c!=null&&c.length()>0)return c}if(["DISSOLVE","INSTANT_TRANSITION","SMART_ANIMATE"].indexOf(o)==-1){let c=Rn.get(o);r==1&&(c=c.reversed());let p=null;if(["OVERLAY","SWAP"].indexOf(a)!=-1?p=wi.computeOverlaySwipeDragVector(c,t,n):p=wi.computeScreenSwipeDragVector(c,t,n),p.length()>0)return p}}return null}static computeDragVector1(e,t,n,r,o){if(e==null||t==null)return null;let a=null;for(let f of t.allActions())if(["INTERNAL_NODE","BACK","CLOSE"].indexOf(f.connectionType())!=-1){a=f;break}if(a==null)return null;let s=a.connectionType(),l=null,d=null,c=a.transitionShouldSmartAnimate(),p=0,u=n,h=null;if(s=="INTERNAL_NODE")if(d=a.navigationType(),l=a.transitionType(),d=="SWAP_STATE"){let f=Zt.whichInstanceToSwap(e,a.transitionNodeID());f!=null&&(u=f,h=e.scene().findNode1(a.transitionNodeID()))}else d=="SWAP"&&(u=e.topLevelAncestor()),h=r.getDestinationFrame(a.transitionNodeID());else if(s=="BACK"){let f=o.getPreviousNonTransientChange();if(f==null)return null;h=r.getDestinationFrame(f.oldStateId()),l=f.transitionParameters.transitionType,d="NAVIGATE",p=1}else if(s=="CLOSE"){h=e.topLevelAncestor();let f=o.getOpenOverlayData(h.id());if(f==null)return null;l=f.openingTransitionType(),d="OVERLAY",p=1}return wi.computeDragVectorImpl(e,u,h,p,l,d,c)}static computeDragVector2(e,t,n){let r=null,o=null;if(e.oldStateId()==e.newStateId()&&e.oldOverlayData().length>0&&e.oldOverlayData().length==e.newOverlayData().length){let s=e.oldOverlayData()[e.oldOverlayData().length-1],l=e.newOverlayData()[e.newOverlayData().length-1];r=n.findNode1(s.id),o=n.findNode1(l.id)}else if(r=n.findNode1(e.oldStateId()),e.transitionParameters.navigationType=="OVERLAY"){let s=e.direction==1?e.getRemovedFrameIds():e.getInsertedFrameIds();o=n.findNode1(s[0])}else o=n.findNode1(e.newStateId());return wi.computeDragVectorImpl(t,r,o,e.direction,e.transitionParameters.transitionType,e.transitionParameters.navigationType,e.transitionParameters.transitionShouldSmartAnimate)}static computeDragVectorForStateSwap(e,t){var a,s;let n=t.findNode3(e.stablePath),r=(a=n==null?void 0:n.transitioningFrom)==null?void 0:a.exitingTransitionRoot,o=(s=n==null?void 0:n.transitioningFrom)==null?void 0:s.hotspotInExitingTree;return wi.computeDragVectorImpl(o,r,n,e.direction,e.transitionParameters.transitionType,e.transitionParameters.navigationType,e.transitionParameters.transitionShouldSmartAnimate)}constructor(e,t,n,r){var o;this._dragStartPosition=null,this._currPointerPosition=null,this._lastPointerPosition=null,this._currPointerTime=-1,this._lastPointerTime=-1,this._didRecordPointerPosition=!1,this._pointerVelocity=null,this._shouldRevertTransition=!1,this._behaviorManager=null,this._dragVector=null,this._easingFunction=null,this._transitionProgress=null,this._lastPointerTime=ke.seconds(),this._behaviorManager=e,this._dragVector=t,this._easingFunction=r,this._transitionProgress=n,(o=this._transitionProgress)==null||o.pinProgressToExternalControl(()=>this.onTickProgress(),()=>this.onTransitionEnded())}handleDrag(e){this._lastPointerTime=this._currPointerTime,this._lastPointerPosition=this._currPointerPosition,this._currPointerTime=ke.seconds(),this._currPointerPosition=e,this._didRecordPointerPosition=!0}handleDragStart(e){this._dragStartPosition=e}handleRelease(e){if(this._transitionProgress!=null&&this._transitionProgress.isProgressControlledExternally()){let t=this._transitionProgress.progress(),n=this._easingFunction!=null?this._easingFunction.invert(t):t,r=this.signedDragSpeed(),o=this._transitionProgress.duration(),a=o>0?wi.DRAG_SPEED_THRESHOLD_MULTIPLE/o:0,s=r>=a,l=r<=-a;this._shouldRevertTransition=!1,t>=.5?this._shouldRevertTransition=l:this._shouldRevertTransition=!s;let d=1;if(this._shouldRevertTransition&&(d=un.Math_clamp1(Math.log(n+.5)/Math.log(2)+1,.02,1)),Math.abs(r)>=1/o){let c=this._easingFunction!=null?this._easingFunction.getDerivative(n,r):1;d=Math.abs(r/c)}this._transitionProgress.pinProgressToRealTimeWithDuration(n,o/d,this._shouldRevertTransition)}}onTickProgress(){if(this._dragVector!=null){if(this._currPointerPosition!=null&&this._dragStartPosition!=null){if(this._lastPointerPosition!=null&&this._lastPointerTime!=-1){let n=this._currPointerTime;this._didRecordPointerPosition||(this._lastPointerTime=this._currPointerTime,this._lastPointerPosition=this._currPointerPosition,n=ke.seconds(),this._currPointerTime=n),this._pointerVelocity=this._currPointerPosition.subtract1(this._lastPointerPosition).divide(n-this._lastPointerTime)}let e=this._currPointerPosition.subtract1(this._dragStartPosition),t=un.Math_clamp1(e.dot(this._dragVector)/Math.pow(this._dragVector.length(),2),0,1);return this._didRecordPointerPosition=!1,t}return this._didRecordPointerPosition=!1,0}return this._didRecordPointerPosition=!1,1}onTransitionEnded(){return this._dragStartPosition=null,this._dragVector=null,this._easingFunction=null,this._transitionProgress=null,this._behaviorManager!=null&&this._behaviorManager.clearDrag(this),this._shouldRevertTransition?Hr.TransitionEndedAction.ABORT:Hr.TransitionEndedAction.COMMIT}signedDragSpeed(){return this._pointerVelocity==null||this._dragVector==null?0:this._dragVector.length()>0?this._pointerVelocity.dot(this._dragVector)/Math.pow(this._dragVector.length(),2):0}};wi.DRAG_SPEED_THRESHOLD_MULTIPLE=.15;var hn=wi;var Dp=Wa(xs());var nd=class{constructor(){if(arguments[0]==0){let[,e]=arguments;this.ws=null,this.ws=e}else if(arguments[0]==1){let[,e]=arguments;this.ws=null,this.ws=new WebSocket(e)}}url(){return this.ws.url}readyState(){return this.ws.readyState}setBinaryType(e){this.ws.binaryType=e}binaryType(){return this.ws.binaryType}setOnclose(e){this.ws.onclose=t=>{e(t)}}setOnerror(e){this.ws.onerror=t=>{e(t)}}setOnmessage(e){this.ws.onmessage=t=>{e(new jg(t))}}setOnopen(e){this.ws.onopen=t=>{e(t)}}close(){this.ws.close()}send1(e){this.ws.send(e)}send2(e){this.ws.send(e)}equals(e){var t;return this.ws==((t=e==null?void 0:e.asHTMLSocket())==null?void 0:t.ws)}asHTMLSocket(){return this}asMockSocket(){return null}},Sp=class Sp{simulateDidOpen(){if(this._readyState=oi.Socket_OPEN,this._onopen!=null){let e={meta:"Fake open event for testing"};this._onopen(e)}}simulateDidClose(){if(this._readyState=oi.Socket_CLOSED,this._onclose!=null){let e={meta:"Fake close event for testing"};this._onclose(e)}}simulateMessage(e){this._onmessage!=null&&this._onmessage(e)}url(){return Sp.FAKE_URL}readyState(){return this._readyState}setBinaryType(e){this._binaryType=e}binaryType(){return this._binaryType}setOnclose(e){this._onclose=e}setOnerror(e){this._onerror=e}setOnmessage(e){this._onmessage=e}setOnopen(e){this._onopen=e}close(){this._readyState=oi.Socket_CLOSING}send1(e){this.sent.push(new Uint8Array(e))}send2(e){this.sent.push(new Uint8Array(e.buffer,e.byteOffset,e.byteLength))}equals(e){return(e==null?void 0:e.asMockSocket())==this}asHTMLSocket(){return null}asMockSocket(){return this}constructor(){this._readyState=oi.Socket_CONNECTING,this._binaryType="blob",this._onclose=null,this._onerror=null,this._onmessage=null,this._onopen=null,this.sent=[]}};Sp.FAKE_URL="ws://fake_url_for_tests_value_does_not_matter.com";var Jg=Sp;var jg=class{isArrayBuffer(){return this.messageEvent.data instanceof ArrayBuffer}isBlob(){return this.messageEvent.data instanceof Blob}isString(){return typeof this.messageEvent.data=="string"}dataAsArrayBuffer(){return this.messageEvent.data}dataAsBlob(){return this.messageEvent.data}dataAsString(){return this.messageEvent.data}constructor(e){this.messageEvent=e}},oi;(r=>(r.Socket_CONNECTING=0,r.Socket_OPEN=1,r.Socket_CLOSING=2,r.Socket_CLOSED=3))(oi||(oi={}));var rd=class{constructor(e){this._imagesByNodeId=null,this._nodeIdsByImage=null,e.addAppObserver(this),this._imagesByNodeId=new Map,this._nodeIdsByImage=new Eo(t=>t.objectHash())}imagesUsedByNode(e){return Be.StringMap_get(this._imagesByNodeId,e,new Map)}nodesUsedByImage(e){return Array.from(this._nodeIdsByImage.get(e,new Map).values())}nodesThatUseAnImage(){return Array.from(this._imagesByNodeId.keys())}handleSceneChange(e,t){e!=null&&e.removeObserver(this),t!=null&&t.addObserver(this),this._imagesByNodeId=new Map,this._nodeIdsByImage.clear(),t!=null&&this._addImageNodeReferencesInSubtree(t.root())}handleActiveCanvasChange(e,t){}handleActivePrototypeStartingPointChange(e,t){}_trackImageUse(e,t){this._imagesByNodeId.has(e.id())||this._imagesByNodeId.set(e.id(),new Map),this._imagesByNodeId.get(e.id()).set(t.objectHash(),t),this._nodeIdsByImage._in(t)||this._nodeIdsByImage.set(t,new Map),this._nodeIdsByImage.get1(t).set(e.id(),e.id())}_removeImageUse(e,t){Array.from(this._imagesByNodeId.keys()).indexOf(e.id())!=-1&&(this._imagesByNodeId.get(e.id()).delete(t.objectHash()),this._imagesByNodeId.get(e.id()).size==0&&this._imagesByNodeId.delete(e.id())),this._nodeIdsByImage._in(t)&&(this._nodeIdsByImage.get1(t).delete(e.id()),this._nodeIdsByImage.get1(t).size==0&&this._nodeIdsByImage.remove(t))}handleSceneGraphEvent(e){let t=Zr.affectsImagesUsedByNode(e.property);if(!(!(t||e.property==8||e.property==25)||!(e.node.isVisibleInCanvas()||e.property==8&&Ze.asBool(e.oldVal)&&!Ze.asBool(e.newVal)&&(e.node.parent()!=null&&e.node.parent().isVisibleInCanvas())))){if(t){let r=e.node.collectUniqueUsedImages(),o=Be.StringMap_get(this._imagesByNodeId,e.node.id(),new Map);for(let a of Array.from(o.keys()))r.has(a)||this._removeImageUse(e.node,o.get(a));for(let a of Array.from(r.keys()))o.has(a)||this._trackImageUse(e.node,r.get(a))}else if(e.property==8){let r=Ze.asBool(e.oldVal)&&(e.node.parent()!=null?e.node.parent().isVisibleInCanvas():!1),o=Ze.asBool(e.newVal)&&(e.node.parent()!=null?e.node.parent().isVisibleInCanvas():!1);!r&&o?this._addImageNodeReferencesInSubtree(e.node):r&&!o&&this._removeImageNodeReferencesInSubtree(e.node)}else if(e.property==25){let r=e.oldVal!=null&&Ze.isParentIndex(e.oldVal)?Ze.asParentIndex(e.oldVal):null,o=e.newVal!=null&&Ze.isParentIndex(e.newVal)?Ze.asParentIndex(e.newVal):null,a=r!=null?e.node.scene().findNode1(r.id):null,s=o!=null?e.node.scene().findNode1(o.id):null,l=a!=null&&a.isRooted(),d=s!=null&&s.isRooted();l&&!d?this._removeImageNodeReferencesInSubtree(e.node):!l&&d&&this._addImageNodeReferencesInSubtree(e.node)}}}_removeImageNodeReferencesInSubtree(e){for(let t=0,n=e.childCount();t<n;t=t+1)this._removeImageNodeReferencesInSubtree(e.childAt1(t));e.forEachSinglePaint(t=>{(t.type()=="IMAGE"||t.type()=="EMOJI"||t.type()=="VIDEO")&&(t.image()!=null&&this._removeImageUse(e,t.image()),t.imageThumbnail()!=null&&this._removeImageUse(e,t.imageThumbnail()))}),e.forEachEmojiInTextData(t=>{this._removeImageUse(e,t)})}_addImageNodeReferencesInSubtree(e){if(e.visible()){for(let t=0,n=e.childCount();t<n;t=t+1)this._addImageNodeReferencesInSubtree(e.childAt1(t));e.forEachSinglePaint(t=>{(t.type()=="IMAGE"||t.type()=="EMOJI"||t.type()=="VIDEO")&&(t.image()!=null&&this._trackImageUse(e,t.image()),t.imageThumbnail()!=null&&this._trackImageUse(e,t.imageThumbnail()))}),e.forEachEmojiInTextData(t=>{this._trackImageUse(e,t)})}}};var yp=class{clear(){this._images=[],this._imageByHash=new Map}allImages(){return this._images}appendIfMissing(e){this._imageByHash.has(e.objectHash())||(this._imageByHash.set(e.objectHash(),e),this._images.push(e))}count(){return this._images.length}isEmpty(){return this.count()==0}takeFirst(){let e=this._images.shift();return this._imageByHash.delete(e.objectHash()),e}constructor(){this._images=[],this._imageByHash=new Map}},xb=(t=>(t[t.ON_SCREEN=0]="ON_SCREEN",t[t.PRERENDERING=1]="PRERENDERING",t))(xb||{}),Zg=(t=>(t[t.IS_EMOJI=0]="IS_EMOJI",t[t.IS_NOT_EMOJI=1]="IS_NOT_EMOJI",t))(Zg||{}),bp=class{constructor(e,t,n,r){this._loadType=null,this._delaySeconds=0,this._startCondition=null,this._endCondition=null,this._startConditionSeconds=-1,this._endConditionSeconds=-1,this._numSuccesses=0,this._numFailures=0,this._numGIFs=0,this._loadType=e,this._delaySeconds=t,this._startCondition=n,this._endCondition=r}reset(){this._startConditionSeconds=-1,this._endConditionSeconds=-1,this._numSuccesses=0,this._numFailures=0}_hasMetStartCondition(){return this._startConditionSeconds>=0}_hasMetEndCondition(){return this._endConditionSeconds>=0}onFrame(){!this._hasMetStartCondition()&&this._startCondition()&&(this._startConditionSeconds=ke.seconds()),this._hasMetStartCondition()&&!this._hasMetEndCondition()&&this._endCondition()&&(this._endConditionSeconds=ke.seconds()),this._hasMetStartCondition()&&this._hasMetEndCondition()&&ke.seconds()-this._endConditionSeconds>=this._delaySeconds&&(this.trackEvent(),this.reset()),this._hasMetStartCondition()&&this._hasMetEndCondition()&&!this._endCondition()&&(this._endConditionSeconds=-1)}trackSuccess(e){this._hasMetStartCondition()&&(this._numSuccesses=this._numSuccesses+1),e==0&&(this._numGIFs=this._numGIFs+1)}trackFailure(e){this._hasMetStartCondition()&&(this._numFailures=this._numFailures+1),e==0&&(this._numGIFs=this._numGIFs+1)}trackEvent(){Pe.trackEvent("images_loaded",{viewer_mode:Y.getViewerMode(),load_type:this._loadType,num_successes:this._numSuccesses,num_failures:this._numFailures,num_gifs:this._numGIFs,duration_s:this._endConditionSeconds-this._startConditionSeconds,fast_image_decode:Un.browserSupportsFastImageDecoding()},{forwardToDatadog:!0})}};var Tp=class i{delayBetweenInvalidations(){return Lr||mi?0:2}constructor(e,t){this._scene=null,this._appState=null,this._prototypeStructure=null,this._previousFileKey="",this._imageResources=new Map,this._emojiResources=new Map,this._imageUseTracker=null,this.MAX_SIMULTANEOUS_PRELOADING=4,this._imageQueue=new hp,this._outboundRequestPriorities=new Map,this._thumbLoadTracker=null,this._fullsizeImageLoadTracker=null,this._requestsInFlight=0,this._needsUpdate=!1,this._needAllThumbnails=!0,this._newlyLoadedImages=new yp,this._topLevelGuidsNeeded=new Ar,this.onImageLoaded=null,this.lastImageLoadedCallbackTime=0,this._pendingRequestSuccessForImage=new Map,this._pendingRequestFailureForImage=new Map,this._shouldInvestigateNextImageFailure=!0,this._showImageFetchFailureUI=null,Kr()!==null&&!Kr().getImageMemoryStats&&(Kr().getImageMemoryStats=()=>{let r=wn.getMax("WEBGL_TEXTURE (Image)"),o=wn.getMax("Decoded image data in RAM (MB)");return{vramMaxForImages:r,ramMaxForImages:o}},Kr().getNumRequestsInFlight=()=>this._requestsInFlight),this._imageUseTracker=new rd(e),this._appState=e,this._prototypeStructure=e.prototypeStructure(),this._showImageFetchFailureUI=t,e.addAppObserver(this),e.addFrameObserver(this),e.prototypeState().addObserver(this);let n=2==0?0:2.5;this._thumbLoadTracker=new bp("thumbs_loaded",n,()=>this._computeTopImagePriority().type==4,()=>this._computeTopImagePriority().type<4),this._fullsizeImageLoadTracker=new bp("fullsize_images_loaded",n,()=>this._computeTopImagePriority().type>=3,()=>this._computeTopImagePriority().type<3)}handleStateChangeAborted(e){}handleStateChangeCommitted(e,t){}handleStateChangeInitiated(e){var t,n;if(yr.advanceGeneration(),e.oldStateId()==null&&this._onTransitionGraphChange(),this._restartGIFsOnEnteringScreens(e),this.clearUnneededTextures(e),this._needAllThumbnails){let r=(n=(t=this._scene)==null?void 0:t.findNode1(e.newStateId()))==null?void 0:n.canvas();this.preloadAllThumbnails(r)}}handleStateChangeRequested(e){}handleFitModeChange(e,t){}handleRestartPrototype(){}clearQueuesAndDecodedDataForAllImages(e){this._imageQueue.clear(),this._clearDecodedDataForAllImagesRecursive(e)}_clearDecodedDataForAllImagesRecursive(e){if(e!=null){this.clearDecodedDataForAllImages(e);for(let t=0,n=e.childCount();t<n;t=t+1){let r=e.childAt1(t);this._clearDecodedDataForAllImagesRecursive(r)}}}clearDecodedDataForAllImages(e){e.forEachSinglePaint(t=>{if(t.image()==null)return;let n=this._imageUseTracker.nodesUsedByImage(t.image());t.image().freeMemoryForDecodedDataAndTexture()&&n.forEach(r=>{var o;(o=this._scene.findNode1(r))==null||o.invalidateRenderTreeForSelfAndParents()})}),e.forEachSinglePaint(t=>{if(t.imageThumbnail()==null)return;let n=this._imageUseTracker.nodesUsedByImage(t.imageThumbnail());t.imageThumbnail().freeMemoryForDecodedDataAndTexture()&&n.forEach(r=>{var o;(o=this._scene.findNode1(r))==null||o.invalidateRenderTreeForSelfAndParents()})}),e.forEachEmojiInTextData(t=>{let n=this._imageUseTracker.nodesUsedByImage(t);t.freeMemoryForDecodedDataAndTexture()&&n.forEach(r=>{var o;(o=this._scene.findNode1(r))==null||o.invalidateRenderTreeForSelfAndParents()})})}clearQueuesAndDecodedDataForFullResolutionImages(e){this._imageQueue.clear();let t=this._appState.currentFileKey();e!=null&&this._previousFileKey!=null&&this._previousFileKey.length>1&&t!=this._previousFileKey&&this._clearDecodedDataForFullResolutionImagesRecursive(e),this._previousFileKey=t}_clearDecodedDataForFullResolutionImagesRecursive(e){if(e!=null){this.clearDecodedDataForFullResolutionImages(e);for(let t=0,n=e.childCount();t<n;t=t+1){let r=e.childAt1(t);this._clearDecodedDataForFullResolutionImagesRecursive(r)}}}clearDecodedDataForFullResolutionImages(e){e.forEachSinglePaint(t=>{var r;if(t.image()==null)return;let n=this._imageUseTracker.nodesUsedByImage(t.image());if(!(t.imageThumbnail()!=null&&t.image().objectHash()==t.imageThumbnail().objectHash())){for(let o of n){let a=(r=this._scene.findNode1(o))==null?void 0:r.topLevelAncestor();if(a!=null&&this._topLevelGuidsNeeded._in(a.id()))return}t.image().freeMemoryForDecodedDataAndTexture()&&n.forEach(o=>{var a;(a=this._scene.findNode1(o))==null||a.invalidateRenderTreeForSelfAndParents()})}}),e.forEachEmojiInTextData(t=>{var r;let n=this._imageUseTracker.nodesUsedByImage(t);for(let o of n){let a=(r=this._scene.findNode1(o))==null?void 0:r.topLevelAncestor();if(a!=null&&this._topLevelGuidsNeeded._in(a.id()))return}t.freeMemoryForDecodedDataAndTexture()&&n.forEach(o=>{var a;(a=this._scene.findNode1(o))==null||a.invalidateRenderTreeForSelfAndParents()})})}_restartGIFsOnEnteringScreens(e){var r;if(e.newStateId()!=null&&e.newStateId()!=e.oldStateId()){let o=(r=this._scene)==null?void 0:r.findNode1(e.newStateId());o!=null&&this._restartGIFsInSubtree(o)}let t=e.newOverlayData(),n=e.oldOverlayData();for(let o=0,a=t.length;o<a;o=o+1)if(o>=n.length||n[o].id!=t[o].id){let s=this._scene.findNode1(t[o].id);s!=null&&this._restartGIFsInSubtree(s)}}_restartGIFsInSubtree(e){e.restartGifs(),e.forEachChild(t=>{this._restartGIFsInSubtree(t)})}clearUnneededTextures(e){if(this._scene!=null&&this._appState.baseScreenId()!=null){this._topLevelGuidsNeeded=new Ar,this._prototypeStructure.getPrerenderingJobs(null).forEach(t=>{let n=t.asScreen();n!=null&&this._topLevelGuidsNeeded.add(n.nodeId)}),e.oldStateId()!=null&&this._topLevelGuidsNeeded.add(e.oldStateId()),e.newStateId()!=null&&this._topLevelGuidsNeeded.add(e.newStateId());for(let t of this._imageUseTracker.nodesThatUseAnImage()){let n=this._scene.findNode1(ee.fromString(t));if(n==null)continue;let r=n.topLevelAncestor();r!=null&&this._topLevelGuidsNeeded._in(r.id())||this.clearDecodedDataForFullResolutionImages(n)}}}handleSceneChange(e,t){e!=null&&this.clearQueuesAndDecodedDataForFullResolutionImages(e.root()),this._scene=t,this._needAllThumbnails=!0,e!=null&&e.removeObserver(this),t!=null&&t.addObserver(this),this._onTransitionGraphChange()}preloadAllThumbnails(e){this._scene==null||e==null||(Be.StringMap_each(i.getThumbnailsInSubtree(e),(t,n)=>{this._imageQueue.insertOrUpdate(n,yr.OTHER)}),this._needAllThumbnails=!1)}handleActiveCanvasChange(e,t){this.clearQueuesAndDecodedDataForFullResolutionImages(e),this.preloadAllThumbnails(t)}handleActivePrototypeStartingPointChange(e,t){}handleSceneGraphEvent(e){(e.property==71||e.property==69||e.property==25)&&this._onTransitionGraphChange()}resetForRenderingTests(){this._imageQueue.clear(),this._newlyLoadedImages.clear(),this.lastImageLoadedCallbackTime=0}onFrame(){this._needsUpdate&&this._traverseSceneForImages(),!this._newlyLoadedImages.isEmpty()&&ke.seconds()-this.lastImageLoadedCallbackTime>=this.delayBetweenInvalidations()&&(this.lastImageLoadedCallbackTime=ke.seconds(),this._onImagesLoaded()),this._thumbLoadTracker.onFrame(),this._fullsizeImageLoadTracker.onFrame(),this._needsUpdate=!1}_computeTopImagePriority(){let e=yr.OTHER;this._imageQueue.count()>0&&(e=yr.max(e,this._imageQueue.maxPriority().value));for(let t of Array.from(this._outboundRequestPriorities.values()))e=yr.max(e,t);return e}findImageByHexHash(e,t){return t==0?Be.StringMap_get(this._emojiResources,e,null):Be.StringMap_get(this._imageResources,e,null)}onNewImage(e,t,n){let r=t==0?this._emojiResources:this._imageResources;r.has(e)||(r.set(e,n),this._appState.baseScreenId()==null)||(this._imageQueue.insertOrUpdate(n,yr.OTHER),this._processNextItemFromRenderQueues())}requestImageForRendering(e,t){this._imageQueue.insertOrUpdate(e,t),this._processNextItemFromRenderQueues()}_onImagesLoaded(){if(this.onImageLoaded!=null){if(this._scene!=null)for(let e=0,t=this._newlyLoadedImages.allImages().length;e<t;e=e+1){let n=this._newlyLoadedImages.allImages()[e];for(let r of this._imageUseTracker.nodesUsedByImage(n)){let o=this._scene.findNode1(r);o!=null&&this.onImageLoaded(o)}}this._newlyLoadedImages.clear()}}_onTransitionGraphChange(){this._needsUpdate=!0}_traverseSceneForImages(){let e=this._appState.baseScreenId();this._scene!=null&&e!=null&&this._processNextItemFromRenderQueues()}postMessageToPerfTests(e){Kr().figmaPerfTesting&&Kr().postMessage({name:e,value:0},"*")}incrementRequestsInFlight(e){this._requestsInFlight=this._requestsInFlight+e,wn.trackNumber("Image requests in flight",this._requestsInFlight),this._requestsInFlight==0&&this.postMessageToPerfTests("IMAGES_FINISHED_LOADING")}_requestImage(e,t,n,r){this._pendingRequestSuccessForImage.has(e.objectHash())||this._pendingRequestSuccessForImage.set(e.objectHash(),[]),this._pendingRequestSuccessForImage.get(e.objectHash()).push(n),this._pendingRequestFailureForImage.has(e.objectHash())||this._pendingRequestFailureForImage.set(e.objectHash(),[]),this._pendingRequestFailureForImage.get(e.objectHash()).push(r),e!=null&&e.state()==1&&this._processNextItemFromRenderQueues(),this._outboundRequestPriorities.set(e.objectHash(),yr.max(t,Be.StringMap_get(this._outboundRequestPriorities,e.objectHash(),yr.OTHER))),this.incrementRequestsInFlight(1),e.fetchAndDecode(1,o=>{this._thumbLoadTracker.trackSuccess(e.imageType()),this._fullsizeImageLoadTracker.trackSuccess(e.imageType()),this.incrementRequestsInFlight(-1),this._newlyLoadedImages.appendIfMissing(e);for(let a of this._pendingRequestSuccessForImage.get(e.objectHash()))a(o);this._pendingRequestSuccessForImage.set(e.objectHash(),[]),this._pendingRequestFailureForImage.set(e.objectHash(),[]),this._outboundRequestPriorities.delete(e.objectHash()),this._processNextItemFromRenderQueues()},o=>{if((Fa.ImagePriorityType_isOnScreen(t.type)||Fa.ImagePriorityType_isPrerender(t.type))&&o==0&&this._shouldInvestigateNextImageFailure){this._shouldInvestigateNextImageFailure=!1;let s=l=>{l==0?(this._showImageFetchFailureUI(),Pe.trackEvent("show_image_failure_ui",{imagePriority:gl[t.type]})):this._shouldInvestigateNextImageFailure=!0};new Mr(e.url()).get().then(l=>{s(l.status)},l=>{s(l.status)})}this._thumbLoadTracker.trackFailure(e.imageType()),this._fullsizeImageLoadTracker.trackFailure(e.imageType()),this.incrementRequestsInFlight(-1),this._processNextItemFromRenderQueues();for(let s of this._pendingRequestFailureForImage.get(e.objectHash()))s(t);this._pendingRequestSuccessForImage.set(e.objectHash(),[]),this._pendingRequestFailureForImage.set(e.objectHash(),[]),this._outboundRequestPriorities.delete(e.objectHash())})}_processNextItemFromRenderQueues(){if(this._requestsInFlight>=this.MAX_SIMULTANEOUS_PRELOADING||this._imageQueue.count()==0)return;let e=this._imageQueue.peek(),t=this._imageQueue.getPriority(e);this._imageQueue.remove(e),this._requestImage(e,t.value,n=>{},n=>{if(n.type==2||n.type==4)for(let o of this._imageUseTracker.nodesUsedByImage(e)){let a=this._scene.findNode1(o);a!=null&&a.forEachSinglePaint(s=>{let l=s.imageThumbnail()!=null&&s.imageThumbnail().objectHash()==e.objectHash(),d=s.imageThumbnail()!=null&&s.image()!=null&&s.image().objectHash()==s.imageThumbnail().objectHash();if(l&&!d&&s.image()!=null){let c=e!=null?e.objectHash():null,p=s.image()!=null?s.image().objectHash():null;console.warn(`Failed to fetch thumbnail ${c}; fetching full size image ${p}`);let u=n.type==2?yr.forType(1):n.type==4?yr.forType(3):yr.OTHER;this.requestImageForRendering(s.image(),u)}})}})}hasPendingImages(){return this._needsUpdate||this._requestsInFlight>0||Fa.ImagePriorityType_isOnScreen(this._computeTopImagePriority().type)||!this._newlyLoadedImages.isEmpty()}static getThumbnailsInSubtree(e){let t=new Map,n=new Map;return i._getImagesInSubtree(e,t,n),n}static _getImagesInSubtree(e,t,n){e.forEachSinglePaint(r=>{r.image()!=null&&t.set(r.image().objectHash(),r.image()),r.imageThumbnail()!=null&&n.set(r.imageThumbnail().objectHash(),r.imageThumbnail())}),e.forEachEmojiInTextData(r=>{n.set(r.objectHash(),r)});for(let r=0,o=e.childCount();r<o;r=r+1){let a=e.childAt1(r);i._getImagesInSubtree(a,t,n)}}},Ob;(e=>{function i(t){return xb[t]}e.RenderPurpose_toString=i})(Ob||(Ob={}));var wb;(e=>{function i(t){return Zg[t]}e.IsEmoji_toString=i})(wb||(wb={}));var vp=class{track(e,t){this._frameRequestInfo.set(e,t)}getMetricsForRequestedNode(e){return this._frameRequestInfo.get(e)}clear(){this._frameRequestInfo.clear()}constructor(){this._frameRequestInfo=new Map}};var Ip=class{hash(){return Un.bytesToHex(this._hash)}getVideoManager(){return this._videoManager}size(e){return this._videoManager.getVideoRuntimeForPaint(e).size()}didLoad(e){let t=this._videoManager.getVideoRuntimeForPaint(e);return t==null?!1:t.isReadyToPlay()}getOrCreateTexture(e,t,n){let r=this._videoManager.getVideoRuntimeForPaint(e);return r==null||r.shouldDisplayThumbnail?null:r.getOrCreateTexture(t,n)}pause(e){let t=this._videoManager.getVideoRuntimeForPaint(e);t!=null&&t.pause()}constructor(e,t){this.id=(Pb=Pb+1)+-1,this._hash=e,this._videoManager=t,this._loadComplete=!1}},Pb=0;var vl=class vl{clone(){let e=new vl(this._hash,this._sourceURL,this._metaMP4Url,this._videoManager);return this._videoManager.enqueueVideoOrStartLoad(e),e}isReadyToPlay(){if(this._player==null||!this._loadComplete||this._isInErrorState)return!1;if(Je.ios()||this._seeking)return this._player.readyState()>Tl.HAVE_NOTHING;{let e=this._player.currentTime()==this._player.duration()&&this._player.readyState()>=Tl.HAVE_CURRENT_DATA;return this._player.readyState()>=Tl.HAVE_FUTURE_DATA||e}}isInErrorState(){return this._isInErrorState}uninitialize(){this._player!=null&&(this.pause(),this.setMuted(!1),this.resetToStartTime(),this._player.dispose())}toString(){if(this._player==null)return`Runtime(id=${this.id},  <NO VIDEO INFORMATION> )`;let e=this._player.currentTime()|0,t=ht.int_remainder(e,60)<10?`0${ht.int_remainder(e,60)}`:`${ht.int_remainder(e,60)}`,r=`${(e/60|0)<10?`0${e/60|0}`:`${e/60|0}`}:${t}`;return this._isInErrorState?`Runtime(id=${this.id}, <LOADING ERROR>)`:`Runtime(id=${this.id}, time=${r}, ready=${this.isReadyToPlay()}, P=${!this._player.paused()}, M=${this._player.muted()}, L=${this._loop})`}_setMuted(e,t){if(this._player!=null){Je.ios()&&!e&&this._videoManager.muteAllOtherVideos(this);try{this._player.muted(e),t&&(this.overriddenMutedState=new _e(e))}catch{Pe.trackEvent("video_mute_failure",{errorState:this._isInErrorState,loadComplete:this._loadComplete,fileType:this._fileTypeLoading})}}}setMutedByVideoAction(e){this._setMuted(e,!0)}setMuted(e){this._setMuted(e,!1)}muted(){return this._player!=null?this._player.muted():!0}setLoop(e){this._loop=e}size(){return this._player==null?null:new I(this._player.videoWidth(),this._player.videoHeight())}_pause(e){ii.VERBOSE_LOGS&&console.log("VideoResource #",this.id,": Pausing"),this._player!=null&&(this._player.pause(),e&&(this.overriddenPlayingState=new _e(!1)))}pauseByVideoAction(){this._pause(!0)}pause(){this._pause(!1)}_play(e,t){ii.VERBOSE_LOGS&&(e?console.log("VideoResource #",this.id,": Loop playback"):console.log("VideoResource #",this.id,": Start playback")),this._player!=null&&this.isReadyToPlay()&&(Y.getFeatureFlags().video_on_ios_staging||(this.shouldDisplayThumbnail=!1),this._player.play().then(n=>{t&&(this.overriddenPlayingState=new _e(!0)),this.reportPlaySuccessAnalytics()},n=>{let r=n.message+"";r.indexOf("The play() request was interrupted")!=-1?this.reportPlayFailureAnalytics(e?`Loop error: ${r}`:r):(console.warn("User has yet to interact with page, starting video muted",n),this.setMuted(!0),this._player.play().then(o=>{},o=>{let a=o.message+"";e&&(a=`Loop error: ${a}`),this.reportPlayFailureAnalytics(a)}))}))}_playLoop(){this._play(!0,!1)}playByVideoAction(){this._play(!1,!0)}play(){this._play(!1,!1)}duration(){return this._player!=null?this._player.liveTracker!=null?this._player.liveTracker.seekableEnd():this._player.duration():0}currentTime1(){return this._player!=null?this._player.currentTime():0}currentTime2(e){this._player!=null&&(this._player.paused()&&this._player.one("timeupdate",t=>{this.invalidateTexture()}),this._player.currentTime(e))}resetToStartTime(){this.currentTime2(0)}isPlaying(){return this._player==null?!1:!this._player.paused()}invalidateTexture(){if(this._texture==null)return;this._texture.invalidateVideoFrame()}_handleOnLoadedMetadata(){var e;ii.VERBOSE_LOGS&&console.log("VideoResource #",this.id,": Loading completed"),this.reportLoadSuccessAnalytics(),this._loadComplete=!0,window.vid=this,(e=this._videoManager)==null||e.onVideoLoaded(this)}_beginLoadingHLS(e){this._loadTimeTracker.start(),this._fileTypeLoading="hls",this._player.src({type:"application/x-mpegURL",src:this._sourceURL}),this._player.one("error",t=>{this._loadTimeTracker.end(),console.warn("Reverting to fallback media source"),this.reportLoadFailureAnalytics("Failed to access HLS manifest"),this._beginLoadingMP4()})}_getMP4Url(){let e=new ro;return this._MP4VideoUrl!=null?(e.resolve(this._MP4VideoUrl),e):(new Mr(this._metaMP4Url).get().then(t=>{let n=null;try{n=JSON.parse(t.text)}catch{e.reject("Failed to parse response");return}let r=new _e(n.status);if(r.value===void 0){e.reject("Failed to parse status from response");return}if(r.value!=200){e.reject(`Status is ${r.value}: ${n.message}`);return}let o=n.meta;if(o===void 0){e.reject("Status is 200, but failed to parse signed_url");return}let a=o.signed_url;if(a===void 0){e.reject("Status is 200, but failed to parse signed_url");return}this._MP4VideoUrl=a,e.resolve(a)},t=>{e.reject(`Request failed with status: ${t.status}`)}),e)}_isWebMVideo(){let e=new ro;return this._getMP4Url().then2(t=>{new Mr(t).head().then(n=>{e.resolve(n.contentType=="video/webm")},n=>{e.resolve(!1)})},t=>{e.resolve(!1)}),e}_beginLoadingMP4(){this._loadTimeTracker.start(),this._fileTypeLoading="mp4",this._getMP4Url().then2(e=>{this._player.src({type:"video/mp4",src:e}),this._player.one("error",t=>{this._loadTimeTracker.end(),this._isInErrorState=!0;try{this.reportLoadFailureAnalytics(`Failed to access mp4. Status: ${t.status} Message: ${t.message}`)}catch{this.reportLoadFailureAnalytics("Failed to access mp4.")}})},e=>{this._loadTimeTracker.end(),this.reportLoadFailureAnalytics(`Failed to acquire mp4 url. ${e}`),this._isInErrorState=!0})}startLoadIfNeeded(){if(this._player!=null)return;let e=document.createElement("video");if(e.crossOrigin="anonymous",e.style.display="none",document.body.appendChild(e),this._player=io.instance().getPlayer(e),this._player==null){this._isInErrorState=!0,this.reportLoadFailureAnalytics("Failed to create VideoJS player");return}this._player.muted(!0),this._player.playsinline(!0),this._player.autoplay(!1),this._player.loop(!1),this._player.ready(()=>{this._player.on("ended",t=>{this._loop?this._playLoop():this.resetToDefaultState()}),this._player.on("seeking",t=>{this._seeking=!0}),this._player.on("seeked",t=>{this._seeking=!1}),this._player.on("loadedmetadata",t=>{this._handleOnLoadedMetadata()}),Y.getFeatureFlags().video_on_ios_staging&&this._player.on("loadeddata",t=>{this.shouldDisplayThumbnail=!1})}),Y.getFeatureFlags().prototype_transparent_webm_video?this._isWebMVideo().then2(t=>{t?this._beginLoadingMP4():this._beginLoadingHLS(this._sourceURL)},t=>{this._beginLoadingHLS(this._sourceURL)}):this._beginLoadingHLS(this._sourceURL)}on(e,t){let n=r=>{t(this._player)};return this._player!=null&&this._player.on(e,n),n}off(e,t){this._player!=null&&this._player.off(e,t)}getOrCreateTexture(e,t){if(this._texture==null&&this._loadComplete){let n=cu.VideoJsPlayer_getBackingVideo(this._player);this._texture=e.createTexture3(t,n,"Video")}return!this.isReadyToPlay()||this.isInErrorState()?null:this._texture}resetToDefaultState(){this.overriddenPlayingState=null,this.overriddenMutedState=null}_getCurrentLocation(){return window.location.href.indexOf("/community/")!=-1?"community_viewer":"viewer"}reportLoadFailureAnalytics(e){this._loadTimeTracker.end();let t=this._loadTimeTracker.getLoadTime();t<0||(console.warn("Video failed to load:",e),Pe.trackDefinedEvent("prototype.video_load",{status:"failure",hash:this._hash,load_time:t,file_type:this._fileTypeLoading,reason:e,location:this._getCurrentLocation()}))}reportLoadSuccessAnalytics(){this._loadTimeTracker.end();let e=this._loadTimeTracker.getLoadTime();e<0||Pe.trackDefinedEvent("prototype.video_load",{status:"success",hash:this._hash,load_time:e,file_type:this._fileTypeLoading,width:this._player.videoWidth(),height:this._player.videoHeight(),location:this._getCurrentLocation()})}reportPlaySuccessAnalytics(){Y.getFeatureFlags().prototype_log_video_play&&Pe.trackEvent("video_play",{status:"success",hash:this._hash,location:this._getCurrentLocation()})}reportPlayFailureAnalytics(e){Y.getFeatureFlags().prototype_log_video_play&&Pe.trackEvent("video_play",{status:"failure",hash:this._hash,reason:e,location:this._getCurrentLocation()})}constructor(e,t,n,r){this.id=(vl.nextID=vl.nextID+1)+-1,this._hash=e,this._sourceURL=t,this._metaMP4Url=n,this._videoManager=r,this._loadTimeTracker=new $g,this._loadComplete=!1,this._texture=null,this._player=null,this._isInErrorState=!1,this._fileTypeLoading="hls",this._loop=!1,this._seeking=!1,this._prevReadyState=Tl.HAVE_NOTHING,this.overriddenPlayingState=null,this.overriddenMutedState=null,this.shouldDisplayThumbnail=!0,this._MP4VideoUrl=null}};vl.nextID=0;var od=vl,Tl;(o=>(o.HAVE_NOTHING=0,o.HAVE_METADATA=1,o.HAVE_CURRENT_DATA=2,o.HAVE_FUTURE_DATA=3,o.HAVE_ENOUGH_DATA=4))(Tl||(Tl={}));var $g=class{start(){this._endConditionSeconds=-1,this._startConditionSeconds=ke.seconds()}end(){this._endConditionSeconds=ke.seconds()}getLoadTime(){return this._endConditionSeconds<0||this._startConditionSeconds<0?-1:this._endConditionSeconds-this._startConditionSeconds}constructor(){this._startConditionSeconds=-1,this._endConditionSeconds=-1}},id=class extends Na{uninitialize1(){this.uninitialize2(e=>{e.uninitialize()})}toString1(){return this.toString2(e=>e.toString())}constructor(){super()}};var Ep=class{constructor(e){this._visiblePaints=new Set([]),this._appState=null,this._lastStateChange=null,this._appState=e}isPaintVisible(e){return this._visiblePaints.has(e)}forEachVisiblePaint(e){for(let t=0,n=Array.from(this._visiblePaints.values()).length;t<n;t=t+1)e(Array.from(this._visiblePaints.values())[t])}refreshVisibleVideosIfNeeded(){this.handlePrototypeStateChange(this._lastStateChange)}handlePrototypeStateChange(e){var a;if(e==null)return;this._visiblePaints=new Set;let t=e.newStateId(),n=(a=this._appState.scene())==null?void 0:a.findNode1(t);if(n==null)return;this._lastStateChange=e,this._gatherVisibleVideoResources(n);let r=e.newOverlayData();for(let s=0,l=r.length;s<l;s=s+1){let d=this._appState.scene().findNode1(r[s].id);this._gatherVisibleVideoResources(d)}let o="";this.forEachVisiblePaint(s=>{o+=" "+s.id().toString()+","}),ii.VERBOSE_LOGS&&console.log("Found these visible paints:",o)}_gatherVisibleVideoResources(e){if(!e.visible())return;for(let n=0,r=e.childCount();n<r;n=n+1)this._gatherVisibleVideoResources(e.childAt1(n));let t=null;if(e.getCachedRenderTree()!=null)t=e.getCachedRenderTree();else if(e.getCachedRenderTreeForBaseScreen()!=null)t=e.getCachedRenderTreeForBaseScreen();else return;this._gatherVideosFromRenderNode(t.value)}_gatherVideosFromRenderNode(e){if(e!=null)switch(e.op()){case 3:{this._gatherVideosFromFillNode(e);break}case 4:{this._gatherVideosFromFillStrokeNode(e);break}case 5:{this._gatherVideosFromMaskNode(e);break}case 1:{this._gatherVideosFromGroupNode(e);break}case 6:{let t=e;this._gatherVideosFromRenderNode(t.child);break}case 2:{let t=e;this._gatherVideosFromRenderNode(t.child);break}case 9:{let t=e;this._gatherVideosFromRenderNode(t.alpha);break}case 7:{let t=e;this._gatherVideosFromRenderNode(t.child);break}case 8:{let t=e;this._gatherVideosFromRenderNode(t.tree);break}case 10:{let t=e;this._gatherVideosFromRenderNode(t.child);break}case 11:{let t=e;this._gatherVideosFromRenderNode(t.child);break}case 12:{let t=e;this._gatherVideosFromRenderNode(t.startChild),this._gatherVideosFromRenderNode(t.endChild);break}case 0:{let t=e;this._gatherVideosFromRenderNode(t.child);break}}}_gatherVideosFromFillNode(e){let t=e.geometry.paints;Ne.forEachPaintWithVideo(t,n=>{this._visiblePaints.add(n)})}_gatherVideosFromFillStrokeNode(e){let t=e.fillGeometries;for(let n=0,r=t.length;n<r;n=n+1){let o=t[n].paints;Ne.forEachPaintWithVideo(o,a=>{this._visiblePaints.add(a)})}for(let n=0,r=e.strokeGeometries.length;n<r;n=n+1){let o=e.strokeGeometries[n].paints;Ne.forEachPaintWithVideo(o,a=>{this._visiblePaints.add(a)})}}_gatherVideosFromMaskNode(e){this._gatherVideosFromRenderNode(e.color)}_gatherVideosFromGroupNode(e){for(let t=0,n=e.children.length;t<n;t=t+1)this._gatherVideosFromRenderNode(e.children[t])}getLastTopLevelStateChange(){return this._lastStateChange}};var El=class i{constructor(e,t,n,r){this.status=i.Status.PENDING,this.interactionType=e,this.interactionID=t,this.hotspotNodeID=n,this.listener=r,this.internalEventListeners=[]}};(t=>{let i;(a=>(a[a.PENDING=0]="PENDING",a[a.ACTIVE=1]="ACTIVE",a[a.SUPERCEDED=2]="SUPERCEDED"))(i=t.Status||(t.Status={}));let e;(r=>{function n(o){return t.Status[o]}r.Status_toString=n})(e=t.in_Status||(t.in_Status={}))})(El||(El={}));var Il=class{constructor(e,t){this.nodePath=e,this.videoPlayback=t}},ad=class{constructor(e,t){this.eventName=e,this.listener=t}},xi=class xi{runtimeStorage(){return this._runtimeStorage}associatePaintWithNode(e,t){this._needToRecalculateVisibleVideos=!0;let n=t.uniqueIdentifier();this._paintToNodeGUIDMap.set(e,n),this._guidToVideoMetadata.set(n,new Il(Cn.getSemanticNodePath(t),t.videoPlayback())),this._paintsForPlaybackSettingsRefresh.add(e)}constructor(e){this._appState=null,this._guidToVideoMetadata=new Map,this._hashToRuntimeMap=new Map,this._paintToNodeGUIDMap=new Map,this._runtimeStorage=new id,this._deferredRuntimes=new Set,this._deferredInteractionEvents=new Set,this._visibilityTracker=null,this._needToRecalculateVisibleVideos=!1,this._framePotentiallyReadyToPlay=!0,this._paintsForPlaybackSettingsRefresh=new Set,this._lastTransitionShouldForceStateRefresh=!1,this._userHasInteractedWithPage=!1,this._appState=e,this._visibilityTracker=new Ep(e),this._appState.addFrameObserver(this),this._appState.prototypeState().addObserver(this),this._appState.prototypeState().addHsmObserver(this),this._appState.addActionObserver(this),this._appState.addAppObserver(this)}getNodeMetadata(e){return this._guidToVideoMetadata.has(e)?this._guidToVideoMetadata.get(e):new Il([],null)}getVideoRuntimeForPaint(e){if(!this._paintToNodeGUIDMap.has(e))return null;let t=this._paintToNodeGUIDMap.get(e),n=this.getNodeMetadata(t).nodePath,r=e.video().hash();return this._runtimeStorage.getData(n,r)}getPlaybackSettingsForPaint(e){if(!this._paintToNodeGUIDMap.has(e))return null;let t=this._paintToNodeGUIDMap.get(e),n=this.getNodeMetadata(t).videoPlayback;return n==null&&(n={autoplay:!0,mediaLoop:!0,muted:!1}),n}_populateRuntimesForVisibleVideos(){this._visibilityTracker.forEachVisiblePaint(e=>{if(!this._paintToNodeGUIDMap.has(e))return;let t=this._paintToNodeGUIDMap.get(e),n=this.getNodeMetadata(t).nodePath;if(this.getVideoRuntimeForPaint(e)!=null)return;let r=e.video().hash(),o=this._hashToRuntimeMap.get(r).clone();this._runtimeStorage.insert(n,r,o)})}getVideoRuntimesForNode(e){let t=this.getNodeMetadata(e).nodePath;return this._runtimeStorage.getAllDataForNode(t)}updateVideoRuntime(e,t){let n=ee.isValid(e.transitionNodeID())?e.transitionNodeID():t;if(!this._guidToVideoMetadata.has(n))return;let r,o,a=[],s=this.getVideoRuntimesForNode(n);s!=null&&(s.forEach((l,d)=>{if(l!=null){switch(e.mediaAction()){case"PLAY":{l.playByVideoAction();break}case"PAUSE":{l.pauseByVideoAction();break}case"TOGGLE_PLAY_PAUSE":{l.isPlaying()?l.pauseByVideoAction():l.playByVideoAction();break}case"MUTE":{l.setMutedByVideoAction(!0);break}case"UNMUTE":{l.setMutedByVideoAction(!1);break}case"TOGGLE_MUTE_UNMUTE":{l.setMutedByVideoAction(!l.muted());break}case"SKIP_FORWARD":{let c=e.mediaSkipByAmount(),p=Math.min(l.currentTime1()+c,l.duration()-.01);l.currentTime2(p);break}case"SKIP_BACKWARD":{let c=e.mediaSkipByAmount(),p=Math.max(0,l.currentTime1()-c);l.currentTime2(p);break}case"SKIP_TO":{let c=e.mediaSkipToTime(),p=Math.max(0,c);p=Math.min(p,l.duration()-.01),l.currentTime2(p);break}}r=l.isPlaying(),o=!l.muted(),a.push(l.currentTime1()*1e3)}}),r!=null&&o!=null&&a.length>0&&this._createVideoStateChangeInPrototypeState(n,r,o,a))}_createVideoStateChangeInPrototypeState(e,t,n,r){this._appState.prototypeState().createVideoStateChange(e,t,n,r,this._currentTruncatedTimeInMilliseconds())}resetVideoStateChanges(e){e.forEach(t=>{let n=ee.fromFigGUID(t.targetNodeId);if(!this._guidToVideoMetadata.has(n))return;let r=this.getVideoRuntimesForNode(n);if(r==null)return;let o=[];r.forEach((a,s)=>{o.push(a.currentTime1())}),this._createDefaultVideoStateChangeInPrototypeState(n,o)})}_createDefaultVideoStateChangeInPrototypeState(e,t){var r;let n=(r=this.getNodeMetadata(e))==null?void 0:r.videoPlayback;this._appState.prototypeState().createVideoStateChange(e,n==null?void 0:n.autoplay,n==null?void 0:n.muted,t,this._currentTruncatedTimeInMilliseconds())}multiplayerUpdateVideoRuntimes(e,t){let n=ee.fromFigGUID(t.targetNodeId);if(!this._guidToVideoMetadata.has(n))return;let r=this.getVideoRuntimesForNode(n);if(r==null)return;let o=0;r.forEach((a,s)=>{if(a!=null){if(t.isPlaying!=a.isPlaying()&&(a.isPlaying()?a.pauseByVideoAction():a.playByVideoAction()),t.isPlayingSound!=!a.muted()&&a.setMutedByVideoAction(!t.isPlayingSound),!a.isPlaying()||t.currentTimes[o]!=e[o]){let l=this._currentTruncatedTimeInMilliseconds()-t.actionTakenTimestamp,c=(a.isPlaying()?t.currentTimes[o]+l:t.currentTimes[o])%(a.duration()*1e3);a.currentTime2(c/1e3)}o+=1}})}_currentTruncatedTimeInMilliseconds(){return Date.now()%1e6}_registerDeferredInteractionEvent(e){if(e.status==1)return;let t=this.getVideoRuntimesForNode(e.hotspotNodeID);if(t!=null){for(let n of Array.from(t.keys())){let r=t.get(n);if(e.interactionType=="ON_MEDIA_END"){let o=r.on("ended",a=>{e.listener(a)});e.internalEventListeners.push(new ad("ended",o))}else if(e.interactionType=="ON_MEDIA_HIT"){let o=r.on("timeupdate",a=>{e.listener(a)});e.internalEventListeners.push(new ad("timeupdate",o)),o=r.on("play",a=>{e.listener(a)}),e.internalEventListeners.push(new ad("play",o))}}e.status=1}}_deregisterDeferredInteractionEvent(e){if(e.status!=2)return;let t=this.getVideoRuntimesForNode(e.hotspotNodeID);if(t!=null)for(let n of Array.from(t.keys())){let r=t.get(n);for(let o of e.internalEventListeners)r.off(o.eventName,o.listener)}}_getListenerForInteractionEvent(e,t,n){let r=null;if(e=="ON_MEDIA_END")r=o=>{n()};else if(e=="ON_MEDIA_HIT"){let o=!1;r=a=>{let s=a.currentTime(),l=a.liveTracker?a.liveTracker.seekableEnd():a.duration();t>l&&(t=l);let d=.3;if(s>=t-d&&s<t){let c=Math.ceil((t-s)*1e3)|0;setTimeout(()=>{let p=a.currentTime(),u=a.paused()&&p<t,h=p>=t&&p<t+d;!o&&!u&&h&&(o=!0,n())},c)}else o=!1}}else console.error("videoManager.addInteractionEvent() should only be called with video trigger events");return r}addInteractionEvent(e,t,n,r){let o=e.event().interactionType(),a=this._getListenerForInteractionEvent(o,n,r),s=new El(o,e.id(),t,a);for(let l of Array.from(this._deferredInteractionEvents.values()))l.interactionID==s.interactionID&&(l.status=2,io.instance().isLibAvailable()&&(this._deregisterDeferredInteractionEvent(l),this._deferredInteractionEvents.delete(l)));io.instance().isLibAvailable()&&this._registerDeferredInteractionEvent(s),this._deferredInteractionEvents.add(s)}onFrame(){if(xi.VERBOSE_LOGS&&console.log(this.debugString()),this._visibilityTracker!=null){if(this._needToRecalculateVisibleVideos&&(this._visibilityTracker.refreshVisibleVideosIfNeeded(),this._populateRuntimesForVisibleVideos(),this._framePotentiallyReadyToPlay=!0,this._needToRecalculateVisibleVideos=!1,xi.VERBOSE_LOGS&&console.log(this.debugString())),this._framePotentiallyReadyToPlay&&this._allVisibleVideosAreLoaded()){this._framePotentiallyReadyToPlay=!1,this._applyPlaybackSettingsToVisibleVideos();for(let e of Array.from(this._deferredInteractionEvents.values()))e.status==0?this._registerDeferredInteractionEvent(e):e.status==2&&(this._deregisterDeferredInteractionEvent(e),this._deferredInteractionEvents.delete(e));xi.VERBOSE_LOGS&&console.log(this.debugString())}this._invalidateTexturesOfPlayingVideos()}}resetAllRuntimesWithinNode(e){let t=new jt(this._appState.scene().findNode1(e)),n=Cn.getSemanticNodePath(t),r=this._runtimeStorage.getSubTrie(n),o=[];r!=null&&r.forEach(a=>{a.resetToStartTime(),o.push(a.currentTime1())}),this._createDefaultVideoStateChangeInPrototypeState(e,o)}resetAllRuntimesWithinTLFNode(e){let t=this._appState.scene().findNode1(e);for(let o=0,a=t.childCount();o<a;o=o+1){let s=t.childAt1(o);this.resetAllRuntimesWithinNode(s.id())}let n=this._runtimeStorage.getSubTrie([new As(t.name(),0)]),r=[];n!=null&&n.forEach(o=>{o.resetToStartTime(),r.push(o.currentTime1())}),this._createDefaultVideoStateChangeInPrototypeState(e,r)}handleHsmAborted(e,t){}handleHsmCommitted(e,t,n){if(this._lastTransitionShouldForceStateRefresh=t.transitionParameters.transitionResetVideoPosition,t.transitionParameters.transitionResetVideoPosition){let r=this._appState.scene().findNode3(e);r&&this.resetAllRuntimesWithinNode(r.id())}this.reactToStateChange(this._visibilityTracker.getLastTopLevelStateChange(),t.getInsertedFrameIds())}handleHsmInitiated(e,t){}handleHsmRequested(e,t){}handleStateChangeCommitted(e,t){if(this._lastTransitionShouldForceStateRefresh=e.transitionParameters.transitionResetVideoPosition,e.transitionParameters.transitionResetVideoPosition){this.resetAllRuntimesWithinTLFNode(e.newStateId());let n=e.newOverlayData();for(let r=0,o=n.length;r<o;r=r+1)this.resetAllRuntimesWithinNode(n[r].id)}this.reactToStateChange(e,e.getInsertedFrameIds())}handleStateChangeAborted(e){}handleStateChangeInitiated(e){}handleStateChangeRequested(e){}handleFitModeChange(e,t){}handleRestartPrototype(){this._deleteVisibleRuntimes(),this._framePotentiallyReadyToPlay=!0}reactToStateChange(e,t){this._recalculateVisibleVideoPaints(e);let n=new Set;this._visibilityTracker.forEachVisiblePaint(r=>{if(!this._paintToNodeGUIDMap.has(r))return;let o=r.video().hash(),a=this._paintToNodeGUIDMap.get(r),s=this.getNodeMetadata(a).nodePath,l=this.getVideoRuntimeForPaint(r);l!=null&&n.add(l.id);let d=this._appState.scene().findNode2(a);for(let c of t){let p=this._appState.scene().findNode1(c);p!=null&&p.isAncestorOf(d)&&this._paintsForPlaybackSettingsRefresh.add(r)}if(l==null){let c=this._hashToRuntimeMap.get(o).clone();this._runtimeStorage.insert(s,o,c)}}),this._runtimeStorage.forEach(r=>{!n.has(r.id)&&r.isPlaying()&&r.pause()}),this._framePotentiallyReadyToPlay=!0}handleAction(e,t){this._userHasInteractedWithPage||(e==5||e==6||e==8||e==9||e==10)&&(this._userHasInteractedWithPage=!0,this._visibilityTracker.forEachVisiblePaint(n=>{let r=this.getVideoRuntimeForPaint(n),o=this.getPlaybackSettingsForPaint(n);r!=null&&o!=null&&!o.muted&&r.setMuted(o.muted)}),this._appState.removeActionObserver(this))}_applyPlaybackSettingsToVisibleVideos(){this._visibilityTracker.forEachVisiblePaint(e=>{if(!this._paintsForPlaybackSettingsRefresh.has(e))return;this._paintsForPlaybackSettingsRefresh.delete(e);let t=this.getVideoRuntimeForPaint(e),n=this.getPlaybackSettingsForPaint(e);if(t!=null&&n!=null){t.setLoop(n.mediaLoop),this._lastTransitionShouldForceStateRefresh&&t.resetToDefaultState();let o=t.overriddenMutedState==null?n.muted:t.overriddenMutedState.value;t.setMuted(o),(t.overriddenPlayingState==null?n.autoplay:t.overriddenPlayingState.value)?t.play():t.pause()}})}_invalidateTexturesOfPlayingVideos(){this._visibilityTracker.forEachVisiblePaint(e=>{let t=this.getVideoRuntimeForPaint(e);t!=null&&t.isPlaying()&&t.invalidateTexture()})}_recalculateVisibleVideoPaints(e){xi.VERBOSE_LOGS&&console.log("Recalculating visible paints"),this._visibilityTracker.handlePrototypeStateChange(e),this._visibilityTracker.forEachVisiblePaint(t=>{let n=this.getVideoRuntimeForPaint(t);n!=null&&n.startLoadIfNeeded()}),this._framePotentiallyReadyToPlay=!0}_deleteVisibleRuntimes(){xi.VERBOSE_LOGS&&console.log("Deleting existing runtimes"),this._runtimeStorage.uninitialize1()}buildVideoResource(e){io.instance().hasRequestedLibrary()||(io.instance().onSuccess=()=>{for(let n of Array.from(this._deferredRuntimes.values()))n.startLoadIfNeeded()},io.instance().requestLibrary());let t=new Ip(e,this);if(!this._hashToRuntimeMap.has(t.hash())){let n=Rt.getVideoPrefixUrl(),r=n!=null&&n.endsWith("/")?n:n+"/",o=`${r}${t.hash()}/manifest`,a=`${r}${t.hash()}`,s=new od(t.hash(),o,a,this);this._hashToRuntimeMap.set(t.hash(),s)}return t}_allVisibleVideosAreLoaded(){let e=!0;return this._visibilityTracker.forEachVisiblePaint(t=>{let n=this.getVideoRuntimeForPaint(t);n!=null&&!n.isReadyToPlay()&&!n.isInErrorState()&&(e=!1)}),e}onVideoLoaded(e){this._appState.imageManager()==null||this._appState.imageManager().onImageLoaded==null||(this._allVisibleVideosAreLoaded()?(xi.VERBOSE_LOGS&&console.log("VideoManager - - : All videos in frame are loaded!"),this._appState.baseScreenNode()!=null&&this._appState.imageManager().onImageLoaded(this._appState.baseScreenNode())):xi.VERBOSE_LOGS&&console.log("VideoManager - - : Not all videos in frame are loaded"))}handleSceneChange(e,t){e!=null&&e.removeObserver(this),t!=null&&t.addObserver(this)}handleActiveCanvasChange(e,t){}handleActivePrototypeStartingPointChange(e,t){}handleSceneGraphEvent(e){e.property==72&&(this._guidToVideoMetadata.set(e.node.id(),new Il(Cn.getSemanticNodePath(new jt(e.node)),e.newVal)),this._paintToNodeGUIDMap.forEach((t,n)=>{t==e.node.id()&&this._paintsForPlaybackSettingsRefresh.add(n)}),this._framePotentiallyReadyToPlay=!0)}debugString(){let e=`VideoManager 
`;return e+="Need to recalculate visible videos: "+this._needToRecalculateVisibleVideos.toString()+`
`,e+="Frame may be ready to start playing videos: "+this._framePotentiallyReadyToPlay.toString()+`
`,e+=`	Loading Runtimes:
`,this._hashToRuntimeMap.forEach((t,n)=>{e+="		hash: "+n+" -> "+t.toString()+`
`}),e+=`	VisiblePaints:
`,this._visibilityTracker.forEachVisiblePaint(t=>{let n=this.getPlaybackSettingsForPaint(t);n!=null?e+="		"+t.debugString()+" muted="+n.muted.toString()+" loop="+n.mediaLoop.toString()+" autoplay="+n.autoplay.toString()+" hash: "+t.video().hash()+`
`:e+="		"+t.debugString()+` (no playback settings found) 
`}),e+=`	Paint -> GUID:
`,this._paintToNodeGUIDMap.forEach((t,n)=>{e+="		P="+n.id().toString()+" => "+t+`
`}),e}enqueueVideoOrStartLoad(e){io.instance().isLibAvailable()?e.startLoadIfNeeded():this._deferredRuntimes.add(e)}muteAllOtherVideos(e){this._runtimeStorage.forEach(t=>{t.id!=e.id&&t.setMuted(!0)})}};xi.VERBOSE_LOGS=!1;var ii=xi;var vn=class{emitter(){return this._emitter}scene(){return this._scene}prototypeState(){return this._prototypeState}prototypeStructure(){return this._prototypeStructure}imageManager(){return this._imageManager}videoManager(){return this._videoManager}requestedFrameMetricsTracker(){return this._requestedFrameMetricsTracker}serialization(){return this._serialization}currentFileKey(){return this._currentFileKey}setCurrentFileKey(e){this._currentFileKey=e}fontListPromise(){return this._fontListPromise}setFontListPromise(e){this._fontListPromise=e}renderDots(){return this._renderDots}setRenderDots(e){this._renderDots=e}baseScreenId(){return this._prototypeState.getCurrentBaseScreenId()}currentFitMode(){return this._prototypeState.getCurrentFitMode()}baseScreenNode(){return this._scene==null?null:this._prototypeState.getCurrentBaseScreenNode()}constructor(){this._appObservers=new Xn,this._actionObservers=new Xn,this._frameObservers=new Xn,this._scene=null,this._canvas=null,this._prototypeState=null,this._prototypeStructure=null,this._imageManager=null,this._videoManager=null,this._requestedFrameMetricsTracker=new vp,this._serialization=null,this._currentFileKey="",this._activePrototypeStartingPointNodeId=null,this._renderDots=!1,this._fontListPromise=Promise.resolve(or.VOID),this._emitter=null,this._pendingSetActiveCanvas=null,this._emitter=qt.getEventEmitter(),this._prototypeState=new Po(this),this._prototypeStructure=new Bt(this),this._imageManager=new Tp(this,()=>{this._emitter.trigger("showImageFetchFailureUI",{})}),this._videoManager=new ii(this),this._serialization=new mt(this._imageManager,this._videoManager),Lr&&D()==null&&Lo.initialize(hi,this)}addAppObserver(e){this._appObservers.add(e)}removeAppObserver(e){this._appObservers.remove(e)}addActionObserver(e){this._actionObservers.add(e)}removeActionObserver(e){this._actionObservers.remove(e)}addFrameObserver(e){this._frameObservers.add(e)}removeFrameObserver(e){this._frameObservers.remove(e)}nodeTransitionTracker(){return this._prototypeStructure.nodeTransitionTracker()}triggerAction1(e){this.triggerAction2(e,null)}triggerAction2(e,t){this._actionObservers.forEach(n=>{n.handleAction(e,t)})}onFrame(){this._frameObservers.forEach(e=>{e.onFrame()})}resetStateForTests(){this._prototypeState.resetState()}setScene(e){var t;if(e!=this._scene){let n=this._scene;this._scene=e,(t=this._scene)==null||t.markLoaded(),this._appObservers.forEach(r=>{r.handleSceneChange(n,e)}),n!=null&&n.destroy(),this._scene==null?this.setActiveCanvas(null):this.setActiveCanvas(this._scene.firstUserCanvasOrNull())}}requestSetActiveCanvas(e){e.hasBeenLoaded()?this.setActiveCanvas(e):(this._pendingSetActiveCanvas=e,this.triggerAction2(11,e))}trySettingRequestedActiveCanvas(){this._pendingSetActiveCanvas!=null&&this._pendingSetActiveCanvas.hasBeenLoaded()&&(this.setActiveCanvas(this._pendingSetActiveCanvas),this._pendingSetActiveCanvas=null)}setActiveCanvas(e){if(this._canvas!=e){let t=this._canvas;this._canvas=e,this._appObservers.forEach(n=>{n.handleActiveCanvasChange(t,this._canvas)})}}getActiveCanvas(){return this._canvas!=null&&this._scene==null?(console.warn("getActiveCanvas called with null scene but non-null canvas"),null):this._canvas}activePrototypeDevice(){var e;return(e=this.getActiveCanvas())==null?void 0:e.prototypeDevice()}storedPrototypeDevice(){var e;return(e=this.getActiveCanvas())==null?void 0:e.storedPrototypeDevice()}activePrototypeStartingPointNodeId(){return this._activePrototypeStartingPointNodeId}setActivePrototypeStartingPointNodeId(e){let t=this._activePrototypeStartingPointNodeId;this._activePrototypeStartingPointNodeId=e,this._appObservers.forEach(n=>{n.handleActivePrototypeStartingPointChange(t,e)})}};var Cp=class{constructor(e,t,n,r){this.node=e,this.property=t,this.oldVal=n,this.newVal=r}},ai=class ai{constructor(e,t){this._listeners=new Set;this._revisionNumber=0;this._handle=0,this._observers=new Xn,this._nodes=new Map,this._cachedRoot=null,this._interactiveComponentsEnabled=!1,this._isBetweenJoinStartAndJoinEnd=!1,this._loadedTlfs=[],this._deferUnregisteringNodes=!1,this._deferredUnregisters=null,this._interactiveComponentsEnabled=t==0,this._handle=e}handle(){return this._handle}interactiveComponentsEnabled(){return this._interactiveComponentsEnabled}setInteractiveComponentsEnabledForTesting(e){this._interactiveComponentsEnabled=e}firstUserCanvasOrNull(){for(let e=0,t=this.root().childCount();e<t;e=e+1){let n=this.root().childAt1(e);if(n.type()=="CANVAS"&&!n.isInternalOnly())return n}return null}addObserver(e){this._observers.add(e)}removeObserver(e){this._observers.remove(e)}broadcastPropertyChange(e){ai.VERBOSE&&console.log(`broadcasting change for property '${Ct[e.property]}' on node '${e.node.id()}'`),this._observers.forEach(t=>{t.handleSceneGraphEvent(e)}),this._revisionNumber+=1;for(let t of this._listeners)t()}onChange(e){return this._listeners.add(e),()=>{var t;return(t=this._listeners)==null?void 0:t.delete(e)}}getRevisionNumber(){return this._revisionNumber}isLoadedTlfsEmpty(){return this._loadedTlfs.length==0}setAllTlfsLoaded(){this.setTlfsLoaded(e=>!0)}setTlfsLoaded(e){this._loadedTlfs=[],ye.forEachNode(this.root(),t=>t.type()=="DOCUMENT"||t.type()=="CANVAS"||t.type()=="SECTION"?ye.Loop.CONTINUE:t.isTopLevel()?(t.setHasBeenLoaded(e(t)),t.hasBeenLoaded()&&this._loadedTlfs.push(t),ye.Loop.CONTINUE):ye.Loop.SKIP)}hierarchyDebugString(){let e="",t=(n,r)=>{let o=n.symbolID(),a=o!=null?` -> ${o}`:"";e+=`${r}${n.id()} ${n.name()}${a}
`,r+="  ";for(let s=0,l=n.childCount();s<l;s=s+1)t(n.childAt1(s),r)};return t(this.root(),""),e}dangerouslyRegisterNode(e){if(e.scene()!=this)throw new Error("Scene mismatch when registering node");let t=this.findNode2(e.id());if(t!=null&&t!=e)throw new Error("Unexpected existing node when registering node");this._nodes.set(e.id(),e)}dangerouslyUnregisterNode(e){if(this._deferUnregisteringNodes){this._deferredUnregisters.push(e);return}this._nodes.delete(e),ee.isRoot(e)&&(this._cachedRoot=null)}dangerouslyDeferNodeRemovalScope(e){this._deferredUnregisters=[],this._deferUnregisteringNodes=!0,e(),this._deferUnregisteringNodes=!1;for(let t of this._deferredUnregisters)this.dangerouslyUnregisterNode(t);this._deferredUnregisters=null}markLoaded(){var e;(e=D())==null||e.markSceneLoaded(this)}destroy(){var e;(e=D())==null||e.destroyScene(this)}setFileKey(e){var t;(t=D())==null||t.modules().prototype.setSceneMetadata(e)}applyMessageToScene(e){var r;let t=ke.milliseconds();(r=D())==null||r.applyNodeChanges(e);let n=ke.milliseconds()-t;n>100&&console.warn(`applyMessageToScene took ${n/1e3} seconds`)}totalNodeCount(){return this._nodes.size}each(e){Be.StringMap_each(this._nodes,(t,n)=>{e(n)})}findNode1(e){return this.findNode2(e)}findNode2(e){return e==null?null:Be.StringMap_get(this._nodes,e,null)}findNode3(e){if(e==null||e.guids==null)return null;let t=D().findNode(this,e);return this.findNode1(t)}findStyle(e){let t=D().sceneGraphTsApi().styleByIdOrNull(e);return this.findNode1(t)}createNode1(e){return this.createNode2(e,new Mt([e]))}createNode2(e,t){if(!Lo.isTestingEnv())throw new Error("Should not be creating nodes in Skew while running fullview");let n={};return n.guid=mt.encodeGUID(e),n.phase="CREATED",ef(n),this.findNode1(e)}removeNode(e){if(!Lo.isTestingEnv())throw new Error("Should not be removing nodes in Skew while running fullview");let t={};t.guid=mt.encodeGUID(e),t.phase="REMOVED",ef(t);let n=this.findNode1(e)}root(){return this._cachedRoot==null&&(this._cachedRoot=this.findNode1(ee._new(0,0)),this._cachedRoot.updateIsRooted()),this._cachedRoot}regenerateDirtySymbolInstances(e){D().updateSymbolInstancesForTests()}updateDirtyStyleConsumers(){D().updateStylesForTests()}findNodeFromDeveloperFriendlyId(e){if(e.charCodeAt(0)==84){let t=e.slice(1).split(";");if(t.length!=3)return console.error("Table cell developer friendly id does not have 3 guids"),null;let n=ee.fromString(t[0]),r=this.findNode1(n);if(r==null)return console.error("Cannot find table from table cell developer friendly id"),null;let o=ee.fromString(t[1]),a=ee.fromString(t[2]);return r.getTableCellAt(o,a)}else if(e.charCodeAt(0)==73){let t=e.slice(1).split(";"),n=ee.fromString(t[0]),r=this.findNode1(n),o=null;o=(s,l)=>{if(s==null)return null;if(l(s))return s;for(let d=0,c=s.childCount();d<c;d=d+1){let p=o(s.childAt1(d),l);if(p!=null)return p}return null};let a=new Mt(t.map(s=>ee.fromString(s)));return o(r,s=>Mt.equals(s.stablePath(),a))}else return this.findNode2(e)}static createCanvasInScene(e,t){let n=e.createNode1(t);return n.setType("CANVAS"),n.setVisible(!0),n.setOpacity(1),n.setName("canvas"),n.setCurrentViewportSize(new I(1e6,1e6)),e.root().appendChild(n),n}static createLoadedFrameWithCanvasContent(e,t){let n=new _t,r=[];ye.forEachNode(t,l=>l.isTopLevel()?(n.include3(l.fullSizeCanvasSpaceBoundingBox()),r.push(l),ye.Loop.SKIP):ye.Loop.CONTINUE);let o=n.build();o.expand1(150);let a=t.fillPaintsToRender()[0].asSinglePaint();a.opacity()==0&&(a=ie.createSolid(E.WHITE,1));let s=Ao(t,"frame",a);We(s,o.topLeft(),o.size()),s.setTestOnlyFillGeometry(Jo(s.fullSizeCanvasSpaceBoundingBox()));for(let l of r){let d=l.relativeTransform().clone();d.translate1(s.relativeTransform().translation().negative()),l.setParentIndex(new Gn(ee.invalid(),sn.fromString(""))),s.appendChild(l),l.setRelativeTransform(d)}return e.setTlfsLoaded(l=>l==s?!0:l.hasBeenLoaded()),s}static createScene(e,t){return D().createSceneAndSetActive(e,t)}static createSceneWithCanvasForTests1(){return ai.createSceneWithCanvasForTests2(Y.ViewerMode.PROTOTYPE,1)}static createSceneWithCanvasForTests2(e,t){var r;new vn,Y.setViewerMode(e);let n=ai.createScene(ai.MAGIC_SESSION_ID_FOR_NON_MULTIPLAYER,t);return(r=D())==null||r.modules().prototype.setSceneMetadata("1"),ai.createCanvasInScene(n,ee._new(0,1)),n.markLoaded(),n}};ai.MAX_GUID_VALUE=2147483647,ai.MAGIC_SESSION_ID_FOR_NON_MULTIPLAYER=ai.MAX_GUID_VALUE-1,ai.VERBOSE=!1;var gt=ai;var Da=class i{constructor(e,t,n){this._hyperlinkBoxes=e,this._usedEmojiCodepoints=t,this._usedEmojiImages=n}hyperlinkBoxes(){return this._hyperlinkBoxes}usedEmojiCodepoints(){return this._usedEmojiCodepoints}usedEmojiImages(){return this._usedEmojiImages}static forTests(e){return new i([],e,[])}};var Pi=class i{constructor(e,t,n,r,o,a,s,l){this._styleOverrideTable=e,this._fontSizes=t,this._hyperlinkBoxesDEPRECATED=n,this._characters=r,this._lines=o,this._characterStyleIds=a,this._usedEmojiCodepointsDEPRECATED=s,this._usedEmojiImagesDEPRECATED=l}characters(){return this._characters}characterStyleIds(){return this._characterStyleIds}lines(){return this._lines}styleOverrideTable(){return this._styleOverrideTable}fontSizes(){return this._fontSizes}hyperlinkBoxesDEPRECATED(){return this._hyperlinkBoxesDEPRECATED}usedEmojiCodepointsDEPRECATED(){return this._usedEmojiCodepointsDEPRECATED}usedEmojiImagesDEPRECATED(){return this._usedEmojiImagesDEPRECATED}static forTests1(){return new i(new zn,null,[],"",[],[],[],[])}static forTests2(e){return new i(e,null,[],"",[],[],[],[])}static forTests3(e){return new i(new zn,null,[],"",[],[],e,[])}},Rp=class{constructor(e){this.paintOverrides=null,this.styleOverrideTable=null,this.paintOverrides=new So(e),this.styleOverrideTable=e}};var Np=class Np{setSerialization(e){this._serialization=e}decodeFillPaintData(e){if(e.length==0)return Ne.EMPTY;let t=ye.schema.decodeMessage(e);if(t.nodeChanges===void 0||t.nodeChanges.length!=1)throw new Error("Got bad node changes from C++");let n=null;try{let r=t.nodeChanges[0],o=r.fillPaints!=null?r.fillPaints:r.strokePaints;n=this._serialization.decodePaints(o,t.blobs)}catch(r){Ve("Caught error during fill paints marshaling. Rendered output may be incorrect"),Ve(r),n=Ne.EMPTY}return n}decodeSingleSolidFillWithNormalBlendMode(e,t,n){if(e.alpha!=1)throw new Error("Alpha from C++ is always expected to be 1");let r=new ie("SOLID");return r.setColor(E.new3(e.red,e.green,e.blue,e.alpha)),r.setOpacity(t),r.setIsEnabled(n),[r]}decodeEffectData(e){let t=ye.schema.decodeMessage(e);if(t.nodeChanges===void 0||t.nodeChanges.length!=1)throw new Error("Got bad node changes from C++");return mt.decodeEffects(t.nodeChanges[0].effects)}decodePrototypeInteractions(e){let t=ye.schema.decodeNodeChange(e);if(t==null)throw new Error("Got bad node change from C++");return mt.decodePrototypeInteractions(t.prototypeInteractions)}decodeVectorData(e){let t=ye.schema.decodeMessage(e);if(t.nodeChanges===void 0||t.nodeChanges.length!=1)throw new Error("Got bad node changes from C++");return this._serialization.decodeVectorData(t.nodeChanges[0].vectorData,t.blobs)}decodeTextData(e,t){let n=ye.schema.decodeMessage(e);if(n.nodeChanges===void 0||n.nodeChanges.length!=1)throw new Error("Got bad node changes from C++");let r=this._serialization.decodeTextData(n.nodeChanges[0].textData,n.blobs),o=[];for(let a of t)o.push(this._serialization.decodeEmojiImage(a));return new Pi(r.styleOverrideTable(),r.fontSizes(),r.hyperlinkBoxesDEPRECATED(),r.characters(),r.lines(),r.characterStyleIds(),t,o)}decodeDerivedTextData(e,t){let n=ye.schema.decodeMessage(e);if(n.nodeChanges===void 0||n.nodeChanges.length!=1)throw new Error("Got bad node changes from C++");let r=this._serialization.decodeDerivedTextData(n.nodeChanges[0].derivedTextData,n.blobs),o=[];for(let a of t)o.push(this._serialization.decodeEmojiImage(a));return new Da(r.hyperlinkBoxes(),t,o)}constructor(){this._serialization=null}};Np.instance=new Np;var La=Np;var Mo=(t=>(t[t.INTERACTIVE_COMPONENTS_ENABLED=0]="INTERACTIVE_COMPONENTS_ENABLED",t[t.INTERACTIVE_COMPONENTS_DISABLED=1]="INTERACTIVE_COMPONENTS_DISABLED",t))(Mo||{}),tf=class{constructor(e,t){this.clone=e,this.source=t}},nf=class{constructor(e,t){this.transitionRootStablePath=e,this.cloneOps=t}},Lo=class i{constructor(e,t){this._appState=null,this._modules=null,this._cachedViewNode=null,this._modules=e,this._appState=t,t.addFrameObserver(this._prototype())}modules(){return this._modules}nodeTsApi(){var e;return(e=this._modules)==null?void 0:e.nodeTsApi}nodeTsApiGenerated(){var e;return(e=this._modules)==null?void 0:e.nodeTsApiGenerated}sceneGraphTsApi(){var e;return(e=this._modules)==null?void 0:e.sceneGraphTsApi}_prototype(){var e;return(e=this._modules)==null?void 0:e.prototype}fonts(){var e;return(e=this._modules)==null?void 0:e.fonts}dumpFileForTests(){return this._prototype().dumpFile()}getNodeChangesForSwap(e,t,n){let r=this._prototype().getNodeChangesForSwap(e.guids,t,n),o=this._appState.scene(),a=r.clones.map(s=>{let l=o.findNode1(s.clone),d=o.findNode1(s.source);return new tf(l,d)});return new nf(new Mt(r.transitionRootStablePath),a)}runSetVariable(e,t,n,r){this._prototype().runSetVariable(e,t,n,r)}getFirstTruthyConditionalIndex(e,t){return this._prototype().getFirstTruthyConditionalIndex(e,t)}getICActionsForSetVariableAction(e,t,n,r,o){return this._prototype().getICActionsForSetVariableAction(e,t,n,r,o)}shouldDisallowSwap(e,t){return this._prototype().shouldDisallowSwap(e.guids,t)}applyExistingVariableChangesToIFLLoadedNodes(){this._prototype().applyExistingVariableChangesToIFLLoadedNodes()}updateImmutableFramesAndLayoutDirtyGroupsAndStacks(){this._prototype().updateImmutableFramesAndLayoutDirtyGroupsAndStacks()}prepareCppNodeForAccess(e){e!=this._cachedViewNode&&(this.nodeTsApi().setGlobalUnstableNodeByHandle(e.handle()),this._cachedViewNode=e)}createSceneAndSetActive(e,t){hr.instance.interactiveComponentsStatusForNewScene=t;let n=this._prototype().createSceneWithDangerousLoadingFlag(e);this._prototype().setActiveScene(n);let r=hr.instance.findScene(n);if(r==null)throw new Error("Failed to create scene in C++");return this._setSceneAsActiveIfNeeded(r),r}destroyScene(e){this._prototype().destroyScene(e.handle())}markSceneLoaded(e){this._prototype().markSceneLoaded(e.handle())}resetLocalChanges(){this._prototype().resetLocalChanges()}isOrContainsBaseScreen(e){return this._prototype().isOrContainsBaseScreen(e)}resetLocalVariableChanges(){this._prototype().resetLocalVariableChanges()}resetLocalInstanceChanges(e){this._prototype().resetLocalInstanceChanges(e)}resetLocalNestedInstanceChanges(e){this._prototype().resetLocalNestedInstanceChanges(e)}nodeHasLocalSymbolChanges(e){return this._prototype().nodeHasLocalSymbolChanges(e)}getNumStateTransitions(e){return this._prototype().getNumStateTransitions(e)}_setSceneAsActiveIfNeeded(e){this._prototype().getActiveScene()!=e.handle()&&this._prototype().setActiveScene(e.handle())}applyNodeChanges(e){this._prototype().applyNodeChanges(e,jo)}reset(){this._prototype()!=null&&this._prototype().reset()}findNode(e,t){return this._setSceneAsActiveIfNeeded(e),this._prototype().findNodeByStablePath(t.guids)}idlRegionsToGeometry(e,t){if(e===null||e==null)return null;let n=[],r=[];_t.INSTANCE.reset();for(let a of e){let s=new co(a.path),l=new Wn(a.windingRule==1?"ODD":"NONZERO",a.styleID,s,s.bounds());n.push(l),r.push(a.styleID),_t.INSTANCE.include3(l.bounds())}let o=t??new So(new zn(new Map));return new Vn(n,r,_t.INSTANCE.build(),o)}idlRegionsToTextGeometry(e,t){if(e==null)return null;let n=[],r=[],o=[];_t.INSTANCE.reset();for(let s of e){let l=new co(s.path),d=new Wn(s.windingRule==1?"ODD":"NONZERO",s.styleID,l,l.bounds());n.push(d),r.push(s.styleID),o.push(s.emojiCodePoints),_t.INSTANCE.include3(d.bounds())}let a=t??new So(new zn(new Map));return new Op(n,r,_t.INSTANCE.build(),a,o)}getFillGeometryForSpread(e,t,n){return this.prepareCppNodeForAccess(n),this._prototype().getFillGeometryForSpread(e,t,2)}getAffineTransform(e,t){return this.prepareCppNodeForAccess(e),this._prototype().getAffineTransform(t),new ne(ft.retAffineTransform_m00,ft.retAffineTransform_m01,ft.retAffineTransform_m02,ft.retAffineTransform_m10,ft.retAffineTransform_m11,ft.retAffineTransform_m12)}getAffineTransform_SGEO(e){return this._prototype().getAffineTransform_SGEO(e),new ne(ft.retAffineTransform_m00,ft.retAffineTransform_m01,ft.retAffineTransform_m02,ft.retAffineTransform_m10,ft.retAffineTransform_m11,ft.retAffineTransform_m12)}getArcData(e,t){this.prepareCppNodeForAccess(e),this._prototype().getArcData(t);let n={};return n.startingAngle=ft.retArcData_startAngle,n.endingAngle=ft.retArcData_endAngle,n.innerRadius=ft.retArcData_innerRadius,n}getArcData_SGEO(e){this._prototype().getArcData_SGEO(e);let t={};return t.startingAngle=ft.retArcData_startAngle,t.endingAngle=ft.retArcData_endAngle,t.innerRadius=ft.retArcData_innerRadius,t}getBool(e,t){return this.prepareCppNodeForAccess(e),this._prototype().getBool(t)}getBool_SGEO(e){return this._prototype().getBool_SGEO(e)}getDouble(e,t){return this.prepareCppNodeForAccess(e),this._prototype().getDouble(t)}getDouble_SGEO(e){return this._prototype().getDouble_SGEO(e)}getEffectList(e){this.prepareCppNodeForAccess(e);let t=this._prototype().getEffectList();return Vr.WeakHandle_isValid(t)?this._modules.effectData_Internal.getOrCreateSkewCopy(t):[]}getEffectList_SGEO(e){let t=this._prototype().getEffectList_SGEO(e);return Vr.WeakHandle_isValid(t)?this._modules.effectData_Internal.getOrCreateSkewCopy(t):[]}getGUID(e,t){return this.prepareCppNodeForAccess(e),this._prototype().getGUID(t),ee._new(ft.retGUID_sessionId,ft.retGUID_localId)}getGUID_SGEO(e){return this._prototype().getGUID_SGEO(e),ee._new(ft.retGUID_sessionId,ft.retGUID_localId)}getStyleId(e,t){return this.prepareCppNodeForAccess(e),this._prototype().getStyleId(t),{guid:ft.retStyleId.guid,ref:ft.retStyleId.ref}}getStyleId_SGEO(e){return this._prototype().getStyleId_SGEO(e),{guid:ft.retStyleId.guid,ref:ft.retStyleId.ref}}getInt(e,t){return this.prepareCppNodeForAccess(e),this._prototype().getInt(t)}getInt_SGEO(e,t){return this._prototype().getInt_SGEO(e,t)}getPaintList(e,t){this.prepareCppNodeForAccess(e);let n=this._prototype().getPaintList(t);return Vr.WeakHandle_isValid(n)?this._modules.paintData_Internal.getOrCreateSkewCopy(n):[]}getPaintList_SGEO(e){let t=this._prototype().getPaintList_SGEO(e);return Vr.WeakHandle_isValid(t)?this._modules.paintData_Internal.getOrCreateSkewCopy(t):[]}getField(e,t){this.prepareCppNodeForAccess(e);let n=this._prototype().getField(t);if(n.length==0)return null;let r=ye.schema.decodeMessage(n);if(r.nodeChanges===void 0||r.nodeChanges.length!=1)throw new Error("Bad NODE_CHANGES from getField");let o=r.nodeChanges[0],a=[],s=null;return this._appState.serialization().decodeNodeChange(o,a,(l,d)=>{s=d}),s}getField_SGEO(e){let t=this._prototype().getField_SGEO(e);if(t.length==0)return null;let n=ye.schema.decodeMessage(t);if(n.nodeChanges===void 0||n.nodeChanges.length!=1)throw new Error("Bad NODE_CHANGES from getField_SGEO");let r=n.nodeChanges[0],o=[],a=null;return this._appState.serialization().decodeNodeChange(r,o,(s,l)=>{a=l}),a}getParentIndex(e){this.prepareCppNodeForAccess(e);let t=this._prototype().getParentIndex();return Gn.fromString(t)}getParentIndex_SGEO(e){return Gn.fromString(this._prototype().getParentIndex_SGEO(e))}getPrototypeInteractions_SGEO(e){let t=this._prototype().getPrototypeInteractions_SGEO(e);return Vr.WeakHandle_isValid(t)?this._modules.prototypeInteractions_Internal.getOrCreateSkewCopy(t):[]}getString(e,t){return this.prepareCppNodeForAccess(e),this._prototype().getString(t)}getString_SGEO(e){return this._prototype().getString_SGEO(e)}getVector(e,t){return this.prepareCppNodeForAccess(e),this._prototype().getVector(t),new I(ft.retVector_x,ft.retVector_y)}getVector_SGEO(e){return this._prototype().getVector_SGEO(e),new I(ft.retVector_x,ft.retVector_y)}getOverridePath(e){return this.prepareCppNodeForAccess(e),new Mt(this._prototype().overridePath())}getStablePath(e){return this.prepareCppNodeForAccess(e),new Mt(this._prototype().stablePath())}hasNodeProperty(e,t){return this.prepareCppNodeForAccess(e),this._prototype().hasNodeProperty(t)}forEachField(e,t){this.prepareCppNodeForAccess(e),ft.forEachFieldCallback=t,this._prototype().forEachField(),ft.forEachFieldCallback=null}applyLocalNodeChangesForTests(e){if(!i.isTestingEnv())throw new Error("Should not be calling applyLocalNodeChangesForTests outside of tests");this._prototype().applyLocalNodeChangesForTests(e)}clearDirtyTextLayoutForTests(e){if(!i.isTestingEnv())throw new Error("Should not be calling flushLayoutForTests outside of tests");this._prototype().clearDirtyTextLayoutForTests(e.handle())}updateSymbolInstancesForTests(){if(!i.isTestingEnv())throw new Error("Should not be calling applyLocalNodeChangesForTests outside of tests");this._prototype().updateSymbolInstancesForTests()}updateStylesForTests(){if(!i.isTestingEnv())throw new Error("Should not be calling applyLocalNodeChangesForTests outside of tests");this._prototype().updateStylesForTests()}static initialize(e,t){if(D()!=null){Ve("Attempt to initialize PrototypeLib, but PrototypeLib is already initialized");return}Bh(new i(e,t)),La.instance.setSerialization(t.serialization()),mi&&e.interactionTestHelpers.setIsRunningViewerRenderServer()}static isTestingEnv(){return Lr||mi}},sd=class sd{isReady(){return this._isReady}createScene(e){return new gt(e,sd.instance.interactiveComponentsStatusForNewScene)}setViewer(e){this._viewer=e}getViewer(){return this._viewer}handleUncompressedMessage(e,t){if(this._multiplayer==null)throw new Error("Multiplayer hasn't been set");this._multiplayer.handleUncompressedMessage(e,t)}handleUncompressedSchema(e){if(this._multiplayer==null)throw new Error("Multiplayer hasn't been set");return this._multiplayer.handleUncompressedSchema(e)}didReceiveNodeChanges(e,t){if(this._multiplayer==null)throw new Error("Multiplayer hasn't been set");this._multiplayer.didReceiveNodeChanges(e,t)}setMultiplayer(e){this._multiplayer=e}findScene(e){return D().modules().prototype.getScene(e)}findNode(e){return Ht.IntMap_get(this._nodes,e,null)}setReverseVariantBindingsForICsDisabled(e){let t=this._reverseVariantBindingsForICsDisabled;return this._reverseVariantBindingsForICsDisabled=e,t}reverseVariantBindingsForICsDisabled(){return this._reverseVariantBindingsForICsDisabled}ready(){this._isReady=!0}track(e,t){Pe.trackEventJSON1(e,t)}triggerViewerEvent(e,t){this._viewer!==null&&this._viewer.trigger(e,t)}Node_created(e,t,n,r){if(t!=null){let o=new ye(e,t,ee._new(n,r));this._nodes.set(e,o),t.dangerouslyRegisterNode(o)}else throw new Error("Cannot create node with null scene")}Node_destroyed(e){let t=this.findNode(e);if(t!=null){let n=t.scene();n!=null&&n.dangerouslyUnregisterNode(t.id()),this._nodes.delete(e)}}triggerSceneGraphEvent(e,t,n){let r=this.findNode(e);if(r==null)return;let o=r.scene();if(o!=null){let a=t,s=r.id(),l=Db(D(),o,s,a,n),d=null,c=!1;a==98?Ze.asStringEnum(l,"CREATED")=="CREATED"?(d="REMOVED",c=!0):d="CREATED":d=wp(D(),r,a),o.broadcastPropertyChange(new Cp(r,a,l,d)),c&&o.dangerouslyUnregisterNode(s)}}updateNodeAfterPropertyChange(e,t){let n=this.findNode(e);n!=null&&n.updateAfterPropertyChange(t)}linkNodeToParent(e,t,n){let r=this.findNode(e);r!=null&&r.linkToParent(this.findNode(t),n)}unlinkNodeFromParent(e){let t=this.findNode(e);t!=null&&t.unlinkFromParent()}debugPrototypeActionFromPreview(e){top.postMessage({debugPrototypeActionFromPreview:e},window.origin)}didEncounterTimeSlicedIFLMessage(){Dt.didEncounterTimeSlicedIFLMessage()}timeSliceIFLEnabled(){return Y.prototypeIFLTimeSlice()}retAffineTransform(e,t,n,r,o,a){ft.retAffineTransform_m00=e,ft.retAffineTransform_m01=t,ft.retAffineTransform_m02=n,ft.retAffineTransform_m10=r,ft.retAffineTransform_m11=o,ft.retAffineTransform_m12=a}retArcData(e,t,n){ft.retArcData_startAngle=e,ft.retArcData_endAngle=t,ft.retArcData_innerRadius=n}retGUID(e,t){ft.retGUID_sessionId=e,ft.retGUID_localId=t}retStyleId(e){ft.retStyleId=e}retVector(e,t){ft.retVector_x=e,ft.retVector_y=t}forEachFieldCallback(e){ft.forEachFieldCallback!=null&&ft.forEachFieldCallback(e)}constructor(){this._viewer=null,this._isReady=!1,this._multiplayer=null,this.interactiveComponentsStatusForNewScene=1,this._nodes=new Map,this._reverseVariantBindingsForICsDisabled=!1}};sd.instance=new sd;var hr=sd,ft;(y=>(y.retAffineTransform_m00=0,y.retAffineTransform_m01=0,y.retAffineTransform_m02=0,y.retAffineTransform_m10=0,y.retAffineTransform_m11=0,y.retAffineTransform_m12=0,y.retArcData_startAngle=0,y.retArcData_endAngle=0,y.retArcData_innerRadius=0,y.retGUID_sessionId=0,y.retGUID_localId=0,y.retStyleId=null,y.retVector_x=0,y.retVector_y=0,y.forEachFieldCallback=null))(ft||(ft={}));var Fb;(e=>{function i(t){return Mo[t]}e.InteractiveComponentsEnabled_toString=i})(Fb||(Fb={}));var gn=class gn{static logVerbose(e){gn.VERBOSE_LOGS&&console.log("[IncrementalFrameLoader]",e())}static MAX_SLIDESHOW_PRELOAD_DISTANCE(){return Y.protoPreloadMore()?3:2}constructor(e,t){this._multiplayer=null,this._appState=null,this._emitter=null,this._canvas=null,this._currentQueries=new si,this._previousSceneGraphReply=new si,this._rootLevelSceneGraphQuery=Qn.create(ee._new(0,0),1),this._requestSectionsOnCanvas=!1,this._requestedTlfIds=new Ar,this._currentTlfIds=[],this._requestedSectionsQueue=[],this._bfsOrderWorkingSet=[],this._pendingNodeToRequest=null,this._multiplayer=t,this._multiplayer.addObserver(this),this._appState=e,e.addAppObserver(this),e.prototypeState().addObserver(this),this._emitter=qt.getEventEmitter(),this._emitter.on("Slow incremental load",n=>{Pe.trackEventJSON1("Slow incremental load",n)}),console.debug("Using incremental frame loading")}simulateRepliedQueriesForTests(e){this._currentQueries=si.fromList(e),this.handleSceneGraphReply(0,e)}requestTlf(e){return this._setCurrentTlfIds([e]),this._isFullyLoaded(e)?!0:(this._requestedTlfIds.add(e),this._redeferUpdate(0),!1)}_setCurrentTlfIds(e){this._currentTlfIds=e}_requestTlfs(e){this._setCurrentTlfIds(e);for(let t of e){if(this._isFullyLoaded(t)){this._appState.requestedFrameMetricsTracker().track(t,{wasAlreadyLoaded:!0,wasAlreadyInWorkingSet:!0});continue}else{let n={wasAlreadyLoaded:!1,wasAlreadyInWorkingSet:!1};for(let r of this._bfsOrderWorkingSet)if(r.nodeId==t){n.wasAlreadyInWorkingSet=!0;break}this._appState.requestedFrameMetricsTracker().track(t,n)}this._requestedTlfIds.add(t),this._redeferUpdate(0)}}_isFullyLoaded(e){var r;let t=(r=this._multiplayer.scene())==null?void 0:r.findNode1(e);if(t==null)return!1;let n=t;for(;n!=null;){if(this._previousSceneGraphReply.containsExactQuery(Qn.create(n.id(),0)))return!0;n=n.parent()}return!1}_isQueryPresent(e,t){for(let n of t)if(br.equals(n,e))return!0;return!1}_getQueriesToLoad(){let e=new si;return this._requestSectionsOnCanvas&&(this._getSectionSceneGraphQueriesGivenNode(this._canvas).each(n=>{e.add(n)}),this._requestSectionsOnCanvas=!1),this._addRequestedTlfs(e),this._appState.scene()!=null&&this._addScreenAdjacencies(e),e}_getSectionSceneGraphQueriesGivenNode(e){let t=new si;if(this._multiplayer.scene()!=null){if(e==null||e.type()!="DOCUMENT"&&e.type()!="CANVAS"&&e.type()!="SECTION")return t;ye.forEachNode(e,n=>{if(n.type()=="SECTION"){Pe.trackDefinedEvent("prototype.ifl_section_infinite_query",{});let r=Qn.create(n.id(),0);t.add(r)}})}return t}_getSectionSceneGraphQueries(){var n;let e=new si,t=[];if(this._multiplayer.scene()!=null){for(;this._requestedSectionsQueue.length!=0;){let r=this._requestedSectionsQueue.shift(),o=(n=this._multiplayer.scene())==null?void 0:n.findNode1(r);o==null||o.type()!="DOCUMENT"&&o.type()!="CANVAS"&&o.type()!="SECTION"||ye.forEachNode(o,a=>{if(a.id()!=o.id()&&a.type()=="SECTION"){let s=Qn.create(a.id(),1);e.add(s),t.push(a.id())}})}this._requestedSectionsQueue=t}return e}_addRequestedTlfs(e){var t;gn.logVerbose(()=>"Visiting requestedTlfs for next queries:"+this._requestedTlfIds.asList().map(n=>Bn.string_toString(n)).join(","));for(let n of this._requestedTlfIds.asList()){let r=ee.fromString(n);if(r==null)continue;if(!this._previousSceneGraphReply.containsNodeById(r)){e.add(Qn.create(r,1));continue}let a=(t=this._multiplayer.scene())==null?void 0:t.findNode1(r);if(this._requestedTlfIds.remove(r),a==null){let s=ee._new(0,0);e.add(Qn.create(s,1)),this._requestedTlfIds.add(s)}else if(a.type()=="DOCUMENT"){this._emitter.trigger("redirectingToFirstPageDueToInvalidStartNode",null);let s=this._multiplayer.scene().firstUserCanvasOrNull();if(s==null){console.error("No user-visible canvases");continue}this._requestedTlfIds.add(s.id()),e.add(Qn.create(s.id(),1))}else if(a.type()=="CANVAS"){let s=!1,l=this._getSectionSceneGraphQueriesGivenNode(a);s=l.count()>0,l.each(c=>{e.add(c)});let d=this._appState.prototypeStructure().nodeToRestartPrototypeOn(a);if(d==null){s||console.error("No top-level frames present");continue}this._requestedTlfIds.add(d.id()),e.add(Qn.create(d.id(),0)),this._setCurrentTlfIds([d.id()])}else{for(;a!=null&&!a.isTopLevel();)a=a.parent();a!=null&&(e.add(Qn.create(a.id(),0)),this._canvas=a.findContainingCanvasOrParent(),e.add(Qn.create(this._canvas.id(),1)),this._getSectionSceneGraphQueriesGivenNode(this._canvas).each(l=>{e.add(l)}),this._requestSectionsOnCanvas=!0)}}}_addScreenAdjacencies(e){Y.getViewerMode()==Y.ViewerMode.PROTOTYPE&&this._appState.prototypeStructure().currentType()==1?this._addScreenAdjacenciesForSlideshow(e):this._addScreenAdjacenciesForPrototype(e)}_getMaxBFSDistance(){return Je.isCurrentOSMobileOrIPad()?gn.MOBILE_MAX_PROTOTYPE_BFS_DEPTH:gn.DEFAULT_MAX_PROTOTYPE_BFS_DEPTH}_getMaxBFSCount(){return Je.isCurrentOSMobileOrIPad()?gn.MOBILE_MAX_PROTOTYPE_BFS_COUNT:gn.DEFAULT_MAX_PROTOTYPE_BFS_COUNT}_addScreenAdjacenciesForSlideshow(e){let t=Bt.visuallySortedTopLevelFrames(this._appState.getActiveCanvas()),n=t.map(o=>o.id());if(this._currentTlfIds.length==0||!ee.isValid(this._currentTlfIds[0]))return;let r=n.indexOf(this._currentTlfIds[0]);if(!(r<0)){for(let o=r-gn.MAX_SLIDESHOW_PRELOAD_DISTANCE(),a=r+gn.MAX_SLIDESHOW_PRELOAD_DISTANCE()+1;o<a;o=o+1)o>=0&&o<t.length&&e.add(Qn.create(t[o].id(),0));if(this._currentTlfIds.length>1)for(let o=1,a=this._currentTlfIds.length;o<a;o=o+1)ee.isValid(this._currentTlfIds[o])&&e.add(Qn.create(this._currentTlfIds[o],0))}}_addScreenAdjacenciesForPrototype(e){if(this._currentTlfIds.length==0||!ee.isValid(this._currentTlfIds[0]))return;let t=new gn.Queue;for(let l=this._currentTlfIds.length-1;l>=0;l=l-1)t.pushBackIfUnseen(this._currentTlfIds[l],0);let n=0;this._bfsOrderWorkingSet=[];let r=this._appState.prototypeStructure().nodeTransitionTracker().cleanedUpTransitionMapByTLF();for(;t.nonempty()&&(t.front().depth<=1||n<this._getMaxBFSCount());){let l=t.popFront(),d=l.guid,c=this._previousSceneGraphReply.containsExactQuery(Qn.create(d,0));this._bfsOrderWorkingSet.push(new gn.WorkingSetItem(d,c));let p=this._appState.scene().findNode1(d);if(p==null||(l.depth>0&&(n=n+1),l.depth>=this._getMaxBFSDistance()))continue;let u=Bt.adjacentBaseScreens(r,p);ye.forEachNode(p,h=>{var f;if(h.isInstance()&&!h.isPrimaryInstance()&&h.getBoundVariables().componentProperties){let g=this._appState.scene().findNode1(h.symbolID()).parent();g.isStateGroup()&&(u.add(g.id()),h.invalidateRenderTreeForSelfAndParents(),h.invalidateRenderTreeForChildren())}(f=h.prototypeInteractions())==null||f.forEach(y=>{for(let g of y.allActions())if(ee.isValid(g.transitionNodeID())&&u.add(g.transitionNodeID()),g.connectionType()=="BACK"){let A=this._appState.prototypeState().getLastChangeInHistory();A!=null&&A.getRemovedFrameIds().forEach(T=>{T!=null&&u.add(T)})}}),Y.getFeatureFlags().viewer_ifl_enhancements&&Bt.isNodeInteractableBecauseOfHyperlinks(h)&&h.textHyperlinkBoxes().forEach(y=>{y.guid&&u.add(ee.fromFigGUID(y.guid))})});for(let h of u.asList())t.pushBackIfUnseen(h,l.depth+1)}let o=this._appState.prototypeState().getInitiatedChange();if(o!=null)for(let l of o.oldStateAndOverlays.statesAndOverlaysIncluded().asList()){let d=ee.fromString(l);this._bfsOrderWorkingSet.unshift(new gn.WorkingSetItem(d,this._previousSceneGraphReply.containsExactQuery(Qn.create(d,0))))}wn.trackNumber("[IFL] Working set size",this._bfsOrderWorkingSet.length);let a=0,s=0;for(let l of this._bfsOrderWorkingSet)if(e.add(Qn.create(l.nodeId,0)),l.isAlreadySubscribed?s=s+1:a=a+1,a>=gn.MAX_PROTOTYPE_TLF_BATCH_SIZE)break;wn.trackNumber("[IFL] Working set frames loaded",s)}getMetricsForNode(e){return this._appState.requestedFrameMetricsTracker().getMetricsForRequestedNode(e.id())}_requestNextQueriesToLoad(e){if(e.add(this._rootLevelSceneGraphQuery),e.equals(this._currentQueries))return;Y.protoUseFrameEviction()?(this._multiplayer.scene()!=null&&this._currentQueries.each(n=>{let r=this._multiplayer.scene().findNode2(Ts.toString(n.startingNode));r!=null&&(r.type()=="DOCUMENT"||r.type()=="CANVAS"||r.type()=="SECTION")&&e.add(n)}),this._currentQueries=e):e.each(n=>{this._currentQueries.add(n)});let t=[];for(let n of this._currentQueries.asList())t.push(n);gn.logVerbose(()=>"setting scene graph queries:"+t.map(n=>br.toString(n)).join(",")),this._multiplayer.setSceneGraphQueries(t)}_redeferUpdate(e){this._deferredUpdate!==void 0?this._deferredUpdate.redefer(e):this._deferredUpdate=new ld(()=>{gn.logVerbose(()=>`update............
`+(gn.VERBOSE_LOGS_SHOW_SCENEGRAPH?this._multiplayer.scene().root().hierarchyString():"")),this._requestNextQueriesToLoad(this._getQueriesToLoad()),this._deferredUpdate=void 0},e)}handleSceneChange(e,t){e!=null&&e.removeObserver(this),t!=null&&t.addObserver(this),this._redeferUpdate(0)}handleActiveCanvasChange(e,t){this._redeferUpdate(0)}handleActivePrototypeStartingPointChange(e,t){}handleStateChangeAborted(e){}handleStateChangeCommitted(e,t){}handleStateChangeInitiated(e){this._redeferUpdate(0)}handleStateChangeRequested(e){let t=e.newStateAndOverlays.statesAndOverlaysIncluded(),n=[];for(let r of t.asList())n.push(ee.fromString(r));this._requestTlfs(n)}handleFitModeChange(e,t){}handleRestartPrototype(){}handleConnect(e,t){e==0&&(this._previousSceneGraphReply=new si,this._currentQueries=new si,this._redeferUpdate(0),Y.getViewerMode()==Y.ViewerMode.PROTOTYPE&&t==null&&(t=ee._new(0,0)),t!=null&&(this._pendingNodeToRequest=t))}handleDisconnect(){}handleJoinStart(e,t,n){this._pendingNodeToRequest!=null&&this.requestTlf(this._pendingNodeToRequest),this._pendingNodeToRequest=null}handleJoinEnd(){}handlePresenterChange(){}handleNodeChanges(){}handleSceneChangedLoadingPhase(e,t){}handleSceneGraphReply(e,t){Pe.handleMultiplayerFirstResponse(),gn.logVerbose(()=>{let o="";return o+=`
-----handleSceneGraphReply-----
`,o+="sceneGraphQueries:"+t.map(a=>br.toString(a)).join(",")+`
`,gn.VERBOSE_LOGS_SHOW_SCENEGRAPH&&(o+=this._multiplayer.scene().root().hierarchyString()+`
`),o+="-----------------------------------",o}),this._previousSceneGraphReply=si.fromList(t);let n=this._getQueriesToLoad();n.isSubsetOf(this._previousSceneGraphReply)?(Pe.handleMultiplayerIFLSatisfied(),gn.logVerbose(()=>"All queries satisfied! Calling finishIncrementalLoading..."),this._multiplayer.finishIncrementalLoading(),Pe.handleIFLCompleted()):this._requestNextQueriesToLoad(n)}handleSceneGraphEvent(e){if(Zr.isPrototypeStructuralChange(e.property)){if(e.node.type()=="SECTION"&&e.property==25&&(this._requestSectionsOnCanvas=!0),this._deferredUpdate!=null&&this._deferredUpdate.delayMs==0)return;this._redeferUpdate(jo||Lr?0:250)}}};gn.VERBOSE_LOGS=!1,gn.VERBOSE_LOGS_SHOW_SCENEGRAPH=!1,gn.MOBILE_MAX_PROTOTYPE_BFS_DEPTH=2,gn.DEFAULT_MAX_PROTOTYPE_BFS_DEPTH=8,gn.MOBILE_MAX_PROTOTYPE_BFS_COUNT=4,gn.DEFAULT_MAX_PROTOTYPE_BFS_COUNT=Number.MAX_SAFE_INTEGER,gn.MAX_PROTOTYPE_TLF_BATCH_SIZE=4;var Ma=gn;(n=>{class i{constructor(o,a){this.guid=o,this.depth=a}}n.Entry=i;class e{constructor(o,a){this.nodeId=o,this.isAlreadySubscribed=a}}n.WorkingSetItem=e;class t{nonempty(){return this._queue.length>0}pushBackIfUnseen(o,a){this._seen.has(o)||(this._seen.set(o,!0),this._queue.push(new n.Entry(o,a)))}front(){return this._queue[0]}popFront(){return this._queue.shift()}constructor(){this._queue=[],this._seen=new Map}}n.Queue=t})(Ma||(Ma={}));var si=class i{add(e){let t=br.nodeIdString(e);if(!this._hash.has(t))this._hash.set(t,e);else{let n=this._hash.get(t);if(n.depth==0)return;(e.depth==0||e.depth>n.depth)&&this._hash.set(t,e)}}containsNodeById(e){return e!=null&&this._hash.has(e)}containsExactQuery(e){return this.containsNodeById(ee.fromFigGUID(e.startingNode))?this._hash.get(br.nodeIdString(e)).depth==e.depth:!1}remove(e){this._hash.delete(br.hash(e))}count(){return this._hash.size}asList(){return Array.from(this._hash.values())}each(e){Array.from(this._hash.values()).forEach(e)}equals(e){if(e==null||this.count()!=e.count())return!1;for(let t of Array.from(this._hash.values()))if(!e.containsExactQuery(t))return!1;return!0}isSubsetOf(e){if(e==null||this.count()>e.count())return!1;for(let t of Array.from(this._hash.values()))if(!e.containsExactQuery(t))return!1;return!0}toJSObject(){return Be.StringMap_toJSObject(this._hash)}static fromList(e){let t=new i;for(let n of e)t.add(n);return t}constructor(){this._hash=new Map}},yo=class yo{constructor(e,t){this.complete=()=>{let e=this._executionTime-Date.now();e<=0||2==0?this.callback():this._timeoutID=yo._setTimeout(this.complete,e)};this.delayMs=t,this.callback=e,this._timeoutID=yo._setTimeout(this.complete,t),this._executionTime=Date.now()+t}redefer(e){this._executionTime=Date.now()+e}cancel(){yo._clearTimeout(this._timeoutID)}static _setTimeout(e,t){if(2==0){let n=(yo._nextMockTimeoutID=yo._nextMockTimeoutID+1)+-1;return yo._mockTimeouts.set(n,e),n}else return setTimeout(e,t)}static _clearTimeout(e){2==0?yo._mockTimeouts.delete(e):clearTimeout(e)}static fireAllMockedTimeouts(){let e=Array.from(yo._mockTimeouts.keys());for(let t of e)yo._mockTimeouts.get(t)(),yo._mockTimeouts.delete(t)}};yo._nextMockTimeoutID=1,yo._mockTimeouts=new Map;var ld=yo;var Pp=class{version(){return mpGlobal.version}sock(){return mpGlobal.sock!=null?new nd(0,mpGlobal.sock):null}setSock(e){if(e!=null){let t=e.asHTMLSocket();t==null&&console.warn("Ignoring invalid socket binding for mpGlobal"),mpGlobal.sock=t.ws}else mpGlobal.sock=null}msgs(){return mpGlobal.msgs}setMsgs(e){mpGlobal.msgs=e}perfMetrics(){return mpGlobal.perfMetrics}setPerfMetrics(e){mpGlobal.perfMetrics=e}url(e){return mpGlobal.url(e)}preconnect(e){mpGlobal.preconnect(e)}newSocket(e){return new nd(1,e)}constructor(){}},rf=class i{static attemptToParseFrom(e){try{let t=JSON.parse(e);return new i(t.url,t.type)}catch{Ve("Failed to parse TooManyConnectionsPayload")}return null}constructor(e,t){this.url=e,this.type=t}},Lp=(t=>(t[t.FLUSH_AT_NEXT_INTERVAL=0]="FLUSH_AT_NEXT_INTERVAL",t[t.FORCE_FLUSH=1]="FORCE_FLUSH",t))(Lp||{}),Zn=class Zn{constructor(e,t,n){this._onDocumentVisibilityChange=()=>{Y.prototypeIFLTimeSlice()&&(document.visibilityState==="visible"&&this._wasBackgrounded?(this._wasBackgrounded=!1,this.flushMessageQueue()):document.visibilityState==="hidden"&&(this._wasBackgrounded=!0))};this._appState=null,this._isWindowActive=null,this._emitter=null,this._mpContext=null,this._incrementalLoader=null,this._role="viewer",this._scene=null,this._userSyncing=null,this._heartbeatTimeout=0,this._consecutiveFailedConnectionAttempts=0,this._attemptsSinceLastConnectionSuccess=0,this._hasConnectedAtLeastOnce=!1,this._onlineChangeHandler=null,this._reconnectionTimeout=0,this._isConnected=!1,this._isJoined=!1,this._shouldReconnect=!0,this._socket=null,this._url=null,this._fileKey=null,this._oauthToken=null,this._nodeId=null,this._partialSnapshotInfo=new Fp(null,null,null),this._reconnectKey=null,this._previousTlfID=null,this._previousCanvasSpaceMouseLocation=null,this._sessionID=0,this._observingSessionID=-1,this._presenterSessionID=null,this._sessionsNominatingCurrentUser=new Set,this._sessionNominatedByCurrentUser=null,this._cachedNextUserChange=null,this._canvasSpaceClicks=[],this._nextCanvasSpaceClickID=0,this._pendingSceneGraphQueriesOrNull=null,this._lastSceneGraphQueryTime=0,this._lastSceneGraphQueryConcurrency=0,this._lastSentSceneGraphQueriesOrNull=null,this._observers=new Xn,this._sceneLoadingPhase=0,this._prototypeLibCppEnabledForPendingFile=1,this._connectType=0,this._sessionSchema=null,this._staticFileRequest=null,this.maxScrollPositionsToStore=10,this._recentlyChangedScrollPositions=[],this._lastFlush=-1,this._appState=e,this._isWindowActive=t,this._emitter=qt.getEventEmitter(),this._appState.addAppObserver(this),e.prototypeState().addObserver(this),e.prototypeState().addHsmObserver(this),this._appState.addFrameObserver(this),this._wasBackgrounded=!1,document.addEventListener("visibilitychange",this._onDocumentVisibilityChange),this._mpContext=n,this._incrementalLoader=new Ma(this._appState,this)}static hasPrefix(e,t){if(e.length>=t.length){for(let n=0,r=t.length;n<r;n=n+1)if(e[n]!=t.charCodeAt(n))return!1;return!0}return!1}onFrame(){var e;Y.prototypeIFLTimeSlice()&&((e=D())==null||e.modules().prototype.tickAsyncMultiplayerMessageHandler(this.sessionID(),this._sceneLoadingPhase,jo))}flushMessageQueue(){var e;Y.prototypeIFLTimeSlice()&&((e=D())==null||e.modules().prototype.flushMessageQueue(this.sessionID(),this._sceneLoadingPhase,jo))}addObserver(e){this._observers.add(e)}removeObserver(e){this._observers.remove(e)}fileKey(){return this._fileKey}observingSessionID(){return this._observingSessionID}setObservingSessionID(e){this._observingSessionID=e,this._getOrCreateNextUserChange().observing=[e]}observedUser(){return this._userSyncing!=null?Ht.IntMap_get(this._userSyncing.userBySessionID(),this._observingSessionID,null):null}isObserving(){return this.observingSessionID()!=-1}presenterSessionID(){return this._presenterSessionID}removeNominator(e){this._sessionsNominatingCurrentUser.delete(e)}sessionsNominatingCurrentUser(){return Array.from(this._sessionsNominatingCurrentUser.values())}sessionNominatedByCurrentUser(){return this._sessionNominatedByCurrentUser}setPresenterSessionID(e){this._presenterSessionID=e}scene(){return this._scene}incrementalLoader(){return this._incrementalLoader}socketForTesting(){var e;return(e=this._socket)==null?void 0:e.asMockSocket()}setMultiplayerUserSyncing(e){this._userSyncing=e}setScene(e){this._scene=e}isConnected(){return this._isConnected}fulfilledMultiplayerQueries(){return this._partialSnapshotInfo.fulfilledQueries}_setSceneLoadingPhase(e){let t=this._sceneLoadingPhase;switch(this._sceneLoadingPhase=e,t!=e&&this._observers.forEach(n=>{n.handleSceneChangedLoadingPhase(t,e)}),e){case 0:break;case 1:{console.log("sceneWillRebuildAfterReconnecting"),this._emitter.trigger("sceneWillRebuildAfterReconnecting",null);break}case 2:{t==0?this._appState.fontListPromise().then(n=>{console.debug("sceneDidCompleteInitialLoad"),this._emitter.trigger("sceneDidCompleteInitialLoad",null)}):t==1&&(console.log("sceneDidRebuildAfterReconnecting"),this._emitter.trigger("sceneDidRebuildAfterReconnecting",null)),this._socket!=null&&this._sendSignal("client-rendered","");break}}}setNodeLoadedStatusesAndUpdate(e){this._setCanvasLoadedStatuses(e),this._setTlfLoadedStatuses(e),this._appState.prototypeState().tryToInitiateRequestedStateChange(Po.InitiateRequestedStateChangePolicy.WAIT_UNTIL_DESTINATIONS_LOADED),this._appState.trySettingRequestedActiveCanvas()}_setCanvasLoadedStatuses(e){this.scene().root().forEachChild(t=>{t.type()!="CANVAS"||t.isInternalOnly()||(e==null||e.some(n=>br.fullyLoadsNode(n,t)))&&t.setHasBeenLoaded(!0)})}_setTlfLoadedStatuses(e){var r,o,a;let t=0,n=0;Zn.VERBOSE&&(console.log("-----------_setTlfLoadedStatuses-----------"),((r=this.scene())==null?void 0:r.root())!=null&&this.scene().root().forEachChild(s=>{s.forEachChild(l=>{l.hasBeenLoaded()&&(t=t+1)})})),this.scene().setTlfsLoaded(s=>e==null||e.some(l=>br.fullyLoadsNode(l,s))),Zn.VERBOSE&&(((o=this.scene())==null?void 0:o.root())!=null&&this.scene().root().forEachChild(s=>{s.forEachChild(l=>{l.hasBeenLoaded()&&(n=n+1)})}),console.log(`\u{1F69A} numLoaded ${n-t} (${t} -> ${n})`),console.log("--------------------------------------------")),(a=D())==null||a.applyExistingVariableChangesToIFLLoadedNodes()}_finishLoadingIfNecessary(){var t;if(this._sceneLoadingPhase==2)return;this._appState.setCurrentFileKey(this._fileKey),this._appState.setScene(this._scene);let e=null;if(this._nodeId!=null){let n=this._appState.scene().findNode1(this._nodeId),r=n==null?void 0:n.findContainingCanvasOrSelf();r!=null&&this._appState.setActiveCanvas(r),e=(t=this._appState.prototypeStructure())==null?void 0:t.validDestinationForPrototypeFromId(this._nodeId)}e!=null?this._appState.prototypeState().navigateToFrameAndCloseOverlays(e.id()):this._appState.prototypeState().restartPrototype(0),Y.getFeatureFlags().prototype_ifl_delay_scene_load?this._scene.isLoadedTlfsEmpty()||this._setSceneLoadingPhase(2):this._setSceneLoadingPhase(2)}finishIncrementalLoading(){this._finishLoadingIfNecessary(),this._emitter.trigger("incrementalLoadingInfo",{type:"finishIncrementalLoading",fileKey:this._fileKey})}sessionID(){return this._sessionID}role(){return this._role}setRole(e){this._role=e}currentSceneGraphQueries(){return this._pendingSceneGraphQueriesOrNull!=null?this._pendingSceneGraphQueriesOrNull:this._lastSentSceneGraphQueriesOrNull!=null?this._lastSentSceneGraphQueriesOrNull:[]}connectTo(e,t,n,r){this._connectTo(e,0,t,n,r)}attemptReconnect(){var t;if(this._scene==null||this._sceneLoadingPhase==0){this._scene!=null&&this._sceneLoadingPhase==0&&Pe.trackEvent("Viewer reconnected during initial load",{}),this._connectTo(this._fileKey,0,this._nodeId,this._oauthToken,this._prototypeLibCppEnabledForPendingFile);return}let e=this._appState.baseScreenId()??((t=this._appState.getActiveCanvas())==null?void 0:t.id());this._connectTo(this._fileKey,1,e,this._oauthToken,this._prototypeLibCppEnabledForPendingFile)}_connectTo(e,t,n,r,o){this._attemptsSinceLastConnectionSuccess=this._attemptsSinceLastConnectionSuccess+1,Pe.handleMultiplayerOpenConnection(),this.disconnect(),this._fileKey=e,this._connectType=t,this._oauthToken=r,this._nodeId=n,this._prototypeLibCppEnabledForPendingFile=o,this._staticFileRequest!=null&&(this._staticFileRequest.cancel(),this._staticFileRequest=null);let a="";switch(t){case 0:{a="initial-load",this._lastSentSceneGraphQueriesOrNull=null,this._pendingSceneGraphQueriesOrNull=null,this._partialSnapshotInfo=new Fp(null,null,null);break}case 1:{a="reconnect",this._pendingSceneGraphQueriesOrNull==null&&this._lastSentSceneGraphQueriesOrNull!=null&&(this._pendingSceneGraphQueriesOrNull=this._lastSentSceneGraphQueriesOrNull,this._lastSentSceneGraphQueriesOrNull=null);break}}let s=this._mpContext.url({fileKey:e,role:this._role,oauthToken:r,connectionType:a}),l=this._partialSnapshotInfo.isValid()&&this._pendingSceneGraphQueriesOrNull!=null&&this._queriesAreEqual(this._partialSnapshotInfo.fulfilledQueries,this._pendingSceneGraphQueriesOrNull);if(this._scene!=null&&l){this._partialSnapshotInfo.snapshotHash!=null&&(s+=`&snapshot-hash=${encodeURIComponent(this._partialSnapshotInfo.snapshotHash)}`),this._partialSnapshotInfo.reconnectSequenceNumber!=null&&(s+=`&reconnect-sequence-number=${encodeURIComponent(this._partialSnapshotInfo.reconnectSequenceNumber.value.toString())}`);let y=encodeURIComponent(Qn.serializeListForMultiplayerURL(this._pendingSceneGraphQueriesOrNull));s+=`&scenegraph-queries=${y}`,this._sendSceneGraphQueries(this._pendingSceneGraphQueriesOrNull,0),this._pendingSceneGraphQueriesOrNull=null}this._reconnectKey!=null&&(console.log(`reconnecting with reconnect key ${this._reconnectKey}`),s+=`&reconnect-key=${encodeURIComponent(this._reconnectKey)}`),this._url=s,console.debug(`attempting to connect to ${s}`);let d=this._mpContext.sock(),c=this._mpContext.msgs();if(d!=null&&d.url()==s&&(d.readyState()==oi.Socket_CONNECTING||d.readyState()==oi.Socket_OPEN))console.debug(`Applied the preconnect optimization for URL ${s}`),this._mpContext.setSock(null),this._mpContext.setMsgs([]),this._mpContext.setPerfMetrics([]);else{if(d!=null){console.warn(`Preconnect URL ${d.url()} doesn't match URL ${s}, skipping preconnect optimization`);try{d.close()}catch{}}d=this._mpContext.newSocket(s),d.setBinaryType("arraybuffer"),c=[]}let p=()=>this._socket==null?d==null:this._socket.equals(d),u=!0,h=null;d.setOnopen(y=>{if(!p()){console.warn("ignoring 'open' event on old socket");return}this._consecutiveFailedConnectionAttempts=0,h()}),h=()=>{this._isConnected=!0,console.debug(`connected to ${this._url}`),Pe.handleMultiplayerSocketConnectionAttempt(!0,this._attemptsSinceLastConnectionSuccess,!this._hasConnectedAtLeastOnce,this._isWindowActive()),this._hasConnectedAtLeastOnce=!0,this._attemptsSinceLastConnectionSuccess=0,this._observers.forEach(y=>{y.handleConnect(t,n)})};let f=null;d.setOnmessage(y=>{if(!p()){console.warn("ignoring 'message' event on old socket");return}if(!y.isArrayBuffer()){console.warn("ignoring 'message' event without an ArrayBuffer payload");return}let g=new Uint8Array(y.dataAsArrayBuffer());f(g)}),f=y=>{let g=D();if(u){if(u=!1,!g.modules().prototype.handleServerSchema(y)){this.disconnect();return}this._sendSignal("feature-flags",JSON.stringify(Y.getFeatureFlags()))}else g.modules().prototype.handleCompressedMultiplayerMessage(y,this.sessionID(),this._sceneLoadingPhase,jo)},d.setOnclose(y=>{if(!p()){console.warn("ignoring 'close' event on old socket");return}if(this._isConnected?Pe.handleMultiplayerSocketDisconnected(this._isWindowActive()):Pe.handleMultiplayerSocketConnectionAttempt(!1,this._attemptsSinceLastConnectionSuccess,!this._hasConnectedAtLeastOnce,this._isWindowActive()),this.disconnect(),!this._shouldReconnect){console.warn("File too busy, not reconnecting");return}let g=null,A=()=>{clearTimeout(this._reconnectionTimeout),this._onlineChangeHandler!=null&&(Yt.EventTarget_removeEventListener1(window,"online",this._onlineChangeHandler),this._onlineChangeHandler=null),this._isWindowActive()?this.attemptReconnect():g()};g=()=>{let T=Math.min(Zn.RECONNECTION_DELAY_MAX,Zn.RECONNECTION_DELAY_MIN*Math.pow(2,this._consecutiveFailedConnectionAttempts)),b=Zn.RECONNECTION_DELAY_MIN+(T-Zn.RECONNECTION_DELAY_MIN)*Math.random();console.debug(`attempting to reconnect to ${this._url} in ${b}s`),this._reconnectionTimeout=setTimeout(A,b*1e3|0),this._onlineChangeHandler=()=>{console.log("attempting to reconnect due to connectivity change"),navigator.onLine&&(this._consecutiveFailedConnectionAttempts=0,A())},Yt.EventTarget_addEventListener1(window,"online",this._onlineChangeHandler)},g(),this._consecutiveFailedConnectionAttempts=this._consecutiveFailedConnectionAttempts+1}),this._socket=d,d.readyState()==oi.Socket_OPEN&&h(),c.forEach(f)}_decodeConcatenatedUncompressedMessages(e,t){let n=new this._sessionSchema.ByteBuffer(e);for(;n.length!==n._index;){let r=null;try{r=this._sessionSchema.decodeMessage(n)}catch(o){console.error(`decoding failed: '${o.message}'`);return}Zn.VERBOSE&&console.log(`got message of type '${r.type}'`),t(r)}}handleUncompressedMessage(e,t){this._decodeConcatenatedUncompressedMessages(e,n=>{switch(n.type){case"JOIN_START":case"JOIN_START_SKIP_RELOAD":{this._handleJoinStartOrJoinStartSkipReload(n,this._connectType);break}case"JOIN_END":{this._handleJoinEnd();break}case"SCENE_GRAPH_REPLY":{this._handleSceneGraphReply(n);break}case"NODE_CHANGES":throw new Error("handleUncompressedMessage cannot handle a NODE_CHANGES payload. Did you mean to process this message in C++ and call PrototypeApp::didReceiveNodeChanges instead?");case"USER_CHANGES":{this._userSyncing!=null&&this._userSyncing.handleUserChanges(n,this);break}case"SIGNAL":{this._handleSignal(n);break}case"NOTIFY_SHOULD_UPGRADE":{this._handleNotifyShouldUpgrade();break}case"CLIENT_BROADCAST":{this._handleClientBroadcast(n);break}}})}handleUncompressedSchema(e){try{this._sessionSchema=Dp.compileSchema(Dp.decodeBinarySchema(e))}catch(t){return console.error(`schema decoding failed: '${t.message}'; uncompressedBytes is ${e.length}`),!1}return!0}didReceiveNodeChanges(e,t){if(this._scene==null){console.warn("ignoring 'NODE_CHANGES' event without a scene");return}this._emitter.trigger("incrementalLoadingInfo",{type:"receiveNodeChanges",size:e}),this._partialSnapshotInfo.snapshotHash=null,t!==null&&t!=null&&(this._partialSnapshotInfo.reconnectSequenceNumber=new _e(t)),this._observers.forEach(n=>{n.handleNodeChanges()}),this._isJoined||(console.debug("server sent the full document (vs. incrementally loading)"),this.setNodeLoadedStatusesAndUpdate(null),this._finishLoadingIfNecessary())}_handleJoinStartOrJoinStartSkipReload(e,t){let n=0;if(e.type=="JOIN_START"?n=0:(n=1,console.debug("performing fast reconnect to skip scene reload")),t==0?this._setSceneLoadingPhase(0):t==1&&n!=1&&this._setSceneLoadingPhase(1),this._sessionID=e.sessionID,n!=1){let r=gt.createScene(this._sessionID,this._prototypeLibCppEnabledForPendingFile);this.setScene(r),r.setFileKey(this.fileKey()),this._appState.setScene(null)}else this._sendSignal("client-rendered","");this._observers.forEach(r=>{r.handleJoinStart(n,e.sessionID,e.fileVersion)})}_handleJoinEnd(){this._isJoined=!0,this._enableHeartbeatTimer(),this._cachedNextUserChange!=null&&(this._getOrCreateNextUserChange().recentClicks=[]),this._pendingSceneGraphQueriesOrNull!=null&&(this._sendSceneGraphQueries(this._pendingSceneGraphQueriesOrNull,1),this._pendingSceneGraphQueriesOrNull=null),this._observers.forEach(e=>{e.handleJoinEnd()}),this.handleStateChangeInitiated(new Hn(0,Po.ROOT_STABLE_PATH()))}_handleSceneGraphReply(e){this._lastSceneGraphQueryConcurrency=this._lastSceneGraphQueryConcurrency-1,wn.increment("[IFL] sceneGraphQueriesReceived",1),wn.trackNumber("[IFL] Total Loaded Nodes",e.sceneGraphQueries.length),this._emitter.trigger("incrementalLoadingInfo",{type:"receiveSceneGraphReply",queries:e.sceneGraphQueries.map(t=>br.toString(t))}),this._partialSnapshotInfo.fulfilledQueries=e.sceneGraphQueries,this.setNodeLoadedStatusesAndUpdate(e.sceneGraphQueries),this._observers.forEach(t=>{t.handleSceneGraphReply(this._lastSceneGraphQueryConcurrency,e.sceneGraphQueries)}),this.handleStateChangeInitiated(new Hn(0,Po.ROOT_STABLE_PATH()))}_handleSignal(e){if(e.signalName!==void 0&&e.signalPayload!==void 0&&e.signalName=="invalid-permissions"){console.warn("received 'invalid-permissions' message."),location.reload();return}if(e.signalName!==void 0&&e.signalPayload!==void 0&&e.signalName=="client-too-old"){console.warn("received 'client-too-old' message. refreshing!"),location.reload();return}if(e.signalName!==void 0&&e.signalPayload!==void 0&&e.signalName=="snapshot-hash"&&(this._partialSnapshotInfo.snapshotHash=e.signalPayload),e.signalName!==void 0&&e.signalPayload!==void 0&&e.signalName=="reconnect-sequence-number"&&(this._partialSnapshotInfo.reconnectSequenceNumber=new _e(parseInt(e.signalPayload))),e.signalName!==void 0&&e.signalName=="reconnect-immediately"&&(console.log("received 'reconnect-immediately' signal. reconnecting."),this.attemptReconnect()),e.signalName!==void 0&&e.signalPayload!==void 0&&e.signalName=="reconnect-key"&&(this._reconnectKey=e.signalPayload,console.debug(`server sent reconnect key ${this._reconnectKey}`)),e.signalName!==void 0&&e.signalName=="too-many-connections"){let t=rf.attemptToParseFrom(e.signalPayload!==void 0?e.signalPayload:"");t!=null&&(this._staticFileRequest=new Mr(t.url).format(1),this._staticFileRequest.get().then(n=>{this._observers.forEach(r=>{r.handleJoinStart(0,-1,-1)}),this._appState.serialization().decodeSceneForViewerAndPrototypeLib1(n.bytes,this._prototypeLibCppEnabledForPendingFile).then(r=>{r!=null?(this._scene=r,this.setNodeLoadedStatusesAndUpdate(null),this._observers.forEach(o=>{o.handleJoinEnd()}),this._finishLoadingIfNecessary()):Ve("Failed to parse scene")})})),console.warn("too many connections to multiplayer or example file, not reconnecting"),this._shouldReconnect=!1}}_handleNotifyShouldUpgrade(){console.warn("received NOTIFY_SHOULD_UPGRADE message. refreshing!"),location.reload()}_handleClientBroadcast(e){for(let t of e.broadcasts)t.prototypePresenter!=null&&(t.prototypePresenter.nomination!=null?this.updateNominatedPresenter(t.prototypePresenter.nomination,t.sessionID):(this.setPresenterSessionID(new _e(t.prototypePresenter.sessionID)),this._presenterSessionID!=null&&(this._sessionsNominatingCurrentUser.clear(),this._sessionNominatedByCurrentUser=null)));this._observers.forEach(t=>{t.handlePresenterChange()})}updateNominatedPresenter(e,t){e.isCancelled?(e.sessionID==this._sessionID&&(t==this._sessionID?this._sessionsNominatingCurrentUser.clear():this._sessionsNominatingCurrentUser.delete(t)),this._sessionNominatedByCurrentUser!=null&&this._sessionNominatedByCurrentUser.value==e.sessionID&&(this._sessionNominatedByCurrentUser=null)):(e.sessionID==this._sessionID&&this._sessionsNominatingCurrentUser.add(t),t==this._sessionID&&(this._sessionNominatedByCurrentUser=new _e(e.sessionID)))}disconnect(){if(this._isJoined=!1,this._socket!=null){try{this._socket.close()}catch{}this._socket=null}this._lastSceneGraphQueryConcurrency=0,clearTimeout(this._heartbeatTimeout),clearTimeout(this._reconnectionTimeout),this._isConnected&&(console.debug(`disconnected from ${this._url}`),this._isConnected=!1,this._observers.forEach(e=>{e.handleDisconnect()}))}_enableHeartbeatTimer(){if(2==0)return;let e=null,t=()=>{if(this._isWindowActive()){console.debug("sending heartbeat message");let n={};n.type="USER_CHANGES",n.userChanges=[],this._sendMessage(n)}e()};e=()=>{this._heartbeatTimeout=setTimeout(t,Zn.HEARTBEAT_DELAY)},e()}handleSceneChange(e,t){e!=null&&e.removeObserver(this),t!=null&&t.addObserver(this)}handleActiveCanvasChange(e,t){}handleActivePrototypeStartingPointChange(e,t){}handleSceneGraphEvent(e){e.property==98&&Ze.asString(e.newVal)=="CREATED"&&this._partialSnapshotInfo.fulfilledQueries!=null&&this._partialSnapshotInfo.fulfilledQueries.some(t=>br.fullyLoadsNode(t,e.node))&&e.node.setHasBeenLoaded(!0)}handleStateUpdate(e,t){this.pushAllInstanceStateChanges()}handleStateChangeAborted(e){e!=null&&(this.handleStateUpdate(e,"ABORTED"),this.handlePresentedStateChange(null,e.oldStateAndOverlays,null))}handleStateChangeCommitted(e,t){this.handleStateUpdate(e,"COMMITTED")}handleStateChangeInitiated(e){if(e==null||e.oldStateAndOverlays.stateId==null&&e.newStateAndOverlays.stateId==null)return;this.handleStateUpdate(e,"INITIATED");let t=this._getSynchronizableHotspotId_instanceHACK(e.interactionAddress.hotspotStablePath);this.handlePresentedStateChange(t,e.newStateAndOverlays,e.interactionAddress.interactionId)}handleStateChangeRequested(e){}_pushInstanceStateChange(e,t,n){let r=mt.encodeInstanceStateChange(t,n);r.hotspotStablePath==null&&(r.hotspotStablePath=mt.encodeGUIDPath(e)),this._getOrCreateNextUserChange().instanceStateChanges==null&&(this._getOrCreateNextUserChange().instanceStateChanges=[]),this._getOrCreateNextUserChange().instanceStateChanges.push(r)}handleHsmAborted(e,t){this._pushInstanceStateChange(e,t,"ABORTED")}handleHsmCommitted(e,t,n){this._pushInstanceStateChange(e,t,"COMMITTED")}handleHsmInitiated(e,t){this._pushInstanceStateChange(e,t,"INITIATED")}handleHsmRequested(e,t){}pushAllInstanceStateChanges(){let e=this._appState.prototypeState();e.getOnscreenStates().forEach(t=>{let n=e.getStateMachineLastChangeInHistory(t.a);this._pushInstanceStateChange(t.a,n,"INITIATED"),this._pushInstanceStateChange(t.a,n,"COMMITTED")})}onTransitionFrame(e){this._getOrCreateNextUserChange()}_getSynchronizableHotspotId_instanceHACK(e){var n,r;return(r=(n=this._appState.scene())==null?void 0:n.findNode3(e))==null?void 0:r.id()}_createTriggeredOverlaysDataForMultiplayer(e,t){let n=[];return t.overlays.forEach(r=>{let o=this._getSynchronizableHotspotId_instanceHACK(r.openingHotspotStablePath);n.push(mt.encodeOverlayData(r,o))}),n}_updateNextUserChangeForOverlay(e,t){this.observedUser()==null&&(this._getOrCreateNextUserChange().triggeredOverlaysData=this._createTriggeredOverlaysDataForMultiplayer(e,t))}handleVideoStateChange(e){this._getOrCreateNextUserChange().videoStateChangeData=e}pushAllVideoStateChanges(){this._getOrCreateNextUserChange().videoStateChangeData=this._appState.prototypeState().getVideoStateChanges()}handlePresentedStateChange(e,t,n){let r=this._previousTlfID,o=this._appState.baseScreenId();ee.equals(r,o)||(this._previousTlfID=o,this._getOrCreateNextUserChange().selection=[],o!=null&&this._getOrCreateNextUserChange().selection.push(ee.toFigGUID(o))),e!=null&&(this._getOrCreateNextUserChange().lastTriggeredHotspot=mt.encodeGUID(e)),n!=null&&(this._getOrCreateNextUserChange().lastTriggeredPrototypeInteractionID=mt.encodeGUID(n)),this._updateNextUserChangeForOverlay(e,t)}pushAllSetVariableActions(){this.handleSetVariableAction(this._appState.prototypeState()._setVariableActionHistory)}handleSetVariableAction(e){this._getOrCreateNextUserChange().triggeredSetVariableActionData=e}handleFitModeChange(e,t){}handleRestartPrototype(){}_getOrCreateNextUserChange(){return this._cachedNextUserChange==null&&(this._cachedNextUserChange={},this._cachedNextUserChange.sessionID=this._sessionID,this._cachedNextUserChange.instanceStateChanges=null),this._cachedNextUserChange}getParticles(){var e;return(e=this.observedUser())==null?void 0:e.remainingParticles()}getMouse(){var e;return(e=this.observedUser())==null?void 0:e.canvasSpaceMouse}getScrollPositions(){var e;return(e=this.observedUser())==null?void 0:e.scrollPositions}setCanvasSpaceMouse(e){let t=this._previousCanvasSpaceMouseLocation;if(e==null&&t==null||e!=null&&t!=null&&e.equals(t))return;this._previousCanvasSpaceMouseLocation=e==null?void 0:e.clone();let n={};e!=null?(n.x=e.x(),n.y=e.y()):(n.x=NaN,n.y=NaN);let r={};r.canvasSpaceLocation=n,r.cursor="DEFAULT",this._getOrCreateNextUserChange().mouse=r}recordCanvasSpaceClick(e){for(;this._canvasSpaceClicks.length>10;)this._canvasSpaceClicks.shift();let t={};t.x=e.x(),t.y=e.y();let n={};n.id=this._nextCanvasSpaceClickID=this._nextCanvasSpaceClickID+1,n.point=t,this._canvasSpaceClicks.push(n),this._getOrCreateNextUserChange().recentClicks=this._canvasSpaceClicks.slice()}setScrollPosition(e,t){for(ue.List_removeIf(this._recentlyChangedScrollPositions,n=>n.nodeId==e);this._recentlyChangedScrollPositions.length>this.maxScrollPositionsToStore;)this._recentlyChangedScrollPositions.shift();this._recentlyChangedScrollPositions.push(new Mp(e,t)),this._getOrCreateNextUserChange().scrollPositions=this._recentlyChangedScrollPositions.map(n=>{let r={};return r.node=mt.encodeGUID(ee.fromString(n.nodeId)),r.scrollOffset=mt.encodeVector2(n.offset),r})}maybeFlushNextUserChange(e){let t=ke.seconds();(this._lastFlush==-1||t-this._lastFlush>Zn.FLUSH_INTERVAL_SEC||e==1)&&(this._flushNextUserChange(),this._lastFlush=t)}_flushNextUserChange(){if(this._isJoined&&this._cachedNextUserChange!=null){let e={};e.type="USER_CHANGES",e.userChanges=[this._cachedNextUserChange],Zn.debugUserChanges&&console.log("flushNextUserChange",this._cachedNextUserChange),this._sendMessage(e),this._cachedNextUserChange=null}}_queriesAreEqual(e,t){let n=new Map;for(let o of e)n.set(br.hash(o),!0);let r=new Map;for(let o of t)r.set(br.hash(o),!0);if(n.size!=r.size)return!1;for(let o of Array.from(n.keys()))if(!r.has(o))return!1;return!0}setSceneGraphQueries(e){this._queriesAreEqual(e,this.currentSceneGraphQueries())||(this._isJoined?this._sendSceneGraphQueries(e,1):this._pendingSceneGraphQueriesOrNull=e)}_sendSceneGraphQueries(e,t){if(this._lastSceneGraphQueryConcurrency==0&&(this._lastSceneGraphQueryTime=ke.milliseconds()),this._lastSceneGraphQueryConcurrency=this._lastSceneGraphQueryConcurrency+1,e.length>0&&(this._lastSentSceneGraphQueriesOrNull=e,t==1)){let n={};n.type="SCENE_GRAPH_QUERY",n.sceneGraphQueries=e,wn.increment("[IFL] sceneGraphQueriesSent",1),this._emitter.trigger("incrementalLoadingInfo",{type:"sendSceneGraphQuery",queries:n.sceneGraphQueries.map(r=>br.toString(r))}),this._sendMessage(n)}}_sendSignal(e,t){let n={};n.type="SIGNAL",n.signalName=e,n.signalPayload=t,this._sendMessage(n)}nominatePresenter(e){let t=this.presenterClientBroadcastMessageWithNomination(e,!1);this._sendClientBroadcast(t)}cancelPresenterNomination(e){let t=this.presenterClientBroadcastMessageWithNomination(e,!0);this._sendClientBroadcast(t)}presenterClientBroadcastMessageWithNomination(e,t){let n={};n.type="CLIENT_BROADCAST";let r={};r.sessionID=this._sessionID;let o={},a={};return this._presenterSessionID!=null&&(o.sessionID=this._presenterSessionID.value),a.sessionID=e,a.isCancelled=t,o.nomination=a,r.prototypePresenter=o,n.broadcasts=[r],n}startPresenting(){let e=this.presenterClientBroadcastMessage(!0);this._sendClientBroadcast(e)}stopPresenting(){let e=this.presenterClientBroadcastMessage(!1);this._sendClientBroadcast(e)}setInteractiveSlideConfigData(e,t,n){if(t!="resultsShown"){console.error(`Could not set configData for ${e} to ${t}:${n}. Only allowed to set resultsShown from the viewer.`);return}let r={};r.type="NODE_CHANGES";let o={entries:[{key:t,value:n}]},a={guid:ee.toFigGUID(e),interactiveSlideConfigData:o};r.nodeChanges=[a],this._sendClientBroadcast(r)}setInteractiveSlideParticipantData(e,t,n){let r={};r.type="INTERACTIVE_SLIDE_CHANGE";let o={anonymousUserID:t,nodeID:ee.toFigGUID(e),responseData:n};r.interactiveSlideElementChange=o,this._sendClientBroadcast(r)}presenterClientBroadcastMessage(e){let t={};t.type="CLIENT_BROADCAST";let n={},r={};return e&&(r.sessionID=this._sessionID),n.prototypePresenter=r,t.broadcasts=[n],t}_sendClientBroadcast(e){this._socket!=null&&this._sendMessage(e)}_sendMessage(e){Y.getFeatureFlags().prototype_log_all_ws&&console.log(e),this._socket.send2(yi.deflateRaw(ye.schema.encodeMessage(e)))}};Zn.debugUserChanges=!1,Zn.VERBOSE=!1,Zn.SCHEMA_PREFIX="fig-wire\0\0\0",Zn.SCHEMA_PREFIX_BYTES=new Uint8Array([102,105,103,45,119,105,114,101,1,0,0,0]),Zn.RECONNECTION_DELAY_MIN=1,Zn.RECONNECTION_DELAY_MAX=128,Zn.FLUSH_INTERVAL_SEC=1/30,Zn.HEARTBEAT_DELAY=60*1e3;var ra=Zn,of=(t=>(t[t.NORMAL=0]="NORMAL",t[t.SKIP_RELOAD=1]="SKIP_RELOAD",t))(of||{}),kb=(t=>(t[t.SKIP=0]="SKIP",t[t.DO_NOT_SKIP=1]="DO_NOT_SKIP",t))(kb||{}),Fp=class{constructor(e,t,n){this.snapshotHash=null,this.reconnectSequenceNumber=null,this.fulfilledQueries=null,this.snapshotHash=e,this.reconnectSequenceNumber=t,this.fulfilledQueries=n}isValid(){return(this.snapshotHash!=null||this.reconnectSequenceNumber!=null)&&this.fulfilledQueries!=null}},xp=(t=>(t[t.INITIAL=0]="INITIAL",t[t.RECONNECT=1]="RECONNECT",t))(xp||{});var Qn;(t=>{function i(n,r){let o={};return o.startingNode=ee.toFigGUID(n),o.depth=r,o}t.create=i;function e(n){if(n==null)return"";let r="";for(let o of n)r+=br.serializeForMultiplayerURL(o),r+=",";return r.slice(0,r.length-1)}t.serializeListForMultiplayerURL=e})(Qn||(Qn={}));var Ts;(t=>{function i(n){return`${n.sessionID}:${n.localID}`}t.toString=i;function e(n,r){return n.sessionID==r.sessionID&&n.localID==r.localID}t.equals=e})(Ts||(Ts={}));var cd;(e=>{function i(t){return t.guid!==void 0?"VariableID:"+Ts.toString(t.guid):t.assetRef!==void 0&&t.assetRef.key!=null&&t.assetRef.version!=null?"VariableID:"+Bn.string_toString(t.assetRef.key)+"/"+Bn.string_toString(t.assetRef.version):""}e.toString=i})(cd||(cd={}));var br;(a=>{function i(s){let l=s.depth!==void 0?s.depth:-1;return`${n(s)}-${l}`}a.hash=i;function e(s,l){return i(s)==i(l)}a.equals=e;function t(s){return i(s)}a.toString=t;function n(s){let l=s.startingNode!==void 0?s.startingNode:null;return l!=null?`${l.sessionID}:${l.localID}`:"-1:-1"}a.nodeIdString=n;function r(s){let l=s.startingNode!==void 0?s.startingNode:null,d=l!=null?`${l.sessionID}:${l.localID}`:"-1:-1",c=s.depth!==void 0?s.depth:-1;return`${d}-${c}`}a.serializeForMultiplayerURL=r;function o(s,l){if((s.depth!==void 0?s.depth:-1)!=0)return!1;let c=s.startingNode!==void 0?s.startingNode:null;for(;l!=null;){if(Ts.equals(ee.toFigGUID(l.id()),c))return!0;l=l.parent()}return!1}a.fullyLoadsNode=o})(br||(br={}));var Lb;(e=>{function i(t){return Lp[t]}e.FlushThrottling_toString=i})(Lb||(Lb={}));var Mb;(e=>{function i(t){return of[t]}e.JoinKind_toString=i})(Mb||(Mb={}));var Bb;(e=>{function i(t){return kb[t]}e.ShouldSkipSendQueryMessage_toString=i})(Bb||(Bb={}));var Vb;(e=>{function i(t){return xp[t]}e.ConnectType_toString=i})(Vb||(Vb={}));var dd=class dd{age(){return un.Math_clamp1((ke.seconds()-this.startTimestamp)/dd.LIFETIME,0,1)}constructor(e,t,n){this.sessionID=e,this.canvasSpaceLocation=t,this.startTimestamp=n}};dd.LIFETIME=.25,dd.RADIUS=25;var Cl=dd,Mp=class{constructor(e,t){this.nodeId=e,this.offset=t}},af=class{remainingParticles(){let e=ke.seconds(),t=null;return this.particles!=null&&ue.List_removeIf(this.particles,n=>e-n.startTimestamp>Cl.LIFETIME?!0:(t==null&&(t=[]),t.push(n),!1)),t}toJSON(){return{sessionID:this.sessionID,userID:this.userID,name:this.name,color:this.color!=E.TRANSPARENT?E.toCSS(this.color):null,imageURL:this.imageURL,deviceName:this.deviceName,currentFrame:this.currentFrame!=null?this.currentFrame:null}}constructor(e){this.sessionID=e,this.userID=null,this.name=null,this.color=E.TRANSPARENT,this.imageURL=null,this.deviceName=null,this.currentFrame=null,this.canvasSpaceMouse=null,this.largestClickID=-1,this.particles=null,this.scrollPositions=new Map,this.observedSessions=[],this.lastTriggeredHotspot=null,this.lastTriggeredPrototypeInteractionID=null,this.triggeredOverlaysData=[],this.instanceStateChanges=[],this.triggeredSetVariableActionData=[],this.videoStateChangeData=[]}},ud=class{userBySessionID(){return this._userBySessionID}handleUserChanges(e,t){if(e.userChanges===void 0){console.error("decoded node change message with missing required field: 'userChanges'");return}let n=!1,r=0;for(let o of e.userChanges){if(o.sessionID===void 0){Ve("skipping user change message without sessionID");continue}r=o.sessionID;let a=ra.debugUserChanges&&t!=null&&r!=t.sessionID();o.connected!==void 0&&(o.connected?(this._userBySessionID.set(r,new af(r)),a&&console.log(`user sessionID ${r} connected`,this._userBySessionID.get(r).toJSON()),t!=null&&(t.pushAllInstanceStateChanges(),t.pushAllSetVariableActions(),t.pushAllVideoStateChanges())):(a&&this._userBySessionID.has(r)&&console.log(`user sessionID ${r} disconnected`,this._userBySessionID.get(r).toJSON()),t!=null&&t.removeNominator(r),this._userBySessionID.delete(r)),n=!0);let s=Ht.IntMap_get(this._userBySessionID,r,null);s!=null?(n=this._applyChangeToUser(o,s,a)||n,this._applyNullChecksToUserStrings(s)):a&&Ve("could not find existing user to apply user change message"),a&&console.log("recvUserChange",o,n)}n&&this.onChange!=null&&this.onChange(r)}_applyNullChecksToUserStrings(e){e.userID==null&&(e.userID=""),e.name==null&&(e.name=""),e.imageURL==null&&(e.imageURL="")}_applyChangeToUser(e,t,n){let r=!1,o=e.sessionID;if(e.color!==void 0&&(t.color=mt.decodeColor(e.color),r=!0),e.name!==void 0&&(t.name=e.name,r=!0),e.deviceName!==void 0&&(t.deviceName=e.deviceName,r=!0),e.imageURL!==void 0&&(t.imageURL=e.imageURL,r=!0),e.userID!==void 0&&(t.userID=e.userID,r=!0),e.observing!==void 0&&(t.observedSessions=e.observing,r=!0),e.selection!==void 0){let a=e.selection;t.currentFrame=a.length==1?mt.decodeGUID(a[0]):null,r=!0}if(e.mouse!==void 0){let a=e.mouse;if(a.canvasSpaceLocation!==void 0){let s=mt.decodeVector(a.canvasSpaceLocation);(t.canvasSpaceMouse==null||!t.canvasSpaceMouse.equals(s))&&(t.canvasSpaceMouse=s.equals(s)?s:null,this.onMouseCursorChange!=null&&this.onMouseCursorChange(o))}}if(e.recentClicks!==void 0)if(t.particles==null){t.particles=[];for(let a of e.recentClicks)a.id>t.largestClickID&&(t.largestClickID=a.id)}else for(let a of e.recentClicks)a.id>t.largestClickID&&(t.largestClickID=a.id,t.particles.push(new Cl(o,mt.decodeVector(a.point),ke.seconds())),this.onMouseCursorChange!=null&&this.onMouseCursorChange(o));if(e.scrollPositions!==void 0)for(let a of e.scrollPositions)t.scrollPositions.set(mt.decodeGUID_instanceHACK(a.node),mt.decodeVector(a.scrollOffset));return e.lastTriggeredHotspot!==void 0&&(t.lastTriggeredHotspot=mt.decodeGUID_instanceHACK(e.lastTriggeredHotspot),r=!0),e.lastTriggeredPrototypeInteractionID!==void 0&&(t.lastTriggeredPrototypeInteractionID=mt.decodeGUID(e.lastTriggeredPrototypeInteractionID),r=!0),e.triggeredOverlaysData!==void 0&&(t.triggeredOverlaysData=e.triggeredOverlaysData.slice(),r=!0),e.instanceStateChanges!==void 0&&(e.instanceStateChanges.forEach(a=>{t.instanceStateChanges.push(a)}),r=!0),e.triggeredSetVariableActionData!==void 0&&(t.triggeredSetVariableActionData=e.triggeredSetVariableActionData.slice(),r=!0),e.videoStateChangeData!==void 0&&(t.videoStateChangeData=e.videoStateChangeData.slice(),r=!0),n&&console.log("_applyChangeToUser",e,t.toJSON()),r}constructor(){this._sessionID=-1,this._userBySessionID=new Map,this.onChange=null,this.onMouseCursorChange=null}};var vs;(a=>{function i(){let s=null;try{s=localStorage}catch{return 1}let l=+s.getItem("cursorScaleFactor");return l||1}a._globalCursorScaleFactor=i;function e(s,l,d,c,p,u){let h=G.new2(),f=G.new2(),y=d.clone(),g=1/l;if(Y.isInlinePreview()&&y.expand1(3),f.copyFrom(c),f.expand1(g),f.left()<y.left()&&s.fillRect(h.setTo1(f.left(),f.top(),y.left()-f.left(),f.height()),p),y.right()<f.right()&&s.fillRect(h.setTo1(y.right(),f.top(),f.right()-y.right(),f.height()),p),f.top()<y.top()&&s.fillRect(h.setTo1(y.left()-g,f.top(),y.width()+2*g,y.top()-f.top()),p),y.bottom()<f.bottom()&&s.fillRect(h.setTo1(y.left()-g,y.bottom(),y.width()+2*g,f.bottom()-y.bottom()),p),u>0){y.expand1(g);let A=u*Math.cos(Math.PI/4);s.fillConvexPolygon([y.topLeft(),y.topLeft().add1(new I(A,0)),y.topLeft().add1(new I(0,A))],p),s.fillConvexPolygon([y.topRight(),y.topRight().add1(new I(0,A)),y.topRight().add1(new I(-A,0))],p),s.fillConvexPolygon([y.bottomRight(),y.bottomRight().add1(new I(-A,0)),y.bottomRight().add1(new I(0,-A))],p),s.fillConvexPolygon([y.bottomLeft(),y.bottomLeft().add1(new I(0,-A)),y.bottomLeft().add1(new I(A,0))],p)}}a.drawPreviewStencil=e;function t(s,l,d,c){for(let p of l){let u=I.new3(p.canvasSpaceLocation);if(!c.contains2(u))continue;let h=[],f=p.age(),y=f*Cl.RADIUS,g=Math.max(8,(y|0)*2);for(let A=0;A<g;A=A+1){let T=Math.PI*2*A/g;h.push(new I(u.x()+Math.cos(T)*y*d,u.y()+Math.sin(T)*y*d))}s.fillConvexPolygon(h,E.new3(.9,.9,.9,.5*(1-f)))}}a.drawParticles=t;function n(s,l,d){let c=l.x(),p=l.y(),u=i()/d,h=[],f=[];for(let b of a.cursorOutlineOuter)h.push(I.new2());for(let b of a.cursorOutlineInner)f.push(I.new2());let y=2,g=.5,A=(y+1)*(y+1)*(y+1)*(y+1),T=g/A;for(let b=-y,_=y+1;b<_;b=b+1)for(let m=-y,S=y+1;m<S;m=m+1){let C=(y+1-Math.abs(b))*(y+1-Math.abs(m))*T;if(!(C<1/255)){for(let N=0,x=a.cursorOutlineOuter.length;N<x;N=N+1){let z=a.cursorOutlineOuter[N],$=h[N];$.setX(c+(z.x()+b)*u),$.setY(p+(z.y()+m+1)*u)}s.fillConvexPolygon(h,E.new3(0,0,0,C))}}for(let b=0,_=a.cursorOutlineOuter.length;b<_;b=b+1){let m=a.cursorOutlineOuter[b],S=h[b];S.setX(c+m.x()*u),S.setY(p+m.y()*u)}s.fillConvexPolygon(h,E.WHITE);for(let b=0,_=a.cursorOutlineInner.length;b<_;b=b+1){let m=a.cursorOutlineInner[b],S=f[b];S.setX(c+m.x()*u),S.setY(p+m.y()*u)}s.fillConvexPolygon(f,E.BLACK)}a.drawMouseCursor=n,a.cursorOutlineOuter=[new I(14.933,9.027),new I(7.755,10.975),new I(3.57,17.299),new I(0,0)],a.cursorOutlineInner=[new I(12.416,8.674),new I(7.13,10.109),new I(4.063,14.742),new I(1.442,2.04)]})(vs||(vs={}));var sf=class{constructor(e,t){this.tree=null,this.bounds=null,this.hash=0,this.tree=e,this.bounds=t;let n=new so;n.hash1(t.x()),n.hash1(t.y()),n.hash1(t.width()),n.hash1(t.height()),this.hash=n.value(),Y.compositeTileGridEqualWithinBounds()?this._equalsImpl=(r,o)=>r.bounds.equals(o.bounds)?(Dt.didEncounterCTGEqualWithinBounds(),r.tree.equalsWithinBounds(o.tree,r.bounds)):!1:this._equalsImpl=(r,o)=>r.bounds.equals(o.bounds)?(Dt.didEncounterCTGEqualWithinBounds(),r.tree.equals(o.tree)):!1}equals(e){return this._equalsImpl(this,e)}},pd=class{constructor(e,t){this._tileAtlas=null,this._keyToTileHandle=null,this._keyToNeededImages=null,this._tileHandleToKey=null,this._resetMaps();let n=(r,o)=>{o.isValid=!1;let a=Be.StringMap_get(this._tileHandleToKey,r,null);a!=null&&(this._tileHandleToKey.delete(r),this._keyToTileHandle.remove(a),this._keyToNeededImages.remove(a))};this._tileAtlas=new yn(e,n)}_resetMaps(){this._keyToTileHandle=new Ei(e=>e.hash,(e,t)=>e.equals(t),e=>null),this._keyToNeededImages=new Ei(e=>e.hash,(e,t)=>e.equals(t),e=>null),this._tileHandleToKey=new Map}_allocateTileHandle(e){let t=this._tileAtlas.allocateTile();return this._tileHandleToKey.set(t,e),this._keyToTileHandle.set(e,t),t}getOrInsertOrNull(e,t){let n=Y.compositeTileGridEqualWithinBounds()?e:new Or(kn.solidColorRect(t,E.BLACK,1),e).optimized();if(n==null)return null;let r=new sf(n,t),o=new Bp(r,this);return o.tileHandleOrNull=this._keyToTileHandle.get(r,null),o.neededImagesOrNull=this._keyToNeededImages.get(r,null),o}setNeededImagesForTile(e,t){this._keyToNeededImages.set(e.key,t),e.neededImagesOrNull=t}maximumCapacity(){return this._tileAtlas.maximumCapacity()}tilesPerAtlasTexture(){return this._tileAtlas.tilesPerTexture()}prepareForNewFrame(){this._tileAtlas.prepareForNewFrame()}totalVRAM(){return this._tileAtlas.totalVRAM()}hasValidRenderedContent(e){return e.tileHandleOrNull!=null&&this._tileAtlas.tileIsStillValid(e.tileHandleOrNull)}prepareToRenderTo(e,t){return this.hasValidRenderedContent(e)||(e.tileHandleOrNull=this._allocateTileHandle(e.key)),this._tileAtlas.viewportForTile(e.tileHandleOrNull,t),this._tileAtlas.framebufferForTile(e.tileHandleOrNull)}textureRegionOrNull(e){if(!this.hasValidRenderedContent(e))return null;let t=G.new2();this._tileAtlas.viewportForTile(e.tileHandleOrNull,t);let n=this._tileAtlas.framebufferForTile(e.tileHandleOrNull).colorTexture();return new w.TextureRegion(n,t.scaledBy1(1/n.width()))}clear(){this._tileAtlas.clearCache(),this._resetMaps()}};var oa=class oa{constructor(e,t,n){this._context=null,this._compositeTileCache=null,this._renderer=null,this._boundsCache=Ba._new(),this._backbuffer=null,this._prepareForEfficientCompositingMemoized=null,this._context=e,this._compositeTileCache=t,this._renderer=n,this._prepareForEfficientCompositingMemoized=kg(r=>{let o=this._prepareForEfficientCompositing(r);return oa._VERBOSE_LOGS&&(console.log("Before Preparation for Rasterization"),console.log("--------------"),console.log(r.debugString1()),console.log(""),console.log("After Preparation for Rasterization"),console.log("--------------"),console.log(o.debugString1())),o})}beginFrameAndCreateBudget(){this._compositeTileCache.prepareForNewFrame(),Ba.clear(this._boundsCache),this._context.resetNumFramebufferSwitches();let e=.016,t=2,n=250,r=this._compositeTileCache.maximumCapacity();return r>=1e3&&(oa._alreadyLoggedTooManyTiles||(Pe.trackEvent("viewer_prototype_too_many_tiles",{numTiles:r}),oa._alreadyLoggedTooManyTiles=!0)),new oa.FrameBudget(this._context,e,t,r,n)}prepareForEfficientCompositing(e){return this._prepareForEfficientCompositingMemoized(e)}_prepareForEfficientCompositing(e){if(e!=null&&e.isAxisAlignedRectFill()){let t=e;if(Ne.onlySolidPaintOrNull(t.geometry.paints)!=null)return e}if(e.canCacheRasterized())return new Vp(e,this._compositeTileCache);switch(e.op()){case 0:{let t=e;return new xa(this._prepareForEfficientCompositing(t.child),t.flags)}case 2:{let t=e;return new Yo(this._prepareForEfficientCompositing(t.child))}case 1:{let t=e,n=[],r=[];for(let o of t.children)if(o.canCacheRasterized())r.push(o);else{if(r.length!=0){let a=ze.wrap(r);n.push(this._prepareForEfficientCompositing(a)),r=[]}n.push(this._prepareForEfficientCompositing(o))}if(r.length!=0){let o=ze.wrap(r);n.push(this._prepareForEfficientCompositing(o))}return ze.wrap(n)}case 5:{let t=e;return new Or(this._prepareForEfficientCompositing(t.alpha),this._prepareForEfficientCompositing(t.color),t.type,t.innerShadowFill,t.innerShadowAlphaRequiresHardMask)}case 6:{let t=e;return t.radius>=1?t:new Jr(t.radius,this._prepareForEfficientCompositing(t.child),t.clamp)}case 7:{let t=e;return new jr(t.blendMode,t.opacity,this._prepareForEfficientCompositing(t.child))}case 9:{let t=e;return new go(this._prepareForEfficientCompositing(t.alpha),t.color)}case 10:{let t=e;return new at(this._prepareForEfficientCompositing(t.child),t.id,t.property,t.getter)}case 11:{let t=e;return new wr(this._prepareForEfficientCompositing(t.child),t.transform)}case 12:{let t=e;return new dr(this._prepareForEfficientCompositing(t.startChild),this._prepareForEfficientCompositing(t.endChild),t.id,t.progressFn)}case 3:case 4:{if(e.hasAnimatingMedia()||e.hasVolatileContent()&&e.op()!=8)return e;throw new Error(`Unexpectedly received ${Sr[e.op()]} node`)}case 8:throw new Error(`Unexpectedly received ${Sr[e.op()]} node`);default:throw new Error(`Node type ${Sr[e.op()]} is unhandled`)}}getPrioritizedListOfTilesToPopulate(e,t,n,r){let o=[ne.new2()],a=[ne.new2()],s=[1],l=[],d=p=>{switch(p.op()){case 10:{let u=p;switch(u.property){case 2:{let h=ne.new3(ue.List_last(o));h.multipliedBy1(u.transform()),o.push(h);let f=ne.new3(u.transform());f.invert()||f.copyFrom(vt.FrozenAffineTransform_IDENTITY),f.multipliedBy1(ue.List_last(a)),a.push(f);break}case 0:{let h=ne.new3(ue.List_last(o));h.multipliedBy1(ue.List_last(a)),o.push(h);let f=ne.new2();a.push(f);break}case 1:{a.push(ne.new2());break}case 3:{s.push(u.maxTransformScale());break}}break}case 11:{let u=p,h=ne.new3(ue.List_last(o));h.multipliedBy1(u.transform),o.push(h);let f=ne.new3(u.transform);f.invert()||f.copyFrom(vt.FrozenAffineTransform_IDENTITY),f.multipliedBy1(ue.List_last(a)),a.push(f);break}case 8:{let u=p,h=ue.List_last(o),f=ne.new3(h);f.invert();let y=G.new3(n);f.transformRect(y);let g=G.new3(t);f.transformRect(g);let A=e*ue.List_last(s);for(let T=0;T<10;T=T+1){u.setDevicePixelPerCanvasPixel(A);let b=u.numTilesNeededForBounds(g),_=this._compositeTileCache.tilesPerAtlasTexture();if(b>_){A/=2;continue}break}u.forEachTileWithinBounds(0,y,T=>{let _=T.bounds().distanceTo(g)*h.scale1().max1();l.push(new oa.TileWithPriority(T,_))});break}}},c=p=>{switch(p.op()){case 10:{let u=p.property;(u==2||u==0||u==1)&&ue.List_removeLast(a),(u==2||u==0)&&ue.List_removeLast(o),u==3&&ue.List_removeLast(s);break}case 11:{ue.List_removeLast(a),ue.List_removeLast(o);break}}};return Dt.didEncounterCullTreesDuringTilePrioritization(),Y.cullTreesDuringTilePrioritization()?Nn.visitEachNodeInTree(r,d,c,n,this._boundsCache):Nn.visitEachNodeInTree(r,d,c),l.sort((p,u)=>p.canvasSpaceDistanceToViewport<u.canvasSpaceDistanceToViewport?-1:1),l}ensureTileIsPopulated(e,t,n){if(t.recordTileCacheSlotWasUsed(),this._compositeTileCache.hasValidRenderedContent(e))return 1;let r=G.new2(),o=this._compositeTileCache.prepareToRenderTo(e,r),a=!1,s=E.TRANSPARENT,l=!0,d=!0,c=new Ri.Options(e.key.tree,a,s,l,this._boundsCache,n,!1,d,!0,!1),p=this._renderer.drawTile(r,e.canvasSpaceBounds().x(),e.canvasSpaceBounds().y(),e.canvasSpaceBounds().width(),o,c);return t.recordTileWasRendered(),this._compositeTileCache.setNeededImagesForTile(e,p.neededImagesOrNull),0}drawToScreen(e,t,n,r,o,a){this._context.annotate("Composite",()=>{let s=po.new2();s.copyFrom(t);let l=s.invert();if(this._backbuffer==null||this._backbuffer.colorTexture().width()!=(n.size().x()|0)||this._backbuffer.colorTexture().height()!=(n.size().y()|0)){this._backbuffer!=null&&this._backbuffer.deleteTexture();let v=w.in_Context.Context_createTexture1(this._context,w.TextureFormat.RGBA_LINEAR_CLAMP,n.size().x()|0,n.size().y()|0,"Compositor Backbuffer"),C=w.in_Context.Context_createTexture1(this._context,w.TextureFormat.STENCIL,n.size().x()|0,n.size().y()|0,"Compositor Backbuffer");this._backbuffer=this._context.createFramebuffer(v,C,"Compositor Backbuffer")}let d=this._context.currentFramebuffer();this._context.setFramebuffer(this._backbuffer),w.in_Context.Context_clear1(this._context,w.Clear.ALL),this._context.setFramebuffer(d),Dt.didEncounterLargeTilesForDrawToScreen();let c=Y.viewerLargeTilesDrawToScreen(),p=c?Ab():yn.TILE_SIZE,u=new G(0,0,p,p),h=G.new2();Y.internalDebugTools()&&(e=this._renderer.treeToRender(e));let f=!1,y=E.TRANSPARENT,g=!1,A=!0,T=!0,b=new Ri.Options(e,f,y,g,this._boundsCache,a,A,T,!1,c);for(let v=n.left();v<=n.right();v+=p)for(let C=n.top();C<=n.bottom();C+=p)u.setX(v),u.setY(C),h.copyFrom(u),s.transformRect(h),u.translate2(n.topLeft().negative()),this._renderer.drawTile(u,h.x(),h.y(),h.width(),this._backbuffer,b);Y.internalDebugTools()&&this._renderer.finishLayerByLayerDrawToScreen();let _=ne.new2();_.translate2(-1,1),_.scale4(2/r.width(),-2/r.height());let m=G.new2();m.copyFrom(n),m.transformBy1(_),m.setY(m.y()+m.height()),m.setHeight(-m.height()),this._context.setFramebuffer(null),this._context.setViewport(r.left()|0,r.top()|0,r.width()|0,r.height()|0),this._context.clear2(w.Clear.ALL,o);let S=G.UNIT;this._renderer.drawTextureToCurrentFramebuffer(this._backbuffer.colorTexture(),S,null,m,vt.FrozenAffineTransform_IDENTITY,1,1),this._renderer.context().endFrame()})}};oa._VERBOSE_LOGS=!1,oa._alreadyLoggedTooManyTiles=!1;var Is=oa;(t=>{class i{overlapsViewport(){return this.canvasSpaceDistanceToViewport==0}constructor(r,o){this.node=r,this.canvasSpaceDistanceToViewport=o}}t.TileWithPriority=i;class e{constructor(r,o,a,s,l){this._context=r,this._renderingDeadline=0,this._tileRenderingBudgetRemaining=0,this._tileCacheCapacityRemaining=0,this._overrideFrameBudget=!1,this._renderingDeadline=ke.seconds()+o,this._tileRenderingBudgetRemaining=a,this._tileCacheCapacityRemaining=s,this._framebufferSwitchBudget=l}recordTileWasRendered(){this._tileRenderingBudgetRemaining=this._tileRenderingBudgetRemaining-1}recordTileCacheSlotWasUsed(){this._tileCacheCapacityRemaining=this._tileCacheCapacityRemaining-1}tileCacheCapacityRemaining(){return this._tileCacheCapacityRemaining}permitsMoreWork(){return this._overrideFrameBudget?!0:!(ke.seconds()>=this._renderingDeadline||this._tileRenderingBudgetRemaining<=0||this._tileCacheCapacityRemaining<=0||this._framebufferSwitchBudget-this._context.getNumFramebufferSwitches()<=0&&(Dt.didEncounterFramebufferSwitchBudget(),Y.enableFramebufferSwitchBudget()))}permitWorkAfterBudgetExceeded(){this._overrideFrameBudget=!0}forbidWorkAfterBudgetExceeded(){this._overrideFrameBudget=!1}}t.FrameBudget=e})(Is||(Is={}));var It;(T=>{function i(b){return`SCROLL_OFFSET::${b}`}T.forScrollOffset=i;function e(b){return`OVERLAY_POSITION::${b}`}T.forOverlayPosition=e;function t(b){return`ANIMATEABLE_TRANSLATION::${b}`}T.forAnimateableTranslation=t;function n(b){return`SHADOW_TRANSFORMATION::${b}`}T.forShadowTransformation=n;function r(b){return`ANIMATEABLE_OPACITY::${b}`}T.forAnimateableOpacity=r;function o(b){return`ANIMATEABLE_DISSOLVE::${b}`}T.forAnimateableDissolve=o;function a(b){return`DYNAMIC_GEOMETRY::${b}`}T.forDynamicGeometry=a;function s(b){return b.id.startsWith("SCROLL_OFFSET")}T.isScrollingTransform=s,T.ENTERING_TLF="ENTERING_TLF",T.EXITING_TLF="EXITING_TLF",T.ENTERING_OVERLAY="ENTERING_OVERLAY",T.EXITING_OVERLAY="EXITING_OVERLAY",T.ENTERING_OVERLAY_BACKGROUND="ENTERING_OVERLAY_BACKGROUND",T.EXITING_OVERLAY_BACKGROUND="EXITING_OVERLAY_BACKGROUND",T.OVERLAY_BACKGROUND="OVERLAY_BACKGROUND",T.SMART_ANIMATE_OVERLAY_TRANSLATION="SMART_ANIMATE_OVERLAY_TRANSLATION",T.OVERLAY_BACKGROUND_DISSOLVE="OVERLAY_BACKGROUND_DISSOLVE",T.DISSOLVE_TRANSITION="DISSOLVE_TRANSITION"})(It||(It={}));var kp=class{toggleRenderTreePrinting(){}addObserver(e){}removeObserver(e){}setBackgroundEnabled(e){}internalInitPerfTracking(){}isRenderingDone(){return!0}getContext(){return null}graphicsCardName(){return""}setNeedsBlit(e){}checkNeedsBlit(){return!1}deviceRenderer(){return null}changeFitMode(e){}setZoomScale(e){}updateScroll(e){}handleSceneChange(e,t){}handleActiveCanvasChange(e,t){}handleActivePrototypeStartingPointChange(e,t){}resize(e,t,n,r){return new w.ComputedCanvasSize(new I(0,0),!1)}drawBlank(){}draw(e,t,n,r){return 1}clearTileCaches(){}getAggregateTransitionStats(){return new Map}triggerTransition(e,t,n){}handleAbortedTransition(e){}handleCommittedTransition(e){}triggerHsmTransition(e,t,n){}abortHsmTransition(e,t){}commitHsmTransition(e,t){}isTopLevelTransitionOngoing(){return!1}easedTransitionProgress(){return 1}currentCanvasSpacePreviewBounds(){return new G(0,0,0,0)}currentCanvasSpaceFrameBounds(){return new G(0,0,0,0)}canvasSpacePreviewBoundsForTransition(e,t){return new G(0,0,0,0)}canvasSpaceFrameBoundsForTransition(e,t){return new G(0,0,0,0)}ongoingPrototypeStateChange(){return null}transitionProgressTracker(){return null}renderLayerByLayerActivate(e){}renderLayerByLayerDeactivate(){}renderLayerByLayerPlay(){}renderLayerByLayerPause(){}renderLayerByLayerForward(){}renderLayerByLayerBackward(){}renderLayerByLayerRewind(){}renderLayerByLayerIncreaseSpeed(){}renderLayerByLayerDecreaseSpeed(){}attachTo(e){}removeFrom(e){}},zr=class zr{toggleRenderTreePrinting(){this._printRenderTree=!this._printRenderTree,this._printRenderTree&&this._activeRenderTree!=null&&console.log(this._activeRenderTree.debugString1())}_currentBaseScreenId(){var e;return(e=this._appState.prototypeState().getCurrentBaseScreenNode())==null?void 0:e.id()}_currentOverlayData(){return this._appState.prototypeState().getCurrentOverlayData()}addObserver(e){this._observers.add(e)}removeObserver(e){this._observers.remove(e)}setBackgroundEnabled(e){}constructor(e,t,n){this._context=null,this._bufferPool=null,this._compositeTileCache=null,this._compositor=null,this._renderer=null,this._viewport=null,this._dirtinessTracker=null,this._appState=null,this._hotspotRenderer=null,this._smoothPath=null,this._deviceRenderer=null,this._prerenderViewport=new $o,this._devicePixelRatio=0,this._needsBlit=!0,this._isAnimatedMediaPlaying=!1,this._printRenderTree=!1,this._activeRenderTree=null,this._overlayBaseScreenId=null,this._generatedOverlays=new Map,this._debouncedDevicePixelsPerCanvasPixel=null,this._didRasterizeContentOnLastDraw=!0,this._observers=new Xn,this._blittingDueToScroll=!1,this._requestImageOnScreen=null,this._requestImageForPrerendering=null,this.PORTION_TO_LOG=50/100,this.MAX_TRANSITION_LOGS=50,this._numTransitionsLogged=0,this._transitionStats=new Map,this._transitionWasInterruptedByVisibilityChange=!1,this._visibilityListener=null,this.HEADERS=["frame_count","transition_count","mean_frame_ms","median_transition_mean","median_transition_max","count_0_to_20ms","count_20_to_40ms","count_40_to_80ms","count_80_to_160ms","count_160_to_320ms","count_320_to_640ms","count_640_ms_or_higher"],this._ongoingTransition=null,this._drewFirstFrameOfTransition=!0,this._transitionProgressTracker=new Hr,this._hsmTransitionMap=new Map,this._consolidatedRenderTreeForMagicMove=null,this._renderTreeForMagicMoveBaseScreen=null,this._renderTreeForMagicMoveOverlay=null,this._context=this._createContext(),this._bufferPool=new w.BufferPool(this._context),this._compositeTileCache=new pd(this._context,this._bufferPool),this._renderer=new Ri(this._context,this._bufferPool),this._compositor=new Is(this._context,this._compositeTileCache,this._renderer),this._viewport=e,this._appState=t,this._appState.addAppObserver(this),this._renderer.context().addContextResetHandler(()=>{this._deviceRenderer.clearOnContextReset(),this._viewport.invalidate(),(Je.isMobile(Je.current())||Je.current()==4&&navigator.maxTouchPoints>0||Rt.forceMobileOptimizations())&&n.clearQueuesAndDecodedDataForAllImages(this._canvas())}),n.onImageLoaded=o=>{o.invalidateRenderTreeForSelfAndParents(),this._dirtinessTracker.handleImageLoaded(o),this._viewport.invalidate()};let r=o=>{this._onBoundsInvalidate(o)};this._dirtinessTracker=new Hc(r),this._smoothPath=new w.SmoothPath(this._context,this._bufferPool),this._deviceRenderer=new tp(this._context,this._bufferPool),this._hotspotRenderer=new ap(this._context,this._bufferPool),this._debouncedDevicePixelsPerCanvasPixel=new Uc(o=>{t.addFrameObserver(o)},2,(o,a)=>o==a,()=>{this.setNeedsBlit(!0)}),this._initMagicMoveRenderTreeCache(),this._requestImageOnScreen=(o,a)=>{let s=yr.forOnScreenPurpose(a);n.requestImageForRendering(o,s)},this._requestImageForPrerendering=(o,a)=>{let s=yr.forPrerenderPurpose(a);n.requestImageForRendering(o,s)},console.debug(`Graphics card: '${this._context.graphicsCardName()}'`),zr.PERF_TRACKING&&(this._initTransitionStats(),window.getTransitionStats=o=>this._formatStatsForGoogleSheets(this.getAggregateTransitionStats(),o??!1))}_uninitialize(){this._debouncedDevicePixelsPerCanvasPixel.unregister(e=>{this._appState.removeFrameObserver(e)}),this._appState.removeAppObserver(this)}internalInitPerfTracking(){3==0&&(zr.PERF_TRACKING=!0,this._initTransitionStats())}isRenderingDone(){return!this._didRasterizeContentOnLastDraw}getContext(){return this._context}graphicsCardName(){return this._context.graphicsCardName()}setNeedsBlit(e){e||(this._blittingDueToScroll=!1),this._needsBlit=e,this._observers.forEach(t=>{t.handleSetNeedsBlit(e)})}checkNeedsBlit(){return this.setNeedsBlit(this._needsBlit||this._viewport.isInvalid()||this.isTopLevelTransitionOngoing()||this._animatedMediaPlaying()||this._hsmTransitionMap.size>0),this._needsBlit||Hi.hasUnexpectedCompositingBug()}deviceRenderer(){return this._deviceRenderer}changeFitMode(e){this._viewport.invalidate()}setZoomScale(e){}updateScroll(e){this._blittingDueToScroll=!0,this.setNeedsBlit(!0)}handleSceneChange(e,t){this._debouncedDevicePixelsPerCanvasPixel.clear()}handleActiveCanvasChange(e,t){this._renderer.setCanvas(t),e!=null&&e.scene().removeObserver(this._dirtinessTracker),t!=null&&t.scene().addObserver(this._dirtinessTracker),this._dirtinessTracker.initCanvas(t)}handleActivePrototypeStartingPointChange(e,t){}resize(e,t,n,r){let a=new I(e,t).multiply(r),s=this._context.resize(Math.round(a.x())|0,Math.round(a.y())|0);return this._devicePixelRatio=r,this.setZoomScale(n),this._debouncedDevicePixelsPerCanvasPixel.clear(),new w.ComputedCanvasSize(s.canvasSize.divide(r),s.webGLDidAdjustCanvasSize)}drawBlank(){this._context.annotate("Draw blank",()=>{Y.isInlinePreview()&&this._ongoingTransition!=null&&this._onBeforeFrameForTransition(),this._renderer.context().beginFrame(),w.in_Context.Context_clear1(this._renderer.context(),w.Clear.ALL),this._renderer.context().endFrame()})}_renderTreeToDraw(e){if(this.isTopLevelTransitionOngoing())return this._renderTreeForTransition(e);{let t=this._appState.prototypeState().getCurrentBaseScreenNode(),n=this._appState.prototypeState().bindOverlays(this._currentOverlayData());return Pe.appTimerStart("invalidateDirtyTiles"),this._dirtinessTracker.invalidateDirtyTiles(this._canvas(),new _o(this._canvas(),this._hsmTransitionMap,new ta(this._generatedOverlays))),Pe.appTimerStop("invalidateDirtyTiles"),this._generatedOverlays=new Map,this._renderTreeForBaseScreenAndOverlays(t,n)}}_renderTreeForBaseScreenAndOverlays(e,t){if(e==null)return null;let n=Re.renderTreeForBaseScreenWithPerfLogging(e,new _o(e,this._hsmTransitionMap,null),"_renderTreeForBaseScreenAndOverlays");return n==null?null:at.forTransformIsolation(ze.wrap([this._compositor.prepareForEfficientCompositing(n),this._renderTreeForOverlays(e,t)]).optimized())}_renderTreeForOverlays(e,t){let n=[],r=new ta;for(let o=0,a=t.length;o<a;o=o+1){let s=Re.renderTreeForOverlayBackground(t[o].backgroundAppearance(),e.canvasSpaceBoundingBox());s!=null&&n.push(s);let l=this._renderTreeForOverlay1(t[o],e,o,r,null);l!=null&&n.push(l)}return ze.wrap(n)}_renderTreeForOverlay1(e,t,n,r,o){return this._renderTreeForOverlay2(e,t,n,null,r,o)}_renderTreeForOverlay2(e,t,n,r,o,a){if(t==null)return null;let s=e.node();if(s==null)return null;let l=e.renderedBounds(t),d=s.canvasSpaceBoundingBox(),c=l.center().subtract1(d.center());this._overlayBaseScreenId!=null&&t.id()!=this._overlayBaseScreenId&&(s.invalidateRenderTreeForSelfAndParents(),s.invalidateRenderTreeForChildren()),this._overlayBaseScreenId=t.id();let p=new jt(t,null),u=new fl(e.id(),e.node(),l,p,e.backgroundAppearance(),r,()=>c,a);o.addEntry(e.id(),u),this._generatedOverlays.set(e.id(),u);let h=Re.renderTreeForOverlayWithPerfLogging(s,new _o(s,this._hsmTransitionMap,o),"_renderTreeForOverlay");if(h==null)return null;let f=this._compositor.prepareForEfficientCompositing(h);return f=at.forTranslation(f,It.forOverlayPosition(n),()=>c),f}_animatedMediaPlaying(){return this._isAnimatedMediaPlaying}_setAnimatedMediaPlaying(e){this._isAnimatedMediaPlaying=e}draw(e,t,n,r){var o;return this._didRasterizeContentOnLastDraw=!1,this._renderer.context().isContextLost()?1:((o=this._canvas())==null?void 0:o.scene())==null?1:this._currentTlf()==null?1:n.viewSpaceBounds().isEmpty()?1:this._context.annotateAndReturn("draw",()=>{var T,b,_,m;let a=this._compositor.beginFrameAndCreateBudget(),s=a.tileCacheCapacityRemaining();this._renderer.context().beginFrame();let l=this._ongoingTransition!=null,d=this.isTopLevelTransitionOngoing();l&&this._onBeforeFrameForTransition(),this._onBeforeFrameForHsm();let c=this._renderTreeToDraw(n);this._activeRenderTree=c,c!=null&&this._setAnimatedMediaPlaying(c.hasAnimatingMedia()),this._debouncedDevicePixelsPerCanvasPixel.queueValue(n.zoomScale()*this._devicePixelRatio);let p=this._debouncedDevicePixelsPerCanvasPixel.hasQueuedValue()&&!(d&&!this._drewFirstFrameOfTransition);this._drewFirstFrameOfTransition=!0;let u=[],h=0,f=G.new2();n.computeCanvasSpaceBounds1(f);let y=this.currentCanvasSpacePreviewBounds();if(y==null)return Pe.trackEvent("prototype_null_canvas_space_preview_bounds",{currentTlfID:((T=this._currentTlf())==null?void 0:T.id)??"null",baseScreenNodeID:((b=this._appState.baseScreenNode())==null?void 0:b.id)??"null",sceneNull:((_=this._canvas())==null?void 0:_.scene())==null,transitionOngoing:this._ongoingTransition!=null}),1;let g=this.currentCanvasSpaceFrameBounds()!=null?this.currentCanvasSpaceFrameBounds().topLeft():new I(0,0);y.intersectWith(f);let A=!1;if(Pe.appTimerStart("drawOnScreenTiles"),this._context.annotate("On-screen tiles",()=>{if(!p){let S=G.new3(y);S.expandedBy1(y.height()),u=this._compositor.getPrioritizedListOfTilesToPopulate(this._debouncedDevicePixelsPerCanvasPixel.getValue(),y,S,c);let v=Y.respectRenderBudgetOnScroll()&&this._blittingDueToScroll;for(v||a.permitWorkAfterBudgetExceeded();h<u.length;){let C=u[h];if(!C.overlapsViewport())break;if(v&&!a.permitsMoreWork()){A=!0;break}let N=this._compositor.ensureTileIsPopulated(C.node,a,this._requestImageOnScreen);N==0&&(this._didRasterizeContentOnLastDraw=!0),N==0&&zr.VERBOSE_LOGS&&console.log(`ProtoRenderManager: Rendered tile for current frame INSIDE of viewport. Capacity left: ${a.tileCacheCapacityRemaining()} / ${s}`),h=h+1}v||a.forbidWorkAfterBudgetExceeded()}}),Pe.appTimerStop("drawOnScreenTiles"),Pe.appTimerStart("drawToScreen"),this._needsBlit){this._printRenderTree&&console.log(c.debugString1());let S=G.new2(),v=0,C=(m=this._canvas())==null?void 0:m.prototypeDevice();C!=null&&C.type=="PRESET"?(S.setTo2(g,C.size()),v=E.BLACK):(S.copyFrom(y),v=r.backgroundColor);let N=po.new2().scaledBy(this._devicePixelRatio).multipliedBy(n.canvasSpaceToViewSpace1());N.transformRect(S),S.round();let x=n.viewSpaceBounds(),z=new G(x.left()*this._devicePixelRatio,x.top()*this._devicePixelRatio,x.width()*this._devicePixelRatio,x.height()*this._devicePixelRatio).rounded();this._compositor.drawToScreen(c,N,S,z,v,this._requestImageOnScreen),this._drawUI(n,r),this.setNeedsBlit(!1)}return Pe.appTimerStop("drawToScreen"),Pe.appTimerStart("drawOffScreenTiles"),this._context.annotate("Off-screen tiles",()=>{if(!p){for(;a.permitsMoreWork()&&h<u.length;){let S=this._compositor.ensureTileIsPopulated(u[h].node,a,this._requestImageForPrerendering);S==0&&(this._didRasterizeContentOnLastDraw=!0),S==0&&zr.VERBOSE_LOGS&&console.log(`ProtoRenderManager: Rendered tile for current frame OUTSIDE of viewport. Capacity left: ${a.tileCacheCapacityRemaining()} / ${s}`),h=h+1}if(t){let S=this._appState.prototypeState().bindOverlays(this._currentOverlayData()),v=null,C=this._appState.baseScreenNode().canvasSpaceBoundingBox().topLeft();for(let N of this._appState.prototypeStructure().getPrerenderingJobs(()=>a.permitsMoreWork())){let x=null,z=null,$=null,q=null,K=N.asScreen(),F=N.asSmartAnimate();if(K!=null){if(K.role==Ln.FrameRole.BASE_SCREEN&&ee.equals(K.nodeId,this._currentBaseScreenId())||($=this._canvas().scene().findNode1(K.nodeId),$==null||!$.hasBeenLoaded()))continue;if(!a.permitsMoreWork())break;let Q=null;if(K.role==Ln.FrameRole.OVERLAY){let M=Jn.fromPrototypeAction(K.prototypeAction,0);Q=Xc.BoundOverlay_computeNewBounds($,this._appState.baseScreenNode(),M,C,$.overlayPositionType()),C=Q.topLeft();let te=new jt(this._appState.baseScreenNode(),null),J=new fl($.id(),$,Q,te,$.overlayBackgroundAppearance(),null,()=>$.canvasSpaceBoundingBox().topLeft().negative().add1(C),null);this._generatedOverlays.set($.id(),J),v==null&&(v=new ta),v.addEntry($.id(),J),x==null&&K.precedingOverlays!=null&&(x=new ta)}if(K.role==Ln.FrameRole.OVERLAY&&S.some(M=>ee.equals(K.nodeId,M.id())))continue;if(q=this.canvasSpacePreviewBoundsForTransition($,$),x!=null){let M=!1;for(let te of K.precedingOverlays){let J=v.get2(te);if(J==null){M=!0;break}x.addEntry(te,J)}if(M)break}let X=new _o($,this._hsmTransitionMap,x);z=K.role==Ln.FrameRole.BASE_SCREEN?Re.renderTreeForBaseScreenWithPerfLogging($,X,"_draw"):Re.renderTreeForOverlayWithPerfLogging($,X,"_draw")}else if(F!=null){let Q=this._canvas().scene().findNode1(F.srcNodeId),X=this._canvas().scene().findNode1(F.dstNodeId);if(Q==null||X==null||!Q.hasBeenLoaded()||!X.hasBeenLoaded())continue;q=this.canvasSpacePreviewBoundsForTransition(Q,X);let M=Rn.get(F.transitionType);z=this._renderTreeForMagicMove(Q,X,M,F.role,F.easingFunction),$=X}if(z==null)continue;if(!a.permitsMoreWork())break;let P=this._compositor.prepareForEfficientCompositing(z);if(!a.permitsMoreWork())break;this._prerenderViewport.copyFrom(this._viewport),this._prerenderViewport.updateForCurrentPreview($.canvasSpaceBoundingBox(),q,this._appState.currentFitMode(),this._appState.activePrototypeDevice());let k=G.new2();this._prerenderViewport.computeCanvasSpaceBounds1(k),q.intersectWith(k);let H=this._prerenderViewport.zoomScale()*this._devicePixelRatio,L=this._compositor.getPrioritizedListOfTilesToPopulate(H,q,q,P);for(let Q of L)if(a.tileCacheCapacityRemaining()==0||this._compositor.ensureTileIsPopulated(Q.node,a,this._requestImageForPrerendering)==0&&(this._didRasterizeContentOnLastDraw=!0,zr.VERBOSE_LOGS&&console.log(`ProtoRenderManager: Rendering tile for future frame. Capacity left: ${a.tileCacheCapacityRemaining()} / ${s}`),!a.permitsMoreWork()))break}}}}),Pe.appTimerStop("drawOffScreenTiles"),A&&this.setNeedsBlit(!0),this._context.endFrame(),0})}_canvas(){return this._appState.getActiveCanvas()}_currentTlf(){var e;return(e=this._canvas())==null?void 0:e.scene().findNode1(this._currentBaseScreenId())}_drawUI(e,t){this._context.annotate("Draw UI",()=>{if(this._appState.getActiveCanvas()==null)return;let n=this.currentCanvasSpacePreviewBounds(),r=this.currentCanvasSpaceFrameBounds().topLeft(),o=G.new2();e.computeCanvasSpaceBounds1(o);let l=1/(e.zoomScale()*this._devicePixelRatio);if(n==null)return;this._smoothPath.setTransformAndPixelScale(e.canvasSpaceToClipSpace1(),l);let d=this._canvas().prototypeDevice(),c=0;if(d!=null&&d.type=="PRESET"&&lb(d.presetIdentifier)&&(c=25),d==null||d.type!="PRESET")n.intersectWith(o),vs.drawPreviewStencil(this._smoothPath,e.zoomScale(),n,o,t.backgroundColor,c);else{let u=G.new2();u.setTo2(r,d.size()),u.expand1(1/e.zoomScale()),n.intersectWith(o),u.intersectWith(o),vs.drawPreviewStencil(this._smoothPath,e.zoomScale(),u,o,t.backgroundColor,c)}3!=0&&(this._drawDeviceFrameIfNecessary(this._smoothPath,e,this._currentTlf().canvasSpaceBoundingBox(),o),t.particles!=null&&vs.drawParticles(this._smoothPath,t.particles,1/e.zoomScale(),n),t.mouse!=null&&n.contains2(t.mouse)&&vs.drawMouseCursor(this._smoothPath,t.mouse,e.zoomScale()),t.hotspots!=null&&this._hotspotRenderer.draw(e.canvasSpaceToClipSpace1(),e.zoomScale(),t.hotspots,t.hotspotOpacity,this._devicePixelRatio),this._smoothPath.flush(),this.deviceRenderer().flush())})}_drawDeviceFrameIfNecessary(e,t,n,r){this._canvas()!=null&&this._context.annotate("Draw device frame",()=>{var o;if(this.deviceRenderer().drawPrototypeDeviceIfAny(t,this._canvas().prototypeDevice(),n,t.canvasSpaceToClipSpace1()),this.deviceRenderer().isWaitingForDeviceFrameToLoad(this._canvas().prototypeDevice())){let a=pp((o=this._appState.baseScreenNode())==null?void 0:o.id(),this._appState.currentFitMode(),this._canvas());e.fillRect(r,a)}})}_totalVRAM(){let e=0;return e=e+this._bufferPool.totalVRAM(),e=e+this._compositeTileCache.totalVRAM(),e=e+this._renderer.totalVRAM(),e}_onBoundsInvalidate(e){this._viewport.invalidate()}clearTileCaches(){this._compositeTileCache.clear()}_initTransitionStats(){if(this._visibilityListener===null){let e=()=>{this._transitionWasInterruptedByVisibilityChange=!0};Yt.EventTarget_addEventListener1(document,"visibilitychange",e)}this._transitionWasInterruptedByVisibilityChange=!1;for(let e of["SA","nonSA"])this._transitionStats.set(e,new Map([["transition_mean",[]],["transition_max",[]],["frame_counts",[]],["count_0_to_20ms",0],["count_20_to_40ms",0],["count_40_to_80ms",0],["count_80_to_160ms",0],["count_160_to_320ms",0],["count_320_to_640ms",0],["count_640_ms_or_higher",0]]))}_maybeLogPerformanceMetricsForTransition(){let e=this._transitionWasInterruptedByVisibilityChange;if(this._transitionWasInterruptedByVisibilityChange=!1,!(e||document.hidden)&&!this._transitionProgressTracker.isProgressControlledExternally()&&this._transitionProgressTracker.duration()>0){let t=Math.random()<this.PORTION_TO_LOG&&this._numTransitionsLogged<this.MAX_TRANSITION_LOGS;if(zr.VERBOSE_LOGS||t||zr.PERF_TRACKING){let n=this._transitionProgressTracker.frameTimesMs,r=n.length,o=0,a=0,s=0,l=0,d=0,c=0,p=0,u=0,h=0;for(let b of n)u=Math.max(u,b),h+=b,b<20?o=o+1:b<40?a=a+1:b<80?s=s+1:b<160?l=l+1:b<320?d=d+1:b<640?c=c+1:p=p+1;if(u>60*1e3)return;let f=h/r,y=this._ongoingTransition.change,g=y.transitionParameters.transitionType,A=g=="SMART_ANIMATE"||Dn.supportsSmartAnimate(g)&&y.transitionParameters.transitionShouldSmartAnimate,T=new Map([["is_smart_animate",A],["mean_frame_ms",f],["max_frame_ms",u],["frame_count",r],["count_0_to_20ms",o],["count_20_to_40ms",a],["count_40_to_80ms",s],["count_80_to_160ms",l],["count_160_to_320ms",d],["count_320_to_640ms",c],["count_640_ms_or_higher",p]]);zr.VERBOSE_LOGS&&(console.group("ProtoRenderManager: Transition complete"),console.table(Be.StringMap_toJSObject(T)),console.groupEnd()),t&&(Pe.trackEvent("viewer_transition_frame_times_v2",Be.StringMap_toJSObject(T)),this._numTransitionsLogged=this._numTransitionsLogged+1),zr.PERF_TRACKING&&this._aggregateTransitionStats(T)}}}_aggregateTransitionStats(e){let t=e.get("is_smart_animate")?"SA":"nonSA",n=this._transitionStats.get(t);n.get("frame_counts").push(e.get("frame_count")),n.get("transition_mean").push(e.get("mean_frame_ms")),n.get("transition_max").push(e.get("max_frame_ms"));for(let r of["count_0_to_20ms","count_20_to_40ms","count_40_to_80ms","count_80_to_160ms","count_160_to_320ms","count_320_to_640ms","count_640_ms_or_higher"])n.set(r,n.get(r)+e.get(r))}getAggregateTransitionStats(){for(let e of["SA"]){let t=new Map(this._transitionStats.get(e)),n=0;for(let a=0,s=t.get("transition_mean").length;a<s;a=a+1)n=n+t.get("transition_mean")[a]*t.get("frame_counts")[a];t.set("frame_count",t.get("frame_counts").reduce((a,s,l)=>a+s,0)),t.delete("frame_counts"),t.set("mean_frame_ms",n/t.get("frame_count")|0),t.get("transition_mean").sort(),t.get("transition_max").sort();let r=t.get("transition_mean").length%2===0,o=Math.floor(t.get("transition_mean").length/2);for(let a of["mean","max"]){let s=t.get(`transition_${a}`)[o];r&&(s+=t.get(`transition_${a}`)[o-1],s/=2),t.set(`median_transition_${a}`,s)}return t.set("transition_count",t.get("transition_mean").length),t.set("max_frame_ms",t.get("transition_max")[t.get("transition_max").length-1]),t.delete("transition_mean"),t.delete("transition_max"),t}}_formatStatsForGoogleSheets(e,t){let n=`
`;t&&(n+=`=SPLIT("${this.HEADERS.join(",")}", ",")
`);let r=[];for(let o of this.HEADERS)r.push(e.get(o).toString());return n+=`=SPLIT("${r.join(",")}", ",")
`,n}triggerTransition(e,t,n){this._drewFirstFrameOfTransition=!1,this._ongoingTransition=new zr.TransitionState(e,t),this._transitionProgressTracker.willStartTransitionWithDuration(e.transitionParameters.transitionDuration),n!=null&&bs.applyTo(n,this._transitionProgressTracker)}handleAbortedTransition(e){var t;e==((t=this._ongoingTransition)==null?void 0:t.change)&&(this._ongoingTransition=null)}handleCommittedTransition(e){var t;e==((t=this._ongoingTransition)==null?void 0:t.change)&&(this._ongoingTransition=null)}triggerHsmTransition(e,t,n){let r=e.toString(),o=new Hr;o.willStartTransitionWithDuration(t.transitionParameters.transitionDuration),n!=null&&bs.applyTo(n,o),this._hsmTransitionMap.set(r,new zr.InstanceSwapTransition(o,()=>{let a=o.progress();return t.transitionParameters.easingFunction==null||o.isProgressControlledExternally()?a:t.easingFunction().get(a)},t))}abortHsmTransition(e,t){this._hsmTransitionMap.delete(e.toString())}commitHsmTransition(e,t){this._hsmTransitionMap.delete(e.toString())}isTopLevelTransitionOngoing(){return this._ongoingTransition!=null&&this._transitionProgressTracker.isTransitionInProgress()}easedTransitionProgress(){let e=this._ongoingTransition;if(e==null)return 0;let t=this._transitionProgressTracker.progress();return e.change.easingFunction()==null||this._transitionProgressTracker.isProgressControlledExternally()?t:e.change.easingFunction().get(t)}_renderTreeForTransition(e){let t=this._ongoingTransition;return t==null?null:t.cachedRenderTree!=null?t.cachedRenderTree:ee.equals(t.change.oldStateId(),t.change.newStateId())?this._renderTreeForOverlayTransition(t):this._renderTreeForBaseScreenTransition(t,e)}_initMagicMoveRenderTreeCache(){let e=l=>l[1]==Ln.FrameRole.OVERLAY?Re.renderTreeWithPerfLogging2(l[0],new _o(l[0],this._hsmTransitionMap,null),"_initMagicMoveRenderTreeCache"):Re.renderTreeForBaseScreenWithPerfLogging(l[0],new _o(l[0],this._hsmTransitionMap,null),"_initMagicMoveRenderTreeCache"),t=l=>Re.renderTreeWithPerfLogging2(l,new _o(l,this._hsmTransitionMap,null),"_initMagicMoveRenderTreeCache"),n=l=>Re.renderTreeForBaseScreenWithPerfLogging(l,new _o(l,this._hsmTransitionMap,null),"_initMagicMoveRenderTreeCache"),r=l=>l,o=l=>l,a=(l,d,c,p)=>{let u=null;try{u=Fo.renderTreeForMagicMove(l,d,()=>this.easedTransitionProgress(),p,c)}catch(h){u=new ze([]),Ve(h)}return zr.VERBOSE_LOGS&&(console.log("Smart animate render tree"),console.log("-------------------------"),console.log(u.debugString1())),u},s=(l,d,c,p)=>a(l[0],d[0],c,p);this._consolidatedRenderTreeForMagicMove=ep(s,e,e,r,o),this._renderTreeForMagicMoveBaseScreen=ep(a,n,n,r,o),this._renderTreeForMagicMoveOverlay=ep(a,t,t,r,o)}_renderTreeForMagicMove(e,t,n,r,o){return Y.useConsolidatedRenderTreeMagicMoveCache()?this._consolidatedRenderTreeForMagicMove([e,r],[t,r],n,o):r==Ln.FrameRole.OVERLAY?this._renderTreeForMagicMoveOverlay(e,t,n,o):this._renderTreeForMagicMoveBaseScreen(e,t,n,o)}_preparedRenderTreeForMagicMove(e,t,n,r,o,a){let s=this._renderTreeForMagicMove(n,r,t,o,a);return e.cachedRenderTree=this._compositor.prepareForEfficientCompositing(s),e.cachedRenderTree}_renderTreeForBaseScreenTransition(e,t){let n=e.change,r=e.viewportBeforeTransition.zoomScale()*this._devicePixelRatio,o=this._appState.prototypeState().lastNodeForBaseScreen();if(o==null)return null;let a=t.zoomScale()*this._devicePixelRatio,s=this._appState.prototypeState().nextNodeForBaseScreen();if(s==null)return null;let l=n.oldOverlays(this._appState.prototypeState()),d=n.newOverlays(this._appState.prototypeState()),c=Rn.get(n.transitionParameters.transitionType);n.direction==1&&(c=c.reversed());let p=n.transitionParameters.transitionType=="SMART_ANIMATE"||Dn.supportsSmartAnimate(n.transitionParameters.transitionType)&&n.transitionParameters.transitionShouldSmartAnimate,u=l.length!=0;if(p){let A=this._preparedRenderTreeForMagicMove(e,c,o,s,Ln.FrameRole.BASE_SCREEN,n.easingFunction());if(u){let T=s.size().max2(o.size()),b=ne.new2(),_=this._renderTreeForOverlays(o,l);if(_=at.forOpacity(_,It.EXITING_TLF,()=>c.exitingFrameTransition().interpolateOpacity(this.easedTransitionProgress())),_=at.forTransform(_,It.EXITING_TLF,()=>b.copyFrom(vt.FrozenAffineTransform_IDENTITY).translatedBy1(T.multiply1(c.exitingFrameTransition().interpolateTranslation(this.easedTransitionProgress()))).translatedBy1(s.canvasSpaceBoundingBox().center()).scaledBy2(r/a).translatedBy1(o.canvasSpaceBoundingBox().center().negative())),n.transitionParameters.transitionType=="SMART_ANIMATE"){let m=It.DISSOLVE_TRANSITION;_=new dr(_,A,m,()=>this.easedTransitionProgress())}return e.cachedRenderTree=ze.wrap([A,_]).optimized(),e.cachedRenderTree}else return A}let h=s.size().max2(o.size()),f=ne.new2(),y=this._renderTreeForBaseScreenAndOverlays(o,l);y!=null?(y=at.forOpacity(y,It.EXITING_TLF,()=>c.exitingFrameTransition().interpolateOpacity(this.easedTransitionProgress())),y=at.forTransform(y,It.EXITING_TLF,()=>f.copyFrom(vt.FrozenAffineTransform_IDENTITY).translatedBy1(h.multiply1(c.exitingFrameTransition().interpolateTranslation(this.easedTransitionProgress()))).translatedBy1(s.canvasSpaceBoundingBox().center()).scaledBy2(r/a).translatedBy1(o.canvasSpaceBoundingBox().center().negative()))):y=new ze([]);let g=this._renderTreeForBaseScreenAndOverlays(s,d);if(g!=null?(g=at.forOpacity(g,It.ENTERING_TLF,()=>c.enteringFrameTransition().interpolateOpacity(this.easedTransitionProgress())),g=at.forTranslation(g,It.ENTERING_TLF,()=>h.multiply1(c.enteringFrameTransition().interpolateTranslation(this.easedTransitionProgress())))):g=new ze([]),c.isDissolve()){let A=It.DISSOLVE_TRANSITION;e.cachedRenderTree=new dr(y,g,A,()=>this.easedTransitionProgress())}else c.drawsEnteringFrameOnTopOfExitingFrame()?e.cachedRenderTree=ze.wrap([y,g]):e.cachedRenderTree=ze.wrap([g,y]);return e.cachedRenderTree}_renderTreeForOverlayTransition(e){var T,b;let t=e.change,n=t.oldOverlays(this._appState.prototypeState()),r=t.newOverlays(this._appState.prototypeState()),o=this._appState.prototypeState().lastNodeForBaseScreen(),a=o.canvasSpaceBoundingBox().topLeft();if(o==null)return null;let s=Re.renderTreeForBaseScreenWithPerfLogging(o,new _o(o,this._hsmTransitionMap,null),"_renderTreeForOverlayTransition");if(s==null)return null;let l=[],d=this._compositor.prepareForEfficientCompositing(s);d!=null&&l.push(at.forTransformIsolation(d));let c=t.getFramePairTransition(),p=new ta,u=0;for(let _=0,m=Math.min(n.length,r.length);_<m&&ee.equals(n[_].id(),r[_].id());_=_+1){let S=Re.renderTreeForOverlayBackground(n[_].backgroundAppearance(),o.canvasSpaceBoundingBox());S!=null&&l.push(S);let v=this._renderTreeForOverlay1(n[_],o,_,p,null);v!=null&&l.push(v),u=u+1}if(n.length==r.length&&u==n.length-1&&t.transitionParameters.transitionType=="SMART_ANIMATE"){let _=n[n.length-1],m=r[r.length-1],S=this._appState.prototypeState().lastNodeForOverlayAt(n.length-1),v=this._appState.prototypeState().nextNodeForOverlayAt(r.length-1);if(S!=null&&v!=null){let C=[];On(C,l);let N=Re.renderTreeForOverlayBackground(_.backgroundAppearance(),o.canvasSpaceBoundingBox()),x=Re.renderTreeForOverlayBackground(m.backgroundAppearance(),o.canvasSpaceBoundingBox());(N!=null||x!=null)&&C.push(new dr(N,x,It.OVERLAY_BACKGROUND_DISSOLVE,()=>this.easedTransitionProgress()));let z=this._preparedRenderTreeForMagicMove(e,c,S,v,Ln.FrameRole.OVERLAY,t.easingFunction());return z=at.forTranslation(z,It.SMART_ANIMATE_OVERLAY_TRANSLATION,()=>{let $=m.deltaFromRenderedPositionToCanvasSpacePosition(o),q=_.renderedOrigin(o).subtract1(v.canvasSpaceBoundingBox().topLeft());return $.multiply(this.easedTransitionProgress()).add1(q.multiply(1-this.easedTransitionProgress()))}),C.push(z),e.cachedRenderTree=ze.wrap(C).optimized(),e.cachedRenderTree}}let y=[];for(let _=u,m=n.length;_<m;_=_+1){let S=Re.renderTreeForOverlayBackground(n[_].backgroundAppearance(),o.canvasSpaceBoundingBox()),v=null;S!=null&&(v=()=>1-this.easedTransitionProgress(),y.push(at.forOpacity(S,It.EXITING_OVERLAY_BACKGROUND,v)));let C=n[_].renderedOrigin(o).subtract1(a),N=((T=n[_].node())==null?void 0:T.size())??Ie.FrozenVector_new1(),x=["MOVE_FROM_RIGHT","MOVE_FROM_BOTTOM"].indexOf(t.transitionParameters.transitionType)!=-1?o.size().subtract1(C.add1(N)):C,z=N.add1(x),$=()=>z.multiply1(c.exitingFrameTransition().interpolateTranslation(this.easedTransitionProgress())),q=this._renderTreeForOverlay2(n[_],o,_,v,p,$);p!=null&&p.removeEntry(n[_].id()),q!=null&&(q=at.forOpacity(q,It.EXITING_OVERLAY,()=>c.exitingFrameTransition().interpolateOpacity(this.easedTransitionProgress())),q=at.forTranslation(q,It.EXITING_OVERLAY,$),y.push(q))}let g=[];for(let _=u,m=r.length;_<m;_=_+1){let S=Re.renderTreeForOverlayBackground(r[_].backgroundAppearance(),o.canvasSpaceBoundingBox()),v=null;S!=null&&(v=()=>this.easedTransitionProgress(),g.push(at.forOpacity(S,It.ENTERING_OVERLAY_BACKGROUND,v)));let C=r[_].renderedOrigin(o).subtract1(a),N=((b=r[_].node())==null?void 0:b.size())??Ie.FrozenVector_new1(),x=["MOVE_FROM_RIGHT","MOVE_FROM_BOTTOM"].indexOf(t.transitionParameters.transitionType)!=-1?o.size().subtract1(C.add1(N)):C,z=N.add1(x),$=()=>z.multiply1(c.enteringFrameTransition().interpolateTranslation(this.easedTransitionProgress())),q=this._renderTreeForOverlay2(r[_],o,_,v,p,$);q!=null&&(q=at.forOpacity(q,It.ENTERING_OVERLAY,()=>c.enteringFrameTransition().interpolateOpacity(this.easedTransitionProgress())),q=at.forTranslation(q,It.ENTERING_OVERLAY,$),g.push(q))}let A=[];if(On(A,l),c.isDissolve()){let _=It.DISSOLVE_TRANSITION,m=ze.wrap(y),S=ze.wrap(g);A.push(new dr(m,S,_,()=>this.easedTransitionProgress()))}else On(A,y),On(A,g);return e.cachedRenderTree=ze.wrap(A),e.cachedRenderTree}_onBeforeFrameForTransition(){if(this._ongoingTransition!=null&&(this._transitionProgressTracker.advanceToNextFrame(),!this._transitionProgressTracker.isTransitionInProgress()))switch(this._maybeLogPerformanceMetricsForTransition(),this._transitionProgressTracker.transitionEnded()){case Hr.TransitionEndedAction.COMMIT:{this._appState.prototypeState().commitStateChange();break}case Hr.TransitionEndedAction.ABORT:{this._appState.prototypeState().abortStateChange();break}}}_onBeforeFrameForHsm(){this._hsmTransitionMap.size!=0&&Array.from(this._hsmTransitionMap.keys()).forEach(e=>{if(Array.from(this._hsmTransitionMap.keys()).indexOf(e)!=-1){let t=this._hsmTransitionMap.get(e),n=t.tracker;if(n.advanceToNextFrame(),!n.isTransitionInProgress()){let r=n.transitionEnded(),o=this._appState.prototypeState(),a=t.change;if(o.getStateMachineInitiatedChange(a.stablePath)==a)switch(r){case Hr.TransitionEndedAction.COMMIT:{o.commitChangesBelowInstanceTransitionRoot(a.stablePath);let s=this._appState.scene().findNode3(a.stablePath);s!=null&&this._dirtinessTracker.dirtyNode(s);break}case Hr.TransitionEndedAction.ABORT:{o.abortInstanceStateChange(a.stablePath);break}}}}})}currentCanvasSpacePreviewBounds(){if(this._ongoingTransition!=null&&this.ongoingPrototypeStateChange().transitionParameters.transitionType!="INSTANT_TRANSITION"){let r=this._appState.prototypeState(),o=r.lastNodeForBaseScreen(),a=r.nextNodeForBaseScreen()??r.lastNodeForBaseScreen();return this.canvasSpacePreviewBoundsForTransition(o,a)}let t=this._appState.baseScreenNode();return this.canvasSpacePreviewBoundsForTransition(t,t)}currentCanvasSpaceFrameBounds(){if(this._ongoingTransition!=null&&this.ongoingPrototypeStateChange().transitionParameters.transitionType!="INSTANT_TRANSITION"){let r=this._appState.prototypeState(),o=r.lastNodeForBaseScreen(),a=r.nextNodeForBaseScreen()??r.lastNodeForBaseScreen();return this.canvasSpaceFrameBoundsForTransition(o,a)}let t=this._appState.baseScreenNode();return this.canvasSpaceFrameBoundsForTransition(t,t)}canvasSpacePreviewBoundsForTransition(e,t){if(e==null&&t==null)return null;if(!ee.equals(e==null?void 0:e.id(),t==null?void 0:t.id())){let n=Ie.FrozenVector_ZERO,r=Ie.FrozenVector_ZERO,o=0,a=0;e!=null&&(n=e.canvasSpaceBoundingBox().size(),e.strokeGeometry()!=null&&e.strokeGeometry().bounds.isFinite()&&e.strokeAlign()!="INSIDE"&&(o=Math.abs(e.strokeGeometry().bounds.left()))),r=t.canvasSpaceBoundingBox().size(),t.strokeGeometry()!=null&&t.strokeGeometry().bounds.isFinite()&&t.strokeAlign()!="INSIDE"&&(a=Math.abs(t.strokeGeometry().bounds.left()));let s=n.max2(r),l=new G(0,0,s.x(),s.y()),d=Math.max(o,a),c=ne.new2().translatedBy1(t.canvasSpaceBoundingBox().center()).translatedBy1(l.center().negative());return l.transformInto1(l,c),l.expand1(d),l}return t.canvasSpacePreviewBounds()}canvasSpaceFrameBoundsForTransition(e,t){if(e==null&&t==null)return null;if(!ee.equals(e==null?void 0:e.id(),t==null?void 0:t.id())){let n=e!=null?e.size():Ie.FrozenVector_ZERO,r=t.size(),o=n.max2(r),a=new G(0,0,o.x(),o.y());return a.transformInto1(a,t.absoluteTransform()),a}return e.canvasSpaceBoundingBox()}ongoingPrototypeStateChange(){var e;return(e=this._ongoingTransition)==null?void 0:e.change}transitionProgressTracker(){return this._transitionProgressTracker}renderLayerByLayerActivate(e){this._renderer.renderLayerByLayerActivate(e)}renderLayerByLayerDeactivate(){this._renderer.renderLayerByLayerDeactivate()}renderLayerByLayerPlay(){this._renderer.renderLayerByLayerPlay()}renderLayerByLayerPause(){this._renderer.renderLayerByLayerPause()}renderLayerByLayerForward(){this._renderer.renderLayerByLayerForward()}renderLayerByLayerBackward(){this._renderer.renderLayerByLayerBackward()}renderLayerByLayerRewind(){this._renderer.renderLayerByLayerRewind()}renderLayerByLayerIncreaseSpeed(){this._renderer.renderLayerByLayerIncreaseSpeed()}renderLayerByLayerDecreaseSpeed(){this._renderer.renderLayerByLayerDecreaseSpeed()}_createContext(){return new w.HTMLContext}attachTo(e){e.element().appendChild(this._context.gl().canvas)}removeFrom(e){e.element().removeChild(this._context.gl().canvas),this._uninitialize()}};zr.VERBOSE_LOGS=!1,zr.PERF_TRACKING=!1;var Va=zr;(t=>{class i{constructor(r,o){this.change=null,this.viewportBeforeTransition=null,this.cachedRenderTree=null,this.change=r,this.viewportBeforeTransition=new $o,this.viewportBeforeTransition.copyFrom(o)}}t.TransitionState=i;class e{constructor(r,o,a){this.tracker=r,this.progress=o,this.change=a}}t.InstanceSwapTransition=e})(Va||(Va={}));var Re;(De=>{function i(B,U,Z){if(B>De.GEN_DURATION_LOG_THRESHOLD_S){let ae=`${Lc[U]}${Z}`;De._trackingKeys.has(ae)||(Pe.trackEvent("Slow Render Tree Generation",{duration:B,frameRole:U,callSite:Z}),De._trackingKeys.add(ae))}}De._logIfNecessary=i;function e(B,U){let Z=new Xa;Pe.appTimerStart("generateRenderTree");let ae=B.renderTree();return Pe.appTimerStop("generateRenderTree"),i(Z.elapsedSeconds(),1,U),ae}De.renderTreeWithPerfLogging1=e;function t(B,U,Z){let ae=new Xa;Pe.appTimerStart("generateRenderTree");let ce=B.renderTree2(U);return Pe.appTimerStop("generateRenderTree"),i(ae.elapsedSeconds(),1,Z),ce}De.renderTreeWithPerfLogging2=t;function n(B,U,Z){let ae=new Xa;Pe.appTimerStart("generateRenderTree");let ce=B.renderTreeForBaseScreen2(U);return Pe.appTimerStop("generateRenderTree"),i(ae.elapsedSeconds(),0,Z),ce}De.renderTreeForBaseScreenWithPerfLogging=n;function r(B,U,Z){let ae=new Xa;Pe.appTimerStart("generateRenderTree");let ce=B.renderTreeForOverlay(U);return Pe.appTimerStop("generateRenderTree"),i(ae.elapsedSeconds(),1,Z),ce}De.renderTreeForOverlayWithPerfLogging=r;function o(B,U,Z){if(Z!=null){let ce=B.getCachedRenderTree();if(ce!=null&&(ce.value==null||!Z.overlaps(ce.value.maxBounds)))return null}let ae=null;switch(U.mode){case 0:{ae=B.renderTree();break}case 2:{ae=B.renderTreeWithoutBackgroundBlurs();break}case 1:{ae=U.shadowOwnerID==B.uniqueIdentifier()?B.renderTreeForShadowRoot():B.renderTreeForShadowDescendant();break}case 3:{ae=U.shadowOwnerID==B.uniqueIdentifier()?B.renderTreeForKnockoutShadowRoot():B.renderTreeForKnockoutShadowDescendant();break}default:throw new Error(`Unhandled render tree GenerateArgs mode: ${ut[U.mode]}`)}return Z!=null&&(ae==null||!Z.overlaps(ae.maxBounds))?null:ae}De._generateRenderTreeForChild=o;function a(B){return B.scrollDirection()!="NONE"&&B.hasOverflowingContentInScrollDirection()}De._nodeCanScroll=a;function s(B,U,Z){return Y.useBackgroundBlurOpts()?Z==null?!0:Z.hasVolatileContent()?!1:!z(B,U):!1}De._canSkipWrappingInVolatileTransforms=s;function l(B,U){if(B.isRoot())return U;U=q(U,B);let Z=B.indexInParent();if(B.moveToParent(),a(B)&&Z<p(B)){let ae=B.clone(),ce=It.forScrollOffset(B.uniqueIdentifier());U=at.forTranslation(U,ce,()=>ae.scrollOffset().negative())}return U=l(B,U),B.moveToChildAt(Z),U}De._wrapInVolatileTransformsForAncestors=l;function d(B,U,Z,ae,ce,me){return c(B,U,Z,ae,ce,me)}De._generateChildrenWithMasking=d;function c(B,U,Z,ae,ce,me){let fe=a(B),Oe=U.clone(),Se=fe?B.clone():null,be=[],Qe=[],Me=Z,Le=ae;for(;Me<Le;){B.moveToChildAt((Me=Me+1)+-1);let St=be.length==0||!ue.List_last(be).isStandardScrolling(),Ke=B.parent()!=null&&B.isStickyScrolling(),$t=Se!=null&&B.isFixed();Ke?(be.push(new wt("STICKY_SCROLLS")),ue.List_last(be).stickyScrollSceneNodes.push(B.clone())):!Ke&&!$t&&St&&be.push(new wt("SCROLLS"));let re=$t?Qe:ue.List_last(be).nodes,za=Se==null||B.isFixed()?ce:null;if(!B.isVisibleMask()){let Bl=o(B,Oe,za);Bl!=null&&re.push(Bl),B.moveToParent();continue}let Th=B.maskType(),NT=Oe.clone(),Rd=o(B,NT,za),Ml=[];B.moveToParent();let OT=p(B);for(;Me<Le;){if(B.moveToChildAt(Me),B.stopsMaskPropagation()||Me==OT){B.moveToParent();break}if(Rd!=null){let Bl=o(B,Oe,za);Bl!=null&&Ml.push(Bl)}Me=Me+1,B.moveToParent()}Rd!=null&&Ml.length!=0&&(me==0&&Me==Le?re.push(ze.wrap(Ml)):Th=="LUMINANCE"?re.push(Or.createForLuminanceMask(Rd,ze.wrap(Ml))):re.push(new Or(Rd,ze.wrap(Ml))))}let dt=be.filter(St=>St.nodes.length!=0),Ue=It.forScrollOffset(B.uniqueIdentifier()),ot=[];for(let St of dt)if(St.isStandardScrolling())if(Se!=null){let Ke=u(Se,ze.wrap(St.nodes).optimized());ot.push(at.forTranslation(Ke,Ue,()=>Se.scrollOffset().negative()))}else On(ot,St.nodes);else if(St.isStickyScrolling()){let Ke=[];for(let eo=0,re=St.nodes.length;eo<re;eo=eo+1){let za=St.nodes[eo],Th=St.stickyScrollSceneNodes[eo];Ke.push(new ar(za,Th))}let $t=Ke.map(eo=>{let re=eo.a,za=eo.b;return at.forTranslation(re,Ue,()=>Ra.getScrollTranslationOfNodeRelativeToParent2(za).negative())});On(ot,$t)}if(Qe.length!=0){let St=ze.wrap(Qe).optimized();ot.push(St)}return new ze(ot).optimized()}De._generateChildrenWithMaskingNew=c;function p(B){for(let U=B.childCount()-1;U>=0;U=U-1){if(B.moveToChildAt(U),!B.isFixed())return B.moveToParent(),U+1;B.moveToParent()}return 0}De._indexOfFirstValidFixedChild=p;function u(B,U){if(U.hasAnimatingMedia()||U.hasVolatileContent()||U.hasBackgroundBlurs()||!U.hasNonIsolatedBlends())return U;let Z=Ne.firstPaintIfSolidAndOpaqueOrNull(B.fillPaintsToRender());return Z==null?U:ze.wrapWithSolidBackground(U,Z.color())}De._wrapScrollingContentWithSolidBackground=u;function h(B,U,Z,ae,ce,me,fe){if(Y.backgroundBlurBoundsOpt(),U.parent()==null)return null;let Oe=U.indexInParent();U.moveToParent();let Se=f(B,U,Z,ae,ce,me,Oe,fe);return U.moveToChildAt(Oe),Se}De._generateBackground=h;function f(B,U,Z,ae,ce,me,fe,Oe){let Se=new bt(2),be=d(U,Se,0,fe,Z,0);if(ae!=null){if(a(U)&&fe<p(U)){let Le=U.clone(),dt=It.forScrollOffset(Le.uniqueIdentifier());ae=at.forTranslation(ae,dt,()=>Le.scrollOffset().negative())}be==null?be=ae:be=ze.wrap([be,ae]).optimized()}be=L(be,U.clone(),Se,1,ce);let Qe=!1;U.isFrameLike()&&U.clipsChildren()&&(Qe=Ne.containsAtLeastOneVisibleOpaquePaint(U.fillPaintsToRender()));let Me=Y.getViewerMode()==Y.ViewerMode.PROTOTYPE&&U.isTopLevel();if(!U.isRoot()&&!Qe&&!Me)be=h(Se,U,Z,be,ce,me,Oe);else{let Le=!Oe&&!s(me,U,be);Le&&(be=l(U,be)),be!=null&&(be=new ze([be,m(me,new bt(2))]),$(me)&&Le&&(be=at.forInverseTransform(be)))}return be}De._generateBackgroundFromParent=f;function y(B,U,Z){let ae=null;switch(U){case 1:{ae=B.renderTreeForShadowRoot();break}case 3:{ae=B.renderTreeForKnockoutShadowRoot();break}default:throw new Error(`Unhandled shadow mode: ${ut[U]}`)}if(ae!=null&&Z!=null){if(B.shouldOptimizeShadowForAnimation(Z)){let ce=B.clone(),me=ce.absoluteTransform(),fe=me.inverse();ae=at.forTransform(ae,It.forShadowTransformation(ce.uniqueIdentifier()),()=>{let Oe=ce.absoluteTransform(),Se=Oe.inverse();Se.multiply(ne.new2().translatedBy1(Z)),Se.multiply(Oe);let be=ne.new2();return be.multiply(me),be.multiply(Se),be.multiply(fe),be})}else{let ce=ne.translated(Z.x(),Z.y());ae=new wr(ae,ce)}ae=ae.optimized()}return ae}De._generateRenderTreeForShadow=y;function g(B,U){if(U.effects()!=null)for(let Z=0,ae=U.effects().length;Z<ae;Z=Z+1){let ce=U.effects()[Z];if(ce.type()!="INNER_SHADOW"||!ce.isVisibleForRendering())continue;let me=y(U,1,null);if(me!=null){let fe=y(U,1,ce.blurOffset());if(fe==null)fe=new ze([]);else{if(ce.spread()!=0&&(fe=_(fe,-ce.spread(),U,ce.type()),fe==null))continue;fe=new go(fe,E.BLACK)}me=new go(me,E.BLACK);let Oe=Or.createForInnerShadow(me,new Jr(ce.blurRadius(),fe,G.INVALID),E.withAlpha(ce.blurColor(),Math.ceil(ce.opacity()*255)|0));Oe=new jr(ce.blendMode(),1,Oe),B!=null?B=new Yo(new ze([B,Oe])):B=Oe}}return B}De._wrapWithInnerShadows=g;function A(B){let U=B.renderableContentType();if(U!=Sn.RenderableContentType.RENDERABLE_GEOMETRY&&U!=Sn.RenderableContentType.RENDERABLE_TEXT&&U!=Sn.RenderableContentType.RENDERABLE_GROUP||U==Sn.RenderableContentType.RENDERABLE_GROUP&&B.childCount()>0&&!B.clipsChildren())return!1;let Z=B.fillPaints(),ae=B.strokePaints(),ce=B.fillGeometry(),me=ce!=null&&ce.regions.length!=0,fe=B.strokeGeometry(),Oe=fe!=null&&fe.regions.length!=0,Se=me&&Z!=null&&Ne.containsAtLeastOneVisibleOpaquePaint(Z),be=!Oe||ae==null||Ne.containsAtLeastOneVisibleOpaquePaint(ae);if(U==Sn.RenderableContentType.RENDERABLE_TEXT){let Me=B.textData().styleOverrideTable().styleByID2();for(let Le of Array.from(Me.keys())){let dt=Me.get(Le),Ue=pn.get(dt,59,null);if(Ue!=null&&!Ne.containsAtLeastOneVisibleOpaquePaint(Ze.asPaintData(Ue))){Se=!1;break}}}return Se&&(be||B.strokeAlign()=="INSIDE")}De._hasOpaqueGeometry=A;function T(B,U){let Z=B.isInsideOutlineMask(),ae=[],ce=[],me=null,fe=H(U,B,0),Oe=H(U,B,1);if(B.renderableContentType()==Sn.RenderableContentType.RENDERABLE_TEXT)tt(ae,B,fe,B.scene(),Z,U);else{let Ue=U.mode==3?0:1;le(ae,B,0,fe,B.uniqueIdentifier(),U,Ue)}le(ce,B,1,Oe,B.uniqueIdentifier(),U,1);let Se=B.size().withOnesForZeros(),be=B.strokeAlign();U.isForShadows()&&be=="INSIDE"&&cn(ae)&&cn(ce)&&(ce.length=0);let Qe=B.effects(),Me=B.absoluteTransform();if(yt(ae)&&yt(ce)&&!U.isForShadows()&&Wt(Qe)&&!(De.emulateFullscreenRenderingBugs&&er(Qe,"FOREGROUND_BLUR")&&er(Qe,"INNER_SHADOW"))){let Ue=[],ot=[];nt(Me,ae,Se,Ue);let St=g(ze.wrap(Ue),B);return me=new _e(2),ot.push(St),be=="CENTER"?nt(Me,ce,Se,ot):Tt(be,Me,ae,ce,Se,ot),new fn(ze.wrap(ot),me)}if(be=="CENTER"||ae.length==0){let Ue=[];for(let ot of[ae,ce])nt(Me,ot,Se,Ue);return new fn(ze.wrap(Ue),me)}if(fe!=null&&Oe!=null&&(Ne.isIsolated(fe)&&Ne.isIsolated(Oe)||U.isForShadows())&&ce.length!=0){let Ue=[],ot=[];for(let Ke of ae)Ne.isEmojiPaint(Ke.paints)?Ue.push(Ke):ot.push(Ke);let St=[];return nt(Me,Ue,Se,St),St.push(new md(Me,ot,ce,Se,be=="INSIDE"?0:1)),new fn(ze.wrap(St),me)}let dt=[];return nt(Me,ae,Se,dt),Tt(be,Me,ae,ce,Se,dt),new fn(ze.wrap(dt),me)}De._generateRenderTreeForGeometry=T;function b(B,U){if(!B.visible()||B.opacity()<=0&&!(2&B.willChange()))return null;let Z=null,ae=0;switch(B.renderableContentType()){case Sn.RenderableContentType.NON_RENDERABLE:return null;case Sn.RenderableContentType.RENDERABLE_GEOMETRY:case Sn.RenderableContentType.RENDERABLE_TEXT:{let ce=T(B,U);Z=ce.node,ce.layerWrap!=null&&(ae=ce.layerWrap.value);break}case Sn.RenderableContentType.RENDERABLE_GROUP:{!(U.isForShadows()&&B.clipsChildren()&&Ne.containsAtLeastOneVisibleNotFullyTransparentPaint(B.fillPaintsToRender()))&&(Z=d(B,U,0,B.childCount(),null,1));break}case Sn.RenderableContentType.CUSTOM_RENDER_TREE:{ae=2,Z=B.customRenderTree(U);break}}return L(Z,B,U,ae,0)}De.generateRenderTree=b;function _(B,U,Z,ae){if(!Z.isSpreadEligibleNode())return B;if(B.op()==10){let Ke=B,$t=_(Ke.child,U,Z,ae);return $t==null?null:new at($t,Ke.id,Ke.property,Ke.getter)}else if(B.op()==11){let Ke=B,$t=_(Ke.child,U,Z,ae);return $t==null?null:new wr($t,Ke.transform)}else if(B.op()==2){let $t=_(B.child,U,Z,ae);return $t==null?null:new Yo($t)}else if(B.op()==12){let Ke=B,$t=Ke.startChild!=null?_(Ke.startChild,U,Z,ae):null,eo=Ke.endChild!=null?_(Ke.endChild,U,Z,ae):null;return $t!=null||eo!=null?new dr($t,eo,Ke.id,Ke.progressFn):null}let ce=Z.fillGeometry()!=null&&Z.fillGeometry().regions.length!=0&&Ne.containsAtLeastOneVisiblePaint(Z.fillPaints()),me=Z.strokeGeometry()!=null&&Z.strokeGeometry().regions.length!=0&&Ne.containsAtLeastOneVisiblePaint(Z.strokePaints()),fe=ce&&!me,Oe=!ce&&me,Se=null,be=B,Qe=()=>{Pe.trackEvent("unexpected_spread_shadow_node",{sceneNode:Z.paintsDebugString(),renderNode:B.debugString1()})};for(;Se==null;)switch(be.op()){case 3:case 4:{Se=be;break}case 5:{be=be.alpha;break}case 7:{be=be.child;break}case 1:{let Ke=null;Nn.visitEachNodeInTree(be,$t=>{($t.op()==3||$t.op()==4)&&(Ke==null||Nn.geometryNodePaintSize($t).area()>Nn.geometryNodePaintSize(Ke).area())&&(Ke=$t)},null),be=Ke;break}case 0:{be=be.child,Qe();break}case 9:{be=be.alpha,Qe();break}case 6:{be=be.child,Qe();break}default:return Qe(),Ve("Unexpected wrapped node for spread shadow"),B}if(Se==null||Se.op()!=3&&Se.op()!=4)return Ve(`Failed to find geometryNode after search; got ${Sr[Se.op()]}`),B;let Me=null,Le=null,dt=null;switch(Se.op()){case 3:{let Ke=Se;Me=Le=Ke.paintSize,dt=Ke.transform;break}case 4:{let Ke=Se;Me=Le=Ke.paintSize,dt=Ke.transform;break}default:return Ve(`Unexpected node type ${Sr[Se.op()]}`),B}if(me&&Z.strokeAlign()!="INSIDE"){let Ke=Z.strokeAlign()=="OUTSIDE"?2:1;Me=Me.add(Z.strokeWeight()*Ke)}if(ae=="DROP_SHADOW"){if(Me.x()<=-(2*U)||Me.y()<=-(2*U))return null}else ae=="INNER_SHADOW"&&(U=Math.max(U,-Math.min(Me.x(),Me.y())/2));let Ue=Le.add(2*U),ot=Ue.divide1(Le),St=ne.new2().translatedBy2(-U,-U).scaledBy1(ot);if(fe){let Ke=Z.fillGeometryForSpread(St,U,Ne.SOLID_BLACK);return new kn(dt,Ke,Ue)}else if(Oe){let Ke=Z.strokeGeometryForSpread(St,U,Le,Ne.SOLID_BLACK);if(Ke==null){if(ae=="DROP_SHADOW")return null;Ke=new nn(new Pt(Nt.fromRect(Kn.FrozenRect_EMPTY),"NONZERO"),Ne.SOLID_BLACK)}return new kn(dt,Ke,Ue)}else{let Ke=Z.strokeGeometryForSpread(St,U,Le,Ne.SOLID_BLACK);return Ke==null?null:new kn(dt,Ke,Ue)}}De._blurChildWithSpread=_;function m(B,U){let Z=[];for(let ae=0,ce=B.effects().length;ae<ce;ae=ae+1){let me=B.effects()[ae];if(me.type()=="DROP_SHADOW"&&me.isVisibleForRendering()){if(U.mode==2&&!me.showShadowBehindNode())continue;let fe=y(B,1,me.blurOffset());if(fe!=null){if(me.spread()!=0&&(fe=_(fe,me.spread(),B,me.type()),fe==null))continue;let Oe=new go(fe,E.multiplyOpacity(me.blurColor(),me.opacity())),Se=null,be=Oe.optimized();if(be!=null&&(Se=new Jr(me.blurRadius(),new Yo(be),G.INVALID)),Se!=null&&!me.showShadowBehindNode()&&!A(B)){let Qe=y(B,3,null);Se=new Yo(Or.createForKnockoutShadow(Qe,Se))}Se!=null&&Z.push(new jr(me.blendMode(),1,Se))}}}return new ze(Z)}De._dropShadowsForNode=m;function S(B){let U=B.parent();if(U==null)return B.absoluteTransform();let Z=U.absoluteTransform().clone();return Z.invert()?(Z.multiply(B.absoluteTransform()),Z):ne.new2()}De._transformRelativeToParent=S;function v(B,U,Z,ae,ce,me){let fe=U.size(),Oe=ae>0&&U.clipsChildren()&&Z!=0,Se=null,be=null,Qe=H(me,U,0);me.isForShadows()&&Ne.containsAtLeastOneVisibleNotFullyTransparentPaint(Qe)&&(Qe=de(1)),Ne.forEachPaintWithVideo(Qe,dt=>{let Ue=dt.video().getVideoManager();Ue!=null&&Ue.associatePaintWithNode(dt,U)});let Me=U.absoluteTransform(),Le=[];if(Oe){Se=Pt.getOrCreate(Nt.fromRect(G.new4(Ie.FrozenVector_ZERO,fe).expandedBy1(ae)),"ODD");let dt=Ne.isolatedPaints(Qe);for(let Ue=0,ot=dt.length;Ue<ot;Ue=Ue+1)ce.push(new nn(Se,dt[Ue]))}else if(U.fillGeometry()!=null&&U.fillGeometry().regions.length!=0)le(ce,U,0,Qe,U.uniqueIdentifier(),me,1);else if(oe(0,U)){be=Pt.getOrCreate(Nt.fromRect(G.new4(Ie.FrozenVector_ZERO,fe)),"ODD");let dt=Ne.isolatedPaints(Qe);for(let Ue=0,ot=dt.length;Ue<ot;Ue=Ue+1)ce.push(new nn(be,dt[Ue]))}if(nt(Me,ce,fe,Le),!U.clipsChildren()){let dt=[],Ue=H(me,U,1);le(dt,U,1,Ue,U.uniqueIdentifier(),me,1),U.strokeAlign()=="CENTER"||ce.length==0?nt(Me,dt,fe,Le):Tt(U.strokeAlign(),Me,ce,dt,fe,Le)}return B!=null&&Le.push(B),B=ze.wrap(Le),B}De._wrapTreeWithFrameFillPaints=v;function C(B,U,Z,ae,ce){let me=U.size(),fe=ae>0&&U.clipsChildren()&&Z!=0,Oe=null,Se=null,be=U.absoluteTransform();if(fe?Oe=Pt.getOrCreate(Nt.fromRect(G.new4(Ie.FrozenVector_ZERO,me).expandedBy1(ae)),"ODD"):Se=Pt.getOrCreate(Nt.fromRect(G.new4(Ie.FrozenVector_ZERO,me)),"ODD"),U.clipsChildren()){let Qe=[],Me=[];fe?Qe.push(new nn(Oe,de(1))):U.fillGeometry()!=null&&U.fillGeometry().regions.length!=0?le(Qe,U,0,de(1),U.uniqueIdentifier(),ce,1):Qe.push(new nn(Se,de(1))),nt(be,Qe,me,Me),B=new Or(ze.wrap(Me),B)}return B}De._wrapTreeWithFrameMasks=C;function N(B){return B.containerSupportsFillStrokeAndCorners()?B.fillPaints():B.fillPaintsToRender()}De._fillPaintsToRender=N;function x(B,U,Z,ae){let ce=U.size();if(!ce.isZero()){let me=null,fe=U.clipsChildren(),Oe=N(U);if(Ne.containsAtLeastOneVisiblePaint(Oe)){let Se=[],be=[],Qe=null;Z.isForShadows()&&Ne.containsAtLeastOneVisibleNotFullyTransparentPaint(Oe)?Qe=de(1):Qe=M(Z,Oe,0),me=Pt.getOrCreate(Nt.fromRect(G.new4(Ie.FrozenVector_ZERO,ce).expandedBy1(fe?ae:0)),"ODD");let Me=Ne.isolatedPaints(Qe);for(let Le=0,dt=Me.length;Le<dt;Le=Le+1){let Ue=Me[Le];Se.push(new nn(me,Ue))}nt(U.absoluteTransform(),Se,ce,be),B!=null&&be.push(B),B=ze.wrap(be)}if(B!=null&&fe){me==null&&(me=Pt.getOrCreate(Nt.fromRect(G.new4(Ie.FrozenVector_ZERO,ce).expandedBy1(ae)),"ODD"));let Se=new nn(me,de(1));B=new Or(new kn(U.absoluteTransform(),Se,ce),B)}}return B}De._wrapTreeWithFrameBackgroundOrFillIgnoringGeometry=x;function z(B,U){let Z=B.clone(),ae=Z.parent(),ce=!0;for(;Z!=null;){if(U!=null&&Z.uniqueIdentifier()==U.uniqueIdentifier())return!1;if(1&Z.willChange()||Z.overlayRenderData()!=null)return!0;if(ae==null||U!=null&&ae.uniqueIdentifier()==U.uniqueIdentifier())return!1;if(!ce){let me=Z.indexInParent();if(a(ae)&&me<p(ae))return!0}ce=!1,Z=ae,ae=ae.parent()}return!1}De._hasVolatileTransformOnAncestor=z;function $(B){return Y.useBackgroundBlurOpts()?z(B,null):!0}De._needInverseTransform=$;function q(B,U){if(1&U.willChange()){let Z=vt.FrozenAffineTransform_IDENTITY,ae=U.parent();ae!=null&&(Z=ae.absoluteTransform());let ce=U.absoluteTransform().clone(),me=ce.invert(),fe=U.clone();B=at.forTransform(B,It.forAnimateableTranslation(U.uniqueIdentifier()),()=>{let Se=ne.new2();return Se.multiply(Z),Se.multiply(S(fe)),Se.multiply(ce),Se});let Oe=U.maxTransformScale();Oe!=1&&(B=at.forMaxTransformScale(Oe,B))}return B}De._wrapTreeInVolatileTransform=q;function K(B,U){if(B.backgroundAppearance.backgroundType=="NONE")return null;let Z=J(B.backgroundAppearance,U.scene().findNode1(U.overrideKey()).canvasSpaceBoundingBox());return Z!=null?(B.backgroundTransitionProgress!=null&&(Z=at.forOpacity(Z,It.OVERLAY_BACKGROUND,B.backgroundTransitionProgress)),at.forInverseTransform(Z)):null}De._generateRenderTreeForOverlayBackground=K;function F(B,U,Z){let ae=[];for(let ce=0,me=B.count();ce<me;ce=ce+1){let fe=B.keys()[ce];if(fe==U)break;let Oe=B.get2(fe),Se=Oe.overlayNode,be=K(Oe,Z.clone()),Qe=Se.renderTreeWithoutBackgroundBlurs();if(be!=null&&ae.push(be),Qe!=null){let Me=Oe.bounds.center(),Le=Se.canvasSpaceBoundingBox().center(),dt=Me.subtract1(Le),Ue=St=>()=>St,ot=at.forInverseTransform(at.forTranslation(Qe,It.forOverlayPosition(ce),Ue(dt)));ae.push(ot)}}return new ze(ae)}De._generateIntermediateOverlays=F;function P(B,U,Z,ae,ce){let me=G.new2();me.copyFrom(B.bounds);let fe=B.baseTlfCursor.clone(),Oe=U.overlayRenderData(),Se=[],be=f(ae,fe.clone(),me,null,ce,U.clone(),fe.childCount(),!1);be!=null&&Se.push(be);let Qe=F(Oe,B.overlayId,fe.clone());Qe!=null&&Se.push(Qe);let Me=K(B,fe);Me!=null&&Se.push(Me);let Le=null;return B.overlayId!=U.uniqueIdentifier()&&(Le=h(ae,U,Z,null,ce,U.clone(),!0),Le!=null&&(Le=at.forInverseTransform(at.forTranslation(Le,It.ENTERING_OVERLAY,()=>(B.transform!=null?B.transform():Ie.FrozenVector_new4(0,0)).add1(B.animationTransform!=null?B.animationTransform():Ie.FrozenVector_new4(0,0)))))),Le!=null&&Se.push(Le),new ze(Se)}De._generateBackgroundBlurForOverlays=P;function k(B,U,Z,ae){let ce=y(B,1,null);if(ce!=null){let me=null,fe=null;if(Dt.didEncounterBackgroundBlurBoundsOpt(),Y.backgroundBlurBoundsOpt()&&(me=G.new2(),me.copyFrom(ce.maxBounds)),B.overlayRenderData()!=null){let Oe=B.clone(),Se=null,be=B.overlayRenderData();for(;Oe!=null&&(Se=be.get2(Oe.uniqueIdentifier()),Se==null);)Oe=Oe.parent();if(Oe==null||Se==null)return Ve("Blurred node with overlay data cannot be found in an overlay"),U;me=G.new2(),me.copyFrom(Se.bounds),fe=P(Se,B.clone(),ce.maxBounds,Z,ae)}else fe=h(Z,B,me,null,ae,B.clone(),!1);if(fe!=null){let Oe=null,Se=Up(ce),be=Se.op()==3?Se:null;be!=null&&be.geometry.type==ei.PaintedGeometryType.STATIC?Oe=be.geometryBounds():Oe=ce.maxBounds;let Qe=new Jr(ae,fe,Oe),Me=Or.createForBackgroundBlur(ce,Qe);U=new ze([Me,U])}U=xa.createForBackgroundBlur(U)}return U}De._generateBackgroundBlur=k;function H(B,U,Z){let ae=U.isInsideOutlineMask(),ce=Z==0?U.fillPaints():U.strokePaints(),me=ce!=null&&Ne.containsAtLeastOneVisiblePaint(ce);return ae?de(me?1:0):M(B,ce,Z)}De._getFinalizedPaintData=H;function L(B,U,Z,ae,ce){let me=[],fe=ae==0&&U.isFrameLike()&&U.containerSupportsFillStrokeAndCorners()&&!U.isGroup()&&U.clipsChildren(),Oe=U.isFrameLike()&&!U.size().isZero(),Se=U.overlayRenderData()==null&&U.isTopLevel()&&U.isFrameLike()&&Ne.containsAtLeastOneVisibleOpaquePaint(U.fillPaintsToRender()),be=!U.containerSupportsFillStrokeAndCorners()||U.isGroup(),Qe=Oe&&!be;Oe&&(be?B=x(B,U,Z,ce):B=v(B,U,ae,ce,me,Z)),B!=null&&(B=B.optimized());let Me=!Z.isForShadows()&&U.effects()!=null,Le=[];if(Me)if(B!=null){if(Z.mode==0)for(let ot=0,St=U.effects().length;ot<St;ot=ot+1){let Ke=U.effects()[ot];if(Ke.type()=="BACKGROUND_BLUR"){Ke.isVisibleForRendering()&&!A(U)&&(B=k(U,B,Z,Ke.blurRadius()));break}}(ae==1||ae==0)&&(B=g(B,U)),Se||Le.push(m(U,Z))}else Se||Le.push(m(U,Z));if(B==null&&Le.length==0&&!fe)return B;let dt=fe&&U.strokeAlign()=="INSIDE";if(Qe&&!dt&&B!=null&&(B=C(B,U,ae,ce,Z)),fe&&!At(U,Z,me)){let ot=U.absoluteTransform(),St=[],Ke=H(Z,U,1),$t=[];B!=null&&$t.push(B),le(St,U,1,Ke,U.uniqueIdentifier(),Z,1),U.strokeAlign()=="CENTER"||me.length==0||dt?nt(ot,St,U.size(),$t):Tt(U.strokeAlign(),ot,me,St,U.size(),$t),B=ze.wrap($t)}else dt=!1;if(fe&&U.strokeAlign()=="OUTSIDE"&&U.clipsChildren()&&(B=Yo.thatShouldNotBeUnwrappedInOptimization(B)),Qe&&dt&&B!=null&&(B=C(B,U,ae,ce,Z)),B!=null?B=new ze([new ze(Le),B]):B=new ze(Le),B!=null&&Me)for(let ot=0,St=U.effects().length;ot<St;ot=ot+1){let Ke=U.effects()[ot];if(Ke.type()=="FOREGROUND_BLUR"){Ke.isVisibleForRendering()&&(B=new Jr(Ke.blurRadius(),B,G.INVALID));break}}if(Z.isForShadows()&&Z.shadowOwnerID==U.uniqueIdentifier())return B.optimized();let Ue=2&U.willChange()?1:U.opacity();if(B=new jr(U.blendMode(),Ue,B),B=B.optimized(),B!=null&&2&U.willChange()){let ot=U.clone();B=new at(B,It.forAnimateableOpacity(ot.uniqueIdentifier()),4,()=>ot.opacity())}return B!=null&&(B=q(B,U)),B}De._wrapTreeWithLayerProperties=L;function Q(B){if(B==null)return null;let U=!1;for(let ae=0,ce=B.length;ae<ce;ae=ae+1){let me=B[ae].asVolatilePaint();if(me!=null){if(me.from().image()!=null&&me.from().image().isDecoded()||me.from().imageThumbnail()!=null&&me.from().imageThumbnail().isDecoded()||me.to().image()!=null&&me.to().image().isDecoded()||me.to().imageThumbnail()!=null&&me.to().imageThumbnail().isDecoded()){U=!0;break}}else if(B[ae].asSinglePaint()!=null){let fe=B[ae].asSinglePaint();if(fe.image()!=null&&fe.image().isDecoded()||fe.imageThumbnail()!=null&&fe.imageThumbnail().isDecoded()){U=!0;break}}if(!B[ae].isEnabledAndVisible()){U=!0;break}}if(!U)return B;let Z=[];for(let ae=0,ce=B.length;ae<ce;ae=ae+1){if(!B[ae].isEnabledAndVisible())continue;let me=B[ae].asVolatilePaint();if(me!=null){let fe=me.cloneAsVolatilePaint();fe.from().setDecodedImageIsReady(fe.from().image()!=null&&fe.from().image().isDecoded()),fe.to().setDecodedImageIsReady(fe.to().image()!=null&&fe.to().image().isDecoded()),fe.from().setDecodedImageThumbnailIsReady(fe.from().imageThumbnail()!=null&&fe.from().imageThumbnail().isDecoded()),fe.to().setDecodedImageThumbnailIsReady(fe.to().imageThumbnail()!=null&&fe.to().imageThumbnail().isDecoded()),Z.push(fe)}else if(B[ae].asSinglePaint()!=null){let fe=B[ae].asSinglePaint().cloneAsSinglePaint();fe.setDecodedImageIsReady(fe.image()!=null&&fe.image().isDecoded()),fe.setDecodedImageThumbnailIsReady(fe.imageThumbnail()!=null&&fe.imageThumbnail().isDecoded()),Z.push(fe)}}return Z}De._filteredPaintsWithImageAvailability=Q;function X(B,U,Z){if(B!=3||Z==1&&U.length==0)return U;let ae=[];for(let ce=0,me=U.length;ce<me;ce=ce+1){let fe=U[ce];if(fe.type()=="IMAGE"||fe.type()=="EMOJI"||fe.type()=="VIDEO")ae.push(fe);else return[ie.createSolid(E.BLACK,1)]}return ae.length==0&&ae.push(ie.SOLID_BLACK),ae}De._filteredPaintsForKnockoutShadow=X;function M(B,U,Z){return X(B.mode,Q(U),Z)}De._substitutePaintsAsNeeded=M;function te(B,U,Z,ae,ce,me){if(ee.equals(U.overrideKey(),ee._new(4e7,2)))return!1;let Oe=U.strokeGeometry()!=null&&U.strokeGeometry().regions.length!=0&&Ne.containsAtLeastOneVisiblePaint(U.strokePaints());if(ae!=0||Oe&&!Lt(U,me,ce))return!1;for(let Se of Z.regions)if(Se.type==1)return!1;switch(U.type()){case"ELLIPSE":{if(U.arcData()==null||Ne.hasEmoji(ce))return!1;let Se=U.arcData(),be=Se.innerRadius<=0,Qe=Se.endingAngle-Se.startingAngle,Me=Math.abs(Qe)>2*Math.PI-.001,Le=U.size().withOnesForZeros();if(be&&Me&&Z.regions.length==1&&Z.regions[0].type==0){let Ue=Le.divide(2),ot=new $i(Ue,Ue.x(),Ue.y()),St=new Pt(ot,"NONZERO"),Ke=Ne.isolatedPaints(ce);for(let $t=0,eo=Ke.length;$t<eo;$t=$t+1){let re=Ke[$t];B.push(new nn(St,re))}return!0}break}case"RECTANGLE":case"ROUNDED_RECTANGLE":case"FRAME":case"STAMP":case"SYMBOL":case"INSTANCE":{let Se=U.roundedRectInfo();if(!Nt.isRoundedRectSupported(Se))return!1;let be=Nt.fromRoundedRect(Se),Qe=new Pt(be,"NONZERO"),Me=Ne.isolatedPaints(ce);for(let Le=0,dt=Me.length;Le<dt;Le=Le+1){let Ue=Me[Le];B.push(new nn(Qe,Ue))}return!0}}return!1}De._attemptToGenerateAAAGeometry=te;function J(B,U){switch(B.backgroundType){case"NONE":return null;case"SOLID_COLOR":{if(U==null)return null;let Z=B.backgroundColor,ae=1;return kn.solidColorRect(U,Z,ae)}}throw new Error(`Unhandled backgroundType ${B.backgroundType}`)}De.renderTreeForOverlayBackground=J;function oe(B,U){if(B==0){let Z=U.fillPaints(),ae=U!=null&&U.clipsChildren();return U!=null&&(ae||Ne.containsAtLeastOneVisiblePaint(Z)||U.strokeAlign()!="CENTER"&&oe(1,U))}else if(B==1){let Z=U.strokePaints();return Ne.containsAtLeastOneVisiblePaint(Z)&&U.hasNonZeroStrokeWeight()}return!1}De._isGeometryNecessary=oe;function le(B,U,Z,ae,ce,me,fe){let Oe=Z==0?U.fillGeometry():U.strokeGeometry();if(Z==0&&fe==1&&!oe(Z,U)&&(Oe=null),Oe==null||ae==null)return;if(Ne.forEachPaintWithVideo(ae,be=>{let Qe=be.video().getVideoManager();Qe!=null&&Qe.associatePaintWithNode(be,U)}),U.hasPerRegionFillPaints()&&Z==0){U.forEachRegionWithFillPaintBatch((be,Qe)=>{let Me=Ne.isolatedPaints(Qe);for(let Le=0,dt=Me.length;Le<dt;Le=Le+1){let Ue=Q(Me[Le]);Ne.forEachPaintWithVideo(Ue,St=>{let Ke=St.video().getVideoManager();Ke!=null&&Ke.associatePaintWithNode(St,U)});let ot=Pt.getOrCreate(be.path(),be.windingRule);B.push(new nn(ot,Ue))}});return}if(te(B,U,Oe,Z,ae,me))return;let Se=Ne.isolatedPaints(ae);for(let be=0,Qe=Se.length;be<Qe;be=be+1){let Me=Se[be],Le=null,dt=()=>{if(Le!=null){let Ue=Le.compilePaths(),ot=Pt.getOrCreate(Ue,Le.windingRule);B.push(new nn(ot,Me)),Le=null}};for(let Ue of Oe.regions)Ue.bounds().isEmpty()||(Ue.type==0?Le!=null&&Le.canAddRegion(Ue)?Le.add(Ue):(dt(),Le=new Qt(Ue)):(dt(),B.push(new _l(()=>new Pt(Ue.path(),Ue.windingRule),Me,Ue.bounds(),It.forDynamicGeometry(ce)))));dt()}}De._generateGeometries=le;function tt(B,U,Z,ae,ce,me){let fe=U.textGeometry();if(fe==null||Z==null)return;let Oe=be=>{var Le,dt;let Qe=Un.getEmojiImageUrl(be),Me=((Le=U.derivedTextData())==null?void 0:Le.usedEmojiImages())??((dt=U.textData())==null?void 0:dt.usedEmojiImagesDEPRECATED());for(let Ue of Me)if(Ue.url()==Qe){let ot=new ie("EMOJI");return ot.setOpacity(1),ot.setBlendMode("NORMAL"),ot.setImage(Ue),M(me,[ot],0)}return null},Se=be=>{let Qe=fe.paintOverrides.get(be,ae);return Qe!=null?M(me,Qe,0):M(me,Z,0)};for(let be=0,Qe=fe.regions.length;be<Qe;be=be+1){let Me=fe.regions[be];if(fe.emojiCodepoints[be].length>0){let Ue=Pt.getOrCreate(Me.path(),Me.windingRule),ot=Oe(fe.emojiCodepoints[be]);if(ot==null)continue;B.push(new nn(Ue,ot));continue}let Le=Se(Me.styleID);if(Le==null)continue;for(let Ue=0,ot=Le.length;Ue<ot;Ue=Ue+1){let St=Le[Ue].asSinglePaint();(St==null?void 0:St.video())!=null&&St.video().getVideoManager().associatePaintWithNode(St,U)}let dt=Ne.isolatedPaints(Le);for(let Ue=0,ot=dt.length;Ue<ot;Ue=Ue+1){let St=dt[Ue];if(!Me.bounds().isEmpty()){let Ke=Pt.getOrCreate(Me.path(),Me.windingRule);B.push(new nn(Ke,St))}}}}De._generateGeometriesForText=tt;function nt(B,U,Z,ae){for(let ce=0,me=U.length;ce<me;ce=ce+1){let fe=U[ce];if(Ne.containsAtLeastOneVisiblePaint(fe.paints)){let Oe=new kn(B,fe,Z),Se=fe.paints;Se.length!=0&&Se[0].blendMode()!="NORMAL"?ae.push(new jr(Se[0].blendMode(),1,Oe)):ae.push(Oe)}}}De._generateFills=nt;function At(B,U,Z){if(U.mode!=1||B.strokeAlign()!="INSIDE")return!1;for(let ae=0,ce=Z.length;ae<ce;ae=ae+1){let me=Z[ae];if(Ne.containsAtLeastOneVisibleOpaquePaint(me.paints))return!0}return!1}De._canSkipInsideStrokesForShadows1=At;function Lt(B,U,Z){return U.mode!=1||B.strokeAlign()!="INSIDE"?!1:Ne.containsAtLeastOneVisibleOpaquePaint(Z)}De._canSkipInsideStrokesForShadows2=Lt;function Tt(B,U,Z,ae,ce,me){let fe=[];for(let Oe=0,Se=Z.length;Oe<Se;Oe=Oe+1){let be=Z[Oe];fe.push(new nn(be.path(),Ne.EMPTY))}for(let Oe=0,Se=ae.length;Oe<Se;Oe=Oe+1){let be=ae[Oe],Qe=be.paints,Me=[be],Le=new md(U,fe,Me,ce,B=="INSIDE"?0:1);Qe.length!=0&&me.push(new jr(Qe[0].blendMode(),1,Le))}}De._generateFillStrokes=Tt;function de(B){return B==1?Ne.SOLID_BLACK:Ne.EMPTY}De._outlineMaskPaintData=de;function yt(B){for(let U=0,Z=B.length;U<Z;U=U+1){let ae=B[U];if(Ne.containsAtLeastOneVisiblePaint(ae.paints))return!0}return!1}De._isAnyGeometryVisible=yt;function er(B,U){for(let Z=0,ae=B.length;Z<ae;Z=Z+1){let ce=B[Z];if(ce.type()==U&&ce.isEnabledAndVisible())return!0}return!1}De._hasVisibleEffectsOfType=er;function Wt(B){for(let U=0,Z=B.length;U<Z;U=U+1)if(B[U].isEnabledAndVisible())return!0;return!1}De._hasVisibleEffects=Wt;function cn(B){if(B.length!=1)return!1;let U=B[0].paints;return U.length==1&&U[0].type()=="SOLID"}De._isSingleSolidGeometry=cn;function Ot(){return De._flushBeforeMasks}De.flushBeforeMasks=Ot;function st(B){De._flushBeforeMasks=B}De.setFlushBeforeMasks=st;let ut;(ce=>(ce[ce.NORMAL=0]="NORMAL",ce[ce.SHADOW=1]="SHADOW",ce[ce.WITHOUT_BACKGROUND_BLURS=2]="WITHOUT_BACKGROUND_BLURS",ce[ce.KNOCKOUT_SHADOW=3]="KNOCKOUT_SHADOW"))(ut=De.RenderMode||(De.RenderMode={}));let Ge;(Z=>(Z[Z.INCLUDE=0]="INCLUDE",Z[Z.IGNORE=1]="IGNORE"))(Ge=De.IncludeUnnecessaryGeometry||(De.IncludeUnnecessaryGeometry={}));class bt{constructor(){if(arguments.length==2){let U=arguments[0],Z=arguments[1];this.mode=0,this.shadowOwnerID=null,this.mode=U,this.shadowOwnerID=Z}else if(arguments.length==1){let U=arguments[0];this.mode=0,this.shadowOwnerID=null,this.mode=U,this.shadowOwnerID=null}}clone(){return new bt(this.mode,this.shadowOwnerID)}isForShadows(){return this.mode==1||this.mode==3}}De.GenerateArgs=bt;let kt;(Z=>(Z[Z.FILL=0]="FILL",Z[Z.STROKE=1]="STROKE"))(kt=De.GeometryType||(De.GeometryType={}));let xe;(Z=>(Z[Z.IGNORE=0]="IGNORE",Z[Z.INCLUDE=1]="INCLUDE"))(xe=De.LastMask||(De.LastMask={}));class wt{constructor(U){this.nodes=null,this.scrollBehavior=null,this.stickyScrollSceneNodes=null,this.stickyScrollNodeStartingTopBounds_DEPRECATED=null,this.nodes=[],this.scrollBehavior=U,this.stickyScrollSceneNodes=[],this.stickyScrollNodeStartingTopBounds_DEPRECATED=[]}isFixed(){return this.scrollBehavior=="FIXED_WHEN_CHILD_OF_SCROLLING_FRAME"}isStickyScrolling(){return this.scrollBehavior=="STICKY_SCROLLS"}isStandardScrolling(){return this.scrollBehavior=="SCROLLS"}}De.ContiguousRenderNodes=wt;class fn{constructor(U,Z){this.node=U,this.layerWrap=Z}}De.GeometryRenderTreeResult=fn;let _n;(ae=>(ae[ae.WITH_INNER_SHADOWS_AND_TOP_STROKE=0]="WITH_INNER_SHADOWS_AND_TOP_STROKE",ae[ae.WITH_INNER_SHADOWS_ONLY=1]="WITH_INNER_SHADOWS_ONLY",ae[ae.WITHOUT_LAYER_WRAPS=2]="WITHOUT_LAYER_WRAPS"))(_n=De.LayerWrap||(De.LayerWrap={}));let Gt;(Z=>(Z[Z.FILL_PAINT_DATA=0]="FILL_PAINT_DATA",Z[Z.STROKE_PAINT_DATA=1]="STROKE_PAINT_DATA"))(Gt=De.PaintType||(De.PaintType={}));class In{constructor(U){this.minX=0,this.minY=0,this.maxX=0,this.maxY=0,this.minX=U.left(),this.maxX=U.right(),this.minY=U.top(),this.maxY=U.bottom()}}De.RBushRect=In;class Qt{constructor(U){this.windingRule=null,this._uniquePathsOnly=!1,this._collisionTracker=new Ub.default,this._paths=[],this.windingRule=U.windingRule,this._uniquePathsOnly=U.path()instanceof co,this.add(U)}compilePaths(){if(this._paths.length==1)return this._paths[0];if(this._uniquePathsOnly){let Z=[];for(let me of this._paths)Z.push(me.handle);let ae=D().modules().uniquePathHelpers.getVolatileConcatenatedPaths(Z),ce=new Uint8Array(ae);return new Ye(new gr(ce))}let U=this._paths[0].toBezierPath().getMutableClone();for(let Z=1,ae=this._paths.length;Z<ae;Z=Z+1)U.append(this._paths[Z].toBezierPath());return U}canAddRegion(U){return U.windingRule==this.windingRule&&this._uniquePathsOnly==U.path()instanceof co&&!this._collisionTracker.collides(new In(U.path().bounds()))}add(U){this._paths.push(U.path()),this._collisionTracker.insert(new In(U.path().bounds()))}}De.PathBatch=Qt;let ln;(Z=>(Z[Z.ALL_PAINTS_INVISIBLE=0]="ALL_PAINTS_INVISIBLE",Z[Z.HAS_VISIBLE_PAINTS=1]="HAS_VISIBLE_PAINTS"))(ln=De.PaintVisibility||(De.PaintVisibility={}));let tr;(U=>{function B(Z){return ut[Z]}U.RenderMode_toString=B})(tr=De.in_RenderMode||(De.in_RenderMode={}));let lt;(U=>{function B(Z){return Ge[Z]}U.IncludeUnnecessaryGeometry_toString=B})(lt=De.in_IncludeUnnecessaryGeometry||(De.in_IncludeUnnecessaryGeometry={}));let O;(U=>{function B(Z){return kt[Z]}U.GeometryType_toString=B})(O=De.in_GeometryType||(De.in_GeometryType={}));let R;(U=>{function B(Z){return xe[Z]}U.LastMask_toString=B})(R=De.in_LastMask||(De.in_LastMask={}));let V;(U=>{function B(Z){return _n[Z]}U.LayerWrap_toString=B})(V=De.in_LayerWrap||(De.in_LayerWrap={}));let W;(U=>{function B(Z){return Gt[Z]}U.PaintType_toString=B})(W=De.in_PaintType||(De.in_PaintType={}));let j;(U=>{function B(Z){return ln[Z]}U.PaintVisibility_toString=B})(j=De.in_PaintVisibility||(De.in_PaintVisibility={})),De.GEN_DURATION_LOG_THRESHOLD_S=.15,De._trackingKeys=new Set,De.EPSILON=.001,De.emulateFullscreenRenderingBugs=!0,De._flushBeforeMasks=!1})(Re||(Re={}));var Hp=class{constructor(e,t,n,r){this.bufferArea=e,this.hasNoCurves=t,this.hasNoOverlaps=n,this.hasNoCurvesAndSameOrientation=r}},ei=class{path(){throw new Error("Not implemented")}optimized(){throw new Error("Not implemented")}equals(e){throw new Error("Not implemented")}withNewPaints(e){throw new Error("Not implemented")}canBeAnalyticallyAntialiased(){return this.path().path().canBeAnalyticallyAntialiased()}constructor(e,t,n){this.type=e,this.paints=t,this.maxBounds=n}};(e=>{let i;(r=>(r[r.STATIC=0]="STATIC",r[r.DYNAMIC=1]="DYNAMIC"))(i=e.PaintedGeometryType||(e.PaintedGeometryType={}))})(ei||(ei={}));var nn=class i extends ei{constructor(t,n){super(0,n,t.bounds());this._isOptimized=!1,this._path=t}path(){return this._path}withNewPaints(t){return new i(this._path,t)}equals(t){if(this.type!=t.type)return!1;if(this.path()==null||t.path()==null){if(this.path()==null!=(t.path()==null))return!1}else if(!this.path().equals(t.path()))return!1;if(this.paints==null||t.paints==null){if(this.paints==null!=(t.paints==null))return!1}else if(!Ne.equals(this.paints,t.paints))return!1;return!0}optimized(){if(this._isOptimized)return this;let t=Ne.optimize(this.paints);return this.paints!=t?new i(this.path(),t):(this._isOptimized=!0,this)}},_l=class i extends ei{constructor(t,n,r,o){super(1,n,r);this._isOptimized=!1,this._computePath=t,this.id=o}path(){return this._computePath()}withNewPaints(t){return new i(this._computePath,t,this.maxBounds,this.id)}equals(t){return this.type==t.type&&this.id==t.id}optimized(){if(this._isOptimized)return this;let t=Ne.optimize(this.paints);return this.paints!=t?new i(this._computePath,t,this.maxBounds,this.id):(this._isOptimized=!0,this)}},Sr=(h=>(h[h.METADATA=0]="METADATA",h[h.GROUP=1]="GROUP",h[h.SUPERSAMPLE_GROUP=2]="SUPERSAMPLE_GROUP",h[h.FILL=3]="FILL",h[h.FILL_STROKE=4]="FILL_STROKE",h[h.MASK=5]="MASK",h[h.BLUR=6]="BLUR",h[h.BLEND=7]="BLEND",h[h.COMPOSITE_TILE_GRID=8]="COMPOSITE_TILE_GRID",h[h.HARD_MASK_WITH_COLOR=9]="HARD_MASK_WITH_COLOR",h[h.VOLATILE_PROPERTY_BINDING=10]="VOLATILE_PROPERTY_BINDING",h[h.STATIC_TRANSFORM_BINDING=11]="STATIC_TRANSFORM_BINDING",h[h.DISSOLVE=12]="DISSOLVE",h))(Sr||{});var Ba;(o=>{function i(a,s){return a.has(s)}o.has=i;function e(a,s){return a.get(s)}o.get=e;function t(a,s,l){a.set(s,l)}o.set=t;function n(a){a.clear()}o.clear=n;function r(){return new Map}o._new=r})(Ba||(Ba={}));var Nn=class i{currentBounds(e){if(e==null)return this.maxBounds;if(Ba.has(e,this))return Ba.get(e,this);let t=this.computeBounds(e);return Ba.set(e,this,t),t}equals(e){return this.equalsWithinBounds(e,null)}constructor(e,t){this.maxBounds=null,this._isOptimized=!1,this.flags=0,this.maxBounds=e,this.flags=t}hasNonIsolatedBlends(){return(1&this.flags)!=0}hasBackgroundBlurs(){return(2&this.flags)!=0}canBeUsedInBackgroundBlurs(){return!(4&this.flags)}hasVolatileContent(){return(8&this.flags)!=0}hasAnimatingMedia(){return(16&this.flags)!=0}maskNeedsSSAA(){return(32&this.flags)!=0}canCacheRasterized(){return!(this.hasNonIsolatedBlends()||this.hasBackgroundBlurs()||this.hasAnimatingMedia()||this.hasVolatileContent())}isRectFill(){if(this.op()==3){let e=this;if(e.geometry.path().isRect()&&e.transform.hasPerpendicularAxes(Re.EPSILON))return!0}return!1}isAxisAlignedRoundedRectFill(){if(this.op()==3){let e=this;if(e.geometry.path().path().asRoundedRectPath()!=null&&e.transform.isAxisAligned(Re.EPSILON))return!0}return!1}isAxisAlignedRectFill(){if(this.op()==3){let e=this;if(e.geometry.path().isRect()&&e.transform.isAxisAligned(Re.EPSILON))return!0}return!1}isRoundedRectFill(){if(this.op()==3){let e=this;if(e.geometry.path().path()instanceof Nt&&e.transform.hasPerpendicularAxes(Re.EPSILON))return!0}return!1}desiredAntialiasing(){return this.op()!=3&&this.op()!=4?0:this.hasAnimatingMedia()||this.hasVolatileContent()?0:this.op()==3&&this.geometry.canBeAnalyticallyAntialiased()?1:2}opProfileString(){let e="RenderNodeOp: ";switch(this.op()){case 0:{e+="METADATA";break}case 2:{e+="SUPERSAMPLE_GROUP";break}case 1:{e+="GROUP";break}case 3:{e+="FILL";break}case 4:{let t=this;switch(e+="FILL_STROKE",t.mode){case 0:{e+=" mode=INSIDE";break}case 1:{e+=" mode=OUTSIDE";break}}break}case 5:{let t=this;switch(e+="MASK",t.type){case 0:{e+=" type=NORMAL";break}case 3:{e+=" type=BACKGROUND_BLUR";break}case 2:{e+=" type=INNER_SHADOW";break}case 4:{e+=" type=KNOCKOUT_SHADOW";break}case 1:{e+=" type=LUMINANCE";break}}break}case 6:{e+="BLUR";break}case 7:{e+="BLEND mode="+this.blendMode;break}case 9:{e+="HARD_MASK_WITH_COLOR";break}case 8:{e+="COMPOSITE_TILE_GRID";break}case 10:{let t=this;e+=`VOLATILE_PROPERTY_BINDING property=${Pa.VolatileProperty_toString(t.property)}`;break}case 11:{e+=`STATIC_TRANSFORM_BINDING transform=${this.transform}`;break}case 12:{e+="DISSOLVE";break}default:throw new Error(`Unhandled node op ${Sr[this.op()]}`)}return e}debugString1(){return this.debugString2(i.DebugStringType.BASIC)}debugString2(e){let t=new i.GenerateStringState;return this._debugStringRecursive(this,t,!0,!1,e),t.result}_debugStringRecursive(e,t,n,r,o){let a=o!=i.DebugStringType.BASIC;t.result+=t.indent,n||(t.result+=r?"\u2514\u2500":"\u251C\u2500");let s=t.indent.length;switch(n||(t.indent+=r?"  ":"\u2502 "),e.op()){case 0:{let l=e;t.result+="METADATA",this._appendFlagsToString(t,e),t.result+=`
`,this._debugStringRecursive(l.child,t,!1,!0,o);break}case 2:{let l=e;t.result+="SUPERSAMPLE_GROUP",this._appendFlagsToString(t,e),t.result+=`
`,this._debugStringRecursive(l.child,t,!1,!0,o);break}case 1:{let l=e;t.result+="GROUP",this._appendFlagsToString(t,e),t.result+=`
`;for(let d=0,c=l.children.length;d<c;d=d+1){let p=l.children[d];this._debugStringRecursive(p,t,!1,d+1==l.children.length,o)}break}case 3:{let l=e,d=l.geometry.path().path(),c=d instanceof $i?"CirclePath":d instanceof Nt?"RoundedRectPath":d instanceof Et?"BezierPath":d instanceof Ye?"FrozenBezierPath":d instanceof co?"UniquePath":"UnknownPath";t.result+=`FILL path=${c} paints=`,this._appendPaintDataToString(t,l.geometry.paints,o),a&&(t.result+=` transform=${l.transform}`,t.result+=` paintSize=${l.paintSize}`),e.isRectFill()?t.result+=" isRect":e.isRoundedRectFill()&&(t.result+=" isRoundedRect"),this._appendFlagsToString(t,e),t.result+=`
`;break}case 4:{let l=e;switch(t.result+="FILL_STROKE",l.mode){case 0:{t.result+=" mode=INSIDE";break}case 1:{t.result+=" mode=OUTSIDE";break}}t.result+=" fills=",this._appendGeometriesToString(t,l.fillGeometries,o),t.result+=" strokes=",this._appendGeometriesToString(t,l.strokeGeometries,o),a&&(t.result+=` transform=${l.transform}`),this._appendFlagsToString(t,l),t.result+=`
`;break}case 5:{let l=e;switch(t.result+="MASK",l.type){case 0:{t.result+=" type=NORMAL";break}case 3:{t.result+=" type=BACKGROUND_BLUR";break}case 2:{t.result+=" type=INNER_SHADOW color=",this._appendColorToString(t,l.innerShadowFill);break}case 4:{t.result+=" type=KNOCKOUT_SHADOW";break}}this._appendFlagsToString(t,e),t.result+=`
`,this._debugStringRecursive(l.alpha,t,!1,!1,o),this._debugStringRecursive(l.color,t,!1,!0,o);break}case 6:{let l=e;t.result+=`BLUR radius=${l.radius}`,a&&(t.result+=` clamp=${l.clamp}`),this._appendFlagsToString(t,e),t.result+=`
`,this._debugStringRecursive(l.child,t,!1,!0,o);break}case 7:{let l=e;t.result+="BLEND mode=",t.result+=l.blendMode,t.result+=` opacity=${l.opacity}`,this._appendFlagsToString(t,e),t.result+=`
`,this._debugStringRecursive(l.child,t,!1,!0,o);break}case 9:{let l=e;t.result+="HARD_MASK_WITH_COLOR color=",this._appendColorToString(t,l.color),this._appendFlagsToString(t,e),t.result+=`
`,this._debugStringRecursive(l.alpha,t,!1,!0,o);break}case 8:{let l=e;t.result+="COMPOSITE_TILE_GRID",this._appendFlagsToString(t,e),t.result+=`
`,this._debugStringRecursive(l.tree,t,!1,!0,o);break}case 10:{let l=e;switch(t.result+=`VOLATILE_PROPERTY_BINDING property=${Pa.VolatileProperty_toString(l.property)}`,a&&(t.result+=` id=${l.id}`),l.property){case 3:{t.result+=` value=${l.maxTransformScale()}`;break}case 2:{t.result+=` value=${l.transform()}`,l.id.startsWith("SHADOW_TRANSFORMATION")&&(t.result+=" SHADOW_TRANSFORMATION");break}case 4:{t.result+=` value=${l.opacity()}`;break}}this._appendFlagsToString(t,e),t.result+=`
`,this._debugStringRecursive(l.child,t,!1,!0,o);break}case 11:{let l=e;t.result+=`STATIC_TRANSFORM_BINDING transform=${l.transform}`,this._appendFlagsToString(t,e),t.result+=`
`,this._debugStringRecursive(l.child,t,!1,!0,o);break}case 12:{let l=e;t.result+="DISSOLVE",this._appendFlagsToString(t,e),t.result+=`
`,this._debugStringRecursive(l.startChild,t,!1,!1,o),this._debugStringRecursive(l.endChild,t,!1,!0,o);break}default:throw new Error(`Unhandled node op ${Sr[e.op()]}`)}t.indent=t.indent.slice(0,s)}_appendGeometriesToString(e,t,n){e.result+="[";for(let r=0,o=t.length;r<o;r=r+1){let a=t[r];r!=0&&(e.result+=", ");let s=a.path().path();s instanceof Et?e.result+=`(${s.countCommands()} commands, `:s instanceof $i?e.result+="EllipsePath, ":s instanceof Nt&&(e.result+="RoundedRectPath, "),this._appendPaintDataToString(e,a.paints,n),e.result+=")"}e.result+="]"}_appendFlagsToString(e,t){t.hasNonIsolatedBlends()&&(e.result+=" hasBlends"),t.hasBackgroundBlurs()&&(e.result+=" hasBgBlurs"),t.canBeUsedInBackgroundBlurs()&&(e.result+=" bgBlurSafe"),t.maskNeedsSSAA()&&(e.result+=" maskNeedsSSAA"),t.hasVolatileContent()&&(e.result+=" volatile"),t.canCacheRasterized()||(e.result+=" nocache")}_appendSinglePaintToString(e,t,n){let r=n!=i.DebugStringType.BASIC,o=t.asVolatilePaint();if(o!=null){e.result+="VOLATILE [",this._appendSinglePaintToString(e,o.from(),n),e.result+=" -> ",this._appendSinglePaintToString(e,o.to(),n),e.result+="]";return}let a=t.asSinglePaint();switch(a.type()){case"SOLID":{e.result+="color=",this._appendColorToString(e,a.color());break}case"GRADIENT_LINEAR":case"GRADIENT_RADIAL":case"GRADIENT_ANGULAR":case"GRADIENT_DIAMOND":{e.result+="stops=[";let s=a.colorStops();for(let l=0,d=s.length;l<d;l=l+1){l>0&&(e.result+=", ");let c=s[l];e.result+=`${c.position}`,e.result+=" ",this._appendColorToString(e,c.color)}e.result+="]";break}case"IMAGE":case"VIDEO":{r&&(e.result+=` hash=${a.image()!=null?a.image().hash():"NULL"}`,e.result+=` thumbnail=${a.imageThumbnail()!=null?a.imageThumbnail().hash():"NULL"}`,e.result+=` imageScaleMode=${a.imageScaleMode()}`,e.result+=` imageRotationDeg=${a.rotationDeg()}`,e.result+=` imageScalingFactor=${a.scalingFactor()}`);break}default:break}r&&a.transform()!=null&&(e.result+=` transform=${a.transform()}`),e.result+=` opacity=${a.opacity()}`}_appendPaintDataToString(e,t,n){e.result+="[";for(let r=0,o=t.length;r<o;r=r+1){r>0&&(e.result+=",");let a=t[r];e.result+=a.type()+" ",this._appendSinglePaintToString(e,a,n)}e.result+="]"}_appendColorToString(e,t){E.isOpaque(t)?e.result+=E.toCSS(t):e.result+=`rgba(${E.red(t)}, ${E.green(t)}, ${E.blue(t)}, ${E.alpha(t)})`}static visitEachNodeInTree(e,t,n,r,o){if(e!=null&&!(r!=null&&o!=null&&!e.currentBounds(o).overlaps(r))){switch(t!=null&&t(e),e.op()){case 0:{let a=e;i.visitEachNodeInTree(a.child,t,n,r,o);break}case 2:{let a=e;i.visitEachNodeInTree(a.child,t,n,r,o);break}case 1:{let a=e;for(let s of a.children)i.visitEachNodeInTree(s,t,n,r,o);break}case 3:case 4:case 8:break;case 5:{let a=e;i.visitEachNodeInTree(a.alpha,t,n,r,o),i.visitEachNodeInTree(a.color,t,n,r,o);break}case 6:{let a=e;i.visitEachNodeInTree(a.child,t,n,r,o);break}case 7:{let a=e;i.visitEachNodeInTree(a.child,t,n,r,o);break}case 9:{let a=e;i.visitEachNodeInTree(a.alpha,t,n,r,o);break}case 10:{let a=e;i.visitEachNodeInTree(a.child,t,n,r,o);break}case 11:{let a=e;i.visitEachNodeInTree(a.child,t,n,r,o);break}case 12:{let a=e;i.visitEachNodeInTree(a.startChild,t,n,r,o),i.visitEachNodeInTree(a.endChild,t,n,r,o);break}default:throw new Error(`Unhandled node op ${Sr[e.op()]}`)}n!=null&&n(e)}}static geometryNodePaintSize(e){return e==null?null:e.op()==3||e.op()==4?e.paintSize:null}};(t=>{let i;(o=>(o[o.BASIC=0]="BASIC",o[o.EXTENDED=1]="EXTENDED"))(i=t.DebugStringType||(t.DebugStringType={}));class e{constructor(){this.result="",this.indent=""}}t.GenerateStringState=e})(Nn||(Nn={}));var ze=class i extends Nn{constructor(){var e=(...args)=>{super(...args)};if(arguments.length==1){let t=arguments[0];e(cf(t,null),Qb(t)),this.children=null,this._isFirstChildSolidBackground=!1,this.children=t}else if(arguments.length==2){let t=arguments[0],n=arguments[1];e(cf(t,null),Qb(t)),this.children=null,this._isFirstChildSolidBackground=!1,this.children=t,this._isFirstChildSolidBackground=n,this._isFirstChildSolidBackground}}op(){return 1}isFirstChildSolidBackground(){return this._isFirstChildSolidBackground}canCacheRasterized(){return this.hasAnimatingMedia()||this.hasVolatileContent()||this.hasBackgroundBlurs()?!1:this._isFirstChildSolidBackground?!0:!this.hasNonIsolatedBlends()}computeBounds(t){return cf(this.children,t)}optimized(){if(this._isOptimized)return this;if(this.maxBounds.isEmpty())return null;let t=this.children.length;for(let n=0;n<t;n=n+1){if(n==0&&this._isFirstChildSolidBackground)continue;let r=this.children[n],o=r.optimized();if(o==r&&r.op()!=1)continue;let a=this.children.slice(0,n),s=(l,d)=>{if(d.op()==1){let c=d;for(let p of c.children)l.push(p)}else l.push(d)};for(o!=null&&s(a,o);(n=n+1)<t;){let l=this.children[n].optimized();l!=null&&s(a,l)}return a.length==0?null:this._isFirstChildSolidBackground?a.length==1?null:new i(a,this._isFirstChildSolidBackground):i.wrap(a)}return this.children.length==1?this.children[0]:(this._isOptimized=!0,this)}equalsWithinBounds(t,n){if(t==this||n!=null&&!t.maxBounds.overlaps(n)&&!this.maxBounds.overlaps(n))return!0;if(t.op()!=this.op())return!1;let o=t.children;if(n==null){if(this.children.length!=o.length)return!1;for(let a=0,s=this.children.length;a<s;a=a+1)if(!this.children[a].equalsWithinBounds(o[a],null))return!1}else{let a=0,s=0,l=[];for(;a<this.children.length&&s<o.length;){if(!this.children[a].maxBounds.overlaps(n)){a++;continue}if(!o[s].maxBounds.overlaps(n)){s++;continue}l.push(new ar(a,s)),a++,s++}for(;a<this.children.length;){if(this.children[a].maxBounds.overlaps(n))return!1;a++}for(;s<o.length;){if(o[s].maxBounds.overlaps(n))return!1;s++}for(let d of l)if(!this.children[d.a].equalsWithinBounds(o[d.b],n))return!1}return!0}static wrap(t){return t.length==1?t[0]:new i(t)}static wrapWithSolidBackground(t,n){let r=kn.solidColorRect(t.maxBounds,n,1);return new i([r,t],!0)}},Yo=class i extends Nn{constructor(){var e=(...args)=>{super(...args)};if(arguments.length==1){let t=arguments[0];e(t.maxBounds,t.flags),this.child=t}else if(arguments.length==2){let t=arguments[0],n=arguments[1];e(t.maxBounds,t.flags|n),this.child=t}}op(){return 2}computeBounds(t){return this.child.computeBounds(t)}optimized(){if(this._isOptimized)return this;let t=o=>o.op()==5&&o.type==4,n=t(Up(this.child)),r=this.child.optimized();return r==null?null:n&&!t(Up(r))||!r.maskNeedsSSAA()&&!this.maskNeedsSSAA()?r:r!=this.child?new i(r,this.flags):(this._isOptimized=!0,this)}equalsWithinBounds(t,n){if(t==this||n!=null&&!t.maxBounds.overlaps(n)&&!this.maxBounds.overlaps(n))return!0;if(t.op()!=this.op())return!1;let r=t;return this.child.equalsWithinBounds(r.child,n)}static thatShouldNotBeUnwrappedInOptimization(t){return new i(t,32)}},xa=class i extends Nn{constructor(t,n){super(t.maxBounds,n|t.flags);this.child=t}op(){return 0}computeBounds(t){return this.child.computeBounds(t)}optimized(){if(this._isOptimized)return this;let t=this.child.optimized();return t==null?null:t==this.child?(this._isOptimized=!0,this):new i(t,this.flags)}equalsWithinBounds(t,n){if(t==this||n!=null&&!t.maxBounds.overlaps(n)&&!this.maxBounds.overlaps(n))return!0;if(t.op()!=this.op())return!1;let r=t;return this.flags==t.flags&&this.child.equalsWithinBounds(r.child,n)}static createForBackgroundBlur(t){return new i(t,6)}},kn=class i extends Nn{constructor(t,n,r){super(d1(t,n),f1(n));this.transform=t,this.geometry=n,this.paintSize=r}op(){return 3}geometryBounds(){return this.geometry.canBeAnalyticallyAntialiased()?this.transform.clone().transformRect(this.geometry.path().bounds().clone()):this.maxBounds}computeBounds(t){return this.maxBounds}withPaints(t){return new i(this.transform,this.geometry.withNewPaints(t),this.paintSize)}optimized(){if(this._isOptimized)return this;if(this.maxBounds.isEmpty()||!Ne.containsAtLeastOneVisiblePaint(this.geometry.paints))return null;let t=this.geometry.optimized(),n=t.type==0,r=t.canBeAnalyticallyAntialiased();if(n&&!r&&!t.path().isRect()&&(Ne.hasAnimatingMediaPaints(t.paints)||Ne.hasVolatilePaints(t.paints))){let o=new i(this.transform,new nn(t.path(),[ie.createSolid(E.BLACK,1)]),this.paintSize),a=new i(this.transform,new nn(Pt.getOrCreate(Nt.fromRect(t.path().bounds()),"ODD"),t.paints),this.paintSize);return new Or(o,a).optimized()}return t==this.geometry?(this._isOptimized=!0,this):new i(this.transform,t,this.paintSize)}equalsWithinBounds(t,n){if(t==this||n!=null&&!t.maxBounds.overlaps(n)&&!this.maxBounds.overlaps(n))return!0;if(t.op()!=this.op())return!1;let r=t;return this.transform.equals1(r.transform)&&this.geometry.equals(r.geometry)&&this.paintSize.equals(r.paintSize)}static solidColorRect(t,n,r){let o=[ie.createSolid(n,r)],a=ne.new2().translatedBy1(t.topLeft()).scaledBy1(t.size()),s=new nn(Pt.UNIT_RECT(),o),l=Ie.FrozenVector_ZERO;return new i(a,s,l)}};var md=class i extends Nn{constructor(t,n,r,o,a){super(c1(t,n,r,a),l1([n,r]));this.mode=0,this.transform=t,this.fillGeometries=n,this.strokeGeometries=r,this.paintSize=o,this.mode=a}op(){return 4}computeBounds(t){return this.maxBounds}optimized(){if(this._isOptimized)return this;let t=[];for(let o=0,a=this.strokeGeometries.length;o<a;o=o+1){let s=this.strokeGeometries[o];Ne.containsAtLeastOneVisiblePaint(s.paints)&&t.push(s)}if(this.maxBounds.isEmpty()||this.fillGeometries.length==0&&t.length==0)return null;let n=o=>{let a=[];for(let s=0,l=o.length;s<l;s=s+1){let d=o[s];a.push(new kn(this.transform,d,this.paintSize))}return ze.wrap(a).optimized()};return t.length==0?n(this.fillGeometries):this.fillGeometries.length==0?this.mode==0?null:n(t):en.FrozenList_equals(t,this.strokeGeometries,(o,a)=>o.equals(a))?(this._isOptimized=!0,this):new i(this.transform,this.fillGeometries,t,this.paintSize,this.mode).optimized()}equalsWithinBounds(t,n){if(t==this||n!=null&&!t.maxBounds.overlaps(n)&&!this.maxBounds.overlaps(n))return!0;if(t.op()!=this.op())return!1;let r=t;return this.transform.equals1(r.transform)&&en.FrozenList_equals(this.fillGeometries,r.fillGeometries,(o,a)=>o.equals(a))&&en.FrozenList_equals(this.strokeGeometries,r.strokeGeometries,(o,a)=>o.equals(a))&&this.paintSize.equals(r.paintSize)&&this.mode==r.mode}};var Or=class i extends Nn{constructor(){var e=(...args)=>{super(...args)};if(arguments.length==5){let t=arguments[0],n=arguments[1],r=arguments[2],o=arguments[3],a=arguments[4];e(df(t,n,r,null),Kb(t,n,r)),this.alpha=t,this.color=n,this.type=r,this.innerShadowFill=o,this.innerShadowAlphaRequiresHardMask=a}else if(arguments.length==2){let t=arguments[0],n=arguments[1];e(df(t,n,0,null),Kb(t,n,0)),this.alpha=t,this.color=n,this.type=0,this.innerShadowFill=E.TRANSPARENT,this.innerShadowAlphaRequiresHardMask=!1}}op(){return 5}computeBounds(t){return df(this.alpha,this.color,this.type,t)}optimized(){if(this._isOptimized)return this;if(this.maxBounds.isEmpty())return null;let t=this.alpha.optimized();if(t==null)return null;let n=this.color.optimized(),r=this.type!=4,o=this.type!=4&&this.type!=2;if(n!=null&&r&&(n=i.cullGroupChildren(n,t.maxBounds)),n!=null&&o&&(t=i.cullGroupChildren(t,n.maxBounds),t==null))return null;switch(this.type){case 0:case 1:{if(n==null)return null;let a=!1,s=t;if(t.isAxisAlignedRectFill()){let l=G.new2();l.copyFrom(s.geometryBounds()),l.expand1(Re.EPSILON),a=l.contains1(n.maxBounds)}else if(t.isAxisAlignedRoundedRectFill()&&(Y.optimizationExposureLogging()&&Dt.didEncounterRoundedRectOptimization(),Y.roundedMaskOptimization())){let d=s.geometry.path().path().asRoundedRectPath().radii(),c=G.new2();c.copyFrom(s.geometryBounds()),c.expand1(Re.EPSILON);let p=Math.max(Math.max(d.topLeft,d.topRight),Math.max(d.bottomLeft,d.bottomRight)),u=Math.min(c.width()/2,c.height()/2);if(p<=u){let h=G.new2();if(h.copyFrom(s.geometryBounds()),h.expand1(Re.EPSILON),h.contains1(n.maxBounds)){let y=n.maxBounds,g=y.left(),A=y.right(),T=y.top(),b=y.bottom(),_=new I(h.left()+d.topLeft,h.top()+d.topLeft),m=new I(h.right()-d.topRight,h.top()+d.topRight),S=new I(h.left()+d.bottomLeft,h.bottom()-d.bottomLeft),v=new I(h.right()-d.bottomRight,h.bottom()-d.bottomRight);(g>=_.x()||T>=_.y()||Math.sqrt(Math.pow(g-_.x(),2)+Math.pow(T-_.y(),2))<=d.topLeft)&&(A<=m.x()||T>=m.y()||Math.sqrt(Math.pow(A-m.x(),2)+Math.pow(T-m.y(),2))<=d.topRight)&&(g>=S.x()||b<=S.y()||Math.sqrt(Math.pow(g-S.x(),2)+Math.pow(b-S.y(),2))<=d.bottomLeft)&&(A<=v.x()||b<=v.y()||Math.sqrt(Math.pow(A-v.x(),2)+Math.pow(b-v.y(),2))<=d.bottomRight)&&(a=!0)}}}if(a){let l=s.geometry.paints;if(Ne.containsAtLeastOneVisibleOpaquePaint(l))return n;let d=Ne.onlySolidPaintOrNull(l);if(d!=null)return new jr("PASS_THROUGH",E.alphaF(d.color())*d.opacity(),n).optimized()}break}case 4:{if(n==null)return null;let a=t.maxBounds,s=n.maxBounds;if(!a.overlaps(s))return n;if(!t.hasVolatileContent()&&a.contains1(s))return null;break}case 2:{if(E.alpha(this.innerShadowFill)==0)return null;if(n==null&&t.op()==3&&!this.innerShadowAlphaRequiresHardMask){let a=t,s=a.geometry.paints,l=Ne.onlySolidPaintOrNull(s);if(l!=null)return a.withPaints([ie.createSolid(E.multiplyOpacity(this.innerShadowFill,E.alphaF(l.color())),1)])}if(t.op()==9&&n!=null){let a=t;return new i(a.alpha,n,this.type,this.innerShadowFill,!0)}break}case 3:break}return t==this.alpha&&n==this.color?(this._isOptimized=!0,this):(n==null&&(n=new ze([])),new i(t,n,this.type,this.innerShadowFill,this.innerShadowAlphaRequiresHardMask))}equalsWithinBounds(t,n){if(t==this||n!=null&&!t.maxBounds.overlaps(n)&&!this.maxBounds.overlaps(n))return!0;if(t.op()!=this.op())return!1;let r=t;return this.type==r.type&&this.innerShadowFill==r.innerShadowFill&&this.alpha.equalsWithinBounds(r.alpha,n)&&this.color.equalsWithinBounds(r.color,n)}static createForInnerShadow(t,n,r){return new i(t,n,2,r,!1)}static createForBackgroundBlur(t,n){return new i(t,n,3,E.TRANSPARENT,!1)}static createForKnockoutShadow(t,n){return new i(t,n,4,E.TRANSPARENT,!1)}static createForLuminanceMask(t,n){return new i(t,n,1,E.TRANSPARENT,!1)}static cullGroupChildren(t,n){if(t!=null&&!t.maxBounds.overlaps(n))return null;if(t!=null&&t.op()==1){let r=t,o=r.children.length;for(let a=0;a<o;a=a+1)if(!r.children[a].maxBounds.overlaps(n)){let l=r.children.slice(0,a);for(;(a=a+1)<o;)r.children[a].maxBounds.overlaps(n)&&l.push(r.children[a]);return ze.wrap(l).optimized()}}return t}},go=class i extends Nn{constructor(t,n){super(E.alpha(n)>0?t.maxBounds:G.INVALID,h1(t));this.alpha=t,this.color=n}op(){return 9}computeBounds(t){return E.alpha(this.color)>0?this.alpha.currentBounds(t):G.INVALID}optimized(){if(this._isOptimized)return this;if(this.maxBounds.isEmpty())return null;let t=this.alpha.optimized();if(t==null)return null;if(t.op()==10){let r=t;return new at(new i(r.child,this.color),r.id,r.property,r.getter).optimized()}t=Gb(t,r=>(r.op()==7&&(r=r.child),r));let n=Gb(t,r=>{if(r.op()==3){let o=r;if(!Ne.hasVolatilePaints(o.geometry.paints)&&!Ne.hasAnyFullyTransparentAreas(o.geometry.paints))return o.withPaints([ie.createSolid(this.color,1)])}return r});return n!=t?n:t==this.alpha?(this._isOptimized=!0,this):new i(t,this.color)}equalsWithinBounds(t,n){if(t==this||n!=null&&!t.maxBounds.overlaps(n)&&!this.maxBounds.overlaps(n))return!0;if(t.op()!=this.op())return!1;let r=t;return this.color==r.color&&this.alpha.equalsWithinBounds(r.alpha,n)}},Jr=class i extends Nn{constructor(t,n,r){super(Hb(t,n,null),m1(n));this.radius=t,this.child=n,this.clamp=r}op(){return 6}computeBounds(t){return Hb(this.radius,this.child,t)}optimized(){if(this._isOptimized)return this;if(this.maxBounds.isEmpty())return null;let t=this.child.optimized();if(t==null)return null;if(this.radius==0)return t;if(t.op()==10&&this.clamp.isInvalid()){let n=t;return new at(new i(this.radius,n.child,this.clamp),n.id,n.property,n.getter).optimized()}return t==this.child?(this._isOptimized=!0,this):new i(this.radius,t,this.clamp)}equalsWithinBounds(t,n){if(t==this||n!=null&&!t.maxBounds.overlaps(n)&&!this.maxBounds.overlaps(n))return!0;if(t.op()!=this.op())return!1;let r=t;return this.radius==r.radius&&this.clamp.equals(r.clamp)&&this.child.equalsWithinBounds(r.child,n)}},jr=class i extends Nn{constructor(t,n,r){super(n>0?r.maxBounds:G.INVALID,g1(t,r));this.blendMode=null,this.opacity=0,this.child=null,this.blendMode=t,this.opacity=n,this.child=r}op(){return 7}computeBounds(t){return this.opacity>0?this.child.currentBounds(t):G.INVALID}optimized(){var r;if(this._isOptimized)return this;if(this.opacity==0||this.maxBounds.isEmpty())return null;let t=this.child.optimized();if(t==null)return null;if(this.opacity==1&&(this.blendMode=="PASS_THROUGH"||this.blendMode=="NORMAL"&&!t.hasNonIsolatedBlends()))return t;if((this.blendMode=="PASS_THROUGH"||this.blendMode=="NORMAL")&&t.op()==3){let o=t,a=(r=Ne.onlyPaintOrNull(o.geometry.paints))==null?void 0:r.asSinglePaint();if(a!=null){let s=a.cloneAsSinglePaint();return s.setOpacity(s.opacity()*this.opacity),o.withPaints([s])}}let n=this.opacity;if(t.op()==7){let o=t;this.blendMode==o.blendMode&&(this.blendMode=="PASS_THROUGH"||this.blendMode=="NORMAL")&&(n=o.opacity*n,t=o.child)}return n==this.opacity&&t==this.child?(this._isOptimized=!0,this):new i(this.blendMode,n,t)}equalsWithinBounds(t,n){if(t==this||n!=null&&!t.maxBounds.overlaps(n)&&!this.maxBounds.overlaps(n))return!0;if(t.op()!=this.op())return!1;let r=t;return this.blendMode==r.blendMode&&this.opacity==r.opacity&&this.child.equalsWithinBounds(r.child,n)}},Bp=class{constructor(e,t){this.tileHandleOrNull=null,this.neededImagesOrNull=null,this.key=e,this._cache=t}canvasSpaceBounds(){return this.key.bounds}textureRegionOrNull(){return this._cache.textureRegionOrNull(this)}bounds(){return this.key.bounds}};var Vp=class extends Nn{constructor(t,n){super(Wb(t,null),t.flags);this._tiles=new Map,this._devicePixelsPerCanvasPixel=-1,this.tree=t,this._tileCache=n}op(){return 8}optimized(){return this._isOptimized=!0,this}computeBounds(t){return Wb(this.tree,t)}equalsWithinBounds(t,n){if(t==this||n!=null&&!t.maxBounds.overlaps(n)&&!this.maxBounds.overlaps(n))return!0;if(t.op()!=this.op())return!1;let r=t;return this._tileCache==r._tileCache&&this.maxBounds.equals(r.maxBounds)&&this.tree.equalsWithinBounds(r.tree,n)}setDevicePixelPerCanvasPixel(t){this._devicePixelsPerCanvasPixel!=t&&(this._tiles=new Map,this._devicePixelsPerCanvasPixel=t)}numTilesNeededForBounds(t){let n=G.new3(t);n.intersectWith(this.maxBounds);let r=new I(Math.floor(this.maxBounds.left()),Math.floor(this.maxBounds.top())),o=yn.TILE_SIZE/this._devicePixelsPerCanvasPixel,a=Math.floor((n.left()-r.x())/o)|0,s=Math.ceil((n.right()-r.x())/o)|0,l=Math.floor((n.top()-r.y())/o)|0,d=Math.ceil((n.bottom()-r.y())/o)|0;return(s-a)*(d-l)}forEachTileWithinBounds(t,n,r){if(!n.overlaps(this.maxBounds))return;let o=G.new3(n);o.intersectWith(this.maxBounds);let a=new I(Math.floor(this.maxBounds.left()),Math.floor(this.maxBounds.top())),s=yn.TILE_SIZE/this._devicePixelsPerCanvasPixel,l=Math.floor((o.left()-a.x())/s)|0,d=Math.ceil((o.right()-a.x())/s)|0,c=Math.floor((o.top()-a.y())/s)|0,p=Math.ceil((o.bottom()-a.y())/s)|0,u=a.y()+c*s;for(let h=c;h<p;h=h+1,u+=s){let f=Ht.IntMap_get(this._tiles,h,null);f==null&&(f=new Map,this._tiles.set(h,f));let y=a.x()+l*s;for(let g=l;g<d;g=g+1,y+=s){let A=Ht.IntMap_get(f,g,null);if(A!=null){let _=A.value;_!=null&&r(_);continue}if(t==1)continue;let T=new G(y,u,s,s),b=this._tileCache.getOrInsertOrNull(this.tree,T);f.set(g,new _e(b)),b!=null&&r(b)}}}};var at=class i extends Nn{constructor(t,n,r,o){super(u1(t,r),t.flags|8);this.child=t,this.id=n,this.property=r,this.getter=o}op(){return 10}computeBounds(t){switch(this.property){case 2:{let n=this.child.currentBounds(t).clone();return this.transform().transformRect(n),n}case 1:case 3:case 4:case 5:return this.child.currentBounds(t);case 0:return this.maxBounds;default:throw new Error(`Unhandled VolatileProperty value: ${Pa.VolatileProperty_toString(this.property)}`)}}transform(){return this.getter()}opacity(){return+this.getter()}maxTransformScale(){return+this.getter()}optimized(){if(this._isOptimized)return this;let t=this.child.optimized();return t==null||t.maxBounds.isEmpty()?null:t!=this.child?new i(t,this.id,this.property,this.getter):(this._isOptimized=!0,this)}equalsWithinBounds(t,n){if(t==this||n!=null&&!t.maxBounds.overlaps(n)&&!this.maxBounds.overlaps(n))return!0;if(t.op()!=this.op())return!1;let r=t;return this.id==r.id&&this.property==r.property&&this.child.equalsWithinBounds(r.child,n)}static forTranslation(t,n,r){let o=ne.new2();return i.forTransform(t,n,()=>(o.copyFrom(vt.FrozenAffineTransform_IDENTITY),o.translatedBy1(r())))}static forTransform(t,n,r){return new i(t,n,2,r)}static forOpacity(t,n,r){return new i(t,n,4,r)}static forTransformIsolation(t){let n="ID_FOR_TRANSFORM_ISOLATION";return new i(t,n,1,null)}static forMaxTransformScale(t,n){let r=`ID_FOR_MAX_TRANSFORM_SCALE_${t}`;return new i(n,r,3,()=>t)}static forInverseTransform(t){let n="ID_FOR_INVERSE_TRANSFORM";return new i(t,n,0,null)}static forStateSwap(t){let n="ID_FOR_STATE_SWAP";return new i(t,n,5,null)}},wr=class i extends Nn{constructor(t,n){super(p1(t,n),t.flags);this.child=t,this.transform=n}op(){return 11}computeBounds(t){return this.maxBounds}optimized(){if(this._isOptimized)return this;let t=this.child.optimized();return t==null||t.maxBounds.isEmpty()?null:this.transform.equals1(vt.FrozenAffineTransform_IDENTITY)?t:t!=this.child?new i(t,this.transform):(this._isOptimized=!0,this)}equalsWithinBounds(t,n){if(t==this||n!=null&&!t.maxBounds.overlaps(n)&&!this.maxBounds.overlaps(n))return!0;if(t.op()!=this.op())return!1;let r=t;return this.transform.equals1(r.transform)&&this.child.equalsWithinBounds(r.child,n)}},dr=class i extends Nn{constructor(t,n,r,o){super(zb(t,n,null),(t!=null?t.flags:0)|(n!=null?n.flags:0)|8);this.startChild=t,this.endChild=n,this.id=r,this.progressFn=o}op(){return 12}computeBounds(t){return zb(this.startChild,this.endChild,t)}progress(){return this.progressFn()}optimized(){if(this._isOptimized)return this;let t=this.startChild!=null?this.startChild.optimized():null,n=this.endChild!=null?this.endChild.optimized():null,r=t!=null&&!t.maxBounds.isEmpty(),o=n!=null&&!n.maxBounds.isEmpty();if(!r&&!o)return null;if(r)if(o){if(this.startChild.equals(this.endChild))return this.startChild}else return new at(t,this.id,4,()=>1-this.progressFn());else return new at(n,this.id,4,()=>this.progressFn());return this.startChild!=t||this.endChild!=n?new i(t,n,this.id,this.progressFn):(this._isOptimized=!0,this)}equalsWithinBounds(t,n){if(t==this||n!=null&&!t.maxBounds.overlaps(n)&&!this.maxBounds.overlaps(n))return!0;if(t.op()!=this.op())return!1;let r=t;return this.id==r.id&&this.startChild.equalsWithinBounds(r.startChild,n)&&this.endChild.equalsWithinBounds(r.endChild,n)}},Pa;(e=>{function i(t){switch(t){case 0:return"INVERSE_TRANSFORM";case 1:return"TRANSFORM_ISOLATION";case 2:return"TRANSFORM";case 3:return"MAX_TRANSFORM_SCALE";case 4:return"OPACITY";case 5:return"STATE_SWAP";default:throw new Error("Unhandled VolatileProperty value")}}e.VolatileProperty_toString=i})(Pa||(Pa={}));function l1(i){let e=0;for(let t of i)for(let n=0,r=t.length;n<r;n=n+1)Ne.hasAnimatingMediaPaints(t[n].paints)&&(e|=16),Ne.hasVolatilePaints(t[n].paints)&&(e|=8);return e}function Gb(i,e){if(i.op()==11){let t=i,n=e(t.child);return n==t.child?t:n!=null?new wr(n,t.transform):null}else return e(i)}function Up(i){return i.op()==11?i.child:i}function yb(i){if(i.op()==11){let e=i;return new ar(e.child,e.transform)}else if(i.op()==10){let e=i;if(e.property==2)return new ar(e.child,e.transform())}return new ar(i,null)}function cf(i,e){let t=new _t;for(let n of i)t.include3(n.currentBounds(e));return t.isValid()?t.build():G.INVALID}function df(i,e,t,n){if(t==2)return i.currentBounds(n);if(t==4)return e.currentBounds(n);if(Re.emulateFullscreenRenderingBugs&&t==3)return i.currentBounds(n);let r=i.currentBounds(n).clone();return r.intersectWith(e.currentBounds(n)),r}function Hb(i,e,t){if(e.currentBounds(t).isEmpty())return e.currentBounds(t);let n=e.currentBounds(t).clone();return n.expand1(i),n}function Gp(i,e){let t=new _t,n=!1;for(let o=0,a=e.length;o<a;o=o+1){let s=e[o];t.include3(s.maxBounds),s.canBeAnalyticallyAntialiased()&&(n=!0)}if(!t.isValid())return G.INVALID;let r=t.build();return i.transformRect(r),n&&r.expand1(4),r}function c1(i,e,t,n){if(n==0)return Gp(i,e);let r=new _t;return r.include3(Gp(i,e)),r.include3(Gp(i,t)),r.isValid()?r.build():G.INVALID}function d1(i,e){return Gp(i,[e])}function u1(i,e){switch(e){case 2:case 0:{let t=G.new2();return t.copyFrom(i.maxBounds),t.expandedBy1(1e6),t}case 4:case 3:case 1:case 5:return i.maxBounds;default:throw new Error(`Unhandled property ${Pa.VolatileProperty_toString(e)}`)}}function p1(i,e){return e.transformRect(G.new3(i.maxBounds))}function zb(i,e,t){let n=new _t;return i!=null&&n.include3(i.currentBounds(t)),e!=null&&n.include3(e.currentBounds(t)),n.build()}function Wb(i,e){let t=i.currentBounds(e).clone();return t.expand1(1),t}function Qb(i){let e=0;for(let t of i)e|=t.flags;return e}function Kb(i,e,t){let n=i.flags&-2|e.flags;return t!=0&&t!=4&&t!=1&&(n&=-2),t==2&&(n|=32),n}function h1(i){return i.flags&-2|32}function m1(i){return i.flags&-2}function g1(i,e){let t=e.flags;return i!="PASS_THROUGH"&&(t&=-2,t|=i!="NORMAL"?1:0),t}function f1(i){let e=0;return Ne.hasAnimatingMediaPaints(i.paints)&&(e|=16),(Ne.hasVolatilePaints(i.paints)||i.type==1)&&(e|=8),e}var Bo;(c=>{function i(p){if(ht.int_remainder(p.byteCount(),c.NUM_BYTES_PER_FLOAT)!=0)return!1;let u=p.byteCount()/c.NUM_BYTES_PER_FLOAT|0;if(ht.int_remainder(u,c.NUM_FLOATS_PER_VERTEX)!=0)return!1;let h=u/c.NUM_FLOATS_PER_VERTEX|0;if(ht.int_remainder(h,3)!=0)return!1;if(p.byteCount()>w.BufferChunk.BYTE_COUNT)throw new Error("This triangles chunk exceeds the maximum buffer size and will crash if we try to render it");return!0}c.isValid=i;function e(p){return p.byteCount()/(c.NUM_BYTES_PER_FLOAT*c.NUM_FLOATS_PER_VERTEX)|0}c.numVertices=e;function t(p,u){let h=u*c.NUM_FLOATS_PER_VERTEX*c.NUM_BYTES_PER_FLOAT;return p.floatAt(h)}c.xValueAt=t;function n(p,u){let h=u*c.NUM_FLOATS_PER_VERTEX*c.NUM_BYTES_PER_FLOAT;return p.floatAt(h+1*c.NUM_BYTES_PER_FLOAT)}c.yValueAt=n;function r(p,u){let h=t(p,u),f=n(p,u);return new I(h,f)}c.xyValueAt=r;function o(p,u){let h=u*c.NUM_FLOATS_PER_VERTEX*c.NUM_BYTES_PER_FLOAT;return p.floatAt(h+2*c.NUM_BYTES_PER_FLOAT)}c.kValueAt=o;function a(p,u){let h=u*c.NUM_FLOATS_PER_VERTEX*c.NUM_BYTES_PER_FLOAT;return p.floatAt(h+3*c.NUM_BYTES_PER_FLOAT)}c.lValueAt=a;function s(p,u){let h=u*c.NUM_FLOATS_PER_VERTEX*c.NUM_BYTES_PER_FLOAT;return p.floatAt(h+4*c.NUM_BYTES_PER_FLOAT)}c.mValueAt=s,c.NUM_BYTES_PER_FLOAT=4,c.NUM_FLOATS_PER_VERTEX=5})(Bo||(Bo={}));var Wr=class Wr{static UNIT_RECT(){return Wr._UNIT_RECT!=null||(Wr._UNIT_RECT=new Wr(Nt.fromRect(new G(0,0,1,1)),"NONZERO")),Wr._UNIT_RECT}static getOrCreate(e,t){return Wr._uniqueValues.getOrInsertFallback(new Wr.PathAndWindingRuleArgs(e,t))}constructor(e,t){this._path=null,this._windingRule=null,this._cachedTriangles=null,this._path=e,this._windingRule=t}equals(e){return e==null?!1:this._windingRule==e._windingRule&&this._path.equals2(e._path)}bounds(){return this._path.bounds()}isRect(){return this._path.isRect()}path(){return this._path}windingRule(){return this._windingRule}triangles(e,t){return this._cachedTriangles==null&&(this._cachedTriangles=this._convertToTriangles(e,t)),this._cachedTriangles}_allTrianglesHaveSameOrientation(e){let t=0;for(let n=0;n<Bo.numVertices(e);n=n+3){let r=Bo.xyValueAt(e,n),o=Bo.xyValueAt(e,n+1),a=Bo.xyValueAt(e,n+2),s=I.cross(o.subtract1(r),a.subtract1(r)),l=s<0?-1:s>0?1:0;if(l!=0){if(t==-l)return!1;t=l}}return!0}_convertToTriangles(e,t){let n=[],r=null;if(this._path instanceof co)r=this._path.compileLoopBlinnAndReturnVolatileTriangles();else{Wr.TEMP_ARRAY.clear();let d=this._path.toBezierPath();Zu.compile(d,Wr.TEMP_ARRAY),r=Wr.TEMP_ARRAY.bytes()}let o=t.stride()*3,a=w.BufferChunk.BYTE_COUNT,s=a-ht.int_remainder(a,o),l=(r.length+s-1)/s|0;for(let d=0,c=l;d<c;d=d+1){let p=r.subarray(d*s,d*s+s),u=new gr(p),h=e.allocate(t,p);if(h==null)continue;let f=!0;for(let A=0,T=Bo.numVertices(u);A<T;A=A+1){let b=Bo.kValueAt(u,A),_=Bo.lValueAt(u,A),m=Bo.mValueAt(u,A);if(b!=.5||_!=.5||m!=.5){f=!1;break}}let y=Bo.numVertices(u)==3||this.isRect(),g=f&&this._allTrianglesHaveSameOrientation(u);n.push(new Hp(h,f,y,g))}return l>1&&console.warn(`splitting ${r.length} byte geometry buffer into ${l} chunks`),n}};Wr.TEMP_ARRAY=new gr,Wr._UNIT_RECT=null,Wr._uniqueValues=new Ei(e=>e.hash,(e,t)=>e.equals(t),e=>new Wr(e.path,e.windingRule));var Pt=Wr;(e=>{class i{constructor(n,r){this.path=null,this.windingRule=null,this.hash=0,this.path=n,this.windingRule=r,this.hash=so.combine(n.hash(),r=="ODD"?1:0)}equals(n){return this.windingRule==n.windingRule&&this.path.equals2(n.path)}}e.PathAndWindingRuleArgs=i})(Pt||(Pt={}));var lf=(t=>(t[t.STATIC_REGION=0]="STATIC_REGION",t[t.DYNAMIC_REGION=1]="DYNAMIC_REGION",t))(lf||{}),zp=class{path(){throw new Error("Not implemented")}bounds(){throw new Error("Not implemented")}geometryEquals(e){throw new Error("Not implemented")}constructor(e,t,n){this.type=e,this.windingRule=t,this.styleID=n}},Wn=class i extends zp{constructor(t,n,r,o){super(0,t,n);this._path=null,this._bounds=null,this._path=r,this._bounds=o}path(){return this._path}bounds(){return this._bounds}geometryEquals(t){return t instanceof i?t.windingRule==this.windingRule&&t.bounds().equals(this._bounds)&&t.path().equals2(this._path):!1}},Jc=class extends zp{constructor(t,n,r,o){super(1,t,n);this._computePath=null,this._maxBounds=null,this._computePath=r,this._maxBounds=o}path(){return this._computePath()}bounds(){return this._maxBounds}geometryEquals(t){return t==this}},So=class{constructor(e){this._overrideTable=null,this._overrideTable=e}get(e,t){if(this._overrideTable!=null&&this._overrideTable._in(e)){let n=this._overrideTable.styleByID1(e),r=n!=null?Ko.get(n,92,null):null,o=null;if(r!=null&&(o=t.findStyle(Ze.asStyleId(r))),o==null){let s=n!=null?Ze.asGUID(Ko.get(n,52,null)):null;o=t.findNode1(s)}if(o!=null)return o.fillPaints();let a=n!=null?Ko.get(n,59,null):null;if(a!=null)return Ze.asPaintList(a)}return null}forEachPaint(e,t){var n;(n=this._overrideTable)==null||n.forEachFillPaint(e,t)}table(){return this._overrideTable}},Vn=class{geometryEquals(e){return ue.List_equalsWithComparison(this.regions,e.regions,(t,n)=>t.geometryEquals(n))}isRect(){return this.regions.length==1?Pt.getOrCreate(this.regions[0].path(),this.regions[0].windingRule).isRect():!1}toString(){return`Geometry(bounds: ${this.bounds} with ${this.regions.length} regions)`}constructor(e,t,n,r){this.regions=e,this.styleIDs=t,this.bounds=n,this.paintOverrides=r}},Op=class extends Vn{constructor(t,n,r,o,a){super(t,n,r,o);this.emojiCodepoints=a}},Mt=class i{static equals(e,t){if(e!=null&&t!=null&&e.guids.length==t.guids.length){for(let n=0,r=e.guids.length;n<r;n=n+1)if(!ee.equals(e.guids[n],t.guids[n]))return!1;return!0}return e==t}static equalsGUID(e,t){return e!=null&&t!=null&&e.guids.length==1?ee.equals(e.guids[0],t):e==null&&t==null}toString(){return`[${this.guids.map(e=>e).join(", ")}]`}startsWith(e){if(this.guids==null)return e.guids==null;if(this.guids.length<e.guids.length)return!1;for(let t=0,n=e.guids.length;t<n;t=t+1)if(!ee.equals(e.guids[t],this.guids[t]))return!1;return!0}slice1(e){return this.slice2(e,this.guids.length)}slice2(e,t){return new i(this.guids.slice(e,t))}cloneAndAppend(e){let t=this.guids.slice();return On(t,e.guids),new i(t)}static fromString(e){if(e!=null&&e.length>=2&&e.startsWith("[")&&e.endsWith("]")){let t=e.slice(1,e.length-1).split(","),n=[];for(let r of t){let o=ee.fromString(r.trim());if(o==null)return null;n.push(o)}return new i(n)}return null}constructor(e){this.guids=e}},Vo;(r=>{function i(o){return o}r.map=i;function e(o){let a=[];return o.each((s,l)=>{a.push(`
  `+s.toString()+": "+pn.toString(l))}),a.join(", ")}r.toString=e;function t(){return new Eo(o=>o.toString())}r._new=t;function n(o,a){let s=new Eo(l=>l.toString());for(let l=0,d=o.length;l<d;l=l+1)s.set(o[l],a[l]);return s}r.new1=n})(Vo||(Vo={}));var ia=class{toString(){return`SymbolData(id=${this.masterID}, overrides=[${Vo.toString(this.instanceOverrides)}])`}constructor(e,t){this.masterID=e,this.instanceOverrides=t}},Wp=class{constructor(e,t){this.value=e,this.units=t}toString(){return`${this.value} ${this.units}`}},Qp=class{constructor(e,t,n){this.family=e,this.style=t,this.postscript=n}toString(){return`${this.family} ${this.style}`}},Rl=class{constructor(e,t){this.type=e,this.value=t}},Kp=class{constructor(e,t,n,r){this.suffix=e,this.imageType=t,this.constraint=n,this.contentsOnly=r}},Di=class i{static DEFAULT_FOR_TESTS(){return new i("DEFAULT_FLOW_FOR_TESTS","default flow for tests",sn.FIRST_POSITION)}constructor(e,t,n){this.name=e,this.description=t,this.position=n}},qp=class qp{size(){switch(this.rotation){case"NONE":return this.nonRotatedSize;case"CCW_90":return this.nonRotatedSize.flipped()}return this.nonRotatedSize}canvasSpaceImageSize(e){let t=e.nonRotatedImageSize.divide(e.scaleFactor);switch(this.rotation){case"NONE":return t;case"CCW_90":return t.flipped()}return t}canvasSpaceTopLeftOffset(e){let t=e.nonRotatedOffset,n=e.nonRotatedImageSize.divide(e.scaleFactor),r=e.nonRotatedFramePresetSize;switch(this.rotation){case"NONE":return t;case"CCW_90":return new I(t.y(),n.x()-r.x()-t.x())}return t}canvasSpaceFramePresetSize(e){let t=e.nonRotatedFramePresetSize;switch(this.rotation){case"NONE":return t;case"CCW_90":return t.flipped()}return t}os(){return this.presetIdentifier==null||this.presetIdentifier==""?0:this.presetIdentifier.indexOf("APPLE")!=-1?this.presetIdentifier.indexOf("MACBOOK")!=-1?4:2:this.presetIdentifier.indexOf("GOOGLE")!=-1?1:this.presetIdentifier.indexOf("MICROSOFT")!=-1?5:(console.error(`${this.presetIdentifier} OS could not be inferred`),0)}toString(){return`PrototypeDevice(${this.type}, ${this.size()}, ${this.presetIdentifier}, ${this.rotation})`}toJSON(){return{type:this.type,size:{x:this.size().x(),y:this.size().y()},presetIdentifier:this.presetIdentifier,rotation:this.rotation}}constructor(e,t,n,r){this.type=e,this.nonRotatedSize=t,this.presetIdentifier=n,this.rotation=r}};qp.DEFAULT=new qp("NONE",new I(0,0),null,"NONE");var Tr=qp,ni=class{constructor(){if(arguments.length==0)this.backgroundType="NONE",this.backgroundColor=E.new3(0,0,0,.25);else if(arguments.length==2){let e=arguments[0],t=arguments[1];this.backgroundType="NONE",this.backgroundColor=E.new3(0,0,0,.25),this.backgroundType=e,this.backgroundColor=t}}},zn=class{constructor(){if(arguments.length==0)this._styleByID=null,this._styleByID=new Map;else if(arguments.length==1){let e=arguments[0];this._styleByID=null,this._styleByID=e}}_in(e){return this._styleByID.has(e)}styleByID1(e){return this._styleByID.get(e)}forEachStyle(e){for(let t of Array.from(this._styleByID.keys()))e(t,this._styleByID.get(t))}styleByID2(){return this._styleByID}forEachFillPaint(e,t){this.forEachStyle((n,r)=>{let o=Ko.get(r,92,null),a=null;if(o!=null&&(a=e.findStyle(Ze.asStyleId(o))),a==null){let s=r!=null?Ze.asGUID(Ko.get(r,52,null)):null;a=e.findNode1(s)}if(a!=null){let s=a.fillPaints();s!=null&&t(s)}else if(Ko._in(r,59)){let s=Ze.asPaintList(Ko.get(r,59,null));s!=null&&t(s)}})}};var gd=class{constructor(e,t,n){this.exitingTransitionRoot=e,this.swappedStablePath=t,this.hotspotInExitingTree=n}},qb;(e=>{function i(t){return lf[t]}e.RegionType_toString=i})(qb||(qb={}));function td(i){return!i.hasNodeProperty(84)||i.prototypeStartingPoint()==null?!1:i.prototypeStartingPoint().name!=""||i.prototypeStartingPoint().description!=""||i.prototypeStartingPoint().position!=null&&sn.isValid(i.prototypeStartingPoint().position)}var jb=(r=>(r[r.REQUESTED=0]="REQUESTED",r[r.INITIATED=1]="INITIATED",r[r.ABORTED=2]="ABORTED",r[r.COMMITTED=3]="COMMITTED",r))(jb||{}),Po=class i{static ROOT_STABLE_PATH(){return new Mt([])}constructor(e){this.VERBOSE_LOGS=!1,this._appState=null,this._observers=new Xn,this._isNotifyingStateChangeObservers=!1,this._emitter=null,this._interactionsEnabled=!0,this._disableNewStateChanges=!1,this._currentFitMode=0,this.componentStateSyncer=null,this._onStateSwapFailedDueToCycle=null,this._isDragging=!1,this._actionCounter=0,this._transitionOnClick=!0,this._changeHistory=[],this._initiatedChange=null,this._initiatedHistory=null,this._lastInitiatedTopLevelStateChange=null,this._ongoingNavigateRepairsInvalidState=!1,this._shouldNotifyNavigationInfoInvalidated=!1,this._tlfHistory=[],this._upcomingTlfs=new Set,this._videoStateChangeHistory=[],this._screensNeedValidating=!1,this._removedPrimaryInstances=[],this._enqueueUpcomingTlfsDeadline=0,this._forceInitiateStateChangeForTests=!1,this._requestedStateChange=null,this._requestedStateChangeAtMs=-1,this._visitedScreenIds=new Ar,this._isApplyingStateChangeMutation=!1,this._isResettingStateChangeMutations=!1,this._hsmRoot=null,this._initiatedInstanceChanges=new Map,this._lastInitiatedInstanceStateChange=null,this._setVariableActionHistory=[],this._hsmObservers=new Xn,this._appState=e,this._appState.addAppObserver(this),this._appState.addFrameObserver(this),this.componentStateSyncer=new kc(this._appState,this,(t,n,r)=>this._getFullscreenNodeChangesForStateSwap(t,n,r)),this._emitter=qt.getEventEmitter(),this._hsmRoot=new Nl(this),this._onStateSwapFailedDueToCycle=()=>{this._emitter.trigger("stateSwapFailedDueToCycle",{})},this.resetState()}hasRequestedStateChange(){return this._requestedStateChange!==null}handleSceneChange(e,t){e!=null&&e.removeObserver(this),t!=null&&t.addObserver(this),this._hsmRoot=new Nl(this),this._initiatedInstanceChanges=new Map,t!=null&&this.createOrRepairStateMachinesForInsertedSubtree(t.root()),this._visitedScreenIds=new Ar,this._enforceValidPrototypeState()}resetState(){this.resetPrototype(),this._currentFitMode=0,this._transitionOnClick=!0}handleActiveCanvasChange(e,t){}handleActivePrototypeStartingPointChange(e,t){this._enforceValidPrototypeState()}handleSceneGraphEvent(e){if(Zr.isPrototypeStructuralChange(e.property)&&(this._screensNeedValidating=!0,this._deferEnqueueUpcomingTlfs()),e.property==98)Ze.asString(e.newVal)=="REMOVED"&&!this.isApplyingStateChangeMutation()&&e.node.isPrimaryInstance()&&this._removedPrimaryInstances.push(e.node.id());else if(e.property==75&&e.node.isInstance()){let t=e.node.symbolID()??ee.invalid();ee.isValid(t)||console.warn("Unexpected invalid symbolID for instance in instance generation"),this.createOrRepairInstanceStateMachineIfNeeded(e.node,t)}else if(e.property==25){let t=e.oldVal!=null&&Ze.isParentIndex(e.oldVal)?Ze.asParentIndex(e.oldVal):null,n=e.newVal!=null&&Ze.isParentIndex(e.newVal)?Ze.asParentIndex(e.newVal):null,r=t!=null?e.node.scene().findNode1(t.id):null,o=n!=null?e.node.scene().findNode1(n.id):null,a=r!=null&&r.isRooted(),s=o!=null&&o.isRooted();!a&&s?this.createOrRepairStateMachinesForInsertedSubtree(e.node):a&&!s&&(this.isApplyingStateChangeMutation()||ye.forEachNode(e.node,l=>{if(l.isInstance()){let d=this._getStateMachineOrNull(l.stablePath());if(d!=null)return this.commitInstanceStateChange(d),ye.Loop.SKIP}return ye.Loop.CONTINUE}))}else e.property==62&&Cn.clearCachedNodePaths()}didApplyNodeChanges(){if(this._screensNeedValidating&&(this._enforceValidPrototypeState(),this._screensNeedValidating=!1),this._removedPrimaryInstances.length>0){for(let e of this._removedPrimaryInstances)this.commitChangesBelowInstanceTransitionRoot(new Mt([e])),this._hsmRoot.removeChild(e);this._removedPrimaryInstances=[]}}onFrame(){this._shouldNotifyNavigationInfoInvalidated&&(this._emitter.trigger("navigationInfoInvalidated",null),this._shouldNotifyNavigationInfoInvalidated=!1),this._enqueueUpcomingTlfsDeadline!=0&&ke.milliseconds()>this._enqueueUpcomingTlfsDeadline&&this._enqueueUpcomingTlfs()}_filterOverlays(e){let t=e.length;for(let n=0;n<e.length;n=n+1){let r=this._appState.prototypeStructure().validDestinationForPrototypeFromId(e[n].id);if(r==null){t=n;break}r.setUsedAsBaseScreen(!1)}return t==e.length?e:e.slice(0,t)}_filterPresentedState(e){if(e==null)return null;if(e.stateId==null&&e.overlays.length==0)return e;let t=this._appState.prototypeStructure().validDestinationForPrototypeFromId(e.stateId);if(t==null)return new bn(null,[]);t.setUsedAsBaseScreen(!0);let n=this._filterOverlays(e.overlays);return n==e.overlays?e:new bn(e.stateId,n)}_filterChange(e){if(e==null)return null;let t=this._filterPresentedState(e.oldStateAndOverlays),n=this._filterPresentedState(e.newStateAndOverlays);return t==e.oldStateAndOverlays&&n==e.newStateAndOverlays?e:new Hn(1,i.ROOT_STABLE_PATH(),t,n)}enforceValidPrototypeStateForTesting(){this._enforceValidPrototypeState()}_enforceValidPrototypeState(){let e=!1;if(this._initiatedChange!=null){let r=this._initiatedChange.oldStateId()!=null&&this._appState.prototypeStructure().validDestinationForPrototypeFromId(this._initiatedChange.oldStateId())==null,o=this._appState.prototypeStructure().validDestinationForPrototypeFromId(this._initiatedChange.newStateId())==null;e=r||o}else if(this._changeHistory.length>0){let r=ue.List_last(this._changeHistory).newStateId();e=this._appState.prototypeStructure().validDestinationForPrototypeFromId(r)==null}else return;if(e){this.restartPrototype(0);return}let t=null,n=null;if(this._initiatedChange!=null){let r=this._filterChange(this._initiatedChange);this._initiatedChange!=r&&(n=this._initiatedHistory.slice(),t=r)}else if(this._changeHistory.length>0){let r=ue.List_last(this._changeHistory),o=this._filterChange(r);o!=r&&(n=this._changeHistory.slice(),t=o)}t!=null&&n!=null&&(ue.List_removeLast(n),n.push(t),this._requestStateChange(t,n),this.commitStateChange())}getTlfHistory(){return this._tlfHistory}getLastChangeInHistory(){return this._changeHistory.length<1?null:ue.List_last(this._changeHistory)}getHistoryCount(){return this._changeHistory.length}getInitiatedChange(){return this._initiatedChange}getCurrentBaseScreenId(){return this._initiatedChange!=null?this._initiatedChange.newStateAndOverlays.stateId:this._changeHistory.length>0?ue.List_last(this._changeHistory).newStateAndOverlays.stateId:null}getCurrentBaseScreenNode(){var t;let e=this.getCurrentBaseScreenId();return e==null?null:(t=this._appState.scene())==null?void 0:t.findNode1(e)}getCurrentBaseScreenIndex(){let e=this.getCurrentBaseScreenId();return e==null?-1:this._appState.prototypeStructure().topLevelPrototypeNodesInOrder().indexOf(e)}getNextBaseScreenIdForPrototype(){let e=this.getCurrentBaseScreenIndex(),t=this._appState.prototypeStructure().topLevelPrototypeNodesInOrder();return e<0?null:e>=t.length-1?this._getUpcomingTlf():ee.fromString(t[e+1])}getNextBaseScreenNodeForPrototype(){return this._appState.scene().findNode1(this.getNextBaseScreenIdForPrototype())}getNextBaseScreenIdForFrameList(){let e=this.getCurrentBaseScreenIndex(),t=this._appState.prototypeStructure().topLevelPrototypeNodesInOrder();return e<0||e>=t.length-1?null:ee.fromString(t[e+1])}getNextBaseScreenNodeForFrameList(){return this._appState.scene().findNode1(this.getNextBaseScreenIdForFrameList())}getPreviousBaseScreenId(){let e=this._appState.prototypeStructure().topLevelPrototypeNodesInOrder(),t=this.getCurrentBaseScreenIndex();return t<1?null:ee.fromString(e[t-1])}getPreviousBaseScreenNode(){return this._appState.scene().findNode1(this.getPreviousBaseScreenId())}getCurrentOverlays(){return this.bindOverlays(this.getCurrentOverlayData())}getCurrentOverlayData(){return this._initiatedChange!=null?this._initiatedChange.newOverlayData():this._changeHistory.length>0?ue.List_last(this._changeHistory).newOverlayData():[]}getCurrentOverlayIds(){return this.getCurrentOverlays().map(e=>e.id())}getOpenOverlayData(e){let t=this.getCurrentOverlays();for(let n=0,r=t.length;n<r;n=n+1){let o=t[n];if(ee.equals(o.id(),e))return o}return null}getTopmostScreenAndPoint(e){let t=this.getCurrentBaseScreenNode(),n=this.getTopmostOverlayNode();return n?[n,this.getTopmostOverlay().baseTlfSpaceToOverlaySpace1(t,e)]:[t,e]}getTopmostScreen(){return this.getTopmostOverlayNode()??this.getCurrentBaseScreenNode()}getTopmostScreenId(){return this.getTopmostOverlayId()??this.getCurrentBaseScreenId()}getTopmostOverlay(){let e=this.getCurrentOverlays();return e.length>0?ue.List_last(e):null}getTopmostOverlayId(){let e=this.getCurrentOverlays();return e.length>0?ue.List_last(e).id():null}getTopmostOverlayNode(){var t;let e=this.getCurrentOverlays();return e.length==0?null:(t=this._appState.scene())==null?void 0:t.findNode1(ue.List_last(e).id())}getSecondTopmostOverlayNodeOrBaseScreen(){var t;let e=this.getCurrentOverlays();return e.length==0?null:e.length==1?this.getCurrentBaseScreenNode():(t=this._appState.scene())==null?void 0:t.findNode1(e[e.length-2].id())}getLayersIds(){let e=this.getCurrentBaseScreenId();if(e==null)return[];let t=this.getCurrentOverlayIds().slice();return t.unshift(e),t}getPreviousNonTransientChange(){let e=this._changeHistory.slice();for(;e.length>0&&ue.List_last(e).isTransientChange();)e.pop();if(e.length==0)return null;for(;e.length>0;){let t=e.pop();if(!(e.length>0&&ue.List_last(e).isTransientChange()||this._appState.prototypeStructure().validDestinationForPrototypeFromId(t.oldStateId())==null))return t}return null}bindOverlays(e){let t=[];for(let n=0,r=e.length;n<r;n=n+1)t.push(new Yc(this._appState.scene(),e[n],n>0?t[n-1]:null,n));return t}getOngoingNavigateRepairsInvalidState(){return this._ongoingNavigateRepairsInvalidState}lastNodeForBaseScreen(){var t;let e=null;return this._initiatedChange!=null?e=this._initiatedChange.oldStateId():this._changeHistory.length>0&&(e=ue.List_last(this._changeHistory).newStateId()),e==null?null:(t=this._appState.scene())==null?void 0:t.findNode1(e)}nextNodeForBaseScreen(){var e,t;return((e=this._initiatedChange)==null?void 0:e.newStateId())==null?null:(t=this._appState.scene())==null?void 0:t.findNode1(this._initiatedChange.newStateId())}lastNodeForOverlayAt(e){var n;let t=null;if(this._initiatedChange!=null)t=this._initiatedChange.oldOverlayData();else if(this._changeHistory.length>0)t=ue.List_last(this._changeHistory).newOverlayData();else return null;return t.length<=e?null:(n=this._appState.scene())==null?void 0:n.findNode1(t[e].id)}nextNodeForOverlayAt(e){var n;if(this._initiatedChange==null)return null;let t=this._initiatedChange.newOverlayData();return t.length<=e?null:(n=this._appState.scene())==null?void 0:n.findNode1(t[e].id)}displayedOverlayCount(){return this._initiatedChange!=null?Math.max(this._initiatedChange.oldOverlayData().length,this._initiatedChange.newOverlayData().length):this._changeHistory.length>0?ue.List_last(this._changeHistory).newOverlayData().length:0}nodeForOverlayAt(e){var n;let t=this.getCurrentOverlayData();return t.length<=e?null:(n=this._appState.scene())==null?void 0:n.findNode1(t[e].id)}getCurrentFitMode(){return this._currentFitMode}setFitModeFromParameter(e){let t=2;switch(e){case"contain":{t=1;break}case"scale-down":{t=2;break}case"min-zoom":{t=3;break}case"scale-down-width":{t=5;break}case"fit-width":{t=6;break}case"free":{t=4;break}default:break}if(t!=this._currentFitMode){let n=this._currentFitMode;this._currentFitMode=t,this._notifyFitModeChange(n,this._currentFitMode)}}_notifyFitModeChange(e,t){this._observers.forEach(n=>{n.handleFitModeChange(e,t)})}actionCounter(){return this._actionCounter}setTransitionOnClick(e){this._transitionOnClick=e}getTransitionOnClick(){return this._transitionOnClick}setInteractionsEnabled(e){this._interactionsEnabled=e}interactionsEnabled(){return this._interactionsEnabled}isDragging(){return this._isDragging}setIsDragging(e){this._isDragging=e}addObserver(e){this._observers.add(e)}removeObserver(e){this._observers.remove(e)}closeOverlayAtAndAbove(e,t){let n=Gr.getDefaultExternalExecution();this._closeOverlayAtAndAbove(e,n.interactionAddress,n.canvasSpaceTriggerBoundsOrNull,0,null,t)}closeOverlayForHotspot(e,t,n,r){var d;let o=null,a=null,s=0;e!=null&&t!=null?(o=(d=e.topLevelAncestor())==null?void 0:d.id(),a=Gr.forNoodle(e,t,r),s=Ut.TransitionAction_fromInteractionType(t.event().interactionType())):(Ve("closeOverlayForHotspot called with null hotspot"),o=this.getTopmostOverlayId(),a=Gr.getDefaultExternalExecution(),s=0);let l=this.getCurrentOverlayData();for(let c=l.length-1;c>=0;c=c-1)if(ee.equals(l[c].id,o)){this._closeOverlayAtAndAbove(c,a.interactionAddress,a.canvasSpaceTriggerBoundsOrNull,s,null,n);return}}_closeOverlayAtAndAbove(e,t,n,r,o,a){if(!this._allowNewStateChanges())return;this._clearInitiatedChangesBeforeNewChange();let s=this.getCurrentOverlayData();if(s.length>e){let l=Hn.forClosingTopNOverlays(s.length-e,this.getCurrentBaseScreenId(),s,t,n,r);if(o==null)switch(a){case 0:{o=this._changeHistory.slice();break}case 1:{o=en.FrozenList_cloneAndAppendOne(this._changeHistory,l);break}case 2:{o=[l];break}}this._requestStateChange(l,o)}}navigateToFrameAndCloseOverlays(e,t=null,n=2,r=0,o=0,a=null,s=null){var b;if(!this._allowNewStateChanges())return;this._clearInitiatedChangesBeforeNewChange();let l=this.getCurrentBaseScreenNode(),d=(b=this._appState.prototypeStructure())==null?void 0:b.getDestinationFrame(e);if(d!=null)this._appState.prototypeStructure().validDestinationForPrototypeFromId(d.id())||Pe.trackDefinedEvent("prototype.viewer_navigation_invalid_destination",{cause:o,nodeType:d.type(),interactionId:(a==null?void 0:a.id())??""}),d.setUsedAsBaseScreen(!0),e=d.id();else if(!Y.isInlinePreview())return;let c=this.getCurrentOverlayData();if(ee.equals(e,l==null?void 0:l.id())&&(l==null?void 0:l.scene())==(d==null?void 0:d.scene())&&c.length==0)return;let p=l!=null?l.id():null,u=[],h=t!=null&&a!=null?Gr.forNoodle(t,a,s):Gr.getDefaultExternalExecution(),f=new Hn(3,i.ROOT_STABLE_PATH(),new bn(p,c),new bn(e,u),h.interactionAddress,h.canvasSpaceTriggerBoundsOrNull,h.transitionParameters,r,o),y=null;switch(n){case 0:{y=this._changeHistory;break}case 1:{y=en.FrozenList_cloneAndAppendOne(this._changeHistory,f);break}case 2:{y=[f];break}}let g=!1,A=d,T=l;if(d!=null&&l!=null&&(A=d.findNearestAncestorSectionOrNull(),T=l.findNearestAncestorSectionOrNull(),g=A!=null&&T!=null),g){let _=this._getStateMachineOrNull(new Mt([A.id()]));if(_==null||this._shouldDisableNewChangesInStateMachine(_))return;_.clearInitiatedChangesInSelfAndSubstates();let m=null;switch(n){case 0:{m=_.changeHistory();break}case 1:{m=en.FrozenList_cloneAndAppendOne(_.changeHistory(),f);break}case 2:{m=[f];break}}if(this._requestAndSaveSectionStateChange(_,f,m,y),A!=T&&A.parent()==T){let S=new Hn(3,i.ROOT_STABLE_PATH(),new bn(p,c),new bn(A.id(),u),h.interactionAddress,h.canvasSpaceTriggerBoundsOrNull,h.transitionParameters,r,o),v=this._getStateMachineOrNull(new Mt([T.id()]));if(v==null||this._shouldDisableNewChangesInStateMachine(v))return;switch(v.clearInitiatedChangesInSelfAndSubstates(),n){case 0:{m=v.changeHistory();break}case 1:{m=en.FrozenList_cloneAndAppendOne(v.changeHistory(),S);break}case 2:{m=[S];break}}this._saveSectionStateChange(v,S,m)}}else this._requestStateChange(f,y)}overlayFrame(e,t,n,r,o,a){var f;if(!this._allowNewStateChanges()||this.getCurrentBaseScreenId()==null||t==null)return;this._clearInitiatedChangesBeforeNewChange();let s=o!=null?Gr.forNoodle(t,o,a):Gr.forExternalOpenOverlay(t),l=this.getCurrentOverlayData(),d=(f=this._appState.prototypeStructure())==null?void 0:f.getDestinationFrame(e);if(d==null){Ve("tried to open to null overlay");return}let c=new qc(d.id(),e,s.interactionAddress.hotspotStablePath,s.interactionAddress.interactionId,s.transitionParameters,this._getOverlayDerivedModes(this.getSecondTopmostOverlayNodeOrBaseScreen()??this.getCurrentBaseScreenNode(),d)),p=this.getCurrentBaseScreenId(),u=new Hn(3,i.ROOT_STABLE_PATH(),new bn(p,l),new bn(p,en.FrozenList_cloneAndAppendOne(l,c)),s.interactionAddress,s.canvasSpaceTriggerBoundsOrNull,s.transitionParameters,n,r);d.setUsedAsBaseScreen(!1);let h=en.FrozenList_cloneAndAppendOne(this._changeHistory,u);this._requestStateChange(u,h)}getSetVariableActionHistoryLength(){return this._setVariableActionHistory.length}createMultiplayerSetVariableAction(e,t,n,r){let o={nodeForFindingTopmostScreenId:ee.toFigGUID(e),targetVariableId:t,targetVariableData:JSON.stringify(n),resolvedVariableModes:JSON.stringify(r)};this._addVariableToHistory(o)}performMultiplayerSetVariableAction(e){D().runSetVariable(ee.fromFigGUID(e.nodeForFindingTopmostScreenId),e.targetVariableId,JSON.parse(e.targetVariableData),JSON.parse(e.resolvedVariableModes)),this._addVariableToHistory(e)}_addVariableToHistory(e){this._setVariableActionHistory.push(e),this._notifyMultiplayerSetVariableActionHistory()}_notifyMultiplayerSetVariableActionHistory(){this._observers.forEach(e=>{var t;(t=e.handleSetVariableAction)==null||t.call(e,this._setVariableActionHistory)})}resetVariablePrototypeState(){D().resetLocalVariableChanges(),this.resetSetVariableActionHistory()}resetSetVariableActionHistory(){this._setVariableActionHistory=[],this._notifyMultiplayerSetVariableActionHistory()}createVideoStateChange(e,t,n,r,o){if(e==null||t==null||n==null)return;let a={targetNodeId:ee.toFigGUID(e),isPlaying:t,isPlayingSound:n,currentTimes:r,actionTakenTimestamp:o};this._addVideoStateChangeToHistory(a)}performMultiplayerVideoStateChange(e,t){this._appState.videoManager().multiplayerUpdateVideoRuntimes(e,t),this._addVideoStateChangeToHistory(t)}_addVideoStateChangeToHistory(e){let t=!1;for(let n=0;n<this._videoStateChangeHistory.length;n++)if(ee.fromFigGUID(this._videoStateChangeHistory[n].targetNodeId)==ee.fromFigGUID(e.targetNodeId)){this._videoStateChangeHistory[n]=e,t=!0;break}t||this._videoStateChangeHistory.push(e),this._notifyMultiplayerVideoStateChangeToHistory()}_notifyMultiplayerVideoStateChangeToHistory(){this._observers.forEach(e=>{var t;(t=e.handleVideoStateChange)==null||t.call(e,this._videoStateChangeHistory)})}getVideoStateChange(e){return this._videoStateChangeHistory[e]}getVideoStateChanges(){return this._videoStateChangeHistory.slice()}resetVideoStateChangeHistory(){var t,n;let e=this._videoStateChangeHistory.slice();this._videoStateChangeHistory=[],(n=(t=this._appState.videoManager())==null?void 0:t.resetVideoStateChanges)==null||n.call(t,e)}resetSectionsState(){let e=this._appState.getActiveCanvas();if(e!=null){let t=e.findAllSectionsInNode();for(let n of t){let r=this._getStateMachineOrNull(new Mt([n.id()]));r!=null&&r.resetHistoryToFirstFrameInSection(n)}}}resetPrototype(){var e;this._appState.scene()!=null&&(this._clearInitiatedChangesBeforeNewChange(),this._isResettingStateChangeMutations=!0,(e=D())==null||e.resetLocalChanges(),this._initiatedInstanceChanges=new Map,this._isResettingStateChangeMutations=!1,this._clearOverlays(this.getCurrentOverlayData()),this.resetSectionsState(),Cn.clearCachedNodePaths(),this.componentStateSyncer.handleRestartPrototype()),this._initiatedChange=null,this._initiatedHistory=null,this._changeHistory=[],this._tlfHistory=[],this._upcomingTlfs=new Set,this.resetSetVariableActionHistory(),this.resetVideoStateChangeHistory(),this._actionCounter=this._actionCounter+1,this._lastInitiatedTopLevelStateChange=null,this._lastInitiatedInstanceStateChange=null}restartPrototype(e){var r;if(this.logVerbose(()=>`[PrototypeState] restartPrototype started for ${Fi[e]}`),this.resetPrototype(),this._observers.forEach(o=>{o.handleRestartPrototype()}),Y.getViewerMode()==Y.ViewerMode.MIRROR)return;if(((r=this._appState.scene())==null?void 0:r.findNode1(this._appState.activePrototypeStartingPointNodeId()))==null){let o=this._appState.prototypeStructure().activePrototypeStartNodeOrDefault();o!=null&&this._appState.setActivePrototypeStartingPointNodeId(o.id())}let n=this._appState.prototypeStructure().nodeToRestartPrototypeOn(this._appState.getActiveCanvas());n!=null&&(e==0&&(this._ongoingNavigateRepairsInvalidState=!0),this.navigateToFrameAndCloseOverlays(n.id()),this.tryToInitiateRequestedStateChange(i.InitiateRequestedStateChangePolicy.FORCE_INITIATE_NOW)),this.logVerbose(()=>`[PrototypeState] restartPrototype finished for ${Fi[e]}`)}returnToState1(e){this.returnToState2(null,null,e,0,null,null)}returnToState2(e,t,n,r,o,a){var p;if(!this._allowNewStateChanges()||this._changeHistory.length<=1)return;let s=n!=2,l=null;this._clearInitiatedChangesBeforeNewChange();let d=this._changeHistory.slice(),c=null;for(e!=null&&t!=null?c=Gr.forNoodle(e,t,a):c=Gr.getDefaultExternalExecution();d.length>1&&(s&&ue.List_last(d).isTransientChange());)l=d.pop();if(n==0||d.length<=1){((p=t==null?void 0:t.event())==null?void 0:p.interactionType())=="DRAG"&&this._returnToOverlayState(c,r,l==null?void 0:l.oldOverlayData(),l,d);return}for(l=ue.List_last(d);d.length>1;){let u=d.pop();if(d.length>1&&s&&ue.List_last(d).isTransientChange())continue;let f=u.oldStateId();if(ee.equals(f,this.getCurrentBaseScreenId()))this._returnToOverlayState(c,r,u.oldOverlayData(),l,d);else{if(this._appState.prototypeStructure().validDestinationForPrototypeFromId(u.oldStateId())==null)continue;this._returnToFrame(f,c,r,l,d,o)}break}}_returnToFrame(e,t,n,r,o,a){var h;let s=(h=this._appState.prototypeStructure())==null?void 0:h.getDestinationFrame(e),l=r.transitionParameters.withStateManagementSettings(a),d=new Hn(4,i.ROOT_STABLE_PATH(),new bn(this.getCurrentBaseScreenId(),this.getCurrentOverlayData()),new bn(e,[]),n,t.interactionAddress,1,l);if(s!=null)s.setUsedAsBaseScreen(!0);else{Ve("tried to return to deleted frame");return}let c=!1,p=s.findNearestAncestorSectionOrNull(),u=this.getCurrentBaseScreenNode().findNearestAncestorSectionOrNull();if(p!=null&&u!=null){if(p==u||p==u.parent()){let f=this._getStateMachineOrNull(new Mt([p.id()])),y=ue.List_last(f.changeHistory()),g=en.FrozenList_cloneAndRemoveOne(f.changeHistory(),y);this._requestAndSaveSectionStateChange(f,d,g,o),c=!0}else if(u==p.parent()){d=new Hn(4,i.ROOT_STABLE_PATH(),new bn(this.getCurrentBaseScreenId(),this.getCurrentOverlayData()),new bn(p.id(),[]),n,t.interactionAddress,1,r.transitionParameters);let f=this._getStateMachineOrNull(new Mt([u.id()])),y=ue.List_last(f.changeHistory()),g=en.FrozenList_cloneAndRemoveOne(f.changeHistory(),y);this._requestAndSaveSectionStateChange(f,d,g,o),c=!0}}c||this._requestStateChange(d,o)}_returnToOverlayState(e,t,n,r,o){var s;let a=this.getCurrentOverlayData();if(n.length<a.length)this._closeOverlayAtAndAbove(n.length,e.interactionAddress,e.canvasSpaceTriggerBoundsOrNull,t,o,0);else{for(let c=0,p=n.length;c<p;c=c+1){let u=(s=this._appState.prototypeStructure())==null?void 0:s.getDestinationFrame(n[c].id);if(u==null)break;u.setUsedAsBaseScreen(!1)}let l=this.getCurrentBaseScreenId(),d=new Hn(4,i.ROOT_STABLE_PATH(),new bn(l,this.getCurrentOverlayData()),new bn(l,n),t,e.interactionAddress,1,r.transitionParameters);this._requestStateChange(d,o)}}swapTopOverlay(e,t,n,r,o){var f;if(!this._allowNewStateChanges())return;let a=this.getCurrentOverlayData(),s=this.getCurrentBaseScreenId();if(s==null||a.length==0)return;this._clearInitiatedChangesBeforeNewChange();let l=(f=this._appState.prototypeStructure())==null?void 0:f.getDestinationFrame(e),d=a.slice();d[d.length-1]=d[d.length-1].cloneWithId(l.id(),this._getOverlayDerivedModes(this.getSecondTopmostOverlayNodeOrBaseScreen(),l));let c=null,p=0;t!=null&&r!=null?(c=Gr.forNoodle(t,r,o),p=Ut.TransitionAction_fromInteractionType(r.event().interactionType())):(c=Gr.getDefaultExternalExecution(),p=0);let u=new Hn(3,i.ROOT_STABLE_PATH(),new bn(s,a),new bn(s,d),c.interactionAddress,c.canvasSpaceTriggerBoundsOrNull,c.transitionParameters,0,p);if(l==null){Ve("tried to swap to null overlay");return}l.setUsedAsBaseScreen(!1);let h=en.FrozenList_cloneAndAppendOne(this._changeHistory,u);this._requestStateChange(u,h)}_clearInitiatedChangesBeforeNewChange(){this._disableNewStateChanges=!0,this._appState.scene()!=null&&this._forEachTransitioningStateMachine(e=>{let t=this._getStateMachineOrNull(e);return t!=null&&t.clearInitiatedChangesInSelfAndSubstates(),ye.Loop.CONTINUE}),this._initiatedChange!=null&&this.commitStateChange(),this._disableNewStateChanges=!1}_allowNewStateChanges(){return this.interactionsEnabled()&&!this._disableNewStateChanges}abortStateChange(){if(this._initiatedChange==null)return;let e=this._initiatedChange;this._initiatedChange=null,this._initiatedHistory=null,this._broadcastStateChange(e,2,null),this._handleOverlaysModeSetting(e,2),this._enforceValidPrototypeState()}commitStateChange(){if(this._initiatedChange==null)return;let e=this._initiatedChange;this._changeHistory=this._initiatedHistory,this._initiatedChange=null,this._initiatedHistory=null,this.logVerbose(()=>`[PrototypeState] commitTopLevelChange ${e.debugString(this._appState.scene())}`);let t=[],n=r=>{t.push(r)};if(this._broadcastStateChange(e,3,n),this._handleOverlaysModeSetting(e,3),this._allowNewStateChanges())for(let r of t)r();Y.isInlinePreview()||this._enforceValidPrototypeState()}_enqueueUpcomingTlfs(){let e=this.getCurrentBaseScreenNode();if(e==null)return;let t=Bt.adjacentBaseScreens(this._appState.prototypeStructure().nodeTransitionTracker().cleanedUpTransitionMapByTLF(),e);for(let n of t.asList())this._upcomingTlfs.add(n);this._shouldNotifyNavigationInfoInvalidated=!0,this._enqueueUpcomingTlfsDeadline=0}_getUpcomingTlf(){for(;this._upcomingTlfs.size>0;){let e=Bt.visuallySortLayersLeftToRightAndTopToBottom2(this._appState.scene(),Array.from(this._upcomingTlfs.values()).map(t=>ee.fromString(t)))[0];if(this._appState.prototypeStructure().topLevelPrototypeNodesInOrder().indexOf(e)>=0){this._upcomingTlfs.delete(e);continue}return this._appState.scene().findNode2(e)==null?null:ee.fromString(e)}return null}setForceInitiateStateChangeForTests(e){this._forceInitiateStateChangeForTests=e}_requestStateChange(e,t){var n;this._broadcastStateChange(e,0,null),this._requestedStateChange=new i.StateChangeRequest(e,t),this._requestedStateChangeAtMs=ke.milliseconds(),this._emitter.trigger("requestedStateChange",{interactionId:(n=e==null?void 0:e.interactionAddress)==null?void 0:n.interactionId,cause:Tn[e.cause],destinationId:e.newStateId()}),this._disableNewStateChanges=!0,this.tryToInitiateRequestedStateChange(i.InitiateRequestedStateChangePolicy.WAIT_UNTIL_DESTINATIONS_LOADED)}_requestAndSaveSectionStateChange(e,t,n,r){this._appState.scene()!=null&&(e.stage(t,n),this._requestStateChange(t,r),ee.equals(t.oldStateId(),t.newStateId())||this.commitSectionStateChange(e))}_saveSectionStateChange(e,t,n){this._appState.scene()!=null&&(e.stage(t,n),ee.equals(t.oldStateId(),t.newStateId())||this.commitSectionStateChange(e))}tryToInitiateRequestedStateChange(e){this._requestedStateChange!=null&&(this._forceInitiateStateChangeForTests||e==i.InitiateRequestedStateChangePolicy.FORCE_INITIATE_NOW?this._initiateStateChange(this._requestedStateChange.change,this._requestedStateChange.history):this._requestedStateChange.change.newStateAndOverlays.statesAndOverlaysIncluded().asList().every(r=>{var a;let o=(a=this._appState.scene())==null?void 0:a.findNode2(r);return o==null?!1:o.hasBeenLoaded()})&&this._initiateStateChange(this._requestedStateChange.change,this._requestedStateChange.history))}_maybeTrackStateChangeInitiated(e){var n;let t=e.newStateAndOverlays.statesAndOverlaysIncluded();for(let r of t.asList())this._visitedScreenIds._in(r)||this._visitedScreenIds.add(r);if(this._requestedStateChangeAtMs>0){let r=ke.milliseconds()-this._requestedStateChangeAtMs;if(r>100){let o={prototypeType:Oi[this._appState.prototypeStructure().currentType()],incrementalFrameLoading:!0,timeWaitedForLoadingMs:r,interactionId:(n=e==null?void 0:e.interactionAddress)==null?void 0:n.interactionId,interactionCause:Tn[e.cause],destinationId:e.newStateId()},a=this._appState.requestedFrameMetricsTracker().getMetricsForRequestedNode(e.newStateId());this._appState.requestedFrameMetricsTracker().clear(),a&&(o.destinationWasLoaded=a.wasAlreadyLoaded,o.destinationWasInWorkingSet=a.wasAlreadyInWorkingSet),Pe.trackDefinedEvent("prototype.viewer_reached_unloaded_frame",o)}}}_initiateStateChange(e,t){this._disableNewStateChanges=!0;for(let o of e.getRemovedFrameIds())this._forEachMaterializedStateInTlf(o,a=>{if(a.changeHistory().length>0&&ue.List_last(a.changeHistory()).isTransientChange()){let s=Ut.TransitionAction_getOppositeTransientAction(ue.List_last(a.changeHistory()).cause);return this.returnInstanceToState(a.stablePath,0,s),a.clearInitiatedChangesInSelfAndSubstates(),ye.Loop.SKIP}return ye.Loop.CONTINUE});this._emitter.trigger("requestedStateChangeInitiated",{}),this._maybeTrackStateChangeInitiated(e),this._requestedStateChange=null,this._requestedStateChangeAtMs=-1,this._disableNewStateChanges=!1,this._initiatedChange=e,this._initiatedHistory=t;let n=e.newStateId();this._tlfHistory.indexOf(n)<0&&ue.List_appendOne(this._tlfHistory,n),this._shouldNotifyNavigationInfoInvalidated=!0,this.logVerbose(()=>`[PrototypeState] initiateTopLevelChange ${e.debugString(this._appState.scene())}`),this._lastInitiatedTopLevelStateChange=e,this._actionCounter=this._actionCounter+1,this._broadcastStateChange(e,1,null),this._handleOverlaysModeSetting(e,1),(e==null?void 0:e.oldStateId())!=(e==null?void 0:e.newStateId())&&(this._ongoingNavigateRepairsInvalidState=!1),e.direction==1&&e.transitionParameters.transitionType=="INSTANT_TRANSITION"&&this.commitStateChange(),this._deferEnqueueUpcomingTlfs()}_handleOverlaysModeSetting(e,t){let n=e.oldOverlayData(),r=n.length,o=e.newOverlayData(),a=o.length;if(!(a==0&&r==0)){if(a>r)t==1?this._setOverlaysToParentModes(o.slice(r),e.oldStateAndOverlays.topId()):t==2&&this._clearOverlays(o.slice(r));else if(a<r&&t==3)this._clearOverlays(n.slice(a));else if(a>0&&r>0&&o[a-1].id!=n[r-1].id){let s=[o[a-1]];t==1?this._setOverlaysToParentModes(s,this.getSecondTopmostOverlayNodeOrBaseScreen().id()):t==2&&this._clearOverlays(s),t==3&&this._clearOverlays([n[r-1]])}}}_getOverlayDerivedModes(e,t){let n=t.getExplicitVariableModes(),r=t.getResolvedVariableModes(),o=e.getResolvedVariableModes();return Object.entries(o).filter(([a,s])=>r[a]!=null&&n[a]==null)}_setOverlaysToParentModes(e,t){var r;let n=t;e.forEach(o=>{let a=this._appState.scene().findNode1(o.id),s=this._appState.scene().findNode1(n),l=s.getResolvedVariableModes(),d=[];this._getOverlayDerivedModes(s,a).forEach(([c,p])=>{a.setExplicitVariableModeForCollection(c,l[c]),d.push([c,l[c]])}),o.newOverlayExplicitModes=d,n=o.id}),(r=D())==null||r.updateImmutableFramesAndLayoutDirtyGroupsAndStacks()}_clearOverlays(e){var t;e.forEach(n=>{let r=this._appState.scene().findNode1(n.id);if(r==null)return;let o=r.getExplicitVariableModes();n.oldOverlayDerivedModes.filter(([a,s])=>o[a]!=null&&(n.newOverlayExplicitModes[a]==null||o[a]==n.newOverlayExplicitModes[a])).forEach(([a,s])=>{r.clearExplicitVariableConsumerModeForCollection(a)})}),(t=D())==null||t.updateImmutableFramesAndLayoutDirtyGroupsAndStacks()}lastInitiatedTopLevelStateChange(){return this._lastInitiatedTopLevelStateChange}_broadcastStateChange(e,t,n){let r=this._isNotifyingStateChangeObservers;switch(r&&Ve("[PrototypeState] An observer performed a prototype state change while another state change was still being broadcasted."),this._isNotifyingStateChangeObservers=!0,t){case 0:{this._observers.forEach(o=>{o.handleStateChangeRequested(e)});break}case 1:{this._observers.forEach(o=>{o.handleStateChangeInitiated(e)});break}case 2:{this._observers.forEach(o=>{o.handleStateChangeAborted(e)});break}case 3:{this._observers.forEach(o=>{o.handleStateChangeCommitted(e,n)});break}}this._isNotifyingStateChangeObservers=r}debugHSMTree(){Y.getFeatureFlags().prototype_state_management&&(console.log("== Component SST =="),console.log(this.componentStateSyncer.debugString()),console.log("== Component HSM ==")),console.log(this._hsmRoot.debugHierarchy(this._appState.scene()))}addHsmObserver(e){this._hsmObservers.add(e)}removeHsmObserver(e){this._hsmObservers.remove(e)}_getStateMachineOrNull(e){let t=e==null?void 0:e.guids;if(t==null)return null;let n=this._hsmRoot;for(let r of t){if(n==null)break;n=n.childOrNull(r)}return n}getStateMachineOrNull(e){return this._getStateMachineOrNull(e)}_getStateMachineOrNullWithString(e){return this._getStateMachineOrNull(Mt.fromString(e))}_getParentStateMachineOrNull(e){return e.guids.length==0?null:this._getStateMachineOrNull(e.slice2(0,e.guids.length-1))}_forMaterializedStateMachineAndDescendants(e,t){var o;let r=[this._getStateMachineOrNull(e)];for(;r.length>0;){let a=r.pop();if(a!=null){let s=((o=this._appState.scene())==null?void 0:o.findNode3(a.stablePath))==null,l=0;s?a==this._hsmRoot?l=ye.Loop.CONTINUE:l=ye.Loop.SKIP:l=t(a);let d=!1;switch(l){case ye.Loop.BREAK:{d=!0;break}case ye.Loop.CONTINUE:{On(r,a.getChildren());break}case ye.Loop.SKIP:continue}if(d)break}}}createOrRepairStateMachinesForInsertedSubtree(e){ye.forEachNode(e,t=>{if(t.isInstance()){let n=t.symbolID()??ee.invalid();ee.isValid(n)||console.warn("Unexpected null symbolData for instance in instance generation"),this.createOrRepairInstanceStateMachineIfNeeded(t,n)}else t.type()=="SECTION"&&this.createOrRepairSectionStateMachineIfNeeded(t,t.id())})}createOrRepairSectionStateMachineIfNeeded(e,t){let n=this._getParentStateMachineOrNull(e.stablePath());if(n==null){Ve("Could not create or repair state machine for section with null parent");return}let r=ue.List_last(e.stablePath().guids),o=n.childOrNull(r);if(o!=null)if(ee.equals(o.stateId(),t)){this._isResettingStateChangeMutations&&o.resetHistoryToFirstFrameInSection(e);return}else o.initiatedChange()!=null&&this.commitSectionStateChange(o);n.setChild(r,new Nl(this,e,t,!0))}createOrRepairInstanceStateMachineIfNeeded(e,t){let n=this._getParentStateMachineOrNull(e.stablePath());if(n==null){console.warn("Could not create or repair state machine with null parent");return}let r=ue.List_last(e.stablePath().guids),o=n.childOrNull(r);if(o!=null){if(ee.equals(o.stateId(),t)){this._isResettingStateChangeMutations&&o.resetHistoryToState(t);return}else if(o.initiatedChange()!=null){if(this.isApplyingStateChangeMutation())return;this.commitInstanceStateChange(o)}}n.setChild(r,new Nl(this,e,t))}actionCounterForState(e){let t=this._getStateMachineOrNull(e);return t==null?-1:t.actionCounter}actionCountersForStateAndAncestors(e){let t=[this.actionCounter()];for(let n=0,r=e.guids.length;n<r;n=n+1)t.push(this.actionCounterForState(e.slice2(0,n+1)));return t}getStateMachineInitiatedChange(e){let t=this._getStateMachineOrNull(e);return t==null?void 0:t.initiatedChange()}getStateMachineLastChangeInHistory(e){let t=this._getStateMachineOrNull(e);return t==null||t.changeHistory().length==0?null:t!=null?ue.List_last(t.changeHistory()):null}getLastFrameOrSectionVisitedInSection(e){if(e==null)return null;let t=this.getStateMachineLastChangeInHistory(new Mt([e]));return t!=null?t.newStateAndOverlays.stateId:null}getState(e){let t=this._getStateMachineOrNull(e);return t==null?void 0:t.stateId()}_forEachMaterializedStateInTlf(e,t){var r;let n=(r=this._appState.scene())==null?void 0:r.findNode1(e);n==null||!n.isTopLevel()||ye.forEachNode(n,o=>{if(o.isInstance()){let a=this._getStateMachineOrNull(o.stablePath());if(a!=null)return t(a)}return ye.Loop.CONTINUE})}_forEachTransitioningStateMachine(e){for(let t of Array.from(this._initiatedInstanceChanges.keys()))if(Array.from(this._initiatedInstanceChanges.keys()).indexOf(t)!=-1){let n=this._initiatedInstanceChanges.get(t);if(e(n.stablePath)==ye.Loop.BREAK)break}}getOnscreenStates(){let e=[],t=this.getLayersIds();for(let n of t)this._forEachMaterializedStateInTlf(n,r=>{if(2==0){let o=this._appState.scene().findNode3(r.stablePath)}return e.push(new ar(r.stablePath,r.stateId())),ye.Loop.CONTINUE});return e}forMaterializedStateInstanceAndDescendants(e,t){this._forMaterializedStateMachineAndDescendants(e,n=>t(n.stablePath))}_deferEnqueueUpcomingTlfs(){this._enqueueUpcomingTlfsDeadline=ke.milliseconds()+(jo?0:250)}lastInitiatedInstanceStateChange(){return this._lastInitiatedInstanceStateChange}_forStateMachineAndParents(e,t){let n=e.guids,r=[],o=this._hsmRoot,a=0;for(;o!=null&&a<n.length;)o=o.childOrNull(n[a]),o!=null&&r.push(o),a=a+1;if(!(r.length==0||!Mt.equals(ue.List_last(r).stablePath,e))){for(let s=r.length-1;s>=0;s=s-1)if(t(r[s])==ye.Loop.BREAK)return}}_shouldDisableNewChangesInStateMachine(e){var r;let t=(r=this._appState.scene())==null?void 0:r.findNode3(e.stablePath);if(t==null)return!0;let n=t;for(;n!=null;){let o=this._getStateMachineOrNull(n.stablePath());if(o!=null&&o.isClearingChangesInSelfAndSubstates())return!0;n=n.parent()}return!1}swapInstanceToState1(e,t,n,r,o,a){this.swapInstanceToState2(e,t,n,r,o,a,null)}swapInstanceToState2(e,t,n,r,o,a,s){this.logVerbose(()=>`[HSM] >>>>>>>> swap instance ${e} to state -> ${t} cause: ${Tn[r]}`);let l=this._getStateMachineOrNull(e);if(l==null||this._shouldDisableNewChangesInStateMachine(l)||this._validatedStateSwapDestination(l.stateId(),t)==null)return;l.clearInitiatedChangesInSelfAndSubstates();let c=n!=null&&o!=null?Gr.forNoodle(n,o,s):Gr.getDefaultExternalExecution(),p=new Hn(2,l.stablePath,l.stateId(),t,c.interactionAddress,c.canvasSpaceTriggerBoundsOrNull,c.transitionParameters,r),u=null;switch(a){case 0:{u=l.changeHistory();break}case 1:{u=en.FrozenList_cloneAndAppendOne(l.changeHistory(),p);break}case 2:{u=[p];break}}let h=this._shouldDisallowSwap(e,t);h==1?this._onStateSwapFailedDueToCycle():h==0&&this._requestInstanceStateChange(l,p,u)}returnInstanceToState(e,t,n){this.logVerbose(()=>`[HSM] >>>>>>>> return instance ${e} to previous state cause: ${Tn[n]}`);let r=this._getStateMachineOrNull(e);if(r==null||this._shouldDisableNewChangesInStateMachine(r)||(r.clearInitiatedChangesInSelfAndSubstates(),r.changeHistory().length<=1))return;let o=r.cloneHistoryForReturnToState(t,(p,u)=>this._validatedStateSwapDestination(p,u)),a=o.a,s=o.b,l=this._validatedStateSwapDestination(r.stateId(),ue.List_last(s).newStateId());if(l==null)return;let d=new Hn(2,r.stablePath,r.stateId(),l.id(),a.interactionAddress,a.canvasSpaceTriggerBoundsOrNull,a.transitionParameters,n),c=this._shouldDisallowSwap(r.stablePath,l.id());c==1?this._onStateSwapFailedDueToCycle():c==0&&this._requestInstanceStateChange(r,d,s)}_requestInstanceStateChange(e,t,n){this._forMaterializedStateMachineAndDescendants(e.stablePath,o=>o!=e&&o.changeHistory().length>0&&ue.List_last(o.changeHistory()).isTransientChange()?(this.returnInstanceToState(o.stablePath,0,0),o.clearInitiatedChangesInSelfAndSubstates(),ye.Loop.SKIP):ye.Loop.CONTINUE);let r=this._appState.scene();if(r!=null){e.stage(t,n),this._initiatedInstanceChanges.set(e.stablePath.toString(),t),this._lastInitiatedInstanceStateChange=t;let o=this._appState.scene().findNode3(t.interactionAddress.hotspotStablePath),a=new Map,s=null;this._isApplyingStateChangeMutation=!0,e.broadcastHsmStateChange(this._hsmObservers,t,0,null),r.dangerouslyDeferNodeRemovalScope(()=>{let c=this._getFullscreenNodeChangesForStateSwap(e.stablePath,t.newStateId(),0);for(let p of c.cloneOps)p.clone.copyNodeCachedTransformAndBounds(p.source),a.set(p.source,p.clone);s=this._appState.scene().findNode3(c.transitionRootStablePath)});let l=Mc.Map_getOrDefault(a,o,null),d=Mc.Map_getOrDefault(a,s,null);s!=null&&d!=null?s.transitioningFrom=new gd(d,t.stablePath,l):Ve("Failed to find swapped out node after state swap"),ee.equals(t.oldStateId(),t.newStateId())||(this._forEachTransitioningStateMachine(c=>{if(!Mt.equals(t.stablePath,c)){let p=r.findNode3(c);if(s!=null&&s.isAncestorOf(p)){let u=this._getStateMachineOrNull(c);this.commitInstanceStateChange(u)}}return ye.Loop.CONTINUE}),this._deferEnqueueUpcomingTlfs()),this._isApplyingStateChangeMutation=!1}e.actionCounter=e.actionCounter+1,e.broadcastHsmStateChange(this._hsmObservers,t,1,null),this.logVerbose(()=>`[HSM] initiate ${t.oldStateId()} -> ${t.newStateId()} finished for ${e.stablePath} -- ${t.transitionParameters.transitionType} !`)}commitChangesBelowStablePath(e){var n,r;let t=(n=this._appState.scene())==null?void 0:n.findNode3(e);for(let o of Array.from(this._initiatedInstanceChanges.keys())){let a=this._initiatedInstanceChanges.get(o),s=this._getStateMachineOrNull(a.stablePath);s!=null&&t!=null&&t.isAncestorOf((r=this._appState.scene())==null?void 0:r.findNode3(s.stablePath))&&this.commitInstanceStateChange(s)}}commitChangesBelowInstanceTransitionRoot(e){let t=this._findTransitionRootForSwappedPath(e),n=t==null?e:t.stablePath();this.commitChangesBelowStablePath(n)}commitInstanceStateChange(e){if(e.initiatedChange()==null)return;let t=e.initiatedChange();e.setChangeHistory(e.initiatedChangeHistory()),e.stage(null,null),this._initiatedInstanceChanges.delete(e.stablePath.toString()),ee.equals(t.oldStateId(),t.newStateId())||this._finishStateSwapMutation(t.stablePath);let n=[],r=o=>{n.push(o)};if(e.broadcastHsmStateChange(this._hsmObservers,t,3,r),!e.isClearingChangesInSelfAndSubstates())for(let o of n)o();this.logVerbose(()=>`[HSM] commit ${t.oldStateId()} -> ${t.newStateId()} finished for ${t.stablePath} -- ${t.transitionParameters.transitionType} !`)}commitSectionStateChange(e){e.initiatedChange()!=null&&(e.setChangeHistory(e.initiatedChangeHistory()),e.stage(null,null))}abortInstanceStateChange(e){let t=this._getStateMachineOrNull(e);if(t==null||t.initiatedChange()==null)return;let n=t.initiatedChange();if(this._appState.scene()!=null){t.stage(null,null),this._initiatedInstanceChanges.delete(t.stablePath.toString());let o=this._findTransitionRootForSwappedPath(e),a=o.transitioningFrom.exitingTransitionRoot;this._isApplyingStateChangeMutation=!0,o.transitioningFrom=null,a.removeSelfAndSubtree(),t.broadcastHsmStateChange(this._hsmObservers,n,0,null),this._getFullscreenNodeChangesForStateSwap(t.stablePath,n.oldStateId(),1),this._isApplyingStateChangeMutation=!1}t.broadcastHsmStateChange(this._hsmObservers,n,2,null),this.logVerbose(()=>`[HSM] abort ${n.oldStateId()} -> ${n.newStateId()} finished for ${t.stablePath} -- ${n.transitionParameters.transitionType} !`)}_validatedStateSwapDestination(e,t){var s,l;let n=(s=this._appState.scene())==null?void 0:s.findNode1(e),r=n==null?void 0:n.parent();if((n==null?void 0:n.type())!="SYMBOL"||r==null||!r.isStateGroup())return null;let o=(l=this._appState.scene())==null?void 0:l.findNode1(t),a=o==null?void 0:o.parent();return(o==null?void 0:o.type())!="SYMBOL"||a==null||!a.isStateGroup()||ee.equals(e,t)?null:ee.equals(r.id(),a.id())?o:null}isApplyingStateChangeMutation(){return this._isApplyingStateChangeMutation}isResettingStateChangeMutations(){return this._isResettingStateChangeMutations}_findTransitionRootForSwappedPath(e){var n;let t=(n=this._appState.scene())==null?void 0:n.findNode3(e);for(;t!=null;){if(t.transitioningFrom!=null&&t.transitioningFrom.swappedStablePath==e)return t;t=t.parent()}return null}_finishStateSwapMutation(e){let t=this._findTransitionRootForSwappedPath(e);if(this.logVerbose(()=>`[PrototypeState] _finishStateSwapMutation started for ${e}`),t==null)return;let n=t.transitioningFrom.exitingTransitionRoot;this._isApplyingStateChangeMutation=!0,t.transitioningFrom=null,n.removeSelfAndSubtree(),this._isApplyingStateChangeMutation=!1,t.invalidateRenderTreeForSelfAndParents(),t.invalidateRenderTreeForChildren(),this.logVerbose(()=>`[PrototypeState] _finishStateSwapMutation finished for ${e}`)}_getFullscreenNodeChangesForStateSwap(e,t,n){return D().getNodeChangesForSwap(e,t,n)}_shouldDisallowSwap(e,t){return D().shouldDisallowSwap(e,t)}logVerbose(e){this.VERBOSE_LOGS&&(this.debugHSMTree(),console.log(e()))}};(n=>{class i{constructor(o,a){this.change=o,this.history=a}}n.StateChangeRequest=i;let e;(a=>(a[a.WAIT_UNTIL_DESTINATIONS_LOADED=0]="WAIT_UNTIL_DESTINATIONS_LOADED",a[a.FORCE_INITIATE_NOW=1]="FORCE_INITIATE_NOW"))(e=n.InitiateRequestedStateChangePolicy||(n.InitiateRequestedStateChangePolicy={}));let t;(o=>{function r(a){return n.InitiateRequestedStateChangePolicy[a]}o.InitiateRequestedStateChangePolicy_toString=r})(t=n.in_InitiateRequestedStateChangePolicy||(n.in_InitiateRequestedStateChangePolicy={}))})(Po||(Po={}));var Fi=(t=>(t[t.FIX_INVALID_STATE=0]="FIX_INVALID_STATE",t[t.USER_REQUESTED=1]="USER_REQUESTED",t))(Fi||{}),fd=(n=>(n[n.LAST_NONTRANSIENT_STATE=0]="LAST_NONTRANSIENT_STATE",n[n.BEFORE_LAST_NONTRANSIENT_STATE=1]="BEFORE_LAST_NONTRANSIENT_STATE",n[n.BEFORE_LAST_ANY_STATE=2]="BEFORE_LAST_ANY_STATE",n))(fd||{}),Oa=(s=>(s[s.NONE=0]="NONE",s[s.CONTAIN=1]="CONTAIN",s[s.SCALE_DOWN=2]="SCALE_DOWN",s[s.MIN_ZOOM=3]="MIN_ZOOM",s[s.FREE=4]="FREE",s[s.SCALE_DOWN_TO_FIT_WIDTH=5]="SCALE_DOWN_TO_FIT_WIDTH",s[s.FIT_WIDTH=6]="FIT_WIDTH",s))(Oa||{});var Yp=class{handleStateChangeAborted(e){}handleStateChangeCommitted(e,t){this.callback(e)}handleStateChangeInitiated(e){}handleStateChangeRequested(e){}handleFitModeChange(e,t){}handleRestartPrototype(){}handleSetVariableAction(e){}constructor(e){this.callback=e}},Nl=class{constructor(e,t,n,r){this.stablePath=null,this._changeHistory=null,this._initiatedChange=null,this._initiatedChangeHistory=null,this._isNotifyingStateChangeObservers=!1,this.actionCounter=0,this._children=new Map,this._isClearingChangesInSelfAndSubstates=!1,this._prototypeState=e,t?(this.stablePath=t.stablePath(),r?this.resetHistoryToFirstFrameInSection(t):this.resetHistoryToState(n)):(this.stablePath=new Mt([]),this.setChangeHistory([]))}changeHistory(){return this._changeHistory}setChangeHistory(e){this._changeHistory=e}debugHierarchy(e){return this._debugHierarchy(0,e)}_debugHierarchy(e,t){let n="";for(let u=0,h=e;u<h;u=u+1)n+="  ";n+=this.stablePath.toString()+": ";let r="missing state name",o="(N/A)";if(this.stateId()!=null){let u=t.findNode1(this.stateId());u!=null&&(r=u.name()??"null state name"),o="("+this.stateId()+")"}n+="<"+r+" "+o+">";let a="[",s=0,l=3,d=this.changeHistory();d.length>l&&(a+="..., ",s=d.length-l);for(let u=s,h=d.length;u<h;u=u+1){let f=d[u];a+=`${(f==null?void 0:f.oldStateId())??"null"}->${f==null?void 0:f.newStateId()}`,u!=d.length-1&&(a+=", ")}a+="]",n+=" "+a;let c=t.findNode3(this.stablePath);if(c!=null){let u=c.name()??"null node name";n+=" "+u}let p=this.initiatedChange()!=null?`{${this.initiatedChange().oldStateId()??"null"}->${this.initiatedChange().newStateId()}}`:"";n+=" "+p+`
`;for(let u of Array.from(this._children.values()))n+=u._debugHierarchy(e+1,t);return n}removeChild(e){this._children.delete(e)}setChild(e,t){this._children.set(e,t)}childOrNull(e){return Be.StringMap_get(this._children,e,null)}getChildren(){return Array.from(this._children.values())}stage(e,t){this._initiatedChange=e,this._initiatedChangeHistory=t}initiatedChange(){return this._initiatedChange}initiatedChangeHistory(){return this._initiatedChangeHistory}stateId(){var t,n;if(((t=this.initiatedChange())==null?void 0:t.newStateId())!=null)return(n=this.initiatedChange())==null?void 0:n.newStateId();let e=this.changeHistory();return e!=null&&e.length>0?ue.List_last(e).newStateId():ee.invalid()}clearInitiatedChangesInSelfAndSubstates(){this._isClearingChangesInSelfAndSubstates=!0,this._prototypeState.commitChangesBelowInstanceTransitionRoot(this.stablePath),this._isClearingChangesInSelfAndSubstates=!1}isClearingChangesInSelfAndSubstates(){return this._isClearingChangesInSelfAndSubstates}cloneHistoryForReturnToState(e,t){let n=e!=2,r=null,o=this.changeHistory().slice();for(;o.length>1&&(n&&ue.List_last(o).isTransientChange());)r=o.pop();if(e==0||o.length<=1)return new ar(r,o);for(r=ue.List_last(o);o.length>1;){let a=o.pop();if(!(o.length>1&&n&&ue.List_last(o).isTransientChange()||t(a.newStateId(),a.oldStateId())==null))break}return new ar(r,o)}resetHistoryToState(e){let t=new Hn(2,this.stablePath,null,e,fo.EXTERNAL,null,Jn.getDefault(),0);this.setChangeHistory([t])}resetHistoryToFirstFrameInSection(e){let t=Bt.visuallySortedTopLevelFrames(e);if(t.length>0){let n=t[0];if(n!=null){let r=new Hn(2,this.stablePath,null,n.id(),fo.EXTERNAL,null,Jn.getDefault(),0);this.setChangeHistory([r])}}else this.setChangeHistory([])}broadcastHsmStateChange(e,t,n,r){let o=this._isNotifyingStateChangeObservers;switch(o&&console.warn("[PrototypeState] An observer performed a prototype state change while another state change was still being broadcasted."),this._isNotifyingStateChangeObservers=!0,n){case 0:{e.forEach(a=>{a.handleHsmRequested(this.stablePath,t)});break}case 1:{e.forEach(a=>{a.handleHsmInitiated(this.stablePath,t)});break}case 2:{e.forEach(a=>{a.handleHsmAborted(this.stablePath,t)});break}case 3:{e.forEach(a=>{a.handleHsmCommitted(this.stablePath,t,r)});break}}this._isNotifyingStateChangeObservers=o}},Yb;(e=>{function i(t){return jb[t]}e.StateChangePhase_toString=i})(Yb||(Yb={}));var Xb;(e=>{function i(t){return Fi[t]}e.RestartCause_toString=i})(Xb||(Xb={}));var Jb;(e=>{function i(t){return fd[t]}e.ReturnTo_toString=i})(Jb||(Jb={}));var Ss;(n=>{function i(r,o){return r!=1&&r!=2&&r!=5&&r!=6&&!(r==3&&o)}n.FitMode_userCanManuallyZoom=i;function e(r){return r!=1&&r!=2&&r!=0&&r!=4}n.FitMode_topLevelFramesCanScroll=e;function t(r){return Oa[r]}n.FitMode_toString=t})(Ss||(Ss={}));var ka={requestedEmbedAPIOrigin:null};function Zb(){try{if(window.top===window)return null;if(window.location.origin===window.parent.location.origin)return window.location.origin}catch{return null}}var aa;(g=>{function i(A){g._mockEmbedListener=A}g.setMockListener=i;function e(A,T,b){T.addObserver(new p(A,T)),g._prototypeObserver=new u(A),ka=b,A.prototypeState().addObserver(g._prototypeObserver),A.prototypeState().addHsmObserver(g._prototypeObserver),qt.getEventEmitter().on("sceneDidCompleteInitialLoad",m=>{A.scene().addObserver(g._prototypeObserver),n(0,{})}),qt.getEventEmitter().on("requestClose",m=>{n(5,{})});let _=window;_!==null&&_.addEventListener("message",m=>{if(Y.getFeatureFlags().embed_api_limit_origins&&ka.requestedEmbedAPIOrigin!=null){let v=Zb(),C=m.origin===ka.requestedEmbedAPIOrigin&&Yu(ka.requestedEmbedAPIOrigin)==="ALLOWED";if(!(v||C))return}let S=m.data;if(S){let v=S.type,C=S.data;t(A,T,v,C)}})}g.init=e;function t(A,T,b,_){var m,S,v;switch(b){case"NAVIGATE_TO_FRAME_AND_CLOSE_OVERLAYS":{let C=ee.fromString(_.nodeId),N=ee.fromString(_.startingPointNodeId);if(Y.isInlinePreview()&&(A.prototypeState().resetPrototype(),T.handleRestartPrototype(),A.videoManager().handleRestartPrototype()),!(Y.isInlinePreview()&&C==null))if(ee.isValid(C)){let x=(m=A.scene())==null?void 0:m.findNode1(C);if(x!=null){N&&A.setActivePrototypeStartingPointNodeId(N);let z=N&&x.topLevelAncestor()==null?N:C;A.prototypeState().navigateToFrameAndCloseOverlays(z,null,2,0,0,null,null)}else g._prototypeObserver.setPendingNodeId(C)}else console.error(`Expected node id; got '${_.nodeId}' instead`);break}case"NAVIGATE_BACKWARD":{T.navigateBackward(18);break}case"NAVIGATE_FORWARD":{T.navigateForward(19);break}case"CHANGE_COMPONENT_STATE":{let C=(S=A.scene())==null?void 0:S.findNodeFromDeveloperFriendlyId(_.nodeId),N=(v=A.scene())==null?void 0:v.findNodeFromDeveloperFriendlyId(_.newVariantId);if(C==null){console.error(`Could not find node from specified node id '${_.nodeId}'`);return}if(N==null){console.error(`Could not find variant for CHANGE_COMPONENT_STATE from id '${_.newVariantId}'`);return}A.prototypeState().swapInstanceToState2(C.stablePath(),N.id(),null,0,null,1,null);break}case"RESTART":{A.prototypeState().restartPrototype(1);break}default:break}}g._receiveFromHost=t;function n(A,T){let b={type:c[A],data:T};if(g._mockEmbedListener!=null){(0,g._mockEmbedListener)(b);return}let _=window;if(!(_===null||_.parent===null||_.parent.postMessage===void 0)&&_.top!==_)if(Y.getFeatureFlags().embed_api_limit_origins&&ka.requestedEmbedAPIOrigin!=null){let m=Zb();m?_.parent.postMessage(b,m):ka.requestedEmbedAPIOrigin!=null&&Yu(ka.requestedEmbedAPIOrigin)==="ALLOWED"&&_.parent.postMessage(b,ka.requestedEmbedAPIOrigin)}else _.parent.postMessage(b,"*")}function r(A,T){for(let b=A.childCount()-1;b>=0;b=b-1)r(A.childAt2(b,!0),T);T(A)}g._forEachNodeInHitTestOrder=r;function o(A,T){let b=null,_=null;return r(A,m=>{if(b!=null)return;let S=m.canvasSpaceScrolledInteractiveBounds(0);if(m.isVisibleInCanvas()&&S.contains2(T)){b=m;let v=m.canvasSpaceScrolledInteractiveBounds(1);_=T.subtract1(v.topLeft())}}),b==null?null:new d(b,_)}g.findClickInfoForUnhandledMouseRelease=o;function a(A,T,b){if(T.node==null){Ve("Hotspot node is null");return}let _=A.baseScreenNode();if(_==null)return;let m=A.prototypeState().getTopmostOverlayNode(),S=m??_,v=b;m!=null&&(v=A.prototypeState().getTopmostOverlay().baseTlfSpaceToOverlaySpace1(_,b));let C=v.subtract1(T.node.canvasSpaceScrolledInteractiveBounds(1).topLeft()),N={};N.handled=!0,N.presentedNodeId=S.developerFriendlyId(),N.targetNodeId=T.node.developerFriendlyId(),N.targetNodeMousePosition=C.toJSON();let x=T.node.findContainingScrollingFrameOrSelf();if(x!=null){let z=x.canvasSpaceScrolledInteractiveBounds(1),$=v.subtract1(z.topLeft());N.nearestScrollingFrameId=x.developerFriendlyId(),N.nearestScrollingFrameMousePosition=$.toJSON(),N.nearestScrollingFrameOffset=x.scrollOffset().toJSON()}else N.nearestScrollingFrameId=null,N.nearestScrollingFrameMousePosition=null,N.nearestScrollingFrameOffset=null;n(1,N)}g.willTriggerClickLikeHotspot=a;function s(A,T){let b=A.baseScreenNode();if(b==null)return;let _=A.prototypeState().getTopmostOverlayNode(),m=T;_!=null&&(m=A.prototypeState().getTopmostOverlay().baseTlfSpaceToOverlaySpace1(b,T));let S=_??b,v=o(S,m),C={};C.handled=!1,C.presentedNodeId=S.developerFriendlyId(),C.targetNodeId=v!=null?v.node.developerFriendlyId():null,C.targetNodeMousePosition=v!=null?v.nodeSpacePoint.toJSON():null;let N=v!=null?v.node.findContainingScrollingFrameOrSelf():null;if(N!=null){let x=N.canvasSpaceScrolledInteractiveBounds(1),z=m.subtract1(x.topLeft());C.nearestScrollingFrameId=N.developerFriendlyId(),C.nearestScrollingFrameMousePosition=z.toJSON(),C.nearestScrollingFrameOffset=N.scrollOffset().toJSON()}else C.nearestScrollingFrameId=null,C.nearestScrollingFrameMousePosition=null,C.nearestScrollingFrameOffset=null;n(1,C)}g.notifyUnhandledMouseRelease=s;function l(){n(4,{})}g.notifyVariableUpdated=l;class d{constructor(T,b){this.node=T,this.nodeSpacePoint=b}}g.ClickedLayer=d;let c;(v=>(v[v.INITIAL_LOAD=0]="INITIAL_LOAD",v[v.MOUSE_PRESS_OR_RELEASE=1]="MOUSE_PRESS_OR_RELEASE",v[v.PRESENTED_NODE_CHANGED=2]="PRESENTED_NODE_CHANGED",v[v.NEW_STATE=3]="NEW_STATE",v[v.VARIABLE_UPDATED=4]="VARIABLE_UPDATED",v[v.REQUEST_CLOSE=5]="REQUEST_CLOSE"))(c=g.MessageType||(g.MessageType={}));class p{willTriggerHotspot(T,b,_,m){let S=_==4||_==8||_==9||_==3;if(m!=null&&S){let v=this._canvasView.viewport().viewSpaceToCanvasSpace1().transformPoint(m.clone());a(this._appState,T,v)}}didScrollNode(T){}constructor(T,b){this._appState=T,this._canvasView=b}}g.EmbedCanvasViewObserver=p;class u{constructor(T){this.appState=null,this._pendingNodeId=null,this.appState=T}setPendingNodeId(T){this._pendingNodeId=T}handleSceneGraphEvent(T){var b;this._pendingNodeId!=null&&((b=this.appState.scene())==null?void 0:b.findNode1(this._pendingNodeId))!=null&&(Y.isInlinePreview()?(this.appState.setActivePrototypeStartingPointNodeId(this._pendingNodeId),this.appState.prototypeState().navigateToFrameAndCloseOverlays(this._pendingNodeId,null,2,0,0,null,null)):this.appState.prototypeState().navigateToFrameAndCloseOverlays(this._pendingNodeId),this._pendingNodeId=null)}handlePresentedNodeChanged(T){if(T==null)return;let b=this.appState.baseScreenNode();if(!Y.isInlinePreview()&&b==null)return;let _=this.appState.prototypeState().getTopmostOverlayNode(),m=_??b,S={};S.presentedNodeId=m==null?void 0:m.developerFriendlyId(),S.isStoredInHistory=!Ut.TransitionAction_isTransientAction(T.cause);let v={};this.appState.prototypeState().getOnscreenStates().forEach(C=>{let N=C.a,x=C.b,z=this.appState.scene().findNode3(N);z!=null&&(v[z.developerFriendlyId()]=x)}),S.stateMappings=v,n(2,S)}handleInteractiveComponentStateChange(T,b){if(b==null)return;let _=this.appState.scene().findNode3(T);if(_==null)return;let m={};m.nodeId=_.developerFriendlyId(),m.currentVariantId=b.oldStateId(),m.newVariantId=b.newStateId(),m.isStoredInHistory=!Ut.TransitionAction_isTransientAction(b.cause),m.isTimedChange=b.cause==1,n(3,m)}handleStateChangeAborted(T){this.handlePresentedNodeChanged(T)}handleStateChangeCommitted(T,b){}handleStateChangeInitiated(T){this.handlePresentedNodeChanged(T)}handleStateChangeRequested(T){}handleFitModeChange(T,b){}handleRestartPrototype(){}handleHsmAborted(T,b){this.handleInteractiveComponentStateChange(T,b)}handleHsmCommitted(T,b,_){}handleHsmInitiated(T,b){this.handleInteractiveComponentStateChange(T,b)}handleHsmRequested(T,b){}}g.EmbedPrototypeObserver=u;let h;(T=>{function A(b){return c[b]}T.MessageType_toString=A})(h=g.in_MessageType||(g.in_MessageType={})),g._mockEmbedListener=null,g._prototypeObserver=null})(aa||(aa={}));var Xp=class{constructor(e,t){this._didFinishZooming=null,this._drawIdleCount=0,this._userIdleCount=0,this._isFirstFrame=!1,this._justInteracted=!1,this._zoomInProgress=!1,this._previousZoomScale=1,this._previousRenderStatus=1,this._emitter=null,this._didFinishZooming=e,this._emitter=t}handleSceneChange(){this._isFirstFrame=!0}updateZoomScaleNow(e){this._previousZoomScale=e,this._didFinishZooming(this._previousZoomScale)}handleInteraction(){this._justInteracted=!0}justInteracted(){return this._justInteracted}advanceFrame(e){e.isInvalid()||this._justInteracted?(this._userIdleCount=0,this._drawIdleCount=0):this._userIdleCount=this._userIdleCount+1,this._previousRenderStatus==0?this._drawIdleCount=0:this._drawIdleCount=this._drawIdleCount+1,this._isFirstFrame&&(this._userIdleCount=0,this._isFirstFrame=!1,this.updateZoomScaleNow(e.zoomScale()));let t=this._zoomInProgress;this._zoomInProgress=this._previousZoomScale!=e.zoomScale(),this._zoomInProgress&&!t&&this._emitter.trigger("zoomStart",null);let n=this._userIdleCount>=2;this._zoomInProgress&&n&&this.updateZoomScaleNow(e.zoomScale()),!this._zoomInProgress&&t&&this._emitter.trigger("zoomStop",null),this._justInteracted=!1}renderingIsComplete(){return this._drawIdleCount>0&&this._userIdleCount>0&&!this._justInteracted}shouldRenderOptionalTiles(){return Je.isMobile(Je.current())||Je.current()==4&&navigator.maxTouchPoints>0||Rt.forceMobileOptimizations()?this._userIdleCount>6&&this._drawIdleCount<120:this._userIdleCount>6}zoomInProgress(){return this._zoomInProgress}previousZoomScale(){return this._previousZoomScale}setPreviousRenderStatus(e){this._previousRenderStatus=e}};var _d=class{delayedHotspotId(){return this._delayedHotspotId}interaction(){return this._interaction}action(){return this._action}counter(){return this._counter}reset(){this._delayedHotspotId=null,this._interaction="ON_CLICK",this._action=0,this._counter=this._counter+1}set(e,t,n){this._delayedHotspotId=e,this._interaction=t,this._action=n,this._counter=this._counter+1}constructor(){this._delayedHotspotId=null,this._interaction="ON_CLICK",this._action=0,this._counter=0}},Jp=class{resetEntry(e,t){this.resetAllEntriesMatchingPredicate((n,r)=>ee.equals(n,e)&&r==t)}resetAllEntries(){this._maintainedDataEntries.length=0}resetAllEntriesWithInteractionType(e){this.resetAllEntriesMatchingPredicate((t,n)=>n==e)}resetAllEntriesMatchingPredicate(e){this._maintainedDataEntries=this._maintainedDataEntries.filter(t=>!e(t.delayedHotspotId(),t.interaction()))}set(e,t,n){let r=this.getByHotspotAndInteractionType(e,t);if(r==null){let o=new _d;o.set(e,t,n),this._maintainedDataEntries.push(o),r=o}else r.set(e,t,n);return r.counter()}getByHotspotAndInteractionType(e,t){for(let n of this._maintainedDataEntries)if(ee.equals(n.delayedHotspotId(),e)&&n.interaction()==t)return n;return null}constructor(){this._maintainedDataEntries=[]}};var jp=class{constructor(e){this._appState=null,this._currentlyEnteredNodesGUIDsOrderedInnerToOuter=[],this.currentlyEnteredGUIDsSet=new Set,this._previouslyEnteredNodesGUIDsOrderedInnerToOuter=[],this.previouslyEnteredGUIDsSet=new Set,this._appState=e}reset(){this._currentlyEnteredNodesGUIDsOrderedInnerToOuter.length=0,this.currentlyEnteredGUIDsSet.clear(),this._previouslyEnteredNodesGUIDsOrderedInnerToOuter.length=0,this.previouslyEnteredGUIDsSet.clear()}updateEnteredNodes(e,t){this._previouslyEnteredNodesGUIDsOrderedInnerToOuter=this._currentlyEnteredNodesGUIDsOrderedInnerToOuter,this._currentlyEnteredNodesGUIDsOrderedInnerToOuter=Y.getFeatureFlags().prototype_new_mouse_perf?this._getNodesEnteredByCanvasSpacePointV2(e,t):this._getNodesEnteredByCanvasSpacePoint(e),this.currentlyEnteredGUIDsSet=new Set(this._currentlyEnteredNodesGUIDsOrderedInnerToOuter),this.previouslyEnteredGUIDsSet=new Set(this._previouslyEnteredNodesGUIDsOrderedInnerToOuter)}getNewlyEnteredMouseEnterHotspotsInOrderOfEntering(e){let t=this._currentlyEnteredNodesGUIDsOrderedInnerToOuter.filter(o=>!this.previouslyEnteredGUIDsSet.has(o));t.reverse();let n=new Map;for(let o=0,a=t.length;o<a;o=o+1)n.set(t[o],o);let r=e.filter(o=>n.has(o.node.id()));return r.sort((o,a)=>ht.int_compare(n.get(o.node.id()),n.get(a.node.id()))),r}getNewlyLeftMouseLeaveHotspotsInOrderOfLeaving(e){let t=this._previouslyEnteredNodesGUIDsOrderedInnerToOuter.filter(o=>!this.currentlyEnteredGUIDsSet.has(o)),n=new Map;for(let o=0,a=t.length;o<a;o=o+1)n.set(t[o],o);let r=e.filter(o=>n.has(o.node.id()));return r.sort((o,a)=>ht.int_compare(n.get(o.node.id()),n.get(a.node.id()))),r}markNodesAsNotEnteredWithoutTriggeringMouseLeave(e){let t=new Set(e);this._currentlyEnteredNodesGUIDsOrderedInnerToOuter=this._currentlyEnteredNodesGUIDsOrderedInnerToOuter.filter(n=>!t.has(n))}resetNoLongerMaintainedMouseEnterOrLeaveInteractions(e){e.resetAllEntriesMatchingPredicate((t,n)=>{let r=n=="MOUSE_ENTER"&&!this.currentlyEnteredGUIDsSet.has(t),o=n=="MOUSE_LEAVE"&&this.currentlyEnteredGUIDsSet.has(t);return r||o})}_getNodesEnteredByCanvasSpacePointV2(e,t){if(this._appState.baseScreenNode()==null)return[];let r=[],[o,a]=this._appState.prototypeState().getTopmostScreenAndPoint(e),s=Bt.getNodeInteractionPairs("MOUSE_ENTER",t),l=Bt.getNodeInteractionPairs("MOUSE_LEAVE",t),d=this._appState.prototypeStructure().findHotspotsWithInteractionFilter(o,0,p=>{let u=p.event().interactionType();return u=="MOUSE_LEAVE"||u=="MOUSE_ENTER"},[...s??[],...l??[]]),c=null;for(let p of d)p.canvasSpaceScrolledInteractiveBounds(0).contains2(a)&&(c==null||p.node.isAboveInLayerOrder(c.node))&&(c=p);if(c!=null&&c.node){let p=c.node;for(;p!=o;)r.push(p.id()),p=p.parent();r.push(o.id())}return r}_getNodesEnteredByCanvasSpacePoint(e){let t=this._appState.baseScreenNode();if(t==null)return[];let n=this._appState.prototypeState(),r=n.getTopmostOverlayNode(),o=r??t,a=r!=null?n.getTopmostOverlay().baseTlfSpaceToOverlaySpace1(t,e):e,s=[],d=o.canvasSpaceScrolledInteractiveBounds(0).contains2(a)?o:null;if(o.forEachDescendantPreorder(c=>{c.canvasSpaceScrolledInteractiveBounds(0).contains2(a)&&(d=c)}),d!=null){let c=d;for(;c!=o;)s.push(c.id()),c=c.parent();s.push(o.id())}return s}};var Ol=class{constructor(e,t){this._ballisticSimulation=null,this._scrollingNodeID=null,this._isValid=!1,this._ballisticSimulation=e,this._scrollingNodeID=t,this._isValid=e!=null}nodeID(){return this._scrollingNodeID}simulation(){return this._ballisticSimulation}isOverscrolled(){return this._ballisticSimulation.isOverscrolled()}isValid(e){return e!=null&&e.findNode1(this._scrollingNodeID)!=null}isDone(){return this._ballisticSimulation.isDone1()}performScroll(e,t){if(!this.isValid(t))return;let n=this._ballisticSimulation.pos1(),r=t.findNode1(this._scrollingNodeID);e.setScrollOffsetUnconditionally(r,n)}};var Ad=class{uninit(){this._semanticScrollStorage.uninitialize1()}getValueFromStorage(e){let t=new jt(e),n=Cn.getSemanticNodePath(t);return this._semanticScrollStorage.getData(n,Cn.DEFAULT_STORAGE_KEY)}setValueInStorage(e,t){let n=new jt(e),r=Cn.getSemanticNodePath(n);this._semanticScrollStorage.insert(r,Cn.DEFAULT_STORAGE_KEY,t)}_getOldNode(e){return e.stablePath.guids.length==0?this._appState.scene().findNode1(e.oldStateId()):this._appState.scene().findNode3(e.stablePath)}_getNewNode(e){return e.stablePath.guids.length==0?this._appState.scene().findNode1(e.newStateId()):this._appState.scene().findNode3(e.stablePath)}commitCurrentScrollStateToStorage(e){let t=this._getOldNode(e);this._recursivelyRecordOffsets(t);for(let n=0,r=e.oldStateAndOverlays.overlays.length;n<r;n=n+1){let o=e.oldStateAndOverlays.overlays[n].id,a=this._appState.scene().findNode1(o);this._recursivelyRecordOffsets(a)}}applyStoredScrollStateToScene(e){let t=this._getNewNode(e);this._recursivelySetOffsets(t);for(let n=0,r=e.newStateAndOverlays.overlays.length;n<r;n=n+1){let o=e.newStateAndOverlays.overlays[n].id,a=this._appState.scene().findNode1(o);this._recursivelySetOffsets(a)}}resetScrollStateToScene(e){let t=this._getNewNode(e);this._recursivelyResetOffsets(t);for(let n=0,r=e.newStateAndOverlays.overlays.length;n<r;n=n+1){let o=e.newStateAndOverlays.overlays[n].id,a=this._appState.scene().findNode1(o);this._recursivelyResetOffsets(a)}}_recursivelyRecordOffsets(e){e!=null&&(e.scrollDirection()!="NONE"&&this.setValueInStorage(e,e.scrollOffset()),e.forEachChild(t=>{this._recursivelyRecordOffsets(t)}))}_recursivelySetOffsets(e){if(e!=null){if(e.scrollDirection()!="NONE"){let t=this.getValueFromStorage(e);t!=null?t.equals(e.scrollOffset())||(Pe.trackDefinedEvent("prototype.viewer_scroll_state_transferred",{}),e.setScrollOffset(this._canvasView.restrictScrollDeltaAxes(e,t))):e.setScrollOffset(Ie.FrozenVector_ZERO)}e.forEachChild(t=>{this._recursivelySetOffsets(t)})}}_recursivelyResetOffsets(e){e!=null&&(e.scrollDirection()!="NONE"&&(Pe.trackDefinedEvent("prototype.viewer_scroll_state_reset",{}),e.setScrollOffset(Ie.FrozenVector_ZERO),this.setValueInStorage(e,Ie.FrozenVector_ZERO)),e.forEachChild(t=>{this._recursivelyResetOffsets(t)}))}toString(){return this._semanticScrollStorage.toString2(e=>e.toString())}constructor(e,t){this._canvasView=e,this._appState=t,this._semanticScrollStorage=new Na}};var Zp=class{constructor(e,t,n,r,o,a,s,l){this.hotspot=e,this.prototypeInteraction=t,this.action=n,this.viewSpacePointOrNull=r,this.prototypeAction=o,this.connectionType=a,this.actionIndexPath=s,this.resolvedVariableModes=l}},$p=class{constructor(e,t){this._queue=null,this._canvasView=null,this._prototypeState=null,this._queue=[],this._canvasView=e,this._prototypeState=t,this._prototypeState.addObserver(this),this._prototypeState.addHsmObserver(this),this._canvasView.addObserver(this)}appendToQueue(e,t,n,r,o,a,s,l){this._queue.push(new Zp(e,t,n,r,o,a,s,l))}insertInQueue(e,t,n,r,o,a,s,l,d){this._queue.splice(l,0,new Zp(e,t,n,r,o,a,s,d))}runNextAction(){if(this._queue.length>0){let e=this._queue.shift();e!=null&&this._runAction(e)}}_runAction(e){this._canvasView.runAction(e.hotspot,e.prototypeInteraction,e.action,e.viewSpacePointOrNull,e.prototypeAction,e.connectionType,e.actionIndexPath,e.resolvedVariableModes)}handleStateChangeAborted(e){this._queue.length=0}handleStateChangeCommitted(e,t){if(this._queue.length>0&&this._shouldProcessAction(e)){let n=this._queue.shift();n!=null&&t(()=>{this._runAction(n)})}}handleStateChangeInitiated(e){}handleStateChangeRequested(e){}handleFitModeChange(e,t){}handleRestartPrototype(){this._queue.length=0}handleHsmAborted(e,t){this._queue.length=0}handleHsmCommitted(e,t,n){if(this._queue.length>0&&this._shouldProcessAction(t)){let r=this._queue.shift();r!=null&&n(()=>{this._runAction(r)})}}handleHsmInitiated(e,t){}handleHsmRequested(e,t){}willTriggerHotspot(e,t,n,r){(n==4||n==8||n==9||n==3)&&(this._queue.length=0)}didScrollNode(e){}_shouldProcessAction(e){return!(e.cause==6||e.cause==7)}};var Es;(r=>{function i(o){return Y.getFeatureFlags().prototype_state_management&&o.stateManagementVersion()==1}r.newStateManagementRulesEnabledForChange=i;function e(){return r._seenOldStateManagementInteraction}r.seenOldStateManagementInteraction=e;function t(){r._seenOldStateManagementInteraction=!0}r.markOldStateManagementInteractionSeen=t,r._seenOldStateManagementInteraction=!1})(Es||(Es={}));var eh=class{check(e){(!this._lastOffset.equals(e.offset())||this._lastZoomScale!=e.zoomScale())&&(this._lastOffset=e.offset(),this._lastZoomScale=e.zoomScale(),this.onChange!=null&&this.onChange(this._lastOffset,this._lastZoomScale))}resetStateForTests(){this._lastOffset=Ie.FrozenVector_ZERO,this._lastZoomScale=0}constructor(){this._lastOffset=Ie.FrozenVector_ZERO,this._lastZoomScale=0,this.onChange=null}};var hd=(t=>(t[t.DID_WORK=0]="DID_WORK",t[t.IDLE=1]="IDLE",t))(hd||{}),oh=(t=>(t[t.SHORTCUT=0]="SHORTCUT",t[t.SCROLL=1]="SCROLL",t))(oh||{}),Ap=(t=>(t[t.AUTOMATIC=0]="AUTOMATIC",t[t.USER_INITIATED=1]="USER_INITIATED",t))(Ap||{}),Tn=(S=>(S[S.UNKNOWN=0]="UNKNOWN",S[S.TIMER=1]="TIMER",S[S.ON_HOVER=2]="ON_HOVER",S[S.ON_PRESS=3]="ON_PRESS",S[S.ON_CLICK=4]="ON_CLICK",S[S.DRAG=5]="DRAG",S[S.REVERSE_HOVER=6]="REVERSE_HOVER",S[S.REVERSE_PRESS=7]="REVERSE_PRESS",S[S.MOUSE_DOWN=8]="MOUSE_DOWN",S[S.MOUSE_UP=9]="MOUSE_UP",S[S.MOUSE_IN=10]="MOUSE_IN",S[S.MOUSE_OUT=11]="MOUSE_OUT",S[S.MOUSE_ENTER=12]="MOUSE_ENTER",S[S.MOUSE_LEAVE=13]="MOUSE_LEAVE",S[S.ON_KEY_DOWN=14]="ON_KEY_DOWN",S[S.ON_GAMEPAD_DOWN=15]="ON_GAMEPAD_DOWN",S[S.ON_VOICE=16]="ON_VOICE",S[S.MOBILE_NAV=17]="MOBILE_NAV",S[S.LEFT_ARROW=18]="LEFT_ARROW",S[S.RIGHT_ARROW=19]="RIGHT_ARROW",S[S.ON_MEDIA_HIT=20]="ON_MEDIA_HIT",S[S.ON_MEDIA_END=21]="ON_MEDIA_END",S))(Tn||{}),rT=(r=>(r[r.MISS=0]="MISS",r[r.LEFT_THIRD=1]="LEFT_THIRD",r[r.CENTER_THIRD=2]="CENTER_THIRD",r[r.RIGHT_THIRD=3]="RIGHT_THIRD",r))(rT||{}),th=class{constructor(e,t){this.swappedStablePath=e,this.hotspotStablePath=t}},nh=class{willTriggerHotspot(e,t,n,r){this.willTriggerHotspotCallback!=null&&this.willTriggerHotspotCallback(e,t,n,r)}didScrollNode(e){this.didScrollNodeCallback!=null&&this.didScrollNodeCallback(e)}constructor(e,t){this.willTriggerHotspotCallback=e,this.didScrollNodeCallback=t}},wl=class i{constructor(e,t){this.FRAMES_TO_FINISH_RENDERING=3,this._state=i.State.INACTIVE,this._framesToFinishRendering=0,this._observers=new Xn,this._emitter=null,e.addObserver(this),this._emitter=t}onFrame(){this._state==i.State.WAITING_TO_FINISH&&(this._framesToFinishRendering==0?(this._emitter.trigger("renderingStop",null),this._observers.forEach(e=>{e.handleRenderingStop()}),this._state=i.State.INACTIVE):this._framesToFinishRendering=this._framesToFinishRendering-1)}handleSetNeedsBlit(e){this._state==i.State.INACTIVE?e&&(this._emitter.trigger("renderingStart",null),this._observers.forEach(t=>{t.handleRenderingStart()}),this._state=i.State.ACTIVE):this._state==i.State.ACTIVE?e||(this._state=i.State.WAITING_TO_FINISH,this._framesToFinishRendering=this.FRAMES_TO_FINISH_RENDERING):e&&(this._state=i.State.ACTIVE)}addObserver(e){this._observers.add(e)}removeObserver(e){this._observers.remove(e)}};(t=>{let i;(a=>(a[a.ACTIVE=0]="ACTIVE",a[a.INACTIVE=1]="INACTIVE",a[a.WAITING_TO_FINISH=2]="WAITING_TO_FINISH"))(i=t.State||(t.State={}));let e;(r=>{function n(o){return t.State[o]}r.State_toString=n})(e=t.in_State||(t.in_State={}))})(wl||(wl={}));var ge=class ge extends uc{constructor(t){super();this._appState=null,this._observers=new Xn,this._renderer=null,this._renderingStateTracker=null,this._idlenessTracker=null,this._transitionBehaviorManager=null,this._scrollSyncer=null,this._sequentialActionManager=null,this._viewportTracker=new eh,this._viewport=new $o,this._hotspotAnimation=new ip,this._uiRenderData=new sp,this._showHotspots=!0,this._multiplayer=null,this._mostRecentTransitionViaArrows=!1,this._mostRecentTransitionViaArrowsLegacy=!1,this._mostRecentFrameNum=0,this._microtasksSinceLastFrame=0,this.MAX_MICROTASKS_PER_FRAME=2,this.onResize=null,this.onBaseScreenIdChanged=null,this.userDidAttemptZoom=null,this.disengageObservationMode=null,this.onURLClicked=null,this.onNavigateToPrototype=null,this.afterFrame=null,this.afterFirstRenderOfScreenStack=null,this._emitter=null,this._pointerEventDelegate=null,this.INTERACTION_REPORTING_RATE=10/100,this._currentMouseLocation=null,this._lastPressData=null,this._hoveredStateInstances=new Map,this._maintainedDataLegacy=new _d,this._maintainedData=new Jp,this._mouseEnteredNodesManager=null,this._initialFlingVelocity=new I(0,0),this._interactionObservers=new Xn,this.ALT_CODE=18,this.SHIFT_CODE=16,this.META_CODE=91,this.CONTROL_CODE=17,this._appState=t,this._appState.prototypeState().addObserver(this),this._appState.prototypeState().addHsmObserver(this),this._emitter=qt.getEventEmitter(),this.makeRenderer(),this.setPhysicsForOS(this.getRelevantOS()),this._idlenessTracker=new Xp(n=>{this._renderer.setZoomScale(n)},this._emitter),this._pointerEventDelegate=new ge.CanvasPointerEventDelegate(this),this._scrollSyncer=new Ad(this,this._appState),this._sequentialActionManager=new $p(this,this._appState.prototypeState()),this._mouseEnteredNodesManager=new jp(this._appState)}addObserver(t){this._observers.add(t)}removeObserver(t){this._observers.remove(t)}setBackgroundEnabled(t){this._renderer.setBackgroundEnabled(t)}renderingStateTracker(){return this._renderingStateTracker}makeRenderer(){let t=this._renderer;t!=null&&t.removeFrom(this),Y.getFeatureFlags().viewer_disable_rendering?this._renderer=new kp:this._renderer=new Va(this._viewport,this._appState,this._appState.imageManager()),this._transitionBehaviorManager!=null&&this._transitionBehaviorManager.removeFrom(this),this._transitionBehaviorManager=new _p(this),this._renderingStateTracker!=null&&this._appState.removeFrameObserver(this._renderingStateTracker),this._renderingStateTracker=new wl(this._renderer,this._emitter),this._appState.addFrameObserver(this._renderingStateTracker),t!=null&&this._renderer!=null&&this._renderer.attachTo(this)}graphicsCardName(){return this._renderer.graphicsCardName()}deviceRenderer(){return this._renderer.deviceRenderer()}getContext(){return this._renderer.getContext()}appState(){return this._appState}idlenessTracker(){return this._idlenessTracker}viewport(){return this._viewport}viewportTracker(){return this._viewportTracker}mostRecentFrameNum(){return this._mostRecentFrameNum}setScrollPadding(t,n,r,o){this._viewport.setScrollPadding([t,n,r,o])}setMultiplayer(t){this._multiplayer=t}setShowHotspots(t){this._showHotspots=t}handleSceneChange(t,n){t!=null&&t.removeObserver(this),n!=null&&n.addObserver(this),this._viewport.invalidate(),this._invalidateZoomScaleForRender(),this._idlenessTracker.handleSceneChange(),this._setCurrentViewportSizeOnCanvas()}resetStateForTests(){this._viewport.resetStateForTests(),this._viewportTracker.resetStateForTests(),this._appState.resetStateForTests(),this._lastPressData=null,this._hoveredStateInstances=new Map,this._maintainedDataLegacy.reset(),Y.getFeatureFlags().prototype_new_mouse_events&&this._maintainedData.resetAllEntries(),this._pointerEventDelegate.resetStateForTests(),this._mouseEnteredNodesManager.reset(),this._appState.prototypeState().addHsmObserver(this)}handleActiveCanvasChange(t,n){n!=null?this._viewport.invalidate():this._currentMouseLocation=null}handleActivePrototypeStartingPointChange(t,n){}afterEnteredViewer(){this._appState.nodeTransitionTracker().triggerPotentialTimedTransition=()=>{let t=this._appState.prototypeState(),n=[];t.getCurrentBaseScreenNode()!=null&&n.push(t.getCurrentBaseScreenNode());for(let r=0,o=t.getCurrentOverlayData().length;r<o;r=r+1)n.push(t.nodeForOverlayAt(r));this._triggerPotentialTimedTransition(n,0)},this._appState.nodeTransitionTracker().createVideoTriggerEventsForNodesInFrame=t=>{t&&this._createVideoTriggerEvents([t])},this._appState.nodeTransitionTracker().createVideoTriggerEventsForAllNodesOnscreen=()=>{let t=[],n=this._appState.prototypeState();n.getCurrentBaseScreenNode()!=null&&t.push(n.getCurrentBaseScreenNode());for(let r=0,o=n.getCurrentOverlayData().length;r<o;r=r+1)t.push(n.nodeForOverlayAt(r));this._createVideoTriggerEvents(t)}}navigateForward(t){if(this._appState.prototypeState().getCurrentBaseScreenId()==null)return;let r=this._appState.prototypeState().getCurrentBaseScreenNode();if(r==null)return;let o=null;this._appState.prototypeStructure().currentType()==1?o=this._appState.prototypeState().getNextBaseScreenNodeForFrameList():o=this._appState.prototypeState().getNextBaseScreenNodeForPrototype(),o!=null&&this.navigateViaArrows(r.id(),o.id(),0,t)}navigateBackward(t){if(this._appState.prototypeState().getCurrentBaseScreenId()==null)return;let r=this._appState.prototypeState().getCurrentBaseScreenNode();if(r==null)return;let o=this._appState.prototypeState().getPreviousBaseScreenNode();o!=null&&this.navigateViaArrows(r.id(),o.id(),1,t)}navigateToFrameAtIndex(t){let n=this._appState.prototypeState().getCurrentBaseScreenId();if(n==null)return;let r=this._appState.prototypeState().getCurrentBaseScreenIndex(),o=this._appState.prototypeStructure().topLevelPrototypeNodesInOrder();if(t<0||t>o.length-1||t==r)return;let a=ee.fromString(o[t]),s=r<t?0:1;this.navigateViaArrows(n,a,s,null)}navigateViaArrows(t,n,r,o){this._mostRecentTransitionViaArrows=!0,this._mostRecentTransitionViaArrowsLegacy=!0,Math.random()<this.INTERACTION_REPORTING_RATE&&Pe.trackEvent("prototype_view_interaction",{type:"navigateViaArrows",direction:xr[r],nonInteraction:0,prototypeType:Oi[this._appState.prototypeStructure().currentType()]});let a=this._appState.prototypeState().getCurrentBaseScreenNode();if(a!=null&&a.prototypeInteractions().length!=0){let s=null;for(let l=0,d=a.prototypeInteractions().length;l<d;l=l+1){let c=a.prototypeInteractions()[l],p=(c==null?void 0:c.action())!=null?c.action().value:null;if(c!=null&&c.allActions().length>0)for(let h of c.allActions())h.transitionNodeID()!=null&&h.transitionNodeID()==n&&(p=h);let u=p!=null?this._appState.scene().findNode1(p.transitionNodeID()):null;if(u!=null){let h=Bt.cleanedUpTransitionDestinationId(this._appState.getActiveCanvas(),a==null?void 0:a.id(),u==null?void 0:u.id(),p.navigationType(),p.connectionType());s=h??null}if(ee.equals(s,n)){this._appState.prototypeState().navigateToFrameAndCloseOverlays(n,a,1,r,o,c,p);return}}}this._appState.prototypeState().navigateToFrameAndCloseOverlays(n,null,1,r,o,null,null)}_navigateToHyperlink(t,n){var r;if(t.hyperlink.url!==void 0){this.onURLClicked(t.hyperlink.url,!0);return}else if(t.hyperlink.guid!==void 0){let o=mt.decodeGUID(t.hyperlink.guid);if(ee.equals(o,this._appState.getActiveCanvas().id())){this._appState.prototypeState().restartPrototype(1);return}let a=this._appState.scene().findNode1(o),s=Bt.cleanedUpTransitionDestinationId(this._appState.getActiveCanvas(),(r=t.node)==null?void 0:r.id(),a==null?void 0:a.id(),n,"URL");if(s!=null){this._appState.prototypeState().navigateToFrameAndCloseOverlays(s);return}let l=this._appState.currentFileKey();this.onNavigateToPrototype(l,o)}}triggerHotspot(t,n,r,o){if(this._multiplayer.isObserving()||(this._observers.forEach(s=>{s.willTriggerHotspot(t,n,r,o)}),n==null||n.actions().length==0))return;Y.getFeatureFlags().prototype_state_management&&!Es.seenOldStateManagementInteraction()&&n.stateManagementVersion()==0&&(Pe.trackDefinedEvent("prototype.viewer_old_noodle_used",{}),Es.markOldStateManagementInteractionSeen());let a=t.node.getResolvedVariableModes();for(let s=0,l=n.actions().length;s<l;s=s+1){let d=n.actions()[s],c=d.connectionType();Math.random()<this.INTERACTION_REPORTING_RATE&&Pe.trackEvent("prototype_view_interaction",{type:"triggerHotspot",transitionAction:Tn[r],transitionType:d==null?void 0:d.transitionType(),action:c=="INTERNAL_NODE"?d==null?void 0:d.navigationType():c=="UPDATE_MEDIA_RUNTIME"?d==null?void 0:d.mediaAction():c,nonInteraction:0}),Y.getViewerMode()==Y.ViewerMode.MIRROR&&Pe.trackDefinedEvent("mobile_platform.first_prototype_interaction_mirror",{}),this._sequentialActionManager.appendToQueue(t,n,r,o,d,c,[s],a)}this._sequentialActionManager.runNextAction()}runAction(t,n,r,o,a,s,l,d){let c=!0;switch(s){case"INTERNAL_NODE":{let p=a.transitionNodeID();this._performNavigationOrOverlayChangeForHotspot(t.node,p,r,n,o,l),a.navigationType()=="SCROLL_TO"&&a.transitionType()!="SCROLL_ANIMATE"||(c=!1);break}case"URL":{t.hyperlink==null?this.onURLClicked(a.connectionURL(),a.openUrlInNewTab()):this._navigateToHyperlink(t,a.navigationType());break}case"BACK":{this.requestBack(t.node,n,1,Ut.TransitionAction_fromInteractionType(n.event().interactionType()),Jn.fromPrototypeAction(a,n.stateManagementVersion()),a),c=!1;break}case"CLOSE":{this._appState.prototypeState().closeOverlayForHotspot(t.node,n,1,a),c=!1;break}case"SET_VARIABLE":{let p=D();if(p.fonts().isWaitingForFontList())return;let u=t.node.id();t.node.isOrInInstance()&&(u=t.node.findContainingPrimaryInstance().id());let h=p.getICActionsForSetVariableAction(u,a.targetVariableID(),a.targetVariableData(),this._appState.prototypeState().getTopmostScreenId(),d);if(h.length>0){let f=hr.instance.setReverseVariantBindingsForICsDisabled(!0);for(let y of h){let A=t.node.scene().findNode1(y.nodeToSwap),T=A.prototypeInteractions()[y.interactionIndex];this.runAction(new Do(A),T,0,null,T.actions()[y.actionIndex],"INTERNAL_NODE",[y.actionIndex],d)}hr.instance.setReverseVariantBindingsForICsDisabled(f),c=!1}D().runSetVariable(u,a.targetVariableID(),a.targetVariableData(),d),this._appState.prototypeState().createMultiplayerSetVariableAction(u,a.targetVariableID(),a.targetVariableData(),d),aa.notifyVariableUpdated();break}case"UPDATE_MEDIA_RUNTIME":{this._appState.videoManager().updateVideoRuntime(a,t.node.id());break}case"CONDITIONAL":{if(D().fonts().isWaitingForFontList()||a.conditionalActions().length==0)return;let p=t.node.id();t.node.isOrInInstance()&&(p=t.node.findContainingPrimaryInstance().id());let u=D().getFirstTruthyConditionalIndex(p,a.conditionalActions()[0].condition());if(u>=0&&u<a.conditionalActions().length){let f=a.conditionalActions()[u].actions();for(let y=0,g=f.length;y<g;y=y+1){let A=f[y],T=[l[0],u,y];this._sequentialActionManager.insertInQueue(t,n,r,o,A,A.connectionType(),T,y,d)}}break}}c&&this._sequentialActionManager.runNextAction()}triggerDelayedHotspot(t,n,r){var a;let o=(a=this._appState.scene())==null?void 0:a.findNode1(t);o!=null&&this.triggerHotspot(new Do(o),n,r,null)}_findPrototypeActionGivenActionIndexPath(t,n){let r=t.actions(),o=n[0];if(o<r.length){let a=r[o];if(n.length>2){let s=n[1],l=n[2];if(a.conditionalActions()!=null&&a.conditionalActions().length>s){let d=a.conditionalActions()[s];if(d.actions()!=null&&d.actions().length>l)return d.actions()[l]}}return a}return null}_performNavigationOrOverlayChangeForHotspot(t,n,r,o,a,s){var d;this._mostRecentTransitionViaArrows=Y.getFeatureFlags().prototype_new_mouse_events?!1:a==null,this._mostRecentTransitionViaArrowsLegacy=a==null;let l=this._findPrototypeActionGivenActionIndexPath(o,s);if(t==null&&Ve("Hotspot node unexepectedly null when performing navigation or overlay change for hotspot"),t==null||l.navigationType()=="NAVIGATE"||l.navigationType()=="SWAP"&&this._appState.prototypeState().getTopmostOverlayId()==null)this._appState.prototypeState().navigateToFrameAndCloseOverlays(n,t,1,0,r,o,l);else if(l.navigationType()=="SCROLL_TO")this.scrollToDestinationInFrame(n,o);else if(l.navigationType()=="OVERLAY")this._appState.prototypeState().overlayFrame(n,t,0,r,o,l);else if(l.navigationType()=="SWAP")this._appState.prototypeState().swapTopOverlay(n,t,r,o,l);else if(l.navigationType()=="SWAP_STATE"){if(D().fonts().isWaitingForFontList())return;let c=(d=Zt.whichInstanceToSwap(t,l.transitionNodeID()))==null?void 0:d.stablePath();c!=null&&this._appState.prototypeState().swapInstanceToState2(c,n,t,r,o,1,l)}}requestBack(t,n,r,o,a,s){this._appState.prototypeState().returnToState2(t,n,r,o,a,s)}handleHsmAborted(t,n){this._renderer.abortHsmTransition(t,n),this._viewport.invalidate(),this._updateHoveredStateInstanceIfNeeded(n.stablePath);let r=[];this._appState.prototypeState().forMaterializedStateInstanceAndDescendants(t,o=>(r.push(this._appState.scene().findNode3(o)),ye.Loop.CONTINUE)),this._onCommitOrAbortForInteractions(r,n.cause,n.oldStateId())}handleHsmCommitted(t,n,r){this._renderer.commitHsmTransition(t,n),this._viewport.invalidate(),this._updateHoveredStateInstanceIfNeeded(n.stablePath);let o=[];this._appState.prototypeState().forMaterializedStateInstanceAndDescendants(t,a=>(o.push(this._appState.scene().findNode3(a)),ye.Loop.CONTINUE)),r(()=>{this._onCommitOrAbortForInteractions(o,n.cause,n.oldStateId())})}handleHsmRequested(t,n){Es.newStateManagementRulesEnabledForChange(n)&&this._scrollSyncer.commitCurrentScrollStateToStorage(n)}handleHsmInitiated(t,n){Es.newStateManagementRulesEnabledForChange(n)&&(n.resetScroll()==1?this._scrollSyncer.applyStoredScrollStateToScene(n):this._scrollSyncer.resetScrollStateToScene(n));let r=this._transitionBehaviorManager.getTransitionMixinForStateSwap(this._appState.scene(),n,this._multiplayer.isObserving());this._renderer.triggerHsmTransition(t,n,r),this._viewport.invalidate(),this._updateHoveredStateInstanceIfNeeded(n.stablePath)}handleStateChangeAborted(t){this._updateCanvasForCurrentBaseScreen();let n=null,r=[];ee.equals(t.oldStateId(),t.newStateId())||r.push(t.oldStateId());let o=t.oldOverlayData(),a=t.newOverlayData();for(let s=0,l=o.length;s<l;s=s+1)(s>=a.length||!ee.equals(o[s].id,a[s].id))&&r.push(o[s].id);n=r.map(s=>{var l;return(l=this._appState.scene())==null?void 0:l.findNode1(s)}).filter(s=>s!=null),!ee.equals(t.oldStateId(),t.newStateId())&&this.onBaseScreenIdChanged!=null&&this.onBaseScreenIdChanged(t.oldStateId(),Ut.TransitionAction_getControlSource(t.cause),!t.isTransientChange(),this._appState.prototypeState().getOngoingNavigateRepairsInvalidState()),this._renderer.handleAbortedTransition(t),this._updateViewportForCurrentPreview(),this._appState.currentFitMode()==4&&this._appState.baseScreenNode()!=null&&this._viewport.zoomToFit2(0,this._appState.baseScreenNode().canvasSpaceBoundingBox()),this._invalidateZoomScaleForRender(),this._sendMouseCursorUpdate(),this._viewport.invalidate(),this._onCommitOrAbortForInteractions(n,t.cause,t.oldStateId())}handleStateChangeCommitted(t,n){this._updateCanvasForCurrentBaseScreen(),this._renderer.handleCommittedTransition(t);let r=t.getNewOrChangedFrameIds().map(o=>{var a;return(a=this._appState.scene())==null?void 0:a.findNode1(o)}).filter(o=>o!=null);if(this._appState.scene().interactiveComponentsEnabled()){let o=this._appState.scene().findNode1(this._appState.prototypeState().getTopmostScreenId());o!=null&&ye.forEachNode(o,a=>(a!=o&&a.isInstance()&&r.push(a),ye.Loop.CONTINUE))}n(()=>{this._onCommitOrAbortForInteractions(r,t.cause,t.oldStateId())})}handleStateChangeInitiated(t){if(this._updateCanvasForCurrentBaseScreen(),this._appState.baseScreenNode()==null&&!Y.isInlinePreview()){console.warn("no current TLF after receiving update");return}this.setPhysicsForOS(this.getRelevantOS());let n=this._transitionBehaviorManager.getTransitionMixin(this._appState.scene(),t,this._multiplayer.isObserving());this._renderer.triggerTransition(t,this._viewport,n),this.setPhysicsForOS(this.getRelevantOS()),!ee.equals(t==null?void 0:t.oldStateId(),t==null?void 0:t.newStateId())&&this.onBaseScreenIdChanged!=null&&this.onBaseScreenIdChanged(t.newStateId(),Ut.TransitionAction_getControlSource(t.cause),!t.isTransientChange(),this._appState.prototypeState().getOngoingNavigateRepairsInvalidState());let r=this._appState.prototypeState();if(Y.getFeatureFlags().prototype_state_management&&t.stateManagementVersion()==1)this._scrollSyncer.commitCurrentScrollStateToStorage(t),t.resetScroll()==1?this._scrollSyncer.applyStoredScrollStateToScene(t):this._scrollSyncer.resetScrollStateToScene(t);else if(t.preserveScroll()==1)ge.matchNodesAndPreserveScroll(this,r,t);else{let o=t.getNewOrChangedFrameIds().map(a=>{var s;return(s=this._appState.scene())==null?void 0:s.findNode1(a)});for(let a of o)this._resetScrollForTlf(a)}this._pointerEventDelegate.unlockScroll(),this._updateViewportForCurrentPreview(),this._appState.currentFitMode()==4&&this._appState.baseScreenNode()!=null&&this._viewport.zoomToFit2(0,this._appState.baseScreenNode().canvasSpaceBoundingBox()),this._invalidateZoomScaleForRender(),this._sendMouseCursorUpdate(),this._viewport.invalidate()}handleStateChangeRequested(t){}handleFitModeChange(t,n){this._appState.baseScreenNode()!=null&&!Ss.FitMode_topLevelFramesCanScroll(this._appState.prototypeState().getCurrentFitMode())&&(this._appState.activePrototypeDevice()!=null&&Aa.hasDevice(this._appState.activePrototypeDevice().type)||this.updateScrollOffsetForNode(this._appState.baseScreenNode(),new I(0,0))),this._renderer.changeFitMode(n),this._setCurrentViewportSizeOnCanvas()}handleRestartPrototype(){this._scrollSyncer.uninit(),this.cancelAnimationManager(),this._mouseEnteredNodesManager.reset()}_updateCanvasForCurrentBaseScreen(){let t=this._appState.baseScreenNode();(t==null?void 0:t.canvas())!=null&&(this._appState.setActiveCanvas(t.canvas()),this._setCurrentViewportSizeOnCanvas())}_updateViewportForCurrentPreview(){let t=this._renderer.currentCanvasSpaceFrameBounds(),n=this._renderer.currentCanvasSpacePreviewBounds();t!=null&&n!=null?this._viewport.updateForCurrentPreview(t,n,this._appState.currentFitMode(),this._appState.activePrototypeDevice()):this._viewport.updateForBaseScreen(this._appState.baseScreenNode(),this._appState.currentFitMode(),this._appState.activePrototypeDevice())}_invalidateZoomScaleForRender(){this._idlenessTracker.updateZoomScaleNow(this._viewport.zoomScale())}handleSceneGraphEvent(t){ee.equals(t.node.id(),this._appState.baseScreenId())?t.property==25?this._updateCanvasForCurrentBaseScreen():t.property==49&&this._updateViewportForCurrentPreview():t.property==66&&(this._updateViewportForCurrentPreview(),this._invalidateZoomScaleForRender(),this._maybeChangePhysicsForDevice(t.oldVal)),this._handleScrollingPropertyChange(t.node,t.property,t.oldVal,t.newVal),t.property!=62&&this._viewport.invalidate()}handleAction(t,n){switch(t){case 1:{if(Y.isInlinePreview())break;this._viewport.adjustCameraZoomRounded(1,2),this.userDidAttemptZoom!=null&&this.userDidAttemptZoom(0);break}case 2:{if(Y.isInlinePreview())break;this._viewport.adjustCameraZoomRounded(1,.5),this.userDidAttemptZoom!=null&&this.userDidAttemptZoom(0);break}case 3:{this._viewport.setCameraZoom(1,1),this.userDidAttemptZoom!=null&&this.userDidAttemptZoom(0);break}case 4:{if(Y.isInlinePreview())break;this.canvasContentBounds()!=null&&this._viewport.zoomToFit2(1,this.canvasContentBounds()),this.userDidAttemptZoom!=null&&this.userDidAttemptZoom(0);break}}}setup(){this._setupInteractionHandlers(this._emitter),qn.addUpdate(Kt.windowResize(this.events()),t=>{this._resize()}),qn.addUpdate(Kt.windowFrame(this.window().events()),t=>{this._onFrame()}),this._renderer.attachTo(this),this._resize(),this._appState.addActionObserver(this),this._appState.addAppObserver(this)}canvasSpaceToWindowSpace(){let t=po.new2();return t.translate2(this._viewport.viewSpaceBounds().topLeft()),t.multiply(this._viewport.canvasSpaceToViewSpace1()),t}_tryResizingTo(t){this._viewport.setBounds(new G(0,0,t.x(),t.y())),this._updateViewportForCurrentPreview();let n=this._renderer.resize(t.x(),t.y(),this._viewport.zoomScale(),rr());return this.onResize!=null&&(this._setCurrentViewportSizeOnCanvas(),this.onResize()),this._idlenessTracker.handleInteraction(),n}_resize(){let t=this.absoluteBounds(),n=Ie.FrozenVector_new4(t.width(),t.height()),r=this._tryResizingTo(n),o=r.canvasSize;if(r.webGLDidAdjustCanvasSize){let a=this._tryResizingTo(o).canvasSize}}_setCurrentViewportSizeOnCanvas(){let t=this._appState.baseScreenNode();if(t==null)return;let n=t.findContainingCanvasOrSelf();if(n==null)return;let r=null,o=this._appState.prototypeState().getCurrentFitMode();if(o==1||o==2)r=Ie.FrozenVector_INFINITY;else if(o==5||o==6){let a=this._viewport.getScaleFactorForCurrentTlf(t.fullSize(),o,n.prototypeDevice()),s=this._viewport.viewSpaceBounds().size().y()/a;r=new I(1/0,s)}else r=this._viewport.viewSpaceBounds().size();n.currentViewportSize().equals(r)||n.setCurrentViewportSize(r)}renderingIsComplete(){return this._renderer.isRenderingDone()}isTopLevelTransitionOngoing(){return this._renderer.isTopLevelTransitionOngoing()}dangerouslyAccessProtoRenderManager(){return this._renderer}clearTileCaches(){this._renderer.clearTileCaches()}_onFrame(){this._mostRecentFrameNum=this._mostRecentFrameNum+1,this._microtasksSinceLastFrame=0,this._appState.onFrame();let t=this._appState.getActiveCanvas();if(t==null)return;this._clampDirtyScrollContainers(),ge._scrollAnimationManager!=null&&this._updateForAnimation(),Y.viewerExtraBlitFix()&&this._viewport.prepareForRendering(),(this._idlenessTracker.justInteracted()||this._renderer.checkNeedsBlit())&&this._renderer.setNeedsBlit(!0),this._idlenessTracker.advanceFrame(this._viewport),this._viewportTracker.check(this._viewport),Y.viewerExtraBlitFix()||this._viewport.prepareForRendering(),this._updateViewportForCurrentPreview(),this._appState.baseScreenNode()!=null&&this._sendMouseCursorUpdate(),this._updateScrollOffsetsFromMultiplayer();let n=this._appState.baseScreenNode()!=null&&this._appState.baseScreenNode().visible();if(!n)this._renderer.drawBlank();else{this._appState.renderDots()?this._uiRenderData.backgroundColor=E.WHITE:this._uiRenderData.backgroundColor=pp(this._appState.baseScreenId(),this._appState.currentFitMode(),t),this._uiRenderData.hotspots!=null&&this._uiRenderData.hotspots.length!=0&&this._renderer.setNeedsBlit(!0),this._uiRenderData.hotspots=this._findHotspotsToAnimate(),this._uiRenderData.hotspots!=null&&this._uiRenderData.hotspots.length!=0&&this._renderer.setNeedsBlit(!0),this._uiRenderData.hotspotOpacity=this._hotspotAnimation.getOpacity(),this._uiRenderData.particles=this._multiplayer.getParticles(),this._uiRenderData.mouse=this._multiplayer.getMouse(),this._uiRenderData.renderDots=this._appState.renderDots(),Pe.appTimerStart("rendererDraw");let o=this._renderer.draw(this._idlenessTracker.zoomInProgress(),this._idlenessTracker.shouldRenderOptionalTiles(),this._viewport,this._uiRenderData);Pe.appTimerStop("rendererDraw"),this._idlenessTracker.setPreviousRenderStatus(o),this._uiRenderData.particles!=null&&this._uiRenderData.particles.length!=0&&this._viewport.invalidate(),this.isTopLevelTransitionOngoing()&&this._multiplayer.onTransitionFrame(this._renderer.transitionProgressTracker().progress())}this.afterFrame!=null&&this.afterFrame(),this.afterFirstRenderOfScreenStack!=null&&n&&this.afterFirstRenderOfScreenStack(),this._pointerEventDelegate.maybeProcessStoredPointerRelease()}_findHotspotsToAnimate(){let t=a=>{let s=a.canvasSpaceScrolledInteractiveBounds(1),l=a.canvasSpaceScrolledInteractiveBounds(0);return new zc(s,l)},n=this._appState.prototypeState(),r=this._appState.baseScreenNode();if(!(!this._showHotspots||!n.getTransitionOnClick()||this._hotspotAnimation.getOpacity()<=0)&&r!=null){let a=(l,d)=>{var u;let c=d.event().interactionType(),p=(u=d.action())==null?void 0:u.value;if(c=="ON_MEDIA_HIT"||c=="ON_MEDIA_END")return!1;if(d.actions().length==1&&p.navigationType()=="SWAP_STATE"){if(["ON_HOVER","ON_PRESS","AFTER_TIMEOUT"].indexOf(c)!=-1)return!1;if(l!=null)return Zt.whichInstanceToSwap(l,p==null?void 0:p.transitionNodeID())!=null}return!0},s=n.getTopmostOverlayNode();if(s!=null){let l=n.getTopmostOverlay();return this._appState.prototypeStructure().findHotspotsWithNoodleFilter(s,0,a).map(d=>{let c=t(d),p=l.overlaySpaceToBaseTlfSpace2(r,c.canvasSpaceBounds),u=l.overlaySpaceToBaseTlfSpace2(r,c.canvasSpaceClipBounds);return new zc(p,u)})}else return this._appState.prototypeStructure().findHotspotsWithNoodleFilter(r,1,a).map(t)}return null}hitTestDeviceFrame(t){let n=this._appState.getActiveCanvas();if(n==null)return!1;let r=this._appState.baseScreenNode();if(r==null)return!1;let o=this._renderer.deviceRenderer();if(o==null||!o.canRenderDeviceFrame(n.prototypeDevice()))return!1;let a=o.pixelAtPosition(t,r.canvasSpaceBoundingBox(),n.prototypeDevice());return E.alpha(a)>0}hitTestBaseScreen(t){let n=this._appState.baseScreenNode();if(n==null)return 0;let r=this._canvasSpacePoint(t),o=n.canvasSpaceBoundingBox();return o.contains2(r)?o.leftThird().contains2(r)?1:o.rightThird().contains2(r)?3:2:0}_canvasSpacePoint(t){return this._viewport.canvasSpaceToViewSpace1().clone().inverseTransformPoint(t.clone())}canvasContentBounds(){var t;return(t=this._appState.getActiveCanvas())==null?void 0:t.canvasSpaceRenderedBounds()}setMaximumDrawingBufferSizeForTesting(t){this._renderer.getContext().setMaximumDrawingBufferSizeForTesting(t)}clearMaximumDrawingBufferSizeForTesting(){this._renderer.getContext().clearMaximumDrawingBufferSizeForTesting()}triggerResizeForTesting(){let t=this._cachedAbsoluteBounds,n=t.clone();n.setWidth(n.width()-1),this._cachedAbsoluteBounds=n,this._resize(),this._cachedAbsoluteBounds=t,this._resize()}toggleRenderTreePrinting(){this._renderer.toggleRenderTreePrinting()}invalidateIdlenessTracker(){this._idlenessTracker.handleInteraction()}_nonNull(t){return t}_setupInteractionHandlers(t){let n=a=>s=>{Pe.appTimerStart("discreteUserAction"),a(s),Pe.appTimerStop("discreteUserAction")},r=a=>s=>{Pe.appTimerStart("mouseMove"),a(s),Pe.appTimerStop("mouseMove")},o=a=>s=>{Pe.appTimerStart("dragUserAction"),a(s),Pe.appTimerStop("dragUserAction")};qn.addUpdate(Kt.mousePress(this.events()),n(a=>{this._pointerEventDelegate.onMousePress(this._nonNull(a.asMouseEvent()))})),qn.addUpdate(Kt.mouseDrag(this.events()),o(a=>{this._pointerEventDelegate.onDrag(this._nonNull(a.asMouseEvent()))})),qn.addUpdate(Kt.mouseRelease(this.events()),n(a=>{this._pointerEventDelegate.onMouseRelease(this._nonNull(a.asMouseEvent()))})),qn.addUpdate(Kt.mouseMove(this.events()),r(a=>{this._pointerEventDelegate.onMouseMove(this._nonNull(a.asMouseEvent()))})),qn.addUpdate(Kt.mouseScroll(this.events()),o(a=>{this._pointerEventDelegate.onMouseScroll(this._nonNull(a.asMouseEvent()))})),qn.addUpdate(Kt.mouseLeave(this.window().root().events()),n(a=>{this._pointerEventDelegate.onMouseLeave(this._nonNull(a.asMouseEvent()))})),qn.addUpdate(Kt.touchPress(this.events()),n(a=>{this._pointerEventDelegate.onTouchPress(this._nonNull(a.asTouchEvent()))})),qn.addUpdate(Kt.touchDrag(this.events()),o(a=>{this._pointerEventDelegate.onDrag(this._nonNull(a.asTouchEvent()))})),qn.addUpdate(Kt.touchRelease(this.events()),n(a=>{this._pointerEventDelegate.onTouchRelease(this._nonNull(a.asTouchEvent()))})),qn.addUpdate(Kt.keyPress(this.events()),n(a=>{this._pointerEventDelegate.onKeyPress(a.asKeyEvent(),t)})),qn.addUpdate(Kt.gamepadDown(this.events()),n(a=>{this._pointerEventDelegate.onGamepadDown(a.asGamepadEvent())}))}_updateHoveredStateInstanceIfNeeded(t){let n=this._appState.prototypeState(),r=n.getStateMachineInitiatedChange(t)??n.getStateMachineLastChangeInHistory(t);r!=null&&r.cause==2?this._hoveredStateInstances.set(t.toString(),r):this._hoveredStateInstances.delete(t.toString())}_onCommitOrAbortForInteractions(t,n,r){if(this._triggerPotentialTimedTransition(t,n),this._createVideoTriggerEvents(t),Y.getFeatureFlags().prototype_new_mouse_events&&this._mouseEnteredNodesManager.markNodesAsNotEnteredWithoutTriggeringMouseLeave(t.map(o=>o.id())),r!=null&&this._currentMouseLocation!=null&&!this._mostRecentTransitionViaArrows){let o=!this._mostRecentTransitionViaArrowsLegacy,a=this._currentMouseLocation;this._microtasksSinceLastFrame=this._microtasksSinceLastFrame+1,this._microtasksSinceLastFrame<=this.MAX_MICROTASKS_PER_FRAME&&Qd(()=>{this.handleInteractionsForMove(a,o)})}}_createCallbackForMediaEvent(t,n,r){return()=>{this.triggerHotspot(t,n,r,null)}}_createVideoTriggerEvents(t){if(!this._appState.prototypeState().interactionsEnabled())return;let n=new Set([Ut.TransitionAction_mapToInteractionType(20),Ut.TransitionAction_mapToInteractionType(21)]),r=a=>n.has(a.event().interactionType()),o=this._appState.prototypeStructure().findHotspotsWithInteractionFilterWithinMultipleNodes(new Set(t),0,r);for(let a of o)this._registerMediaEventsForHotspot(a)}_registerMediaEventsForHotspot(t){let n=this._appState.prototypeStructure().findPrototypeInteractionsWithInteractionType(t.node,Ut.TransitionAction_mapToInteractionType(20));for(let o of n){let a=o.event().mediaHitTime();this._appState.videoManager().addInteractionEvent(o,t.node.id(),a,this._createCallbackForMediaEvent(t,o,20))}let r=this._appState.prototypeStructure().findPrototypeInteractionsWithInteractionType(t.node,Ut.TransitionAction_mapToInteractionType(21));for(let o=0,a=r.length;o<a;o=o+1){let s=r[o],l=this._createCallbackForMediaEvent(t,s,21);if(this._appState.videoManager().addInteractionEvent(s,t.node.id(),0,l),o+1<r.length){let d=r[o+1];if(this._shouldTriggerVariantInteractionWithMediaAction(s,d)){let c=this._createCallbackForMediaEvent(t,d,21);this._appState.videoManager().addInteractionEvent(d,t.node.id(),0,c)}}}}_triggerPotentialTimedTransition(t,n){if(!this._appState.prototypeState().interactionsEnabled())return;let r=[],o=[],a=null,s=null;for(let d of t){let c=this._appState.prototypeStructure().findPrototypeInteractionsWithInteractionType(d,Ut.TransitionAction_mapToInteractionType(1));for(let p of c)p.getFirstActionInInteractionWithSpecificNavigation("SWAP_STATE")!=null?(r.push(p),o.push(d)):(a==null||p.event().transitionTimeout()<a.event().transitionTimeout())&&(a=p,s=d)}a!=null&&(r.push(a),o.push(s));let l=0;r.forEach(d=>{var b;let c=o[l];l=l+1;let p=d.getFirstActionInInteractionWithSpecificNavigation("SWAP_STATE"),u=p!=null?(b=Zt.whichInstanceToSwap(c,p.transitionNodeID()))==null?void 0:b.stablePath():null,h=this._appState.prototypeState(),f=u!=null?h.actionCountersForStateAndAncestors(u):[h.actionCounter()],y=this._appState.nodeTransitionTracker().topmostScreenChangeCounter(),g=c.stablePath(),A=()=>{var C;let _=(C=this._appState.scene())==null?void 0:C.findNode3(g);if(_==null)return;let m=u!=null?h.actionCountersForStateAndAncestors(u):[h.actionCounter()];this._appState.nodeTransitionTracker().topmostScreenChangeCounter()==y&&ue.List_equalsWithComparison(f,m,(N,x)=>N==x)&&this.triggerDelayedHotspot(_.id(),d,1)},T=d.event().transitionTimeout()*1e3|0;(n==18||n==19)&&(T=Math.max(500,T)),setTimeout(A,T)})}updateCursorType(t,n){if(!this._appState.prototypeState().interactionsEnabled()){this.setCursor(0);return}if(Je.isMobile(this.getRelevantOS())){this.setCursor(2);return}let r=this._appState.prototypeState().getTopmostScreen();if(r==null){this.setCursor(0);return}let o=this._hotspotAtViewportSpacePointWithInteractionType(t,"ON_CLICK",Bt.getNodeInteractionPairs("ON_CLICK",n));o==null&&(o=this._hotspotAtViewportSpacePointWithInteractionType(t,"ON_PRESS",Bt.getNodeInteractionPairs("ON_PRESS",n))),o==null&&(o=this._hotspotAtViewportSpacePointWithInteractionType(t,"MOUSE_DOWN",Bt.getNodeInteractionPairs("MOUSE_DOWN",n))),o==null&&(o=this._hotspotAtViewportSpacePointWithInteractionType(t,"MOUSE_UP",Bt.getNodeInteractionPairs("MOUSE_UP",n))),o!=null&&!ee.equals(o.node.id(),r.id())?this.setCursor(1):this.setCursor(0)}_handleMaintainedInteraction(t,n,r){var y;if(!this._appState.prototypeState().interactionsEnabled()||n==null)return;let o=t.node.id(),a=n.event().interactionType(),s=0;if(Y.getFeatureFlags().prototype_new_mouse_events){if(this._maintainedData.getByHotspotAndInteractionType(o,a)!=null)return;s=this._maintainedData.set(o,a,r)}else{if(ee.equals(this._maintainedDataLegacy.delayedHotspotId(),o))return;this._maintainedDataLegacy.set(o,a,r),s=this._maintainedDataLegacy.counter()}let l=n.getFirstActionInInteractionWithSpecificNavigation("SWAP_STATE"),d=l!=null?(y=Zt.whichInstanceToSwap(t.node,l.transitionNodeID()))==null?void 0:y.stablePath():null,c=d!=null?this._appState.prototypeState().actionCounterForState(d):-1,p=this._appState.prototypeState().actionCounter(),u=()=>{var v;let g=this._maintainedData.getByHotspotAndInteractionType(o,a);if(g==null)return;let A=g.counter(),T=d!=null?this._appState.prototypeState().actionCounterForState(d):-1,b=this._appState.prototypeState().actionCounter(),_=(v=this._appState.scene())==null?void 0:v.findNode1(o),m=s==A,S=m&&p==b&&c==T;m&&this._maintainedData.resetEntry(o,a),S&&_!=null&&this.triggerDelayedHotspot(_.id(),n,g.action())},h=()=>{var m;if(this._maintainedDataLegacy.delayedHotspotId()==null)return;let g=this._maintainedDataLegacy.counter(),A=d!=null?this._appState.prototypeState().actionCounterForState(d):-1,T=this._appState.prototypeState().actionCounter(),b=(m=this._appState.scene())==null?void 0:m.findNode1(this._maintainedDataLegacy.delayedHotspotId());s==g&&p==T&&c==A&&b!=null&&(this.triggerDelayedHotspot(b.id(),n,this._maintainedDataLegacy.action()),this._maintainedDataLegacy.reset())},f=Y.getFeatureFlags().prototype_new_mouse_events?u:h;setTimeout(f,n.event().interactionDuration()*1e3|0)}_handleMouseEnterMouseLeave(t,n){let r=this._canvasSpacePoint(t);this._mouseEnteredNodesManager.updateEnteredNodes(r,n),this._mouseEnteredNodesManager.resetNoLongerMaintainedMouseEnterOrLeaveInteractions(this._maintainedData);let o=ge.WasHandled.NOT_HANDLED,a=this._appState.prototypeState().actionCounter(),s=this._appState.prototypeState(),l=s.getTopmostOverlayNode(),d=this._appState.baseScreenNode(),c=l??d,p=s.getSecondTopmostOverlayNodeOrBaseScreen(),u=this._appState.prototypeStructure().findHotspotsWithInteractionFilter(c,0,g=>g.event().interactionType()=="MOUSE_LEAVE",Bt.getNodeInteractionPairs("MOUSE_LEAVE",n));if(p!=null){let g=this._appState.prototypeStructure().findHotspotsWithInteractionFilter(p,0,A=>A.event().interactionType()=="MOUSE_LEAVE");On(u,g)}let h=this._appState.prototypeStructure().findHotspotsWithInteractionFilter(c,0,g=>g.event().interactionType()=="MOUSE_ENTER",Bt.getNodeInteractionPairs("MOUSE_ENTER",n)),f=this._mouseEnteredNodesManager.getNewlyLeftMouseLeaveHotspotsInOrderOfLeaving(u);for(let g of f){let A=this._appState.prototypeStructure().findPrototypeInteractionsWithInteractionType(g.node,"MOUSE_LEAVE"),T=this._appState.prototypeState().actionCounter();if(a!=T)return o;o=this._triggerOrHandleMaintainedInteractions(A,g,13,t)}let y=this._mouseEnteredNodesManager.getNewlyEnteredMouseEnterHotspotsInOrderOfEntering(h);for(let g of y){let A=this._appState.prototypeStructure().findPrototypeInteractionsWithInteractionType(g.node,"MOUSE_ENTER"),T=this._appState.prototypeState().actionCounter();if(a!=T)return o;o=this._triggerOrHandleMaintainedInteractions(A,g,12,t)}return o}handleInteractionsForMove(t,n){if(this._appState.scene()==null||!this._appState.prototypeState().interactionsEnabled())return;let r=Y.prototypeMouseMovePerf(),o=this._appState.prototypeState().getTopmostScreen(),a=r?this._appState.prototypeStructure().getInteractionsGroupedByType([o]):null;this.updateCursorType(t,a);let s=ge.WasHandled.NOT_HANDLED;if(Y.getFeatureFlags().prototype_new_mouse_events){let l=a,d=Y.getFeatureFlags().prototype_new_mouse_perf;d?!r&&d&&(l=this._appState.prototypeStructure().getInteractionsGroupedByType([o])):l=null,s=this._handleMouseEnterMouseLeave(t,l)}n&&(s=this._handleGranularMoveForDeprecatedMouseInMouseOut(t,a)),s==ge.WasHandled.NOT_HANDLED&&n&&(this._handleHover1(t,a),this._handleReverseHover(t))}_handleGranularMoveForDeprecatedMouseInMouseOut(t,n){let r=10,o=this._hotspotAtViewportSpacePointWithInteractionType(t,"MOUSE_IN",Bt.getNodeInteractionPairs("MOUSE_IN",n));if(!Y.getFeatureFlags().prototype_new_mouse_events&&o==null&&(o=this._hotspotAtViewportSpacePointWithInteractionType(t,"MOUSE_ENTER",Bt.getNodeInteractionPairs("MOUSE_ENTER",n)),r=12),o==null&&(o=this._hotspotAtViewportSpacePointWithInteractionType(t,"MOUSE_OUT",Bt.getNodeInteractionPairs("MOUSE_OUT",n)),r=11),!Y.getFeatureFlags().prototype_new_mouse_events&&o==null&&(o=this._hotspotAtViewportSpacePointWithInteractionType(t,"MOUSE_LEAVE",Bt.getNodeInteractionPairs("MOUSE_LEAVE",n)),r=13),Y.getFeatureFlags().prototype_new_mouse_events?this._maintainedData.resetAllEntriesMatchingPredicate((s,l)=>["MOUSE_IN","MOUSE_OUT"].indexOf(l)!=-1&&!ee.equals(o!=null?o.node.id():null,s)):["MOUSE_IN","MOUSE_OUT","MOUSE_ENTER","MOUSE_LEAVE"].indexOf(this._maintainedDataLegacy.interaction())!=-1&&!ee.equals(o!=null?o.node.id():null,this._maintainedDataLegacy.delayedHotspotId())&&this._maintainedDataLegacy.reset(),o==null)return ge.WasHandled.NOT_HANDLED;let a=this._appState.prototypeStructure().findPrototypeInteractionsWithInteractionType(o.node,Ut.TransitionAction_mapToInteractionType(r));return this._triggerOrHandleMaintainedInteractions(a,o,r,t)}_handleHover1(t,n){let r=this._hotspotAtViewportSpacePointWithInteractionType(t,"ON_HOVER",Bt.getNodeInteractionPairs("ON_HOVER",n));return this._handleHover2(r,t)}handleHoverAtHotspot(t){return this._mostRecentTransitionViaArrows=!0,this._mostRecentTransitionViaArrowsLegacy=!0,this._handleHover2(t,null)}_handleHover2(t,n){if(t!=null){let r=this._appState.prototypeStructure().findPrototypeInteractionsWithInteractionType(t.node,Ut.TransitionAction_mapToInteractionType(2));for(let o of r)return this.triggerHotspot(t,o,2,n),o.setHoverLastHandledFrameNum(this.mostRecentFrameNum()),ge.WasHandled.HANDLED}return ge.WasHandled.NOT_HANDLED}handleReverseHoverAtHotspot(t){var o;let n=t.node,r=Be.StringMap_get(this._hoveredStateInstances,t.node.stablePath().toString(),null);return r==null||!ee.equals((o=n.topLevelAncestor())==null?void 0:o.id(),this._appState.prototypeState().getTopmostScreenId())?ge.WasHandled.NOT_HANDLED:(this._appState.prototypeState().returnInstanceToState(r.stablePath,2,6),ge.WasHandled.HANDLED)}_handleReverseHover(t){var y,g;if(this._multiplayer.isObserving())return ge.WasHandled.HANDLED;let n=this._appState.prototypeState();if(this._appState.scene().interactiveComponentsEnabled()){let A=ge.WasHandled.NOT_HANDLED;for(let T of Array.from(this._hoveredStateInstances.keys())){let b=Be.StringMap_get(this._hoveredStateInstances,T,null);if(b==null)continue;let _=this._appState.scene().findNode3(b.stablePath);if(_==null||!ee.equals((y=_.topLevelAncestor())==null?void 0:y.id(),n.getTopmostScreenId()))continue;let m=(g=b==null?void 0:b.canvasSpaceTriggerBoundsOrNull)==null?void 0:g.clone(),S=n.getCurrentBaseScreenNode();if(m!=null&&S!=null){let v=null,C=this._canvasSpacePoint(t),N=this._appState.prototypeState().getTopmostOverlay();if(v=(N==null?void 0:N.baseTlfSpaceToOverlaySpace1(S,C))??C,_.scrollAndClipBoundsBySelfAndAncestors(m,0).contains2(v))continue;n.returnInstanceToState(b.stablePath,2,6),A=ge.WasHandled.HANDLED;break}}if(A==ge.WasHandled.HANDLED)return A}let r=this._appState.prototypeState().getInitiatedChange()??this._appState.prototypeState().getLastChangeInHistory(),o=r==null?void 0:r.canvasSpaceTriggerBoundsOrNull;if(!(o!=null&&r.cause==2))return ge.WasHandled.NOT_HANDLED;let s=null;if(s=this._appState.scene().findNode1(r==null?void 0:r.oldStateId()),s==null)return ge.WasHandled.NOT_HANDLED;let l=null,d=this._canvasSpacePoint(t);ee.equals(r==null?void 0:r.oldStateId(),r==null?void 0:r.newStateId())||(d=this._canvasSpacePointInPreviousFrame(s,this._appState.baseScreenNode(),d));let c=r==null?void 0:r.oldOverlays(this._appState.prototypeState());c.length>0?l=ue.List_last(c).baseTlfSpaceToOverlaySpace1(s,d):l=d;let p=r!=null?r.interactionAddress.hotspotStablePath:null,u=this._retrieveReverseInteractionHotspotFromStoredData(p);if(u==null||u.scrollAndClipBoundsBySelfAndAncestors(o,0).contains2(l))return ge.WasHandled.NOT_HANDLED;let f=this._appState.prototypeStructure().findPrototypeInteractionsWithInteractionType(this._retrieveReverseInteractionHotspotFromStoredData(p),Ut.TransitionAction_mapToInteractionType(2));for(let A of f){if(A.getHoverLastHandledFrameNum()==this.mostRecentFrameNum())break;return this.requestBack(u,A,2,6,null,null),ge.WasHandled.HANDLED}return ge.WasHandled.NOT_HANDLED}_retrieveReverseInteractionHotspotFromStoredData(t){return this._appState.scene().findNode3(t)}handleInteractionsForPress(t){if(this._lastPressData=null,!this._appState.prototypeState().interactionsEnabled())return ge.WasHandled.HANDLED;Y.getFeatureFlags().prototype_new_mouse_events?this._maintainedData.resetAllEntriesWithInteractionType("MOUSE_UP"):this._maintainedDataLegacy.interaction()=="MOUSE_UP"&&this._maintainedDataLegacy.reset();let n=this._handleMouseDown(t);return n==ge.WasHandled.NOT_HANDLED&&(n=this._handlePress(t)),n}_handleMouseDown(t){if(!this._appState.prototypeState().interactionsEnabled())return ge.WasHandled.HANDLED;let n=this._hotspotAtViewportSpacePointWithInteractionType(t,"MOUSE_DOWN");if(n==null)return ge.WasHandled.NOT_HANDLED;let r=this._appState.prototypeStructure().findPrototypeInteractionsWithInteractionType(n.node,Ut.TransitionAction_mapToInteractionType(8));return this._triggerOrHandleMaintainedInteractions(r,n,8,t)}_handlePress(t){if(!this._appState.prototypeState().interactionsEnabled())return ge.WasHandled.HANDLED;let n=this._hotspotAtViewportSpacePointWithInteractionType(t,"ON_PRESS");if(n==null)return ge.WasHandled.NOT_HANDLED;let r=this._appState.prototypeStructure().findPrototypeInteractionsWithInteractionType(n.node,Ut.TransitionAction_mapToInteractionType(3));for(let o of r){let a=n.node.stablePath(),s=o.getFirstActionInInteractionWithSpecificNavigation("SWAP_STATE");if(s!=null){let l=Zt.whichInstanceToSwap(n.node,s.transitionNodeID());this._lastPressData=new th(l==null?void 0:l.stablePath(),a)}else this._lastPressData=new th(null,a);return this.triggerHotspot(n,o,3,t),ge.WasHandled.HANDLED}return ge.WasHandled.NOT_HANDLED}maybeHandleSingleTapAsNavigation(t){if(this._appState.scene()==null||this._appState.getActiveCanvas()==null)return!1;if(this._appState.prototypeStructure().currentType()==1){let o=this.hitTestBaseScreen(t);if(o!=0&&o!=2){let a=o==1?-1:1;return a==1?this.navigateForward(17):this.navigateBackward(17),Math.random()<this.INTERACTION_REPORTING_RATE&&Pe.trackEvent("prototype_view_interaction",{type:"navigateViaArrows",direction:a==1?"FORWARD":"REVERSE",inputType:"tap",nonInteraction:0,prototypeType:Oi[this._appState.prototypeStructure().currentType()]}),!0}}return!1}maybeAdvanceViaSwipeGesture(t,n){if(!this._appState.prototypeState().interactionsEnabled())return!1;let r=this._appState.getActiveCanvas();if(!(this._appState.prototypeStructure().currentType()==0)||this._appState.storedPrototypeDevice().type=="PRESENTATION"||this._appState.storedPrototypeDevice().type=="NONE"){let a=t==null?!1:t.overflowDirection()=="BOTH"||t.overflowDirection()=="HORIZONTAL",s=t==null||t==r||!a;if(Y.getViewerMode()==Y.ViewerMode.PROTOTYPE&&Math.abs(n.x())>Math.abs(n.y())&&s)return n.x()>0?this.navigateBackward(18):this.navigateForward(19),!0}return!1}handleInteractionsForRelease(t,n,r){let o=this._lastPressData;if(this._lastPressData=null,!this._appState.prototypeState().interactionsEnabled())return ge.WasHandled.HANDLED;Y.getFeatureFlags().prototype_new_mouse_events?this._maintainedData.resetAllEntriesWithInteractionType("MOUSE_DOWN"):this._maintainedDataLegacy.interaction()=="MOUSE_DOWN"&&this._maintainedDataLegacy.reset();let a=this._appState.prototypeState().isDragging(),s=this._viewport.viewSpaceToCanvasSpace1().transformPoint(t.clone());if(this._interactionObservers.forEach(p=>{p.handleRelease(s)}),a)return this._appState.prototypeState().setIsDragging(!1),ge.WasHandled.HANDLED;let l=this._handleMouseUp(t);l==ge.WasHandled.NOT_HANDLED&&n&&(l=this._handleClick(t)),l==ge.WasHandled.NOT_HANDLED&&(l=this._handleReversePress(o));let d=l==ge.WasHandled.NOT_HANDLED,c=r==ge.WasHandled.NOT_HANDLED;return d&&c&&aa.notifyUnhandledMouseRelease(this._appState,s),l}_handleMouseUp(t){if(!this._appState.prototypeState().interactionsEnabled())return ge.WasHandled.HANDLED;let n=this._hotspotAtViewportSpacePointWithInteractionType(t,"MOUSE_UP");if(n==null)return ge.WasHandled.NOT_HANDLED;let r=this._appState.prototypeStructure().findPrototypeInteractionsWithInteractionType(n.node,Ut.TransitionAction_mapToInteractionType(9));return this._triggerOrHandleMaintainedInteractions(r,n,9,t)}_handleReversePress(t){if(!this._appState.prototypeState().interactionsEnabled()||this._multiplayer.isObserving())return ge.WasHandled.HANDLED;if(t==null)return ge.WasHandled.NOT_HANDLED;if(t.swappedStablePath!=null)return this._appState.prototypeState().returnInstanceToState(t.swappedStablePath,2,7),ge.WasHandled.HANDLED;{let n=t.hotspotStablePath!=null?this._retrieveReverseInteractionHotspotFromStoredData(t.hotspotStablePath):null,r=this._appState.prototypeStructure().findPrototypeInteractionsWithInteractionType(n,Ut.TransitionAction_mapToInteractionType(3));for(let o of r)return this.requestBack(n,o,2,7,null,null),ge.WasHandled.HANDLED}return ge.WasHandled.NOT_HANDLED}_handleClick(t){if(this.disengageObservationMode(),!this._appState.prototypeState().interactionsEnabled())return ge.WasHandled.HANDLED;let n=this._hotspotAtViewportSpacePointWithInteractionType(t,"ON_CLICK");if(n!=null){let r=this._appState.prototypeStructure().findPrototypeInteractionsWithInteractionType(n.node,Ut.TransitionAction_mapToInteractionType(4));for(let o=0,a=r.length;o<a;o=o+1){let s=r[o];if(this.triggerHotspot(n,s,4,t),o+1<r.length){let l=r[o+1];this._shouldTriggerVariantInteractionWithMediaAction(s,l)&&this.triggerHotspot(n,l,4,t)}return ge.WasHandled.HANDLED}}if(this._shouldCloseTopmostOverlayOnClickOutside(t)){let r=this._appState.prototypeState().getCurrentOverlayData().length-1;return this._appState.prototypeState().closeOverlayAtAndAbove(r,1),ge.WasHandled.HANDLED}return ge.WasHandled.NOT_HANDLED}performHotspotAnimationOnClick(){this._hotspotAnimation.onClick()}handleInteractionsForDrag(t){if(Y.getFeatureFlags().prototype_new_mouse_events){let r=this._hotspotAtViewportSpacePointWithInteractionType(t,"MOUSE_DOWN");this._maintainedData.resetAllEntriesMatchingPredicate((o,a)=>a=="MOUSE_DOWN"&&!ee.equals(r!=null?r.node.id():null,o))}else if(this._maintainedDataLegacy.interaction()=="MOUSE_DOWN"){let r=this._hotspotAtViewportSpacePointWithInteractionType(t,"MOUSE_DOWN");ee.equals(r!=null?r.node.id():null,this._maintainedDataLegacy.delayedHotspotId())||this._maintainedDataLegacy.reset()}let n=this._viewport.viewSpaceToCanvasSpace1().transformPoint(t.clone());this._interactionObservers.forEach(r=>{r.handleDrag(n)})}handleDragStart(t,n,r){if(!this._appState.prototypeState().interactionsEnabled()||this._appState.prototypeState().isDragging())return ge.WasHandled.HANDLED;if(n==null)return ge.WasHandled.NOT_HANDLED;let o=this._appState.prototypeStructure().findPrototypeInteractionWithId(n!=null?n.id():null,r);if(o==null)return ge.WasHandled.NOT_HANDLED;this.triggerHotspot(new Do(n),o,5,t),this._appState.prototypeState().setIsDragging(!0);let a=this._viewport.viewSpaceToCanvasSpace1().transformPoint(t.clone());return this._interactionObservers.forEach(s=>{s.handleDragStart(a)}),ge.WasHandled.HANDLED}handleInteractionsForScroll(){this.handleScrollAndFindNewNodeToScroll(null)}handleScrollAndFindNewNodeToScroll(t){if(Y.getFeatureFlags().prototype_new_mouse_events?this._maintainedData.resetAllEntriesWithInteractionType("MOUSE_DOWN"):this._maintainedDataLegacy.interaction()=="MOUSE_DOWN"&&this._maintainedDataLegacy.reset(),this._lastPressData!=null){if(t==null)return null;let n=t==this._appState.baseScreenNode();this._handleReversePress(this._lastPressData),this._lastPressData=null;let r=this._appState.baseScreenNode();if(r==null)return null;if(n)return this._appState.baseScreenNode();{let o=r.scrollableFrameDescendants();return ge.findMatchingTransitionNode(t,o)}}return t}handleFling(t,n){var d;let r=n.length,o=ke.seconds(),a=this._appState.getActiveCanvas();if(a==null)return ge.WasHandled.NOT_HANDLED;if(!this._appState.prototypeState().interactionsEnabled())return ge.WasHandled.HANDLED;let s=(d=a.scene())==null?void 0:d.findNode1(t),l=50*rr();this._initialFlingVelocity=new I(0,0);for(let c=r-1;c>=0;c=c-1)if(c==0||o-n[c-1].startTime>.1){let p=n[c],u=n[r-1],h=u.startLocation.subtract1(p.startLocation).divide(u.startTime-p.startTime),f=h.length(),y=Math.log(1+f)/5,g=f*y/5,A=h.multiply(g/f);if(p!=u&&f>l){if(Y.getFeatureFlags().swipe_presentation&&this.maybeAdvanceViaSwipeGesture(s,h))break;if(s==null||s==a)this._viewport.flingCameraOffset(A,y);else{this._initialFlingVelocity=this.restrictScrollDeltaAxes(s,h).negative();let T=ge._scrollPhysics.createBallisticScrollSimulation(s.scrollOffset(),this._initialFlingVelocity,s.minScrollOffsetX(),s.maxScrollOffsetX(),s.minScrollOffsetY(),s.maxScrollOffsetY());return T!=null&&(ge._scrollAnimationManager=new Ol(T,s.id())),ge.WasHandled.HANDLED}}break}return ge.WasHandled.NOT_HANDLED}handleInteractionsForLeave(){Y.getFeatureFlags().prototype_new_mouse_events?(this._maintainedData.resetAllEntriesWithInteractionType("MOUSE_DOWN"),this._maintainedData.resetAllEntriesWithInteractionType("MOUSE_IN")):(this._maintainedDataLegacy.interaction()=="MOUSE_DOWN"||this._maintainedDataLegacy.interaction()=="MOUSE_IN")&&this._maintainedDataLegacy.reset(),this.handleInteractionsForMove(Ie.FrozenVector_new4(-1,-1),!0)}handleInteractionsForKeyPress(t){let n=this._appState.prototypeState().getTopmostScreen(),r=this._appState.prototypeStructure().findHotspotsWithInteractionType(n,0,"ON_KEY_DOWN"),o=this._createListFromKeyEvent(t),a=l=>(l=Je.current()!=4&&l==this.META_CODE?this.CONTROL_CODE:l,o.some(d=>d.indexOf(l)!=-1)),s=l=>{let d=l.event().keyTrigger().triggerDevice=="KEYBOARD",c=l.event().keyTrigger().keyCodes;if(c==null)return!1;let p=c.length==o.length;return d&&p&&c.every(a)};for(let l of r){let c=this._appState.prototypeStructure().findPrototypeInteractionsWithInteractionType(l.node,Ut.TransitionAction_mapToInteractionType(14)).filter(s);for(let p=0,u=c.length;p<u;p=p+1){let h=c[p];if(this.triggerHotspot(l,h,14,null),p+1<c.length){let f=c[p+1];this._shouldTriggerVariantInteractionWithMediaAction(h,f)&&this.triggerHotspot(l,f,14,null)}return t.accept(),ge.WasHandled.HANDLED}}return ge.WasHandled.NOT_HANDLED}_createListFromKeyEvent(t){let n=[];return 1&t.modifiers()&&n.push([this.ALT_CODE]),4&t.modifiers()&&n.push([this.SHIFT_CODE]),2&t.modifiers()&&n.push([this.META_CODE]),8&t.modifiers()&&n.push([this.CONTROL_CODE]),dc.Key_isModifier(t.key)||n.push(dc.Key_keyToKeyCode(t.key)),n}handleInteractionsForGamepadDown(t){let n=this._appState.prototypeState().getTopmostScreen(),r=a=>{let s=a.event().keyTrigger().triggerDevice!="KEYBOARD";return a.event().keyTrigger().keyCodes==null?!1:s&&a.event().keyTrigger().keyCodes.indexOf(t.button)!=-1},o=this._appState.prototypeStructure().findHotspotsWithInteractionType(n,0,"ON_KEY_DOWN");for(let a of o){let l=this._appState.prototypeStructure().findPrototypeInteractionsWithInteractionType(a.node,Ut.TransitionAction_mapToInteractionType(14)).filter(r);for(let d=0,c=l.length;d<c;d=d+1){let p=l[d];if(this.triggerHotspot(a,p,14,null),d+1<l.length){let u=l[d+1];this._shouldTriggerVariantInteractionWithMediaAction(p,u)&&this.triggerHotspot(a,u,14,null)}return t.accept(),ge.WasHandled.HANDLED}}return ge.WasHandled.NOT_HANDLED}addInteractionObserver(t){this._interactionObservers.add(t)}removeInteractionObserver(t){this._interactionObservers.remove(t)}_hotspotAtViewportSpacePointWithInteractionType(t,n,r){if(!this._appState.prototypeState().getTransitionOnClick())return null;let o=this._canvasSpacePoint(t);return this._hotspotAtCanvasSpacePointWithInteractionType(o,n,r)}_hotspotAtCanvasSpacePointWithInteractionType(t,n,r){let o=this._appState.baseScreenNode();if(o==null||!o.canvasSpaceBoundingBox().contains2(t)&&n!="MOUSE_OUT")return null;let a=this._appState.prototypeState(),s=a.getTopmostOverlayNode();if(s!=null){let l=a.getTopmostOverlay().baseTlfSpaceToOverlaySpace1(o,t);return this._appState.prototypeStructure().hotspotOnPresentedNode(s,l,n,r)}else return this._appState.prototypeStructure().hotspotOnPresentedNode(o,t,n,r)}_canvasSpacePointInPreviousFrame(t,n,r){if(t==n)return r;let o=n.absoluteTransform().clone();if(!o.invert())return r;let a=t.absoluteTransform(),s=r.clone();return o.transformPoint(s),a.transformPoint(s),s}updateUserCursor(t){this._currentMouseLocation=t==null?void 0:t.locationInView(this),this._sendMouseCursorUpdate()}_shouldCloseTopmostOverlayOnClickOutside(t){let n=this._appState.prototypeState().getTopmostOverlay(),r=this._appState.prototypeState().getTopmostOverlayNode(),o=this._appState.baseScreenNode();if(o==null||r==null||n.backgroundInteraction()!="CLOSE_ON_CLICK_OUTSIDE")return!1;let a=this._canvasSpacePoint(t),s=n.baseTlfSpaceToOverlaySpace1(o,a);return!r.canvasSpaceBoundingBox().contains2(s)}recordViewportSpaceClick(t){let n=this._canvasSpacePoint(t);n!=null&&this._multiplayer.recordCanvasSpaceClick(n)}_sendMouseCursorUpdate(){if(this._currentMouseLocation==null)this._multiplayer.setCanvasSpaceMouse(null);else{let t=this._canvasSpacePoint(this._currentMouseLocation);t!=null&&this._multiplayer.setCanvasSpaceMouse(t)}}triggerMouseAction(t,n){this._appState.triggerAction2(t,n)}_triggerOrHandleMaintainedInteractions(t,n,r,o){for(let a=0,s=t.length;a<s;a=a+1){let l=ge.WasHandled.NOT_HANDLED,d=t[a];if(d.event().interactionMaintained()?(this._handleMaintainedInteraction(n,d,r),l=ge.WasHandled.MAINTAINED):(this.triggerHotspot(n,d,r,o),l=ge.WasHandled.HANDLED),a+1<t.length){let c=t[a+1];this._shouldTriggerVariantInteractionWithMediaAction(d,c)&&(d.event().interactionMaintained()?(this._handleMaintainedInteraction(n,c,r),l=ge.WasHandled.MAINTAINED):(this.triggerHotspot(n,c,r,o),l=ge.WasHandled.HANDLED))}return l}return ge.WasHandled.NOT_HANDLED}_shouldTriggerVariantInteractionWithMediaAction(t,n){let r=t.allActions().length>=1&&t.allActions().every(d=>d.connectionType()=="UPDATE_MEDIA_RUNTIME"),o=t.allActions().length>=1&&t.allActions().every(d=>ee.isValid(d.transitionNodeID())),a=n.getFirstActionInInteractionWithSpecificNavigation("SWAP_STATE"),s=a!=null&&a.connectionType()=="INTERNAL_NODE",l=r&&o&&s;return l&&Y.getFeatureFlags().prototype_log_video_and_ic_swap&&Pe.trackEvent("prototype_interaction_conflict_override_triggered",{interaction_type:t.event().interactionType(),action_type:t.actions().map(d=>d.mediaAction())}),l}getRelevantOS(){return this._appState.getActiveCanvas()==null?0:ge._getRelevantOSForDevice(this._appState.getActiveCanvas().prototypeDevice())}_resetScrollForTlf(t){if(t!=null){this.updateScrollOffsetForNode(t,Ie.FrozenVector_ZERO);let n=t.scrollableFrameDescendants();for(let r of n)this.updateScrollOffsetForNode(r,Ie.FrozenVector_ZERO)}}getBestScrollOrDragProposal(t,n,r){let o=this._appState.getActiveCanvas();if(o==null)return null;if(this._appState.currentFitMode()==3&&this._viewport.zoomScale()!=1)return new ge.ScrollOrDragProposal(ge.ScrollOrDragProposal.InteractionType.SCROLL,1,o==null?void 0:o.id(),null);let a=this._canvasSpacePoint(n);if(a==null||this._appState.baseScreenNode()==null)return null;let s=null;t==ge.ScrollOrDragQuerySet.SCROLL_OR_DRAG&&(s=(d,c)=>hn.computeDragVector1(d,c,this._appState.baseScreenNode(),this._appState.prototypeStructure(),this._appState.prototypeState()));let l=this._appState.prototypeState().getCurrentOverlays();for(let d=0,c=l.length;d<c;d=d+1){let p=l[l.length-d-1],u=p.node();if(u==null)continue;let h=p.baseTlfSpaceToOverlaySpace1(this._appState.baseScreenNode(),a);if(!u.canvasSpaceBoundingBox().contains2(h)){if(p.backgroundAppearance().backgroundType=="SOLID_COLOR")return null;continue}let f=ge.findBestScrollOrDragProposalInFrame(o,h,r,u,this._appState.activePrototypeDevice(),s);return ee.equals(f==null?void 0:f.targetNodeId,o==null?void 0:o.id())?null:f}return ge.findBestScrollOrDragProposalInFrame(o,a,r,this._appState.baseScreenNode(),this._appState.activePrototypeDevice(),s)}_updateForAnimation(){if(ge._scrollAnimationManager==null)return;let t=!ge._scrollAnimationManager.isValid(this._appState.scene());t||(ge._scrollAnimationManager.performScroll(this,this._appState.scene()),t=ge._scrollAnimationManager.isDone()),t&&(this.cancelAnimationManager(),this._sequentialActionManager.runNextAction())}cancelAnimationManager(){ge._scrollAnimationManager=null}maybeHandleOverdragRelease(){var r;if(ge._overscrolledNodeID==null)return;let t=(r=this._appState.scene())==null?void 0:r.findNode1(ge._overscrolledNodeID);ge._overscrolledNodeID=null,!(t==null||ge.clampScrollOffsetForNode(t,t.scrollOffset()).equals(t.scrollOffset()))&&(ge._scrollAnimationManager=new Ol(new ul(t.scrollOffset(),new I(0,0),t.minScrollOffsetX(),t.maxScrollOffsetX(),t.minScrollOffsetY(),t.maxScrollOffsetY()),t.id()))}setPhysicsForOS(t){switch(wg(t)){case 0:{ge._scrollPhysics=new Pc;break}case 1:{ge._scrollPhysics=new Fc;break}case 2:{ge._scrollPhysics=new al;break}}}_maybeChangePhysicsForDevice(t){let n=this.getRelevantOS(),r=ge._getRelevantOSForDevice(t);n!=r&&this.setPhysicsForOS(n)}updateScrollOffsetForNode(t,n){let r=ge.clampScrollOffsetForNode(t,n),o=this.restrictScrollDeltaAxes(t,n),a=this._pointerEventDelegate.isDragging();if(t.scrollOffset().equals(r)&&(!a||t.scrollOffset().equals(n)))return!1;if(a&&!r.equals(n)){let l=ge._scrollPhysics.applyOverscrollBehavior(o,r,t.scrollOffset(),t.size());l.equals(r)||(ge._overscrolledNodeID=t.id(),r=l)}t.setScrollOffset(r),this._observers.forEach(l=>{l.didScrollNode(t)}),this._emitter.trigger("scrollNode",t.id());let s=t.id();return this._multiplayer.setScrollPosition(s,t.scrollOffset()),!0}setScrollOffsetUnconditionally(t,n){t.setScrollOffset(n);let r=t.id();this._multiplayer.setScrollPosition(r,n)}restrictScrollDeltaAxes(t,n){let r=n.clone();switch(t.scrollDirection()){case"HORIZONTAL":{r.setY(0);break}case"VERTICAL":{r.setX(0);break}case"NONE":{r.setX(0),r.setY(0);break}case"BOTH":{let o=null;switch(t.overflowDirection()){case"NONE":{o="NONE";break}case"HORIZONTAL":{o="HORIZONTAL";break}case"VERTICAL":{o="VERTICAL";break}case"BOTH":{o="BOTH";break}}!sr.scrollsHorizontally(o)&&!t.hasOverflowingContentInXDirection()&&r.setX(0),!sr.scrollsVertically(o)&&!t.hasOverflowingContentInYDirection()&&r.setY(0);break}}return r}scrollToDestinationInFrame(t,n){let r=this._appState.scene().findNode1(t),o=r.parent();for(;o!=null&&!((o.scrollDirection()!="NONE"||o.isTopLevel())&&!o.isTooRotatedToScroll());)o=o.parent();if(o!=null){let a=n.action().value;for(let d of n.getAllActionsWithSpecificTransitionType("SCROLL_ANIMATE"))a=d;let s=Jn.fromPrototypeAction(a,Y.getFeatureFlags().prototype_state_management?n.stateManagementVersion():0),l=r.absoluteTransform().translation().add1(s.extraScrollOffset).subtract1(o.absoluteTransform().translation());if(a.transitionType()=="SCROLL_ANIMATE"){let d=ge.clampScrollOffsetForNode(o,l);ge._scrollAnimationManager=new Ol(new Dc(o.scrollOffset(),d,s.transitionDuration,s.easingFunction),o.id())}else this.updateScrollOffsetForNode(o,l)}}scrollNode(t,n,r){var l,d;let o=(l=this._appState.scene())==null?void 0:l.findNode1(t);if(o==null)return!1;if(ge._scrollAnimationManager!=null&&ge._scrollAnimationManager.isOverscrolled()){let c=ge._scrollAnimationManager;if(o.id()!=c.nodeID()){let p=(d=this._appState.scene())==null?void 0:d.findNode1(c.nodeID());p!=null&&p.setScrollOffset(c.simulation().endPos())}this.cancelAnimationManager()}else ge._scrollAnimationManager!=null&&n!=ge.ScrollSource.FLING&&this.cancelAnimationManager();if(o.isTooRotatedToScroll()||o.scrollDirection()=="NONE")return!1;let a=o.scrollOffset().clone();o.scrollDirection()=="HORIZONTAL"?a.setX(a.x()+(r.x()==0&&n==ge.ScrollSource.SCROLL_EVENT?r.y():r.x())):a.addUpdate1(r);let s=this.updateScrollOffsetForNode(o,a);return this.disengageObservationMode(),s}_updateScrollOffsetsFromMultiplayer(){var n;let t=this._multiplayer.getScrollPositions();if(t!=null)for(let r of Array.from(t.keys())){let o=ee.fromString(r),a=(n=this._appState.scene())==null?void 0:n.findNode1(o);a!=null&&a.setScrollOffset(t.get(r))}}_clampDirtyScrollContainers(){let t=this._appState.scene();if(t==null)return;let n=new Set;for(let r of Array.from(ge._dirtyNodesForScrollClamping.values())){let o=t.findNode2(r);for(let a=o;a!=null&&!(n.has(a.id())||a!=o&&Jt.isFrameLike(a.type())&&a.clipsToBoundingRectangle());a=a.parent())a.scrollDirection()!="NONE"&&this.updateScrollOffsetForNode(a,a.scrollOffset()),n.add(a.id())}ge._dirtyNodesForScrollClamping=new Set}_handleScrollingPropertyChange(t,n,r,o){if(n==34)t.setScrollOffset(Ie.FrozenVector_ZERO);else if(n==49||n==24)ge._dirtyNodesForScrollClamping.add(t.id());else if(n==66){let a=this._appState.baseScreenNode();a!=null&&this.updateScrollOffsetForNode(a,a.scrollOffset())}else n==88&&(this._renderer.updateScroll(t),this._emitter.trigger("scrollEvent",null))}renderLayerByLayerActivate(){this._renderer.renderLayerByLayerActivate(()=>{this.viewport().invalidate()})}renderLayerByLayerDeactivate(){this._renderer.renderLayerByLayerDeactivate()}renderLayerByLayerPlay(){this._renderer.renderLayerByLayerPlay()}renderLayerByLayerPause(){this._renderer.renderLayerByLayerPause()}renderLayerByLayerForward(){this._renderer.renderLayerByLayerForward()}renderLayerByLayerBackward(){this._renderer.renderLayerByLayerBackward()}renderLayerByLayerRewind(){this._renderer.renderLayerByLayerRewind()}renderLayerByLayerIncreaseSpeed(){this._renderer.renderLayerByLayerIncreaseSpeed()}renderLayerByLayerDecreaseSpeed(){this._renderer.renderLayerByLayerDecreaseSpeed()}static findBestScrollOrDragProposalInTree(t,n,r,o,a){let s=o==0,l=null;return l=(d,c)=>{let p=d.canvasSpaceGeometryBounds().contains2(c),u=d.canvasSpaceBoundingBox().contains2(c);if(d.clipsToBoundingRectangle()&&!p&&!u)return null;let h=null;for(let _=0,m=d.childCount();_<m;_=_+1){let S=d.childAt2(d.childCount()-_-1,!0),v=c,C=Ra.getScrollTranslationOfNodeRelativeToParent1(S);v=c.add1(C);let N=l(S,v);h=(h==null?void 0:h.updateToBestProposal1(N))??N}let f=d.scrollDirectionWithScrollableContent(),y=u||p,g=f!="NONE"&&y&&!d.isInvisibleOrTransparent(),A=y&&d.visible()&&d.prototypeInteractions().some(_=>_.event().interactionType()=="DRAG"&&_.allActions().some(m=>ed.isValidForConnection(_.event().interactionType(),m.connectionType()))),T=n.length()>0?n.divide(n.length()):n,b=null;if(y){if(g){let _=Zy(f),m=ge.ScrollOrDragProposal.InteractionType.OVERSCROLL;Math.abs(T.y())>0&&Math.abs(_.y())>0&&(T.y()>0?d.scrollOffset().y()<d.maxScrollOffsetY():d.scrollOffset().y()>d.minScrollOffsetY())&&(m=ge.ScrollOrDragProposal.InteractionType.SCROLL),Math.abs(T.x())>0&&Math.abs(_.x())>0&&(T.x()>0?d.scrollOffset().x()<d.maxScrollOffsetX():d.scrollOffset().x()>d.minScrollOffsetX())&&(m=ge.ScrollOrDragProposal.InteractionType.SCROLL);let S=sr.getDirectionSimilarity(f,T);(m==ge.ScrollOrDragProposal.InteractionType.SCROLL||s)&&(b=new ge.ScrollOrDragProposal(m,S,d.id(),null))}if(a!=null&&A){let _=T.multiply(-1);for(let m of d.prototypeInteractions().filter(S=>S.event().interactionType()=="DRAG")){let S=a(d,m),v=S!=null?_.dot(S.divide(S.length())):0;b=(b==null?void 0:b.updateToBestProposal2(ge.ScrollOrDragProposal.InteractionType.DRAG,v,d.id(),m.id()))??new ge.ScrollOrDragProposal(ge.ScrollOrDragProposal.InteractionType.DRAG,v,d.id(),m.id())}}}return b=(h==null?void 0:h.updateToBestProposal1(b))??b,b},l(r,t)}static _canvasSpaceBoundsOfDeviceBackground(t,n){let r=Br.infoForDevice(n);if(r==null)return Kn.FrozenRect_EMPTY;let o=t.canvasSpaceBoundingBox().topLeft(),a=n.canvasSpaceFramePresetSize(r);return new G(o.x(),o.y(),a.x(),a.y())}static findBestScrollOrDragProposalInFrame(t,n,r,o,a,s){if(o==null)return null;let l=a!=null&&Aa.hasDevice(a.type),d=wg(ge._getRelevantOSForDevice(a)),c=Math.abs(r.y())>Math.abs(r.x())?"VERTICAL":"HORIZONTAL",p=o.scrollsInPreferredDirection(c)&&o.hasOverflowingContentInScrollDirection();if(o.canvasSpaceBoundingBox().contains2(n)){let u=ge.findBestScrollOrDragProposalInTree(n,r,o,d,s);if(u!=null)return u;if(l)return null}else if(l){if(ge._canvasSpaceBoundsOfDeviceBackground(o,a).contains2(n))return null}else if(p)return new ge.ScrollOrDragProposal(ge.ScrollOrDragProposal.InteractionType.SCROLL,1,o.id(),null);return new ge.ScrollOrDragProposal(ge.ScrollOrDragProposal.InteractionType.SCROLL,1,t==null?void 0:t.id(),null)}static copyScrollOffset(t,n,r){n!=null&&r!=null&&(t==null?r.setScrollOffset(n.scrollOffset()):t.updateScrollOffsetForNode(r,n.scrollOffset()))}static findMatchingTransitionNode(t,n){let r=n.filter(d=>d.name()==t.name());if(r.length==1)return r[0];let o=t.canvasSpaceBoundingBox(),a=n.filter(d=>d.canvasSpaceBoundingBox().size().approximatelyEquals(o.size(),1));if(a.length==0)return null;if(a.length==1)return a[0];let s=t.topLevelAncestor(),l=o.topLeft();s!=null&&l.subtractUpdate1(s.canvasSpaceBoundingBox().topLeft());for(let d of a){let c=d.canvasSpaceBoundingBox().topLeft(),p=d.topLevelAncestor();if(p!=null&&c.subtractUpdate1(p.canvasSpaceBoundingBox().topLeft()),l.approximatelyEquals(c,1))return d}return null}static matchNodesAndPreserveScroll(t,n,r){if(!ee.equals(r.oldStateId(),r.newStateId())){let s=n.lastNodeForBaseScreen(),l=n.nextNodeForBaseScreen();ge.findMatchingNodesAndPreserveScroll(t,s,l)}let o=r.oldStateAndOverlays.overlays,a=r.newStateAndOverlays.overlays;for(let s=0,l=Math.min(o.length,a.length);s<l;s=s+1)if(!ee.equals(o[s].id,a[s].id)){let d=n.lastNodeForOverlayAt(s),c=n.nextNodeForOverlayAt(s);ge.findMatchingNodesAndPreserveScroll(t,d,c)}}static findMatchingNodesAndPreserveScroll(t,n,r){if(n!=null&&r!=null){ge.copyScrollOffset(t,n,r);let o=n.scrollableFrameDescendants(),a=r.scrollableFrameDescendants();for(let s of o){if(a.length==0)break;let l=ge.findMatchingTransitionNode(s,a);l!=null&&(ge.copyScrollOffset(t,s,l),ue.List_removeOne(a,l))}}}static clampScrollOffsetForNode(t,n){if(t.scrollDirection()=="NONE")return Ie.FrozenVector_ZERO.clone();let r=I.new2();return t.scrollDirection()=="HORIZONTAL"?r.setX(un.Math_clamp1(n.x(),t.minScrollOffsetX(),t.maxScrollOffsetX())):t.scrollDirection()=="VERTICAL"?r.setY(un.Math_clamp1(n.y(),t.minScrollOffsetY(),t.maxScrollOffsetY())):t.scrollDirection()=="BOTH"&&(r.setX(un.Math_clamp1(n.x(),t.minScrollOffsetX(),t.maxScrollOffsetX())),r.setY(un.Math_clamp1(n.y(),t.minScrollOffsetY(),t.maxScrollOffsetY()))),r}static _getRelevantOSForDevice(t){return Je.current()==2||Je.current()==1||t==null?Je.current():t.os()==2||t.os()==1?t.os():Je.current()}};ge._scrollPhysics=new al,ge._scrollAnimationManager=null,ge._overscrolledNodeID=null,ge._dirtyNodesForScrollClamping=new Set;var Ua=ge;(l=>{class i{constructor(c){this._debounceScrollCallback=()=>{let c=performance.now();this._currentTimeoutForMouseMove=0,this._nodeIdRecordedDuringDebounceScroll==this._scrollingNodeId&&(c-uf>=this._lastRecordedDebouncedScrollTimeMs?this._canvasView.handleInteractionsForMove(this._lastRecordedScrollPoint,!0):this._currentTimeoutForMouseMove=setTimeout(this._debounceScrollCallback,this._lastRecordedDebouncedScrollTimeMs-(c-uf)))};this._canvasView=null,this._dragStart=null,this._isDragging=!1,this._isDragGestureConfirmed=!1,this._isDragInteractionLocked=!1,this._activeScrollOrDrag=null,this._flingPoints=null,this._currentGesture=null,this._previousGesture=null,this._scrollingNodeId=null,this._lastScrollEvent=0,this._currentTimeoutForMouseMove=0,this._lastPointerPressHandled=0,this._storedPointerReleasePoint=null,this._lastPointerPressHandledAt=0,this._canvasView=c}unlockScroll(){this._lastScrollEvent=0,this._scrollingNodeId=null}resetStateForTests(){this._resetDragInfo(),this._flingPoints=null,this._currentGesture=null,this._previousGesture=null,this._scrollingNodeId=null,this._lastScrollEvent=0,this._lastPointerPressHandled=0,this._storedPointerReleasePoint=null,this._lastPointerPressHandledAt=0}isDragging(){return this._isDragging}_handleSinglePointerPress(c,p){let u=c.locationInView(this._canvasView);this._canvasView.triggerMouseAction(p,u),this._dragStart=u,this._isDragGestureConfirmed=!1,this._canvasView.recordViewportSpaceClick(this._dragStart),c.accept(),this._flingPoints=[],this._currentGesture=new rh(u,ke.seconds(),c.interactionType()),this._lastPointerPressHandled=this._canvasView.handleInteractionsForPress(u),this._lastPointerPressHandled!=0&&(this._lastPointerPressHandledAt=ke.seconds())}onMousePress(c){this._handleSinglePointerPress(c,6),this._canvasView.cancelAnimationManager()}onTouchPress(c){this._canvasView.cancelAnimationManager(),c.touches.length==1?this._handleSinglePointerPress(c,10):c.accept()}_processPointerRelease(c){var b;if(!this._canvasView.appState().prototypeState().interactionsEnabled())return!1;let p=this._isDragGestureConfirmed,u=!p&&this._lastPointerPressHandled!=2,h=p&&this._lastPointerPressHandled==1&&(this._activeScrollOrDrag==null||this._activeScrollOrDrag.interactionType==l.ScrollOrDragProposal.InteractionType.DRAG),f=u||h,y=this._canvasView.handleInteractionsForRelease(c,f,this._lastPointerPressHandled);return(this._isDragging?this._canvasView.handleFling((b=this._activeScrollOrDrag)==null?void 0:b.targetNodeId,this._flingPoints):0)==0&&this._canvasView.maybeHandleOverdragRelease(),!p&&y==0&&this._lastPointerPressHandled==0&&this._canvasView.performHotspotAnimationOnClick(),!p&&this._canvasView.appState().scene()!=null&&Y.getViewerMode()==Y.ViewerMode.MIRROR&&this._canvasView.appState().triggerAction1(5),this._canvasView.updateCursorType(c,null),this._resetDragInfo(),p||y==1||this._lastPointerPressHandled==1}_storeOrProcessPointerReleaseAtPoint(c){if(ke.seconds()-this._lastPointerPressHandledAt<y1)this._storedPointerReleasePoint=c;else if(this._processPointerRelease(c))return 1;return this._lastPointerPressHandledAt=0,0}onMouseRelease(c){let p=c.locationInView(this._canvasView);this._canvasView.triggerMouseAction(9,p),this._storeOrProcessPointerReleaseAtPoint(p)}onTouchRelease(c){c.touches.length==0&&this._currentGesture!=null?(this._currentGesture!=null&&(this._currentGesture.endTime=ke.seconds(),this.isSingleTap()?this._storeOrProcessPointerReleaseAtPoint(this._currentGesture.endLocation)==0&&this._canvasView.appState().prototypeState().getTransitionOnClick()&&this._canvasView.maybeHandleSingleTapAsNavigation(this._currentGesture.endLocation):this._storeOrProcessPointerReleaseAtPoint(this._currentGesture.endLocation)),this._resetDragInfo()):c.touches.length==0&&this._canvasView.maybeHandleOverdragRelease(),this._previousGesture=this._currentGesture,this._currentGesture=null}_resetDragInfo(){this._dragStart=null,this._activeScrollOrDrag=null,this._isDragging=!1,this._isDragGestureConfirmed=!1,this._isDragInteractionLocked=!1}onDrag(c){var u;let p=c.locationInView(this._canvasView);if(this._isDragging=!0,this._dragStart!=null&&!this._isDragGestureConfirmed&&(this._isDragGestureConfirmed=c.interactionCount()>1||p.distanceTo(this._dragStart)>_1),this._dragStart!=null&&this._isDragGestureConfirmed&&!this._isDragInteractionLocked){let h=p.subtract1(this._dragStart).multiply(-1);this._activeScrollOrDrag=this._canvasView.getBestScrollOrDragProposal(1,this._dragStart,h)}if(!this._canvasView.appState().prototypeState().isDragging()){if(this._isDragGestureConfirmed&&Y.getDragToPan()&&this._activeScrollOrDrag!=null){let h=c.delta(),f=(u=this._canvasView.appState().scene())==null?void 0:u.findNode1(this._activeScrollOrDrag.targetNodeId);switch(this._activeScrollOrDrag.interactionType){case l.ScrollOrDragProposal.InteractionType.SCROLL:case l.ScrollOrDragProposal.InteractionType.OVERSCROLL:{if(f!=null&&f!=this._canvasView.appState().getActiveCanvas()){if(this._canvasView.scrollNode(f.id(),1,h.negative().divide(this._canvasView.viewport().zoomScale()))){this._lastPointerPressHandled=1,this._isDragInteractionLocked=!0;let g=this._canvasView.handleScrollAndFindNewNodeToScroll(f);g==null&&Ve("new scroll node is null"),this._activeScrollOrDrag.targetNodeId=g==null?void 0:g.id()}}else this._canvasView.viewport().panCamera(h);break}case l.ScrollOrDragProposal.InteractionType.DRAG:{this._lastPointerPressHandled=this._canvasView.handleDragStart(p,f,this._activeScrollOrDrag.targetInteractionId),this._isDragInteractionLocked=!0;break}}c.interactionCount()!=1?this._currentGesture=null:this._currentGesture!=null&&(this._flingPoints.push(new rh(p,ke.seconds(),c.interactionType())),this._currentGesture.endLocation=p,this._currentGesture.endTime=ke.seconds())}}this._canvasView.idlenessTracker().handleInteraction(),this._canvasView.handleInteractionsForDrag(p),c.interactionType()==0&&(this._canvasView.updateUserCursor(c),this._canvasView.triggerMouseAction(8,p))}onMouseScroll(c){var y;let p=this._canvasView.appState().getActiveCanvas();if(p==null)return;let u=ke.seconds();u-this._lastScrollEvent>oT&&(this._scrollingNodeId=null);let h=c.locationInView(this._canvasView),f=this._canvasView.appState().activePrototypeDevice()!=null&&Aa.hasDevice(this._canvasView.appState().activePrototypeDevice().type);if((8&c.modifiers()||2&c.modifiers())&&Ss.FitMode_userCanManuallyZoom(this._canvasView.appState().prototypeState().getCurrentFitMode(),f))this._canvasView.viewport().adjustCameraZoomWithPin(Math.pow(.99,c.scrollDelta.y()),h.subtract1(this._canvasView.viewport().viewSpaceBounds().topLeft())),c.accept(),this._canvasView.userDidAttemptZoom!=null&&this._canvasView.userDidAttemptZoom(1);else{let g=(y=p.scene())==null?void 0:y.findNode1(this._scrollingNodeId);if(g==null){let A=this._canvasView.getBestScrollOrDragProposal(0,h,c.scrollDelta);g=this._canvasView.appState().scene().findNode1(A==null?void 0:A.targetNodeId),this._scrollingNodeId=g==null?void 0:g.id()}g==null||(g!=p?(this._canvasView.scrollNode(this._scrollingNodeId,0,c.scrollDelta.divide(this._canvasView.viewport().zoomScale()))&&(this._canvasView.handleInteractionsForScroll(),Y.optimizationExposureLogging()&&Dt.didEncounterDebounceScrollHover(),Y.debounceMouseMoveScrolling()?(this._lastRecordedScrollPoint=h,this._lastRecordedDebouncedScrollTimeMs=performance.now(),this._nodeIdRecordedDuringDebounceScroll=this._scrollingNodeId,this._currentTimeoutForMouseMove==0&&(this._currentTimeoutForMouseMove=setTimeout(this._debounceScrollCallback,uf))):this._canvasView.handleInteractionsForMove(h,!0)),c.accept()):Y.getScrollToPan()&&(this._canvasView.viewport().panCamera(c.scrollDelta.negative()),this._scrollingNodeId=p.id(),c.accept(),this._canvasView.handleInteractionsForMove(h,!0)))}this._lastScrollEvent=u,this._canvasView.idlenessTracker().handleInteraction()}onMouseMove(c){let p=c.locationInView(this._canvasView);this._canvasView.updateUserCursor(c),this._canvasView.triggerMouseAction(7,p),this._canvasView.handleInteractionsForMove(p,!0),this._scrollingNodeId=null}onMouseLeave(c){this._canvasView.updateUserCursor(null),this._canvasView.handleInteractionsForLeave()}onKeyPress(c,p){let u=this._canvasView.handleInteractionsForKeyPress(c);Y.isInlinePreview()&&u==0&&(c.key==7||c.key==8&&4&c.modifiers())&&p.trigger("requestClose",{})}onGamepadDown(c){this._canvasView.handleInteractionsForGamepadDown(c)}maybeProcessStoredPointerRelease(){this._storedPointerReleasePoint!=null&&(this._processPointerRelease(this._storedPointerReleasePoint),this._storedPointerReleasePoint=null)}isSingleTap(){return this._canvasView.appState().baseScreenNode()!=null&&this._currentGesture!=null&&this._currentGesture.isTap()}}l.CanvasPointerEventDelegate=i;let e;(u=>(u[u.NOT_HANDLED=0]="NOT_HANDLED",u[u.HANDLED=1]="HANDLED",u[u.MAINTAINED=2]="MAINTAINED"))(e=l.WasHandled||(l.WasHandled={}));let t;(p=>(p[p.SCROLL_ONLY=0]="SCROLL_ONLY",p[p.SCROLL_OR_DRAG=1]="SCROLL_OR_DRAG"))(t=l.ScrollOrDragQuerySet||(l.ScrollOrDragQuerySet={}));class n{updateToBestProposal1(c){return c!=null&&this.updateToBestProposal2(c.interactionType,c.directionSimilarity,c.targetNodeId,c.targetInteractionId),this}updateToBestProposal2(c,p,u,h){return(this.interactionType==l.ScrollOrDragProposal.InteractionType.OVERSCROLL&&c==l.ScrollOrDragProposal.InteractionType.DRAG||p>this.directionSimilarity)&&(this.interactionType=c,this.directionSimilarity=p,this.targetNodeId=u,this.targetInteractionId=h),this}constructor(c,p,u,h){this.interactionType=c,this.directionSimilarity=p,this.targetNodeId=u,this.targetInteractionId=h}}l.ScrollOrDragProposal=n,(p=>{let d;(y=>(y[y.OVERSCROLL=0]="OVERSCROLL",y[y.SCROLL=1]="SCROLL",y[y.DRAG=2]="DRAG"))(d=p.InteractionType||(p.InteractionType={}));let c;(h=>{function u(f){return l.ScrollOrDragProposal.InteractionType[f]}h.InteractionType_toString=u})(c=p.in_InteractionType||(p.in_InteractionType={}))})(n=l.ScrollOrDragProposal||(l.ScrollOrDragProposal={}));let r;(u=>(u[u.SCROLL_EVENT=0]="SCROLL_EVENT",u[u.DRAGGING=1]="DRAGGING",u[u.FLING=2]="FLING"))(r=l.ScrollSource||(l.ScrollSource={}));let o;(c=>{function d(p){return l.WasHandled[p]}c.WasHandled_toString=d})(o=l.in_WasHandled||(l.in_WasHandled={}));let a;(c=>{function d(p){return l.ScrollOrDragQuerySet[p]}c.ScrollOrDragQuerySet_toString=d})(a=l.in_ScrollOrDragQuerySet||(l.in_ScrollOrDragQuerySet={}));let s;(c=>{function d(p){return l.ScrollSource[p]}c.ScrollSource_toString=d})(s=l.in_ScrollSource||(l.in_ScrollSource={}))})(Ua||(Ua={}));var rh=class{constructor(e,t,n){this.startLocation=null,this.startTime=0,this.endLocation=null,this.endTime=0,this.type=0,this.startLocation=e,this.startTime=t,this.endLocation=e,this.endTime=t,this.type=n}isTap(){return(this.endLocation==null||this.startLocation.distanceTo(this.endLocation)<S1)&&this.endTime-this.startTime<A1}},$b;(e=>{function i(t){return hd[t]}e.RenderCallStatus_toString=i})($b||($b={}));var eT;(e=>{function i(t){return oh[t]}e.ZoomMethod_toString=i})(eT||(eT={}));var tT;(e=>{function i(t){return Ap[t]}e.TransitionSource_toString=i})(tT||(tT={}));var Ut;(s=>{function i(l){switch(l){case 1:case 20:case 21:case 4:case 5:case 9:case 17:case 18:case 19:return!1;case 2:case 3:case 6:case 7:case 8:case 10:case 11:case 12:case 13:return!0;default:return!1}}s.TransitionAction_isTransientAction=i;function e(l){switch(l){case 2:return 6;case 3:return 7;case 6:return 2;case 7:return 3;case 10:return 11;case 11:return 10;case 12:return 13;case 13:return 12;case 8:return 9;default:return 0}}s.TransitionAction_getOppositeTransientAction=e;function t(l){switch(l){case"TIMER":return 1;case"ON_HOVER":return 2;case"ON_PRESS":return 3;case"ON_CLICK":return 4;case"REVERSE_HOVER":return 6;case"REVERSE_PRESS":return 7;case"MOUSE_DOWN":return 8;case"MOUSE_UP":return 9;case"MOUSE_IN":return 10;case"MOUSE_OUT":return 11;case"MOUSE_ENTER":return 12;case"MOUSE_LEAVE":return 13;case"ON_KEY_DOWN":return 14;case"ON_GAMEPAD_DOWN":return 15;case"ON_VOICE":return 16;case"MOBILE_NAV":return 17;case"LEFT_ARROW":return 18;case"RIGHT_ARROW":return 19;case"ON_MEDIA_HIT":return 20;case"ON_MEDIA_END":return 21}return 0}s.TransitionAction_fromString=t;function n(l){return[1,18,19,20,21].indexOf(l)!=-1?0:1}s.TransitionAction_getControlSource=n;function r(l){switch(l){case"AFTER_TIMEOUT":return 1;case"ON_HOVER":return 2;case"ON_PRESS":return 3;case"ON_CLICK":return 4;case"DRAG":return 5;case"MOUSE_DOWN":return 8;case"MOUSE_UP":return 9;case"MOUSE_IN":return 10;case"MOUSE_OUT":return 11;case"MOUSE_ENTER":return 12;case"MOUSE_LEAVE":return 13;case"ON_KEY_DOWN":return 14;case"ON_VOICE":return 16;case"ON_MEDIA_HIT":return 20;case"ON_MEDIA_END":return 21}return Ve("fromInteractionType InteractionType not handled"),0}s.TransitionAction_fromInteractionType=r;function o(l){switch(l){case 1:return"AFTER_TIMEOUT";case 2:return"ON_HOVER";case 3:return"ON_PRESS";case 4:return"ON_CLICK";case 5:return"DRAG";case 8:return"MOUSE_DOWN";case 9:return"MOUSE_UP";case 10:return"MOUSE_IN";case 11:return"MOUSE_OUT";case 12:return"MOUSE_ENTER";case 13:return"MOUSE_LEAVE";case 14:return"ON_KEY_DOWN";case 15:return"ON_KEY_DOWN";case 16:return"ON_VOICE";case 20:return"ON_MEDIA_HIT";case 21:return"ON_MEDIA_END"}return Ve("mapToInteractionType TransitionAction not handled"),null}s.TransitionAction_mapToInteractionType=o;function a(l){return Tn[l]}s.TransitionAction_toString=a})(Ut||(Ut={}));var nT;(e=>{function i(t){return rT[t]}e.BaseScreenHitTestResult_toString=i})(nT||(nT={}));var _1=5,oT=.2,uf=1.5*oT*1e3,A1=.4,S1=50,y1=.1;function pf(i){return i.x()==375&&i.y()==812?"APPLE_IPHONE_X_SILVER":i.x()==414&&i.y()==736?"APPLE_IPHONE_8_PLUS_SILVER":i.x()==375&&i.y()==667?"APPLE_IPHONE_8_SILVER":i.x()==320&&i.y()==568?"APPLE_IPHONE_SE_SILVER":i.x()==411&&i.y()==731?"GOOGLE_PIXEL_2_CLEARLY_WHITE":i.x()==768&&i.y()==1024?"APPLE_IPAD_MINI_4_SILVER":i.x()==1024&&i.y()==1366?"APPLE_IPAD_PRO_SILVER":i.x()==1440&&i.y()==990?"MICROSOFT_SURFACE_PRO_3":i.x()==1368&&i.y()==912?"MICROSOFT_SURFACE_PRO_4":i.x()==312&&i.y()==390?"APPLE_WATCH_42MM_STEEL_PLUS_WHITE_CLOSED":i.x()==272&&i.y()==340?"APPLE_WATCH_38MM_STEEL_PLUS_WHITE_CLOSED":null}var Ee=class Ee{constructor(){if(arguments.length==2){let e=arguments[0],t=arguments[1];this._paths=new Map,this._imageManager=null,this._videoManager=null,this._imageManager=e,this._videoManager=t}else if(arguments.length==1){let e=arguments[0];this._paths=new Map,this._imageManager=null,this._videoManager=null,this._imageManager=e}}static hash(e,t){return t instanceof Array&&t.length===0?e:t}static hasFileHeader(e){for(let t=0,n=Ee.FILE_HEADER.length;t<n;t=t+1)if(t>=e.length||e[t]!=Ee.FILE_HEADER[t])return!1;return!0}static parseChunkType(e){return e.length!=Ee.CHUNK_TAG_LEN?Ee.ChunkType.UNKNOWN:(n=>{for(let r=0,o=e.length;r<o;r=r+1)if(e[r]!=n[r])return!1;return!0})(Ee.THUMBNAIL_CHUNK_TAG)?Ee.ChunkType.THUMBNAIL:Ee.ChunkType.UNKNOWN}static readInt32(e,t){return e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24}static _logVerbose(e){console.log(e)}static _logVerbosePropertyChange(e,t){console.log(`decoded property change '${t}' for node '${e}'`)}static encodeGUID(e){return ee.toFigGUID(e)}static encodeGUIDPath(e){let t={};return e.guids!=null&&(t.guids=e.guids.map(n=>Ee.encodeGUID(n))),t}static encodeInstanceStateChange(e,t){let n={};return n.stateID=Ee.encodeGUID(e.newStateId()),n.interactionID=Ee.encodeGUID(e.interactionAddress.interactionId),e.interactionAddress.hotspotStablePath!=null&&(n.hotspotStablePath=Ee.encodeGUIDPath(e.interactionAddress.hotspotStablePath)),e.stablePath!=null&&(n.instanceStablePath=Ee.encodeGUIDPath(e.stablePath)),n.phase=t,n}static encodePrototypeStateChange(e){let t={};if(e.oldStateAndOverlays!=null){let n={};e.oldStateAndOverlays.stateId!=null&&(n.baseScreenID=Ee.encodeGUID(e.oldStateAndOverlays.stateId),n.overlays=e.oldStateAndOverlays.overlays.map(r=>Ee.encodeOverlayData(r,null))),t.oldState=n}if(e.newStateAndOverlays!=null){let n={};e.newStateAndOverlays.stateId!=null&&(n.baseScreenID=Ee.encodeGUID(e.newStateAndOverlays.stateId),n.overlays=e.newStateAndOverlays.overlays.map(r=>Ee.encodeOverlayData(r,null))),t.newState=n}return e.interactionAddress.hotspotStablePath!=null&&(t.hotspotBlueprintID=Ee.encodeGUIDPath(e.interactionAddress.hotspotStablePath)),t.isHotspotInNewPresentedState=[6,7].indexOf(e.cause)==-1,t.interactionID=Ee.encodeGUID(e.interactionAddress.interactionId),t.direction=e.direction==0?"FORWARD":"REVERSE",t}static encodeOverlayData(e,t){let n={};return n.hotspotBlueprintId=Ee.encodeGUIDPath(e.openingHotspotStablePath),t!=null&&(n.hotspotGuid=Ee.encodeGUID(t)),n.overlayGuid=Ee.encodeGUID(e.id),n.prototypeInteractionGuid=Ee.encodeGUID(e.openingInteractionId),n.swapGuid=Ee.encodeGUID(e.overlayDataModelId),n}static encodeMatrix(e){let t={};return t.m00=e.m00(),t.m01=e.m01(),t.m02=e.m02(),t.m10=e.m10(),t.m11=e.m11(),t.m12=e.m12(),t}static encodeVector1(e){let t={};return t.x=e.x(),t.y=e.y(),t}static encodeVector2(e){let t={};return t.x=e.x(),t.y=e.y(),t}static decodeGUID(e){let t=null,n=e.sessionID|0;if(n<0){let r=e.localID|0;n==-1&&(r==-1||r==-2)?t=ee._new(n,r):(Ve("Negative session ID encountered in GUID deserialization"),t=ee._new(e.sessionID,e.localID))}else t=ee._new(e.sessionID,e.localID);return Ze.asGUID(t)}static decodeGUID_instanceHACK(e){return ee._new(e.sessionID|0,e.localID)}static decodeGUIDPath(e){if(e.guids===void 0)return null;let t=[];for(let n of e.guids){let r=Ee.decodeGUID(n);if(r==null)return null;t.push(r)}return new Mt(t)}static decodeStyleId(e){let t=e.guid!=null?Ee.decodeGUID(e.guid):null,n=e.assetRef!=null?{key:e.assetRef.key,version:e.assetRef.version}:null,r={guid:t,ref:n};return Ze.asStyleId(r)}static decodeParentIndex(e){return new Gn(Ee.decodeGUID(e.guid),sn.fromString(e.position))}static decodeVector(e){return new I(e.x,e.y)}static decodeMatrix(e){return new ne(e.m00,e.m01,e.m02,e.m10,e.m11,e.m12)}static decodeColor(e){return E.new3(e.r,e.g,e.b,e.a)}static decodeFontName(e){let t=e.postscript!==void 0?e.postscript:"";return new Qp(e.family,e.style,t)}static decodeNumber(e){return new Wp(e.value,e.units)}static decodeStops(e){let t=[];for(let n of e)t.push(new $e(Ee.decodeColor(n.color),n.position));return t}static decodePrototypeDevice(e){let t=Ee.decodeVector(e.size),n=e.presetIdentifier!==void 0?e.presetIdentifier:null;e.type=="PRESET"&&(n==null||n.length==0)&&(n=pf(t));let r=e.rotation!==void 0?e.rotation:"NONE";return new Tr(e.type,t,n,r)}static decodePrototypeStartingPoint(e){return new Di(e.name,e.description,sn.fromString(e.position))}static encodePrototypeStartingPoint(e){let t={};return t.name=e.name,t.description=e.description,t.position=sn.toString(e.position),t}static decodeOverlayBackgroundAppearance(e){return new ni(e.backgroundType!==void 0?e.backgroundType:"NONE",e.backgroundColor!==void 0?Ee.decodeColor(e.backgroundColor):E.TRANSPARENT)}static decodeVideoPlayback(e){return{autoplay:e.autoplay!==void 0?e.autoplay:!1,mediaLoop:e.mediaLoop!==void 0?e.mediaLoop:!1,muted:e.muted!==void 0?e.muted:!1}}static decodeEffects(e){let t=[];for(let r of e){let o=new we;o.setType(r.type),r.color!==void 0&&(o.setBlurColor(E.withAlpha(Ee.decodeColor(r.color),255)),o.setOpacity(r.color.a)),r.blendMode!==void 0&&o.setBlendMode(r.blendMode),r.offset!==void 0&&o.setBlurOffset1(Ee.decodeVector(r.offset)),r.radius!==void 0&&o.setBlurRadius(r.radius),r.visible!==void 0&&o.setIsEnabled(r.visible),r.spread!==void 0&&o.setSpread(r.spread),r.showShadowBehindNode!==void 0?o.setShowShadowBehindNode(r.showShadowBehindNode):o.setShowShadowBehindNode(!0),t.push(o)}let n=t;return Ze.asEffectList(n)}static decodeExportConstraint(e){return e.type!==void 0&&e.value!==void 0?new Rl(e.type,e.value):new Rl("CONTENT_SCALE",1)}static decodeExportSettings(e,t){let n=[];for(let r of e){let o=null;r.suffix!==void 0?o=r.suffix:o="";let a=null;r.imageType!==void 0?a=r.imageType:a="PNG";let s=null;r.constraint!==void 0?s=Ee.decodeExportConstraint(r.constraint):s=new Rl("CONTENT_SCALE",1);let l=t;r.contentsOnly!==void 0&&(l=r.contentsOnly),n.push(new Kp(o,a,s,l))}return n}static decodePrototypeInteractions(e){return e.map(t=>Ee.decodePrototypeInteraction(t))}static decodePrototypeInteraction(e){let t=e.id!==void 0?Ee.decodeGUID(e.id):null,n=e.event!==void 0?Ee.decodePrototypeEvent(e.event):null,r=e.actions!==void 0?e.actions.map(s=>Ee.decodePrototypeAction(s)):null,o=e.isDeleted!==void 0?e.isDeleted:!1,a=e.stateManagementVersion!==void 0?e.stateManagementVersion:0;return new Zt(t,n,r,o,a)}static encodePrototypeInteractionForTests(e){let t={};t.id=Ee.encodeGUID(e.id()),t.isDeleted=e.isDeleted(),t.stateManagementVersion=e.stateManagementVersion(),t.event=Ee.encodePrototypeEventForTests(e.event());let n=[],r=e.actions();for(let o=0,a=r.length;o<a;o=o+1){let s=r[o];n.push(Ee.encodePrototypeActionForTests(s))}return t.actions=n,t}static decodePrototypeEvent(e){let t=e.interactionType!==void 0?e.interactionType:null,n=e.interactionMaintained!==void 0?new _e(e.interactionMaintained):null,r=e.interactionDuration!==void 0?new _e(e.interactionDuration):null,o=e.keyTrigger!==void 0?e.keyTrigger:null,a=e.transitionTimeout!==void 0?new _e(e.transitionTimeout):null,s=e.mediaHitTime!==void 0?new _e(e.mediaHitTime):null;return new $r(t,n,r,o,a,s)}static encodePrototypeEventForTests(e){let t={};return t.interactionType=e.interactionType(),t.interactionMaintained=e.interactionMaintained(),t.interactionDuration=e.interactionDuration(),t.keyTrigger=e.keyTrigger(),t.keyTrigger.keyCodes=e.keyTrigger().keyCodes,t.keyTrigger.triggerDevice=e.keyTrigger().triggerDevice,t.transitionTimeout=e.transitionTimeout(),t.mediaHitTime=e.mediaHitTime(),t}static decodeConditionalActions(e){let t=[],n=e.actions!==void 0?e.actions.map(o=>Ee.decodePrototypeAction(o)):t,r=e.condition!==void 0?Ee.variableDataToJson(e.condition):"";return new $c(n,r)}static encodeConditionalActionsForTests(e){let t={},n=[],r=e.actions();for(let o=0,a=r.length;o<a;o=o+1){let s=r[o];n.push(Ee.encodePrototypeActionForTests(s))}return t.actions=n,t}static decodePrototypeAction(e){let t=e.transitionNodeID!==void 0?Ee.decodeGUID(e.transitionNodeID):null,n=e.transitionType!==void 0?e.transitionType:null,r=e.transitionDuration!==void 0?new _e(e.transitionDuration):null,o=e.easingType!==void 0?e.easingType:null,a=e.easingFunction!==void 0?e.easingFunction:null,s=e.transitionShouldSmartAnimate!==void 0?new _e(e.transitionShouldSmartAnimate):null,l=e.connectionType!==void 0?e.connectionType:null,d=e.connectionURL!==void 0?e.connectionURL:null,c=e.overlayRelativePosition!==void 0?Ee.decodeVector(e.overlayRelativePosition):null,p=e.navigationType!==void 0?e.navigationType:null,u=e.transitionPreserveScroll!==void 0?new _e(e.transitionPreserveScroll):null,h=e.extraScrollOffset!==void 0?Ee.decodeVector(e.extraScrollOffset):null,f=e.mediaAction!==void 0?e.mediaAction:null,y=e.transitionResetVideoPosition!==void 0?new _e(e.transitionResetVideoPosition):null,g=e.openUrlInNewTab!==void 0?new _e(e.openUrlInNewTab):null,A=e.mediaSkipToTime!==void 0?new _e(e.mediaSkipToTime):null,T=e.mediaSkipByAmount!==void 0?new _e(e.mediaSkipByAmount):null,b=e.transitionResetScrollPosition!==void 0?new _e(e.transitionResetScrollPosition):null,_=e.conditionalActions!==void 0?e.conditionalActions.map(C=>Ee.decodeConditionalActions(C)):null,m=e.transitionResetInteractiveComponents!==void 0?new _e(e.transitionResetInteractiveComponents):null,S=e.targetVariable!==void 0?cd.toString(e.targetVariable.id):null,v=e.targetVariableData!==void 0?Ee.variableDataToJson(e.targetVariableData):null;return new jn(t,n,r,o,a,s,l,d,c,p,u,h,f,y,g,A,T,b,_,m,S,v)}static variableDataToJson(e){let t={},n=e.dataType;switch(t.type=Ee.variableDataTypeToEnumValue(n),t.resolvedType=Ee.variableResolvedDataTypeToEnumValue(e.resolvedDataType),n){case"BOOLEAN":{t.value=e.value.boolValue;break}case"STRING":{t.value=e.value.textValue;break}case"FLOAT":{t.value=e.value.floatValue;break}case"COLOR":{let r={};r.r=e.value.colorValue.r,r.g=e.value.colorValue.g,r.b=e.value.colorValue.b,r.a=e.value.colorValue.a,t.value=r;break}case"ALIAS":{t.value=cd.toString(e.value.alias);break}case"EXPRESSION":{t.value=Ee.expressionToJson(e.value.expressionValue);break}case"MAP":throw new Error("Did not implement variableDataToJson for MAP data type")}return t}static variableDataTypeToEnumValue(e){switch(e){case"BOOLEAN":return 0;case"FLOAT":return 1;case"STRING":return 2;case"ALIAS":return 3;case"COLOR":return 4;case"EXPRESSION":return 5;case"MAP":return 6;case"SYMBOL_ID":return 7}throw new Error(`Invalid variable data type: ${e}`)}static variableResolvedDataTypeToEnumValue(e){switch(e){case"BOOLEAN":return 0;case"FLOAT":return 1;case"STRING":return 2;case"COLOR":return 3;case"MAP":return 4;case"SYMBOL_ID":return 5}throw new Error(`Invalid resolved variable data type: ${e}`)}static expressionToJson(e){let t={};t.expressionFunction=Ee.expressionFunctionToEnumValue(e.expressionFunction);let n=[];for(let r=0;r<e.expressionArguments.length;r=r+1)n.push(Ee.variableDataToJson(e.expressionArguments[r]));return t.expressionArguments=n,t}static expressionFunctionToEnumValue(e){switch(e){case"ADDITION":return 0;case"SUBTRACTION":return 1;case"RESOLVE_VARIANT":return 2;case"MULTIPLY":return 3;case"DIVIDE":return 4;case"EQUALS":return 5;case"NOT_EQUAL":return 6;case"LESS_THAN":return 7;case"LESS_THAN_OR_EQUAL":return 8;case"GREATER_THAN":return 9;case"GREATER_THAN_OR_EQUAL":return 10;case"AND":return 11;case"OR":return 12;case"NOT":return 13;case"STRINGIFY":return 14;case"TERNARY":return 15;case"VAR_MODE_LOOKUP":return 16;case"NEGATE":return 17}throw new Error(`Invalid expression function: ${e}`)}static encodePrototypeActionForTests(e){let t={};t.transitionNodeID=Ee.encodeGUID(e.transitionNodeID()),t.transitionType=e.transitionType(),t.transitionDuration=e.transitionDuration(),t.easingType=e.easingType(),t.easingFunction=e.easingFunctionValues(),t.transitionShouldSmartAnimate=e.transitionShouldSmartAnimate(),t.connectionType=e.connectionType(),t.connectionURL=e.connectionURL(),t.overlayRelativePosition=Ee.encodeVector1(e.overlayRelativePosition()),t.navigationType=e.navigationType(),t.transitionPreserveScroll=e.transitionPreserveScroll(),t.extraScrollOffset=Ee.encodeVector1(e.extraScrollOffset()),t.mediaAction=e.mediaAction(),t.transitionResetVideoPosition=e.transitionResetVideoPosition(),t.openUrlInNewTab=e.openUrlInNewTab(),t.mediaSkipToTime=e.mediaSkipToTime(),t.mediaSkipByAmount=e.mediaSkipByAmount(),t.transitionResetScrollPosition=e.transitionResetScrollPosition();let n=[],r=e.conditionalActions();for(let o=0,a=r.length;o<a;o=o+1){let s=r[o];n.push(Ee.encodeConditionalActionsForTests(s))}return t.conditionalActions=n,t.transitionResetInteractiveComponents=e.transitionResetInteractiveComponents(),t}static serializeValueToKiwiForTests1(e,t){let n={},r=[];return Ee.serializeValueToKiwiForTests2(e,t,n,r),new ar(n,r)}static serializeValueToKiwiForTests2(e,t,n,r){if(!Lo.isTestingEnv())throw new Error("Should only serialize values to kiwi when running tests");if(e==59||e==60){let o=Ze.asPaintList(t);if(o==null)throw new Error("attempt to set null paint list");let a=[];for(let s=0,l=o.length;s<l;s=s+1){let d=o[s].asSinglePaint(),c={};if(c.type=d.type(),c.opacity=d.opacity(),c.visible=d.isEnabled(),c.blendMode=d.blendMode(),d.colorStops()!=null){let u=[];for(let h=0,f=d.colorStops().length;h<f;h=h+1){let y=d.colorStops()[h],g={},A={};A.r=E.redF(y.color),A.g=E.greenF(y.color),A.b=E.blueF(y.color),A.a=E.alphaF(y.color),g.color=A,g.position=y.position,u.push(g)}c.stops=u}let p={};if(p.r=E.redF(d.color()),p.g=E.greenF(d.color()),p.b=E.blueF(d.color()),p.a=E.alphaF(d.color()),c.color=p,d.image()!=null){let u={};u.hash=Un.hexToBytes(d.image().hash()),c.image=u,c.imageScaleMode=d.imageScaleMode()}a.push(c)}e==59?n.fillPaints=a:e==60&&(n.strokePaints=a)}else if(e==75){let o=t;if(o==null)throw new Error("attempt to set null symbol data");let a={};a.symbolID=Ee.encodeGUID(o.masterID);let s=[];Vo.map(o.instanceOverrides).each((l,d)=>{let c={};c.guidPath=Ee.encodeGUIDPath(l),pn.each(d,(p,u)=>{Ee.serializeValueToKiwiForTests2(p,u,c,[])}),s.push(c)}),a.symbolOverrides=s,n.symbolData=a}else if(e==73||e==74){let o=t;if(o==null)throw new Error("attempt to set null geometry");let a=[];for(let s=0,l=o.regions.length;s<l;s=s+1){let d=o.regions[s],c={};c.windingRule=d.windingRule,c.styleID=d.styleID,c.commandsBlob=r.length,r.push(Et.mutableData(d.path().toBezierPath().getMutableClone()).bytes()),a.push(c)}e==73?n.fillGeometry=a:n.strokeGeometry=a}else if(e==4){let o=t;if(o==null)throw new Error("attempt to set null textData");let a={};a.characters=o.characters();let s=[];o.styleOverrideTable().forEachStyle((d,c)=>{Ko.each(c,(p,u)=>{let f=Ee.serializeValueToKiwiForTests1(p,u).a;f.styleID=d,s.push(f)})}),a.styleOverrideTable=s;let l=[];o.usedEmojiCodepointsDEPRECATED().forEach(d=>{let c={};c.emojiCodePoints=d,l.push(c)}),a.glyphs=l,n.textData=a}else if(e==5){let o=t;if(o==null)throw new Error("attempt to set null textData");let a={},s=[];o.usedEmojiCodepoints().forEach(l=>{let d={};d.emojiCodePoints=l,s.push(d)}),a.glyphs=s,a.hyperlinkBoxes=o.hyperlinkBoxes().map(l=>({guid:l.guid,bounds:l.bounds,hyperlinkID:l.hyperlinkID,url:l.url})),n.derivedTextData=a}else if(e==61){let o=Ze.asEffectList(t);if(o==null)throw new Error("attempt to set null effects");let a=[];for(let s=0,l=o.length;s<l;s=s+1){let d=o[s],c={};c.blendMode=d.blendMode(),c.radius=d.blurRadius(),c.spread=d.spread(),c.visible=d.isEnabled(),c.showShadowBehindNode=d.showShadowBehindNode(),c.type=d.type();let p={};p.r=E.redF(d.blurColor()),p.g=E.greenF(d.blurColor()),p.b=E.blueF(d.blurColor()),p.a=d.opacity(),c.color=p;let u=Ee.encodeVector2(d.blurOffset());c.offset=u,a.push(c)}n.effects=a}else if(e==51){let o=Ze.asGUID(t);if(o==null)throw new Error("attempt to set null overridenSymbolID");n.overriddenSymbolID=Ee.encodeGUID(o)}else if(e==82){let o=t;if(o==null)throw new Error("attempt to set null prototypeInteractions");let a=[];for(let s=0,l=o.length;s<l;s=s+1){let c=o[s];a.push(Ee.encodePrototypeInteractionForTests(c))}n.prototypeInteractions=a}else if(e==98){let o=Ze.asStringEnum(t,null);if(o==null)throw new Error("Bad node phase");n.phase=o}else{let o=yd(e);throw new Error(`unsupported setter for node field ${Ct[e]} and type ${Sd[o]}`)}}_imageDecoded(e,t,n){this._imageManager!=null&&this._imageManager.onNewImage(e,t,n)}_imageByHexHashOrNull(e,t){var n;return(n=this._imageManager)==null?void 0:n.findImageByHexHash(e,t)}decodeImage(e,t,n){let r=Un.bytesToHex(e.hash),o=this._imageByHexHashOrNull(r,1);if(o==null){let a=null;if(e.dataBlob!==void 0){let s=e.dataBlob;s<0||s>=t.length?console.warn(`ignoring invalid compressed data index ${s} for blob count ${t.length}`):a=t[s].bytes}Lr?o=new il(null,r):o=Un.createImage(e.hash,a,n),this._imageDecoded(r,1,o)}return o}decodeVideo(e){let t=new Uint8Array(e.hash);return this._videoManager.buildVideoResource(t)}decodeEmojiImage(e){let t=e.map(r=>r.toString(16)).join("-"),n=this._imageByHexHashOrNull(t,0);return n==null&&(n=Un.createEmojiImage2(t),this._imageDecoded(t,0,n)),n}decodePaints(e,t){let n=[];for(let o of e){let a=new ie(o.type);if(o.blendMode!==void 0&&a.setBlendMode(o.blendMode),o.color!==void 0){let s=Ee.decodeColor(o.color);a.setOpacity(E.alphaF(s)),a.setColor(E.withAlpha(s,255))}if(o.opacity!==void 0&&a.setOpacity(a.opacity()*o.opacity),o.stops!==void 0&&a.setColorStops1(Ee.decodeStops(o.stops)),o.transform!==void 0&&a.setTransform1(Ee.decodeMatrix(o.transform)),o.visible!==void 0&&a.setIsEnabled(o.visible),o.imageScaleMode!==void 0&&a.setImageScaleMode(o.imageScaleMode),o.rotation!==void 0&&a.setRotationDeg(o.rotation),o.scale!==void 0&&a.setScalingFactor(o.scale),o.paintFilter!==void 0&&a.setFilterColorAdjust(o.paintFilter),o.originalImageWidth!==void 0&&a.setOriginalImageWidth(o.originalImageWidth),o.originalImageHeight!==void 0&&a.setOriginalImageHeight(o.originalImageHeight),o.emojiCodePoints!==void 0)a.setImage(this.decodeEmojiImage(o.emojiCodePoints));else{let s=!1;o.animatedImage!==void 0&&o.animatedImage.hash!==void 0?(a.setImage(this.decodeImage(o.animatedImage,t,0)),o.animationFrame!==void 0&&o.animationFrame!=0&&(s=!0)):o.video!==void 0&&o.video.hash!==void 0?(a.setVideo(this.decodeVideo(o.video)),o.image!==void 0&&o.image.hash!==void 0&&a.setImage(this.decodeImage(o.image,t,1))):o.image!==void 0&&o.image.hash!==void 0&&a.setImage(this.decodeImage(o.image,t,1)),!s&&o.imageThumbnail!==void 0&&o.imageThumbnail.hash!==void 0&&a.setImageThumbnail(this.decodeImage(o.imageThumbnail,t,1))}a.opacity()!=0&&a.opacity()<1/250&&a.setOpacity(1/250),n.push(a)}let r=n;return Ze.asPaintList(r)}decodePath(e,t){let n=Ht.IntMap_get(this._paths,e,null);return n==null&&(e<0||e>=t.length?(console.warn(`ignoring invalid path index ${e} for blob count ${t.length}`),n=new Et(new gr)):n=new Et(new gr(new Uint8Array(t[e].bytes))),this._paths.set(e,n)),n}decodeGeometry(e,t){let n=[],r=null;for(let o of e){let a="ODD";if(o.commandsBlob===void 0){console.warn("ignoring path with missing required field: 'commandsBlob'");continue}o.windingRule!==void 0&&(a=o.windingRule);let s=this.decodePath(o.commandsBlob,t);n.push(new Wn(a,0,s,s.bounds())),o.styleID!==void 0&&(r==null&&(r=[]),r.push(o.styleID))}_t.INSTANCE.reset();for(let o of n)_t.INSTANCE.include3(o.bounds());return new Vn(n,r,_t.INSTANCE.build(),null)}decodeTextData(e,t){let n=e.styleOverrideTable!==void 0?this.decodeStyleOverrideTable(e.styleOverrideTable,t):new zn,r=e.hyperlinkBoxes!==void 0?e.hyperlinkBoxes:[],o=null,a=n.styleByID2();for(let s of Array.from(a.keys())){let l=a.get(s),d=pn.get(l,3,null);if(d!=null){if(o==null)o=d;else if(d!==o){o="mixed";break}}}return new Pi(n,o,r,e.characters!==void 0?e.characters:"",e.lines!==void 0?e.lines:[],e.characterStyleIDs!==void 0?e.characterStyleIDs:[],[],[])}decodeDerivedTextData(e,t){let n=e.hyperlinkBoxes!==void 0?e.hyperlinkBoxes:[];return new Da(n,[],[])}decodeVectorData(e,t){let n=e.styleOverrideTable!==void 0?this.decodeStyleOverrideTable(e.styleOverrideTable,t):new zn;return new Rp(n)}decodeSymbolData(e,t){return e.symbolID===void 0?(console.warn("ignoring symbol data with missing required field: 'symbolID'"),null):new ia(Ee.decodeGUID(e.symbolID),e.symbolOverrides!==void 0?this.decodeOverrides(e.symbolOverrides,t):Vo._new())}decodeOverrides(e,t){let n=Vo._new();for(let r of e)if(r.guidPath!==void 0){let o=Ee.decodeGUIDPath(r.guidPath),a=pn._new();this.decodeNodeChange(r,t,(s,l)=>{pn.set(a,s,l)}),Vo.map(n).set(o,a)}return n}decodeStyleOverrideTable(e,t){let n=new Map;for(let r of e)r.styleID!==void 0&&this.decodeNodeChange(r,t,(o,a)=>{n.has(r.styleID)||n.set(r.styleID,pn._new()),pn.set(n.get(r.styleID),o,a)});return new zn(n)}decodeNodeChange(e,t,n){e.type!==void 0&&n(19,e.type),e.backgroundColor!==void 0&&n(64,Ee.decodeColor(e.backgroundColor)),e.backgroundEnabled!==void 0&&n(9,e.backgroundEnabled),e.backgroundOpacity!==void 0&&n(38,e.backgroundOpacity),e.blendMode!==void 0&&n(22,e.blendMode),e.connectionType!==void 0&&n(26,e.connectionType),e.connectionURL!==void 0&&n(70,e.connectionURL),e.containerSupportsFillStrokeAndCorners!==void 0&&n(79,e.containerSupportsFillStrokeAndCorners),e.cornerRadius!==void 0&&n(44,e.cornerRadius),e.rectangleTopLeftCornerRadius!==void 0&&n(39,e.rectangleTopLeftCornerRadius),e.rectangleTopRightCornerRadius!==void 0&&n(40,e.rectangleTopRightCornerRadius),e.rectangleBottomLeftCornerRadius!==void 0&&n(41,e.rectangleBottomLeftCornerRadius),e.rectangleBottomRightCornerRadius!==void 0&&n(42,e.rectangleBottomRightCornerRadius),e.rectangleCornerRadiiIndependent!==void 0&&n(15,e.rectangleCornerRadiiIndependent),e.cornerSmoothing!==void 0&&n(45,e.cornerSmoothing),e.easingType!==void 0&&n(28,e.easingType),e.effects!==void 0&&n(61,Ee.decodeEffects(e.effects)),e.arcData!==void 0&&n(63,e.arcData),e.shapeWithTextType!==void 0&&n(85,e.shapeWithTextType),e.fillGeometry!==void 0&&n(73,this.decodeGeometry(e.fillGeometry,t)),e.fillPaints!==void 0&&n(59,this.decodePaints(e.fillPaints,t)),e.frameMaskDisabled!==void 0&&n(13,e.frameMaskDisabled),e.interactionType!==void 0&&n(29,e.interactionType),e.internalOnly!==void 0&&n(12,e.internalOnly),e.isStateGroup!==void 0&&n(81,e.isStateGroup),e.mask!==void 0&&n(10,e.mask),e.maskIsOutline!==void 0&&n(11,e.maskIsOutline),e.name!==void 0&&n(62,e.name),e.navigationType!==void 0&&n(30,e.navigationType),e.opacity!==void 0&&n(37,un.Math_clamp1(e.opacity,0,1)),e.overlayBackgroundInteraction!==void 0&&n(32,e.overlayBackgroundInteraction),e.overlayBackgroundAppearance!==void 0&&n(67,Ee.decodeOverlayBackgroundAppearance(e.overlayBackgroundAppearance)),e.overlayPositionType!==void 0&&n(31,e.overlayPositionType),e.overlayRelativePosition!==void 0&&n(57,Ee.decodeVector(e.overlayRelativePosition)),e.overriddenSymbolID!==void 0&&n(51,Ee.decodeGUID(e.overriddenSymbolID)),e.overrideKey!==void 0&&n(50,Ee.decodeGUID(e.overrideKey)),e.parentIndex!==void 0&&n(25,Ee.decodeParentIndex(e.parentIndex)),e.prototypeBackgroundColor!==void 0&&n(65,Ee.decodeColor(e.prototypeBackgroundColor)),e.prototypeDevice!==void 0&&n(66,Ee.decodePrototypeDevice(e.prototypeDevice)),e.prototypeStartNodeID!==void 0&&n(69,Ee.decodeGUID(e.prototypeStartNodeID)),e.prototypeStartingPoint!==void 0&&n(84,Ee.decodePrototypeStartingPoint(e.prototypeStartingPoint)),e.resizeToFit!==void 0&&n(14,e.resizeToFit),e.scrollDirection!==void 0&&n(34,e.scrollDirection),e.size!==void 0&&n(49,Ee.decodeVector(e.size)),e.strokeAlign!==void 0&&n(23,e.strokeAlign),e.strokeGeometry!==void 0&&n(74,this.decodeGeometry(e.strokeGeometry,t)),e.strokePaints!==void 0&&n(60,this.decodePaints(e.strokePaints,t)),e.symbolData!==void 0&&n(75,this.decodeSymbolData(e.symbolData,t)),e.videoPlayback!==void 0&&n(72,Ee.decodeVideoPlayback(e.videoPlayback)),e.stackReverseZIndex!==void 0&&n(78,e.stackReverseZIndex),e.textData!==void 0&&n(4,this.decodeTextData(e.textData,t)),e.derivedTextData!==void 0&&n(5,this.decodeDerivedTextData(e.derivedTextData,t)),e.vectorData!==void 0&&n(76,this.decodeVectorData(e.vectorData,t)),e.transform!==void 0&&n(24,Ee.decodeMatrix(e.transform)),e.transitionNodeID!==void 0&&n(71,Ee.decodeGUID(e.transitionNodeID)),e.transitionType!==void 0&&n(27,e.transitionType),e.transitionShouldSmartAnimate!==void 0&&n(18,e.transitionShouldSmartAnimate),e.transitionDuration!==void 0&&n(46,e.transitionDuration),e.transitionTimeout!==void 0&&n(47,e.transitionTimeout),e.interactionMaintained!==void 0&&n(16,e.interactionMaintained),e.interactionDuration!==void 0&&n(48,e.interactionDuration),e.transitionPreserveScroll!==void 0&&n(17,e.transitionPreserveScroll),e.visible!==void 0&&n(8,e.visible),e.styleType!==void 0&&n(33,e.styleType),e.inheritFillStyleID!==void 0&&n(52,Ee.decodeGUID(e.inheritFillStyleID)),e.inheritFillStyleIDForStroke!==void 0&&n(53,Ee.decodeGUID(e.inheritFillStyleIDForStroke)),e.inheritEffectStyleID!==void 0&&n(56,Ee.decodeGUID(e.inheritEffectStyleID)),e.inheritTextStyleID!==void 0&&n(55,Ee.decodeGUID(e.inheritTextStyleID)),e.styleIdForFill!==void 0&&n(92,Ee.decodeStyleId(e.styleIdForFill)),e.styleIdForStrokeFill!==void 0&&n(93,Ee.decodeStyleId(e.styleIdForStrokeFill)),e.styleIdForEffect!==void 0&&n(95,Ee.decodeStyleId(e.styleIdForEffect)),e.styleIdForText!==void 0&&n(94,Ee.decodeStyleId(e.styleIdForText)),e.horizontalConstraint!==void 0&&n(20,e.horizontalConstraint),e.verticalConstraint!==void 0&&n(21,e.verticalConstraint),e.scrollBehavior!==void 0&&n(35,e.scrollBehavior),e.keyTrigger!==void 0&&n(80,e.keyTrigger),e.prototypeInteractions!==void 0&&n(82,Ee.decodePrototypeInteractions(e.prototypeInteractions)),e.fontSize!==void 0&&n(3,e.fontSize),e.textAlignHorizontal!==void 0&&n(1,e.textAlignHorizontal),e.textAlignVertical!==void 0&&n(2,e.textAlignVertical),e.strokeWeight!==void 0&&n(43,e.strokeWeight),e.hyperlink!==void 0&&n(6,e.hyperlink),e.mention!==void 0&&n(7,e.mention),e.interactiveSlideConfigData!==void 0&&n(86,e.interactiveSlideConfigData),e.interactiveSlideParticipantData!==void 0&&n(87,e.interactiveSlideParticipantData),e.slideSpeakerNotes!==void 0&&n(97,e.slideSpeakerNotes),e.transitionType!==void 0&&e.transitionType=="MAGIC_MOVE"&&n(27,"SMART_ANIMATE")}decompressZlibOrZstd(e){let t=new ro;try{let n=yi.inflateRaw(e);t.resolve(n)}catch{let n=new Hu;n.init().then(o=>{t.resolve(n.decode(e))},o=>{t.resolve(null)})}return t}async decodeSceneForViewerAndPrototypeLib1(e,t){return this.decodeSceneForViewerAndPrototypeLib2(e,t,null)}_isProbablyZipFile(e){return e[0]=="P".charCodeAt(0)&&e[1]=="K".charCodeAt(0)}async decodeSceneForViewerAndPrototypeLib2(e,t,n){if(this._isProbablyZipFile(e)){let d=(await new nl(new Zs(e)).getEntries()).find(c=>c.filename==="canvas.fig");if(!(d!=null&&d.getData))throw new Error("Cannot find canvas.fig in zip file");e=await d.getData(new $s)}let r=new ro,o=e.length,a=Ee.FILE_HEADER.length;if(Ee.hasFileHeader(e)&&a+4<=o){let s=Ee.readInt32(e,a);if(a=a+4,s>=1&&a+4<=o){let l=Ee.readInt32(e,a);a=a+4,a+l+4<=o?this.decompressZlibOrZstd(e.subarray(a,a+l)).then1(d=>{let c=ih.compileSchema(ih.decodeBinarySchema(d));a=a+l;let p=Ee.readInt32(e,a);if(a=a+4,a+p<=o){let u=e.subarray(a,a+p);a=a+p;let h=!1;for(;a<o;){a+4>e.length&&r.resolve(null);let f=Ee.readInt32(e,a);if(a=a+4,f==0)continue;a+Ee.CHUNK_TAG_LEN>o&&r.resolve(null);let y=e.subarray(a,a+Ee.CHUNK_TAG_LEN);a=a+Ee.CHUNK_TAG_LEN;let g=f-Ee.CHUNK_TAG_LEN;switch(a+g>o&&r.resolve(null),a=a+g,Ee.parseChunkType(y)){case Ee.ChunkType.THUMBNAIL:{h&&r.resolve(null),h=!0;break}case Ee.ChunkType.UNKNOWN:break}}this.decompressZlibOrZstd(new Uint8Array(u)).then1(f=>{let y=c.decodeMessage(f);if(y.type!==void 0&&y.type=="NODE_CHANGES"){let g=gt.createScene(gt.MAGIC_SESSION_ID_FOR_NON_MULTIPLAYER,t);n!=null&&g.setFileKey(n),g.applyMessageToScene(f),r.resolve(g)}else r.resolve(null)})}else r.resolve(null)}):r.resolve(null)}else r.resolve(null)}else r.resolve(null);return r.realPromise()}};Ee.VERBOSE=!1,Ee.FILE_HEADER=[102,105,103,45,107,105,119,105],Ee.CHUNK_TAG_LEN=8,Ee.THUMBNAIL_CHUNK_TAG=[137,80,78,71,13,10,26,10];var mt=Ee;(n=>{let i;(a=>(a[a.THUMBNAIL=0]="THUMBNAIL",a[a.UNKNOWN=1]="UNKNOWN"))(i=n.ChunkType||(n.ChunkType={}));class e{constructor(o){this.timeSpentApplyingMessageToSceneMs=o}}n.TimingInfo=e;let t;(o=>{function r(a){return n.ChunkType[a]}o.ChunkType_toString=r})(t=n.in_ChunkType||(n.in_ChunkType={}))})(mt||(mt={}));var Zr;(r=>{function i(o,a){return o==a?!0:o==26?a==71||a==70:!1}r.affects=i;function e(o){return o==59||o==60||o==52||o==53||o==92||o==93||o==4||o==5}r.affectsImagesUsedByNode=e;function t(o){switch(o){case 98:case 25:case 8:case 26:case 70:case 48:case 16:case 29:case 34:case 65:case 66:case 82:case 69:case 84:case 35:case 46:case 71:case 17:case 47:case 27:case 30:case 31:case 57:case 32:case 67:return!0}return!1}r.isPrototypeStructuralChange=t;function n(o){switch(o){case 29:case 16:case 48:case 80:case 83:case 71:case 27:case 46:case 28:case 47:case 18:case 26:case 70:case 57:case 30:case 17:case 4:case 5:return!0}return!1}r.isInteractionProperty=n})(Zr||(Zr={}));var Sd=(q=>(q[q.BOOL=0]="BOOL",q[q.DOUBLE=1]="DOUBLE",q[q.INT=2]="INT",q[q.STRING=3]="STRING",q[q.STRING_ENUM=4]="STRING_ENUM",q[q.AFFINE_TRANSFORM=5]="AFFINE_TRANSFORM",q[q.ARC_DATA=6]="ARC_DATA",q[q.GUID=7]="GUID",q[q.STYLE_ID=8]="STYLE_ID",q[q.OVERLAY_BACKGROUND_APPEARANCE=9]="OVERLAY_BACKGROUND_APPEARANCE",q[q.VECTOR=10]="VECTOR",q[q.EFFECT_LIST=11]="EFFECT_LIST",q[q.PAINT_LIST=12]="PAINT_LIST",q[q.PROTOTYPE_INTERACTION_LIST=13]="PROTOTYPE_INTERACTION_LIST",q[q.GEOMETRY=14]="GEOMETRY",q[q.PARENT_INDEX=15]="PARENT_INDEX",q[q.PROTOTYPE_DEVICE=16]="PROTOTYPE_DEVICE",q[q.PROTOTYPE_STARTING_POINT=17]="PROTOTYPE_STARTING_POINT",q[q.VIDEO_PLAYBACK=18]="VIDEO_PLAYBACK",q[q.KEY_TRIGGER=19]="KEY_TRIGGER",q[q.SYMBOL_DATA=20]="SYMBOL_DATA",q[q.TEXT_DATA=21]="TEXT_DATA",q[q.DERIVED_TEXT_DATA=22]="DERIVED_TEXT_DATA",q[q.VECTOR_DATA=23]="VECTOR_DATA",q[q.HYPERLINK=24]="HYPERLINK",q[q.MENTION=25]="MENTION",q[q.STRING_STRING_MULTIPLAYER_MAP=26]="STRING_STRING_MULTIPLAYER_MAP",q[q.OTHER__=27]="OTHER__",q[q.END__=28]="END__",q))(Sd||{}),iT;(e=>{function i(t){return Sd[t]}e.BindingType_toString=i})(iT||(iT={}));function yd(i){switch(i){case 79:case 91:case 12:case 9:case 13:case 10:case 11:case 14:case 81:case 8:case 16:case 15:case 17:case 18:case 89:case 78:return 0;case 38:case 44:case 45:case 3:case 48:case 37:case 39:case 40:case 41:case 42:case 43:case 46:case 47:return 1;case 64:case 65:return 2;case 70:case 62:case 83:case 97:return 3;case 22:case 26:case 20:case 21:case 28:case 29:case 30:case 32:case 34:case 31:case 98:case 35:case 85:case 77:case 23:case 33:case 1:case 2:case 27:case 19:return 4;case 24:return 5;case 63:return 6;case 50:case 51:case 69:case 52:case 53:case 54:case 56:case 55:case 71:return 7;case 92:case 93:case 94:case 95:case 96:return 8;case 67:return 9;case 90:case 57:case 88:case 49:return 10;case 61:return 11;case 58:case 59:case 60:return 12;case 82:return 13;case 73:case 74:return 14;case 25:return 15;case 66:return 16;case 84:return 17;case 80:return 19;case 75:return 20;case 4:return 21;case 5:return 22;case 76:return 23;case 72:return 18;case 6:return 24;case 7:return 25;case 86:case 87:return 26;case 68:case 36:return 27;default:return 28}}function aT(i,e){switch(e){case 22:return ye.schema.BlendMode[i];case 26:return ye.schema.ConnectionType[i];case 20:return ye.schema.ConstraintType[i];case 21:return ye.schema.ConstraintType[i];case 28:return ye.schema.EasingType[i];case 29:return ye.schema.InteractionType[i];case 30:return ye.schema.NavigationType[i];case 32:return ye.schema.OverlayBackgroundInteraction[i];case 34:return ye.schema.ScrollDirection[i];case 31:return ye.schema.OverlayPositionType[i];case 98:return ye.schema.NodePhase[i];case 35:return ye.schema.ScrollBehavior[i];case 85:return ye.schema.ShapeWithTextType[i];case 77:return ye.schema.StackMode[i];case 23:return ye.schema.StrokeAlign[i];case 33:return ye.schema.StyleType[i];case 1:return ye.schema.TextAlignHorizontal[i];case 2:return ye.schema.TextAlignVertical[i];case 27:return ye.schema.TransitionType[i];case 19:return ye.schema.NodeType[i];default:throw new Error(`Given field ${Ct[e]} is not a string enum field`)}}function wp(i,e,t){switch(yd(t)){case 0:return i.getBool(e,t);case 1:return i.getDouble(e,t);case 2:return i.getInt(e,t);case 3:return i.getString(e,t);case 4:return aT(i.getInt(e,t),t);case 5:return i.getAffineTransform(e,t);case 6:return i.getArcData(e,t);case 7:return i.getGUID(e,t);case 8:return i.getStyleId(e,t);case 10:return i.getVector(e,t);case 11:return i.getEffectList(e);case 12:return i.getPaintList(e,t);case 15:return i.getParentIndex(e);case 13:case 9:case 19:case 17:case 16:case 18:case 24:case 25:case 26:return i.getField(e,t);case 20:case 23:return null;case 14:case 21:case 22:case 27:return null;default:return Ve(`Unhandled node field ${Ct[t]} in getCppNodeValue`),null}}function Db(i,e,t,n,r){switch(yd(n)){case 0:return i.getBool_SGEO(r);case 1:return i.getDouble_SGEO(r);case 2:return i.getInt_SGEO(r,n);case 3:return i.getString_SGEO(r);case 4:return aT(i.getInt_SGEO(r,n),n);case 5:return i.getAffineTransform_SGEO(r);case 6:return i.getArcData_SGEO(r);case 7:return i.getGUID_SGEO(r);case 8:return i.getStyleId_SGEO(r);case 10:return i.getVector_SGEO(r);case 11:return i.getEffectList_SGEO(r);case 12:return i.getPaintList_SGEO(r);case 15:return i.getParentIndex_SGEO(r);case 13:return i.getPrototypeInteractions_SGEO(r);case 9:case 19:case 17:case 16:case 18:case 24:case 25:case 26:return i.getField_SGEO(r);case 20:case 23:return null;case 14:case 21:case 22:case 27:return null;default:return Ve(`Unhandled node field ${Ct[n]} in getCppSGEOValue`),null}}function vr(i,e,t,n){let r=mt.serializeValueToKiwiForTests1(t,n),o=r.a,a=r.b;o.guid=mt.encodeGUID(e.id()),ah(o,a)}var Fe=class Fe extends _u{constructor(t,n,r){super();this._scene=null,this._id=null,this._scrollingLogic=null,this._handle=0,this._cachedType=null,this._absoluteTransform=vt.FrozenAffineTransform_IDENTITY,this._flags=5,this._cachedChildren=[],this._cachedParent=null,this._isPartOfLoop=!1,this.transitioningFrom=null,this._lastParent=null,this._lazyInteractionsMigrationValue=null,this._cachedCanvasSpaceGeometryBounds=Kn.FrozenRect_EMPTY,this._cachedCanvasSpaceRenderedBounds=Kn.FrozenRect_EMPTY,this._cachedCanvasSpaceScrollingBounds=Kn.FrozenRect_EMPTY,this._renderTree=null,this._renderTreeAsBaseScreen=null,this._renderTreeWithoutBackgroundBlurs=null,this._renderTreeForShadowRoot=null,this._renderTreeForShadowDescendant=null,this._renderTreeForKnockoutShadowRoot=null,this._renderTreeForKnockoutShadowDescendant=null,this._overlayCacheKey=null,this._scene=n,this._id=r,this._scrollingLogic=new Xu(this),this._handle=t}handle(){return this._handle}updateAfterPropertyChange(t){t==25?(this.updateDirtyFlagsForPropertyChange(t,this._lastParent),this._lastParent=this.parent()):this.updateDirtyFlagsForPropertyChange(t,null),t==19&&(this._cachedType=null)}linkToParent(t,n){t!=null&&(this._cachedParent=t,this._addFlagsToSelfAndChildren(1),t._cachedChildren.splice(n,0,this),this.updateIsRooted())}unlinkFromParent(){this._cachedParent!=null&&(ue.List_removeOne(this._cachedParent._cachedChildren,this),this._cachedParent=null,this.updateIsRooted())}hasOverflowingContentInScrollDirection(){return this._scrollingLogic.hasOverflowingContentInScrollDirection()}scrollsInPreferredDirection(t){return this._scrollingLogic.scrollsInPreferredDirection(t)}scrollAndClipBoundsBySelfAndAncestors(t,n){return this._scrollingLogic.scrollAndClipBoundsBySelfAndAncestors(t,n)}canvasSpaceScrolledBounds(t){return this._scrollingLogic.canvasSpaceScrolledBounds(t)}canvasSpaceScrolledInteractiveBounds(t){return this._scrollingLogic.canvasSpaceScrolledInteractiveBounds(t)}scrollDirection(){return this._scrollingLogic.scrollDirection()}scrollDirectionWithScrollableContent(){return this._scrollingLogic.scrollDirectionWithScrollableContent()}isFixed(){return this._scrollingLogic.isFixed()}isStandardScrolling(){return this._scrollingLogic.isStandardScrolling()}isStickyScrolling(){return this._scrollingLogic.isStickyScrolling()}defaultScrollOffset(){return this._scrollingLogic.defaultScrollOffset()}canvasSpaceContentBounds(){return this._scrollingLogic.canvasSpaceContentBounds()}nodeSpaceScrollableContentBounds(){return this._scrollingLogic.nodeSpaceScrollableContentBounds()}minScrollOffsetX(){return this._scrollingLogic.minScrollOffsetX()}minScrollOffsetY(){return this._scrollingLogic.minScrollOffsetY()}maxScrollOffsetX(){return this._scrollingLogic.maxScrollOffsetX()}maxScrollOffsetY(){return this._scrollingLogic.maxScrollOffsetY()}hasOverflowingContentInXDirection(){return this._scrollingLogic.hasOverflowingContentInXDirection()}hasOverflowingContentInYDirection(){return this._scrollingLogic.hasOverflowingContentInYDirection()}isSpreadEligibleNode(){return Jt.isFrameLike(this.type())?this.isFrameBackgroundVisible()&&this.clipsToBoundingRectangle():Jt.isRectOrEllipseLike(this.type())}id(){return this._id}isRooted(){return(2&this._flags)!=0}parent(){return this._cachedParent}scene(){return this._scene}isInvisibleOrTransparent(){return!this.visible()||this.opacity()<=0}fillPaintsToRender(){return this.containerSupportsFillStrokeAndCorners()?this.fillPaints():this.hasNodeProperty(38)&&this.hasNodeProperty(64)?[ie.createSolid(this.computedBackgroundColor(),1)]:Ne.EMPTY}computedBackgroundColor(){return this.isBackgroundEnabled()?E.multiplyOpacity(this.backgroundColor(),this.backgroundOpacity()):E.TRANSPARENT}isInsideOutlineMask(){return this.isMask()&&(this.isMaskOutline_DEPRECATED()||this.maskType()=="OUTLINE")||(this.parent()!=null?this.parent().isInsideOutlineMask():!1)}isOrInSymbol(){return this.type()=="SYMBOL"?!0:this.parent()!=null?this.parent().isOrInSymbol():!1}isStack(){return D().prepareCppNodeForAccess(this),D().nodeTsApi().getIsStack(2)}isInstanceSublayer(){return this.stablePath().guids.length>1}isPrimaryInstance(){return this.stablePath().guids.length==1&&this.isInstance()}isState(){return this.type()=="SYMBOL"&&this.parent()!=null&&this.parent().isStateGroup()}isInstance(){return this.type()=="INSTANCE"}isOrInInstance(){return this.isInstanceSublayer()||this.isPrimaryInstance()}isSymbol(){return this.type()=="SYMBOL"}findContainingPrimaryInstance(){return this.isOrInInstance()?this.scene().findNode1(this.stablePath().guids[0]):null}findNearestAncestorSectionOrNull(){let t=this;for(;t!=null&&t.type()!="CANVAS"&&t.type()!="DOCUMENT";){if(t.type()=="SECTION")return t;t=t.parent()}return null}findContainingCanvasOrSelf(){let t=this;for(;t!=null;){if(t.type()=="CANVAS")return t;if(t.parent()==null)break;t=t.parent()}return null}constrainsAnchoredChildren(){return Jt.isFrameLike(this.type())&&!this.isResizeToFit()}size(){return this._scrollingLogic.nodeSize()}prototypeDevice(){return Y.deviceFramesSupported()?this.storedPrototypeDevice():Tr.DEFAULT}findContainingCanvasOrParent(){let t=this.parent();for(;t!=null&&t.type()!="CANVAS"&&t.parent()!=null;)t=t.parent();return t}guidPath(){return D().getOverridePath(this)}stablePath(){return D().getStablePath(this)}removeSelfAndSubtree(){D().prepareCppNodeForAccess(this),D().nodeTsApi().removeSelfAndChildren(2)}type(){if(this._cachedType==null||this._cachedType=="NONE"){D().prepareCppNodeForAccess(this);let t=D().nodeTsApiGenerated().getType(2);this._cachedType=Fe.schema.NodeType[t]}return this._cachedType}setType(t){D().prepareCppNodeForAccess(this);let n=Fe.schema.NodeType[t];D().nodeTsApiGenerated().setType(n,2)}name(){return D().prepareCppNodeForAccess(this),D().nodeTsApi().getName(2)}setName(t){D().prepareCppNodeForAccess(this);let n=D().nodeTsApi().setName(t,2);n!=""&&Ve(n)}scrollOffset(){D().prepareCppNodeForAccess(this);let t=D().nodeTsApi().getScrollOffset(2);return new I(t.x,t.y)}setScrollOffset(t){D().prepareCppNodeForAccess(this);let n=D().nodeTsApi().setScrollOffset({x:t.x(),y:t.y()},2);n!=""&&Ve(n)}currentViewportSize(){D().prepareCppNodeForAccess(this);let t=D().nodeTsApi().getCurrentViewportSize(2);return new I(t.x,t.y)}setCurrentViewportSize(t){D().prepareCppNodeForAccess(this);let n=D().nodeTsApi().setCurrentViewportSize({x:t.x(),y:t.y()},2);n!=""&&Ve(n)}fullSize(){D().prepareCppNodeForAccess(this);let t=D().nodeTsApi().getSize(2);return new I(t.x,t.y)}setSize(t){D().prepareCppNodeForAccess(this);let n=D().nodeTsApi().setSize(t.x(),t.y(),2);n!=""&&Ve(n)}relativeTransform(){D().prepareCppNodeForAccess(this);let t=D().nodeTsApi().getRelativeTransform(2);return new ne(t.m00,t.m01,t.m02,t.m10,t.m11,t.m12)}setRelativeTransform(t){this.setRelativeTransform1(t)}setRelativeTransform1(t){D().prepareCppNodeForAccess(this);let n=D().nodeTsApi().setRelativeTransform(t.m00(),t.m01(),t.m02(),t.m10(),t.m11(),t.m12(),2);n!=""&&Ve(n)}interactiveSlideConfigData(){return D().prepareCppNodeForAccess(this),D().nodeTsApi().getInteractiveSlideConfigData(2)}setInteractiveSlideConfigData(t,n){return D().prepareCppNodeForAccess(this),D().nodeTsApi().setInteractiveSlideConfigData(t,n,2)}interactiveSlideParticipantData(){return D().prepareCppNodeForAccess(this),D().nodeTsApi().getInteractiveSlideParticipantData(2)}setInteractiveSlideParticipantData(t,n){return D().prepareCppNodeForAccess(this),D().nodeTsApi().setInteractiveSlideParticipantData(t,n,2)}slideSpeakerNotes(){return D().prepareCppNodeForAccess(this),D().nodeTsApi().getSlideSpeakerNotes(2)}stackMode(){D().prepareCppNodeForAccess(this);let t=D().nodeTsApi().getStackMode(2);return Fe.schema.StackMode[t]}setStackMode(t){D().prepareCppNodeForAccess(this);let n=Fe.schema.StackMode[t];D().nodeTsApi().setStackMode(n,2)}arcData(){return D().prepareCppNodeForAccess(this),D().nodeTsApi().getArcData(2)}setArcData(t){D().prepareCppNodeForAccess(this);let n=D().nodeTsApi().setArcData(t.startingAngle,t.endingAngle,t.innerRadius,2);n!=""&&Ve(n)}backgroundColor(){D().prepareCppNodeForAccess(this);let t=D().nodeTsApi().getBackgroundColor(2);return E.new3(t.red,t.green,t.blue,t.alpha)}setBackgroundColor(t){D().prepareCppNodeForAccess(this);let n=D().nodeTsApi().setBackgroundColor(E.toColorF(t),2);n!=""&&Ve(n)}prototypeBackgroundColor(){D().prepareCppNodeForAccess(this);let t=D().nodeTsApi().getPrototypeBackgroundColor(2);return E.fromColorF(t)}setPrototypeBackgroundColor(t){D().prepareCppNodeForAccess(this);let n={red:E.redF(t),green:E.greenF(t),blue:E.blueF(t),alpha:E.alphaF(t)},r=D().nodeTsApi().setPrototypeBackgroundColor(n,2);r!=""&&Ve(r)}parentIndex(){D().prepareCppNodeForAccess(this);let t=D().nodeTsApi().getParentIndex(2),n=t.parent;return new Gn(n,t.position)}setParentIndex(t){D().prepareCppNodeForAccess(this);let n={parent:t.id,position:t.position},r=D().nodeTsApi().setParentIndex(n,2);r!=""&&Ve(r)}fillPaints(){D().prepareCppNodeForAccess(this);let t=D().nodeTsApi().getFillPaints(2);return Vr.WeakHandle_isValid(t)?D().modules().paintData_Internal.getOrCreateSkewCopy(t):[]}getBoundVariables(){return D().prepareCppNodeForAccess(this),D().nodeTsApi().getBoundVariables(2)}getResolvedVariableModes(){return D().prepareCppNodeForAccess(this),D().nodeTsApi().getResolvedVariableModes(2)}getExplicitVariableModes(){return D().prepareCppNodeForAccess(this),D().nodeTsApi().getExplicitVariableModes(2)}setExplicitVariableModeForCollection(t,n){return D().prepareCppNodeForAccess(this),D().nodeTsApi().setExplicitVariableModeForCollection(t,n,2)}clearExplicitVariableConsumerModeForCollection(t){return D().prepareCppNodeForAccess(this),D().nodeTsApi().clearExplicitVariableConsumerModeForCollection(t,2)}setTestOnlyFillPaints(t){$n("Paint serialization only partially implemented in Skew"),vr(D(),this,59,t)}setTestOnlyFillPaints1(t){$n("Paint serialization only partially implemented in Skew"),vr(D(),this,59,t)}setTestOnlyFillPaints2(t){$n("Paint serialization only partially implemented in Skew"),vr(D(),this,59,t)}setTestOnlyFillPaints3(t){$n("Paint serialization only partially implemented in Skew"),vr(D(),this,59,t)}strokePaints(){D().prepareCppNodeForAccess(this);let t=D().nodeTsApi().getStrokePaints(2);return Vr.WeakHandle_isValid(t)?D().modules().paintData_Internal.getOrCreateSkewCopy(t):[]}setTestOnlyStrokePaints(t){$n("Paint serialization only partially implemented in Skew"),vr(D(),this,60,t)}setTestOnlyStrokePaints1(t){$n("Paint serialization only partially implemented in Skew"),vr(D(),this,60,t)}setTestOnlyStrokePaints2(t){$n("Paint serialization only partially implemented in Skew"),vr(D(),this,60,t)}setTestOnlyStrokePaints3(t){$n("Paint serialization only partially implemented in Skew"),vr(D(),this,60,t)}effects(){D().prepareCppNodeForAccess(this);let t=D().nodeTsApi().getEffects(2);return Vr.WeakHandle_isValid(t)?D().modules().effectData_Internal.getOrCreateSkewCopy(t):null}setTestOnlyEffects(t){$n("Effect serialization only partially implemented in Skew"),vr(D(),this,61,t)}setTestOnlyEffects1(t){$n("Effect serialization only partially implemented in Skew"),vr(D(),this,61,t)}setTestOnlyEffects2(t){$n("Effect serialization only partially implemented in Skew"),vr(D(),this,61,t)}symbolID(){return this.isInstance()?(D().prepareCppNodeForAccess(this),D().nodeTsApi().getSymbolId(2)):ee.invalid()}setTestOnlySymbolData(t){$n("SymbolData serialization only partially implemented in Skew"),vr(D(),this,75,t)}fillGeometry(){if(2==0&&Jt.isFrameLike(this.type())&&this.containerSupportsFillStrokeAndCorners())return Jo(this.canvasSpaceBoundingBox());D().prepareCppNodeForAccess(this);let t=D().nodeTsApi().getFillGeometryRegions(2);return D().idlRegionsToGeometry(t,null)}setTestOnlyFillGeometry(t){$n("Geometry serialization only partially implemented in Skew"),vr(D(),this,73,t)}strokeGeometry(){D().prepareCppNodeForAccess(this);let t=D().nodeTsApi().getStrokeGeometryRegions(2);return D().idlRegionsToGeometry(t,null)}setTestOnlyStrokeGeometry(t){$n("Geometry serialization only partially implemented in Skew"),vr(D(),this,74,t)}textGeometry(){let t=this.textData();if(t==null)return null;D().prepareCppNodeForAccess(this);let n=D().nodeTsApi().getTextGeometryRegions(2),r=new So(t.styleOverrideTable());return D().idlRegionsToTextGeometry(n,r)}prototypeInteractions(){D().prepareCppNodeForAccess(this);let t=D().nodeTsApi().getPrototypeInteractions(2);return Vr.WeakHandle_isValid(t)?D().modules().prototypeInteractions_Internal.getOrCreateSkewCopy(t):[]}setTestOnlyPrototypeInteractions(t){$n("PrototypeInteraction[] serialization only partially implemented in Skew"),vr(D(),this,82,t)}prototypeStartingPoint(){D().prepareCppNodeForAccess(this);let t=D().nodeTsApi().getPrototypeStartingPoint(2);if(t==null)return null;let n=t;return new Di(n.name,n.description,sn.fromString(n.position))}setPrototypeStartingPoint(t){D().prepareCppNodeForAccess(this);let n={name:t.name,description:t.description,position:sn.toString(t.position)},r=D().nodeTsApi().setPrototypeStartingPoint(n,2);r!=""&&Ve(r)}storedPrototypeDevice(){D().prepareCppNodeForAccess(this);let t=D().nodeTsApi().getPrototypeDevice(2);if(t==null)return null;let n=t;return new Tr(Fe.schema.PrototypeDeviceType[n.type],new I(n.size.x,n.size.y),n.presetIdentifier,Fe.schema.DeviceRotation[n.rotation])}setPrototypeDevice(t){D().prepareCppNodeForAccess(this);let n={type:Fe.schema.PrototypeDeviceType[t.type],size:{x:t.size().x(),y:t.size().y()},presetIdentifier:t.presetIdentifier,rotation:Fe.schema.DeviceRotation[t.rotation]};D().nodeTsApi().setPrototypeDevice(n,2)}overlayBackgroundAppearance(){D().prepareCppNodeForAccess(this);let t=D().nodeTsApi().getOverlayBackgroundAppearance(2);if(t==null)return null;let n=t;return new ni(Fe.schema.OverlayBackgroundType[n.backgroundType],E.fromColorF(n.backgroundColor))}setOverlayBackgroundAppearance(t){D().prepareCppNodeForAccess(this);let n={backgroundType:Fe.schema.OverlayBackgroundType[t.backgroundType],backgroundColor:E.toColorF(t.backgroundColor)},r=D().nodeTsApi().setOverlayBackgroundAppearance(n,2);r!=""&&Ve(r)}textData(){D().prepareCppNodeForAccess(this);let t=D().nodeTsApi().getTextData(2);return Vr.WeakHandle_isValid(t)?D().modules().textData_Internal.getOrCreateSkewCopy(t):null}setTestOnlyTextData(t){$n("TextData serialization only partially implemented in Skew"),vr(D(),this,4,t)}derivedTextData(){D().prepareCppNodeForAccess(this);let t=D().nodeTsApi().getDerivedTextData(2);return Vr.WeakHandle_isValid(t)?D().modules().derivedTextData_Internal.getOrCreateSkewCopy(t):null}setTestOnlyDerivedTextData(t){$n("DerivedTextData serialization only partially implemented in Skew"),vr(D(),this,5,t)}vectorData(){D().prepareCppNodeForAccess(this);let t=D().nodeTsApi().getVectorData(2);return Vr.WeakHandle_isValid(t)?D().modules().compiledVectorData_Internal.getOrCreateSkewCopy(t):null}videoPlayback(){return D().prepareCppNodeForAccess(this),D().nodeTsApi().getVideoPlayback(2)}setVideoPlayback(t){D().prepareCppNodeForAccess(this),D().nodeTsApi().setVideoPlayback(t,2)}accessibleLabel(){return D().prepareCppNodeForAccess(this),D().nodeTsApi().getAccessibleLabel(2)}hasNodeProperty(t){return D().hasNodeProperty(this,t)}get1(t,n){let r=wp(D(),this,t);return r??n}each(t){D().forEachField(this,n=>{t(n,this.get2(n))})}isVisibleInCanvas(){return D().prepareCppNodeForAccess(this),D().nodeTsApi().isVisibleInCanvas(2)}supportsBackgroundPaints(){return Jt.isFrameLike(this.type())&&!this.containerSupportsFillStrokeAndCorners()}supportsGeometry(){return Jt.isGeometryLeaf(this.type())||Jt.isFrameLike(this.type())&&this.containerSupportsFillStrokeAndCorners()}findPrototypeInteraction(t){if(t==null)return null;let n=this.prototypeInteractions().filter(r=>ee.equals(r.id(),t));return n.length==0?null:(n.length>1&&Ve("Found multiple prototype interactions with the same GUID"),n[0])}get2(t){return this.get1(t,null)}updateDirtyFlagsForPropertyChange(t,n){this._handlePropertyChangeForTransform(t),this._handlePropertyChangeForBounds(t,n),this._handlePropertyChangeForRenderTree(t,n),this._handlePropertyChangeForInteractions(t)}_handlePropertyChangeForTransform(t){if((t==89||t==24||t==66||t==35||t==90)&&this._addFlagsToSelfAndChildren(1),t==20||t==21){let n=this;for(;n!=null&&!(n.isFixed()||n.hasOwnConstraintValues());)n=n.parent();n!=null&&n.isFixed()&&n.dirtyTransform()}}_handlePropertyChangeForInteractions(t){Zr.isInteractionProperty(t)&&(this._lazyInteractionsMigrationValue=null)}map(t){return this._cachedChildren.map(t)}forEachChild(t){this._cachedChildren.forEach(t)}forEachDescendantPreorder(t){this._cachedChildren.forEach(n=>{t(n),n.forEachDescendantPreorder(t)})}childCount(){return this._cachedChildren.length}childAt1(t){return this.childAt2(t,!1)}childAt2(t,n){return n&&this.stackReverseZIndex()&&this.isStack()?this._cachedChildren[this.childCount()-t-1]:this._cachedChildren[t]}indexInParent(){if(this._cachedParent==null)return-1;let t=this._cachedParent._cachedChildren.indexOf(this);return this._cachedParent.stackReverseZIndex()&&this._cachedParent.isStack()&&(t=this._cachedParent.childCount()-t-1),t}updateIsRooted(){let t=this._cachedParent!=null?this._cachedParent.isRooted():this==this._scene.root();if(t!=this.isRooted()){this._flags=t?this._flags|2:this._flags&-3,t&&this._addFlagsToSelfAndChildren(1);for(let n of this._cachedChildren)n.updateIsRooted()}}appendChild(t){let n=this._cachedChildren.length==0?sn.FIRST_POSITION:sn.after(ue.List_last(this._cachedChildren).parentIndex().position);t.setParentIndex(new Gn(this.id(),n))}collectUniqueUsedImages(){let t=new Map;return this.forEachSinglePaint(n=>{(n.type()=="IMAGE"||n.type()=="EMOJI"||n.type()=="VIDEO")&&(n.image()!=null&&t.set(n.image().objectHash(),n.image()),n.imageThumbnail()!=null&&t.set(n.imageThumbnail().objectHash(),n.imageThumbnail()))}),this.forEachEmojiInTextData(n=>{t.set(n.objectHash(),n)}),t}forEachSinglePaint(t){var r,o;let n=a=>{let s=a.asVolatilePaint();s!=null&&(t(s.from()),t(s.to()));let l=a.asSinglePaint();l!=null&&t(l)};this.fillPaints().forEach(n),this.strokePaints().forEach(n),(o=(r=this.textData())==null?void 0:r.styleOverrideTable())==null||o.forEachFillPaint(this.scene(),a=>{a.forEach(n)}),this.hasPerRegionFillPaints()&&this.forEachRegionWithFillPaintBatch((a,s)=>{s.forEach(n)})}forEachEmojiInTextData(t){var n,r,o;this._cachedType=="TEXT"&&(((n=this.derivedTextData())==null?void 0:n.usedEmojiImages())!=null?this.derivedTextData().usedEmojiImages().forEach(a=>{t(a)}):(o=(r=this.textData())==null?void 0:r.usedEmojiImagesDEPRECATED())==null||o.forEach(a=>{t(a)}))}textHyperlinkBoxes(){var t,n;return this._cachedType!="TEXT"?[]:((t=this.derivedTextData())==null?void 0:t.hyperlinkBoxes())!=null?this.derivedTextData().hyperlinkBoxes():((n=this.textData())==null?void 0:n.hyperlinkBoxesDEPRECATED())??[]}textHasMixedFontSizes(){return this._cachedType!="TEXT"||this.textData()==null||this.textData().fontSizes()===null?!1:this.textData().fontSizes()==="mixed"?!0:(D().prepareCppNodeForAccess(this),this.textData().fontSizes()!=D().nodeTsApiGenerated().getFontSize(2))}restartGifs(){this.forEachSinglePaint(t=>{let n=t.image();if(n==null||!n.isGIF())return;let r=n.gif();r!=null&&r.restart()})}clipsToBoundingRectangle(){return Jt.isFrameLike(this.type())&&!this.isFrameMaskDisabled()&&!this.isResizeToFit()}isAxisAligned(){let n=this.absoluteTransform();return Math.abs(n.m00())<1e-4&&Math.abs(n.m11())<1e-4||Math.abs(n.m01())<1e-4&&Math.abs(n.m10())<1e-4}isAxisAlignedRectFill(){return this.fillGeometry()!=null&&this.fillPaints().length!=0&&this.strokePaints().length==0&&this.fillGeometry().isRect()&&this.isAxisAligned()}isInSymbol(){let t=!1;for(let n=this;n!=null;n=n.parent())if(n.type()=="SYMBOL"){t=!0;break}return t}_addScrollableChildFramesToListRecursive(t){for(let n of this._cachedChildren)n.scrollDirection()!="NONE"&&t.push(n),n._addScrollableChildFramesToListRecursive(t)}scrollableFrameDescendants(){let t=[];return this._addScrollableChildFramesToListRecursive(t),t}isGroup(){return Jt.isFrameLike(this.type())&&this.isResizeToFit()}hasOwnConstraintValues(){return this.type()!="BOOLEAN_OPERATION"&&this.type()!="CANVAS"&&this.type()!="DOCUMENT"&&!this.isGroup()}_collectConstraintValuesInSubtree(t){let n=null;return Fe.forEachNode(this,r=>{if(!r.hasOwnConstraintValues())return Fe.Loop.CONTINUE;let o=t(r);if(n==null)n=new _e(o);else if(n.value!=o)return n=null,Fe.Loop.BREAK;return Fe.Loop.SKIP}),n}horizontalConstraintOfSubtree(){return this._collectConstraintValuesInSubtree(t=>t.horizontalConstraint())}verticalConstraintOfSubtree(){return this._collectConstraintValuesInSubtree(t=>t.verticalConstraint())}_withOverriddenFrameRole(t,n){this._scrollingLogic.overrideRole(t),this._addFlagsToSelfAndChildren(1),this._invalidateRenderTreeForSelf();for(let r=0,o=this.childCount();r<o;r=r+1){let a=this.childAt1(r);a.isFixed()&&Fe.forEachNode(a,s=>{s._invalidateRenderTreeForSelf()})}n(),this._scrollingLogic.clearRoleOverride()}actingAsOverlayOrSublayerForRendertreeGeneration(t){this._withOverriddenFrameRole(1,t)}actingAsBaseScreenForRendertreeGeneration(t){this._withOverriddenFrameRole(0,t)}_translateFixedElementIfNecessary(t){if(!this.isFixed()||this.parent()==null||this.parent().scrollDirection()=="NONE")return;let n=this.parent();if(sr.scrollsHorizontally(n.scrollDirection())){let r=this.horizontalConstraintOfSubtree();r!=null&&(r.value=="MAX"?t.translate2(n.size().x()-n.fullSize().x(),0):r.value=="CENTER"&&t.translate2((n.size().x()-n.fullSize().x())/2,0))}if(sr.scrollsVertically(n.scrollDirection())){let r=this.verticalConstraintOfSubtree();r!=null&&(r.value=="MAX"?t.translate2(0,n.size().y()-n.fullSize().y()):r.value=="CENTER"&&t.translate2(0,(n.size().y()-n.fullSize().y())/2))}}hasPerRegionFillPaints(){if(this.type()!="VECTOR"||this.fillGeometry()==null)return!1;let t=this.fillGeometry().styleIDs;return t==null?!1:t.some(n=>n!=0)}forEachRegionWithFillPaintBatch(t){var a;let n=this.fillGeometry(),r=(a=this.vectorData())==null?void 0:a.paintOverrides,o=this.fillPaints();if(!(r==null||n==null))for(let s=0;s<n.regions.length;s=s+1){let l=o;if(s<n.styleIDs.length){let c=n.styleIDs[s],p=r.get(c,this.scene());p!=null&&(l=p)}let d=n.regions[s];t(d,l)}}relativeTransformAccountingForFixedOffset(){let t=this.relativeTransform().clone();return this._translateFixedElementIfNecessary(t),t}absoluteTransform(){if(this.isRooted()&&1&this._flags){let t=this.relativeTransformAccountingForFixedOffset();if(this._cachedParent!=null){let n=this._cachedParent.absoluteTransform().clone();n.multiply(t),t=n}this._absoluteTransform=t,this._flags&=-2}return this._absoluteTransform}dirtyTransform(){this._addFlagsToSelfAndChildren(1),this._addFlagsToSelfAndChildren(4)}copyNodeCachedTransformAndBounds(t){this._absoluteTransform=t._absoluteTransform,this._cachedCanvasSpaceGeometryBounds=t._cachedCanvasSpaceGeometryBounds,this._cachedCanvasSpaceRenderedBounds=t._cachedCanvasSpaceRenderedBounds,this._cachedCanvasSpaceScrollingBounds=t._cachedCanvasSpaceScrollingBounds}_addFlagsToParents(t){this.parent()!=null&&this.parent()._addFlagsToSelfAndParents(t)}_addFlagsToSelfAndParents(t){for(let n=this;n!=null;n=n.parent())n._flags|=t}_addFlagsToSelfAndChildren(t){this._flags|=t;for(let n of this._cachedChildren)n._addFlagsToSelfAndChildren(t)}isFrameBackgroundVisible(){if(!Jt.isFrameLike(this.type()))return!1;let t=this.containerSupportsFillStrokeAndCorners()?this.fillPaints():null;if(t==null)return E.alpha(this.computedBackgroundColor())>0;for(let n=0,r=t.length;n<r;n=n+1)if(t[n].isEnabledAndVisible())return!0;return!1}hasBackgroundBlurs(){if(this.effects().filter(n=>n.type()=="BACKGROUND_BLUR").length>0)return!0;let t=!1;return this.forEachChild(n=>{n.hasBackgroundBlurs()&&(t=!0)}),t}hasNonZeroStrokeWeight(){return D().prepareCppNodeForAccess(this),D().nodeTsApi().getHasNonZeroStrokeWeight(2)}styleId(){return D().prepareCppNodeForAccess(this),D().nodeTsApi().styleId(2)}inheritedStyleId(t){return D().prepareCppNodeForAccess(this),D().nodeTsApi().inheritedStyleId(t,2)}setInheritStyleId(t,n){return D().prepareCppNodeForAccess(this),D().nodeTsApi().setInheritStyleId(t,n,2)}setStyleSortPosition(t){return D().prepareCppNodeForAccess(this),D().nodeTsApi().setStyleSortPosition(t,2)}tableCellRowId(){return D().prepareCppNodeForAccess(this),D().nodeTsApi().tableCellColumnId(2)}tableCellColumnId(){return D().prepareCppNodeForAccess(this),D().nodeTsApi().tableCellColumnId(2)}getTableCellAt(t,n){D().prepareCppNodeForAccess(this);let r=D().nodeTsApi().getTableCellGuid(2,t,n);return this._scene.findNode1(r)}canvasSpaceGeometryBounds(){return this._updateBoundsIfNeeded(),this._cachedCanvasSpaceGeometryBounds}canvasSpaceRenderedBounds(){return this._updateBoundsIfNeeded(),this._cachedCanvasSpaceRenderedBounds}canvasSpaceScrollingBounds(){return this._updateBoundsIfNeeded(),this._cachedCanvasSpaceScrollingBounds}canvasSpaceInteractiveBounds(){let t=this.fillOrTextGeometry(),n=this.strokeGeometry(),r=G.new2(),o=this.size();r.setTo1(0,0,o.x(),o.y());let a=new _t;a.include3(r),t!=null&&a.include3(t.bounds),n!=null&&this.strokeAlign()!="INSIDE"&&a.include3(n.bounds);let s=a.build();return s.transformInto1(s,this.absoluteTransform()),s}canvasSpacePreviewBounds(){let t=this.strokeGeometry(),n=G.new2();n.setTo1(0,0,this.fullSize().x(),this.fullSize().y());let r=new _t;r.include3(n),t!=null&&this.strokeAlign()!="INSIDE"&&r.include3(t.bounds);let o=r.build();if(o.transformInto1(o,this.absoluteTransform()),this._scrollingLogic.shouldResizeToFitViewport()){let a=this.parent().prototypeDevice(),s=a.type=="NONE"||a.type=="PRESENTATION"?this.parent().currentViewportSize():a.size(),l=this.findContainingCanvasOrParent();if(a=l.prototypeDevice(),s=a.type=="NONE"||a.type=="PRESENTATION"?l.currentViewportSize():a.size(),!o.size().min2(s).equals(o.size())){let d=G.new4(this.canvasSpaceBoundingBox().topLeft(),s);o.intersectWith(d)}}return o}canvasSpaceBoundingBox(){let t=G.new2(),n=this.size();return t.setTo1(0,0,n.x(),n.y()),t.transformInto1(t,this.absoluteTransform()),t}fullSizeCanvasSpaceBoundingBox(){let t=G.new2();return t.setTo1(0,0,this.fullSize().x(),this.fullSize().y()),t.transformInto1(t,this.absoluteTransform()),t}_updateBoundsIfNeeded(){if(!this.isRooted()||!(4&this._flags))return;for(let r of this._cachedChildren)r._updateBoundsIfNeeded();Fe._geometryBuilder.reset(),Fe._renderedBuilder.reset(),Fe._scrollingBuilder.reset(),Fe._effectBuilder.reset();let t=0,n=this.effects();for(let r=0,o=n.length;r<o;r=r+1){let a=n[r];a.isEnabledAndVisible()&&a.type()=="FOREGROUND_BLUR"&&(t+=a.blurRadius())}t>0&&(Fe._effectBuilder.include1(-t,-t),Fe._effectBuilder.include1(t,t));for(let r=0,o=n.length;r<o;r=r+1){let a=n[r];if(a.isEnabledAndVisible()&&a.type()=="DROP_SHADOW"){let s=t+a.blurRadius()+a.spread();Fe._effectBuilder.include1(a.blurOffset().x()-s,a.blurOffset().y()-s),Fe._effectBuilder.include1(a.blurOffset().x()+s,a.blurOffset().y()+s)}}if(Jt.isGeometryLeaf(this.type())){let r=this.fillOrTextGeometry(),o=this.strokeGeometry(),a=this.absoluteTransform();r!=null&&Fe._geometryBuilder.include4(r.bounds,a),o!=null&&(this.strokeAlign()!="INSIDE"||r==null||r.regions.length==0||r.bounds.isInvalid())&&Fe._geometryBuilder.include4(o.bounds,a)}else for(let r of this._cachedChildren)r.isInvisibleOrTransparent()||(Fe._geometryBuilder.include3(r._cachedCanvasSpaceGeometryBounds),Fe._renderedBuilder.include3(r._cachedCanvasSpaceRenderedBounds)),r.visible()&&Fe._scrollingBuilder.include3(r._cachedCanvasSpaceScrollingBounds);if(Jt.isFrameLike(this.type())){let r=this.canvasSpaceBoundingBox();if(this.clipsToBoundingRectangle()){let o=Fe._geometryBuilder.build(),a=Fe._renderedBuilder.build(),s=Fe._scrollingBuilder.build();o.intersectWith(r),a.intersectWith(r),s.intersectWith(r),Fe._geometryBuilder.reset(),Fe._renderedBuilder.reset(),Fe._scrollingBuilder.reset(),Fe._geometryBuilder.include3(o),Fe._renderedBuilder.include3(a),Fe._scrollingBuilder.include3(s)}if(this.containerSupportsFillStrokeAndCorners()){let o=this.fillOrTextGeometry(),a=this.strokeGeometry(),s=this.absoluteTransform();o!=null&&Fe._geometryBuilder.include4(o.bounds,s),a!=null&&(this.strokeAlign()!="INSIDE"||o==null||o.regions.length==0||o.bounds.isInvalid())&&Fe._geometryBuilder.include4(a.bounds,s)}(this.isFrameBackgroundVisible()||this.parent()!=null&&this.parent().type()=="CANVAS"&&this.clipsToBoundingRectangle())&&(Fe._geometryBuilder.include3(r),Fe._renderedBuilder.include3(r)),Fe._scrollingBuilder.include3(r)}this._cachedCanvasSpaceGeometryBounds=Fe._geometryBuilder.build(),Fe._renderedBuilder.include3(this._cachedCanvasSpaceGeometryBounds),Fe._scrollingBuilder.include3(this._cachedCanvasSpaceGeometryBounds),Fe._effectBuilder.isValidOrZeroArea()&&(Fe._effectBuilder.buildTo(Fe._effectBounds),Fe._renderedBuilder.include3(Fe._applyEffectSpread(this._cachedCanvasSpaceGeometryBounds,Fe._effectBounds)),Fe._scrollingBuilder.include3(Fe._applyEffectSpread(this._cachedCanvasSpaceGeometryBounds,Fe._effectBounds))),this._cachedCanvasSpaceRenderedBounds=Fe._renderedBuilder.build(),this._cachedCanvasSpaceScrollingBounds=Fe._scrollingBuilder.build(),this._flags&=-5}_handlePropertyChangeForBounds(t,n){switch(t){case 22:case 20:case 21:case 12:case 51:case 75:case 62:case 26:case 70:case 28:case 48:case 16:case 29:case 65:case 66:case 69:case 46:case 71:case 17:case 47:case 27:case 30:case 88:break;case 64:case 8:{this._addFlagsToParents(4);break}default:{this._addFlagsToParents(4),this._addFlagsToSelfAndChildren(4),t==25&&n!=null&&n._addFlagsToSelfAndParents(4);break}}}developerFriendlyId(){if(this.type()=="TABLE_CELL"){let r=this.parent();return r==null?(console.error("Orphaned table cell"),null):"T"+[r.id(),this.tableCellRowId(),this.tableCellColumnId()].map(a=>a).join(";")}if(!this.isInstanceSublayer())return this.id();let t=this;for(;t!=null&&!t.isPrimaryInstance();)t=t.parent();return t==null?(console.error("Unable to find primary instance backing node"),null):"I"+this.stablePath().guids.map(r=>r).join(";")}fillOrTextGeometry(){return this.type()=="TEXT"?this.textGeometry():this.fillGeometry()}fillRegionPaints(){return Fe._computeRegionPaintsFromStyles(this.fillOrTextGeometry(),this.fillPaints(),this.scene())}strokeRegionPaints(){return Fe._computeRegionPaintsFromStyles(this.strokeGeometry(),this.strokePaints(),this.scene())}hasMoreThanOneCornerRadius(){let t=this.rectangleTopLeftCornerRadius();return this.rectangleTopRightCornerRadius()!=t||this.rectangleBottomLeftCornerRadius()!=t||this.rectangleBottomRightCornerRadius()!=t}roundedRectInfo(){return this._instantiateRoundedRect()}_instantiateRoundedRect(){if(this.rectangleCornerRadiiIndependent()){let t=[this.rectangleTopLeftCornerRadius(),this.rectangleTopRightCornerRadius(),this.rectangleBottomRightCornerRadius(),this.rectangleBottomLeftCornerRadius()];return new os(1,Ie.FrozenVector_ZERO,this.size(),t,this.cornerSmoothing())}else return new os(0,Ie.FrozenVector_ZERO,this.size(),this.cornerRadius(),this.cornerSmoothing())}fillGeometryForSpread(t,n,r){let o=null;if(this.type()=="ELLIPSE"){let a={m00:t.m00(),m01:t.m01(),m02:t.m02(),m10:t.m10(),m11:t.m11(),m12:t.m12()},s=D().getFillGeometryForSpread(a,n,this);o=new co(s)}else{let a=this._instantiateRoundedRect();a.transform(t),a.adjustCornerRadiiForSpread(n),o=Nt.fromRoundedRect(a)}return new nn(new Pt(o,"NONZERO"),r)}strokeGeometryForSpread(t,n,r,o){let a=null,s=this.strokeAlign()=="INSIDE"?2:this.strokeAlign()=="CENTER"?1:0,l=!r.subtract(2*n+s*this.strokeWeight()).isPositive(),d=2-s;if(Ne.containsAtLeastOneVisiblePaint(this.fillPaints())||l){let c=ne.new2(),u=r.add(this.strokeWeight()*d).add(2*n).divide1(r),h=-n-this.strokeWeight()*d/2;if(c.translate2(h,h),c.scale3(u),this.type()=="ELLIPSE"){let f=new G(0,0,this.size().x(),this.size().y());c.transformRect(f),a=Et.forEllipse(f)}else{let f=this._instantiateRoundedRect();f.transform(c),a=Et.fromRoundedRectWithSpread(f,n+d*this.strokeWeight()/2)}}else{if(this.strokeWeight()+2*n<=0)return null;if(this.type()=="ELLIPSE"){let c=G.new4(Ie.FrozenVector_ZERO,this.size());t.transformRect(c),c.expand1(d*this.strokeWeight()/2),a=Et.forEllipse(c),c.contract(2*n+this.strokeWeight()),a.append(Et.forEllipse(c))}else{let c=this._instantiateRoundedRect();c.transform(t),c.expand(d*this.strokeWeight()/2),a=Et.fromRoundedRectWithSpread(c,n+d*this.strokeWeight()/2),c.contract(2*n+this.strokeWeight()),a.append(Et.fromRoundedRectWithSpread(c,-(2*n+this.strokeWeight())))}}return new nn(new Pt(a,"ODD"),o)}isTopLevel(){return this.parent()!=null&&this.parent().isTopLevelParent()}isTopLevelParent(){return Fe.isTopLevelParentNodeType(this.type())}static isTopLevelParentNodeType(t){return t=="CANVAS"||t=="SECTION"}topLevelAncestor(){let t=this;for(;t!=null;){if(t.isTopLevel())return t;t=t.parent()}return null}canvas(){var r,o;let t=this.type()=="CANVAS"?this:(r=this.topLevelAncestor())==null?void 0:r.parent();return t=((o=this.topLevelAncestor())==null?void 0:o.parent().type())=="SECTION"?this.findContainingCanvasOrParent():t,t}isAncestorOf(t){for(let n=t;n!=null;n=n.parent())if(n==this)return!0;return!1}forSelfAndAncestors(t){for(let n=this;n!=null;n=n.parent())t(n)}findContainingStateGroupOrSelf(){for(let t=this;t!=null;t=t.parent())if(t.isStateGroup())return t;return null}findContainingScrollingFrameOrSelf(){for(let t=this;t!=null;t=t.parent())if(t.scrollDirection()!="NONE"&&!t.isTooRotatedToScroll())return t;return null}findContainingInstanceOrSelf(){for(let t=this;t!=null;t=t.parent())if(t.type()=="INSTANCE")return t;return null}findAllSectionsInNode(){let t=this,n=[];n.push(t);let r=[];for(;n.length>0;){let o=n.shift();for(let a=0,s=o.childCount();a<s;a=a+1){let l=o.childAt1(a);l!=null&&l.type()=="SECTION"&&(n.push(l),r.push(l))}}return r}findAllTopLevelNodesInNode(t){let n=[];if(t.type()!="CANVAS"&&t.type()!="SECTION")return n;let r=[];for(r.push(t);r.length>0;){let o=r.shift();for(let a=0,s=o.childCount();a<s;a=a+1){let l=o.childAt1(a);l.type()=="SECTION"&&r.push(l),n.push(l)}}return n}buildAncestors(){let t=[];return this.forSelfAndAncestors(n=>{t.push(n)}),t.reverse(),t}isAboveInLayerOrder(t){let n=this.buildAncestors(),r=t.buildAncestors();for(let o=0,a=Math.min(n.length,r.length);o<a;o=o+1)if(n[o]!=r[o]){let s=n[o],l=r[o];return s.indexInParent()>l.indexInParent()}return n.length==r.length?!1:n.length>r.length}isTooRotatedToScroll(){return Math.abs(this.absoluteTransform().toAngle())>=Math.PI/180}debugString(){let t="";if(t+=this.hierarchyString()+`

`,this.type()=="INSTANCE"){let n=`stablePath: ${this.stablePath()}`;t+=n+`

`}return t+=`{
`,this.each((n,r)=>{t+=`  ${Ct[n]}: ${Ze.toString(r)}
`}),t+="}",t+=`

`,t}paintsDebugString(){let t=this.strokePaints().some(n=>n.isEnabledAndVisible())?` strokeAlign=${this.strokeAlign()} weight=${this.strokeWeight()}`:"";return`Node type=${this.type()} size=${this.size()}
 -- fills=[${this.fillPaints().map(n=>n.debugString()).join(", ")}]
 -- strokes=[${this.strokePaints().map(n=>n.debugString()).join(", ")}]`+t}_makeIndent(t,n){let o="";if(n){for(let a=0,s=2*(t-1);a<s;a=a+1)o+="-";return o+="> ",o}else{for(let a=0,s=2*t;a<s;a=a+1)o+=" ";return o}}hierarchyString(){let t=[],n=this._hierarchyStringForAncestors(t);return n==0&&(t.push("(null parent)"),n=n+1),this._hierarchyStringWithChildren(n,!0,t),t.join(`
`)}_hierarchyStringLocal(t,n){let r=this._makeIndent(t,n);return r+=`${this.type()}: '${this.name()??"null"}' (${this.id()})`,(this.isInstanceSublayer()||this.isPrimaryInstance())&&(r+=` stablePath: ${this.stablePath()}`),this.isInSymbol()&&(r+=` (overrideKey: ${this.overrideKey()})`),this.type()=="INSTANCE"&&(r+=` (symbol: ${this.symbolID()??"null"})`),r+=` hasBeenLoaded: ${this.hasBeenLoaded()?"\u2714":"\u25FB\uFE0F"}`,r}_hierarchyStringForAncestors(t){let n=0,r=[];for(this.forSelfAndAncestors(o=>{o!=this&&r.push(o)});r.length>0;)t.push(r.pop()._hierarchyStringLocal(n,!1)),n=n+1;return n}_hierarchyStringWithChildren(t,n,r){r.push(this._hierarchyStringLocal(t,n));for(let o=0,a=this.childCount();o<a;o=o+1)this.childAt1(o)._hierarchyStringWithChildren(t+1,!1,r)}_invalidateRenderTreeForSelf(){this._renderTree=null,this._renderTreeAsBaseScreen=null,this._renderTreeWithoutBackgroundBlurs=null,this._renderTreeForShadowRoot=null,this._renderTreeForShadowDescendant=null,this._renderTreeForKnockoutShadowRoot=null,this._renderTreeForKnockoutShadowDescendant=null}invalidateRenderTreeForSelfAndParents(){for(let t=this;t!=null;t=t.parent())t._invalidateRenderTreeForSelf()}invalidateRenderTreeForChildren(){for(let t=0,n=this.childCount();t<n;t=t+1){let r=this.childAt1(t);r._invalidateRenderTreeForSelf(),r.invalidateRenderTreeForChildren()}}invalidateNestedBackgroundBlurRenderTrees(t,n){var s;let r=this.topLevelAncestor();if(!this.isTopLevelParent()&&(r==null||!t.has(r.id()))&&(Dt.didEncounterNestedBBNotInDirtyNodes(),Y.viewerSkipNotDirtyTreeOpt()))return!1;let o=(s=this._renderTree)==null?void 0:s.value;if(o!=null&&!o.hasBackgroundBlurs())return!1;if(this.transitioningFrom!=null){if(o==null||o.hasBackgroundBlurs()){let l=this.topLevelAncestor();if(l!=null&&t.has(l.id()))return this._invalidateRenderTreeForSelf(),!0}return!1}if(this.isInvisibleOrTransparent()&&(Dt.didEncounterNestedBBInvisible(),Y.viewerSkipInvisibleTreeOpt()))return!1;let a=!1;for(let l=0,d=this.childCount();l<d;l=l+1)a=this.childAt2(l,!0).invalidateNestedBackgroundBlurRenderTrees(t,n)||a;if(a)return this._invalidateRenderTreeForSelf(),!0;if(!Jt.isGeometryLeaf(this.type())&&!Jt.isFrameLike(this.type()))return!1;if(this.effects().length!=0){let l=this.supportsGeometry()?this.canvasSpaceGeometryBounds():this.canvasSpaceBoundingBox();for(let d=0,c=this.effects().length;d<c;d=d+1){let p=this.effects()[d];if(p.isVisibleForRendering()&&p.type()=="BACKGROUND_BLUR"){let u=G.new3(l).expandedBy1(p.blurRadius()),h=!1,f=this.topLevelAncestor();if(f!=null&&t.has(f.id())&&(h=!0),h)return this._invalidateRenderTreeForSelf(),n.push(u),!0}}}return!1}getCachedRenderTree(){return this._renderTree}getCachedRenderTreeForBaseScreen(){return this._renderTreeAsBaseScreen}renderTree1(){return this.renderTree2(new jt(this))}renderTree2(t){if(t.overlayRenderData()!=null&&t.overlayRenderData().hasTransition()&&t.hasBackgroundBlurs()){let n=new Re.GenerateArgs(Re.RenderMode.NORMAL);return Re.generateRenderTree(t,n)}if(this._renderTree==null){let n=new Re.GenerateArgs(Re.RenderMode.NORMAL);this.actingAsOverlayOrSublayerForRendertreeGeneration(()=>{this._renderTree=new _e(Re.generateRenderTree(t,n))}),(this._renderTree.value==null||!this._renderTree.value.hasBackgroundBlurs())&&(this._renderTreeWithoutBackgroundBlurs=this._renderTree)}return this._renderTree.value}renderTreeForBaseScreen1(){return this.renderTreeForBaseScreen2(new jt(this))}renderTreeForBaseScreen2(t){if(this._renderTreeAsBaseScreen==null){let n=new Re.GenerateArgs(Re.RenderMode.NORMAL);this.actingAsBaseScreenForRendertreeGeneration(()=>{this._renderTreeAsBaseScreen=new _e(Re.generateRenderTree(t,n))})}return this._renderTreeAsBaseScreen.value}renderTreeWithoutBackgroundBlurs(){if(this._renderTreeWithoutBackgroundBlurs==null){let t=new jt(this),n=new Re.GenerateArgs(Re.RenderMode.WITHOUT_BACKGROUND_BLURS);this._renderTreeWithoutBackgroundBlurs=new _e(Re.generateRenderTree(t,n))}return this._renderTreeWithoutBackgroundBlurs.value}renderTreeForShadowRoot1(){return this.renderTreeForShadowRoot2(new jt(this))}renderTreeForShadowRoot2(t){if(this._renderTreeForShadowRoot==null){let n=new Re.GenerateArgs(Re.RenderMode.SHADOW,t.uniqueIdentifier());this._renderTreeForShadowRoot=new _e(Re.generateRenderTree(t,n))}return this._renderTreeForShadowRoot.value}renderTreeForShadowDescendant1(){return this.renderTreeForShadowDescendant2(new jt(this))}renderTreeForShadowDescendant2(t){if(this._renderTreeForShadowDescendant==null){let n=new Re.GenerateArgs(Re.RenderMode.SHADOW);this._renderTreeForShadowDescendant=new _e(Re.generateRenderTree(t,n))}return this._renderTreeForShadowDescendant.value}renderTreeForKnockoutShadowRoot1(){return this.renderTreeForKnockoutShadowRoot2(new jt(this))}renderTreeForKnockoutShadowRoot2(t){if(this._renderTreeForKnockoutShadowRoot==null){let n=new Re.GenerateArgs(Re.RenderMode.KNOCKOUT_SHADOW,t.uniqueIdentifier());this._renderTreeForKnockoutShadowRoot=new _e(Re.generateRenderTree(t,n))}return this._renderTreeForKnockoutShadowRoot.value}renderTreeForKnockoutShadowDescendant1(){return this.renderTreeForKnockoutShadowDescendant2(new jt(this))}renderTreeForKnockoutShadowDescendant2(t){if(this._renderTreeForKnockoutShadowDescendant==null){let n=new Re.GenerateArgs(Re.RenderMode.KNOCKOUT_SHADOW);this._renderTreeForKnockoutShadowDescendant=new _e(Re.generateRenderTree(t,n))}return this._renderTreeForKnockoutShadowDescendant.value}renderTreeForOverlay(t){let n=!1;t.overlayRenderData()!=null&&this._overlayCacheKey!=t.overlayRenderData().overlayCacheKey()&&(this._invalidateRenderTreeForSelf(),n=!0);let r=this.renderTree2(t);return n&&(this._overlayCacheKey=t.overlayRenderData().overlayCacheKey()),r}_handlePropertyChangeForRenderTree(t,n){switch(t){case 24:case 78:{this.invalidateRenderTreeForSelfAndParents(),this.invalidateRenderTreeForChildren();break}case 25:{this.invalidateRenderTreeForSelfAndParents(),n!=null&&n.invalidateRenderTreeForSelfAndParents();break}case 90:case 66:{let r=this.findAllTopLevelNodesInNode(this);for(let o=0,a=r.length;o<a;o=o+1){let s=r[o];s!=null&&s.invalidateRenderTreeForSelfAndParents()}break}case 64:case 9:case 38:case 22:case 59:case 3:case 13:case 10:case 11:case 37:case 14:case 81:case 35:case 34:case 49:case 23:case 74:case 60:case 1:case 2:case 4:case 76:case 19:case 8:case 61:case 52:case 53:case 55:case 56:case 92:case 93:case 94:case 95:case 63:case 73:case 75:case 44:case 39:case 40:case 41:case 42:case 15:case 45:case 62:{this.invalidateRenderTreeForSelfAndParents();break}}}static _forEachNodeHelper(t,n){let r=n(t)||Fe.Loop.CONTINUE;switch(r){case Fe.Loop.BREAK:return Fe.Loop.BREAK;case Fe.Loop.CONTINUE:break;case Fe.Loop.SKIP:return Fe.Loop.CONTINUE}for(let o=0,a=t.childCount();o<a;o=o+1)if(t.childAt1(o)!==void 0)switch(r=Fe._forEachNodeHelper(t.childAt1(o),n),r){case Fe.Loop.BREAK:return Fe.Loop.BREAK;case Fe.Loop.CONTINUE:break;case Fe.Loop.SKIP:return Fe.Loop.CONTINUE}return Fe.Loop.CONTINUE}static forEachNode(t,n){Fe._forEachNodeHelper(t,n)}static lowestCommonAncestor(t){if(t.length==0)return null;let n=t[0];for(;n!=null;){let r=!0;for(let o of t)if(!n.isAncestorOf(o)){n=n.parent(),r=!1;break}if(r)break}return n}static _areNodesOrderedCorrectly(t,n){let r=t.parentIndex(),o=n.parentIndex();return sn.compare(r.position,o.position)<0||r.position==o.position&&ee.compare(t.id(),n.id())<0}static _applyEffectSpread(t,n){if(n!=null){let r=t.clone();return r.translate1(n.centerX(),n.centerY()),r.expand2(n.width()/2,n.height()/2),r}return t}static _computeRegionPaintsFromStyles(t,n,r){if(t!=null){let o=n!=null?n.filter(l=>l.isEnabledAndVisible()):[],a=new Map,s=t.paintOverrides;return o.length==0&&o.push(ie.TRANSPARENT),t.regions.map(l=>{let d=o,c=l.styleID;if(c!=0&&s!=null){let p=Ht.IntMap_get(a,c,null);if(p==null){let u=s.get(c,r);u!=null&&(p=u.filter(h=>h.isEnabledAndVisible()),a.set(c,p))}p!=null&&(d=p)}return d})}return Fe.EMPTY_REGION_PAINTS}};Fe.schema=null,Fe._geometryBuilder=new _t,Fe._renderedBuilder=new _t,Fe._scrollingBuilder=new _t,Fe._effectBuilder=new _t,Fe._effectBounds=G.new2(),Fe.EMPTY_REGION_PAINTS=[];var ye=Fe;(t=>{let i;(a=>(a[a.CONTINUE=0]="CONTINUE",a[a.BREAK=1]="BREAK",a[a.SKIP=2]="SKIP"))(i=t.Loop||(t.Loop={}));let e;(r=>{function n(o){return t.Loop[o]}r.Loop_toString=n})(e=t.in_Loop||(t.in_Loop={}))})(ye||(ye={}));var sh;(t=>{function i(n){return ee._new(n,t._nextLocalID=t._nextLocalID+1)}t.make=i,t._nextLocalID=0})(sh||(sh={}));var Cs=class i{constructor(){this.assertEquals=AssertLib.strictEqual,this.trackingCalls=[],this._uninstall=null,this._uninstall=Pe.mockTrackEvent((e,t,n)=>{this.trackingCalls.push(new i.TrackingPayload(e,t,n))})}uninstall(){this._uninstall()}expectTrackToHaveBeenCalledWith1(e,t){this.expectTrackToHaveBeenCalledWith2(e,t,{})}expectTrackToHaveBeenCalledWith2(e,t,n){this.trackingCalls.some(r=>r.equalsWithSubsetOfArgs(new i.TrackingPayload(e,t,n)))}};(e=>{class i{equalsWithSubsetOfArgs(n){if(this.name!=n.name)return!1;for(let r of Object.keys(n.args))if(n.args[r]!==this.args[r])return!1;for(let r of Object.keys(n.options))if(n.options[r]!==this.options[r])return!1;return!0}constructor(n,r,o){this.name=n,this.args=r,this.options=o}}e.TrackingPayload=i})(Cs||(Cs={}));function $n(i){if(!Lo.isTestingEnv())throw new Error(i)}function b1(i){xl=xl+1;let e=ee._new(1,xl);for(let t=0,n=i.totalNodeCount();t<n&&i.findNode1(e)!=null;t=t+1)xl=xl+1,e=ee._new(1,xl);return e}function Pr(i,e){let t=i.scene().createNode1(b1(i.scene()));return t.setVisible(!0),t.setOpacity(1),t.setType(e),e!="CANVAS"&&e!="DOCUMENT"&&(t.setRelativeTransform(ne.new2()),t.setSize(new I(100,100))),i.appendChild(t),t}function et(i,e){return dn(i,e,E.BLACK)}function Ao(i,e,t){let n=Pr(i,"FRAME");return n.setName(e),n.setBackgroundOpacity(1),n.setIsBackgroundEnabled(!0),n.setIsFrameMaskDisabled(!1),n.setIsResizeToFit(!1),n.setContainerSupportsFillStrokeAndCorners(!0),n.setTestOnlyFillPaints2([t]),n}function Rs(i,e,t,n,r){let o=Pr(i,"FRAME");return o.setName(e),o.setBackgroundOpacity(1),o.setIsBackgroundEnabled(!0),o.setIsFrameMaskDisabled(!1),o.setIsResizeToFit(!1),o.setContainerSupportsFillStrokeAndCorners(!0),o.setTestOnlyFillPaints(t),o.setTestOnlyStrokeGeometry(new Vn([new Wn("NONZERO",0,Et.forCenterStrokeAroundRect(r,10),r)],null,r,null)),o.setTestOnlyStrokePaints(n),o}function dn(i,e,t){let n=new ie("SOLID");return n.setColor(t),n.setOpacity(1),n.setIsEnabled(!0),Ao(i,e,n)}function sT(i,e){let t=ie.createLinearGradient([new $e(E.new3(1,.5,0,1),.25),new $e(E.new3(0,.5,1,1),.75)]);return Ao(i,e,t)}function li(i){let e=Pr(i,"FRAME");return e.setName("Group"),e.setBackgroundOpacity(1),Ha(e,!1),e.setIsResizeToFit(!0),e}function Pl(i){let e=Pr(i,"BOOLEAN_OPERATION");return e.setName("Boolean Operation"),e.setBackgroundOpacity(1),e.setIsBackgroundEnabled(!1),e.setIsResizeToFit(!0),e}function sa(i,e){let t=li(i);return t.setName(e),t}function rt(i){return et(i,"Frame")}function lT(i){return Pr(i,"VECTOR")}function Fr(i){return Pr(i,"RECTANGLE")}function je(i,e){let t=Fr(i);return t.setName(e),t}function cT(i,e){let t=Pr(i,"ROUNDED_RECTANGLE");return t.setCornerRadius(e),t}function lh(i){return Pr(i,"TEXT")}function T1(i,e){let t=lh(i);return t.setName(e),t}function ci(i){return Pr(i,"SYMBOL")}function Ga(i,e){let t=Pr(i,"INSTANCE");return t.setTestOnlySymbolData(new ia(e.id(),Vo.new1([],[]))),t}function Jo(i){let e=new G(0,0,i.width(),i.height()),t=new Wn("NONZERO",0,Nt.fromRect(e),e);return new Vn([t],null,t.bounds(),new So(new zn))}function dT(i,e){let t=new Wn("NONZERO",0,Et.fromRoundedRect1(new os(2,G.new3(i),e,null,0)),i);return new Vn([t],null,t.bounds(),new So(new zn))}function uT(i){let e=Et.new2();e.moveTo1(i.topLeft().x(),i.topLeft().y()).lineTo(i.topRight().x(),i.topRight().y()).lineTo(i.bottomLeft().x(),i.bottomLeft().y()).close();let t=new Wn("NONZERO",0,e,i);return new Vn([t],null,t.bounds(),new So(new zn))}function pT(i){let e=[];_t.INSTANCE.reset();for(let t of i)e.push(new Wn("NONZERO",0,Et.fromRect(t),t)),_t.INSTANCE.include3(t);return new Vn(e,null,_t.INSTANCE.build(),new So(new zn))}function Fl(i,e){hf(i,e.id())}function hf(i,e){let t=i.prototypeInteractions().length==0?Zt.createDefault():i.prototypeInteractions()[0],n=t.action()!=null?t.action().value:jn.createDefault();i.setTestOnlyPrototypeInteractions([t.withActions([n.withTransitionNodeID(e).withConnectionType("INTERNAL_NODE")])])}function Mn(i,e,t,n,r){return ch(i,e,t,n,r,!1)}function ch(i,e,t,n,r,o){switch(r){case"NAVIGATE":{Fl(i,e);break}case"OVERLAY":{bd(i,e);break}case"SWAP":{gf(i,e);break}case"SWAP_STATE":{v1(i,e);break}}let a=i.prototypeInteractions()[0];return i.setTestOnlyPrototypeInteractions([a.withEvent(a.event().withInteractionType(t)).withActions([a.action().value.withTransitionType(n).withTransitionShouldSmartAnimate(o)]).withStateManagementVersion(Y.getFeatureFlags().prototype_state_management?1:0)]),i.prototypeInteractions()[0]}function dh(i){let e=i.prototypeInteractions().length==0?Zt.createDefault():i.prototypeInteractions()[0],t=e.action()!=null?e.action().value:jn.createDefault();i.setTestOnlyPrototypeInteractions([e.withActions([t.withConnectionType("BACK")])])}function bd(i,e){mf(i,e,I.new2())}function mf(i,e,t){let n=i.prototypeInteractions().length==0?Zt.createDefault():i.prototypeInteractions()[0],r=n.action()!=null?n.action().value:jn.createDefault();i.setTestOnlyPrototypeInteractions([n.withActions([r.withTransitionNodeID(e.id()).withConnectionType("INTERNAL_NODE").withOverlayRelativePosition(t).withNavigationType("OVERLAY")])])}function gf(i,e){let t=i.prototypeInteractions().length==0?Zt.createDefault():i.prototypeInteractions()[0],n=t.action()!=null?t.action().value:jn.createDefault();i.setTestOnlyPrototypeInteractions([t.withActions([n.withTransitionNodeID(e.id()).withConnectionType("INTERNAL_NODE").withNavigationType("SWAP")])])}function v1(i,e){let t=i.prototypeInteractions().length==0?Zt.createDefault():i.prototypeInteractions()[0],n=t.action()!=null?t.action().value:jn.createDefault();i.setTestOnlyPrototypeInteractions([t.withActions([n.withTransitionNodeID(e.id()).withConnectionType("INTERNAL_NODE").withNavigationType("SWAP_STATE")])])}function ff(i){let e=i.prototypeInteractions().length==0?Zt.createDefault():i.prototypeInteractions()[0],t=e.action()!=null?e.action().value:jn.createDefault();i.setTestOnlyPrototypeInteractions([e.withActions([t.withConnectionType("CLOSE")])])}function uh(i,e){let t=i.prototypeInteractions().length==0?Zt.createDefault():i.prototypeInteractions()[0];i.setTestOnlyPrototypeInteractions([t.withEvent(t.event().withInteractionType(e))])}function We(i,e,t){let n=ne.new2();n.translate1(e),i.setRelativeTransform(n),i.setSize(t)}function pe(i,e){let t=je(i,e);return t.setTestOnlyFillPaints([ie.createSolid(E.RED,1)]),t.setTestOnlyFillGeometry(Jo(G.new4(new I(0,0),t.size()))),t}function Vt(i,e,t,n){let r=je(i,e);return r.setTestOnlyFillPaints([ie.createSolid(t,n)]),r.setTestOnlyFillGeometry(Jo(G.new4(new I(0,0),r.size()))),r}function ph(i,e,t){let n=je(i,e);return n.setTestOnlyFillPaints3(t),n.setTestOnlyFillGeometry(Jo(G.new4(new I(0,0),n.size()))),n}function Td(i,e,t){let n=je(i,e);return n.setSize(t),n.setTestOnlyFillPaints(Ne.fromPaint(new ie("IMAGE"))),n.setTestOnlyFillGeometry(Jo(G.new4(new I(0,0),n.size()))),n}function _f(i,e,t){let n=Pr(i,"VECTOR");return n.setName(e),n.setSize(t),n.setTestOnlyFillPaints(Ne.fromPaint(new ie("IMAGE"))),n.setTestOnlyFillGeometry(uT(G.new4(new I(0,0),n.size()))),n}function Dr(i,e,t,n,r){let o=je(i,e);return o.setSize(r),o.setTestOnlyFillPaints([ie.createSolid(t,n)]),o.setTestOnlyFillGeometry(Jo(G.new4(new I(0,0),o.size()))),o}function Af(i,e,t,n,r){let o=Pr(i,"VECTOR");return o.setName(e),o.setSize(r),o.setTestOnlyFillPaints([ie.createSolid(t,n)]),o.setTestOnlyFillGeometry(uT(G.new4(new I(0,0),o.size()))),o}function hT(i,e){let t=T1(i,e);return t.setTestOnlyFillPaints([ie.createSolid(E.RED,1)]),t.setTestOnlyTextData(Pi.forTests1()),t}function ef(i){ah(i,[])}function ah(i,e){if($n("Should only be used in tests"),D()==null)throw new Error("Expected PrototypeLib to be initialized");let t=[i],n=[];for(let a=0,s=e.length;a<s;a=a+1){let l={};l.bytes=e[a],n.push(l)}let r={type:"NODE_CHANGES",sessionID:0,ackID:0,blobs:n,nodeChanges:t},o=ye.schema.encodeMessage(r);D().applyLocalNodeChangesForTests(o)}function Ha(i,e){if($n("Writing to paints is only supported in tests because it's not fully implemented"),Jt.isFrameLike(i.type())){let t=[],n=i.fillPaints();if(n!=null)for(let r=0,o=n.length;r<o;r=r+1){let a=n[r].clone();a.setIsEnabled(e),t.push(a)}i.setTestOnlyFillPaints(t)}else i.setIsBackgroundEnabled(!1)}var xl=0;var Ns=class{constructor(e,t,n){var r;this._property=0,this._activeCanvasGUID=null,this._onChange=null,this._property=t,this._activeCanvasGUID=(r=e.getActiveCanvas())==null?void 0:r.id(),this._onChange=n,e.addAppObserver(this)}handleSceneChange(e,t){e!=null&&e.removeObserver(this),t!=null&&t.addObserver(this)}handleActiveCanvasChange(e,t){if(t==null)return;this._activeCanvasGUID=t.id();let n=e==null?void 0:e.get2(this._property),r=t.get2(this._property);n!=r&&this._onChange(r)}handleActivePrototypeStartingPointChange(e,t){}handleSceneGraphEvent(e){var t;e.property==this._property&&ee.equals((t=e.node)==null?void 0:t.id(),this._activeCanvasGUID)&&e.oldVal!=e.newVal&&this._onChange(e.newVal)}};var yf=Wa(xs());var hh=class{constructor(e,t,n){this._appState=null,this._canvasView=null,this._emitter=null,this._session=null,this._userSyncing=null,this._isFirst=!1,this._appState=e,this._canvasView=t,this._emitter=qt.getEventEmitter(),this._session=n,this._userSyncing=null,this._isFirst=!0,this._session.addObserver(this),this._appState.addFrameObserver(this)}reset(){this._isFirst=!0}userInfoJSON(){if(this._userSyncing==null)return null;let e=[],t=this._userSyncing.userBySessionID(),n=this._session.sessionID();t.has(n)&&e.push(t.get(n).toJSON());for(let o of Array.from(this._userSyncing.userBySessionID().values()))o.sessionID!=n&&e.push(o.toJSON());let r=0;if(this._session.presenterSessionID()!=null&&this._session.presenterSessionID().value==n)for(let o of Array.from(this._userSyncing.userBySessionID().values()))o.sessionID!=n&&o.observedSessions.indexOf(n)!=-1&&(r=r+1);return{deviceNameFilter:this._session.role(),sessionID:n,allUsers:e,followerCount:r,observingSessionID:this._session.observingSessionID(),presenterSessionID:this._session.presenterSessionID()!=null?this._session.presenterSessionID().value:null,sessionNominatedByCurrentUser:this._session.sessionNominatedByCurrentUser()!=null?this._session.sessionNominatedByCurrentUser().value:null,sessionsNominatingCurrentUser:this._session.sessionsNominatingCurrentUser()}}performSetVariableActions(e){let t=this._appState.prototypeState(),n=this._session.observedUser();if(n==null)return;e&&t.resetVariablePrototypeState();let r=n.triggeredSetVariableActionData??[];if(t.getSetVariableActionHistoryLength()>r.length&&t.resetVariablePrototypeState(),t.getSetVariableActionHistoryLength()<r.length)for(let o=t.getSetVariableActionHistoryLength();o<r.length;o++){let a=r[o];t.performMultiplayerSetVariableAction(a)}}performVideoStateChanges(e){let t=this._appState.prototypeState(),n=this._session.observedUser();if(n==null)return;e&&t.resetVideoStateChangeHistory();let r=n.videoStateChangeData??[];for(let o=0;o<r.length;o++){let a=r[o],s=t.getVideoStateChange(o);(!s||!this._videoStateEqual(a,s))&&t.performMultiplayerVideoStateChange((s==null?void 0:s.currentTimes)||[],a)}}_videoStateEqual(e,t){return ee.fromFigGUID(e.targetNodeId)!=ee.fromFigGUID(t.targetNodeId)||e.isPlaying!=t.isPlaying||e.isPlayingSound!=t.isPlayingSound||e.actionTakenTimestamp!=t.actionTakenTimestamp?!1:(e.currentTimes.forEach((n,r)=>{if(n!=t.currentTimes[r])return!1}),!0)}setPreviewToObservedFrameOrOverlay(e){let t=this._appState.prototypeState(),n=this._appState.prototypeStructure(),r=this._session.observedUser();if(r==null)return;this.applyInstanceStateSwaps(e);let o=r.triggeredOverlaysData??[],a=r.currentFrame;if(a!=null&&!ee.equals(this._appState.baseScreenId(),a)){let l=null,d=null;o.length==0&&(l=r.lastTriggeredHotspot,d=r.lastTriggeredPrototypeInteractionID);let c=null;if(l!=null&&d!=null)c=n.findPrototypeInteractionWithId(l,d);else if(l!=null){let p=this._appState.getActiveCanvas().scene().findNode1(l),u=Bt.cleanedInteractionsForNode(this._appState,p);u.length!=0&&(c=u[0])}this._appState.prototypeState().navigateToFrameAndCloseOverlays(a,this._appState.scene().findNode1(l),1,0,0,c,null)}let s=t.getCurrentOverlays();s.length>o.length&&(t.closeOverlayAtAndAbove(o.length,1),s=t.getCurrentOverlays());for(let l=0,d=o.length;l<d;l=l+1){let c=mt.decodeGUID(o[l].overlayGuid),p=mt.decodeGUID(o[l].swapGuid),u=mt.decodeGUID_instanceHACK(o[l].hotspotGuid),h=mt.decodeGUID(o[l].prototypeInteractionGuid),f=null;if(h!=null)f=n.findPrototypeInteractionWithId(u,h);else{let y=this._appState.prototypeStructure().findPrototypeInteractionsWithTransition(u,p);y.length!=0&&(f=y[0])}if(s.length<=l){let y=this._appState.scene().findNode1(u);if(y==null)return;t.overlayFrame(p,y,0,0,f,null),s=t.getCurrentOverlays()}if(!ee.equals(s[l].id(),c)||!ee.equals(s[l].overlayDataModelId(),p)){if(l<s.length-1&&t.closeOverlayAtAndAbove(l+1,1),!ee.equals(s[l].overlayDataModelId(),p)){t.closeOverlayAtAndAbove(l,1);let _=this._appState.scene().findNode1(u);t.overlayFrame(p,_,0,0,f,null)}let y=this._appState.scene().findNode1(s[l].id()),g=r.lastTriggeredHotspot,A=this._appState.scene().findNode1(g);A=y!=null&&y.isAncestorOf(A)?A:null;let T=r.lastTriggeredPrototypeInteractionID,b=null;A!=null&&T!=null?b=n.findPrototypeInteractionWithId(A.id(),T):A!=null&&n.nodeTransitionTracker().cleanedUpInteractionMap()._in(A.id())&&(b=n.nodeTransitionTracker().cleanedUpInteractionMap().getHotspotInteractions(A.id())[0]),t.swapTopOverlay(c,A,0,b,null)}s=t.getCurrentOverlays()}t.getInitiatedChange()!=null&&!e&&t.commitStateChange()}_initiateStateSwap(e){var a;let t=this._appState.prototypeState(),n=mt.decodeGUIDPath(e.hotspotStablePath),r=(a=this._appState.scene())==null?void 0:a.findNode3(n),o=mt.decodeGUID(e.interactionID);t.swapInstanceToState2(mt.decodeGUIDPath(e.instanceStablePath),mt.decodeGUID(e.stateID),r,0,r==null?void 0:r.findPrototypeInteraction(o),1,null)}_commitStateSwap(e){let t=this._appState.prototypeState(),n=mt.decodeGUIDPath(e.instanceStablePath);t.commitChangesBelowInstanceTransitionRoot(n)}applyInstanceStateSwaps(e){let t=this._session.observedUser();if(t.instanceStateChanges!=null){for(let n of t.instanceStateChanges)n.phase=="INITIATED"&&this._initiateStateSwap(n),(n.phase=="COMMITTED"||!e)&&this._commitStateSwap(n);t.instanceStateChanges=[]}}handleConnect(e,t){this._userSyncing=new ud,this._session.setMultiplayerUserSyncing(this._userSyncing),this._userSyncing.onChange=n=>{this._emitter.trigger("multiplayerUserInfoChange",this.userInfoJSON())},this._userSyncing.onMouseCursorChange=n=>{var r;n==this._session.observingSessionID()&&((r=this._canvasView)==null||r.viewport().invalidate())}}handleDisconnect(){this._userSyncing=null,this._session.setMultiplayerUserSyncing(null),this._emitter.trigger("multiplayerUserInfoChange",null)}handleJoinStart(e,t,n){e!=1&&this._emitter.trigger("joinStart",null)}handleJoinEnd(){var t;this._session.scene()!=this._appState.scene()&&this._appState.setActiveCanvas(null),this._isFirst&&(this._isFirst=!1);let e=this._appState.getActiveCanvas();e!=null&&this._emitter.trigger("prototypeDeviceChanged",e.prototypeDevice().toJSON()),(t=this._canvasView)==null||t.afterEnteredViewer()}handleNodeChanges(){this._appState.prototypeState().didApplyNodeChanges()}handlePresenterChange(){this._emitter.trigger("multiplayerUserInfoChange",this.userInfoJSON())}handleSceneGraphReply(e,t){}handleSceneChangedLoadingPhase(e,t){}onFrame(){this.setPreviewToObservedFrameOrOverlay(!0),this.performSetVariableActions(!1),this.performVideoStateChanges(!1)}};var mh;(p=>{function i(u){return u}p._shortcut1=i;function e(u,h){return u|h<<p.MODIFIERS_SHIFT}p._shortcut2=e;function t(u,h,f){return u|h<<p.MODIFIERS_SHIFT|f<<p.FLAGS_SHIFT}p._shortcut3=t;function n(u){let h=new Map([[3,[e(20,4),e(20,16)]],[4,[21,29]],[1,[93,92,69,e(93,16),e(92,16),e(69,16)]],[2,[91,70,e(91,16),e(70,16)]]]);for(let f of Array.from(h.keys()))for(let y of h.get(f)){let g=y&p.KEY_MASK,A=y>>p.MODIFIERS_SHIFT&p.MODIFIERS_MASK,T=y>>p.FLAGS_SHIFT&p.FLAGS_MASK;o.Flags_currentlyApplies(T)&&(16&A&&(A|=cs.Modifiers_currentPlatformModifier()),Ws.KeyShortcutMap_set(u,g,A,f))}}p.addTo=n;let r;(y=>(y[y.__NONE=0]="__NONE",y[y.MAC=1]="MAC",y[y.NON_MAC=2]="NON_MAC"))(r=p.Flags||(p.Flags={}));let o;(y=>{function u(g){return(1&g)!=0}y.Flags_isMacOnly=u;function h(g){return(2&g)!=0}y.Flags_isNonMacOnly=h;function f(g){return(!u(g)||Je.current()==4)&&(!h(g)||Je.current()!=4)}y.Flags_currentlyApplies=f})(o=p.in_Flags||(p.in_Flags={})),p.KEY_MASK=255,p.MODIFIERS_MASK=255,p.MODIFIERS_SHIFT=8,p.FLAGS_MASK=255,p.FLAGS_SHIFT=16})(mh||(mh={}));var vd=(t=>(t[t.INTERNAL_ON_FRAME_LOOP_ENABLED=0]="INTERNAL_ON_FRAME_LOOP_ENABLED",t[t.INTERNAL_ON_FRAME_LOOP_DISABLED=1]="INTERNAL_ON_FRAME_LOOP_DISABLED",t))(vd||{}),Dl=class{constructor(e,t,n,r){this._window=null,this._appState=null,this._canvasView=null,this._shortcuts=new Map,this._multiplayerSession=null,this._multiplayerCoupler=null,this._window=new hu(e,t,r==1,()=>Y.isInlinePreview()),this._appState=new vn,this._canvasView=new Ua(this._appState),this._canvasView.setParent(this._window.root()),this._canvasView.setup(),this._canvasView.focus(),this._registerShortcuts(),this._multiplayerSession=new ra(this._appState,()=>this._window.isActive(),n),this._multiplayerCoupler=new hh(this._appState,this._canvasView,this._multiplayerSession),this._canvasView.setMultiplayer(this._multiplayerSession),hr.instance.setMultiplayer(this._multiplayerSession)}state(){return this._appState}canvasView(){return this._canvasView}window(){return this._window}multiplayerSession(){return this._multiplayerSession}multiplayerCoupler(){return this._multiplayerCoupler}_registerShortcuts(){let e=!0;qn.addUpdate(Kt.keyPress(this._window.root().events()),t=>{e&&(mh.addTo(this._shortcuts),e=!1);let n=Ws.KeyShortcutMap_get(this._shortcuts,t.asKeyEvent().key,t.modifiers(),0);n!=0&&(this._appState.triggerAction1(n),t.accept())})}unloadSceneAndResetPrototypeLib(){this._multiplayerSession.disconnect(),this._appState.setScene(null),this._multiplayerSession.setScene(null),D()!=null&&(console.debug("Resetting PrototypeLib..."),Ul())}initializePrototypeLib(e){if(this.unloadSceneAndResetPrototypeLib(),e==null)throw new Error("Can't initialize PrototypeLib with null CppModules");Lo.initialize(e,this._appState)}connectTo(e,t,n,r,o,a,s){this._appState.setActivePrototypeStartingPointNodeId(n),this._appState.prototypeState().resetPrototype(),this._multiplayerCoupler.reset(),this._appState.setRenderDots(!!a),this._canvasView.setBackgroundEnabled(!a),Rt.setImagePrefixURL(`/file/${e}/image`),Rt.setVideoPrefixUrl(`/api/files/${e}/videos`),Je.isMobile(Je.current())||Je.current()==4&&navigator.maxTouchPoints>0||Rt.forceMobileOptimizations()?Rt.setImageBatchURL(`/file/${e}/image/batch?max_size=2048`):Rt.setImageBatchURL(`/file/${e}/image/batch`),this.initializePrototypeLib(s),this._multiplayerSession.connectTo(e,t,r,o)}},mT;(e=>{function i(t){return vd[t]}e.InternalOnFrameLoop_toString=i})(mT||(mT={}));var Sf;(r=>{function i(o){return Array.from(o.values())}r.Set_values=i;function e(o,a){return n(o,a)}r.Set_subtract=e;function t(o){return new Set(o)}r.Set_new1=t;function n(o,a){let s=new Set(Array.from(o.values()));return o.forEach(l=>{a.has(l)&&s.delete(l)}),s}r.Set_difference=n})(Sf||(Sf={}));var bf=(t=>(t[t.INCREMENTAL_QUERIED_BY_CLIENT=0]="INCREMENTAL_QUERIED_BY_CLIENT",t[t.FULL_DOCUMENT_UPFRONT=1]="FULL_DOCUMENT_UPFRONT",t))(bf||{});var gT;(e=>{function i(t){return bf[t]}e.DocumentLoadMode_toString=i})(gT||(gT={}));var Tf;(d=>{function i(){return w.BufferChunk.BYTE_COUNT}d.BYTE_COUNT=i;function e(){let c=new l,p=c.add(w.VertexFormat.getPositionF2(),i()/4|0,0);p.area.byteOffset()==0;let u=c.add(w.VertexFormat.getPositionF2(),i()/4|0,1);u.area.byteOffset()==(i()/4|0);let h=c.add(w.VertexFormat.getPositionF2(),i()/4|0,2);h.area.byteOffset()==(i()/4|0)*2;let f=c.add(w.VertexFormat.getPositionF2(),i()/4|0,3);f.area.byteOffset()==(i()/4|0)*3,p.free(),h.free();let y=c.add(w.VertexFormat.getPositionF2(),i()/4|0,4);u.area.byteOffset()==0,f.area.byteOffset()==(i()/4|0),y.area.byteOffset()==(i()/4|0)*2,c.pool.totalVRAM()==i(),c.context.buffers.length==1;let g=c.context.buffers[0];u.check(g),f.check(g),y.check(g)}d.testBasicBufferPoolGC=e;function t(){let c=new l,p=c.add(w.VertexFormat.getPositionF2(),i()/4|0,0);p.area.byteOffset()==0;let u=c.add(w.VertexFormat.getPositionF2(),i()/4|0,1);u.area.byteOffset()==(i()/4|0);let h=c.add(w.VertexFormat.getPositionF2(),i()/4|0,2);h.area.byteOffset()==(i()/4|0)*2;let f=c.add(w.VertexFormat.getPositionF2(),i()/4|0,3);f.area.byteOffset()==(i()/4|0)*3,p.free();let y=c.add(w.VertexFormat.getPositionF2(),i()/4|0,4);u.area.byteOffset()==0,h.area.byteOffset()==(i()/4|0),f.area.byteOffset()==(i()/4|0)*2,y.area.byteOffset()==(i()/4|0)*3,c.pool.totalVRAM()==i(),c.context.buffers.length==1;let g=c.context.buffers[0];u.check(g),h.check(g),f.check(g),y.check(g)}d.testBasicBufferPoolGC2=t;function n(){let c=new l,p=c.add(w.VertexFormat.getPositionF2(),i()/4|0,0);p.area.byteOffset()==0;let u=c.add(w.VertexFormat.getPositionF2(),i()/4|0,1);u.area.byteOffset()==(i()/4|0);let h=c.add(w.VertexFormat.getPositionF2(),i()/4|0,2);h.area.byteOffset()==(i()/4|0)*2,u.free();let f=c.add(w.VertexFormat.getPositionF2(),i()/2|0,3);p.area.byteOffset()==0,h.area.byteOffset()==(i()/4|0),f.area.byteOffset()==(i()/4|0)*2,c.pool.totalVRAM()==i(),c.context.buffers.length==1;let y=c.context.buffers[0];p.check(y),h.check(y),f.check(y)}d.testByteOffsetBugFig5426=n;function r(){let c=new l,p=c.add(w.VertexFormat.getPositionF2(),8,0);p.area.byteOffset()==0;let u=c.add(w.VertexFormat.getPositionF2(),8,1);u.area.byteOffset()==8;let h=c.add(w.VertexFormat.getPositionF4CoordF4(),32,2);h.area.byteOffset()==32;let f=c.add(w.VertexFormat.getPositionF4CoordF4(),32,3);f.area.byteOffset()==64,u.free(),h.free();let y=c.add(w.VertexFormat.getPositionF2(),i()-64,4);p.area.byteOffset()==0,f.area.byteOffset()==32,y.area.byteOffset()==64,c.pool.totalVRAM()==i(),c.context.buffers.length==1;let g=c.context.buffers[0];p.check(g),f.check(g),y.check(g)}d.testStrideBugFig5426=r;class o{constructor(p,u){this._context=null,this._byteCount=0,this._bytes=null,this._context=p,this._byteCount=u,this._bytes=new Uint8Array(u)}context(){return this._context}bytes(){return this._bytes}byteCount(){return this._byteCount}move(p,u,h){h>=0,0<=p&&p+h<=this._byteCount,0<=u&&u+h<=this._byteCount,p!=u&&h!=0&&this._bytes.set(this._bytes.subarray(p,p+h),u)}upload2(p,u){0<=u&&u+p.length<=this._byteCount,this._bytes.set(p,u)}prepare(){}}d.VertexBuffer=o;class a{createVertexBuffer(p){let u=new o(this,p);return this.buffers.push(u),u}addContextResetHandler(p){}beginFrame(){}clear2(p,u){}createMaterial(p,u,h,f){return null}createTexture2(p,u,h,f,y){return null}createTexture3(p,u,h){return null}createFramebuffer(p,u,h){return null}currentFramebuffer(){return null}currentStencilState(){return null}currentBlendState(){return null}draw(p,u,h){}endFrame(){}flush(){}getNumFramebufferSwitches(){return 0}height(){return 0}maxTextureSize(){return 4096}removeContextResetHandler(p){}resize(p,u){return new w.ComputedCanvasSize(new I(p,u),!1)}setBlendState(p){}readPixels(p,u,h,f,y){return null}resetNumFramebufferSwitches(){}bindWebGLFramebufferAndTrackForBudget(p){}setStencilState(p){}setFramebuffer(p){}setViewport(p,u,h,f){}width(){return 0}annotate(p,u){u()}annotateAndReturn(p,u){return u()}annotateProfile(p,u){u()}setScissor(p){}isContextLost(){return!1}graphicsCardName(){return"Unknown"}setMaximumDrawingBufferSizeForTesting(p){}clearMaximumDrawingBufferSizeForTesting(){}hasLoggedHighpPrecisionUnsupported(){return!0}setHasLoggedHighpPrecisionUnsupported(){}constructor(){this.buffers=[]}}d.Context=a;class s{free(){this.area.free(),this.area.wasFreed()}check(p){for(let u=0,h=this.bytes.length;u<h;u=u+1)p.bytes()[this.area.byteOffset()+u]==this.bytes[u]}constructor(p,u){this.bytes=p,this.area=u}}d.Result=s;class l{constructor(){this.context=new a,this.pool=null,this.pool=new w.BufferPool(this.context)}add(p,u,h){let f=new Uint8Array(u);f[0]=h*2+1,f[f.length-1]=h*2+2;let y=this.pool.allocate(p,f);return y!=null,y.byteCount()==u,y.wasFreed(),new s(f,y)}}d.Helper=l})(Tf||(Tf={}));var Id=class{constructor(e){this._scene=null,this._watchedNodeIDs=new Map,this.onChangeCallback=null,e.addAppObserver(this)}watchNodesWithIDs(e){this._watchedNodeIDs=new Map;for(let t of e)this._watchedNodeIDs.set(t,!0)}handleSceneChange(e,t){this._scene=t,e!=null&&e.removeObserver(this),t!=null&&t.addObserver(this),this.onChangeCallback!=null&&this.onChangeCallback()}handleActiveCanvasChange(e,t){}handleActivePrototypeStartingPointChange(e,t){}_isWatchedNode(e){return this._watchedNodeIDs.has(e)}_isAncestorOrSelfOfWatchedNode(e){for(let t of Array.from(this._watchedNodeIDs.keys())){let n=this._scene.findNode2(t);for(let r=n;r!=null;r=r.parent())if(ee.equals(r.id(),e))return!0}return!1}handleSceneGraphEvent(e){let t=!1;if(e.property==25){let n=e.oldVal!=null&&Ze.isParentIndex(e.oldVal)?Ze.asParentIndex(e.oldVal):null,r=e.newVal!=null&&Ze.isParentIndex(e.newVal)?Ze.asParentIndex(e.newVal):null;(n==null||r==null||n.id!=r.id)&&(t=this._isAncestorOrSelfOfWatchedNode(e.node.id()))}else e.property==24?t=this._isAncestorOrSelfOfWatchedNode(e.node.id()):(e.property==49||e.property==88)&&(t=this._isWatchedNode(e.node.id()));t&&this.onChangeCallback!=null&&this.onChangeCallback()}};var Os=class i{toJSON(){let e={nodeId:this.nodeId};return this.nodeOffset!=null&&(e.nodeOffset={x:this.nodeOffset.x(),y:this.nodeOffset.y()}),this.canvasPosition!=null&&(e.canvasPosition={x:this.canvasPosition.x(),y:this.canvasPosition.y()}),e}static fromJSON(e){let t=null,n=null,r=null;return e.nodeId!==null&&e.nodeId!==void 0&&(t=ee.fromString(e.nodeId)),e.nodeOffset!==null&&e.nodeOffset!==void 0&&(n=new I(e.nodeOffset.x,e.nodeOffset.y)),e.canvasPosition!==null&&e.canvasPosition!==void 0&&(r=new I(e.canvasPosition.x,e.canvasPosition.y)),new i(t,n,r)}constructor(e,t,n){this.nodeId=e,this.nodeOffset=t,this.canvasPosition=n}},Ed=class{constructor(e){this._appState=null,this._boundsWatcher=null,this._shouldNotifyCommentPositionsChanged=!1,this._nodesWithComments=[],this.notifyCommentPositionsChange=null,this._appState=e,this._boundsWatcher=new Id(e),this._boundsWatcher.onChangeCallback=()=>{this._shouldNotifyCommentPositionsChanged=!0},this._appState.addAppObserver(this),this._appState.addFrameObserver(this),this._appState.prototypeState().addObserver(this)}setNodesWithComments(e){this._boundsWatcher.watchNodesWithIDs(e),this._nodesWithComments=e}onFrame(){this._shouldNotifyCommentPositionsChanged&&(this.notifyCommentPositionsChange!=null&&this.notifyCommentPositionsChange(),this._shouldNotifyCommentPositionsChanged=!1)}handleSceneChange(e,t){this._shouldNotifyCommentPositionsChanged=!0}handleActiveCanvasChange(e,t){this._shouldNotifyCommentPositionsChanged=!0}handleActivePrototypeStartingPointChange(e,t){}_isAncestorOrSelfOfNodeWithComment(e){let t=this._appState.scene();if(t==null)return!1;for(let n of this._nodesWithComments){let r=t.findNode1(n);for(let o=r;o!=null;o=o.parent()){let a=o.id();if(ee.equals(a,e))return!0}}return!1}handleStateChangeAborted(e){this.handlePresentedStateChange(e)}handleStateChangeCommitted(e,t){this.handlePresentedStateChange(e)}handleStateChangeInitiated(e){this.handlePresentedStateChange(e)}handleStateChangeRequested(e){}handlePresentedStateChange(e){if(e==null||this._shouldNotifyCommentPositionsChanged)return;if(this._isAncestorOrSelfOfNodeWithComment(e.oldStateAndOverlays.stateId)){this._shouldNotifyCommentPositionsChanged=!0;return}let t=e.oldStateAndOverlays.overlays;for(let r=0,o=t.length;r<o;r=r+1){let a=t[r].id;if(this._isAncestorOrSelfOfNodeWithComment(a)){this._shouldNotifyCommentPositionsChanged=!0;return}}if(this._isAncestorOrSelfOfNodeWithComment(e.newStateAndOverlays.stateId)){this._shouldNotifyCommentPositionsChanged=!0;return}let n=e.newStateAndOverlays.overlays;for(let r=0,o=n.length;r<o;r=r+1){let a=n[r].id;if(this._isAncestorOrSelfOfNodeWithComment(a)){this._shouldNotifyCommentPositionsChanged=!0;return}}}handleFitModeChange(e,t){}handleRestartPrototype(){}getCommentDestinationAtPosition(e){let t=this._appState.scene();if(t==null)return null;let n=this._appState.baseScreenNode();if(n==null)return null;let r=this._appState.prototypeState().getCurrentOverlays();for(let a=r.length-1;a>=0;a=a-1){let s=t.findNode1(r[a].id());if(s==null)continue;let l=r[a].renderedBounds(n);if(l.contains2(e)){let d=e.subtract1(l.topLeft());return new Os(s.id(),d,null)}}let o=e.subtract1(n.canvasSpaceBoundingBox().topLeft());return new Os(n.id(),o,null)}_currentCommentsScreen(){return this._appState.prototypeState().getTopmostScreen()}_currentCommentsScreenRenderedBounds(){let e=this._appState.baseScreenNode(),t=this._appState.prototypeState().getTopmostOverlay();return e!=null&&t!=null?t.renderedBounds(e):e==null?void 0:e.canvasSpaceBoundingBox()}getCanvasSpaceCommentLocations(e,t){let n={};for(let r of Array.from(t.keys())){let o=t.get(r),a=e.findNode1(o.nodeId),s=this._currentCommentsScreen(),l=this._currentCommentsScreenRenderedBounds();if(a==null||s==null||l==null)continue;let d=!1;if(d=s.isAncestorOf(a),!d)continue;let c=a.canvasSpaceScrolledBounds(1).topLeft().subtract1(s.canvasSpaceBoundingBox().topLeft()),u=l.topLeft().add1(c).add1(o.nodeOffset),h={};h.x=u.x(),h.y=u.y(),n[r]=h}return n}};var fh;(y=>{function i(g,A){let T=new Wn("NONZERO",0,Et.forCenterStrokeAroundRect(g,A),g);return new Vn([T],null,T.bounds(),null)}y.strokeGeometryForRect=i;function e(g,A){if(Math.abs(E.redF(g)-E.redF(A))+Math.abs(E.greenF(g)-E.greenF(A))+Math.abs(E.blueF(g)-E.blueF(A))+Math.abs(E.alphaF(g)-E.alphaF(A))>.01)throw new Error(`Colors are too different ${E.toString(g)} ${E.toString(A)}`)}y.assertColorRoughlyEquals=e;function t(g,A,T){let b=lT(g);return b.setTestOnlyFillPaints([ie.createSolid(E.BLACK,T)]),b.setTestOnlyFillGeometry(pT(A)),We(b,b.fillGeometry().bounds.topLeft(),b.fillGeometry().bounds.size()),b}y.createStaticVectorWithMultipleRegions=t;function n(g,A,T,b){g.setTestOnlyFillPaints([ie.createSolid(E.BLACK,1)]),f.GeometryType_hasFill(A)&&g.setTestOnlyFillGeometry(Jo(T)),f.GeometryType_hasStroke(A)&&(g.setTestOnlyStrokeGeometry(i(T,b)),g.setStrokeWeight(b)),We(g,T.topLeft(),T.size())}y.addPaintsAndGeometry=n;function r(g,A,T,b){let _=Fr(g);return n(_,A,T,b),_}y.createRectangleWithPaintsAndGeometry1=r;function o(g,A,T){return r(g,A,T,1)}y.createRectangleWithPaintsAndGeometry2=o;function a(g,A,T,b,_){let m=cT(g,A);return n(m,T,b,_),m}y.createRoundedRectangleWithPaintsAndGeometry1=a;function s(g,A,T,b){return a(g,A,T,b,1)}y.createRoundedRectangleWithPaintsAndGeometry2=s;function l(g,A){let T=Fr(g);T.setTestOnlyFillPaints([ie.createSolid(E.BLACK,1)]);let b=A.topLeft().x(),_=A.topLeft().y(),m=A.width(),S=A.height(),v=new Wn("NONZERO",0,Et.new2().moveTo1(b,_).lineTo(b+m,_).lineTo(b+m,_+S).lineTo(b,_+S-1).close(),A),C=new Vn([v],null,v.bounds(),null);return T.setTestOnlyFillPaints([ie.createSolid(E.BLACK,1)]),T.setTestOnlyFillGeometry(C),T.setTestOnlyStrokeGeometry(C),We(T,A.topLeft(),A.size()),T}y.createNonRectangleInNode=l;function d(g,A,T){let b=g.canvasSpaceBoundingBox();switch(T){case"INSIDE":case"OUTSIDE":{g.setTestOnlyStrokeGeometry(i(b,A*2));break}case"CENTER":{g.setTestOnlyStrokeGeometry(i(b,A));break}}g.setStrokeAlign(T)}y.setStrokeForRect=d;function c(){let g=AssertLib.deepStrictEqual,A=new _a("./src/test/rendertree.test.sk");Ft("generateRenderTree",()=>{let T=null,b=null,_=()=>{T=gt.createSceneWithCanvasForTests1(),b=T.root().childAt1(0),b.setPrototypeDevice(Tr.DEFAULT)};beforeEach(_),Te("simple rect",()=>{let m=o(b,0,new G(0,0,100,100));return A.asyncAssertMatchesSnapshot("should emit single fill",m.renderTree1().debugString1())}),Te("simple rounded rect",()=>{let m=s(b,10,0,new G(0,0,100,100));return A.asyncAssertMatchesSnapshot("should emit single rounded rect fill",m.renderTree1().debugString1())}),Te("rounded rect symbol",()=>{let m=ci(b);return n(m,0,new G(0,0,100,100),0),m.setContainerSupportsFillStrokeAndCorners(!0),m.setIsFrameMaskDisabled(!0),m.setCornerRadius(10),A.asyncAssertMatchesSnapshot("symbol should emit rounded rect fill",m.renderTree1().debugString1())}),Te("rounded rect instance",()=>{let m=ci(b),S=Ga(b,m);return n(S,0,new G(0,0,100,100),0),S.setContainerSupportsFillStrokeAndCorners(!0),S.setIsFrameMaskDisabled(!0),S.setCornerRadius(10),A.asyncAssertMatchesSnapshot("instance should emit rounded rect fill",S.renderTree1().debugString1())}),ds("simple vector with multiple regions",()=>{let m=[],S=t(b,[new G(0,0,10,10),new G(20,20,10,10)],.5);m.push(A.asyncAssertMatchesSnapshot("should emit single fill",S.renderTree1().debugString1()));let v=t(b,[new G(0,0,10,10),new G(5,5,10,10)],.5);return m.push(A.asyncAssertMatchesSnapshot("should emit multiple fills",v.renderTree1().debugString1())),Promise.all(m)}),Te("multiply blend mode",()=>{let m=o(b,0,new G(0,0,100,100));return m.setBlendMode("MULTIPLY"),A.asyncAssertMatchesSnapshot("should emit fill with blend mode",m.renderTree1().debugString1())}),Te("foreground blur",()=>{let m=o(b,0,new G(0,0,100,100));return m.setTestOnlyEffects([we.createForegroundBlur(4)]),A.asyncAssertMatchesSnapshot("should emit foreground blur",m.renderTree1().debugString1())}),Te("foreground blur w/ radius zero",()=>{let m=o(b,0,new G(0,0,100,100));return m.setTestOnlyEffects([we.createForegroundBlur(0)]),A.asyncAssertMatchesSnapshot("blur should be ellided",m.renderTree1().debugString1())}),Te("foreground blur disabled",()=>{let m=o(b,0,new G(0,0,100,100)),S=we.createForegroundBlur(4);return S.setIsEnabled(!1),m.setTestOnlyEffects([S]),A.asyncAssertMatchesSnapshot("blur should be ellided",m.renderTree1().debugString1())}),Te("background blur",()=>{o(b,0,new G(25,25,50,50)).setTestOnlyFillPaints([ie.createSolid(E.RED,1)]);let S=o(b,0,new G(0,0,100,100));return S.setTestOnlyEffects([we.createBackgroundBlur(4)]),A.asyncAssertMatchesSnapshot("blur should be ellided because rect with blur is opaque",S.renderTree1().debugString1())}),Te("background blur on partially transparent node",()=>{let m=Object({viewer_background_blur_opts:!1});Y.updateFeatureFlags(m),o(b,0,new G(25,25,50,50)).setTestOnlyFillPaints([ie.createSolid(E.RED,1)]);let v=o(b,0,new G(0,0,100,100));return v.setTestOnlyFillPaints([ie.createSolid(E.BLACK,.5)]),v.setTestOnlyEffects([we.createBackgroundBlur(4)]),A.asyncAssertMatchesSnapshot("background blur should be emitted",v.renderTree1().debugString1())}),Te("rectangle won't show up in the background blur",()=>{let m=Object({viewer_background_blur_opts:!1});Y.updateFeatureFlags(m),o(b,0,new G(0,0,10,10)).setTestOnlyFillPaints([ie.createSolid(E.RED,1)]);let v=rt(b);v.setTestOnlyFillPaints([ie.createSolid(E.BLACK,.5)]),We(v,new I(0,0),new I(10,10));let C=o(v,0,new G(0,0,10,10));return C.setTestOnlyFillPaints([ie.createSolid(E.GREEN,.5)]),C.setTestOnlyEffects([we.createBackgroundBlur(4)]),A.asyncAssertMatchesSnapshot("red rectangle should not show up in the background blur",v.renderTree1().debugString1())}),Ft("scrolling frames",()=>{Te("wrap scrollable layers in a volatile property binding",()=>{let m=rt(b);return m.setOverflowDirection("VERTICAL"),We(m,new I(0,0),new I(100,100)),o(m,0,new G(0,0,100,200)).setTestOnlyFillPaints([ie.createSolid(E.RED,1)]),A.asyncAssertMatchesSnapshot("red fill should be in volatile property binding",m.renderTree1().debugString1())}),Te("wrap scrollable layers with non-isolated blends with a group",()=>{let m=rt(b);m.setOverflowDirection("VERTICAL"),We(m,new I(0,0),new I(100,100));let S=o(m,0,new G(0,0,100,200));S.setBlendMode("MULTIPLY"),S.setTestOnlyFillPaints([ie.createSolid(E.RED,1)]);let v=m.renderTree1();return A.asyncAssertMatchesSnapshot("red rectangle should be wrapped with a group",v.debugString1())}),ds("fixed layers and their descendants should be re-positioned",()=>{let m=[];b.setPrototypeDevice(new Tr("CUSTOM",new I(100,100),"","NONE"));let S=rt(b);We(S,new I(0,0),new I(100,500));let v=rt(S);return v.setScrollBehavior("FIXED_WHEN_CHILD_OF_SCROLLING_FRAME"),v.setVerticalConstraint("MAX"),We(v,new I(0,400),new I(100,100)),o(v,0,new G(0,0,100,100)).setTestOnlyFillPaints([ie.createSolid(E.RED,1)]),m.push(A.asyncAssertMatchesSnapshot("Red square should NOT be culled because the screen is 100 x 500",S.renderTree1().debugString1())),m.push(A.asyncAssertMatchesSnapshot("Red square should NOT be culled even though the screen is 100 x 100 because it is a fixed footer that was repositioned to be in in the screen",S.renderTreeForBaseScreen1().debugString1())),v.setScrollBehavior("SCROLLS"),m.push(A.asyncAssertMatchesSnapshot("Red square SHOULD be culled because the screen is 100 x 100 and the footer is not fixed",S.renderTreeForBaseScreen1().debugString1())),Promise.all(m)}),Te("do not wrap fixed layers in a volatile property binding",()=>{let m=rt(b);m.setOverflowDirection("VERTICAL"),We(m,new I(0,0),new I(100,100));let S=rt(m);return S.setTestOnlyFillPaints([ie.createSolid(E.GREEN,1)]),S.setScrollBehavior("FIXED_WHEN_CHILD_OF_SCROLLING_FRAME"),o(m,0,new G(0,50,100,150)).setTestOnlyFillPaints([ie.createSolid(E.RED,1)]),A.asyncAssertMatchesSnapshot("red fill should be in volatile property binding; green fill should not",m.renderTree1().debugString1())}),Te("Background blur trees should not cull scrollable content",()=>{let m=Object({viewer_background_blur_opts:!1});Y.updateFeatureFlags(m);let S=rt(b);S.setOverflowDirection("VERTICAL"),We(S,new I(0,0),new I(100,100)),S.setTestOnlyFillPaints([ie.createSolid(E.BLACK,1)]);let v=o(S,0,new G(0,150,100,100));We(v,new I(150,0),new I(100,101)),v.setTestOnlyFillPaints([ie.createSolid(E.GREEN,1)]);let C=o(S,0,new G(0,0,100,100));return C.setScrollBehavior("FIXED_WHEN_CHILD_OF_SCROLLING_FRAME"),We(C,new I(0,0),new I(100,100)),C.setTestOnlyFillPaints([ie.createSolid(E.RED,.5)]),C.setTestOnlyEffects([we.createBackgroundBlur(4)]),A.asyncAssertMatchesSnapshot("blur node should contain green fill",S.renderTree1().optimized().debugString1())}),["FRAME","GROUP"].forEach(m=>{Te(`Background blur inside ${m} in scrolling content should contain transformed scrolling siblings`,()=>{let S=Object({viewer_background_blur_opts:!1});Y.updateFeatureFlags(S);let v=rt(b);v.setOverflowDirection("VERTICAL"),We(v,new I(0,0),new I(100,100)),v.setTestOnlyFillPaints([ie.createSolid(E.BLACK,1)]);let C=m=="FRAME"?rt(v):li(v),N=o(C,0,new G(0,0,100,101));We(N,new I(0,0),new I(100,101)),N.setTestOnlyFillPaints([ie.createSolid(E.GREEN,1)]);let x=o(C,0,new G(0,0,100,100));return We(x,new I(0,0),new I(100,100)),x.setTestOnlyFillPaints([ie.createSolid(E.RED,.5)]),x.setTestOnlyEffects([we.createBackgroundBlur(4)]),We(C,new I(0,0),new I(100,101)),A.asyncAssertMatchesSnapshot("blur node should contain transformed green fill",v.renderTree1().optimized().debugString1())})}),Te("calling .renderTree on a frame should NOT make it scrollable by default",()=>{b.setCurrentViewportSize(new I(100,50));let m=rt(b);return We(m,new I(0,0),new I(100,100)),o(m,0,new G(0,0,100,100)).setTestOnlyFillPaints([ie.createSolid(E.RED,1)]),A.asyncAssertMatchesSnapshot("VOLATILE_PROPERTY_BINDING should NOT be present",m.renderTree1().debugString1())}),Te("calling .renderTreeForBaseScreen on a frame should make it scrollable by default",()=>{b.setCurrentViewportSize(new I(100,50));let m=rt(b);return We(m,new I(0,0),new I(100,100)),o(m,0,new G(0,0,100,100)).setTestOnlyFillPaints([ie.createSolid(E.RED,1)]),A.asyncAssertMatchesSnapshot("VOLATILE_PROPERTY_BINDING should be present",m.renderTreeForBaseScreen1().debugString1())})}),Te("drop shadow",()=>{let m=o(b,0,new G(0,0,100,100));return m.setTestOnlyFillPaints([ie.createSolid(E.BLACK,1)]),m.setTestOnlyEffects([we.createDropShadow1(4,new I(0,0),E.BLACK,.25)]),A.asyncAssertMatchesSnapshot("drop shadow should be emitted",m.renderTree1().debugString1())}),Te("two drop shadows",()=>{let m=o(b,0,new G(0,0,100,100));return m.setTestOnlyFillPaints([ie.createSolid(E.BLACK,1)]),m.setTestOnlyEffects([we.createDropShadow1(0,new I(50,50),E.RED,1),we.createDropShadow1(0,new I(-50,-50),E.GREEN,1)]),A.asyncAssertMatchesSnapshot("two drop shadows should be emitted",m.renderTree1().debugString1())}),Te("drop shadow on semi-transparent layer",()=>{let m=o(b,0,new G(0,0,100,100));return m.setTestOnlyFillPaints([ie.createSolid(E.BLACK,1)]),m.setTestOnlyEffects([we.createDropShadow1(4,new I(0,0),E.BLACK,.25)]),m.setOpacity(.5),A.asyncAssertMatchesSnapshot("should be wrapped in blend with 0.5 opacity",m.renderTree1().debugString1())}),Te("drop shadow on clipping frame with visible background paints",()=>{let m=rt(b);We(m,new I(-100,-100),new I(300,300));let S=rt(m);return We(S,new I(0,0),new I(200,200)),S.setTestOnlyFillPaints([ie.createSolid(E.RED,1)]),o(S,0,new G(0,0,100,100)).setTestOnlyFillPaints([ie.createSolid(E.GREEN,1)]),S.setTestOnlyEffects([we.createDropShadow1(4,new I(0,0),E.BLACK,.25)]),A.asyncAssertMatchesSnapshot("shadow tree does not contain rect fill",S.renderTree1().debugString1())}),Te("drop shadow on non-clipping frame with visible background paints",()=>{let m=rt(b);We(m,new I(-100,-100),new I(300,300));let S=rt(m);return We(S,new I(0,0),new I(200,200)),S.setTestOnlyFillPaints([ie.createSolid(E.RED,1)]),S.setIsFrameMaskDisabled(!0),o(S,0,new G(0,0,100,100)).setTestOnlyFillPaints([ie.createSolid(E.GREEN,1)]),S.setTestOnlyEffects([we.createDropShadow1(4,new I(0,0),E.BLACK,.25)]),A.asyncAssertMatchesSnapshot("shadow tree DOES contain rect fill",S.renderTree1().debugString1())}),Te("drop shadow on clipping frame with no background paints",()=>{let m=rt(b);We(m,new I(-100,-100),new I(300,300));let S=rt(m);return We(S,new I(0,0),new I(200,200)),S.setTestOnlyFillPaints([]),o(S,0,new G(0,0,100,100)).setTestOnlyFillPaints([ie.createSolid(E.GREEN,1)]),S.setTestOnlyEffects([we.createDropShadow1(4,new I(0,0),E.BLACK,.25)]),A.asyncAssertMatchesSnapshot("shadow tree DOES contain rect fill; does not contain frame background",S.renderTree1().debugString1())}),Te("drop shadow on clipping frame with no visible background paints",()=>{let m=rt(b);We(m,new I(-100,-100),new I(300,300));let S=rt(m);return We(S,new I(0,0),new I(200,200)),S.setTestOnlyFillPaints([ie.createSolid(E.RED,0)]),o(S,0,new G(0,0,100,100)).setTestOnlyFillPaints([ie.createSolid(E.GREEN,1)]),S.setTestOnlyEffects([we.createDropShadow1(4,new I(0,0),E.BLACK,.25)]),A.asyncAssertMatchesSnapshot("shadow tree DOES contain rect fill; does not contain frame background",S.renderTree1().debugString1())}),Te("drop shadow on clipping frame with visible background paint with transparent area",()=>{let m=ie.createLinearGradient([new $e(E.new3(0,0,0,1),0),new $e(E.new3(0,0,0,0),.5)]),S=rt(b);We(S,new I(-100,-100),new I(300,300));let v=rt(S);return We(v,new I(0,0),new I(200,200)),v.setTestOnlyFillPaints([m]),o(v,0,new G(0,0,100,100)).setTestOnlyFillPaints([ie.createSolid(E.GREEN,1)]),v.setTestOnlyEffects([we.createDropShadow1(4,new I(0,0),E.BLACK,.25)]),A.asyncAssertMatchesSnapshot("shadow tree should contain frame background and rect",v.renderTree1().debugString1())}),Te("drop shadow on clipping frame with inside stroke",()=>{let m=rt(b);We(m,new I(-100,-100),new I(300,300));let S=Rs(m,"frame",[ie.createSolid(E.RED,1)],[ie.createSolid(E.BLACK,1)],new G(0,0,50,50));return We(S,new I(0,0),new I(50,50)),S.setStrokeAlign("INSIDE"),S.setStrokeWeight(4),l(S,new G(0,0,100,100)),S.setTestOnlyEffects([we.createDropShadow1(4,new I(0,0),E.BLACK,.25)]),A.asyncAssertMatchesSnapshot("drop shadow should not be clipped by frame mask",S.renderTree1().debugString1())}),Te("drop shadow on rounded rectangle clipping frame with inside stroke",()=>{let m=rt(b);We(m,new I(-100,-100),new I(300,300));let S=Rs(m,"frame",[ie.createSolid(E.RED,1)],[ie.createSolid(E.WHITE,1)],new G(0,0,50,50));return We(S,new I(0,0),new I(50,50)),S.setStrokeAlign("INSIDE"),S.setStrokeWeight(4),S.setCornerRadius(10),S.setTestOnlyFillGeometry(dT(S.canvasSpaceBoundingBox(),10)),S.setTestOnlyEffects([we.createDropShadow1(4,new I(0,0),E.BLACK,.25)]),A.asyncAssertMatchesSnapshot("drop shadow should be a rounded rect",S.renderTree1().debugString1())}),Te("drop shadow and inner shadow on clipping frame with inside stroke",()=>{let m=rt(b);We(m,new I(-100,-100),new I(300,300));let S=Rs(m,"frame",[ie.createSolid(E.RED,1)],[ie.createSolid(E.BLACK,1)],new G(0,0,50,50));return We(S,new I(0,0),new I(50,50)),S.setTestOnlyFillPaints([ie.createSolid(E.WHITE,1)]),S.setStrokeAlign("INSIDE"),S.setTestOnlyStrokePaints([ie.createSolid(E.RED,1)]),S.setStrokeWeight(4),l(S,new G(0,0,100,100)),S.setTestOnlyEffects([we.createInnerShadow(4,new I(0,0),E.BLACK,.25),we.createDropShadow1(4,new I(0,0),E.BLACK,.25)]),A.asyncAssertMatchesSnapshot("inner shadow should be clipped by frame mask",S.renderTree1().debugString1())}),Te("spread shadow for eligible frame",()=>{let m=rt(b);We(m,new I(0,0),new I(300,300));let S=Ao(m,"frame",ie.createSolid(E.RED,1));return We(S,new I(0,0),new I(50,50)),S.setTestOnlyEffects([we.createDropShadow2(0,new I(0,0),E.BLACK,.25,10)]),A.asyncAssertMatchesSnapshot("should generate shadow with spread for eligible frame: max bounds",`${S.renderTree1().maxBounds}
`)}),Te("no spread shadow for frame with no visible fill paints",()=>{let m=Ao(b,"frame",ie.createSolid(E.RED,0));return We(m,new I(0,0),new I(50,50)),o(m,0,new G(0,0,100,100)).setTestOnlyFillPaints([ie.createSolid(E.BLACK,1)]),m.setTestOnlyEffects([we.createDropShadow2(0,new I(0,0),E.BLACK,.25,10)]),A.asyncAssertMatchesSnapshot("should generate shadow without spread for frame with no visible fill: max bounds",`${m.renderTree1().maxBounds}
`)}),Te("no spread shadow for frame that does not clip",()=>{let m=rt(b);We(m,new I(0,0),new I(300,300));let S=Ao(m,"frame",ie.createSolid(E.RED,1));return We(S,new I(0,0),new I(50,50)),S.setIsFrameMaskDisabled(!0),S.setTestOnlyEffects([we.createDropShadow2(0,new I(0,0),E.BLACK,.25,10)]),A.asyncAssertMatchesSnapshot("should generate shadow without spread for frame with no clipping: max bounds",`${S.renderTree1().maxBounds}
`)}),Te("drop shadow with knockout: translucent node",()=>{let m=o(b,0,new G(0,0,100,100));return m.setTestOnlyFillPaints([ie.createSolid(E.RED,.5)]),m.setTestOnlyEffects([we.createDropShadow3(10,new I(10,0),E.BLACK,.25,5,!1)]),A.asyncAssertMatchesSnapshot("should generate knockout shadow for regular translucent node",m.renderTree1().debugString1())}),Te("drop shadow with knockout: opaque node",()=>{let m=o(b,0,new G(0,0,100,100));return m.setTestOnlyFillPaints([ie.createSolid(E.RED,1)]),m.setTestOnlyEffects([we.createDropShadow3(10,new I(10,0),E.BLACK,.25,5,!1)]),A.asyncAssertMatchesSnapshot("should optimize out knockout shadow for opaque node",m.renderTree1().debugString1())}),Te("drop shadow with knockout: opaque frame",()=>{let m=rt(b);We(m,new I(-100,-100),new I(300,300));let S=Ao(m,"frame",ie.createSolid(E.RED,1));return We(S,new I(0,0),new I(50,50)),S.setIsFrameMaskDisabled(!0),S.setTestOnlyEffects([we.createDropShadow3(10,new I(10,0),E.BLACK,.25,20,!1)]),A.asyncAssertMatchesSnapshot("should optimize out knockout shadow for opaque frame",S.renderTree1().debugString1())}),Te("drop shadow with knockout: node with gradient transparency",()=>{let m=o(b,0,new G(0,0,100,100)),S=ie.createLinearGradient([new $e(E.new3(0,0,0,1),0),new $e(E.new3(0,0,0,0),.3),new $e(E.new3(0,0,0,0),.7),new $e(E.new3(0,0,0,1),.7)]);return m.setTestOnlyFillPaints([S]),m.setTestOnlyEffects([we.createDropShadow3(10,new I(10,0),E.BLACK,.25,5,!1)]),A.asyncAssertMatchesSnapshot("should knockout gradient with transparency",m.renderTree1().debugString1())}),Te("drop shadow with knockout: with effect blend mode",()=>{let m=o(b,0,new G(0,0,100,100));m.setTestOnlyFillPaints([ie.createSolid(E.RED,.5)]);let S=we.createDropShadow3(0,new I(10,0),E.BLACK,.25,5,!1);return S.setBlendMode("DIFFERENCE"),m.setTestOnlyEffects([S]),A.asyncAssertMatchesSnapshot("should generate blend for knockout shadow",m.renderTree1().debugString1())}),Te("drop shadow with knockout: with an inner shadow",()=>{let m=o(b,0,new G(0,0,100,100));return m.setTestOnlyFillPaints([ie.createSolid(E.RED,.5)]),m.setTestOnlyEffects([we.createDropShadow3(10,new I(10,0),E.BLACK,.25,5,!1),we.createInnerShadow(4,new I(5,5),E.BLACK,.25)]),A.asyncAssertMatchesSnapshot("should generate knockout shadow and inner shadow",m.renderTree1().debugString1())}),Te("drop shadow with knockout: with fill/stroke blend modes",()=>{let m=o(b,0,new G(0,0,100,100)),S=ie.createSolid(E.RED,.5);S.setBlendMode("HARD_LIGHT"),m.setTestOnlyFillPaints([S]);let v=ie.createSolid(E.BLUE,.5);return v.setBlendMode("SOFT_LIGHT"),m.setTestOnlyStrokePaints([v]),m.setStrokeWeight(5),m.setStrokeAlign("OUTSIDE"),m.setTestOnlyEffects([we.createDropShadow3(10,new I(10,0),E.BLACK,.25,5,!1)]),A.asyncAssertMatchesSnapshot("should generate fills/strokes with effects correctly (should not nest blends into knockout shadow mask alpha)",m.renderTree1().debugString1())}),Te("drop shadow with knockout: should not render knockout shadow inside bg blur",()=>{let m=Object({viewer_background_blur_opts:!1});Y.updateFeatureFlags(m);let S=Ao(b,"frame",ie.createSolid(E.RED,1));We(S,new I(0,0),new I(50,50));let v=o(b,0,new G(0,0,100,100));return v.setTestOnlyFillPaints([ie.createSolid(E.RED,.5)]),v.setTestOnlyEffects([we.createDropShadow3(10,new I(10,0),E.BLACK,.25,5,!1),we.createBackgroundBlur(10)]),A.asyncAssertMatchesSnapshot("should not render knockout shadow inside bg blur",v.renderTree1().debugString1())}),Te("drop shadow with knockout: with drop shadow that does not overlap node at all",()=>{let m=o(b,0,new G(0,0,100,100));return m.setTestOnlyFillPaints([ie.createSolid(E.RED,.5)]),m.setTestOnlyEffects([we.createDropShadow3(10,new I(200,0),E.BLACK,.25,5,!1)]),A.asyncAssertMatchesSnapshot("should optimize but not cull knockout shadow that does not overlap node",m.renderTree1().debugString1())}),Te("drop shadow with knockout: transparent frame with stroke should have no shadows inside",()=>{let m=rt(b);We(m,new I(-100,-100),new I(300,300));let S=Rs(m,"frame",[ie.createSolid(E.RED,0)],[ie.createSolid(E.BLACK,1)],new G(0,0,50,50));return We(S,new I(0,0),new I(50,50)),S.setTestOnlyEffects([we.createDropShadow3(10,new I(10,0),E.BLACK,1,5,!1)]),A.asyncAssertMatchesSnapshot("should generate knockout shadow for transparent node",S.renderTree1().debugString1())}),Te("inner shadow",()=>{let m=o(b,0,new G(0,0,100,100));return m.setTestOnlyFillPaints([ie.createSolid(E.BLACK,1)]),m.setTestOnlyEffects([we.createInnerShadow(4,new I(0,0),E.BLACK,.25)]),A.asyncAssertMatchesSnapshot("should output inner shadow",m.renderTree1().debugString1())}),Te("two inner shadows",()=>{let m=o(b,0,new G(0,0,100,100));return m.setTestOnlyFillPaints([ie.createSolid(E.BLACK,1)]),m.setTestOnlyEffects([we.createInnerShadow(0,new I(50,50),E.RED,1),we.createInnerShadow(0,new I(-50,-50),E.GREEN,1)]),A.asyncAssertMatchesSnapshot("should output two inner shadows",m.renderTree1().debugString1())}),Te("inner shadow w/ zero blur radius",()=>{let m=o(b,0,new G(0,0,100,100));return m.setTestOnlyFillPaints([ie.createSolid(E.BLACK,1)]),m.setTestOnlyEffects([we.createInnerShadow(0,new I(0,4),E.BLACK,.25)]),A.asyncAssertMatchesSnapshot("should NOT output inner shadow",m.renderTree1().debugString1())}),Te("inner shadow, with outside stroke (mask.alpha HARD_MASK_WITH_COLOR inlines into shader)",()=>{let m=o(b,1,new G(0,0,100,100));return m.setStrokeAlign("OUTSIDE"),m.setTestOnlyFillPaints([ie.createSolid(E.BLACK,1)]),m.setTestOnlyStrokePaints([ie.createSolid(E.WHITE,1)]),m.setTestOnlyEffects([we.createInnerShadow(1,new I(0,4),E.BLACK,.25)]),A.asyncAssertMatchesSnapshot("should have mask without hard mask alpha",m.renderTree1().debugString1())}),Te("semi-transparent rect",()=>{let m=o(b,0,new G(0,0,100,100));return m.setTestOnlyFillPaints([ie.createSolid(E.BLACK,.5)]),m.setOpacity(.5),A.asyncAssertMatchesSnapshot("opacity should be baked into fill paint",m.renderTree1().debugString1())}),Te("simple rect with stroke",()=>{let m=o(b,1,new G(0,0,100,100));return m.setStrokeAlign("INSIDE"),m.setTestOnlyFillPaints([ie.createSolid(E.BLACK,1)]),m.setTestOnlyStrokePaints([ie.createSolid(E.WHITE,1)]),A.asyncAssertMatchesSnapshot("should output FillStroke",m.renderTree1().debugString1())}),Te("rect with stroke and disabled fill should NOT render fill",()=>{let m=o(b,1,new G(0,0,100,100));m.setStrokeAlign("INSIDE");let S=ie.createSolid(E.BLACK,1);return S.setIsEnabled(!1),m.setTestOnlyFillPaints([S]),m.setTestOnlyStrokePaints([ie.createSolid(E.WHITE,1)]),A.asyncAssertMatchesSnapshot("FILL_STROKE should NOT have black fill",m.renderTree1().debugString1())}),Te("background blur with no background",()=>{let m=Object({viewer_background_blur_opts:!0});Y.updateFeatureFlags(m);let S=Ao(b,"frame",ie.createSolid(E.RED,.5));return We(S,new I(0,0),new I(100,100)),S.setTestOnlyEffects([we.createBackgroundBlur(10)]),A.asyncAssertMatchesSnapshot("should not generate a background blur subtree",S.renderTree1().debugString1())}),Te("background blur with no scrolling elements",()=>{let m=Object({viewer_background_blur_opts:!0});Y.updateFeatureFlags(m);let S=Ao(b,"frame",ie.createSolid(E.RED,1));We(S,new I(0,0),new I(100,100));let v=o(b,0,new G(0,0,50,50));return v.setTestOnlyFillPaints([ie.createSolid(E.RED,.5)]),v.setTestOnlyEffects([we.createBackgroundBlur(10)]),A.asyncAssertMatchesSnapshot("should not include an INVERSE_TRANSFORM node",v.renderTree1().debugString1())}),Te("background blur with scroll: foreground and background in clipping frame",()=>{let m=Object({viewer_background_blur_opts:!0});Y.updateFeatureFlags(m);let S=Ao(b,"frame",ie.createSolid(E.RED,1));We(S,new I(0,0),new I(100,100)),S.setOverflowDirection("VERTICAL");let v=Ao(S,"container",ie.createSolid(E.WHITE,1));We(v,new I(0,0),new I(100,500));let C=o(v,0,new G(0,0,50,50));return C.setTestOnlyFillPaints([ie.createSolid(E.RED,.5)]),C.setTestOnlyEffects([we.createBackgroundBlur(10)]),A.asyncAssertMatchesSnapshot("background blur should not include INVERSE_TRANSFORM or scrolling TRANSFORM nodes",C.renderTree1().debugString1())}),Ft("simple stroke-only rect",()=>{let m=null;beforeEach(()=>{_(),m=o(b,1,new G(0,0,100,100)),m.setTestOnlyFillPaints(Ne.EMPTY),m.setTestOnlyStrokePaints([ie.createSolid(E.WHITE,1)])}),Te("inside stroke",()=>(d(m,1,"INSIDE"),A.asyncAssertMatchesSnapshot("should output FillStroke with mode .INSIDE",m.renderTree1().debugString1()))),Te("outside stroke",()=>(d(m,1,"OUTSIDE"),A.asyncAssertMatchesSnapshot("should output FillStroke with mode .OUTSIDE",m.renderTree1().debugString1()))),Te("center stroke",()=>(d(m,1,"CENTER"),A.asyncAssertMatchesSnapshot("should output FillStroke with mode .CENTER",m.renderTree1().debugString1())))}),Ft("Simple tests on non-rects",()=>{Te("simple non-rectangle",()=>{let m=l(b,new G(0,0,100,100));return A.asyncAssertMatchesSnapshot("should be single fill without isRect flag",m.renderTree1().debugString1())}),Te("non-rectangle not clipped by frame",()=>{let m=rt(b);return We(m,new I(0,0),new I(100,100)),m.setTestOnlyFillPaints([ie.createSolid(E.WHITE,1)]),l(m,new G(0,0,99,99)),A.asyncAssertMatchesSnapshot("group with two fills (frame background and non-rect layer)",m.renderTree1().debugString1())}),Te("non-rectangle clipped by frame",()=>{let m=rt(b);return We(m,new I(0,0),new I(50,50)),m.setTestOnlyFillPaints([ie.createSolid(E.WHITE,1)]),l(m,new G(0,0,100,100)),A.asyncAssertMatchesSnapshot("clipping should not be optimized",m.renderTree1().debugString1())})}),Te("grouped single node",()=>{let m=li(b);Ha(m,!1),We(m,new I(0,0),new I(100,100));let S=o(m,0,new G(0,0,100,100));return S.setTestOnlyFillPaints([ie.createSolid(E.BLACK,1)]),A.asyncAssertMatchesSnapshot("group should be ellided since it does not affect rendering",S.renderTree1().debugString1())}),Te("nested groups",()=>{let m=li(b);Ha(m,!1),We(m,new I(0,0),new I(100,100));let S=li(m);Ha(S,!1),We(S,new I(0,0),new I(50,50)),o(S,0,new G(0,0,50,50)).setTestOnlyFillPaints([ie.createSolid(E.BLACK,1)]);let C=li(m);return Ha(C,!1),We(C,new I(50,50),new I(50,50)),o(C,0,new G(0,0,50,50)).setTestOnlyFillPaints([ie.createSolid(E.BLACK,1)]),A.asyncAssertMatchesSnapshot("render tree should contain only 1 group since groups do not affect rendering",m.renderTree1().debugString1())}),Te("flatten nested opacities",()=>{let m=li(b);We(m,new I(0,0),new I(100,100)),m.setOpacity(.8);let S=li(m);We(S,new I(0,0),new I(50,50)),S.setOpacity(.5);let v=o(S,0,new G(0,0,50,50));v.setTestOnlyFillPaints([ie.createSolid(E.BLACK,1)]),v.setOpacity(.5);let C=li(m);We(C,new I(50,50),new I(50,50)),C.setOpacity(.25);let N=o(C,0,new G(0,0,50,50));return N.setTestOnlyFillPaints([ie.createSolid(E.BLACK,1)]),N.setOpacity(.1),A.asyncAssertMatchesSnapshot("opacities for ellided groups should be applied to leaves",m.renderTree1().debugString1())}),Ft("node outside bounds of frame",()=>{let m=null;beforeEach(()=>{_(),m=rt(b),m.setTestOnlyFillPaints([ie.createSolid(E.WHITE,1)]),We(m,new I(0,0),new I(100,100)),o(m,0,new G(110,110,100,100)).setTestOnlyFillPaints([ie.createSolid(E.BLACK,1)])}),Te("without frame clipping",()=>(m.setIsFrameMaskDisabled(!0),A.asyncAssertMatchesSnapshot("there should be two fills; one for the non-clipped rect",m.renderTree1().debugString1()))),Te("with frame clipping",()=>(m.setIsFrameMaskDisabled(!1),A.asyncAssertMatchesSnapshot("there should be on fill; rect was clipped",m.renderTree1().debugString1()))),Ce("with frame clipping and no background color",()=>{m.setIsFrameMaskDisabled(!1),Ha(m,!1),g(m.renderTree1(),null)})}),Ft("frame background",()=>{let m=null;beforeEach(()=>{_(),m=rt(b),m.setTestOnlyFillPaints([ie.createSolid(E.WHITE,1)]),Ha(m,!0),We(m,new I(0,0),new I(100,100))}),Te("with solid paint",()=>(m.setTestOnlyFillPaints([ie.createSolid(E.new3(1,.5,0,1),1)]),A.asyncAssertMatchesSnapshot("frame background fill should be present",b.renderTree1().debugString1()))),Te("with solid paint and blend mode",()=>{let S=ie.createSolid(E.new3(1,.5,0,1),1);return S.setBlendMode("MULTIPLY"),m.setTestOnlyFillPaints([S]),A.asyncAssertMatchesSnapshot("frame background should have MULTIPLY blend mode",b.renderTree1().debugString1())}),Te("with solid paint and blended gradient",()=>{let S=ie.createSolid(E.new3(1,.5,0,1),1),v=ie.createLinearGradient([new $e(E.new3(1,.5,0,1),.25),new $e(E.new3(0,.5,1,1),.75)]);return v.setBlendMode("MULTIPLY"),m.setTestOnlyFillPaints([S,v]),A.asyncAssertMatchesSnapshot("should output solid Fill and blended gradient Fill",b.renderTree1().debugString1())}),Te("with solid paint and blend mode and children",()=>{let S=ie.createSolid(E.new3(1,.5,0,1),1);return S.setBlendMode("MULTIPLY"),m.setTestOnlyFillPaints([S]),o(m,0,new G(0,0,100,100)).setTestOnlyFillPaints([ie.createSolid(E.BLACK,.5)]),A.asyncAssertMatchesSnapshot("should output background and children",b.renderTree1().debugString1())}),Te("with drop shadow and opaque fill",()=>(m.setTestOnlyEffects([we.createDropShadow1(4,new I(0,0),E.BLACK,.25)]),A.asyncAssertMatchesSnapshot("should not output a drop shadow",m.renderTree1().debugString1()))),Te("with drop shadow and no opaque fill",()=>(m.setTestOnlyFillPaints([ie.createSolid(E.WHITE,.5)]),m.setTestOnlyEffects([we.createDropShadow1(4,new I(0,0),E.BLACK,.25)]),A.asyncAssertMatchesSnapshot("should output a drop shadow",m.renderTree1().debugString1())))}),Ft("frame fills for containers supporting fill stroke and corners",()=>{let m=null;beforeEach(()=>{_(),m=rt(b),m.setContainerSupportsFillStrokeAndCorners(!0),m.setTestOnlyFillPaints([ie.createSolid(E.WHITE,1)]),We(m,new I(0,0),new I(100,100))}),Te("with solid paint",()=>(m.setTestOnlyFillPaints([ie.createSolid(E.new3(1,.5,0,1),1)]),A.asyncAssertMatchesSnapshot("frame background fill should be present",b.renderTree1().debugString1()))),Te("with solid paint and blend mode",()=>{let S=ie.createSolid(E.new3(1,.5,0,1),1);return S.setBlendMode("MULTIPLY"),m.setTestOnlyFillPaints([S]),A.asyncAssertMatchesSnapshot("frame background should have MULTIPLY blend mode",b.renderTree1().debugString1())}),Te("with solid paint and blended gradient",()=>{let S=ie.createSolid(E.new3(1,.5,0,1),1),v=ie.createLinearGradient([new $e(E.new3(1,.5,0,1),.25),new $e(E.new3(0,.5,1,1),.75)]);return v.setBlendMode("MULTIPLY"),m.setTestOnlyFillPaints([S,v]),A.asyncAssertMatchesSnapshot("should output solid Fill and blended gradient Fill",b.renderTree1().debugString1())}),Te("with solid paint and blend mode and children",()=>{let S=ie.createSolid(E.new3(1,.5,0,1),1);return S.setBlendMode("MULTIPLY"),m.setTestOnlyFillPaints([S]),o(m,0,new G(0,0,100,100)).setTestOnlyFillPaints([ie.createSolid(E.BLACK,.5)]),A.asyncAssertMatchesSnapshot("should output background and children",b.renderTree1().debugString1())}),Te("with inside stroke",()=>{let S=Rs(b,"frame",[ie.createSolid(E.RED,1)],[ie.createSolid(E.BLACK,1)],new G(0,0,50,50));return We(S,new I(0,0),new I(50,50)),S.setContainerSupportsFillStrokeAndCorners(!0),S.setStrokeAlign("INSIDE"),S.setStrokeWeight(4),l(S,new G(0,0,100,100)),A.asyncAssertMatchesSnapshot("should generate a fill render node that is clipped by the frame mask",b.renderTree1().debugString1())}),Te("with outside stroke",()=>{let S=Rs(b,"frame",[ie.createSolid(E.RED,1)],[ie.createSolid(E.BLACK,1)],new G(0,0,50,50));return We(S,new I(0,0),new I(50,50)),S.setContainerSupportsFillStrokeAndCorners(!0),We(S,new I(0,0),new I(50,50)),S.setStrokeAlign("OUTSIDE"),S.setStrokeWeight(4),l(S,new G(0,0,100,100)),A.asyncAssertMatchesSnapshot("should have stroke on top of mask",b.renderTree1().debugString1())})}),Ft("masks",()=>{Te("blend mode of masked content should mark mask and all ancestors as 'hasBlends'",()=>{let m=Object({rounded_mask_optimization:!0,viewer_perf_h2_2023_holdout:!1,viewer_perf_h2_2023_combined:!1});Y.updateFeatureFlags(m);let S=rt(b);return S.setIsBackgroundEnabled(!1),S.setIsFrameMaskDisabled(!0),o(S,0,new G(0,0,10,10)).setIsMask(!0),o(S,0,new G(0,0,100,100)).setBlendMode("MULTIPLY"),A.asyncAssertMatchesSnapshot("all ancestors of rect should have 'hasBlends' flag",b.renderTree1().debugString1())}),Te("small outside strokes should be masked",()=>{let m=Object({rounded_mask_optimization:!0,viewer_perf_h2_2023_holdout:!1,viewer_perf_h2_2023_combined:!1});Y.updateFeatureFlags(m);let S=rt(b);S.setIsBackgroundEnabled(!1),S.setIsFrameMaskDisabled(!0),o(S,0,new G(0,0,100,100)).setIsMask(!0);let C=r(S,1,new G(0,0,100,100),2);return C.setStrokeAlign("OUTSIDE"),C.setTestOnlyFillPaints([ie.createSolid(E.WHITE,1)]),C.setTestOnlyStrokePaints([ie.createSolid(E.BLACK,1)]),A.asyncAssertMatchesSnapshot("optimized RenderTree should mask rect with outside stroke",b.renderTree1().optimized().debugString1())}),Te("mask should be ignored if color is contained within the alpha",()=>{let m=Object({rounded_mask_optimization:!0,viewer_perf_h2_2023_holdout:!1,viewer_perf_h2_2023_combined:!1});Y.updateFeatureFlags(m);let S=rt(b);return S.setIsBackgroundEnabled(!1),S.setIsFrameMaskDisabled(!0),s(S,50,0,new G(0,0,100,100)).setIsMask(!0),s(S,10,0,new G(40,40,20,20)).setTestOnlyFillPaints([ie.createSolid(E.WHITE,1)]),A.asyncAssertMatchesSnapshot("optimized RenderTree should ignore mask as contained",b.renderTree1().optimized().debugString1())}),Te("mask should not ignored if color is not contained within the alpha",()=>{let m=Object({rounded_mask_optimization:!0,viewer_perf_h2_2023_holdout:!1,viewer_perf_h2_2023_combined:!1});Y.updateFeatureFlags(m);let S=rt(b);return S.setIsBackgroundEnabled(!1),S.setIsFrameMaskDisabled(!0),s(S,50,0,new G(0,0,100,100)).setIsMask(!0),s(S,32,0,new G(12,12,76,76)).setTestOnlyFillPaints([ie.createSolid(E.WHITE,1)]),A.asyncAssertMatchesSnapshot("optimized RenderTree should have a mask if alpha does not contain color",b.renderTree1().optimized().debugString1())}),Te("mask should be ignored if color contained within the a rounded rectangular alpha",()=>{let m=Object({rounded_mask_optimization:!0,viewer_perf_h2_2023_holdout:!1,viewer_perf_h2_2023_combined:!1});Y.updateFeatureFlags(m);let S=rt(b);return S.setIsBackgroundEnabled(!1),S.setIsFrameMaskDisabled(!0),s(S,27,0,new G(0,0,100,100)).setIsMask(!0),s(S,32,0,new G(12,12,76,76)).setTestOnlyFillPaints([ie.createSolid(E.WHITE,1)]),A.asyncAssertMatchesSnapshot("optimized RenderTree should not contain a mask if color is contained within a rounded rectangular alpha",b.renderTree1().optimized().debugString1())})}),Ft("rectangle visibility",()=>{let m=null;beforeEach(()=>{_(),m=o(b,0,new G(0,0,100,100)),m.setTestOnlyFillPaints([ie.createSolid(E.BLACK,1)])}),Te("default visible",()=>A.asyncAssertMatchesSnapshot("should output single fill",m.renderTree1().debugString1())),Ce("visibility false",()=>{m.setVisible(!1),g(m.renderTree1(),null)}),Ce("layer opacity zero",()=>{m.setOpacity(0),g(m.renderTree1(),null)}),Ce("fill paint opacity zero",()=>{m.setTestOnlyFillPaints([ie.createSolid(E.BLACK,0)]),g(m.renderTree1(),null)}),Ce("no paints",()=>{m.setTestOnlyFillPaints(Ne.EMPTY),g(m.renderTree1(),null)}),Ce("no fill paint, stroke paints, zero stroke width",()=>{let v=r(b,1,new G(0,0,100,100),0);v.setTestOnlyFillPaints(Ne.EMPTY),v.setTestOnlyStrokePaints([ie.createSolid(E.TRANSPARENT,0)]),g(v.renderTree1(),null)})}),Ft("solid paints",()=>{let m=null;beforeEach(()=>{_(),m=o(b,0,new G(0,0,100,100))}),Te("normal",()=>(m.setTestOnlyFillPaints([ie.createSolid(E.new3(1,.5,0,1),1)]),A.asyncAssertMatchesSnapshot("should output fill with opacity=1",m.renderTree1().debugString1()))),Te("50% opacity",()=>(m.setTestOnlyFillPaints([ie.createSolid(E.new3(1,.5,0,1),.5)]),A.asyncAssertMatchesSnapshot("should output fill with opacity=0.5",m.renderTree1().debugString1()))),Ce("0% opacity",()=>{m.setTestOnlyFillPaints([ie.createSolid(E.new3(1,.5,0,1),0)]),g(m.renderTree1(),null)}),Ce("disabled",()=>{let S=ie.createSolid(E.new3(1,.5,0,1),1);S.setIsEnabled(!1),m.setTestOnlyFillPaints([S]),g(m.renderTree1(),null)}),Te("multiply blend",()=>{let S=ie.createSolid(E.new3(1,.5,0,1),1);return S.setBlendMode("MULTIPLY"),m.setTestOnlyFillPaints([S]),A.asyncAssertMatchesSnapshot("should output Blend with Fill child",m.renderTree1().debugString1())})}),Ft("gradient paints",()=>{let m=null;beforeEach(()=>{_(),m=o(b,0,new G(0,0,100,100))}),Te("linear",()=>{let S=ie.createLinearGradient([new $e(E.new3(1,.5,0,1),.25),new $e(E.new3(0,.5,1,1),.75)]);return m.setTestOnlyFillPaints([S]),A.asyncAssertMatchesSnapshot("should output Fill with linear gradient paint",m.renderTree1().debugString1())}),Te("radial",()=>{let S=ie.createRadialGradient([new $e(E.new3(1,.5,0,1),.25),new $e(E.new3(0,.5,1,1),.75)]);return m.setTestOnlyFillPaints([S]),A.asyncAssertMatchesSnapshot("should output Fill with radial gradient paint",m.renderTree1().debugString1())}),Te("angular",()=>{let S=ie.createAngularGradient([new $e(E.new3(1,.5,0,1),.25),new $e(E.new3(0,.5,1,1),.75)]);return m.setTestOnlyFillPaints([S]),A.asyncAssertMatchesSnapshot("should output Fill with angular gradient paint",m.renderTree1().debugString1())}),Te("diamond",()=>{let S=ie.createDiamondGradient([new $e(E.new3(1,.5,0,1),.25),new $e(E.new3(0,.5,1,1),.75)]);return m.setTestOnlyFillPaints([S]),A.asyncAssertMatchesSnapshot("should output Fill with diamond gradient paint",m.renderTree1().debugString1())}),Te("50% opacity",()=>{let S=ie.createLinearGradient([new $e(E.new3(1,.5,0,1),.25),new $e(E.new3(0,.5,1,1),.75)]);return S.setOpacity(.5),m.setTestOnlyFillPaints([S]),A.asyncAssertMatchesSnapshot("should output linear gradient with 50% opacity",m.renderTree1().debugString1())}),Ce("0% opacity",()=>{let S=ie.createLinearGradient([new $e(E.new3(1,.5,0,1),.25),new $e(E.new3(0,.5,1,1),.75)]);S.setOpacity(0),m.setTestOnlyFillPaints([S]),g(m.renderTree1(),null)}),Ce("disabled",()=>{let S=ie.createLinearGradient([new $e(E.new3(1,.5,0,1),.25),new $e(E.new3(0,.5,1,1),.75)]);S.setIsEnabled(!1),m.setTestOnlyFillPaints([S]),g(m.renderTree1(),null)}),Te("40% stop opacity",()=>{let S=ie.createLinearGradient([new $e(E.new3(1,.5,0,.4),.25),new $e(E.new3(0,.5,1,.6),.75)]);return m.setTestOnlyFillPaints([S]),A.asyncAssertMatchesSnapshot("should output linear gradient with partial opacity stops",m.renderTree1().debugString1())}),Ce("0% stop opacity",()=>{let S=ie.createLinearGradient([new $e(E.new3(1,.5,0,0),.25),new $e(E.new3(0,.5,1,0),.75)]);m.setTestOnlyFillPaints([S]),g(m.renderTree1(),null)}),Te("transform",()=>{let S=ie.createLinearGradient([new $e(E.new3(1,.5,0,1),.25),new $e(E.new3(0,.5,1,1),.75)]);S.setTransform1(new ne(.5,-.5,1,-1,1.5,-1.5)),m.setTestOnlyFillPaints([S]);let v=m.renderTree1();g(v.op(),3);let N=v.geometry.paints;return g(N,m.fillPaints()),A.asyncAssertMatchesSnapshot("should output linear gradient",m.renderTree1().debugString1())})}),Te("geometry",()=>{let m=Pr(b,"VECTOR");m.setTestOnlyFillPaints([ie.createSolid(E.BLACK,1)]);let S=new G(0,0,100,100),v=new Wn("ODD",0,Et.new2().moveTo1(0,0).lineTo(100,0).lineTo(50,100).close(),S),C=new Wn("NONZERO",0,Et.new2().moveTo1(0,100).lineTo(100,100).lineTo(50,0).close(),S);m.setTestOnlyFillGeometry(new Vn([v,C],null,S,null));let N=m.renderTree1();g(N.op(),1);let x=N;return g(x.children.length,2),g(x.children[0].op(),3),g(x.children[1].op(),3),g(x.children[0].geometry.path().windingRule(),"ODD"),g(x.children[1].geometry.path().windingRule(),"NONZERO"),A.asyncAssertMatchesSnapshot("should output a group with two fills",m.renderTree1().debugString1())})}),Ft("RenderTree optimization of PaintData",()=>{Ce("dual-color gradient",()=>{let T=[ie.createLinearGradient([new $e(E.new3(0,.5,1,1),0),new $e(E.new3(1,.5,0,1),1)])],b=Ne.optimize(T);g(b.length,1),g(b[0].type(),"GRADIENT_LINEAR")}),Ce("dual-opacity gradient",()=>{let T=[ie.createLinearGradient([new $e(E.new3(1,.5,0,0),0),new $e(E.new3(1,.5,0,1),1)])],b=Ne.optimize(T);g(b.length,1),g(b[0].type(),"GRADIENT_LINEAR")}),Ce("single-color gradient",()=>{let T=[ie.createLinearGradient([new $e(E.new3(1,.5,0,1),0),new $e(E.new3(1,.5,0,1),1)])],b=Ne.optimize(T);g(b.length,1),g(b[0].type(),"SOLID")}),Ce("solid underneath dual-color gradient",()=>{let T=[ie.createSolid(E.GREEN,1),ie.createLinearGradient([new $e(E.new3(0,0,1,.5),0),new $e(E.new3(1,0,0,.5),1)])],b=Ne.optimize(T);g(b.length,1),g(b[0].type(),"GRADIENT_LINEAR"),b[0].asSinglePaint()!=null;let _=b[0].asSinglePaint().colorStops()[0],m=b[0].asSinglePaint().colorStops()[1];g(_.position,0),e(_.color,E.new3(0,.5,.5,1)),g(m.position,1),e(m.color,E.new3(.5,.5,0,1))}),Ce("solid underneath single-color gradient",()=>{let T=[ie.createSolid(E.GREEN,1),ie.createLinearGradient([new $e(E.new3(1,0,0,.5),0),new $e(E.new3(1,0,0,.5),1)])],b=Ne.optimize(T);g(b.length,1),g(b[0].type(),"SOLID"),e(b[0].asSinglePaint().color(),E.new3(.5,.5,0,1))})}),Ft("RenderTree.isRect",()=>{let T=_=>{g(new Pt(_,"ODD").isRect(),!0)},b=_=>{g(new Pt(_,"ODD").isRect(),!1)};Ce("RenderTree.isRect",()=>{T(Et.new2().lineTo(10,0).lineTo(10,5).lineTo(0,5)),T(Et.new2().lineTo(10,0).lineTo(10,5).lineTo(0,5).lineTo(0,0)),T(Et.new2().lineTo(10,0).lineTo(10,5).lineTo(0,5).lineTo(0,0).close()),T(Et.new2().moveTo1(0,0).lineTo(10,0).lineTo(10,5).lineTo(0,5).close()),T(Et.new2().moveTo1(0,0).lineTo(10,0).lineTo(10,5).lineTo(0,5).lineTo(0,0).close()),b(Et.new2().moveTo1(10,0).lineTo(10,5).lineTo(0,5)),b(Et.new2().moveTo1(10,0).lineTo(0,0).lineTo(10,5).lineTo(0,5).close()),b(Et.new2().quadraticTo(10,0,10,5).lineTo(0,5)),b(Et.new2().lineTo(10,0).quadraticTo(10,5,0,5)),b(Et.new2().cubicTo1(10,0,10,5,0,5));let m=gt.createSceneWithCanvasForTests1().root().childAt1(0),S=o(m,0,new G(0,0,100,100));g(S.renderTree1()!=null,!0),g(S.renderTree1().isRectFill(),!0)})}),Ft("RenderTree optimization of Group nodes",()=>{let T=null;beforeEach(()=>{let b=new nn(new Pt(Nt.fromRect(new G(0,0,1,1)),"ODD"),[ie.createSolid(E.BLACK,1)]);T=new kn(ne.new2(),b,I.new2())}),Ce("empty group",()=>{g(new ze([]).optimized(),null)}),Ce("empty nested group",()=>{g(new ze([new ze([])]).optimized(),null)}),Te("single group",()=>A.asyncAssertMatchesSnapshot("should be fill only; no groups",new ze([T]).optimized().debugString1())),Te("single nested group",()=>A.asyncAssertMatchesSnapshot("should be fill only; no groups",new ze([new ze([T])]).optimized().debugString1())),Te("double group",()=>A.asyncAssertMatchesSnapshot("group with two fill children can't be optimized",new ze([T,T]).optimized().debugString1())),Te("double nested group 1",()=>A.asyncAssertMatchesSnapshot("outer group should be optimized away, leaving a group with two fill children",new ze([new ze([T,T])]).optimized().debugString1())),Te("double nested group 2",()=>A.asyncAssertMatchesSnapshot("inner groups should be optimized away, leaving a group with two fill children",new ze([new ze([T]),new ze([T])]).optimized().debugString1()))}),Ft("RenderTree optimization of Dissolve",()=>{let T=null,b=null,_=(m,S)=>new dr(m,S,"A",()=>1).optimized();beforeEach(()=>{let m=new nn(new Pt(Nt.fromRect(new G(0,0,1,1)),"ODD"),[ie.createSolid(E.BLACK,1)]);T=new kn(ne.new2(),m,I.new2());let S=new nn(new Pt(Nt.fromRect(new G(0,0,1,1)),"ODD"),[ie.createSolid(E.RED,1)]);b=new kn(ne.new2(),S,I.new2())}),Ce("both subtrees null",()=>{g(_(null,null),null)}),Te("old subtree null",()=>A.asyncAssertMatchesSnapshot("dissolve should be optimized into volatile opacity because old subtree is null",_(null,T).debugString1())),Te("new subtree null",()=>A.asyncAssertMatchesSnapshot("dissolve should be optimized into volatile opacity because new subtree is null",_(T,null).debugString1())),Te("identical subtrees",()=>A.asyncAssertMatchesSnapshot("dissolve should be optimized away entirely because subtrees are identical",_(T,T).debugString1())),Te("different subtrees",()=>A.asyncAssertMatchesSnapshot("dissolve should not be optimized away",_(T,b).debugString1()))}),Ft("RenderTree optimization of Fill",()=>{Ce("fill with zero opacity paint",()=>{g(new kn(ne.new2(),new nn(new Pt(Nt.fromRect(new G(0,0,1,1)),"ODD"),[ie.createSolid(E.BLACK,0)]),I.new2()).optimized(),null)}),Ce("fill with disabled paint",()=>{g(new kn(ne.new2(),new nn(new Pt(Nt.fromRect(new G(0,0,1,1)),"ODD"),[ie.create("SOLID",1,"NORMAL",!1,E.BLACK)]),I.new2()).optimized(),null)}),Ce("fill with empty bounds",()=>{g(new kn(ne.new2(),new nn(new Pt(Nt.fromRect(new G(0,0,0,0)),"ODD"),[ie.createSolid(E.BLACK,1)]),I.new2()).optimized(),null)})}),Ft("RenderTree optimization of Blur",()=>{let T=null;beforeEach(()=>{let b=new nn(new Pt(Nt.fromRect(new G(0,0,1,1)),"ODD"),[ie.createSolid(E.BLACK,1)]);T=new kn(ne.new2(),b,I.new2())}),Te("zero radius blur",()=>A.asyncAssertMatchesSnapshot("should contain no Blur node",new Jr(0,T,G.INVALID).optimized().debugString1())),Te("blur wrapping volatile fill",()=>A.asyncAssertMatchesSnapshot("volatile property binding should be OUTSIDE of blur",new Jr(10,at.forTranslation(T,It.forAnimateableTranslation("x"),()=>I.new2()),G.INVALID).optimized().debugString1())),Te("clamp blur wrapping volatile fill",()=>A.asyncAssertMatchesSnapshot("volatile property binding should be INSIDE of blur",new Jr(10,at.forTranslation(T,It.forAnimateableTranslation("x"),()=>I.new2()),new G(0,0,1,1)).optimized().debugString1()))}),Ft("RenderTree optimization of HardMaskWithColor",()=>{let T=null;beforeEach(()=>{let b=new nn(new Pt(Nt.fromRect(new G(0,0,1,1)),"ODD"),[ie.createSolid(E.BLACK,1)]);T=new kn(ne.new2(),b,I.new2())}),Te("hard mask wrapping fill",()=>A.asyncAssertMatchesSnapshot("should be a single Fill",new go(T,E.BLACK).optimized().debugString1())),Te("hard mask wrapping volatile fill",()=>A.asyncAssertMatchesSnapshot("should be a single Fill wrapped by the VolatilePropertyBinding",new go(at.forTranslation(T,It.forAnimateableTranslation("x"),()=>I.new2()),E.BLACK).optimized().debugString1())),Te("hard mask wrapping blend nodes",()=>A.asyncAssertMatchesSnapshot("should be a single Fill",new go(new jr("MULTIPLY",.5,T),E.BLACK).optimized().debugString1()))}),Ft("Stack reverse Z index",()=>{let T=null,b=null,_=()=>{T=gt.createSceneWithCanvasForTests1(),b=T.root().childAt1(0),b.setPrototypeDevice(Tr.DEFAULT)};beforeEach(_),Te("stacking frame without stackReverseZIndex",()=>{let m=et(b,"f");return Vt(m,"c1",E.RED,1),Vt(m,"c2",E.BLUE,1),m.setStackMode("VERTICAL"),m.setStackReverseZIndex(!1),A.asyncAssertMatchesSnapshot("should have non-reversed children",m.renderTree1().debugString1())}),Te("stacking frame with stackReverseZIndex",()=>{let m=et(b,"f");return Vt(m,"c1",E.RED,1),Vt(m,"c2",E.BLUE,1),m.setStackMode("VERTICAL"),m.setStackReverseZIndex(!0),A.asyncAssertMatchesSnapshot("should have reversed children",m.renderTree1().debugString1())}),Te("non-stacking frame without stackReverseZIndex",()=>{let m=et(b,"f");return Vt(m,"c1",E.RED,1),Vt(m,"c2",E.BLUE,1),m.setStackMode("NONE"),m.setStackReverseZIndex(!1),A.asyncAssertMatchesSnapshot("should have non-reversed children",m.renderTree1().debugString1())}),Te("non-stacking frame with stackReverseZIndex",()=>{let m=et(b,"f");return Vt(m,"c1",E.RED,1),Vt(m,"c2",E.BLUE,1),m.setStackMode("NONE"),m.setStackReverseZIndex(!0),A.asyncAssertMatchesSnapshot("should have non-reversed children",m.renderTree1().debugString1())})})}y.testRenderTree=c;function p(){let g=AssertLib.deepStrictEqual;Ce("Reparenting a node should invalidate render trees on both its old and its new parent",()=>{let T=gt.createSceneWithCanvasForTests1().root().childAt1(0),b=rt(T),_=rt(T),m=o(b,0,new G(0,0,100,100)),S=b.renderTree1(),v=_.renderTree1();g(S!=null,!0),g(v!=null,!0),m.setParentIndex(new Gn(ee.invalid(),sn.fromString(""))),_.appendChild(m);let C=b.renderTree1(),N=_.renderTree1();g(C!=S,!0),g(N!=v,!0)})}y.testNodeRenderTree=p;function u(){let g=AssertLib.deepStrictEqual,A=AssertLib.notDeepStrictEqual;Ce("equalWithinBounds works for Group nodes",()=>{let b=gt.createSceneWithCanvasForTests1().root().childAt1(0),_=dn(b,"frame1",E.BLUE),m=dn(b,"frame2",E.BLUE),S=null,v=null,C=()=>{S=_.renderTree1(),v=m.renderTree1()};C(),g(S.equals(v),!0),g(S,v),g(S.equalsWithinBounds(v,new G(15,15,10,10)),!0),g(S.equalsWithinBounds(v,new G(0,0,5,5)),!0);let N=o(_,0,new G(1,1,10,10)),x=o(m,0,new G(0,0,10,10));C(),g(S.equals(v),!1),A(S,v),g(S.equalsWithinBounds(v,new G(15,15,10,10)),!0),g(S.equalsWithinBounds(v,new G(0,0,5,5)),!1);let z=o(_,0,new G(15,15,10,10));C(),g(S.equalsWithinBounds(v,new G(30,30,10,10)),!0),g(S.equalsWithinBounds(v,new G(15,15,10,10)),!1),g(S.equalsWithinBounds(v,new G(0,0,5,5)),!1)}),Ce("equalWithinBounds works with nested masking",()=>{let b=gt.createSceneWithCanvasForTests1().root().childAt1(0),_=dn(b,"frame1",E.BLUE),m=dn(b,"frame2",E.BLUE),S=null,v=null,C=()=>{S=_.renderTree1(),v=m.renderTree1()};C(),g(S.equals(v),!0),g(S,v),g(S.equalsWithinBounds(v,new G(15,15,10,10)),!0),g(S.equalsWithinBounds(v,new G(0,0,5,5)),!0),o(_,0,new G(1,1,10,10)).setIsMask(!0);let x=o(_,0,new G(1,1,100,100));o(m,0,new G(1,1,10,10)).setIsMask(!0);let $=o(m,0,new G(1,1,101,101));C(),g(S.equals(v),!1),A(S,v),g(S.equalsWithinBounds(v,new G(15,15,10,10)),!0),g(S.equalsWithinBounds(v,new G(0,0,5,5)),!1)})}y.testEqualsWithinBounds=u;let h;(T=>(T[T.FILL=0]="FILL",T[T.FILL_AND_STROKE=1]="FILL_AND_STROKE"))(h=y.GeometryType||(y.GeometryType={}));let f;(b=>{function g(_){return _==0||_==1}b.GeometryType_hasFill=g;function A(_){return _==1}b.GeometryType_hasStroke=A;function T(_){return h[_]}b.GeometryType_toString=T})(f=y.in_GeometryType||(y.in_GeometryType={}))})(fh||(fh={}));var _h;(s=>(s.FIG_FILE_NO_THUMBNAIL=new Uint8Array([102,105,103,45,107,105,119,105,1,0,0,0,208,10,0,0,141,24,123,127,227,70,113,87,118,156,199,229,30,125,80,74,41,165,148,82,74,129,114,87,74,41,165,180,149,45,217,86,34,75,170,36,231,113,148,186,138,45,199,106,100,201,104,101,95,114,208,239,206,204,142,94,78,14,126,228,143,104,231,177,243,218,153,217,89,127,57,10,133,8,46,67,255,102,21,50,182,119,100,27,214,196,243,85,215,103,240,103,217,154,62,233,13,85,107,160,123,0,242,177,167,187,13,88,145,220,186,165,193,186,229,25,3,75,53,97,213,246,252,115,83,135,197,142,92,76,60,29,101,117,106,201,19,239,216,112,38,174,110,218,42,238,220,85,175,35,1,194,206,80,227,57,170,81,167,83,48,10,80,174,174,106,19,219,50,17,203,36,112,234,26,62,202,230,86,58,11,157,69,32,192,104,165,7,36,95,215,136,105,100,159,200,37,63,141,146,89,148,92,186,235,24,121,44,219,122,170,187,54,242,216,154,86,74,32,175,95,2,34,10,101,154,221,27,143,116,11,237,229,61,213,58,81,165,151,3,215,30,59,232,98,223,85,71,200,215,238,218,182,169,171,214,196,118,116,87,245,13,219,66,111,79,244,158,111,187,232,42,122,137,142,153,134,20,187,167,155,166,225,120,184,220,119,129,9,194,39,227,115,224,234,131,177,169,186,19,199,54,207,7,82,200,61,80,101,105,186,54,105,242,29,250,250,25,154,116,223,51,141,30,34,30,120,231,163,174,141,177,126,104,88,160,204,146,216,71,221,56,76,102,35,240,138,177,87,28,213,243,38,254,16,196,13,134,116,146,238,72,158,14,215,84,247,88,71,93,202,104,108,250,134,35,131,219,66,83,193,146,238,216,69,82,187,103,155,118,5,237,152,198,96,232,203,61,29,15,98,45,87,187,197,14,205,214,6,210,73,218,82,130,251,112,10,174,169,162,236,3,207,238,251,19,41,3,61,28,170,174,86,65,135,154,209,239,235,174,78,30,220,215,207,122,230,216,163,120,62,24,142,17,247,208,83,253,113,21,228,71,82,11,44,94,50,199,35,195,178,61,195,71,21,47,59,65,148,228,116,152,29,207,54,13,153,11,3,87,213,12,56,205,9,153,138,206,87,40,252,202,120,40,21,10,194,141,167,129,209,168,112,192,52,178,101,126,183,141,145,42,61,219,49,150,80,46,222,52,136,67,138,53,228,187,171,251,61,25,230,190,33,115,167,111,152,82,182,111,200,3,108,233,243,121,56,45,236,107,27,150,5,85,228,13,85,205,62,149,73,231,218,78,13,242,190,13,105,33,211,96,210,53,199,104,142,210,85,123,199,219,168,150,31,94,231,61,153,253,109,219,53,6,6,149,30,27,59,144,145,40,197,180,79,229,2,76,240,201,6,220,161,133,211,52,11,242,40,77,0,81,38,61,38,156,91,164,42,7,95,140,99,189,78,28,197,90,47,47,194,108,156,68,57,20,100,203,85,165,201,142,113,166,155,178,35,128,186,30,21,140,210,75,19,145,103,245,65,236,192,1,33,51,210,201,168,145,138,53,174,212,241,106,121,61,85,90,215,246,242,44,189,10,213,56,186,68,211,170,45,12,242,219,208,164,101,246,216,47,150,10,49,247,130,21,40,41,189,144,225,145,30,124,61,86,93,201,166,186,174,125,42,15,31,77,109,17,168,127,61,54,76,232,22,110,209,171,164,168,163,52,66,181,35,163,208,218,213,79,116,89,44,165,84,165,155,166,113,24,36,246,42,44,227,215,30,91,148,147,96,35,108,243,160,96,165,250,113,215,119,85,185,86,206,236,234,172,164,103,195,52,139,158,167,73,30,196,176,221,212,251,254,118,120,220,162,40,148,163,177,231,27,125,67,182,177,122,247,73,152,229,209,20,247,182,124,219,217,222,218,181,125,223,30,201,162,78,215,34,236,173,51,145,102,80,11,154,222,87,161,202,37,179,107,123,144,101,134,228,215,207,117,76,59,74,22,5,26,186,84,229,168,224,10,84,125,239,88,182,236,182,163,83,99,131,220,77,179,81,148,101,40,179,202,155,178,61,113,185,128,242,129,178,214,173,129,47,211,70,11,196,130,202,67,233,65,243,67,254,250,216,185,44,161,162,28,28,107,128,212,35,71,31,200,248,157,224,71,113,180,190,44,156,235,85,154,229,183,51,171,213,179,193,113,48,181,76,31,86,34,78,13,77,234,231,37,98,168,151,65,53,131,155,116,157,15,178,104,86,8,185,147,158,181,129,138,12,250,58,79,221,80,68,207,195,134,211,82,129,244,181,146,204,107,29,94,126,19,135,94,88,22,0,132,215,179,139,202,244,117,117,36,13,131,179,165,147,234,187,144,139,208,249,100,255,245,245,145,99,187,170,123,78,73,73,98,192,239,60,172,156,190,211,215,100,36,139,174,4,170,131,233,21,69,188,50,118,8,173,225,41,4,130,26,63,52,100,223,232,81,211,147,220,189,116,13,242,179,162,232,218,255,79,185,226,182,163,181,200,163,249,205,255,218,225,168,61,125,2,53,68,55,119,107,48,6,195,185,34,224,82,135,210,129,245,46,227,113,10,169,44,151,208,56,98,72,44,222,206,216,62,227,151,240,79,185,128,127,173,0,254,181,41,247,96,243,53,18,111,144,232,2,10,184,107,196,51,228,94,32,183,148,228,229,233,10,54,76,165,212,46,227,171,84,68,178,100,129,117,20,228,89,116,205,120,103,249,248,49,238,95,62,126,130,232,229,227,143,80,198,242,9,34,219,203,39,136,220,89,62,65,100,199,9,50,56,3,35,153,133,176,79,185,92,71,51,246,85,67,232,189,178,69,2,113,19,196,235,16,197,174,101,187,124,29,206,24,78,208,10,150,33,227,173,121,176,140,226,27,224,231,2,143,23,55,130,144,92,76,179,104,149,3,116,39,215,65,96,142,39,255,152,241,82,176,210,141,211,11,198,249,197,77,30,10,214,226,84,72,76,105,193,32,180,64,56,65,93,32,121,22,228,129,228,221,133,170,150,194,148,67,41,236,1,227,101,96,148,116,21,76,163,28,67,216,218,68,34,186,0,163,56,107,95,84,83,196,33,219,17,16,75,193,134,188,3,38,37,98,158,102,75,118,196,118,35,169,245,132,237,201,133,191,0,255,147,32,138,1,179,31,109,95,142,143,216,65,150,230,65,17,254,123,2,9,176,56,148,151,17,216,200,148,221,233,34,200,130,41,228,161,192,216,84,144,172,1,67,19,108,23,18,7,215,246,38,204,160,120,67,63,64,67,115,222,138,101,65,123,88,159,26,152,13,151,97,28,37,16,150,111,248,206,101,124,179,90,8,246,45,239,204,170,27,79,176,239,248,110,183,224,98,74,187,58,65,72,205,103,209,44,199,4,82,144,118,142,1,193,197,48,140,46,23,57,102,196,0,229,193,158,105,186,92,6,201,76,20,161,229,13,25,100,164,76,232,214,28,78,93,218,5,91,27,87,174,162,100,144,186,130,245,57,175,153,21,202,112,10,70,107,35,1,43,204,159,165,217,85,169,37,129,176,7,49,200,155,21,206,254,151,128,96,153,57,1,56,162,112,76,83,193,190,226,220,187,89,94,164,113,33,93,72,0,212,66,2,211,186,148,33,96,191,2,89,139,39,44,79,175,31,200,186,219,103,149,212,81,176,90,193,56,13,94,20,21,128,154,102,80,236,112,98,96,153,20,231,134,243,16,170,101,10,241,221,153,71,113,120,28,82,194,215,122,21,80,136,77,96,136,9,11,73,143,134,54,164,11,182,224,237,50,187,119,104,108,98,74,71,166,238,203,205,212,157,207,69,152,67,40,90,89,48,139,214,2,35,93,231,240,78,51,135,59,84,87,208,78,115,169,0,194,176,158,207,161,9,128,97,81,117,15,125,200,160,97,84,149,231,194,64,92,93,23,76,217,147,250,63,98,60,192,151,138,2,78,84,170,90,201,122,233,129,145,50,193,118,88,187,48,12,218,135,32,108,145,7,157,203,117,142,89,77,208,110,233,200,30,157,151,242,172,241,86,217,67,63,183,242,76,193,167,74,111,17,36,88,235,63,148,45,8,191,126,112,9,244,63,173,228,67,168,3,29,5,23,132,252,100,213,104,92,38,107,53,64,98,248,179,244,234,128,181,241,75,168,79,139,254,177,131,95,66,253,165,246,181,83,44,137,240,25,116,240,171,112,6,248,93,90,17,250,175,117,87,217,43,150,68,248,188,121,40,251,21,64,196,191,77,241,46,130,197,129,92,16,242,11,65,233,126,15,191,132,250,178,217,135,14,43,128,136,95,205,32,169,32,160,16,103,232,54,252,126,3,36,6,53,144,87,186,116,146,179,7,53,68,228,238,5,220,110,151,25,24,48,211,19,44,42,116,238,225,29,36,49,247,150,129,184,2,250,35,252,18,74,11,203,14,142,183,182,176,19,104,247,156,189,116,23,75,236,58,238,52,132,189,206,101,71,226,236,229,45,4,49,245,107,245,118,21,216,87,238,32,137,121,0,173,38,9,51,183,44,137,87,155,48,177,12,27,189,233,71,229,154,72,6,100,72,112,153,5,171,5,38,73,130,73,252,218,45,20,49,30,85,88,15,181,39,120,101,255,248,54,142,88,143,69,30,100,70,2,70,120,69,235,127,125,27,67,108,230,50,130,83,50,35,248,0,203,79,106,136,200,35,33,167,244,211,178,31,191,209,132,137,197,202,225,70,241,225,234,184,34,123,126,218,132,137,197,94,84,227,119,227,146,125,131,189,249,34,60,109,113,68,227,89,242,38,251,89,3,36,134,175,69,245,20,121,139,189,85,1,68,116,69,253,184,120,155,253,188,134,136,236,229,47,120,23,188,203,222,126,1,154,54,248,249,157,167,192,123,236,23,119,144,196,60,206,203,23,226,171,236,157,114,77,164,147,124,251,41,248,26,251,229,54,134,216,78,47,110,191,121,222,97,239,222,198,17,235,217,166,208,189,21,216,95,221,197,18,251,57,220,13,177,28,75,4,59,227,239,213,16,145,159,82,164,42,134,95,55,97,98,249,123,227,126,182,216,251,53,68,228,111,230,229,220,229,176,223,148,107,34,253,35,47,71,143,167,236,131,114,77,164,111,67,121,223,8,22,243,223,22,75,34,76,160,245,206,96,162,145,47,32,204,175,15,216,239,110,161,136,241,187,112,251,174,73,248,239,183,49,196,22,228,219,207,139,143,217,135,219,24,98,187,136,171,59,72,176,21,255,67,3,36,134,233,166,158,29,46,216,227,26,34,242,172,158,50,158,20,75,34,132,117,255,232,21,23,209,71,183,80,196,56,199,163,25,132,233,50,204,179,27,150,241,63,54,97,98,185,164,195,105,48,125,188,141,33,182,133,168,222,39,159,177,168,2,136,248,189,132,235,102,114,213,132,137,37,150,40,39,152,205,136,101,217,132,137,37,41,103,9,152,74,210,114,77,164,149,168,199,160,57,251,103,13,17,57,155,103,144,31,35,232,190,90,36,202,198,47,238,32,137,57,207,232,136,210,62,52,43,206,214,13,144,24,54,116,228,221,42,160,13,161,207,196,157,135,215,231,236,90,52,159,85,95,176,27,241,194,145,234,123,246,60,18,132,116,214,23,113,4,92,116,47,255,171,201,223,24,164,254,61,11,179,104,83,18,164,243,57,255,225,36,10,159,161,125,48,8,77,131,100,19,8,140,115,216,69,67,97,52,133,185,46,186,14,99,39,11,55,192,7,194,21,9,107,97,34,138,167,130,252,129,1,55,211,111,12,239,195,180,82,139,49,225,85,87,14,196,13,180,23,198,52,13,117,211,107,208,209,26,139,48,43,231,153,131,173,103,33,12,97,9,176,202,96,41,197,52,210,42,167,165,182,156,215,198,174,137,35,202,166,244,99,195,58,75,105,211,53,219,21,165,34,152,125,247,210,11,80,179,193,124,217,229,251,51,112,104,26,90,36,241,160,248,209,155,41,15,229,16,4,79,215,166,21,10,28,7,77,242,73,53,120,225,132,220,94,87,118,11,246,156,195,152,9,42,152,207,59,2,14,50,136,11,225,187,1,253,124,221,102,123,162,120,200,23,148,125,209,252,125,224,19,118,32,94,240,208,255,148,221,91,5,34,199,186,221,97,135,114,105,151,211,238,125,9,246,171,201,250,1,41,118,130,155,56,13,102,128,120,248,31,73,0,0,0,99,100,100,98,96,102,96,97,98,100,96,96,98,96,97,100,117,201,79,46,205,77,205,43,97,96,99,228,168,103,96,96,224,100,224,1,81,64,0,166,4,24,132,24,24,24,25,192,154,24,20,129,250,88,157,19,243,202,18,139,113,40,231,103,4,105,16,102,48,130,136,1,0]),s.FIG_FILE_THUMBNAIL=new Uint8Array([102,105,103,45,107,105,119,105,1,0,0,0,208,10,0,0,141,24,123,127,227,70,113,87,118,156,199,229,30,125,80,74,41,165,148,82,74,129,114,87,74,41,165,180,149,45,217,86,34,75,170,36,231,113,148,186,138,45,199,106,100,201,104,101,95,114,208,239,206,204,142,94,78,14,126,228,143,104,231,177,243,218,153,217,89,127,57,10,133,8,46,67,255,102,21,50,182,119,100,27,214,196,243,85,215,103,240,103,217,154,62,233,13,85,107,160,123,0,242,177,167,187,13,88,145,220,186,165,193,186,229,25,3,75,53,97,213,246,252,115,83,135,197,142,92,76,60,29,101,117,106,201,19,239,216,112,38,174,110,218,42,238,220,85,175,35,1,194,206,80,227,57,170,81,167,83,48,10,80,174,174,106,19,219,50,17,203,36,112,234,26,62,202,230,86,58,11,157,69,32,192,104,165,7,36,95,215,136,105,100,159,200,37,63,141,146,89,148,92,186,235,24,121,44,219,122,170,187,54,242,216,154,86,74,32,175,95,2,34,10,101,154,221,27,143,116,11,237,229,61,213,58,81,165,151,3,215,30,59,232,98,223,85,71,200,215,238,218,182,169,171,214,196,118,116,87,245,13,219,66,111,79,244,158,111,187,232,42,122,137,142,153,134,20,187,167,155,166,225,120,184,220,119,129,9,194,39,227,115,224,234,131,177,169,186,19,199,54,207,7,82,200,61,80,101,105,186,54,105,242,29,250,250,25,154,116,223,51,141,30,34,30,120,231,163,174,141,177,126,104,88,160,204,146,216,71,221,56,76,102,35,240,138,177,87,28,213,243,38,254,16,196,13,134,116,146,238,72,158,14,215,84,247,88,71,93,202,104,108,250,134,35,131,219,66,83,193,146,238,216,69,82,187,103,155,118,5,237,152,198,96,232,203,61,29,15,98,45,87,187,197,14,205,214,6,210,73,218,82,130,251,112,10,174,169,162,236,3,207,238,251,19,41,3,61,28,170,174,86,65,135,154,209,239,235,174,78,30,220,215,207,122,230,216,163,120,62,24,142,17,247,208,83,253,113,21,228,71,82,11,44,94,50,199,35,195,178,61,195,71,21,47,59,65,148,228,116,152,29,207,54,13,153,11,3,87,213,12,56,205,9,153,138,206,87,40,252,202,120,40,21,10,194,141,167,129,209,168,112,192,52,178,101,126,183,141,145,42,61,219,49,150,80,46,222,52,136,67,138,53,228,187,171,251,61,25,230,190,33,115,167,111,152,82,182,111,200,3,108,233,243,121,56,45,236,107,27,150,5,85,228,13,85,205,62,149,73,231,218,78,13,242,190,13,105,33,211,96,210,53,199,104,142,210,85,123,199,219,168,150,31,94,231,61,153,253,109,219,53,6,6,149,30,27,59,144,145,40,197,180,79,229,2,76,240,201,6,220,161,133,211,52,11,242,40,77,0,81,38,61,38,156,91,164,42,7,95,140,99,189,78,28,197,90,47,47,194,108,156,68,57,20,100,203,85,165,201,142,113,166,155,178,35,128,186,30,21,140,210,75,19,145,103,245,65,236,192,1,33,51,210,201,168,145,138,53,174,212,241,106,121,61,85,90,215,246,242,44,189,10,213,56,186,68,211,170,45,12,242,219,208,164,101,246,216,47,150,10,49,247,130,21,40,41,189,144,225,145,30,124,61,86,93,201,166,186,174,125,42,15,31,77,109,17,168,127,61,54,76,232,22,110,209,171,164,168,163,52,66,181,35,163,208,218,213,79,116,89,44,165,84,165,155,166,113,24,36,246,42,44,227,215,30,91,148,147,96,35,108,243,160,96,165,250,113,215,119,85,185,86,206,236,234,172,164,103,195,52,139,158,167,73,30,196,176,221,212,251,254,118,120,220,162,40,148,163,177,231,27,125,67,182,177,122,247,73,152,229,209,20,247,182,124,219,217,222,218,181,125,223,30,201,162,78,215,34,236,173,51,145,102,80,11,154,222,87,161,202,37,179,107,123,144,101,134,228,215,207,117,76,59,74,22,5,26,186,84,229,168,224,10,84,125,239,88,182,236,182,163,83,99,131,220,77,179,81,148,101,40,179,202,155,178,61,113,185,128,242,129,178,214,173,129,47,211,70,11,196,130,202,67,233,65,243,67,254,250,216,185,44,161,162,28,28,107,128,212,35,71,31,200,248,157,224,71,113,180,190,44,156,235,85,154,229,183,51,171,213,179,193,113,48,181,76,31,86,34,78,13,77,234,231,37,98,168,151,65,53,131,155,116,157,15,178,104,86,8,185,147,158,181,129,138,12,250,58,79,221,80,68,207,195,134,211,82,129,244,181,146,204,107,29,94,126,19,135,94,88,22,0,132,215,179,139,202,244,117,117,36,13,131,179,165,147,234,187,144,139,208,249,100,255,245,245,145,99,187,170,123,78,73,73,98,192,239,60,172,156,190,211,215,100,36,139,174,4,170,131,233,21,69,188,50,118,8,173,225,41,4,130,26,63,52,100,223,232,81,211,147,220,189,116,13,242,179,162,232,218,255,79,185,226,182,163,181,200,163,249,205,255,218,225,168,61,125,2,53,68,55,119,107,48,6,195,185,34,224,82,135,210,129,245,46,227,113,10,169,44,151,208,56,98,72,44,222,206,216,62,227,151,240,79,185,128,127,173,0,254,181,41,247,96,243,53,18,111,144,232,2,10,184,107,196,51,228,94,32,183,148,228,229,233,10,54,76,165,212,46,227,171,84,68,178,100,129,117,20,228,89,116,205,120,103,249,248,49,238,95,62,126,130,232,229,227,143,80,198,242,9,34,219,203,39,136,220,89,62,65,100,199,9,50,56,3,35,153,133,176,79,185,92,71,51,246,85,67,232,189,178,69,2,113,19,196,235,16,197,174,101,187,124,29,206,24,78,208,10,150,33,227,173,121,176,140,226,27,224,231,2,143,23,55,130,144,92,76,179,104,149,3,116,39,215,65,96,142,39,255,152,241,82,176,210,141,211,11,198,249,197,77,30,10,214,226,84,72,76,105,193,32,180,64,56,65,93,32,121,22,228,129,228,221,133,170,150,194,148,67,41,236,1,227,101,96,148,116,21,76,163,28,67,216,218,68,34,186,0,163,56,107,95,84,83,196,33,219,17,16,75,193,134,188,3,38,37,98,158,102,75,118,196,118,35,169,245,132,237,201,133,191,0,255,147,32,138,1,179,31,109,95,142,143,216,65,150,230,65,17,254,123,2,9,176,56,148,151,17,216,200,148,221,233,34,200,130,41,228,161,192,216,84,144,172,1,67,19,108,23,18,7,215,246,38,204,160,120,67,63,64,67,115,222,138,101,65,123,88,159,26,152,13,151,97,28,37,16,150,111,248,206,101,124,179,90,8,246,45,239,204,170,27,79,176,239,248,110,183,224,98,74,187,58,65,72,205,103,209,44,199,4,82,144,118,142,1,193,197,48,140,46,23,57,102,196,0,229,193,158,105,186,92,6,201,76,20,161,229,13,25,100,164,76,232,214,28,78,93,218,5,91,27,87,174,162,100,144,186,130,245,57,175,153,21,202,112,10,70,107,35,1,43,204,159,165,217,85,169,37,129,176,7,49,200,155,21,206,254,151,128,96,153,57,1,56,162,112,76,83,193,190,226,220,187,89,94,164,113,33,93,72,0,212,66,2,211,186,148,33,96,191,2,89,139,39,44,79,175,31,200,186,219,103,149,212,81,176,90,193,56,13,94,20,21,128,154,102,80,236,112,98,96,153,20,231,134,243,16,170,101,10,241,221,153,71,113,120,28,82,194,215,122,21,80,136,77,96,136,9,11,73,143,134,54,164,11,182,224,237,50,187,119,104,108,98,74,71,166,238,203,205,212,157,207,69,152,67,40,90,89,48,139,214,2,35,93,231,240,78,51,135,59,84,87,208,78,115,169,0,194,176,158,207,161,9,128,97,81,117,15,125,200,160,97,84,149,231,194,64,92,93,23,76,217,147,250,63,98,60,192,151,138,2,78,84,170,90,201,122,233,129,145,50,193,118,88,187,48,12,218,135,32,108,145,7,157,203,117,142,89,77,208,110,233,200,30,157,151,242,172,241,86,217,67,63,183,242,76,193,167,74,111,17,36,88,235,63,148,45,8,191,126,112,9,244,63,173,228,67,168,3,29,5,23,132,252,100,213,104,92,38,107,53,64,98,248,179,244,234,128,181,241,75,168,79,139,254,177,131,95,66,253,165,246,181,83,44,137,240,25,116,240,171,112,6,248,93,90,17,250,175,117,87,217,43,150,68,248,188,121,40,251,21,64,196,191,77,241,46,130,197,129,92,16,242,11,65,233,126,15,191,132,250,178,217,135,14,43,128,136,95,205,32,169,32,160,16,103,232,54,252,126,3,36,6,53,144,87,186,116,146,179,7,53,68,228,238,5,220,110,151,25,24,48,211,19,44,42,116,238,225,29,36,49,247,150,129,184,2,250,35,252,18,74,11,203,14,142,183,182,176,19,104,247,156,189,116,23,75,236,58,238,52,132,189,206,101,71,226,236,229,45,4,49,245,107,245,118,21,216,87,238,32,137,121,0,173,38,9,51,183,44,137,87,155,48,177,12,27,189,233,71,229,154,72,6,100,72,112,153,5,171,5,38,73,130,73,252,218,45,20,49,30,85,88,15,181,39,120,101,255,248,54,142,88,143,69,30,100,70,2,70,120,69,235,127,125,27,67,108,230,50,130,83,50,35,248,0,203,79,106,136,200,35,33,167,244,211,178,31,191,209,132,137,197,202,225,70,241,225,234,184,34,123,126,218,132,137,197,94,84,227,119,227,146,125,131,189,249,34,60,109,113,68,227,89,242,38,251,89,3,36,134,175,69,245,20,121,139,189,85,1,68,116,69,253,184,120,155,253,188,134,136,236,229,47,120,23,188,203,222,126,1,154,54,248,249,157,167,192,123,236,23,119,144,196,60,206,203,23,226,171,236,157,114,77,164,147,124,251,41,248,26,251,229,54,134,216,78,47,110,191,121,222,97,239,222,198,17,235,217,166,208,189,21,216,95,221,197,18,251,57,220,13,177,28,75,4,59,227,239,213,16,145,159,82,164,42,134,95,55,97,98,249,123,227,126,182,216,251,53,68,228,111,230,229,220,229,176,223,148,107,34,253,35,47,71,143,167,236,131,114,77,164,111,67,121,223,8,22,243,223,22,75,34,76,160,245,206,96,162,145,47,32,204,175,15,216,239,110,161,136,241,187,112,251,174,73,248,239,183,49,196,22,228,219,207,139,143,217,135,219,24,98,187,136,171,59,72,176,21,255,67,3,36,134,233,166,158,29,46,216,227,26,34,242,172,158,50,158,20,75,34,132,117,255,232,21,23,209,71,183,80,196,56,199,163,25,132,233,50,204,179,27,150,241,63,54,97,98,185,164,195,105,48,125,188,141,33,182,133,168,222,39,159,177,168,2,136,248,189,132,235,102,114,213,132,137,37,150,40,39,152,205,136,101,217,132,137,37,41,103,9,152,74,210,114,77,164,149,168,199,160,57,251,103,13,17,57,155,103,144,31,35,232,190,90,36,202,198,47,238,32,137,57,207,232,136,210,62,52,43,206,214,13,144,24,54,116,228,221,42,160,13,161,207,196,157,135,215,231,236,90,52,159,85,95,176,27,241,194,145,234,123,246,60,18,132,116,214,23,113,4,92,116,47,255,171,201,223,24,164,254,61,11,179,104,83,18,164,243,57,255,225,36,10,159,161,125,48,8,77,131,100,19,8,140,115,216,69,67,97,52,133,185,46,186,14,99,39,11,55,192,7,194,21,9,107,97,34,138,167,130,252,129,1,55,211,111,12,239,195,180,82,139,49,225,85,87,14,196,13,180,23,198,52,13,117,211,107,208,209,26,139,48,43,231,153,131,173,103,33,12,97,9,176,202,96,41,197,52,210,42,167,165,182,156,215,198,174,137,35,202,166,244,99,195,58,75,105,211,53,219,21,165,34,152,125,247,210,11,80,179,193,124,217,229,251,51,112,104,26,90,36,241,160,248,209,155,41,15,229,16,4,79,215,166,21,10,28,7,77,242,73,53,120,225,132,220,94,87,118,11,246,156,195,152,9,42,152,207,59,2,14,50,136,11,225,187,1,253,124,221,102,123,162,120,200,23,148,125,209,252,125,224,19,118,32,94,240,208,255,148,221,91,5,34,199,186,221,97,135,114,105,151,211,238,125,9,246,171,201,250,1,41,118,130,155,56,13,102,128,120,248,31,76,0,0,0,99,100,100,98,96,102,96,97,98,100,96,96,98,96,97,100,117,201,79,46,205,77,205,43,97,96,99,228,168,103,96,96,224,100,224,1,81,64,0,166,4,24,132,24,24,24,25,192,154,24,20,129,250,88,157,19,243,202,18,139,113,40,231,103,4,105,16,102,48,2,11,177,49,48,0,0,3,0,0,0,1,2,3]),s.GIF_MULTI_IMAGE=new Uint8Array([71,73,70,56,57,97,2,0,2,0,241,0,0,0,0,0,255,255,255,255,0,0,0,255,0,33,255,11,78,69,84,83,67,65,80,69,50,46,48,3,1,0,0,0,33,249,4,4,50,0,0,0,44,0,0,0,0,2,0,2,0,0,2,2,12,94,0,44,1,0,0,0,1,0,1,0,0,2,2,84,1,0,33,249,4,4,50,0,0,0,44,1,0,0,0,1,0,1,0,0,2,2,76,1,0,44,1,0,1,0,1,0,1,0,0,2,2,84,1,0,33,249,4,4,50,0,0,0,44,1,0,1,0,1,0,1,0,0,2,2,76,1,0,44,0,0,1,0,1,0,1,0,0,2,2,84,1,0,33,249,4,4,50,0,0,0,44,0,0,1,0,1,0,1,0,0,2,2,76,1,0,59]),s.GIF_MALFORMED_END_NO_EOF=new Uint8Array([71,73,70,56,57,97,2,0,2,0,241,0,0,0,0,0,255,255,255,255,0,0,0,255,0,33,255,11,78,69,84,83,67,65,80,69,50,46,48,3,1,0,0,0,33,249,4,4,50,0,0,0,44,0,0,0,0,2,0,2,0,0,2,2,12,94,0,44,1,0,0,0,1,0,1,0,0,2,2,84,1,0,33,249,4,4,50,0,0,0,44,1,0,0,0,1,0,1,0,0,2,2,76,1,0,44,1,0,1,0,1,0,1,0,0,2,2,84,1,0,33,249,4,4,50,0,0,0,44,1,0,1,0,1,0,1,0,0,2,2,76,1,0,44,0,0,1,0,1,0,1,0,0,2,2,84,1,0,33,249,4,4,50,0,0,0,44,0,0,1,0,1,0,1,0,0,2,50,76,1,0]),s.GIF_SPEED=new Uint8Array([71,73,70,56,57,97,2,0,2,0,240,0,0,0,0,0,255,255,255,33,255,11,78,69,84,83,67,65,80,69,50,46,48,3,1,0,0,0,33,249,4,0,25,0,0,0,44,0,0,0,0,2,0,2,0,0,2,2,12,94,0,33,249,4,0,50,0,0,0,44,0,0,0,0,2,0,2,0,0,2,3,68,0,5,0,33,249,4,0,100,0,0,0,44,0,0,0,0,2,0,2,0,0,2,2,132,83,0,33,249,4,0,200,0,0,0,44,0,0,0,0,2,0,2,0,0,2,3,4,2,5,0,59]),s.GIF_D1_D3_D3_D3=new Uint8Array([71,73,70,56,57,97,4,0,4,0,240,0,0,0,0,0,255,0,0,33,249,4,5,100,0,0,0,33,255,11,78,69,84,83,67,65,80,69,50,46,48,3,1,0,0,0,33,255,11,73,109,97,103,101,77,97,103,105,99,107,13,103,97,109,109,97,61,48,46,52,53,52,53,53,0,44,0,0,0,0,4,0,4,0,0,2,5,76,0,134,203,80,0,33,249,4,13,100,0,0,0,33,255,11,73,109,97,103,101,77,97,103,105,99,107,13,103,97,109,109,97,61,48,46,52,53,52,53,53,0,44,0,0,0,0,4,0,4,0,128,0,0,0,0,255,0,2,5,4,18,134,198,92,0,33,249,4,13,100,0,0,0,33,255,11,73,109,97,103,101,77,97,103,105,99,107,13,103,97,109,109,97,61,48,46,52,53,52,53,53,0,44,0,0,0,0,4,0,4,0,128,0,0,0,0,0,255,2,5,132,143,17,166,5,0,33,249,4,13,100,0,0,0,33,255,11,73,109,97,103,101,77,97,103,105,99,107,13,103,97,109,109,97,61,48,46,52,53,52,53,53,0,44,0,0,0,0,4,0,4,0,128,0,0,0,255,0,255,2,5,132,111,17,185,80,0,59]),s.GIF_D3_D3_D3_D3=new Uint8Array([71,73,70,56,57,97,4,0,4,0,240,0,0,0,0,0,255,0,0,33,249,4,13,100,0,0,0,33,255,11,78,69,84,83,67,65,80,69,50,46,48,3,1,0,0,0,33,255,11,73,109,97,103,101,77,97,103,105,99,107,13,103,97,109,109,97,61,48,46,52,53,52,53,53,0,44,0,0,0,0,4,0,4,0,0,2,5,76,0,134,203,80,0,33,249,4,13,100,0,0,0,33,255,11,73,109,97,103,101,77,97,103,105,99,107,13,103,97,109,109,97,61,48,46,52,53,52,53,53,0,44,0,0,0,0,4,0,4,0,128,0,0,0,0,255,0,2,5,4,18,134,198,92,0,33,249,4,13,100,0,0,0,33,255,11,73,109,97,103,101,77,97,103,105,99,107,13,103,97,109,109,97,61,48,46,52,53,52,53,53,0,44,0,0,0,0,4,0,4,0,128,0,0,0,0,0,255,2,5,132,143,17,166,5,0,33,249,4,13,100,0,0,0,33,255,11,73,109,97,103,101,77,97,103,105,99,107,13,103,97,109,109,97,61,48,46,52,53,52,53,53,0,44,0,0,0,0,4,0,4,0,128,0,0,0,255,0,255,2,5,132,111,17,185,80,0,59])))(_h||(_h={}));var Cd=class{constructor(e,t){if(this._app=null,this._frameLoader=null,this._session=null,this._pendingNodeId=null,this._app=e,this._session=t,this._frameLoader=this._session.incrementalLoader(),this._frameLoader==null)throw new Error("Expected incremental frame loader for mirror mode");this._emitter=qt.getEventEmitter(),this._pendingNodeId=null,this._emitter.on("incrementalLoadingInfo",n=>{n.type==="finishIncrementalLoading"&&this._handleIncrementalLoadFinished()})}hasPendingSelectionChange(){return this._pendingNodeId!==null}connectToFileAndShowNode(e,t,n,r,o,a,s){n!=null&&this._app.state().setActivePrototypeStartingPointNodeId(n),this._session.fileKey()!=e?this._app.connectTo(e,t,n,r,o,a,s):this._app.state().currentFileKey()!=e?(this._frameLoader.requestTlf(t),this._pendingNodeId=t):this._frameLoader.requestTlf(t)?this._app.state().prototypeState().navigateToFrameAndCloseOverlays(t):this._pendingNodeId=t}_handleIncrementalLoadFinished(){var e;this._pendingNodeId!=null&&((e=this._app.state().scene())==null?void 0:e.findNode1(this._pendingNodeId))!=null&&(this._app.state().prototypeState().navigateToFrameAndCloseOverlays(this._pendingNodeId),this._pendingNodeId=null)}};var Ll;(a=>{function i(s){return{x:Math.round(s.x()*100)/100,y:Math.round(s.y()*100)/100}}a._serialize=i;function e(s){return new I(s.x,s.y)}a._deserializeVector=e;function t(s,l){1&l&&(s.alt=!0),2&l&&(s.meta=!0),4&l&&(s.shift=!0),8&l&&(s.ctrl=!0),16&l&&(s.platform=!0)}a._setModifiers=t;function n(s){return("alt"in s?1:0)|("meta"in s?2:0)|("shift"in s?4:0)|("ctrl"in s?8:0)|("platform"in s?16:0)}a._loadModifiers=n;function r(s,l){let d=s.asMouseEvent();if(d!=null){let p={};return p.type=Wi[s.type()],p.at=i(l(d.locationInWindow)),d.locationInWindow.equals(d.previousLocationInWindow)||(p.lastAt=i(l(d.previousLocationInWindow))),d.clickCount!=0&&(p.clicks=d.clickCount),d.scrollDelta!=null&&(p.scroll=i(d.scrollDelta)),t(p,s.modifiers()),p}let c=s.asKeyEvent();if(c!=null){let p={};return p.type=Wi[s.type()],p.key=c.key,c.isRepeat&&(p.repeat=!0),t(p,s.modifiers()),p}return null}a.serialize=r;function o(s,l,d,c){let p=ga.ViewerEventType_fromString(s.type);if(ga.ViewerEventType_isMouseEventType(p)){let u=c(e(s.at)),h=l(u),f=u;"lastAt"in s&&(f=c(e(s.lastAt)));let y=null;"scroll"in s&&(y=e(s.scroll));let g=0;"clicks"in s&&(g=s.clicks);let A=n(s);return new as(p,h,A,u,f,y,g,[])}else if(ga.ViewerEventType_isKeyEventType(p)){let u=d(),h=s.key|0,f=s.repeat,y=n(s);return new ls(p,u,y,h,f)}else if(ga.ViewerEventType_isTouchEventType(p)){let u=n(s),h=c(e(s.at)),f=l(h);if(p==11||p==12){let y=h;"lastAt"in s&&(y=c(e(s.lastAt)));let g=new zs(0,f,h,y);return new ss(p,f,u,[g],[g])}else return new ss(p,f,u,[],[])}else if(ga.ViewerEventType_isWindowEventType(p))throw new Error("Deserializing window events not supported");throw new Error(`Unrecognized event type in deserialize ${Wi[p]}`)}a.deserialize=o})(Ll||(Ll={}));var Bj=new ll(1/.05,1),Vj=sl.withDampingRatio(.5,100,1.1);var _T;(t=>{function i(n,r){return n(r)}t.call=i;function e(n){return n}t._new=e})(_T||(_T={}));var vf;(r=>{function i(o){e(o.map(a=>(s,l,d,c)=>{a(d,c)}))}r.createNewSceneAndRun=i;function e(o){let a=new vn,s=gt.createSceneWithCanvasForTests1(),l=s.root().childAt1(0),d=dn(l,"source",E.BLACK);d.setRelativeTransform(new ne(1,0,0,0,1,400)),d.setSize(new I(500,700));let c=dn(l,"dst",E.BLACK);c.setRelativeTransform(new ne(1,0,0,0,1,1100)),c.setSize(new I(500,700)),a.setActiveCanvas(l),a.setScene(s);for(let p of o)p(a,s,d,c)}r.createNewAppStateAndSceneAndRun=e;function t(){let o=AssertLib.deepStrictEqual,a=new _a("./src/test/protomagicmove.test.sk");beforeEach(()=>{Y.setViewerMode(Y.ViewerMode.PROTOTYPE)}),Ft("getNodeMatches",()=>{let s=(l,d,c)=>{let p=Fo.getNodeMatches(l,d);for(let u of c){let h=u[0],f=u[1],y=Be.StringMap_get(p,h.id(),null),g=Be.StringMap_get(p,f.id(),null);o(y,f,`Expected ${h.id()} to match ${f.id()}, but got ${y==null?null:y.id()} instead.`),o(g,h,`Expected ${f.id()} to match ${h.id()}, but got ${g==null?null:g.id()} instead.`)}o(p.size,c.length*2)};Ce("simple match case",()=>{let d=gt.createSceneWithCanvasForTests1().root().childAt1(0),c=et(d,"src"),p=je(c,"A"),u=je(c,"B"),h=je(c,"C"),f=et(d,"dst"),y=je(f,"A"),g=je(f,"B"),A=je(f,"C");s(c,f,[[p,y],[u,g],[h,A]])}),Ce("crossed match case",()=>{let d=gt.createSceneWithCanvasForTests1().root().childAt1(0),c=et(d,"src"),p=je(c,"A"),u=je(c,"B"),h=et(d,"dst"),f=je(h,"B"),y=je(h,"A");s(c,h,[[p,y],[u,f]])}),Ce("duplicate names",()=>{let d=gt.createSceneWithCanvasForTests1().root().childAt1(0),c=et(d,"src"),p=je(c,"A"),u=je(c,"A");je(c,"A");let h=et(d,"dst"),f=je(h,"A"),y=je(h,"A");s(c,h,[[p,f],[u,y]])}),Ce("recursive matches",()=>{let d=gt.createSceneWithCanvasForTests1().root().childAt1(0),c=et(d,"src"),p=et(d,"dst"),u=je(c,"A"),h=je(u,"A"),f=je(u,"B"),y=je(c,"B");je(y,"A"),je(y,"B");let g=je(c,"C");je(g,"A"),je(g,"B");let A=je(p,"A"),T=je(A,"A"),b=je(A,"B"),_=je(p,"B");je(_,"C"),je(_,"D");let m=je(p,"D");je(m,"A"),je(m,"B"),s(c,p,[[u,A],[h,T],[f,b],[y,_]])}),Ce("hidden and transparent nodes",()=>{let d=gt.createSceneWithCanvasForTests1().root().childAt1(0),c=et(d,"src"),p=je(c,"A");je(c,"B");let u=je(c,"C"),h=je(c,"D");p.setVisible(!1),u.setOpacity(0);let f=et(d,"dst");je(f,"A");let y=je(f,"B"),g=je(f,"C"),A=je(f,"D");y.setVisible(!1),h.setOpacity(0),s(c,f,[[u,g],[h,A]])}),Ce("boolean op nodes",()=>{let d=gt.createSceneWithCanvasForTests1().root().childAt1(0),c=et(d,"src"),p=Pl(c);p.setName("booleanOp"),je(p,"A"),je(p,"B");let u=et(d,"dst"),h=Pl(u);h.setName("booleanOp"),je(h,"A"),je(h,"B"),s(c,u,[[p,h]])})}),Ce("Smart animate of fixed elements",()=>{let s=new I(100,100),l=new I(10,10),d=new vn,c=gt.createSceneWithCanvasForTests1(),p=c.root().childAt1(0);p.setPrototypeDevice(new Tr("CUSTOM",s,null,"NONE")),p.setCurrentViewportSize(s),d.setActiveCanvas(p),d.setScene(c);let u=(g,A)=>{let T=rt(p);T.setSize(new I(g,A)),T.setUsedAsBaseScreen(!0);let b=Fr(T);return b.setSize(new I(10,10)),b.setRelativeTransform(new ne(1,0,0,0,1,A-l.y())),b.setVerticalConstraint("MAX"),b.setScrollBehavior("FIXED_WHEN_CHILD_OF_SCROLLING_FRAME"),T},h=u(100,200),f=u(100,100);Fl(h,f);let y=Sl.buildStrategy(h.childAt1(0),f.childAt1(0));o(y.transition.from().transform1().translation().y(),s.y()-l.y()),o(y.transition.to().transform1().translation().y(),s.y()-l.y())}),Ft("interpolation strategies",()=>{let s=(l,d)=>{let c=Sl.buildStrategy(l,d);c.isDissolve};Ce("dissolve discrete properties",()=>{[(d,c)=>{let p=pe(d,"A");p.setBlendMode("NORMAL");let u=pe(c,"A");u.setBlendMode("MULTIPLY"),s(p,u)},(d,c)=>{let p=hT(d,"B"),u=pe(c,"B");s(p,u)},(d,c)=>{let p=dn(d,"C",E.TRANSPARENT);pe(p,"C_content");let u=sa(c,"C");pe(u,"C_content"),s(p,u)},(d,c)=>{d.setOverflowDirection("VERTICAL"),c.setOverflowDirection("VERTICAL");let p=pe(d,"D");p.setScrollBehavior("SCROLLS");let u=pe(c,"D");u.setScrollBehavior("FIXED_WHEN_CHILD_OF_SCROLLING_FRAME"),s(p,u)}].forEach(d=>{i([d])})}),Ce("interpolate effects and paints",()=>{let l=ie.createLinearGradient([new $e(E.RED,0),new $e(E.TRANSPARENT,.5)]);[(c,p)=>{let u=ph(c,"A",[l]),h=pe(p,"A");s(u,h)},(c,p)=>{let u=pe(c,"B");u.setTestOnlyEffects1([]);let h=pe(p,"B");h.setTestOnlyEffects1([we.createForegroundBlur(1)]),s(u,h)},(c,p)=>{let u=pe(c,"C");u.setTestOnlyEffects1([we.createForegroundBlur(1)]);let h=pe(p,"C");h.setTestOnlyEffects1([we.createDropShadow1(1,new I(1,1),E.BLACK,1)]),s(u,h)},(c,p)=>{let u=pe(c,"D"),h=[we.createForegroundBlur(1),we.createDropShadow1(1,new I(1,1),E.BLACK,1)];u.setTestOnlyEffects1(h);let f=pe(p,"D"),y=h.slice();y[0].setIsEnabled(!1),f.setTestOnlyEffects1(y),s(u,f)},(c,p)=>{let u=pe(c,"E"),h=[l,ie.createSolid(E.RED,1)];u.setTestOnlyFillPaints3(h);let f=pe(p,"E"),y=h.slice();y[0].setIsEnabled(!1),f.setTestOnlyFillPaints3(y),s(u,f)}].forEach(c=>{i([c])})}),Ce("interpolate geometry",()=>{let l=(c,p,u)=>{let h=je(c,p);h.setTestOnlyFillPaints([ie.createSolid(E.BLACK,1)]);let f=u.topLeft().x(),y=u.topLeft().y(),g=u.width(),A=u.height(),T=new Wn("NONZERO",0,Et.new2().moveTo1(f,y).lineTo(f+g,y).lineTo(f+g,y+A).lineTo(f,y+A-1).close(),u),b=new Vn([T],null,T.bounds(),null);return h.setTestOnlyFillPaints([ie.createSolid(E.RED,1)]),h.setTestOnlyFillGeometry(b),h.setTestOnlyStrokeGeometry(b),We(h,u.topLeft(),u.size()),h};[(c,p)=>{let u=l(c,"A",new G(0,0,100,100)),h=Vt(p,"A",E.RED,1);s(u,h)}].forEach(c=>{i([c])})})}),Ft("magic move",()=>{let s=(p,u,h)=>{ds(p,()=>{let f=[];return u.forEach(y=>{i([h,(g,A)=>{let T=new ne(1,0,0,0,1,700),b=vt.FrozenAffineTransform_IDENTITY,_=Fo.getMagicMovePlan2(g,T,A,b,Rn.get(y));f.push(a.asyncAssertMatchesSnapshot(`plan ${y}`,_.debugString()));let m=()=>0,S=Ur.makeEasingFunction([0,0,1,1],.3),v=new Ni(_,m,S);f.push(a.asyncAssertMatchesSnapshot(`render tree ${y}`,v.renderTree().debugString1()))}])}),Promise.all(f)})},l=["DISSOLVE","SLIDE_FROM_RIGHT","PUSH_FROM_RIGHT","MOVE_FROM_RIGHT","SLIDE_OUT_TO_RIGHT","MOVE_OUT_TO_RIGHT"],d=["DISSOLVE","MOVE_FROM_RIGHT","MOVE_OUT_TO_RIGHT"],c=["DISSOLVE"];s("identical rectangles",c,(p,u)=>{pe(p,"rect"),pe(u,"rect")}),s("rectangles with different opacities",c,(p,u)=>{pe(p,"rect").setOpacity(.9),pe(u,"rect").setOpacity(.1)}),s("rectangles with changing and unchanging paints",c,(p,u)=>{ph(p,"rect",[ie.createSolid(E.RED,1),ie.createSolid(E.GREEN,1)]),ph(u,"rect",[ie.createSolid(E.BLUE,1),ie.createSolid(E.GREEN,1)])}),s("rectangles with different translations",c,(p,u)=>{pe(p,"rect").setRelativeTransform(new ne(1,0,30,0,1,50)),pe(u,"rect").setRelativeTransform(new ne(1,0,130,0,1,250))}),s("rectangles with different rotation",c,(p,u)=>{let h=pe(p,"rect");h.setRelativeTransform(new ne(1,0,30,0,1,50));let f=pe(u,"rect"),y=ne.new3(h.relativeTransform());y.rotatedBy(Math.PI/4),f.setRelativeTransform(y)}),s("rectangles with different scale",c,(p,u)=>{let h=pe(p,"rect");h.setRelativeTransform(new ne(1,0,30,0,1,50));let f=pe(u,"rect"),y=ne.new3(h.relativeTransform());y.scaledBy1(new I(2,3)),f.setRelativeTransform(y)}),s("insertion of new rectangle",c,(p,u)=>{pe(u,"rect")}),s("deletion of old rectangle",c,(p,u)=>{pe(p,"rect")}),s("rectangles with mismatched names",c,(p,u)=>{pe(p,"A"),pe(u,"B")}),s("hidden and never-visible rectangles",c,(p,u)=>{let h=pe(p,"hidden"),f=pe(p,"neverVisible");h.setVisible(!1),f.setOpacity(0);let y=pe(u,"hidden"),g=pe(u,"neverVisible");y.setVisible(!1),g.setOpacity(0)}),s("hidden and transparent and no match nodes to visible nodes",c,(p,u)=>{let h=pe(p,"hidden"),f=pe(p,"transparent");h.setVisible(!1),f.setOpacity(0),pe(u,"hidden"),pe(u,"transparent"),pe(u,"noMatch")}),s("visible nodes to hidden and transparent and no match nodes",c,(p,u)=>{pe(p,"hidden"),pe(p,"transparent"),pe(p,"noMatch");let h=pe(u,"hidden"),f=pe(u,"transparent");h.setVisible(!1),f.setOpacity(0)}),s("matching boolean op nodes",c,(p,u)=>{let h=Pl(p);h.setName("booleanOp"),je(h,"A"),je(h,"B");let f=Pl(u);f.setName("booleanOp"),je(f,"A"),je(f,"B")}),s("simple matching with layer re-ordering",c,(p,u)=>{pe(p,"A"),pe(p,"B"),pe(u,"B"),pe(u,"A")}),s("simple insertion, deletion, and matching",l,(p,u)=>{pe(p,"A"),pe(p,"B"),pe(u,"C"),pe(u,"B")}),s("complex layer re-ordering with insertions and removals",d,(p,u)=>{pe(p,"A"),pe(p,"B"),pe(p,"C"),pe(p,"D"),pe(p,"E"),pe(p,"F"),pe(p,"G"),pe(p,"H"),pe(u,"1"),pe(u,"2"),pe(u,"F"),pe(u,"3"),pe(u,"4"),pe(u,"C"),pe(u,"5"),pe(u,"6")}),s("complex matching case with no nesting",c,(p,u)=>{pe(p,"A"),pe(p,"B"),pe(p,"C"),pe(p,"E"),pe(u,"X"),pe(u,"Y"),pe(u,"B"),pe(u,"Z"),pe(u,"E"),pe(u,"F")}),s("simple nested matching",c,(p,u)=>{let h=et(p,"F");et(h,"rect");let f=et(u,"F");et(f,"rect").setOpacity(.5)}),s("nested insertions/removals",d,(p,u)=>{let h=et(p,"A");pe(h,"rectA");let f=et(u,"B");pe(f,"rectB")}),s("dissolving between different sized objects",c,(p,u)=>{pe(p,"A").setSize(new I(100,100)),pe(u,"A").setSize(new I(200,200))}),s("dissolving between non-uniformly scaling frames with children",c,(p,u)=>{let h=et(p,"A");h.setSize(new I(150,1)),Vt(h,"rect",E.RED,1).setSize(new I(100,100)),Vt(h,"rect",E.RED,1).setSize(new I(100,100));let g=et(u,"A");g.setSize(new I(300,300)),Vt(g,"rect",E.RED,1).setSize(new I(100,100)),Vt(g,"rect",E.RED,1).setSize(new I(100,100))}),s("dissolving between background blur objects",c,(p,u)=>{let h=Object({viewer_background_blur_opts:!1});Y.updateFeatureFlags(h),Vt(p,"A",E.RED,.5).setTestOnlyEffects1([we.createBackgroundBlur(1)]),Vt(u,"A",E.BLUE,.5).setTestOnlyEffects1([we.createBackgroundBlur(1)])}),s("dissolving between background blur objects with a background blur behind",c,(p,u)=>{let h=Object({viewer_background_blur_opts:!1});Y.updateFeatureFlags(h),Vt(p,"BG",E.RED,.5).setTestOnlyEffects1([we.createBackgroundBlur(1)]),Vt(u,"BG",E.RED,.5).setTestOnlyEffects1([we.createBackgroundBlur(1)]),Vt(p,"A",E.RED,.5).setTestOnlyEffects1([we.createBackgroundBlur(1)]),Vt(u,"A",E.BLUE,.5).setTestOnlyEffects1([we.createBackgroundBlur(1)])}),s("translating a background blur contained in a frame with clip-content enabled",c,(p,u)=>{let h=Object({viewer_background_blur_opts:!1});Y.updateFeatureFlags(h);let f=et(p,"A");f.setIsFrameMaskDisabled(!0);let y=et(f,"B");Vt(y,"BG",E.RED,.5).setTestOnlyEffects1([we.createBackgroundBlur(1)]);let A=et(u,"A");A.setIsFrameMaskDisabled(!0);let T=ne.new3(A.relativeTransform());T.translatedBy2(10,10),A.setRelativeTransform(T);let b=et(A,"B");Vt(b,"BG",E.RED,.5).setTestOnlyEffects1([we.createBackgroundBlur(1)])}),s("translating a node with a background blur",c,(p,u)=>{Vt(p,"BG",E.RED,.5).setTestOnlyEffects1([we.createBackgroundBlur(1)]);let f=Vt(u,"BG",E.RED,.5);f.setTestOnlyEffects1([we.createBackgroundBlur(1)]);let y=ne.new3(f.relativeTransform());y.translatedBy2(10,10),f.setRelativeTransform(y)}),s("dissolving + scaling between nodes with unmatched children",c,(p,u)=>{let h=dn(p,"F",E.RED);h.setSize(new I(100,100)),pe(h,"rect"),et(u,"F").setSize(new I(200,200))}),s("dissolve only between nodes with unmatched children",c,(p,u)=>{let h=dn(p,"F",E.RED);h.setSize(new I(100,100)),pe(h,"rect"),sT(u,"F").setSize(new I(100,100))}),s("dissolving between visible top frame to invisibile top frame",c,(p,u)=>{let h=new ie("SOLID");h.setColor(E.RED),h.setOpacity(1),h.setIsEnabled(!0),p.setTestOnlyFillPaints3([h]),h.setOpacity(0),u.setTestOnlyFillPaints3([h])}),s("dissolving between different opacity objects",c,(p,u)=>{let h=pe(p,"A");h.setOpacity(1),h.setBlendMode("MULTIPLY");let f=pe(u,"A");f.setOpacity(.5),f.setBlendMode("NORMAL")}),s("dissolving between invisible node to visible node",c,(p,u)=>{Vt(p,"A",E.RED,0),Vt(u,"A",E.BLUE,.5)}),s("interpolating between two solid color paints",c,(p,u)=>{Vt(p,"A",E.RED,1),Vt(u,"A",E.BLUE,1)}),s("drop shadow: node rotates",c,(p,u)=>{let h=pe(p,"rect");h.setTestOnlyEffects1([we.createDropShadow1(1,Ie.FrozenVector_new4(1,1),E.BLACK,.5)]),h.setRelativeTransform(new ne(1,0,30,0,1,50));let f=pe(u,"rect");f.setTestOnlyEffects1([we.createDropShadow1(1,Ie.FrozenVector_new4(1,1),E.BLACK,.5)]);let y=ne.new3(h.relativeTransform());y.rotatedBy(Math.PI/4),f.setRelativeTransform(y)}),s("inner shadow: node rotates",c,(p,u)=>{let h=pe(p,"rect");h.setTestOnlyEffects1([we.createInnerShadow(1,Ie.FrozenVector_new4(1,1),E.BLACK,.5)]),h.setRelativeTransform(new ne(1,0,30,0,1,50));let f=pe(u,"rect");f.setTestOnlyEffects1([we.createInnerShadow(1,Ie.FrozenVector_new4(1,1),E.BLACK,.5)]);let y=ne.new3(h.relativeTransform());y.rotatedBy(Math.PI/4),f.setRelativeTransform(y)}),s("drop shadow: group shadow where group rotates and children are static",c,(p,u)=>{let h=dn(p,"F",E.TRANSPARENT);h.setIsBackgroundEnabled(!1),pe(h,"rectA").setRelativeTransform(ne.new2()),pe(h,"rectB").setRelativeTransform(new ne(1,0,50,0,1,0)),h.setRelativeTransform(new ne(1,0,30,0,1,50)),h.setTestOnlyEffects1([we.createDropShadow1(1,Ie.FrozenVector_new4(1,1),E.BLACK,.5)]);let g=dn(u,"F",E.TRANSPARENT);g.setIsBackgroundEnabled(!1),pe(g,"rectA").setRelativeTransform(ne.new2()),pe(g,"rectB").setRelativeTransform(new ne(1,0,50,0,1,0));let b=ne.new3(h.relativeTransform());b.rotatedBy(Math.PI/4),g.setRelativeTransform(b),g.setTestOnlyEffects1([we.createDropShadow1(1,Ie.FrozenVector_new4(1,1),E.BLACK,.5)])}),s("drop shadow: group shadow where group is static and children rotate",c,(p,u)=>{let h=dn(p,"F",E.TRANSPARENT);h.setIsBackgroundEnabled(!1),pe(h,"rectA").setRelativeTransform(ne.new2()),pe(h,"rectB").setRelativeTransform(new ne(1,0,50,0,1,0)),h.setRelativeTransform(new ne(1,0,30,0,1,50)),h.setTestOnlyEffects1([we.createDropShadow1(1,Ie.FrozenVector_new4(1,1),E.BLACK,.5)]);let g=dn(u,"F",E.TRANSPARENT);g.setIsBackgroundEnabled(!1);let A=pe(g,"rectA");A.setRelativeTransform(ne.new2());let T=pe(g,"rectB");T.setRelativeTransform(new ne(1,0,50,0,1,0));let b=ne.new3(A.relativeTransform());b.rotatedBy(Math.PI/4),A.setRelativeTransform(b);let _=ne.new3(T.relativeTransform());_.rotatedBy(Math.PI/4),T.setRelativeTransform(_),g.setTestOnlyEffects1([we.createDropShadow1(1,Ie.FrozenVector_new4(1,1),E.BLACK,.5)])}),s("drop shadow: complex group shadow with nested groups and mixed transitions",c,(p,u)=>{let h=dn(p,"staticGroup1",E.TRANSPARENT);h.setIsBackgroundEnabled(!1),h.setRelativeTransform(new ne(1,0,30,0,1,50)),h.setTestOnlyEffects1([we.createDropShadow1(1,Ie.FrozenVector_new4(1,1),E.BLACK,.5)]),pe(h,"staticRectZ").setRelativeTransform(ne.new2());let y=dn(h,"rotatingGroup2",E.TRANSPARENT);y.setIsBackgroundEnabled(!1),pe(y,"rotatingRectA").setRelativeTransform(ne.new2()),pe(y,"staticRectB").setRelativeTransform(new ne(1,0,50,0,1,0));let T=dn(u,"staticGroup1",E.TRANSPARENT);T.setIsBackgroundEnabled(!1),T.setRelativeTransform(new ne(1,0,30,0,1,50)),T.setTestOnlyEffects1([we.createDropShadow1(1,Ie.FrozenVector_new4(1,1),E.BLACK,.5)]),pe(T,"staticRectZ").setRelativeTransform(ne.new2());let _=dn(T,"rotatingGroup2",E.TRANSPARENT);_.setIsBackgroundEnabled(!1),_.setRelativeTransform(ne.new2().rotatedBy(Math.PI/4)),pe(_,"rotatingRectA").setRelativeTransform(ne.new2().rotatedBy(Math.PI/3)),pe(_,"staticRectB").setRelativeTransform(new ne(1,0,50,0,1,0))}),s("inner shadow: complex group shadow with nested groups and mixed transitions",c,(p,u)=>{let h=dn(p,"staticGroup1",E.TRANSPARENT);h.setIsBackgroundEnabled(!1),h.setRelativeTransform(new ne(1,0,30,0,1,50)),h.setTestOnlyEffects1([we.createInnerShadow(1,Ie.FrozenVector_new4(1,1),E.BLACK,.5)]),pe(h,"staticRectZ").setRelativeTransform(ne.new2());let y=dn(h,"rotatingGroup2",E.TRANSPARENT);y.setIsBackgroundEnabled(!1),pe(y,"rotatingRectA").setRelativeTransform(ne.new2()),pe(y,"staticRectB").setRelativeTransform(new ne(1,0,50,0,1,0));let T=dn(u,"staticGroup1",E.TRANSPARENT);T.setIsBackgroundEnabled(!1),T.setRelativeTransform(new ne(1,0,30,0,1,50)),T.setTestOnlyEffects1([we.createInnerShadow(1,Ie.FrozenVector_new4(1,1),E.BLACK,.5)]),pe(T,"staticRectZ").setRelativeTransform(ne.new2());let _=dn(T,"rotatingGroup2",E.TRANSPARENT);_.setIsBackgroundEnabled(!1),_.setRelativeTransform(ne.new2().rotatedBy(Math.PI/4)),pe(_,"rotatingRectA").setRelativeTransform(ne.new2().rotatedBy(Math.PI/3)),pe(_,"staticRectB").setRelativeTransform(new ne(1,0,50,0,1,0))}),s("drop shadow: no node change but parent rotates",c,(p,u)=>{let h=et(p,"F");pe(h,"rect").setTestOnlyEffects1([we.createDropShadow1(1,Ie.FrozenVector_new4(1,1),E.BLACK,.5)]),h.setRelativeTransform(new ne(1,0,30,0,1,50));let y=pe(u,"F");pe(y,"rect").setTestOnlyEffects1([we.createDropShadow1(1,Ie.FrozenVector_new4(1,1),E.BLACK,.5)]);let A=ne.new3(h.relativeTransform());A.rotatedBy(Math.PI/4),y.setRelativeTransform(A)}),s("drop shadow: no node change but parent translates/resizes",c,(p,u)=>{let h=et(p,"F");pe(h,"rect").setTestOnlyEffects1([we.createDropShadow1(1,Ie.FrozenVector_new4(1,1),E.BLACK,.5)]),h.setRelativeTransform(new ne(1,0,30,0,1,50)),h.setSize(new I(100,100));let y=et(u,"F");pe(y,"rect").setTestOnlyEffects1([we.createDropShadow1(1,Ie.FrozenVector_new4(1,1),E.BLACK,.5)]);let A=ne.new3(h.relativeTransform());A.translate1(Ie.FrozenVector_new4(1,1)),y.setRelativeTransform(A),y.setSize(new I(100,200))}),s("transition between scrolling frames",d,(p,u)=>{p.setOverflowDirection("VERTICAL"),p.setTestOnlyFillPaints([ie.createSolid(E.RED,1)]),p.setTestOnlyEffects1([we.createDropShadow1(1,new I(1,1),E.BLACK,1)]),u.setTestOnlyFillPaints([ie.createSolid(E.BLUE,1)]),u.setTestOnlyEffects1([we.createDropShadow1(1,new I(1,1),E.BLACK,1)]);let h=Vt(p,"rect",E.GREEN,1);h.setSize(new I(p.size().x(),p.size().y()+100)),Vt(u,"rect",E.GREEN,1).setSize(h.size())}),s("scaling nodes whose children have different scaling factors",c,(p,u)=>{let h=et(p,"subframe");h.setSize(new I(100,100)),pe(h,"rect").setSize(new I(50,50));let y=et(u,"subframe");y.setSize(new I(200,200)),pe(y,"rect").setSize(new I(50,50))}),s("deeply nested scaling nodes whose children have different scaling factors",c,(p,u)=>{let h=et(p,"A");h.setSize(new I(100,100));let f=dn(h,"B",E.RED);f.setSize(new I(50,50)),dn(f,"C",E.BLACK).setSize(new I(10,10));let g=et(u,"A");g.setSize(new I(200,200));let A=pe(g,"B");A.setSize(new I(50,50)),dn(A,"C",E.BLACK).setSize(new I(10,10))}),s("transition between two screens with masks",c,(p,u)=>{let h=pe(p,"mask");h.setSize(new I(50,50)),h.setIsMask(!0),pe(p,"color").setSize(new I(100,100)),je(u,"andrew");let y=pe(u,"mask");y.setRelativeTransform(new ne(1,0,10,0,1,10)),y.setSize(new I(50,50)),y.setIsMask(!0),pe(u,"color").setSize(new I(100,100))}),s("MOVE_IN with unmatched layers nested inside of matched layers",["MOVE_FROM_RIGHT"],(p,u)=>{let h=et(p,"A");Vt(h,"A_1",E.BLUE,1);let f=et(u,"A");Vt(f,"A_2",E.GREEN,1)}),s("MOVE_IN with unmatched layers nested inside of matched fixed layers",["MOVE_FROM_RIGHT"],(p,u)=>{let h=et(p,"A");h.setScrollBehavior("FIXED_WHEN_CHILD_OF_SCROLLING_FRAME"),Vt(h,"A_1",E.BLUE,1);let f=et(u,"A");Vt(f,"A_2",E.GREEN,1)}),s("dissolving image fills with different geometries should separate into masks",c,(p,u)=>{_f(p,"tri",new I(100,100)),_f(u,"tri",new I(50,100))}),s("dissolving non-image fills with different geometries should NOT separate into masks",c,(p,u)=>{Af(p,"rect",E.RED,1,new I(100,100)),Af(u,"rect",E.GREEN,1,new I(50,100))}),ds("non-image rects with different geometries interpolate rounded rectangle parameters",()=>{let p=[];return c.forEach(u=>{i([(h,f)=>{Dr(h,"rect",E.RED,1,new I(100,100)),Dr(f,"rect",E.GREEN,1,new I(50,100));let y=new ne(1,0,0,0,1,1100-400),g=vt.FrozenAffineTransform_IDENTITY,A=Fo.getMagicMovePlan2(h,y,f,g,Rn.get(u));p.push(a.asyncAssertMatchesSnapshot(`plan ${u}`,A.debugString()));let T=()=>0,b=Ur.makeEasingFunction([0,0,1,1],.3),_=new Ni(A,T,b);p.push(a.asyncAssertMatchesSnapshot(`render tree ${u}`,_.renderTree().debugString1()))}])}),Promise.all(p)}),ds("non-image rects with different geometries and different effect spreads interpolate rounded rectangle + effect parameters",()=>{let p=[];return c.forEach(u=>{i([(h,f)=>{Dr(h,"rect",E.RED,1,new I(100,100)).setTestOnlyEffects1([we.createDropShadow2(1,new I(5,5),E.BLACK,.5,10)]),Dr(f,"rect",E.GREEN,1,new I(50,100)).setTestOnlyEffects1([we.createDropShadow2(1,new I(5,5),E.BLACK,.5,10)]);let A=new ne(1,0,0,0,1,1100-400),T=vt.FrozenAffineTransform_IDENTITY,b=Fo.getMagicMovePlan2(h,A,f,T,Rn.get(u));p.push(a.asyncAssertMatchesSnapshot(`plan ${u}`,b.debugString()));let _=()=>0,m=Ur.makeEasingFunction([0,0,1,1],.3),S=new Ni(b,_,m);p.push(a.asyncAssertMatchesSnapshot(`render tree ${u}`,S.renderTree().debugString1()))}])}),Promise.all(p)}),s("dissolving image rects with different geometries: render good-enough identical shadows for now",c,(p,u)=>{let h=[we.createDropShadow1(1,new I(5,5),E.BLACK,.5)];Td(p,"rect",new I(100,100)).setTestOnlyEffects1(h),Td(u,"rect",new I(50,100)).setTestOnlyEffects1(h)}),s("dissolving image rects with different geometries: non-identical shadows fall back to dissolve for now",c,(p,u)=>{Td(p,"rect",new I(100,100)).setTestOnlyEffects1([we.createDropShadow1(1,new I(5,5),E.BLACK,.5)]),Td(u,"rect",new I(50,100)).setTestOnlyEffects1([we.createDropShadow1(5,new I(5,5),E.BLACK,.5)])}),s("groups with drop shadows and moving children",c,(p,u)=>{let h=sa(p,"G");Dr(h,"A",E.RED,1,new I(10,10)),Dr(h,"B",E.GREEN,1,new I(10,10)),h.setTestOnlyEffects1([we.createDropShadow1(1,Ie.FrozenVector_new4(1,1),E.BLACK,.5)]);let f=sa(u,"G");f.setTestOnlyEffects1([we.createDropShadow1(1,Ie.FrozenVector_new4(1,1),E.BLACK,.5)]),Dr(f,"A",E.RED,1,new I(10,10)).setRelativeTransform(new ne(1,0,20,0,1,30)),Dr(f,"B",E.GREEN,1,new I(10,10)).setRelativeTransform(new ne(1,0,50,0,1,100))}),s("resizing resize-to-fit-groups without background paints",c,(p,u)=>{let h=sa(p,"G");Dr(h,"A",E.RED,1,new I(10,10)).setRelativeTransform(new ne(1,0,0,0,1,0)),Dr(h,"B",E.GREEN,1,new I(10,10)).setRelativeTransform(new ne(1,0,10,0,1,30)),h.setSize(new I(20,40));let g=sa(u,"G");Dr(g,"A",E.RED,1,new I(10,10)).setRelativeTransform(new ne(1,0,0,0,1,0)),Dr(g,"B",E.GREEN,1,new I(10,10)).setRelativeTransform(new ne(1,0,20,0,1,30)),g.setSize(new I(30,40))}),s("resizing resize-to-fit-groups with background paints",c,(p,u)=>{let h=[ie.createSolid(E.RED,1)],f=sa(p,"G");f.setTestOnlyFillPaints(h),Dr(f,"A",E.RED,1,new I(10,10)).setRelativeTransform(new ne(1,0,0,0,1,0)),Dr(f,"B",E.GREEN,1,new I(10,10)).setRelativeTransform(new ne(1,0,10,0,1,30)),f.setSize(new I(20,40));let A=sa(u,"G");A.setTestOnlyFillPaints(h),Dr(A,"A",E.RED,1,new I(10,10)).setRelativeTransform(new ne(1,0,0,0,1,0)),Dr(A,"B",E.GREEN,1,new I(10,10)).setRelativeTransform(new ne(1,0,20,0,1,30)),A.setSize(new I(30,40))}),s("transition between symbols with new frame properties",c,(p,u)=>{p.setType("SYMBOL"),p.setContainerSupportsFillStrokeAndCorners(!0),p.setTestOnlyFillPaints(p.fillPaints()),u.setType("SYMBOL"),u.setContainerSupportsFillStrokeAndCorners(!0),u.setTestOnlyFillPaints([ie.createSolid(E.RED,1)])}),s("Smart animate frames with reverse z-index",["SMART_ANIMATE"],(p,u)=>{let h=f=>{f.setStackReverseZIndex(!0),f.setStackMode("HORIZONTAL");let y=Vt(f,"A",E.RED,.5);y.setSize(new I(20,20)),y.setRelativeTransform(new ne(1,0,0,0,1,0));let g=Vt(f,"B",E.BLUE,.5);g.setSize(new I(20,20)),g.setRelativeTransform(new ne(1,0,10,0,1,0))};h(p),h(u)})})}r.testMagicMove=t;function n(){let o=AssertLib.deepEqual;beforeEach(()=>{Y.setViewerMode(Y.ViewerMode.PROTOTYPE)}),Ft("Drag vector computation:",()=>{Ce("Smart animate drag - matched object with translation",()=>{e([(a,s,l,d)=>{let c=pe(l,"rect");c.setRelativeTransform(new ne(1,0,30,0,1,50)),pe(d,"rect").setRelativeTransform(new ne(1,0,130,0,1,250));let u=Mn(c,d,"DRAG","SMART_ANIMATE","NAVIGATE"),h=hn.computeDragVector1(c,u,l,a.prototypeStructure(),a.prototypeState());o(h,new I(100,200))}])}),Ce("Smart animate drag - matched object with translation, rotation, and resizing",()=>{e([(a,s,l,d)=>{let c=pe(l,"rect");c.setSize(new I(100,100)),c.setRelativeTransform(ne.new2().translatedBy1(c.size().negative().divide(2)));let p=pe(d,"rect");p.setSize(new I(200,100));let u=ne.new2().translatedBy1(p.size().negative().divide(2));u.postRotate(Math.PI/2),u.postTranslate(new I(100,200)),p.setRelativeTransform(u);let h=Mn(c,d,"DRAG","SMART_ANIMATE","NAVIGATE"),f=hn.computeDragVector1(c,h,l,a.prototypeStructure(),a.prototypeState());o(f,new I(100,200))}])}),Ce("Smart animate drag - no matches",()=>{e([(a,s,l,d)=>{let c=pe(l,"rect");c.setRelativeTransform(new ne(1,0,30,0,1,50));let p=Mn(c,d,"DRAG","SMART_ANIMATE","NAVIGATE"),u=hn.computeDragVector1(c,p,l,a.prototypeStructure(),a.prototypeState());o(u,null)}])}),Ce("Smart animate drag - overlay swap with matched object with translation",()=>{e([(a,s,l,d)=>{let c=s.root().childAt1(0),p=et(c,"overlayA"),u=et(c,"overlayB"),h=pe(p,"rect");h.setRelativeTransform(new ne(1,0,30,0,1,50)),pe(u,"rect").setRelativeTransform(new ne(1,0,130,0,1,250));let y=Mn(h,u,"DRAG","SMART_ANIMATE","SWAP");Mn(l,p,"ON_CLICK","MOVE_FROM_LEFT","OVERLAY");let g=hn.computeDragVector1(h,y,l,a.prototypeStructure(),a.prototypeState());o(g,new I(100,200))}])}),Ce("Smart animate drag - overlay swap with no matches",()=>{e([(a,s,l,d)=>{let c=s.root().childAt1(0),p=et(c,"overlayA"),u=et(c,"overlayB"),h=pe(p,"rect");h.setRelativeTransform(new ne(1,0,30,0,1,50));let f=Mn(h,u,"DRAG","SMART_ANIMATE","SWAP");Mn(l,p,"ON_CLICK","MOVE_FROM_LEFT","OVERLAY");let y=hn.computeDragVector1(h,f,l,a.prototypeStructure(),a.prototypeState());o(y,null)}])}),Ce("Move in smart animate drag - matched object with translation",()=>{e([(a,s,l,d)=>{let c=pe(l,"rect");c.setRelativeTransform(new ne(1,0,30,0,1,50)),pe(d,"rect").setRelativeTransform(new ne(1,0,130,0,1,250));let u=ch(c,d,"DRAG","MOVE_FROM_LEFT","NAVIGATE",!0),h=hn.computeDragVector1(c,u,l,a.prototypeStructure(),a.prototypeState());o(h,new I(100,200))}])}),Ce("Move in smart animate drag - no matches",()=>{e([(a,s,l,d)=>{let c=pe(l,"rect");c.setRelativeTransform(new ne(1,0,30,0,1,50));let p=ch(c,d,"DRAG","MOVE_FROM_LEFT","NAVIGATE",!0),u=Rn.get("MOVE_FROM_LEFT").enteringFrameTransition(),h=d.size().multiply1(u.to().translation1().subtract1(u.from().translation1())),f=hn.computeDragVector1(c,p,l,a.prototypeStructure(),a.prototypeState());o(f,h)}])}),Ce("Screen swipe drag - nested node move in transition",()=>{e([(a,s,l,d)=>{let c=pe(l,"rect");c.setRelativeTransform(new ne(1,0,30,0,1,50));let p=Mn(c,d,"DRAG","MOVE_FROM_LEFT","NAVIGATE"),u=Rn.get("MOVE_FROM_LEFT").enteringFrameTransition(),h=d.size().multiply1(u.to().translation1().subtract1(u.from().translation1())),f=hn.computeDragVector1(c,p,l,a.prototypeStructure(),a.prototypeState());o(f,h)}])}),Ce("Screen swipe drag - nested node move out transition",()=>{e([(a,s,l,d)=>{let c=pe(l,"rect");c.setRelativeTransform(new ne(1,0,30,0,1,50));let p=Mn(c,d,"DRAG","MOVE_OUT_TO_LEFT","NAVIGATE"),u=Rn.get("MOVE_OUT_TO_LEFT").exitingFrameTransition(),h=l.size().multiply1(u.to().translation1().subtract1(u.from().translation1())),f=hn.computeDragVector1(c,p,l,a.prototypeStructure(),a.prototypeState());o(f,h)}])}),Ce("Screen swipe drag - TLF move in transition",()=>{e([(a,s,l,d)=>{let c=Mn(l,d,"DRAG","MOVE_FROM_LEFT","NAVIGATE"),p=Rn.get("MOVE_FROM_LEFT").enteringFrameTransition(),u=d.size().multiply1(p.to().translation1().subtract1(p.from().translation1())),h=hn.computeDragVector1(l,c,l,a.prototypeStructure(),a.prototypeState());o(h,u)}])}),Ce("Back screen swipe drag - TLF was opened by move in",()=>{e([(a,s,l,d)=>{Mn(l,d,"ON_CLICK","MOVE_FROM_LEFT","NAVIGATE"),dh(d),uh(d,"DRAG");let c=l.prototypeInteractions()[0],p=c.action().value;a.scene().setAllTlfsLoaded(),a.prototypeState().navigateToFrameAndCloseOverlays(l.id()),a.prototypeState().commitStateChange(),a.prototypeState().navigateToFrameAndCloseOverlays(p.transitionNodeID(),a.baseScreenNode(),1,0,4,c,p),a.prototypeState().commitStateChange();let u=Rn.get("MOVE_FROM_LEFT").reversed().exitingFrameTransition(),h=d.size().multiply1(u.to().translation1().subtract1(u.from().translation1())),f=d.prototypeInteractions()[0],y=hn.computeDragVector1(d,f,d,a.prototypeStructure(),a.prototypeState());o(y,h)}])}),Ce("Overlay swipe drag - overlay move in transition",()=>{e([(a,s,l,d)=>{Mn(l,d,"DRAG","MOVE_FROM_LEFT","OVERLAY"),d.setSize(new I(250,250)),d.setOverlayPositionType("TOP_LEFT");let c=hn.computeDragVector1(l,l.prototypeInteractions()[0],l,a.prototypeStructure(),a.prototypeState());o(c,new I(d.size().x(),0))}])}),Ce("Overlay swipe drag - overlay move in transition with nested source",()=>{e([(a,s,l,d)=>{let c=pe(l,"rect"),p=Mn(c,d,"DRAG","MOVE_FROM_LEFT","OVERLAY");d.setSize(new I(250,250)),d.setOverlayPositionType("TOP_LEFT");let u=hn.computeDragVector1(c,p,l,a.prototypeStructure(),a.prototypeState());o(u,new I(d.size().x(),0))}])}),Ce("Close overlay swipe drag - overlay opened by move in",()=>{e([(a,s,l,d)=>{let c=s.root().childAt1(0),p=et(c,"overlayA");p.setSize(new I(250,250)),p.setOverlayPositionType("TOP_LEFT");let u=pe(p,"rect");u.setRelativeTransform(new ne(1,0,30,0,1,50)),Mn(l,p,"ON_CLICK","MOVE_FROM_LEFT","OVERLAY"),ff(u),uh(u,"DRAG"),a.scene().setAllTlfsLoaded(),a.prototypeState().navigateToFrameAndCloseOverlays(l.id()),a.prototypeState().commitStateChange(),a.prototypeState().overlayFrame(p.id(),l,0,0,l.prototypeInteractions()[0],null),a.prototypeState().commitStateChange();let h=Rn.get("MOVE_FROM_LEFT").reversed().exitingFrameTransition(),f=p.size().multiply1(h.to().translation1().subtract1(h.from().translation1())),y=hn.computeDragVector1(u,u.prototypeInteractions()[0],l,a.prototypeStructure(),a.prototypeState());o(y,f)}])}),Ce("Overlay go back swipe drag - no back frame",()=>{e([(a,s,l,d)=>{d.setSize(new I(250,250)),d.setOverlayPositionType("TOP_LEFT"),Mn(l,d,"DRAG","MOVE_FROM_LEFT","OVERLAY"),dh(d),uh(d,"DRAG"),a.scene().setAllTlfsLoaded(),a.prototypeState().navigateToFrameAndCloseOverlays(l.id()),a.prototypeState().commitStateChange(),a.prototypeState().overlayFrame(d.id(),l,0,0,l.prototypeInteractions()[0],null),a.prototypeState().commitStateChange();let c=hn.computeDragVector1(d,d.prototypeInteractions()[0],l,a.prototypeStructure(),a.prototypeState());o(c,null)}])}),Ce("Drag - invalid navigate transition",()=>{e([(a,s,l,d)=>{Mn(l,d,"DRAG","DISSOLVE","NAVIGATE");let c=hn.computeDragVector1(l,null,l,a.prototypeStructure(),a.prototypeState());o(c,null)}])})}),Ft("Drag progress measurement:",()=>{let a=null;beforeEach(()=>{a=new la,ke.dangerouslyPushMockTime(a)}),afterEach(()=>{ke.popMockTime()}),Ce("Simple drag velocity and progress measurement",()=>{e([(s,l,d,c)=>{let u=AssertLib,h=(C,N,x)=>u(Math.abs(x-N)<=1e-14,`Expected velocity at timestep ${C} to equal ${N}, got ${x}`);s.prototypeState().setIsDragging(!0);let f=new hn(null,new I(1,0),null,null);f.handleDragStart(new I(0,0)),f.handleDrag(new I(0,0));let y=f.onTickProgress();o(y,0),a.advanceSeconds(1),f.handleDrag(new I(.5,0));let g=f.onTickProgress();o(g,.5);let A=f.signedDragSpeed();h(1,.5,A),a.advanceSeconds(.5),f.handleDrag(new I(1,0));let T=f.onTickProgress();o(T,1);let b=f.signedDragSpeed();h(2,1,b),a.advanceSeconds(1);let _=f.onTickProgress();o(_,1);let m=f.signedDragSpeed();h(3,0,m),a.advanceSeconds(.1),f.handleDrag(new I(.5,0));let S=f.onTickProgress();o(S,.5);let v=f.signedDragSpeed();h(4,-5,v)}])}),Ce("Different-direction drag velocity and progress measurement",()=>{e([(s,l,d,c)=>{let u=AssertLib,h=(S,v,C)=>u(Math.abs(C-v)<=1e-14,`Expected velocity at timestep ${S} to equal ${v}, got ${C}`);s.prototypeState().setIsDragging(!0);let f=new hn(null,new I(1,0),null,null);f.handleDragStart(new I(0,0)),f.handleDrag(new I(0,0));let y=f.onTickProgress();o(y,0),a.advanceSeconds(1),f.handleDrag(new I(0,.5));let g=f.onTickProgress();o(g,0);let A=f.signedDragSpeed();h(1,0,A),a.advanceSeconds(1),f.handleDrag(new I(-.5,0));let T=f.onTickProgress();o(T,0);let b=f.signedDragSpeed();h(2,-.5,b),a.advanceSeconds(1),f.handleDrag(new I(.5,1));let _=f.onTickProgress();o(_,.5);let m=f.signedDragSpeed();h(3,1,m)}])})})}r.testDragToAnimateBehavior=n})(vf||(vf={}));var Ah;(n=>{let i=()=>null;function e(r){r&&(i=r)}n.initialize=e;function t(r){return i(r)}n.getStatsigExpConfig=t})(Ah||(Ah={}));var Sh=class{constructor(e){this._session=null,this._preservers=[],this._isReconnecting=!1,this._session=e,this._session.addObserver(this),this._preservers.push(new Ef),this._preservers.push(new If)}handleSceneChangedLoadingPhase(e,t){t==1?this.handleSceneWillRebuildAfterReconnect():e==1&&t==2&&this.handleSceneDidRebuildAfterReconnect()}handleSceneWillRebuildAfterReconnect(){if(this._session.scene()==null){Ve("Scene unexpectedly null in handleSceneWillRebuildAfterReconnect");return}this._isReconnecting=!0,this._preservers.forEach(e=>{e.reset()}),this._session.scene().each(e=>{this._preservers.forEach(t=>{t.saveDataFromOldSceneNode(e)})})}handleSceneDidRebuildAfterReconnect(){this._isReconnecting=!1,this._preservers.forEach(e=>{e.restoreDataToNewScene(this._session.scene())}),this._preservers.forEach(e=>{e.reset()})}handleConnect(e,t){}handleDisconnect(){}handleJoinStart(e,t,n){}handleJoinEnd(){}handlePresenterChange(){}handleNodeChanges(){this._isReconnecting&&this._preservers.forEach(e=>{e.restoreDataToNewScene(this._session.scene())})}handleSceneGraphReply(e,t){}},If=class{constructor(){this._nodeDeveloperFriendlyIdToScrollOffset=null,this.reset()}reset(){this._nodeDeveloperFriendlyIdToScrollOffset=new Map}saveDataFromOldSceneNode(e){e.scrollDirection()!="NONE"&&!e.scrollOffset().equals(Ie.FrozenVector_ZERO)&&this._nodeDeveloperFriendlyIdToScrollOffset.set(e.developerFriendlyId(),e.scrollOffset())}restoreDataToNewScene(e){Be.StringMap_each(this._nodeDeveloperFriendlyIdToScrollOffset,(t,n)=>{let r=e.findNodeFromDeveloperFriendlyId(t);r!=null&&r.setScrollOffset(n)})}},Ef=class{constructor(){this._nodeDeveloperFriendlyIdsUsedAsBaseScreens=null,this.reset()}reset(){this._nodeDeveloperFriendlyIdsUsedAsBaseScreens=new Ar}saveDataFromOldSceneNode(e){e.usedAsBaseScreen()&&this._nodeDeveloperFriendlyIdsUsedAsBaseScreens.add(e.developerFriendlyId())}restoreDataToNewScene(e){this._nodeDeveloperFriendlyIdsUsedAsBaseScreens.each(t=>{let n=e.findNodeFromDeveloperFriendlyId(t);n!=null&&n.setUsedAsBaseScreen(!0)})}};var yh=class{constructor(e){this._scene=null,this.onChange=null,this._scene=e.scene(),e.addAppObserver(this)}handleSceneChange(e,t){e!=null&&e.removeObserver(this),t!=null&&t.addObserver(this),this._scene=t}handleActiveCanvasChange(e,t){}handleActivePrototypeStartingPointChange(e,t){}handleSceneGraphEvent(e){(e.node.type()=="CANVAS"||e.node.type()=="DOCUMENT")&&this.onChange(this.pages())}pages(){let e=[];if(this._scene!=null&&this._scene.root()!=null)for(let t=0;t<this._scene.root().childCount();t=t+1){let n=this._scene.root().childAt1(t);n.type()=="CANVAS"&&!n.isInternalOnly()&&e.push({id:n.id(),name:n.name()})}return e}};var bh=Wa(xs());var ST=(t=>(t[t.RENDER=0]="RENDER",t[t.PERFORMANCE=1]="PERFORMANCE",t))(ST||{}),Li=class Li{constructor(){this.flagsToClearOnNextPrototypeLoad=new Map;this.secret=null,this.app=null,this.viewer=null,this.basePath="",this.commandQueue=[],this.container=null,this._mockTime=null,this.testMode=0,this.figFileName="",this.initializePrototypeLib=null,this.bowser=null}static instance(){return Li._instance==null&&(Li._instance=new Li),Li._instance}requestWithSecret(e){let t=`secret=${encodeURIComponent(this.secret)}`;return new Mr(e+(e.indexOf("?")!=-1?"&":"?")+t)}getArgv(){return new Promise((e,t)=>{this.requestWithSecret("/rpc/argv").get().then(n=>{e(JSON.parse(n.text))})})}readFile(e,t){return this.requestWithSecret(`/rpc/file?path=${e}`).format(t).get()}writeFile(e,t){return this.requestWithSecret(`/rpc/file?path=${e}`).send2("POST",t)}exit(){this.requestWithSecret("/rpc/process?returnCode=0").send3("DELETE")}queryArgs(){let e=new Map,t=window.location.search;if(t.length==0)return e;t=t.slice(1);for(let n of t.split("&")){let r=n.split("=");r.length==2&&e.set(r[0],r[1])}return e}resolveFromBasePath(e){return e.startsWith("/")?e:this.basePath+"/"+e}afterRenderingCompletes(e){let t=()=>{this._triggerOnFrameCallbacksForTesting(),this.testMode==0&&this.app.canvasView().renderingIsComplete()&&!this.app.state().imageManager().hasPendingImages()||this.testMode==1&&!this.app.canvasView().isTopLevelTransitionOngoing()&&!this.app.state().imageManager().hasPendingImages()?e():requestAnimationFrame(t)};requestAnimationFrame(t)}afterInitialLoad(e){let t=()=>{e(),this.viewer.off("sceneDidCompleteInitialLoad",t)};this.viewer.on("sceneDidCompleteInitialLoad",t)}convertTitleToFilename(e,t,n,r,o){let a=t.trim();return o>0?`${a}${n}-${o}${r}`:`${a}${n}${r}`}figFileToName(e){let t=e.split("/");return t[t.length-1].replace(new RegExp(".fig$","g"),"")}computeBoundsForExport(e){let t=G.new3(e.canvasSpaceRenderedBounds());(Jt.isFrameLike(e.type())||e.type()=="SLICE")&&(t.isInvalid()?t=e.canvasSpaceBoundingBox():t.expandToInclude(e.canvasSpaceBoundingBox()));for(let n=e.parent();n!=null;n=n.parent())n.clipsToBoundingRectangle()&&t.intersectWith(n.canvasSpaceRenderedBounds());return t}saveCanvasContentToPathAsync(e,t){this.app.canvasView().getContext().gl().canvas.toBlob(r=>{this.writeFile(e,r).then(o=>{t()})})}_assertCurrentModeIsOneOf(e,t){if(e.indexOf(Y.getViewerMode())==-1){let n=e.map(r=>Y.ViewerMode[r]);throw new Error(`Command ${JSON.stringify(t)} is supported only in modes ${n}`)}}clearTestSpecificFeatureFlags(){this.flagsToClearOnNextPrototypeLoad.forEach((e,t)=>{Y.getFeatureFlags()[t]=e}),this.flagsToClearOnNextPrototypeLoad.clear()}runNextCommand(){if(this.commandQueue.length==0){this.exit();return}let e=this.commandQueue.shift();switch(e.type){case"load-canvas-as-prototype":{this._assertCurrentModeIsOneOf([Y.ViewerMode.PROTOTYPE],e),console.log(e.type,e.figFile),this.clearTestSpecificFeatureFlags(),this.figFileName=this.figFileToName(e.figFile),this.readFile(this.resolveFromBasePath(e.figFile),1).then(t=>{this.app.state().imageManager().resetForRenderingTests(),this.viewer.loadFile({bytes:t.bytes},this.initializePrototypeLib),this.afterInitialLoad(()=>{let n=gt.createLoadedFrameWithCanvasContent(this.app.state().scene(),this.app.state().getActiveCanvas()),r=n.canvasSpaceRenderedBounds();this.resize(r.width(),r.height()),this.app.state().prototypeState().setFitModeFromParameter("contain"),this.app.state().prototypeState().navigateToFrameAndCloseOverlays(n.id()),this.commandQueue.unshift({type:"save-canvas-as-image",outFile:e.outFile}),this.afterRenderingCompletes(()=>{this.runNextCommand()})})});break}case"load-prototype":{this._assertCurrentModeIsOneOf([Y.ViewerMode.PROTOTYPE],e),console.log(e.type,e.figFile,e.nodeId),this.clearTestSpecificFeatureFlags(),e.featureFlags&&e.featureFlags.forEach(t=>{for(var n in t)this.flagsToClearOnNextPrototypeLoad.set(n,Y.getFeatureFlags()[n]),Y.getFeatureFlags()[n]=t[n]}),this.figFileName=this.figFileToName(e.figFile),this.testMode==0&&this._mockTime.reset(),this.readFile(this.resolveFromBasePath(e.figFile),1).then(t=>{this.app.canvasView().dangerouslyAccessProtoRenderManager().clearTileCaches(),this.app.state().imageManager().resetForRenderingTests(),this.viewer.loadFile({bytes:t.bytes,interactiveComponentsEnabled:!0},this.initializePrototypeLib),this.afterInitialLoad(()=>{let n=this.app.state().scene();if(n!=null){let r=n.findNode2(e.nodeId);if(r.type()!="CANVAS")this.app.state().prototypeState().navigateToFrameAndCloseOverlays(r.id());else{this.app.state().setActiveCanvas(r);let o=Bt.visuallySortedTopLevelFrames(this.app.state().getActiveCanvas());if(o.length>0)this.app.state().prototypeState().navigateToFrameAndCloseOverlays(o[0].id());else throw new Error("no top level frames in prototype")}}this.app.state().prototypeState().setFitModeFromParameter(e.scalingMode),this.afterRenderingCompletes(()=>{this.runNextCommand()})})});break}case"set-top-level-frame":{this._assertCurrentModeIsOneOf([Y.ViewerMode.PROTOTYPE],e),console.log(e.type,e.nodeId);let t=this.app.state().scene();if(t==null)throw new Error("Missing scene in set-top-level-frame");let n=t.findNode2(e.nodeId);if(n==null)throw new Error("Missing node to navigate to");this.app.state().prototypeState().navigateToFrameAndCloseOverlays(n.id()),this.runNextCommand();break}case"scroll-node":{this._assertCurrentModeIsOneOf([Y.ViewerMode.PROTOTYPE],e);let t=this.app.state().scene();if(t==null)throw new Error("Missing scene in scroll-node");let n=t.findNode2(e.nodeId);if(n==null)throw new Error("Missing node in scroll-node");this.app.canvasView().updateScrollOffsetForNode(n,new I(+e.offset.x,+e.offset.y)),this.runNextCommand();break}case"trigger-hotspot":{this._assertCurrentModeIsOneOf([Y.ViewerMode.PROTOTYPE],e);let t=e.nodeId,n=Ut.TransitionAction_fromString(e.action);if(n==0)throw new Error(`Unrecognized action ${e.action}`);let r=this.app.state().scene();if(r==null)throw new Error(`Missing scene in ${e.type}`);let o=r.findNode2(t);if(o==null)throw new Error(`Missing node in ${e.type}`);let a=this.app.state().prototypeStructure().findPrototypeInteractionsWithInteractionType(o,Ut.TransitionAction_mapToInteractionType(n));if(a.length==0)throw new Error(`Could not find hotspot for action ${Tn[n]} on node ${t}`);this.app.canvasView().triggerHotspot(new Do(o),a[0],n,null),this.afterRenderingCompletes(()=>{this.runNextCommand()});break}case"advance-time":{this._assertCurrentModeIsOneOf([Y.ViewerMode.PROTOTYPE],e);let t=parseFloat(e.seconds),n=1/60;for(;t>n;)this._mockTime.advanceSeconds(n),this._triggerOnFrameCallbacksForTesting(),t-=n;t>0&&(this._mockTime.advanceSeconds(t),this._triggerOnFrameCallbacksForTesting()),this.runNextCommand();break}case"save-canvas-as-image":{this._assertCurrentModeIsOneOf([Y.ViewerMode.PROTOTYPE],e);let t=e.outFile;console.log("save-canvas-as-image",t),this.afterRenderingCompletes(()=>{this.saveCanvasContentToPathAsync(this.resolveFromBasePath(e.outFile),()=>{this.runNextCommand()})});break}case"write-performance-stats":{let t=this.app.canvasView().dangerouslyAccessProtoRenderManager().getAggregateTransitionStats(),n=Object.create(null);n.stats=Object.create(null),n.meta=Object.create(null),t.forEach((o,a)=>{n.stats[a]=o});for(let o of["runCount","deviceMode","flags"])n.meta[o]=e[o];let r=JSON.stringify(n);this.writeFile(e.outFile,new Blob([r],{type:"application/json"})).then(o=>{this.runNextCommand()});break}case"trigger-optional-oob-access-for-testing":{let t=D();t.modules().interactionTestHelpers.triggerOptionalOOBAccess(),t.modules().interactionTestHelpers.triggerReleaseReport(),t.modules().interactionTestHelpers.triggerSloge(),setTimeout(()=>{this.runNextCommand()},1e3);break}default:throw new Error(`Skipping unrecognized command ${e.type}`)}}writePerformanceResultsWhenFinished(e,t){this.commandQueue.push({type:"write-performance-stats",outFile:e,runCount:t.get("runCount"),deviceMode:t.get("deviceMode"),flags:t.get("flags")})}_triggerOnFrameCallbacksForTesting(){this.app.window().internalOnFrame()}resizeToFit(){this.resize(window.innerWidth*rr(),window.innerHeight*rr())}resize(e,t){this.container.style.width=`${Math.ceil(e/rr())}px`,this.container.style.height=`${Math.ceil(t/rr())}px`,this.app.window().notifyAll(new Co(2,this.app.window().root(),0)),this._triggerOnFrameCallbacksForTesting()}start(e,t,n){Li.instance().initializePrototypeLib=t,Li.instance().bowser=n,Rt.setImagePrefixURL(""),__();let r=decodeURIComponent(this.queryArgs().get("viewerMode"));if(r!="PROTOTYPE")throw new Error(`Invalid viewer mode '${r}'`);let o=this.queryArgs().get("testMode");switch(o){case"RENDER":{this.testMode=0;break}case"PERFORMANCE":{this.testMode=1;break}default:throw new Error(`Invalid viewer test mode '${o}'`)}this.secret=decodeURIComponent(this.queryArgs().get("secret")),this.container=document.createElement("div"),document.body.appendChild(this.container),this.getArgv().then(a=>{let s=a[0],l=s.split("/");ue.List_removeLast(l),this.basePath=l.join("/");let d={};for(let c=1,p=a.length;c<p;c=c+1){let u=a[c];u.length>=2&&u.charCodeAt(0)==45&&u.charCodeAt(1)==70&&(d[u.slice(2)]=!0)}if(this.viewer=e({workerURL:"ts-imagedecoder.js",containerElement:this.container,viewerMode:r,featureFlags:d,trackingSessionId:"unimportant dummy value",startNodeId:null,bowser:Li.instance().bowser,kiwiSchema:bh.compileSchema(bh.parseSchema(`// This is the schema for the file format. We use the Kiwi serialization format,
// which is a custom format that is similar to Google Protocol Buffers but
// customized for our needs: https://github.com/evanw/kiwi
//
// The files src/multiplayer/sync.h and resources/other/sync.bkiwi in fullscreen
// are automatically generated from this schema file every time you build
// fullscreen using Xcode. To manually generate the files, run the
// "fullscreen/scripts/generate_kiwi.sh" script.
//
// The "kiwic" compiler emits errors in a format that Xcode understands, so you
// should be able to edit the "sync.kiwi" file directly in Xcode and get inline
// errors if the build fails.
//
// Please ensure every property that is an index into the top-level "blobs"
// array ends in "Blob", like "fooBlob". This is used by the multiplayer
// server to automatically substitute blob values in the right places.

package Fig;

enum MessageType {
  JOIN_START = 0;
  NODE_CHANGES = 1;
  USER_CHANGES = 2;
  JOIN_END = 3;
  SIGNAL = 4;
  STYLE = 5;
  STYLE_SET = 6;

  // This message type is only sent if:
  //
  // - The client passes the "snapshot-hash" query parameter on connect
  // - The value for that parameter is the same as the current document
  // - There aren't any pending unsaved changes or active autosaves
  //
  // In this case, the client should skip reloading the document and just assume
  // that it's local document is the exact same as the server. This is just an
  // optimization to avoid needing to download and parse the document all over
  // again when the browser tab has timed out because it was in the background
  // and the network connection was idle. It's completely optional; if a client
  // doesn't want to handle JOIN_START_SKIP_RELOAD, it can just not pass the
  // "snapshot-hash" query parameter and the server will never send this type.
  JOIN_START_SKIP_RELOAD = 7;

  // Client upgrades work like this:
  //
  // 1) Client -> server:
  // - Make a WebSocket request with an old "version" URL parameter
  //
  // 2) Server -> client:
  // - Send the schema
  // - Send a NOTIFY_SHOULD_UPGRADE message
  //   - The "access" property is either READ_ONLY | READ_WRITE. The client
  //     should use this to update the "isReadOnly" state of the scene.
  //
  // 3) Client -> server:
  // - Send the schema
  //   - This is optional, and is currently unused by the server. We were
  //     thinking this could be nice to have if we ever change the wire
  //     protocol itself since the client definitely knows what format its
  //     messages are in.
  // - At this point the upgrade flow pauses until user action. We let the user
  //   continue to edit the document while we show a persistent banner at the
  //   top of the screen that prompts them to upgrade. When they click the
  //   upgrade button in this banner, we kick off the rest of the flow below.
  // - Send a NODE_CHANGES message for all local changes
  //   - This will happen if the document was already open and the user made
  //     some unsaved changes while disconnected.
  //   - Note that this currently happens even if the document is read-only.
  //     In that case the server will just reject all of that user's changes
  //     and they will be dropped on the floor when the client reloads.
  // - Send an UPGRADE_DONE message
  //
  // 4) Server -> client:
  // - Send an UPGRADE_REFRESH message
  //   - This lets the client know that its changes have been fully committed
  //     to the server and it's ok to reload.
  //
  // 5) Client -> server:
  // - Close the connection and reload
  //   - The client waits to reload until it gets the UPGRADE_REFRESH message
  //     to avoid losing data. If the client reloaded earlier, it might lose
  //     data because the message may not have ever reached the server. For
  //     example, the user's car might have just entered a tunnel and has no
  //     more internet connection.
  //
  // This whole sequence can be easily tested from the editor. Just choose
  // "Debug > Test Multiplayer Upgrade Protocol". That reconnects to the
  // multiplayer server with a special flag that forces the upgrade sequence.
  NOTIFY_SHOULD_UPGRADE = 8;
  UPGRADE_DONE = 9;
  UPGRADE_REFRESH = 10;
  SCENE_GRAPH_QUERY = 11;
  SCENE_GRAPH_REPLY = 12;

  DIFF = 13;

  // Sometimes clients want to send information to each other that, unlike
  // USER_CHANGES, is ephemeral. An example is when someone in the editor uses
  // the E shortcut to react to things in the editor. This shows temporary
  // emoji around the user's cursor on other clients. We DON'T want these to
  // show up when others join the file in future.
  CLIENT_BROADCAST = 14;

  // Sent to indicate that a journaled reconnect will be performed.
  JOIN_START_JOURNALED = 15;

  // To stream chunked NODE_CHANGES, the client needs to know whether to
  // decompress using a Zstd stream context or to individually decompress
  // messages. The server sends STREAM_START and STREAM_END messages
  // to indicate to the client when it should decompress using the Zstd
  // stream context and when to individually decompress messages.
  STREAM_START = 16;
  STREAM_END = 17;

  // Send changes to interactiveSlideParticipantData using this message type
  // from the Flides viewer. This allows viewers to write to this field.
  INTERACTIVE_SLIDE_CHANGE = 18;

  RECONNECT_SCENE_GRAPH_QUERY = 19;
  RECONNECT_SCENE_GRAPH_REPLY = 20;
}

enum Axis {
  X = 0;
  Y = 1;
}

enum Access {
  READ_ONLY = 0;
  READ_WRITE = 1;
}

enum NodePhase {
  CREATED = 0;
  REMOVED = 1;
}

enum WindingRule {
  NONZERO = 0;
  ODD = 1;
}

// Keep the names here up to date with serialization logic in FGNode.h
enum NodeType {
  NONE = 0;
  DOCUMENT = 1;
  CANVAS = 2;
  GROUP = 3;
  FRAME = 4;
  BOOLEAN_OPERATION = 5;
  VECTOR = 6;
  STAR = 7;
  LINE = 8;
  ELLIPSE = 9;
  RECTANGLE = 10;
  REGULAR_POLYGON = 11;
  ROUNDED_RECTANGLE = 12;
  TEXT = 13;
  SLICE = 14;
  SYMBOL = 15;
  INSTANCE = 16;
  STICKY = 17;
  SHAPE_WITH_TEXT = 18;
  CONNECTOR = 19;
  CODE_BLOCK = 20;
  WIDGET = 21;
  STAMP = 22;
  MEDIA = 23;
  HIGHLIGHT = 24;
  SECTION = 25;
  SECTION_OVERLAY = 26;
  WASHI_TAPE = 27;
  VARIABLE = 28;
  TABLE = 29;
  TABLE_CELL = 30;
  VARIABLE_SET = 31;
  SLIDE = 32;
  ASSISTED_LAYOUT = 33;
  INTERACTIVE_SLIDE_ELEMENT = 34;
  VARIABLE_OVERRIDE = 35;
  MODULE = 36;
}

enum ShapeWithTextType {
  SQUARE = 0;
  ELLIPSE = 1;
  DIAMOND = 2;
  TRIANGLE_UP = 3;
  TRIANGLE_DOWN = 4;
  ROUNDED_RECTANGLE = 5;
  PARALLELOGRAM_RIGHT = 6;
  PARALLELOGRAM_LEFT = 7;
  ENG_DATABASE = 8;
  ENG_QUEUE = 9;
  ENG_FILE = 10;
  ENG_FOLDER = 11;
  TRAPEZOID = 12;
  PREDEFINED_PROCESS = 13;
  SHIELD = 14;
  DOCUMENT_SINGLE = 15;
  DOCUMENT_MULTIPLE = 16;
  MANUAL_INPUT = 17;
  HEXAGON = 18;
  CHEVRON = 19;
  PENTAGON = 20;
  OCTAGON = 21;
  STAR = 22;
  PLUS = 23;
  ARROW_LEFT = 24;
  ARROW_RIGHT = 25;
  SUMMING_JUNCTION = 26;
  OR = 27;
  SPEECH_BUBBLE = 28;
  INTERNAL_STORAGE = 29;
}

// Keep the names here up to date with serialization logic in FGPaintHelpers.cpp
enum BlendMode {
  PASS_THROUGH = 0;
  NORMAL = 1;
  DARKEN = 2;
  MULTIPLY = 3;
  LINEAR_BURN = 4;
  COLOR_BURN = 5;
  LIGHTEN = 6;
  SCREEN = 7;
  LINEAR_DODGE = 8;
  COLOR_DODGE = 9;
  OVERLAY = 10;
  SOFT_LIGHT = 11;
  HARD_LIGHT = 12;
  DIFFERENCE = 13;
  EXCLUSION = 14;
  HUE = 15;
  SATURATION = 16;
  COLOR = 17;
  LUMINOSITY = 18;
}

enum PaintType {
  SOLID = 0;
  GRADIENT_LINEAR = 1;
  GRADIENT_RADIAL = 2;
  GRADIENT_ANGULAR = 3;
  GRADIENT_DIAMOND = 4;
  IMAGE = 5;
  EMOJI = 6;
  VIDEO = 7;
}

enum ImageScaleMode {
  STRETCH = 0;
  FIT = 1;
  FILL = 2;
  TILE = 3;
}

enum EffectType {
  INNER_SHADOW = 0;
  DROP_SHADOW = 1;
  FOREGROUND_BLUR = 2;
  BACKGROUND_BLUR = 3;
}

// Keep the names here up to date with serialization logic in FGSerialization.cpp
enum TextCase {
  ORIGINAL = 0;
  UPPER = 1;
  LOWER = 2;
  TITLE = 3;
  SMALL_CAPS = 4;
  SMALL_CAPS_FORCED = 5;
}

// Keep the names here up to date with serialization logic in FGSerialization.cpp
enum TextDecoration {
  NONE = 0;
  UNDERLINE = 1;
  STRIKETHROUGH = 2;
}

enum LeadingTrim {
  NONE = 0;
  CAP_HEIGHT = 1;
}

// Keep the names here up to date with serialization logic in FGSerialization.cpp
enum NumberUnits {
  RAW = 0;
  PIXELS = 1;
  PERCENT = 2;
}

enum ConstraintType {
  MIN = 0;
  CENTER = 1;
  MAX = 2;
  STRETCH = 3;
  SCALE = 4;

  // FIXED_MIN and FIXED_MAX are deprecated and should be parsed as MIN
  // and MAX. They were released internally, so there are documents on
  // staging with these values stored in them. We already released them
  // to users behind a feature flag. No external users should have been
  // able to create documents with these constraint values.
  FIXED_MIN = 5;
  FIXED_MAX = 6;
}

enum StrokeAlign {
  CENTER = 0;
  INSIDE = 1;
  OUTSIDE = 2;
}

enum StrokeCap {
  NONE = 0;
  ROUND = 1;
  SQUARE = 2;
  ARROW_LINES = 3;
  ARROW_EQUILATERAL = 4;
  DIAMOND_FILLED = 5;
  TRIANGLE_FILLED = 6;
  HIGHLIGHT = 7;
  WASHI_TAPE_1 = 8;
  WASHI_TAPE_2 = 9;
  WASHI_TAPE_3 = 10;
  WASHI_TAPE_4 = 11;
  WASHI_TAPE_5 = 12;
  WASHI_TAPE_6 = 13;
  CIRCLE_FILLED = 14;
}

enum StrokeJoin {
  MITER = 0;
  BEVEL = 1;
  ROUND = 2;
}

enum BooleanOperation {
  UNION = 0;
  INTERSECT = 1;
  SUBTRACT = 2;
  XOR = 3;
}

enum TextAlignHorizontal {
  LEFT = 0;
  CENTER = 1;
  RIGHT = 2;
  JUSTIFIED = 3;
}

enum TextAlignVertical {
  TOP = 0;
  CENTER = 1;
  BOTTOM = 2;
}

enum MouseCursor {
  DEFAULT = 0;
  CROSSHAIR = 1;
  EYEDROPPER = 2;
  HAND = 3;
  PAINT_BUCKET = 4;
  PEN = 5;
  PENCIL = 6;
  MARKER = 7;
  ERASER = 8;
  HIGHLIGHTER = 9;
}

// The order here matters. Moving geometry around may downgrade (decrement)
// the mirror mode but will never upgrade (increment) the mirror mode.
enum VectorMirror {
  NONE = 0;
  ANGLE = 1;
  ANGLE_AND_LENGTH = 2;
}

enum DashMode {
  CLIP = 0;
  STRETCH = 1;
}

// Keep the names here up to date with imageTypeFromEnumName() in FWImageIO.cpp
enum ImageType {
  PNG = 0;
  JPEG = 1;
  SVG = 2;
  PDF = 3;
}

// Keep the names here up to date with serialization logic in FGSerialization.cpp
enum ExportConstraintType {
  CONTENT_SCALE = 0;
  CONTENT_WIDTH = 1;
  CONTENT_HEIGHT = 2;
}

enum LayoutGridType {
  MIN = 0;
  CENTER = 1;
  STRETCH = 2;
  MAX = 3;
}

enum LayoutGridPattern {
  STRIPES = 0;
  GRID = 1;
}

enum TextAutoResize {
  NONE = 0;
  WIDTH_AND_HEIGHT = 1; // Don't wrap lines and adjust width and height automatically.
  HEIGHT = 2; // Wrap lines to fit existing width and adjust height automatically.
}

enum TextTruncation {
  DISABLED = 0;
  ENDING = 1;
}

enum StyleSetType {
  PERSONAL = 0;
  TEAM = 1;
  CUSTOM = 2;
  FREQUENCY = 3;
  TEMPORARY = 4;
}

enum StyleSetContentType {
  SOLID = 0;
  GRADIENT = 1;
  IMAGE = 2;
}

enum StackMode {
  NONE = 0;
  HORIZONTAL = 1;
  VERTICAL = 2;
}

enum StackAlign {
  MIN = 0;
  CENTER = 1;
  MAX = 2;
  BASELINE = 3;
}

enum StackCounterAlign {
  MIN = 0; // DEPRECATED - no longer used as of ALv3
  CENTER = 1; // DEPRECATED - no longer used as of ALv3
  MAX = 2; // DEPRECATED - no longer used as of ALv3
  STRETCH = 3;
  AUTO = 4;
  BASELINE = 5;
}

enum StackJustify {
  MIN = 0;
  CENTER = 1;
  MAX = 2;
  SPACE_EVENLY = 3; // DEPRECATED - new stacks will use SPACE_BETWEEN
  SPACE_BETWEEN = 4;
}

enum StackSize {
  FIXED = 0;
  RESIZE_TO_FIT = 1; // DEPRECATED - no longer used as of ALv3
  RESIZE_TO_FIT_WITH_IMPLICIT_SIZE = 2;
}

enum StackPositioning {
  AUTO = 0;
  ABSOLUTE = 1;
}

enum StackWrap {
  NO_WRAP = 0;
  WRAP = 1;
}

enum StackCounterAlignContent {
  AUTO = 0; // If all stack children are FILL in the counter axis, auto=stretch, otherwise auto=flex-start
  SPACE_BETWEEN = 1;
}

enum ConnectionType {
  NONE = 0;

  // Prototype link/hotspot points to a node in the same file
  // to perform a Navigation action (excludes MediaActions)
  INTERNAL_NODE = 1;

  // Prototype link/hotspot opens a URL
  URL = 2;

  // Goes to the previous frame
  BACK = 3;

  // Closes the overlay
  CLOSE = 4;

  // Changes the value of a variable
  SET_VARIABLE = 5;

  // Changes the runtime properties of media
  // Can point to a node in the same frame
  UPDATE_MEDIA_RUNTIME = 6;

  // Evaluates a conditional expression and executes a list of actions
  CONDITIONAL = 7;
}

enum InteractionType {
  ON_CLICK = 0;
  AFTER_TIMEOUT = 1;
  MOUSE_IN = 2;
  MOUSE_OUT = 3;
  ON_HOVER = 4;
  MOUSE_DOWN = 5;
  MOUSE_UP = 6;
  ON_PRESS = 7;
  NONE = 8;
  DRAG = 9;
  ON_KEY_DOWN = 10;
  ON_VOICE = 11;
  ON_MEDIA_HIT = 12;
  ON_MEDIA_END = 13;
  MOUSE_ENTER = 14;
  MOUSE_LEAVE = 15;
}

enum TransitionType {
  INSTANT_TRANSITION = 0;

  DISSOLVE = 1;

  FADE = 2;

  // Frame A moves over frame B while frame B
  // fades out and moves slightly in the direction
  // of the animation.
  SLIDE_FROM_LEFT = 3;
  SLIDE_FROM_RIGHT = 4;
  SLIDE_FROM_TOP = 5;
  SLIDE_FROM_BOTTOM = 6;

  // Frame A moves onto screen by pushing frame B
  // out of the way in the direction of the animation.
  // The frames never overlap.
  PUSH_FROM_LEFT = 7;
  PUSH_FROM_RIGHT = 8;
  PUSH_FROM_TOP = 9;
  PUSH_FROM_BOTTOM = 10;

  // Frame A moves over frame B in the direction of the
  // animation. Frame B remains in place and doesn't
  // change visually.
  MOVE_FROM_LEFT = 11;
  MOVE_FROM_RIGHT = 12;
  MOVE_FROM_TOP = 13;
  MOVE_FROM_BOTTOM = 14;

  // The current frame on screen slides in the direction OPPOSITE
  // to the one specified revealing the new frame under it which
  // fades in and moves slightly in the direction of
  // the animation.
  //
  // Why does ..._TO_LEFT actually move to the right? This was a
  // mistake when we picked these names, and changing names in our
  // file format is a huge pain so we've chosen to live with this
  // for now.
  SLIDE_OUT_TO_LEFT = 15;
  SLIDE_OUT_TO_RIGHT = 16;
  SLIDE_OUT_TO_TOP = 17;
  SLIDE_OUT_TO_BOTTOM = 18;

  // The current frame on screen moves in the direction OPPOSITE
  // to the one specified, revealing the new frame under it.
  //
  // Why does ..._TO_LEFT actually move to the right? This was a
  // mistake when we picked these names, and changing names in our
  // file format is a huge pain so we've chosen to live with this
  // for now.
  MOVE_OUT_TO_LEFT = 19;
  MOVE_OUT_TO_RIGHT = 20;
  MOVE_OUT_TO_TOP = 21;
  MOVE_OUT_TO_BOTTOM = 22;

  // DEPRECATED: This was deprecated in favor of SMART_ANIMATE below.
  MAGIC_MOVE = 23;

  // The current frame on screen transitions "magically" to match the
  // destination frame.
  SMART_ANIMATE = 24;

  SCROLL_ANIMATE = 25;
}

enum EasingType {
  IN_CUBIC = 0;
  OUT_CUBIC = 1;
  INOUT_CUBIC = 2;
  LINEAR = 3;
  IN_BACK_CUBIC = 4;
  OUT_BACK_CUBIC = 5;
  INOUT_BACK_CUBIC = 6;
  CUSTOM_CUBIC = 7;
  SPRING = 8;
  GENTLE_SPRING = 9;
  CUSTOM_SPRING = 10;
  SPRING_PRESET_ONE = 11;
  SPRING_PRESET_TWO = 12;
  SPRING_PRESET_THREE = 13;
}

enum ScrollDirection {
  NONE = 0;
  HORIZONTAL = 1;
  VERTICAL = 2;
  BOTH = 3;
}

enum ScrollContractedState {
  EXPANDED = 0;
  CONTRACTED = 1;
}

struct GUID {
  uint sessionID;
  uint localID;
}

struct Color {
  float r;
  float g;
  float b;
  float a;
}

struct Vector {
  float x;
  float y;
}

struct Rect {
  float x;
  float y;
  float w;
  float h;
}

struct ColorStop {
  Color color;
  float position;
}

struct Matrix {
  float m00;
  float m01;
  float m02;
  float m10;
  float m11;
  float m12;
}

struct ParentIndex {
  GUID guid;
  string position;
}

struct Number {
  float value;
  NumberUnits units;
}

struct FontName {
  string family;
  string style;
  string postscript;
}

enum FontVariantNumericFigure {
  NORMAL = 0;
  LINING = 1;
  OLDSTYLE = 2;
}

enum FontVariantNumericSpacing {
  NORMAL = 0;
  PROPORTIONAL = 1;
  TABULAR = 2;
}

enum FontVariantNumericFraction {
  NORMAL = 0;
  DIAGONAL = 1;
  STACKED = 2;
}

// Keep the names here up to date with serialization logic in FGSerialization.cpp
enum FontVariantCaps {
  NORMAL = 0;
  SMALL = 1;
  ALL_SMALL = 2;
  PETITE = 3;
  ALL_PETITE = 4;
  UNICASE = 5;
  TITLING = 6;
}

enum FontVariantPosition {
  NORMAL = 0;
  SUB = 1;
  SUPER = 2;
}

enum FontStyle {
  // Keep this up-to-date with \`FontStyle\` in \`FGFontFace.h\`
  NORMAL = 0;
  ITALIC = 1;
}

enum SemanticWeight {
  NORMAL = 0;
  BOLD = 1;
}

enum SemanticItalic {
  NORMAL = 0;
  ITALIC = 1;
}

// All registered OpenType features:
// https://docs.microsoft.com/en-us/typography/opentype/spec/featurelist
// Omitted tags:
//  \`pnum\`, \`tnum\`, \`lnum\`, \`lnum\` (covered by \`FontVariantNumericFigure\` and \`FontVariantNumericSpacing\`)
//  \`frac\` (covered by \`FontVariantNumericFraction\`)
//  \`smcp\`, \`c2sc\` (covered by \`FontVariantCaps\`)
//  \`subs\`, \`sups\` (covered by \`FontVariantPosition\`)

enum OpenTypeFeature {

    // Letter case
    PCAP = 0; // Petite Capitals
    C2PC = 1; // Petite Capitals from Capitals
    CASE = 2; // Case-Sensitive Forms
    CPSP = 3; // Capital Spacing
    TITL = 4; // Titling
    UNIC = 5; // Unicase

    // Numbers
    ZERO = 6; // Slashed Zero
    SINF = 7; // Scientific Inferiors
    ORDN = 8; // Ordinals
    AFRC = 9; // Alternative Fractions
    DNOM = 10; // Denominators
    NUMR = 11; // Numerators

    // Variants
    LIGA = 12; // Standard Ligatures
    CLIG = 13; // Contextual Ligatures
    DLIG = 14; // Discretionary Ligatures
    HLIG = 15; // Historical Ligatures
    RLIG = 16; // Required Ligatures
    AALT = 17; // Access All Alternates
    CALT = 18; // Contextual Alternates
    RCLT = 19; // Required Contextual Alternates
    SALT = 20; // Stylistic Alternates
    RVRN = 21; // Required Variation Alternates
    VERT = 22; // Vertical Alternates
    SWSH = 23; // Swash
    CSWH = 24; // Contextual Swash
    NALT = 25; // Alternate Annotation Forms
    CCMP = 26; // Glyph Composition/Decomposition
    STCH = 27; // Stretching Glyph Decomposition
    HIST = 28; // Historical Forms
    SIZE = 29; // Optical Size
    ORNM = 30; // Ornaments
    ITAL = 31; // Italics
    RAND = 32; // Randomize

    // Math
    DTLS = 33; // Dotless Forms
    FLAC = 34; // Flattened Ascent Forms
    MGRK = 35; // Mathematical Greek
    SSTY = 36; // Math script style alternates

    // Horizontal spacing
    KERN = 37; // Kerning
    FWID = 38; // Full Widths
    HWID = 39; // Half Widths
    HALT = 40; // Alternate Half Widths
    TWID = 41; // Third Widths
    QWID = 42; // Quarter Widths
    PWID = 43; // Proportional Widths
    JUST = 44; // Justification Alternates
    LFBD = 45; // Left Bounds
    OPBD = 46; // Optical Bounds
    RTBD = 47; // Right Bounds
    PALT = 48; // Proportional Alternate Widths
    PKNA = 49; // Proportional Kana

    // Writing direction
    LTRA = 50; // Left-to-right Alternates
    LTRM = 51; // Left-to-right Mirrored Forms
    RTLA = 52; // Right-to-left Alternates
    RTLM = 53; // Right-to-left Mirrored Forms

    // More features
    ABRV = 54; // Above-base Forms
    ABVM = 55; // Above-base Mark Positioning
    ABVS = 56; // Above-base Substitutions
    VALT = 57; // Alternate Vertical Metrics
    VHAL = 58; // Alternate Vertical Half Metrics
    BLWF = 59; // Below-base Forms
    BLWM = 60; // Below-base Mark Positioning
    BLWS = 61; // Below-base Substitutions
    AKHN = 62; // Akhand (Ligature Devanagari)
    CJCT = 63; // Conjuct Forms
    CFAR = 64; // Conjunct Form After Ro
    CPCT = 65; // Centered CJK Punctuation
    CURS = 66; // Cursive Positioning
    DIST = 67; // Distances
    EXPT = 68; // Expert Forms
    FALT = 69; // Final Glyph on Line Alternates
    FINA = 70; // Terminal Forms
    FIN2 = 71; // Terminal Form #2
    FIN3 = 72; // Terminal Form #3
    HALF = 73; // Half Forms
    HALN = 74; // Halant Forms
    HKNA = 75; // Horizontal Kana Alternates
    HNGL = 76; // Hangul
    HOJO = 77; // Hojo Kanji Forms
    INIT = 78; // Initial Forms
    ISOL = 79; // Isolated Forms
    JP78 = 80; // JIS78 Forms
    JP83 = 81; // JIS83 Forms
    JP90 = 82; // JIS90 Forms
    JP04 = 83; // JIS2004 Forms
    LJMO = 84; // Leading Jamo Forms (Hangul)
    LOCL = 85; // Localized Forms
    MARK = 86; // Mark Positioning (Arabic)
    MEDI = 87; // Medial Forms
    MED2 = 88; // Medial Forms #2
    MKMK = 89; // Mark-to-Mark Positioning
    NLCK = 90; // NLC Kanji Forms
    NUKT = 91; // Nukta Forms
    PREF = 92; // Pre-base Forms
    PRES = 93; // Pre-base Substitutions
    VPAL = 94; // Proportional Alternate Vertical Metrics
    PSTF = 95; // Post-base Forms
    PSTS = 96; // Post-base Substitutions
    RKRF = 97; // Rakar Forms
    RPHF = 98; // Reph Form
    RUBY = 99; // Ruby Notation Forms
    SMPL = 100; // Simplified Forms
    TJMO = 101; // Trailing Jamo Forms
    TNAM = 102; // Traditional Name Forms
    TRAD = 103; // Traditional Forms
    VATU = 104; // Vattu Variants
    VJMO = 105; // Vovel Jamo Forms
    VKNA = 106; // Vertical Kana Alternates
    VKRN = 107; // Vertical Kerning
    VRTR = 108; // Vertical Alternates for Rotation
    VRT2 = 109; // Vertical Alternates and Rotation

    // Variants: Stylistic Sets
    SS01 = 110; // Stylistic Set 1
    SS02 = 111; // Stylistic Set 2
    SS03 = 112; // Stylistic Set 3
    SS04 = 113; // Stylistic Set 4
    SS05 = 114; // Stylistic Set 5
    SS06 = 115; // Stylistic Set 6
    SS07 = 116; // Stylistic Set 7
    SS08 = 117; // Stylistic Set 8
    SS09 = 118; // Stylistic Set 9
    SS10 = 119; // Stylistic Set 10
    SS11 = 120; // Stylistic Set 11
    SS12 = 121; // Stylistic Set 12
    SS13 = 122; // Stylistic Set 13
    SS14 = 123; // Stylistic Set 14
    SS15 = 124; // Stylistic Set 15
    SS16 = 125; // Stylistic Set 16
    SS17 = 126; // Stylistic Set 17
    SS18 = 127; // Stylistic Set 18
    SS19 = 128; // Stylistic Set 19
    SS20 = 129; // Stylistic Set 20

    // Variants: Character Variants
    CV01 = 130; // Character Variants 1
    CV02 = 131; // Character Variants 2
    CV03 = 132; // Character Variants 3
    CV04 = 133; // Character Variants 4
    CV05 = 134; // Character Variants 5
    CV06 = 135; // Character Variants 6
    CV07 = 136; // Character Variants 7
    CV08 = 137; // Character Variants 8
    CV09 = 138; // Character Variants 9
    CV10 = 139; // Character Variants 10
    CV11 = 140; // Character Variants 11
    CV12 = 141; // Character Variants 12
    CV13 = 142; // Character Variants 13
    CV14 = 143; // Character Variants 14
    CV15 = 144; // Character Variants 15
    CV16 = 145; // Character Variants 16
    CV17 = 146; // Character Variants 17
    CV18 = 147; // Character Variants 18
    CV19 = 148; // Character Variants 19
    CV20 = 149; // Character Variants 20
    CV21 = 150; // Character Variants 21
    CV22 = 151; // Character Variants 22
    CV23 = 152; // Character Variants 23
    CV24 = 153; // Character Variants 24
    CV25 = 154; // Character Variants 25
    CV26 = 155; // Character Variants 26
    CV27 = 156; // Character Variants 27
    CV28 = 157; // Character Variants 28
    CV29 = 158; // Character Variants 29
    CV30 = 159; // Character Variants 30
    CV31 = 160; // Character Variants 31
    CV32 = 161; // Character Variants 32
    CV33 = 162; // Character Variants 33
    CV34 = 163; // Character Variants 34
    CV35 = 164; // Character Variants 35
    CV36 = 165; // Character Variants 36
    CV37 = 166; // Character Variants 37
    CV38 = 167; // Character Variants 38
    CV39 = 168; // Character Variants 39
    CV40 = 169; // Character Variants 40
    CV41 = 170; // Character Variants 41
    CV42 = 171; // Character Variants 42
    CV43 = 172; // Character Variants 43
    CV44 = 173; // Character Variants 44
    CV45 = 174; // Character Variants 45
    CV46 = 175; // Character Variants 46
    CV47 = 176; // Character Variants 47
    CV48 = 177; // Character Variants 48
    CV49 = 178; // Character Variants 49
    CV50 = 179; // Character Variants 50
    CV51 = 180; // Character Variants 51
    CV52 = 181; // Character Variants 52
    CV53 = 182; // Character Variants 53
    CV54 = 183; // Character Variants 54
    CV55 = 184; // Character Variants 55
    CV56 = 185; // Character Variants 56
    CV57 = 186; // Character Variants 57
    CV58 = 187; // Character Variants 58
    CV59 = 188; // Character Variants 59
    CV60 = 189; // Character Variants 60
    CV61 = 190; // Character Variants 61
    CV62 = 191; // Character Variants 62
    CV63 = 192; // Character Variants 63
    CV64 = 193; // Character Variants 64
    CV65 = 194; // Character Variants 65
    CV66 = 195; // Character Variants 66
    CV67 = 196; // Character Variants 67
    CV68 = 197; // Character Variants 68
    CV69 = 198; // Character Variants 69
    CV70 = 199; // Character Variants 70
    CV71 = 200; // Character Variants 71
    CV72 = 201; // Character Variants 72
    CV73 = 202; // Character Variants 73
    CV74 = 203; // Character Variants 74
    CV75 = 204; // Character Variants 75
    CV76 = 205; // Character Variants 76
    CV77 = 206; // Character Variants 77
    CV78 = 207; // Character Variants 78
    CV79 = 208; // Character Variants 79
    CV80 = 209; // Character Variants 80
    CV81 = 210; // Character Variants 81
    CV82 = 211; // Character Variants 82
    CV83 = 212; // Character Variants 83
    CV84 = 213; // Character Variants 84
    CV85 = 214; // Character Variants 85
    CV86 = 215; // Character Variants 86
    CV87 = 216; // Character Variants 87
    CV88 = 217; // Character Variants 88
    CV89 = 218; // Character Variants 89
    CV90 = 219; // Character Variants 90
    CV91 = 220; // Character Variants 91
    CV92 = 221; // Character Variants 92
    CV93 = 222; // Character Variants 93
    CV94 = 223; // Character Variants 94
    CV95 = 224; // Character Variants 95
    CV96 = 225; // Character Variants 96
    CV97 = 226; // Character Variants 97
    CV98 = 227; // Character Variants 98
    CV99 = 228; // Character Variants 99
}

struct ExportConstraint {
  ExportConstraintType type;
  float value;
}

struct GUIDMapping {
  GUID from;
  GUID to;
}

struct Blob {
  byte[] bytes;
}

message Image {
  byte[] hash = 1; // SHA1 of compressed data
  string name = 2; // Just for display, not referenced by anything
  uint dataBlob = 3; // An index into "blobs", stores a compressed PNG or JPG (optional, will be missing for messages sent over the wire)
}

message Video {
  byte[] hash = 1; // SHA1 of compressed data
  string s3Url = 2; // HACK(ldamasco): ideally we should be resolving the hash against sinatra to get the s3 url, not storing it directly in fig file

  // string name = 3; // Just for display, not referenced by anything
  // uint dataBlob = 4; // An index into "blobs", stores a compressed MP4 (optional, will be missing for messages sent over the wire)
}

message PasteSource {
  string srcFile = 1;
  GUID srcNode = 2;
}

// DEPRECATED
struct FilterColorAdjust {
  float tint;
  float shadows;
  float highlights;
  float detail;
  float exposure;
  float vignette;
  float temperature;
  float vibrance;
}

message PaintFilterMessage {
  float tint = 1;
  float shadows = 2;
  float highlights = 3;
  float detail = 4 [deprecated];
  float exposure = 5;
  float vignette = 6 [deprecated];
  float temperature = 7;
  float vibrance = 8;
  float contrast = 9;
  float brightness = 10 [deprecated];
}

message Paint {
  PaintType type = 1;
  Color color = 2;
  float opacity = 3;
  bool visible = 4;
  BlendMode blendMode = 5;
  ColorStop[] stops = 6;
  Matrix transform = 7;
  Image image = 8;
  Image imageThumbnail = 9;
  Image animatedImage = 16;
  uint animationFrame = 17;
  ImageScaleMode imageScaleMode = 10;
  // Will not exist / be false for images uploaded before color management
  // Will always be true for images uploaded in non-legacy documents after color management
  bool imageShouldColorManage = 22;


  // NOTE: Either the transform above is used (e.g. for ImageScaleMode::STRETCH),
  // or these decomposed parameters are used (e.g. for ImageScaleMode::TILE).
  float rotation = 11;
  float scale = 12;

  // DEPRECATED, this is not used anywhere.
  FilterColorAdjust filterColorAdjust = 13 [deprecated];

  PaintFilterMessage paintFilter = 14;

  uint[] emojiCodePoints = 15;

  // NOTE: videos still use \`image\` and \`imageThumbnail\` for cover images in the editor
  // Video Playback data is stored in the VideoPlayback node field.
  Video video = 18;

  // For a fill of type IMAGE, these fields store the dimensions of the
  // original (full-size) image.  This is needed to correctly render an
  // image with imageScaleMode == TILE before the original image is loaded.
  // Beware that this isn't always present (specifically it is missing from
  // fills created before this handling was added), so fullscreen needs to
  // be prepared to render image fills without this information.
  uint originalImageWidth = 19;
  uint originalImageHeight = 20;

  VariableData colorVar = 21;
}

message FontMetaData {
  FontName key = 1;
  float fontLineHeight = 2;
  byte[] fontDigest = 3;
  FontStyle fontStyle = 4;
  int fontWeight = 5;
}

message FontVariation {
  uint axisTag = 1;
  string axisName = 2;
  float value = 3;
}

message TextData {
  string characters = 1;
  uint[] characterStyleIDs = 2; // All style IDs after the end are assumed to be 0, meaning no override
  NodeChange[] styleOverrideTable = 3;

  Vector layoutSize = 4;
  Baseline[] baselines = 5;
  Glyph[] glyphs = 6;
  Decoration[] decorations = 7;
  Blockquote[] blockquotes = 16;

  uint layoutVersion = 8 [deprecated];

  FontMetaData[] fontMetaData = 9; // Used for CSS export when font is not locally available

  FontName[] fallbackFonts = 10 [deprecated];
  HyperlinkBox[] hyperlinkBoxes = 11;
  TextLineData[] lines = 12;

  int truncationStartIndex = 13;
  float truncatedHeight = 14;

  float[] logicalIndexToCharacterOffsetMap = 15;

  float minContentHeight = 17 [deprecated]; // Moved to layout data

  MentionBox[] mentionBoxes = 18;
  DerivedTextLineData[] derivedLines = 19;
}

message DerivedTextData {
  Vector layoutSize = 1;
  Baseline[] baselines = 2;
  Glyph[] glyphs = 3;
  Decoration[] decorations = 4;
  Blockquote[] blockquotes = 5;
  FontMetaData[] fontMetaData = 6; // Used for CSS export when font is not locally available
  HyperlinkBox[] hyperlinkBoxes = 7;
  int truncationStartIndex = 8;
  float truncatedHeight = 9;
  float[] logicalIndexToCharacterOffsetMap = 10;
  MentionBox[] mentionBoxes = 11;
  DerivedTextLineData[] derivedLines = 12;
}

message HyperlinkBox {
  Rect bounds = 1;

  // url/guid are copied directly from the Hyperlink object.
  string url = 2;
  GUID guid = 3;
  int hyperlinkID = 4;
}

message MentionBox {
  Rect bounds = 1; // bounds for mention background pill
  uint startIndex = 2; // first mention character index
  uint endIndex = 3; // last mention character index
  bool isValid = 4; // whether the mention is valid (i.e., file keys match)
  uint mentionKey = 5; // boxes with the same key refer to the same mention
}

message Baseline {
  Vector position = 1;
  float width = 2;
  float lineY = 3;
  float lineHeight = 4;
  float lineAscent = 7;
  float ignoreLeadingTrim = 8;

  uint firstCharacter = 5; // An index into "characters" in TextData
  uint endCharacter = 6; // An index past the last character into "characters" in TextData
}

message Glyph {
  uint commandsBlob = 1; // An index into "blobs"
  Vector position = 2;
  uint styleID = 3;
  float fontSize = 4;
  uint firstCharacter = 5; // An index into "characters" in TextData
  float advance = 6;
  uint[] emojiCodePoints = 7;
}

message Decoration {
  Rect[] rects = 1;
  uint styleID = 2;
}

message Blockquote {
  Rect verticalBar = 1;
  Rect quoteMarkBounds = 2;
  uint styleID = 3;
}

message VectorData {
  uint vectorNetworkBlob = 1; // An index into "blobs"
  Vector normalizedSize = 2;
  NodeChange[] styleOverrideTable = 3;
}

message GUIDPath {
  GUID[] guids = 1;
}

message SymbolData {
  GUID symbolID = 1;
  NodeChange[] symbolOverrides = 2; // Uses GUIDPath as map key
  float uniformScaleFactor = 3;
}

message GUIDPathMapping {
  GUID id = 1;
  GUIDPath path = 2;
}

message NodeGenerationData {
  // Uses GUIDPath as map key. These are details of the nodes that we should be generating.
  NodeChange[] overrides = 1;
  // Indicates whether overrides should be fine-grained synced over multiplayer,
  // keyed on the guid path and field. When true, if multiple clients are adding
  // overrides for different guid paths or changing values for different fields
  // on the same override path,  the multiplayer server merges the incoming diffs
  // so all changes are retained.
  bool useFineGrainedSyncing = 2;

  // Uses GUIDPath as map key. These indicate to multiplayer which fields should be removed
  // for an override path when using fine grained syncing. The reason why we use NodeChanges
  // here is to make the server-side diffing easier, since it's not safe to convert from a
  // uint32 indicating the field to a NodeChangeField. The actual value stored does not
  // matter; the only thing that matters is that there is a value stored.
  // See this Slack conversation for more context:
  // https://figma.slack.com/archives/CUWG9FWKH/p1668718183550959
  //
  // When using fine grained syncing, the messages sent to multiplayer for node generation
  // data are the diffs the client wants to apply, not the entire new value. This works well
  // for adding and changing values, but if a client wants to remove a field for an override
  // path, there is no way to represent that the diff using the just overrides field.
  //
  // This should *only* be used in the message from the client to multiplayer server, and
  // should always be empty when node generation data is saved to the file format.
  //
  // If a node generation data diff includes a path/field in both overrides and
  // diffOnlyRemovals, we will remove the path/field.
  NodeChange[] diffOnlyRemovals = 3;
}

message DerivedImmutableFrameData {
  NodeChange[] overrides = 1; // Uses GUIDPath as map key. These are details of the nodes that we should be generating.

  // A version number that we increment to invalidate derived
  // immutable frame data in the wild. See comment in FGNodeTypes
  // around DERIVED_IMMUTABLE_FRAME_DATA_VERSION for how to use this.
  uint version = 2;
}

message AssetIdMap {
  AssetIdEntry[] entries = 1;
}

message AssetIdEntry {
  string assetKey = 1;
  AssetId assetId = 2;
}

message AssetRef {
  string key = 1;
  string version = 2;
}

// For now, this field is only used for file-level asset versions,
// which does not include variable overrides and themes.
// If we want to broaden the use case of AssetId, we can expand it to include
// these other types of assets in the future.
message AssetId {
  // Deprecated fields
  GUID guid = 1 [deprecated];
  AssetRef assetRef = 2 [deprecated];

  // Only one of these should be populated.
  StateGroupId stateGroupId = 3;
  StyleId styleId = 4;
  SymbolId symbolId = 5;
  VariableID variableId = 6;
  VariableSetID variableSetId = 7;
  // moduleId is intentionally excluded because we never store references to modules on other nodes.
  // If this product requirement changes, add it as a field here.
}

message StateGroupId {
  // Populated on local
  GUID guid = 1;
  // Populated on subscribed
  AssetRef assetRef = 2;
}

message StyleId {
  // Populated on local
  GUID guid = 1;
  // Populated on subscribed
  AssetRef assetRef = 2;
}

message SymbolId {
  // Populated on local
  GUID guid = 1;
  // Populated on subscribed
  AssetRef assetRef = 2;
}

message VariableID {
  // Populated on local
  GUID guid = 1;
  // Populated on subscribed
  AssetRef assetRef = 2;
}

message VariableOverrideId {
  // Populated on local
  GUID guid = 1;
  // Populated on subscribed
  AssetRef assetRef = 2;
}

message VariableSetID {
  // Populated on local
  GUID guid = 1;
  // Populated on subscribed
  AssetRef assetRef = 2;
}

message ModuleId {
  // Populated on local
  GUID guid = 1;
  // Populated on subscribed
  AssetRef assetRef = 2;
}

message ThemeID {
  // Populated on local
  GUID guid = 1;
  // Populated on subscribed
  AssetRef assetRef = 2;
}

message SlideThemeData {
  ThemeID themeID = 1;
  string version = 2;
}

message SlideThemeProps {
  string themeVersion = 1;
  VariableSetID variableSetId = 2;
  StyleId[] textStyleIds = 3;
  bool isTextColorManuallySelected = 4;
  bool isBorderColorManuallySelected = 5;
  // Only populated for local themes. This is the ref to the
  // subscribed theme the local theme was created from.
  AssetRef subscribedThemeRef = 6;
}

message SlideThemeMap {
  SlideThemeMapEntry[] entries = 1;
}

message SlideThemeMapEntry {
  // Key of the map
  ThemeID themeId = 1;
  // Value of the map
  SlideThemeProps themeProps = 2;
}

message SharedSymbolReference {
  string fileKey = 1; // The fileKey of the document that publishes the Symbol. Will soon be deprecated by componentKey
  GUID symbolID = 2; // The symbolID as it exists in publishing document. Will soon be deprecated by componentKey
  string versionHash = 3; // The hash of the version of the published Symbol
  GUIDPathMapping[] guidPathMappings = 4; // Maps volatile local GUIDs to stable GUID paths.
  byte[] bytes = 5; // The actual serialized Symbol fig file
  GUIDMapping[] libraryGUIDToSubscribingGUID = 6 [deprecated]; // The goal of this was to map stable GUIDs in the team library to stable GUIDs in a subscribing document. This work was never finished
  string componentKey = 7; // Uniquely identifies the component within all of Figma. Will be hex digest of a SHA1 hash.
  GUIDPathMapping[] unflatteningMappings = 8;  // Maps from the old, unflattened GUIDs on this root symbol to new GUIDPaths in this root symbol.
  bool isUnflattened = 9; // Stores whether this shared symbol was last published unflattened.
}

message SharedComponentMasterData {
  string componentKey = 1; // The globally unique component key that references this component.
  GUIDPathMapping[] publishingGUIDPathToTeamLibraryGUID = 2; // Maps volatile local GUIDPaths to stable GUIDs in the team library.
  bool isUnflattened = 3; // Stores whether this shared component was published unflattened.
}

// This is deprecated! It turns out keying based on componentKey is a bad idea.
// https://paper.dropbox.com/doc/Problems-with-OverrideStash--BElX~69l3h5Ny8AWHe~aWEGsAg-jXmtLTn2kZEF9tqvlNOo5
message InstanceOverrideStash {
  // The override path to the instance swap we're caching overrides for. This
  // uses exactly the same path convention as SymbolData. This means the GUIDs
  // may not refer to local IDs. They may refer to remote IDs if the symbol is a
  // subscribed symbol.
  GUIDPath overridePathOfSwappedInstance = 1;

  // Identifies which symbol we're swapping to. We use this rather than the
  // local ID of the symbol in order to avoid needing to remap the override
  // stash when updating from the team library.
  string componentKey = 2;

  // Use overrides.guidPath as the override path key. Note that regardless of the
  // overridePathOfSwappedInstance, the guidPath key is always relative to the
  // primary instance.
  //
  // The remainder of the fields are used as overrides.
  NodeChange[] overrides = 3;
}

// This is deprecated!
message InstanceOverrideStashV2 {
  // The override path to the instance swap we're caching overrides for. This
  // uses exactly the same path convention as SymbolData. This means the GUIDs
  // may not refer to local IDs. They may refer to remote IDs if the symbol is a
  // subscribed symbol.
  GUIDPath overridePathOfSwappedInstance = 1;

  // Identifies which symbol we're swapping to. We use this rather than a
  // componentKey because componentKeys change when a file is duplicated!
  GUID localSymbolID = 2;

  // Use overrides.guidPath as the override path key. Note that regardless of the
  // overridePathOfSwappedInstance, the guidPath key is always relative to the
  // primary instance.
  //
  // The remainder of the fields are used as overrides.
  NodeChange[] overrides = 3;
}

message Effect {
  EffectType type = 1;
  Color color = 2;
  Vector offset = 3;
  float radius = 4;
  bool visible = 5;
  BlendMode blendMode = 6;
  float spread = 7;
  bool showShadowBehindNode = 8;

  VariableData radiusVar = 9;
  VariableData colorVar = 10;
  VariableData spreadVar = 11;
  VariableData xVar = 12;
  VariableData yVar = 13;
}

message TransitionInfo {
  TransitionType type = 1;
  float duration = 2;
}

enum PrototypeDeviceType {
  NONE = 0;
  PRESET = 1;
  CUSTOM = 2;
  PRESENTATION = 3;
}

enum DeviceRotation {
  NONE = 0;

  // "Counter clock-wise 90 degrees"
  CCW_90 = 1;
}

message PrototypeDevice {
  // If type is ::PRESET, then the size is inferred from \`presetIdentifier\`.
  // If type is ::CUSTOM, the device size is encoded in \`size\`.
  PrototypeDeviceType type = 1;
  Vector size = 2;

  // A string that uniquely identifies a device and style, e.g. "APPLE_IPHONE_X_SILVER"
  // These are uppercase versions of the file names in the Facebook Design devices repo.
  string presetIdentifier = 3;

  // Right now we expose a portrait/landscape option on device frames that toggles
  // devices between DeviceRotation.NONE and DeviceRotation.CCW_90.
  //
  // We think it's possible users will want to be able to rotate their devices 270
  // degrees as well in future (iPhone X, for example, looks different when rotated
  // on one side vs. the other).
  DeviceRotation rotation = 4;
}

enum OverlayPositionType {
  CENTER = 0;
  TOP_LEFT = 1;
  TOP_CENTER = 2;
  TOP_RIGHT = 3;
  BOTTOM_LEFT = 4;
  BOTTOM_CENTER = 5;
  BOTTOM_RIGHT = 6;
  MANUAL = 7;
}

enum OverlayBackgroundInteraction {
  NONE = 0;
  CLOSE_ON_CLICK_OUTSIDE = 1;
}

enum OverlayBackgroundType {
  NONE = 0;
  SOLID_COLOR = 1;
}

message OverlayBackgroundAppearance {
  OverlayBackgroundType backgroundType = 1;
  Color backgroundColor = 2;
}

enum NavigationType {
  NAVIGATE = 0;
  OVERLAY = 1;
  SWAP = 2;
  SWAP_STATE = 3;
  SCROLL_TO = 4;
}

// Represents ICC color profiles.
// This is different from ColorProfile (node field index 341) since:
// 1. There can be different ICC color profiles that represent
// the color profile (ex. ICC V4 vs ICC V2).
// 2. ColorProfile is used to represent Figma's color space
// while ExportColorProfile is used to represent profiles found in
// images.
enum ExportColorProfile {
  // Export in the same color profile as the document
  DOCUMENT = 0;
  // No profile will be embedded (previous behavior of exports); web specs mandate that
  // images without profiles are assumed to be sRGB
  SRGB = 1;
  // Embed Display P3 V4 profile
  DISPLAY_P3_V4 = 2;
}

message ExportSettings {
  string suffix = 1;
  ImageType imageType = 2;
  ExportConstraint constraint = 3;
  bool svgDataName = 4;
  ExportSVGIDMode svgIDMode = 5;
  bool svgOutlineText = 6;
  bool contentsOnly = 7;
  bool svgForceStrokeMasks = 8;
  bool useAbsoluteBounds = 9;
  ExportColorProfile colorProfile = 10;
}

enum ExportSVGIDMode {
  IF_NEEDED = 0;
  ALWAYS = 1;
}

message LayoutGrid {
  LayoutGridType type = 1;
  Axis axis = 2;
  bool visible = 3;
  int numSections = 4;
  float offset = 5;
  float sectionSize = 6;
  float gutterSize = 7;
  Color color = 8;
  LayoutGridPattern pattern = 9;

  VariableData numSectionsVar = 10;
  VariableData offsetVar = 11;
  VariableData sectionSizeVar = 12;
  VariableData gutterSizeVar = 13;
}

message Guide {
  Axis axis = 1;
  float offset = 2;
  GUID guid = 3;
}

message Path {
  WindingRule windingRule = 1;
  uint commandsBlob = 2; // An index into "blobs"
  uint styleID = 3; // Used to support per-region paints
}

// IMPORTANT:
// If you add a value, you must add it to \`VALID_STYLE_TYPES\` in lib/models/style.rb.
// Please never remove any of the StyleType values!
// They are stored in Postgres as strings (eg: "FILL", "TEXT", "EFFECT")
enum StyleType {
  NONE = 0;
  FILL = 1;
  STROKE = 2;
  TEXT = 3;
  EFFECT = 4;
  EXPORT = 5;
  GRID = 6;
}

message SharedStyleReference {
  string styleKey = 1; // The globally unique style key that references this style
  string versionHash = 2; // The hash of the version of the published Style
}

message SharedStyleMasterData {
  string styleKey = 1; // The globally unique style key that references this style
  string sortPosition = 2; // The sort position of the style, within its defining file
  string fileKey = 3; // The file where this style belongs to
}

enum ScrollBehavior {
  SCROLLS = 0;
  FIXED_WHEN_CHILD_OF_SCROLLING_FRAME = 1;
  STICKY_SCROLLS = 2;
}

message ArcData {
  // These are stored in radians
  float startingAngle = 1;
  float endingAngle = 2;
  // This is store as a ratio from 0 to 1
  float innerRadius = 3;
}

message SymbolLink {
  string uri = 1;
  string displayName = 2;
  string displayText = 3;
}

message PluginData {
  string pluginID = 1;
  string value = 2;
  string key = 3;
}

message PluginRelaunchData {
  string pluginID = 1;
  // This is used as description
  string message = 2;
  string command = 3;
  bool isDeleted = 4;
}

message MultiplayerFieldVersion {
  // Incremented by multiplayer with each accepted write. Clients must send up the latest
  // value in order to have their writes accepted, or match the previous \`sessionID\`.
  uint counter = 1;
  // The last session to bump the counter. This ensures consecutive writes from the same
  // client are accepted, instead of conflicting with themselves!
  uint sessionID = 2;
}

// Keep the connector fields in sync with FGConnectorFields.h
enum ConnectorMagnet {
  NONE = 0;
  AUTO = 1;
  TOP = 2;
  LEFT = 3;
  BOTTOM = 4;
  RIGHT = 5;
  CENTER = 6;
  AUTO_HORIZONTAL = 7;
}

message ConnectorEndpoint {
  GUID endpointNodeID = 1;
  Vector position = 2;
  ConnectorMagnet magnet = 3;
}

message ConnectorControlPoint {
  Vector position = 1;
  Vector axis = 2;
}

enum ConnectorTextSection {
  MIDDLE_TO_START = 0;
  MIDDLE_TO_END = 1;
}

message ConnectorTextMidpoint {
  ConnectorTextSection section = 1;
  float offset = 2;
}

enum ConnectorLineStyle {
  ELBOWED = 0;
  STRAIGHT = 1;
  CURVED = 2;
}

enum ConnectorType {
  MANUAL = 0;
  DIAGRAM = 1;
}

enum AnnotationPropertyType {
  FILL = 0;
  STROKE = 1;

  WIDTH = 2;
  HEIGHT = 3;
  MIN_WIDTH = 4;
  MIN_HEIGHT = 5;
  MAX_WIDTH = 6;
  MAX_HEIGHT = 7;

  STROKE_WIDTH = 8;
  CORNER_RADIUS = 9;

  EFFECT = 10;

  TEXT_STYLE = 11;
  TEXT_ALIGN_HORIZONTAL = 12;
  FONT_FAMILY = 13;
  FONT_SIZE = 14;
  FONT_WEIGHT = 15;
  LINE_HEIGHT = 16;
  LETTER_SPACING = 17;

  STACK_SPACING = 18;
  STACK_PADDING = 19;
  STACK_MODE = 20;
  STACK_ALIGNMENT = 21;

  OPACITY = 22;

  COMPONENT = 23;
}

message AnnotationProperty {
  AnnotationPropertyType type = 1;
}

message Annotation {
  string label = 1;
  AnnotationProperty[] properties = 2;
}

enum AnnotationMeasurementNodeSide {
  TOP = 0;
  BOTTOM = 1;
  LEFT = 2;
  RIGHT = 3;
}

message AnnotationMeasurement {
  GUID id = 1;
  // This lives on fromNode, however keeping the ID here is useful when
  // we are just keeping refs to AnnotationMeasurement in our application code.
  GUID fromNode = 2;
  GUID toNode = 3;
  AnnotationMeasurementNodeSide fromNodeSide = 4;
  // If fromNodeSide is TOP or BOTTOM, then toNodeSide must also be TOP or
  // BOTTOM. (And vice versa for LEFT and RIGHT). So we only need to track if
  // it's the same side or opposite through toSameSide.
  bool toSameSide = 5;
  float innerOffsetRelative = 6;
  float outerOffsetFixed = 7;
}

message LibraryMoveInfo {
  string oldKey = 1;
  string pasteFileKey = 2;
}

message LibraryMoveHistoryItem {
  GUID sourceNodeId = 1;
  string sourceComponentKey = 2;
}

message DeveloperRelatedLink {
  string nodeId = 1;
  string fileKey = 2;
  string linkName = 3;
  string linkUrl = 4;
}

// This is a pointer to a widget node in the scene. It's
// a message in case we want to store an override path
// in future (e.g. if widgets end up living in symbols).
message WidgetPointer {
  GUID nodeId = 1;
}

// This message contains information related to the last
// edit made on a node. Currently only contains timestamp in ISO8601
// format but is part of a message to allow it to be extended in the future
// with author attribution.
message EditInfo {
  string timestampIso8601 = 1;
  string userId = 2;
  uint lastEditedAt = 3;
  uint createdAt = 4;
}

enum EditorType {
  DESIGN = 0;
  WHITEBOARD = 1;
  SLIDES = 2;
}

enum MaskType {
  ALPHA = 0;
  OUTLINE = 1;
  LUMINANCE = 2;
}

enum ModuleType {
  NONE = 0;
  SINGLE_NODE = 1;
  MULTI_NODE = 2;
}

// Note: This was renamed to NodeStatus in C++. We had to keep the legacy
//       name here because renaming enums in the Kiwi schema is not supported.
enum SectionStatus {
  NONE = 0;
  BUILD = 1; // AKA "Ready for dev"
  // In the future, we can add a CUSTOM field here
}

// Note: This was renamed to NodeStatusInfo in C++. We had to keep the legacy
//       name here because renaming enums in the Kiwi schema is not supported.
message SectionStatusInfo {
  SectionStatus status = 1;
  // In the future, we can add a string field here to hold a custom tag
}

// NodeChange is grouped into pseudo-classes. We'd eventually like these
// groupings to be reflected as actual structs on the C++ side. Each class has a
// header and uses "Class extend SuperClass" syntax. To start with, we will
// probably manually implement the C++ side classes
//
// TODO: Figure out whether to use inheritance or composition. See
// https://github.com/figma/figma/pull/71145/files#r918328436 for discussion.
//
// TODO: Consider adding a first class "NodeFieldGroup" concept to kiwi and auto
// generate the class structure. NodeFieldGroup would also allow us to add new
// invariants that are currently impossible in kiwi. In particular, all fields
// of a message are optional. We could make it so that all or some of the fields
// in a group are required, but the group itself is optional. Although we'd
// probably not change multiplayer atomicity to account for groups. It would
// still be strictly NodeField-based probably, i.e. it would pretend the fields
// within a group were just inline in the group's parent message. Compared to
// adding a struct inside a message, this doesn't actually change the wire
// format or multiplayer atomicity. It just gives some extra type-safety style
// guarantees (similar to how TypeScript relates to JS).
//
// Here's the inheritance hierarcy (everything also inherits from NodeBase):
// - Asset
//   - Style
//   - Componentish
//     - Symbol
//     - StateGroup
// - Text
// - RenderableNode
// - AutoLayout
// - Plugin
// - Connector
// - FigJamShape
// - Widget
// - ForTest

message NodeChange {
  ///////////////////////////////////////
  // Last used node field index. We group nodefields by pseudo-class, but that
  // means it's annoying to figure out the next available index, so we document
  // that here. Please update this and the comment with the node field you added
  // if you add a new field so we can trigger merge conflicts pre-merge.
  //
  // next free node field index: 392, last node field name => emojiImageSet (391)
  ///////////////////////////////////////

  // We used to ensure every property "foo" has a corresponding "fooTag" property of type "uint", but the tags are now deprecated.

  ///////////////////////////////////////
  // NodeBase
  ///////////////////////////////////////
  GUID guid = 1;                                uint guidTag = 53 [deprecated];
  NodePhase phase = 2;                          uint phaseTag = 54 [deprecated];
  ParentIndex parentIndex = 3;                  uint parentIndexTag = 55 [deprecated];
  NodeType type = 4;                            uint typeTag = 56 [deprecated];
  string name = 5;                              uint nameTag = 57 [deprecated];


  ///////////////////////////////////////
  // Asset : NodeBase
  ///////////////////////////////////////
  // A generic boolean indicating if the node (e.g. a Style node)
  // can be published
  bool isPublishable = 174;
  string description = 318;
  LibraryMoveInfo libraryMoveInfo = 256;
  LibraryMoveHistoryItem[] libraryMoveHistory = 281;
  // The asset key; currently used by variable assets only.
  // componentKey and styleKey can eventually be merged into this field.
  string key = 319;

  // Populated only on the document node.
  // For all consumptions of an asset whose key is specified within this field,
  // resolve to the specified version.
  AssetIdMap fileAssetIds = 383;

  ///////////////////////////////////////
  // Style extends Asset
  ///////////////////////////////////////
  uint styleID = 49;
  uint styleIDTag = 101 [deprecated];
  bool isSoftDeletedStyle = 176; // will be replaced by isSoftDeleted
  bool isNonUpdateable = 177;
  bool isFillStyle = 157 [deprecated]; // replaced by styleType
  bool isStrokeStyle = 161 [deprecated];
  bool isOverrideOverTextStyle = 376;
  StyleType styleType = 163;
  string styleDescription = 191;
  // A generic hash of the version of the node
  // E.g. a Main style node uses version as the
  // main style version
  string version = 171;
  SharedStyleMasterData sharedStyleMasterData = 172;
  SharedStyleReference sharedStyleReference = 173;
  // The sort position of the style, within its defining file. This is currently
  // unused. It will be used as part of S2 removing
  // sharedStyleMasterData/sharedStyleReference.
  string sortPosition = 320;

  // Ignore this field. It was the predecessor to sevMoonlitLilyData and we were
  // feeling mischevious when we named it, but we've since renamed it for
  // clarity. It's not used for anything.
  SharedStyleMasterData ojansSuperSecretNodeField = 345 [deprecated];
  // This is a field populated for #sev-1-2023-03-20-moonlit-lily. Unless you're
  // specifically writing code to address this sev, ignore this field.
  SharedStyleMasterData sevMoonlitLilyData = 348;

  ///////////////////////////////////////
  // Componentish (Symbol | State Group) extends Asset
  ///////////////////////////////////////
  GUID inheritFillStyleID = 158;
  GUID inheritStrokeStyleID = 162;
  GUID inheritTextStyleID = 167;
  GUID inheritExportStyleID = 168;
  GUID inheritEffectStyleID = 169;
  GUID inheritGridStyleID = 170;
  GUID inheritFillStyleIDForStroke = 185;

  StyleId styleIdForFill = 332;
  StyleId styleIdForStrokeFill = 333;
  StyleId styleIdForText = 334;
  StyleId styleIdForEffect = 335;
  StyleId styleIdForGrid = 336;

  // TODO: Background paints no longer exist. Delete these two.
  Paint[] backgroundPaints = 193;
  GUID inheritFillStyleIDForBackground = 194 [deprecated];


  ///////////////////////////////////////
  // StateGroup extends Componentish
  ///////////////////////////////////////
  bool isStateGroup = 225;
  StateGroupPropertyValueOrder[] stateGroupPropertyValueOrders = 238;


  ///////////////////////////////////////
  // Symbol extends Componentish
  ///////////////////////////////////////
  SharedSymbolReference sharedSymbolReference = 122;

  // TODO: isSymbolPublishable could be merged with isPublishable at some point in the future
  // because they serve a similar purpose.
  bool isSymbolPublishable = 123;
  GUIDPathMapping[] sharedSymbolMappings = 124;

  // TODO: sharedSymbolVersion could be merged with version at some point in the future
  // because they serve a similar purpose.
  string sharedSymbolVersion = 126;

  SharedComponentMasterData sharedComponentMasterData = 152;
  string symbolDescription = 144;

  // Stores the mappings this symbol needs to correctly remap
  // its overrides in remote instances.
  GUIDPathMapping[] unflatteningMappings = 164;
  GUIDPathMapping[] forceUnflatteningMappings = 228;

  // c2: the following replace SharedComponentMasterData and SharedSymbolReference,
  // which aren't used in c2.
  string publishFile = 214;
  GUID publishID = 215;
  string componentKey = 216;
  bool isC2 = 217;  // Indicates whether file is under component 2.0 format
  string publishedVersion = 218;  // C2 field representing current published symbol version.

  // Deprecated
  string originComponentKey = 252 [deprecated];

  // eng-spec: http://go/ds-props
  ComponentPropDef[] componentPropDefs = 266;
  ComponentPropRef[] componentPropRefs = 267;

  ///////////////////////////////////////
  // Instance extends NodeBase
  ///////////////////////////////////////
  SymbolData symbolData = 113;                  uint symbolDataTag = 114 [deprecated]; // used by instance to reference overrides
  NodeChange[] derivedSymbolData = 125; // Uses GUIDPath as map key
  GUID overriddenSymbolID = 143;
  ComponentPropAssignment[] componentPropAssignments = 268;
  // https://paper.dropbox.com/doc/Bubbled-Props-Eng-Spec--BjWiuLkMXiUypzdlIpN8XJ7zAg-hoNxNifj2y8pdQ88w4rmd
  bool propsAreBubbled = 305;
  InstanceOverrideStash[] overrideStash = 248;
  InstanceOverrideStashV2[] overrideStashV2 = 250 [deprecated];

  ///////////////////////////////////////
  // Only used for NodeChanges within SymbolData.symbolOverrides (on instances).
  // These fields are not used independently.
  ///////////////////////////////////////
  GUIDPath guidPath = 111;                      uint guidPathTag = 112 [deprecated]; // used by instance override map
  int overrideLevel = 321;

  ///////////////////////////////////////
  // Module extends Asset
  ///////////////////////////////////////
  ModuleType moduleType = 382;


  ///////////////////////////////////////
  // Text extends NodeBase
  ///////////////////////////////////////
  float fontSize = 21;                          uint fontSizeTag = 73 [deprecated];
  float paragraphIndent = 22;                   uint paragraphIndentTag = 74 [deprecated];
  float paragraphSpacing = 23;                  uint paragraphSpacingTag = 75 [deprecated];
  TextAlignHorizontal textAlignHorizontal = 32; uint textAlignHorizontalTag = 84 [deprecated];
  TextAlignVertical textAlignVertical = 33;     uint textAlignVerticalTag = 85 [deprecated];
  TextCase textCase = 34;                       uint textCaseTag = 86 [deprecated];
  TextDecoration textDecoration = 35;           uint textDecorationTag = 87 [deprecated];
  Number lineHeight = 40;                       uint lineHeightTag = 92 [deprecated];
  FontName fontName = 41;                       uint fontNameTag = 93 [deprecated];
  TextData textData = 42;                       uint textDataTag = 94 [deprecated];
  DerivedTextData derivedTextData = 359;
  bool fontVariantCommonLigatures = 127;
  bool fontVariantContextualLigatures = 128;
  bool fontVariantDiscretionaryLigatures = 129;
  bool fontVariantHistoricalLigatures = 130;
  bool fontVariantOrdinal = 131;
  bool fontVariantSlashedZero = 132;
  FontVariantNumericFigure fontVariantNumericFigure = 133;
  FontVariantNumericSpacing fontVariantNumericSpacing = 134;
  FontVariantNumericFraction fontVariantNumericFraction = 135;
  FontVariantCaps fontVariantCaps = 136;
  FontVariantPosition fontVariantPosition = 137;
  Number letterSpacing = 165;
  // The version of the font referenced in fontName
  string fontVersion = 202;
  LeadingTrim leadingTrim = 322;
  bool hangingPunctuation = 337;
  bool hangingList = 339;
  int maxLines = 351;

  // Deprecated, use sectionStatusInfo instead.
  SectionStatus sectionStatus = 352 [deprecated];
  SectionStatusInfo sectionStatusInfo = 355;

  uint textUserLayoutVersion = 203;

  OpenTypeFeature[] toggledOnOTFeatures = 205;
  OpenTypeFeature[] toggledOffOTFeatures = 206;
  // This is currently only ever set as a style override within a text object
  Hyperlink hyperlink = 223;

  // Used for tracking at-mentions
  Mention mention = 340;

  FontVariation[] fontVariations = 260;
  uint textBidiVersion = 279;
  TextTruncation textTruncation = 280;
  bool hasHadRTLText = 292;
  EmojiImageSet emojiImageSet = 391;


  ///////////////////////////////////////
  // RenderableNode extends NodeBase
  ///////////////////////////////////////
  bool visible = 6;                             uint visibleTag = 58 [deprecated];
  bool locked = 7;                              uint lockedTag = 59 [deprecated];
  float opacity = 8;                            uint opacityTag = 60 [deprecated];
  BlendMode blendMode = 9;                      uint blendModeTag = 61 [deprecated];
  Vector size = 11;                             uint sizeTag = 63 [deprecated];
  Matrix transform = 12;                        uint transformTag = 64 [deprecated];
  float[] dashPattern = 13;                     uint dashPatternTag = 65 [deprecated];
  bool mask = 16;                               uint maskTag = 68 [deprecated];

  // Deprecated in favor of maskType
  bool maskIsOutline = 18;                      uint maskIsOutlineTag = 70 [deprecated];

  MaskType maskType = 317;
  float backgroundOpacity = 19;                 uint backgroundOpacityTag = 71 [deprecated];
  float cornerRadius = 20;                      uint cornerRadiusTag = 72 [deprecated];
  float strokeWeight = 26;                      uint strokeWeightTag = 78 [deprecated];
  StrokeAlign strokeAlign = 29;                 uint strokeAlignTag = 81 [deprecated];
  StrokeCap strokeCap = 30;                     uint strokeCapTag = 82 [deprecated];
  StrokeJoin strokeJoin = 31;                   uint strokeJoinTag = 83 [deprecated];
  Paint[] fillPaints = 38;                      uint fillPaintsTag = 90 [deprecated];
  Paint[] strokePaints = 39;                    uint strokePaintsTag = 91 [deprecated];
  Effect[] effects = 43;                        uint effectsTag = 95 [deprecated];
  Color backgroundColor = 50;                   uint backgroundColorTag = 102 [deprecated];
  Path[] fillGeometry = 51;                     uint fillGeometryTag = 103 [deprecated];
  Path[] strokeGeometry = 52;                   uint strokeGeometryTag = 104 [deprecated];

  // The following values address rectangle corner rounding:
  // Values 145-148 represent the radius of curvature of
  // each rectangle corner.  Value 149 controls whether the
  // rectangle is drawn using the global value (20) or the
  // four independent values (145-148).  We also need to keep
  // the state of the corner rounding tool (which is split
  // between web and fullscreen) because this behavior varies
  // independently of whether the rectangle's corners are
  // actually independent.  When the tool commits a change, we
  // update 145-148 and 149 appropriately.

  float rectangleTopLeftCornerRadius = 145;
  float rectangleTopRightCornerRadius = 146;
  float rectangleBottomLeftCornerRadius = 147;
  float rectangleBottomRightCornerRadius = 148;
  bool rectangleCornerRadiiIndependent = 149;
  bool rectangleCornerToolIndependent = 150;

  bool proportionsConstrained = 151;
  bool useAbsoluteBounds = 258 [deprecated];

  // These are no longer used! We realized it was simpler to represent a hidden border side by a
  // zero value on the border<side>Weight properties below
  bool borderTopHidden = 287 [deprecated];
  bool borderBottomHidden = 288 [deprecated];
  bool borderLeftHidden = 289 [deprecated];
  bool borderRightHidden = 290 [deprecated];

  bool bordersTakeSpace = 294;

  float borderTopWeight = 295;
  float borderBottomWeight = 296;
  float borderLeftWeight = 297;
  float borderRightWeight = 298;
  bool borderStrokeWeightsIndependent = 299;

  ///////////////////////////////////////
  // AutoLayout extends NodeBase
  ///////////////////////////////////////

  // TODO: Split this into two classes: 1. values on an AL frame, 2. values on children of AL frames

  ConstraintType horizontalConstraint = 28;     uint horizontalConstraintTag = 80 [deprecated];
  StackMode stackMode = 105;                    uint stackModeTag = 106 [deprecated];
  float stackSpacing = 107;                     uint stackSpacingTag = 108 [deprecated];
  float stackPadding = 109;                     uint stackPaddingTag = 110 [deprecated];
  // \`stackCounterAlign\` is being deprecated in favor of \`stackChildAlignSelf\`.
  // It's not marked [deprecated] because existing documents on prod which haven't been migrated may still depend on this field.
  // See https://paper.dropbox.com/doc/8272020-Auto-Layout-v3-server-side-migration-engineering-plan--A66p1t5jgmSnBoTeBJMAm~CkAg-cNFlCeZDA3JaJxB0DMe21
  StackCounterAlign stackCounterAlign = 120;

  // \`stackJustify\` is deprecated in favor of \`stackPrimaryAlignItems\`.
  // NOTE: This isn't marked deprecated yet because there are still some tests in file-importer that check this field.
  StackJustify stackJustify = 121;

  StackAlign stackAlign = 208 [deprecated];
  float stackHorizontalPadding = 209;
  float stackVerticalPadding = 210;

  // \`stackWidth\` and \`stackHeight\` are deprecated in favor of \`stackPrimarySizing\` and \`stackCounterSizing\`.
  StackSize stackWidth = 211 [deprecated];
  StackSize stackHeight = 212 [deprecated];

  StackSize stackPrimarySizing = 229;
  StackJustify stackPrimaryAlignItems = 230;
  StackAlign stackCounterAlignItems = 231;
  float stackChildPrimaryGrow = 232;
  float stackPaddingRight = 233;
  float stackPaddingBottom = 234;
  StackCounterAlign stackChildAlignSelf = 236;
  StackPositioning stackPositioning = 269;
  bool stackReverseZIndex = 271;
  StackWrap stackWrap = 323;
  float stackCounterSpacing = 324;
  OptionalVector minSize = 325;
  OptionalVector maxSize = 326;
  StackCounterAlignContent stackCounterAlignContent = 343;

  bool isSnakeGameBoard = 344 [deprecated];

  ///////////////////////////////////////
  // Prototyping extends NodeBase
  ///////////////////////////////////////
  GUID transitionNodeID = 139;
  GUID prototypeStartNodeID = 140;
  Color prototypeBackgroundColor = 141;
  // DEPRECATED - this was split into the individual fields below
  TransitionInfo transitionInfo = 153 [deprecated];
  TransitionType transitionType = 154;
  float transitionDuration = 155;
  EasingType easingType = 156;
  bool transitionPreserveScroll = 181;
  ConnectionType connectionType = 182;
  string connectionURL = 183;
  PrototypeDevice prototypeDevice = 184;
  // Describes the kind of interaction that triggers a navigation from
  // this node (e.g. click, mouse enter, mouse exit, etc.)
  InteractionType interactionType = 187;

  // DEPRECATED
  float transitionTimeout = 188;
  bool interactionMaintained = 189;
  float interactionDuration = 190;

  bool destinationIsOverlay = 192 [deprecated];
  bool transitionShouldSmartAnimate = 207;

  PrototypeInteraction[] prototypeInteractions = 226;
  PrototypeStartingPoint prototypeStartingPoint = 249;


  ///////////////////////////////////////
  // Plugin extends NodeBase
  ///////////////////////////////////////
  PluginData[] pluginData = 204;
  PluginRelaunchData[] pluginRelaunchData = 219;


  ///////////////////////////////////////
  // Connector extends NodeBase
  ///////////////////////////////////////
  ConnectorEndpoint connectorStart = 242;
  ConnectorEndpoint connectorEnd = 243;
  ConnectorLineStyle connectorLineStyle = 244;
  StrokeCap connectorStartCap = 245;
  StrokeCap connectorEndCap = 246;
  ConnectorControlPoint[] connectorControlPoints = 253;
  ConnectorTextMidpoint connectorTextMidpoint = 255;
  ConnectorType connectorType = 373;

  ///////////////////////////////////////
  // Annotations
  ///////////////////////////////////////
  Annotation[] annotations = 369;
  AnnotationMeasurement[] measurements = 384;

  ///////////////////////////////////////
  // FigJamShape extends NodeBase
  ///////////////////////////////////////
  ShapeWithTextType shapeWithTextType = 241;
  float shapeUserHeight = 247;

  // These are fields that are calculated as part of layout for immutable frames.
  // You can think of nodeGenerationData as the inputs or source of truth and derivedImmutableFrameData
  // as the outputs. This field is used as a cache so we don't have to recalculate these fields in the viewer.
  DerivedImmutableFrameData derivedImmutableFrameData = 254;

  // Sent over the wire only, not persisted. Used to prevent flickering between active clients.
  MultiplayerFieldVersion derivedImmutableFrameDataVersion = 338;

  // This is data that is used to build out child nodes in immutable frames (stickies, connectors, etc.)
  // these are the inputs that are used to generate the actualized nodes in the canvas.
  // A much better name for this field would be immutableFrameData, but we can't rename fields in kiwi.
  NodeGenerationData nodeGenerationData = 240;

  CodeBlockLanguage codeBlockLanguage = 259;
  LinkPreviewData linkPreviewData = 278;
  bool shapeTruncates = 282;
  bool sectionContentsHidden = 283;
  VideoPlayback videoPlayback = 300;
  StampData stampData = 301;
  SectionPresetInfo sectionPresetInfo = 370;


  ///////////////////////////////////////
  // Widget extends NodeBase
  ///////////////////////////////////////
  MultiplayerMap widgetSyncedState = 273;
  uint widgetSyncCursor = 274 [deprecated];
  WidgetDerivedSubtreeCursor widgetDerivedSubtreeCursor = 275 [deprecated];
  WidgetPointer widgetCachedAncestor = 276;
  WidgetInputBehavior widgetInputBehavior = 285;
  string widgetTooltip = 286;
  WidgetHoverStyle widgetHoverStyle = 291;
  bool isWidgetStickable = 293;
  bool shouldHideCursorsOnWidgetHover = 360;
  WidgetMetadata widgetMetadata = 262;
  WidgetEvent[] widgetEvents = 263;
  WidgetPropertyMenuItem[] widgetPropertyMenuItems = 265;

  ///////////////////////////////////////
  // Table extends NodeBase
  ///////////////////////////////////////
  TableRowColumnPositionMap tableRowPositions = 308;
  TableRowColumnPositionMap tableColumnPositions = 309;
  TableRowColumnSizeMap tableRowHeights = 310;
  TableRowColumnSizeMap tableColumnWidths = 311;

  ///////////////////////////////////////
  // InteractiveSlideElement extends NodeBase
  ///////////////////////////////////////
  MultiplayerMap interactiveSlideConfigData = 371;
  MultiplayerMap interactiveSlideParticipantData = 372;

  ///////////////////////////////////////
  // Speaker notes for Slides
  ///////////////////////////////////////

  // Represented as a JSON string
  string slideSpeakerNotes = 389;

  ///////////////////////////////////////
  // ThemeData for Slides
  ///////////////////////////////////////
  ThemeID themeID = 379;
  SlideThemeData slideThemeData = 381;
  SlideThemeMap slideThemeMap = 390;

  ///////////////////////////////////////
  // Assisted layout                   //
  ///////////////////////////////////////

  GUID diagramParentId = 363 [deprecated];
  GUID layoutRoot = 362 [deprecated];
  string layoutPosition = 364 [deprecated];
  DiagramLayoutRuleType diagramLayoutRuleType = 366;
  DiagramParentIndex diagramParentIndex = 367;
  DiagramLayoutPaused diagramLayoutPaused = 368;

  ///////////////////////////////////////
  // Page dividers
  ///////////////////////////////////////
  bool isPageDivider = 380;

  ///////////////////////////////////////
  // ForTest
  ///////////////////////////////////////
  // We use this for unit testing schema compatibility
  InternalEnumForTest internalEnumForTest = 251;

  // We use this for kiwi schema compatibility testing
  InternalDataForTest internalDataForTest = 257;


  ///////////////////////////////////////
  // TODO: triage all these into appropriate groups
  ///////////////////////////////////////
  uint count = 10;                              uint countTag = 62 [deprecated];
  bool autoRename = 14;                         uint autoRenameTag = 66 [deprecated];
  bool backgroundEnabled = 15;                  uint backgroundEnabledTag = 67 [deprecated];
  bool exportContentsOnly = 17;                 uint exportContentsOnlyTag = 69 [deprecated];
  float starInnerScale = 24;                    uint starInnerScaleTag = 76 [deprecated];
  float miterLimit = 25;                        uint miterLimitTag = 77 [deprecated];
  float textTracking = 27;                      uint textTrackingTag = 79 [deprecated];
  BooleanOperation booleanOperation = 36;       uint booleanOperationTag = 88 [deprecated];
  ConstraintType verticalConstraint = 37;       uint verticalConstraintTag = 89 [deprecated];
  VectorMirror handleMirroring = 44;            uint handleMirroringTag = 96 [deprecated];
  ExportSettings[] exportSettings = 45;         uint exportSettingsTag = 97 [deprecated];
  TextAutoResize textAutoResize = 46;           uint textAutoResizeTag = 98 [deprecated];
  LayoutGrid[] layoutGrids = 47;                uint layoutGridsTag = 99 [deprecated];
  VectorData vectorData = 48;                   uint vectorDataTag = 100 [deprecated];
  bool frameMaskDisabled = 115;                 uint frameMaskDisabledTag = 116 [deprecated];
  bool resizeToFit = 117;                       uint resizeToFitTag = 118 [deprecated];

  // don't add tags anymore... they will be removed in a future update
  bool exportBackgroundDisabled = 119;

  Guide[] guides = 138;
  bool internalOnly = 142;

  // This field would be better named OverflowDirection, which is
  // what the user sees in the UI. For that reason, most places in
  // the C++ & viewer code (but not web) also access it as OverflowDirection.
  ScrollDirection scrollDirection = 159;
  float cornerSmoothing = 160;
  Vector scrollOffset = 166 [deprecated];
  bool exportTextAsSVGText = 175;
  ScrollContractedState scrollContractedState = 178 [deprecated];
  // Due to a bug, some nodes in production have contractedSize set to some
  // non-zero value even thought it was never used for a feature used in production.
  Vector contractedSize = 179 [deprecated];
  string fixedChildrenDivider = 180 [deprecated];
  ScrollBehavior scrollBehavior = 186;

  ArcData arcData = 195;
  int derivedSymbolDataLayoutVersion = 196;

  NavigationType navigationType = 197;
  OverlayPositionType overlayPositionType = 198;
  Vector overlayRelativePosition = 199; // Deprecated into PrototypeAction
  OverlayBackgroundInteraction overlayBackgroundInteraction = 200;
  OverlayBackgroundAppearance overlayBackgroundAppearance = 201;

  // c2: durable stable ID for override mapping
  GUID overrideKey = 213;

  // This is present on a frames/instances/symbols which have been migrated to support
  // fill/stroke/corners during the \`frame_properties_migration\`.
  // Spec: https://paper.dropbox.com/doc/Tech-spec-frame-properties-8n6mTCIBtcMS7PEn50nOS
  bool containerSupportsFillStrokeAndCorners = 220;
  StackSize stackCounterSizing = 221;

  bool containersSupportFillStrokeAndCorners = 222 [deprecated];
  KeyTrigger keyTrigger = 224;
  string voiceEventPhrase = 227;
  GUID[] ancestorPathBeforeDeletion = 235;
  SymbolLink[] symbolLinks = 237;
  TextListData textListData = 239 [deprecated];

  bool detachOpticalSizeFromFontSize = 261;
  float listSpacing = 264;
  EmbedData embedData = 270;

  RichMediaData richMediaData = 272;
  // This is the value for synced state that represents what is
  // actually on the sceneGraph at a given time. This is not actually
  // used as a multiplayer map and should be synced atomically it just
  // shares the exact same shape.
  MultiplayerMap renderedSyncedState = 277;

  // Set on a component and controls whether a simpler layer and property panel is
  // shown for instances.
  bool simplifyInstancePanels = 284;

  // Used for accessibility annotations
  HTMLTag accessibleHTMLTag = 302;
  ARIARole ariaRole = 303;
  string accessibleLabel = 304;

  VariableData variableData = 306 [deprecated];

  // The following fields encode variable bindings on variable consumers:
  // 1. The consumption map contains bindings of simple fields.
  VariableDataMap variableConsumptionMap = 307;
  // 2. The modeBySet map contains the specific mode of variable sets used by
  // the consumer.
  VariableModeBySetMap variableModeBySetMap = 316;

  // Present on variable set nodes only.
  VariableSetMode[] variableSetModes = 312;

  // The following fields are present variable nodes only.
  // Identifies the set that the variable belongs to.
  VariableSetID variableSetID = 313;
  VariableResolvedDataType variableResolvedType = 314;
  // Specifies the variable data for the variable under each mode.
  VariableDataValues variableDataValues = 315;
  string variableTokenName = 350 [deprecated];

  // What scopes this variable is shown in (i.e. what fields can
  // this variable be used in). null = all fields
  VariableScope[] variableScopes = 353;

  // User defined token names for a variable, used in Lego and import/export
  CodeSyntaxMap codeSyntax = 358;

  // Information about where node is pasted from
  PasteSource pasteSource = 388;

  //////////////////////////////
  //// Extended collections ////
  //////////////////////////////

  // The ID of the base variable set or set extension a given variable set extension overrides
  VariableSetID backingVariableSetId = 377;
  // The ID of the base variable or variable override a given variable override applies to.
  VariableIdOrVariableOverrideId backingVariableId = 378 [deprecated];
  // Whether the given variable set is extendable (ie. an extended collection can be based off of it)
  bool isCollectionExtendable = 385;
  // The key of the root (e.g. not another override) variable that this override applies to.
  string rootVariableKey = 386;

  HandoffStatusMap handoffStatusMap = 361;

  AgendaPositionMap agendaPositionMap = 327;
  AgendaMetadataMap agendaMetadataMap = 328;

  // only set on the root DOCUMENT element
  MigrationStatus migrationStatus = 329;

  // generic replacement for isSoftDeletedStyle that can be applied to other asset types
  bool isSoftDeleted = 330;

  // only set on top level frames
  EditInfo editInfo = 331;

  // This is currently not being used but could be used in the future to allow for per node color profiles.
  // For the document color profile, see documentColorProfile.
  ColorProfile colorProfile = 341 [deprecated];

  // Set whenever an instance is detached, making it possible to find the original component later on.
  SymbolId detachedSymbolId = 342;

  // Controls the primary reading order for children of this node.
  ChildReadingDirection childReadingDirection = 346;
  // The explicit reading order for this node within its parent.
  string readingIndex = 347;

  // only set on the root DOCUMENT element
  DocumentColorProfile documentColorProfile = 349;

  // temporarily stores related links for copy and paste
  DeveloperRelatedLink[] developerRelatedLinks = 354;

  string slideActiveThemeLibKey = 356;

	// a map of ARIA attributes to their values (e.g. aria-checked="true")
  ARIAAttributesMap ariaAttributes = 357;

  // A list of the edit scope stacks that this node was changed under. May be multiple stacks if
  // this NodeChange sets multiple fields.
  // go/edit-scopes-backend
  EditScopeInfo editScopeInfo = 365;

  SemanticWeight semanticWeight = 374;
  SemanticItalic semanticItalic = 375;

  ///////////////////////////////////////
  // Sites
  ///////////////////////////////////////
  // Flag indicating whether a container (frame for now) is a group of related frames designed
  // for different screen sizes
  bool isResponsiveSet = 387;

  ///////////////////////////////////////
  // See top-level NodeChanges comment to find the next available field index.
  ///////////////////////////////////////
}

message VideoPlayback {
  bool autoplay = 1;
  bool mediaLoop = 2;
  bool muted = 3;
}

enum MediaAction {
  PLAY = 0;
  PAUSE = 1;
  TOGGLE_PLAY_PAUSE = 2;
  MUTE = 3;
  UNMUTE = 4;
  TOGGLE_MUTE_UNMUTE = 5;
  SKIP_FORWARD = 6;
  SKIP_BACKWARD = 7;
  SKIP_TO = 8;
}

message WidgetHoverStyle {
  Paint[] fillPaints = 1;
  Paint[] strokePaints = 2;
  float opacity = 3;
  bool areFillPaintsSet = 4;
  bool areStrokePaintsSet = 5;
  bool isOpacitySet = 6;
}

// Deprecated
message WidgetDerivedSubtreeCursor {
  uint sessionID = 1;
  uint counter = 2;
}

// A special type that knows how to diff and merge itself, allowing
// separate sessions to write to the map concurrently without
// clobbering each other's changes.
message MultiplayerMap {
  MultiplayerMapEntry[] entries = 1;
}

message MultiplayerMapEntry {
  string key = 1;
  string value = 2;
}

message VariableDataMap {
  VariableDataMapEntry[] entries = 1;
}

message VariableDataMapEntry {
  uint nodeField = 1; // deprecated, should write to variableField instead
  VariableData variableData = 2;
  VariableField variableField = 3;
}

enum VariableField {
  MISSING = 0;
  CORNER_RADIUS = 1; // deprecated, should write to RECTANGLE_X_X_CORNER_RADIUS instead
  PARAGRAPH_SPACING = 2;
  PARAGRAPH_INDENT = 3;
  STROKE_WEIGHT = 4; // deprecated, should write to BORDER_X_WEIGHT instead
  STACK_SPACING = 5;
  STACK_PADDING_LEFT = 6;
  STACK_PADDING_TOP = 7;
  STACK_PADDING_RIGHT = 8;
  STACK_PADDING_BOTTOM = 9;
  VISIBLE = 10;
  TEXT_DATA = 11;
  WIDTH = 12;
  HEIGHT = 13;
  RECTANGLE_TOP_LEFT_CORNER_RADIUS = 14;
  RECTANGLE_TOP_RIGHT_CORNER_RADIUS = 15;
  RECTANGLE_BOTTOM_LEFT_CORNER_RADIUS = 16;
  RECTANGLE_BOTTOM_RIGHT_CORNER_RADIUS = 17;
  BORDER_TOP_WEIGHT = 18;
  BORDER_BOTTOM_WEIGHT = 19;
  BORDER_LEFT_WEIGHT = 20;
  BORDER_RIGHT_WEIGHT = 21;
  VARIANT_PROPERTIES = 22;
  STACK_COUNTER_SPACING = 23;
  MIN_WIDTH = 24;
  MAX_WIDTH = 25;
  MIN_HEIGHT = 26;
  MAX_HEIGHT = 27;
  FONT_FAMILY = 28;
  FONT_STYLE = 29;
  FONT_VARIATIONS = 30;
  OPACITY = 31;
}

message VariableModeBySetMap {
  VariableModeBySetMapEntry[] entries = 1;
}

message VariableModeBySetMapEntry {
  VariableSetID variableSetID = 1;
  GUID variableModeID = 2;
}

message CodeSyntaxMap {
  CodeSyntaxMapEntry[] entries = 1;
}

message CodeSyntaxMapEntry {
  CodeSyntaxPlatform platform = 1;
  string value = 2;
}

message TableRowColumnPositionMap {
  TableRowColumnPositionMapEntry[] entries = 1;
}
message TableRowColumnPositionMapEntry {
  GUID id = 1;
  string position = 2;
}

message TableRowColumnSizeMap {
  TableRowColumnSizeMapEntry[] entries = 1;
}

message TableRowColumnSizeMapEntry {
  GUID id = 1;
  float size = 2;
}

message AgendaPositionMap {
  AgendaPositionMapEntry[] entries = 1;
}

message AgendaPositionMapEntry {
  GUID id = 1;
  string position = 2;
}

enum AgendaItemType {
  NODE = 0; // node (such as a section) associated with this particular agenda item
  BLOCK = 1; // free floating item not tied to any node, such as "break"
}

message AgendaMetadataMap {
  AgendaMetadataMapEntry[] entries = 1;
}

message AgendaMetadataMapEntry {
  GUID id = 1;
  AgendaMetadata data = 2;
}

message AgendaMetadata {
  string name = 1;
  AgendaItemType type = 2;
  GUID targetNodeID = 3; // optional node ID that points to a node on canvas, such as a section
  AgendaTimerInfo timerInfo = 4;
  AgendaVoteInfo voteInfo = 5;
  AgendaMusicInfo musicInfo = 6;
}

message AgendaTimerInfo {
  uint timerLength = 1;
}

message AgendaVoteInfo {
  uint voteCount = 1;
}

message AgendaMusicInfo {
  string songID = 1;
  uint startTimeMs = 2;
}

enum DiagramLayoutRuleType {
  NONE = 0;
  TREE = 1;
}

struct DiagramParentIndex {
  GUID guid;
  string position;
}

enum DiagramLayoutPaused {
  NO = 0;
  YES = 1;
}

message ComponentPropRef {
  uint nodeField = 1; // should not be written to and componentPropNodeField used instead
  GUID defID = 2;
  string zombieFallbackName = 3;
  ComponentPropNodeField componentPropNodeField = 4;
  bool isDeleted = 5; // deprecated
}

// Should be kept in sync with decodeComponentPropNodeField in serialization.sk
enum ComponentPropNodeField {
  VISIBLE = 0;
  TEXT_DATA = 1;
  OVERRIDDEN_SYMBOL_ID = 2;
  INHERIT_FILL_STYLE_ID = 3; // deprecated
}

message ComponentPropAssignment {
  GUID defID = 1;
  ComponentPropValue value = 2;
  VariableData varValue = 3;
}

message ComponentPropDef {
  GUID id = 1;
  string name = 2;
  // NOTE: In most places in the code, we refer to the component prop value
  // as the default value. This field is called initial value for historical
  // reasons; since we can't easily rename this here, we continue to refer to
  // default value as initial value when encoding/decoding kiwi messages.
  ComponentPropValue initialValue = 3;
  string sortPosition = 4;
  GUID parentPropDefId = 5;
  ComponentPropType type = 6;
  bool isDeleted = 7; // deprecated
  ComponentPropPreferredValues preferredValues = 8;
  VariableData varValue = 9;
}

// every ComponentPropDef and ComponentPropAssignment value
// will have exactly one field in ComponentPropValue set.
message ComponentPropValue {
  bool boolValue = 1;
  TextData textValue = 2;
  GUID guidValue = 3;
}

// Should be kept in sync with mapPublicComponentPropTypeToKiwi in jsvm_node_properties.ts
enum ComponentPropType {
  BOOL = 0;
  TEXT = 1;
  COLOR = 2; // deprecated
  INSTANCE_SWAP = 3;
}

message ComponentPropPreferredValues {
  string[] stringValues = 1 [deprecated];
  InstanceSwapPreferredValue[] instanceSwapValues = 2;
}

message InstanceSwapPreferredValue {
  InstanceSwapPreferredValueType type = 1;
  string key = 2;
}

enum InstanceSwapPreferredValueType {
  COMPONENT = 0;
  STATE_GROUP = 1;
}

enum WidgetEvent {
  MOUSE_DOWN = 0;
  CLICK = 1;
  TEXT_EDIT_END = 2;
  ATTACHED_STICKABLES_CHANGED = 3;
  STUCK_STATUS_CHANGED = 4;
}

enum WidgetInputBehavior {
  WRAP = 0;
  TRUNCATE = 1;
  MULTILINE = 2;
}

message WidgetMetadata {
  string pluginID = 1;
  string pluginVersionID = 2;
  string widgetName = 3;
}

enum WidgetPropertyMenuItemType {
  ACTION = 0;
  SEPARATOR = 1;
  COLOR = 2; // deprecated
  DROPDOWN = 3;
  COLOR_SELECTOR = 4;
  TOGGLE = 5;
  LINK = 6;
}

message WidgetPropertyMenuSelectorOption {
  string option = 1;
  string tooltip = 2;
}

message WidgetPropertyMenuItem {
  string propertyName = 1;
  string tooltip = 2;
  WidgetPropertyMenuItemType itemType = 3;
  string icon = 4; // svg string for the icon to display eg. "<svg ..."
  WidgetPropertyMenuSelectorOption[] options = 5; // array of strings used for selector menus
  string selectedOption = 6; // the selected value for selector menus
  bool isToggled = 7; // defaults to false, is true when button is selected
  string href = 8; // url to open for link menu items
  bool allowCustomColor = 9; // defaults to false, can be set to true to allow users to choose custom colors with the color selector
}

enum CodeBlockLanguage {
  TYPESCRIPT = 0;
  CPP = 1;
  RUBY = 2;
  CSS = 3;
  JAVASCRIPT = 4;
  HTML = 5;
  JSON = 6;
  GRAPHQL = 7;
  PYTHON = 8;
  GO = 9;
  SQL = 10;
  SWIFT = 11;
  KOTLIN = 12;
  RUST = 13;
  BASH = 14;
  PLAINTEXT = 15;
}

enum InternalEnumForTest {
  OLD = 1;
}

message InternalDataForTest {
  int testFieldA = 1;
}

message StateGroupPropertyValueOrder {
  string property = 1;
  string[] values = 2;
}

// Deprecated in favor of TextLineData
message TextListData {
  int listID = 1 [deprecated];
  BulletType bulletType = 2 [deprecated];
  int indentationLevel = 3 [deprecated];
  int lineNumber = 4 [deprecated];
}

// Deprecated in favor of LineType
enum BulletType {
  ORDERED = 0;
  UNORDERED = 1;
  INDENT = 2;
  NO_LIST = 3;
}

message TextLineData {
  LineType lineType = 1;
  int styleId = 10;
  int indentationLevel = 2;
  SourceDirectionality sourceDirectionality = 9;
  Directionality directionality = 3;
  DirectionalityIntent directionalityIntent = 4;
  int downgradeStyleId = 5;
  int consistencyStyleId = 6;
  int listStartOffset = 7;
  bool isFirstLineOfList = 8;
}

message DerivedTextLineData {
  Directionality directionality = 1;
}

enum LineType {
  PLAIN = 0;
  ORDERED_LIST = 1;
  UNORDERED_LIST = 2;
  BLOCKQUOTE = 3;
  HEADER = 4;
}

enum SourceDirectionality {
  AUTO = 0;
  LTR = 1;
  RTL = 2;
}

enum Directionality {
  LTR = 0;
  RTL = 1;
}

enum DirectionalityIntent {
  IMPLICIT = 0;
  EXPLICIT = 1;
}

message PrototypeInteraction {
  GUID id = 1;
  PrototypeEvent event = 2;
  PrototypeAction[] actions = 3;
  bool isDeleted = 4;
  int stateManagementVersion = 5;
}

message PrototypeEvent {
  InteractionType interactionType = 1;
  // When interactionType is MOUSE_IN/MOUSE_ENTER, MOUSE_OUT/MOUSE_LEAVE, MOUSE_DOWN or MOUSE_UP
  // and interactionMaintained is true, we wait for the interaction to "keep
  // going" for some specified duration before triggering its action.
  //
  // For example if interactionType is MOUSE_DOWN and interactionDuration
  // is 300, then we will wait for the user to continually mouse down for
  // 300ms before performing the requested action.
  bool interactionMaintained = 2;
  // Stored in milliseconds
  float interactionDuration = 3;
  // Used for keydown events transition triggers and in the future keyup
  KeyTrigger keyTrigger = 4;
  string voiceEventPhrase = 5;
  // If we transition to a node in the prototype view with
  // interactionType == AFTER_TIMEOUT, then after the duration specified
  // in transitionTimeout we should navigate again with whatever
  // transition properties are stored on this node.
  //
  // This duration is stored in ms.
  float transitionTimeout = 6;
  // Point in video to trigger ON_MEDIA_HIT events
  float mediaHitTime = 7;
}

// The information about a variable we're targetting for a
// Set Variable PrototypeAction. This may grow to include info about
// modes.
message PrototypeVariableTarget {
  VariableID id = 1;
}

// The list of actions to execute for Conditional actions in prototype interactions
message ConditionalActions {
  PrototypeAction[] actions = 1;
  VariableData condition = 2;
}

message PrototypeAction {
  GUID transitionNodeID = 1;
  TransitionType transitionType = 2;
  float transitionDuration = 3;
  EasingType easingType = 4;
  // This was moved into PrototypeEvent
  float transitionTimeout = 5 [deprecated];
  bool transitionShouldSmartAnimate = 6;
  ConnectionType connectionType = 7;
  string connectionURL = 8;
  Vector overlayRelativePosition = 9;
  NavigationType navigationType = 10;
  bool transitionPreserveScroll = 11;
  float[] easingFunction = 12;
  Vector extraScrollOffset = 13;

  // For Set Variable action
  // Deprecated for the VariableID version below
  GUID targetVariableID = 14 [deprecated];

  // For Set Variable action
  // Deprecated for targetVariableData
  VariableAnyValue targetVariableValue = 15 [deprecated];


  MediaAction mediaAction = 16;
  bool transitionResetVideoPosition = 17;
  bool openUrlInNewTab = 18;

  PrototypeVariableTarget targetVariable = 19;
  VariableData targetVariableData = 20;

  // Point in video for SET_TO media actions (in seconds)
  float mediaSkipToTime = 21;
  // Time delta to change the video by for SKIP_FORWARD/BACKWARD media actions (in seconds)
  float mediaSkipByAmount = 22;

  // This is deprecated in favor of the conditionalActions field
  VariableData[] conditions = 23;

  // This array holds the list of conditions and the actions to be run if said
  // condition is true.  We will iterate through each conditionalAction object
  // and find the first one with a true condition, then run its actions.
  ConditionalActions[] conditionalActions = 24;

  bool transitionResetScrollPosition = 25;
  bool transitionResetInteractiveComponents = 26;
}

message PrototypeStartingPoint {
  string name = 1;
  string description = 2;
  string position = 3;  // this is a string and not a number in order to use Fractional Indexing
}

enum TriggerDevice {
  KEYBOARD = 0;
  UNKNOWN_CONTROLLER = 1;
  XBOX_ONE = 2;
  PS4 = 3;
  SWITCH_PRO = 4;
}

message KeyTrigger {
  int[] keyCodes = 1;
  TriggerDevice triggerDevice = 2;
}

message Hyperlink {
  // This object either contains a url or a node ID -- never both!
  string url = 1;
  GUID guid = 2;
}

enum MentionSource {
  DEFAULT = 0;
  COPY_DUPLICATE = 1;
}

message Mention {
  GUID id = 1;
  string mentionedUserId = 2; // deprecated - use mentionedUserIdInt
  string mentionedByUserId = 3; // deprecated - use mentionedByUserIdInt
  // Allows us to ignore mentions that came from file duplication
  string fileKey = 4;
  // Where did the mention came from. Used to filter which ones should be processed
  MentionSource source = 5;

  uint64 mentionedUserIdInt = 6;
  uint64 mentionedByUserIdInt = 7;
}


message EmbedData {
  string url = 1;
  string srcUrl = 2;
  string title = 3;
  string thumbnailUrl = 4;
  float width = 5;
  float height = 6;

  string embedType = 7;
  string thumbnailImageHash = 8;
  string faviconImageHash = 9;
  string provider = 10;
  string originalText = 11;
  string description = 12;
  // embedVersionId is a string in the form of "v0", "v1", etc - each integer is a 1:1 mapping to which embed React component will be rendered
  string embedVersionId = 13;
}

message StampData {
  string userId = 1;
  string votingSessionId = 2;
  string stampedByUserId = 3;
}

message LinkPreviewData {
  string url = 1;
  string title = 2;
  string provider = 3;
  string description = 4;
  string thumbnailImageHash = 5;
  string faviconImageHash = 6;
  float thumbnailImageWidth = 7;
  float thumbnailImageHeight = 8;
}

message Viewport {
  Rect canvasSpaceBounds = 1;
  bool pixelPreview = 2;
  float pixelDensity = 3;
  GUID canvasGuid = 4;
}

message Mouse {
  MouseCursor cursor = 1;
  Vector canvasSpaceLocation = 2;
  Rect canvasSpaceSelectionBox = 3;
  GUID canvasGuid = 4;
  uint cursorHiddenReason = 5;
}

struct Click {
  uint id;
  Vector point; // In canvas space
}

struct ScrollPosition {
  GUID node;
  Vector scrollOffset;
}

// DEPRECATED
struct TriggeredOverlay {
  GUID overlayGuid;
  GUID hotspotGuid;
  GUID swapGuid;
}

message TriggeredOverlayData {
  GUID overlayGuid = 1;
  GUID hotspotGuid = 2; // TODO(achan): Deprecate
  GUID swapGuid = 3;
  GUID prototypeInteractionGuid = 4;

  GUIDPath hotspotBlueprintId = 5;
}

message TriggeredSetVariableActionData {
  GUID nodeForFindingTopmostScreenId = 1;
  string targetVariableId = 2;
  string targetVariableData = 3;
  string resolvedVariableModes = 4;
}

message VideoStateChangeData {
  GUID targetNodeId = 1;
  bool isPlaying = 2;
  bool isPlayingSound = 3;
  uint[] currentTimes = 4;
  uint actionTakenTimestamp = 5;
}

message PresentedState {
  GUID baseScreenID = 1;
  TriggeredOverlayData[] overlays = 2;
}

enum TransitionDirection {
  FORWARD = 0;
  REVERSE = 1;
}

message TopLevelPlaybackChange {
  PresentedState oldState = 1;
  PresentedState newState = 2;

  GUIDPath hotspotBlueprintID = 3;
  GUID interactionID = 4;
  bool isHotspotInNewPresentedState = 5;
  TransitionDirection direction = 6;
  GUIDPath instanceStablePath = 7;
}

message InstanceStateChange {
  GUID stateID = 1;
  GUID interactionID = 2;
  GUIDPath hotspotStablePath = 3;
  GUIDPath instanceStablePath = 4;
  PlaybackChangePhase phase = 5;
}

message TextCursor {
  Rect selectionBox = 1;
  GUID canvasGuid = 2 [deprecated];
  GUID textNodeGuid = 3;
}

message TextSelection {
  Rect[] selectionBoxes = 1;
  GUID canvasGuid = 2 [deprecated];
  GUID textNodeGuid = 3;
  Vector textSelectionRange = 4;
  GUID textNodeOrContainingIfGuid = 5;
  GUID tableCellRowId = 6;
  GUID tableCellColId = 7;
}

enum PlaybackChangePhase {
  INITIATED = 0;
  ABORTED = 1;
  COMMITTED = 2;
}

message PlaybackChangeKeyframe {
  PlaybackChangePhase phase = 1;
  float progress = 2; // Should be between 0 and 1
  float timestamp = 3; // Time in seconds
}

message StateMapping {
  GUIDPath stablePath = 1;
  TopLevelPlaybackChange lastTopLevelChange = 2;
  PlaybackChangeKeyframe lastTopLevelChangeStatus = 3; // Time at which lastChange entered lastChangeStatus on the driver client
  float timestamp = 4;
}

message ScrollMapping {
  GUIDPath blueprintID = 1;
  uint overlayIndex = 2;
  Vector scrollOffset = 3;
}

message PlaybackUpdate {
  TopLevelPlaybackChange lastTopLevelChange = 1;
  PlaybackChangeKeyframe lastTopLevelChangeStatus = 2;

  ScrollMapping[] scrollMappings = 3;
  float timestamp = 4; // Time in seconds
  Vector pointerLocation = 5; // Canvas-space mouse coordinates
  bool isTopLevelFrameChange = 6;
  StateMapping[] stateMappings = 7; // Deprecated
}

// This is a \`message\` (instead of just a \`string message\` on UserChange)
// so that we can add more properties to it in future if we want to.
message ChatMessage {
  string text = 1; // current message, not renamed to maintain backwards compatibility
  string previousText = 2;
}

// Message for all voice chat related metadata.
message VoiceMetadata {
  string connectedCallId = 1;
}

enum Heartbeat {
  FOREGROUND = 0;
  BACKGROUND = 1;
}

message UserChange {
  uint sessionID = 1;
  bool connected = 2;
  string name = 3;
  Color color = 4;
  string imageURL = 5;
  Viewport viewport = 6;
  Mouse mouse = 7;
  GUID[] selection = 8;
  uint[] observing = 9;
  string deviceName = 10; // Valid values: "viewer" | "editor" | "prototype"

  // Only keeps the last N around to avoid being a memory leak
  Click[] recentClicks = 11;
  ScrollPosition[] scrollPositions = 12; // TODO(achan): Deprecate
  TriggeredOverlay[] triggeredOverlays = 13 [deprecated];

  string userID = 14;

  GUID lastTriggeredHotspot = 15; // TODO(achan): Deprecate
  GUID lastTriggeredPrototypeInteractionID = 16; // TODO(achan): Deprecate
  TriggeredOverlayData[] triggeredOverlaysData = 17; // TODO(achan): Deprecate

  PlaybackUpdate[] playbackUpdates = 18 [deprecated];
  ChatMessage chatMessage = 19;
  VoiceMetadata voiceMetadata = 20;
  bool canWrite = 21;
  bool highFiveStatus = 22;
  InstanceStateChange[] instanceStateChanges = 23;
  TextCursor textCursor = 24;
  TextSelection textSelection = 25;
  uint connectedAtTimeS = 26; // Time in seconds connected since the start of multiplayer server
  bool focusOnTextCursor = 27;
  Heartbeat heartbeat = 28;
  TriggeredSetVariableActionData[] triggeredSetVariableActionData = 29;
  VideoStateChangeData[] videoStateChangeData = 30;
}

message InteractiveSlideElementChange {
  string userID = 1 [deprecated]; // This was before we realized we could infer the userId from MP.
  // anonyomousUserID is set if the user is anon, otherwise the userId is
  // inferred from the multiplayer connection.
  string anonymousUserID = 2;
  GUID nodeID = 3;
  string responseData = 4;
}

enum SceneGraphQueryBehavior {
  DEFAULT = 0;
  CONTAINING_PAGE = 1;
}

message SceneGraphQuery {
  GUID startingNode = 1;
  uint depth = 2;
  SceneGraphQueryBehavior behavior = 3;
}

// Deprecated.
message NodeChangesMetadata {
  uint blobsFieldOffset = 1;
}

message CursorReaction {
  string imageUrl = 1;
}

message TimerInfo {
  bool isPaused = 1;
  uint timeRemainingMs = 2;
  uint totalTimeMs = 3;
  uint timerID = 4;
  string setBy = 5;
  uint songID = 6 [deprecated];
  uint lastReceivedSongTimestampMs = 7;
  string songUUID = 8;
}

message MusicInfo {
  bool isPaused = 1;
  uint messageID = 2;
  string songID = 3;
  uint lastReceivedSongTimestampMs = 4;
  bool isStopped = 5;
}

message PresenterNomination {
  uint sessionID = 1;
  bool isCancelled = 2;
}

message PresenterInfo {
  uint sessionID = 1;
  PresenterNomination nomination = 2;
}

// ClientBroadcasts are a way to broadcast information verbatim from one
// client in a file to all others. If you're wondering whether to use a
// signal, a client broadcast, or UserChanges, here are some guidelines...
//
//  - Signals are for the behind-the-scenes functioning of our protocol
//    and have very simple payloads (always a short string). Examples: a
//    client telling the server why it's disconnecting, or the server telling
//    the client why it can't connect.
//  - ClientBroadcasts are a way to publish user actions to other clients. They
//    have arbitrarily complex payloads and are ephemeral (i.e. multiplayer
//    server can forget about them once they've been broadcast). Examples:
//    cursor reactions.
//  - UserChanges are a way to publish user actions to other clients. They have
//    arbitrarily complex payloads and are stateful. Multiplayer remembers their
//    last-sent values (per client) and sends them to new clients on connect.
//    Examples: mouse cursor position, selection.
message ClientBroadcast {
  // Describes which session this is from. The sessionID in Message is not sufficient
  // for this because, as an optimization, the multiplayer server collates broadcasts
  // from various sessions and sends them to clients as a single message.
  uint sessionID = 1;

  // Exactly one member of ClientBroadcast should be non-null at a given time.
  // If you're adding a new kind of broadcast, implement a message that
  // describes your broadcast and then add it as a member to ClientBroadcast.
  CursorReaction cursorReaction = 2;
  TimerInfo timer = 3;
  PresenterInfo presenter = 4;
  PresenterInfo prototypePresenter = 5;
  MusicInfo music = 6;
}

message Message {
  // NEXT ID: 35

  MessageType type = 1;
  uint sessionID = 2;
  uint ackID = 3;
  NodeChange[] nodeChanges = 4;
  UserChange[] userChanges = 5;
  InteractiveSlideElementChange interactiveSlideElementChange = 32;

  // All large arrays of bytes are pulled up to the top level and deduplicated to save space.
  // These blobs are referenced by index. blobBaseIndex determines how blob indices are resolved.
  // See the comment below for more details.
  Blob[] blobs = 6;

  // The value of this field controls how blob references inside this message should be resolved.
  // Specifically, blobs in this message are given indices starting with the number stored in this
  // field. Thus, if the value of this field is 0, all blob references this message refer to blobs
  // contained within the same message. But if the value of this field is non-zero, blob references
  // in this message may refer to blobs transmitted in an earlier message which the client is expected
  // to retain. For more information see:
  // https://paper.dropbox.com/doc/Chunked-File-Loads-Blobs-Handling--Bt509lHm1xl_rJZ9TFjQqZ7vAQ-7P7VnuIZ410PhfxEsJpXu
  uint blobBaseIndex = 30;

  string signalName = 7;
  Access access = 8;
  string styleSetName = 9;
  StyleSetType styleSetType = 10;
  StyleSetContentType styleSetContentType = 11;

  // This is used to support pasting with an offset from the original copied location if both the copy and paste are within the same document
  int pasteID = 12;
  Vector pasteOffset = 13;
  string pasteFileKey = 14; // designate whether paste came from same file or not, shallow vs. deep copy (eventually shared asset ref)

  // This was added so that signals can contain debugging information. In
  // practice it is used to send arbitrary data along with signals.
  string signalPayload = 15;
  SceneGraphQuery[] sceneGraphQueries = 16;

  // Deprecated.
  NodeChangesMetadata nodeChangesMetadata = 17 [deprecated];

  // Sent in JOIN_START messages. See https://www.notion.so/figma/The-fig-file-format-95aea405c2334eb0b753ca5524a12616
  uint fileVersion = 18;

  // This is used to further support pasting for copy/paste V4.
  bool pasteIsPartiallyOutsideEnclosingFrame = 19;
  GUID pastePageId = 20;

  // This is used to support pasting cut components as main components when
  // pasting into a different file.
  bool isCut = 21;

  // This is used to migrate the user's local undo/redo buffer at the same time
  // as the user's local pending changes. Each \`Message\` contains a single batch
  // of \`NodeChange\`s.
  Message[] localUndoStack = 22;
  Message[] localRedoStack = 23;

  // Used when this is a CLIENT_BROADCAST message
  ClientBroadcast[] broadcasts = 24;

  // The sequence number of the file is stored by clients and is sent up to the
  // server to determine if their local file is up-to-date and can use the fast
  // reconnect path.
  uint reconnectSequenceNumber = 25;

  // If a client copies (or cuts) from a branch, we populate this so that the
  // pasting client knows the source file for that branch. This is mainly needed
  // to compute component keys correctly when symbols are cloned from branch files.
  string pasteBranchSourceFileKey = 26;

  // The editor type of the file the client copies from
  EditorType pasteEditorType = 27;

  // Included in NODE_CHANGES messages sent from the client to multiplayer to
  // indicate actions to be taken after applying the changes in the message.
  // Currently used when merging a branch.
  string postSyncActions = 28;

  // Populated on the clipboard PasteData with the guids of cut assets that have been
  // published. Used to determine when to populate LibraryMoveInfo for an asset on paste.
  GUID[] publishedAssetGuids = 29;

  // Indicates that all \`nodeChanges\` contained in the message were generated
  // automatically on file load (fullscreen does this in various cases, like generating
  // derived data or geometry) and not in response to a user's explicit action.
  bool dirtyFromInitialLoad = 31;

  // Populated on the clipboard PasteData with the selection regions that were copied.
  // Used to support multi-edit pasting
  ClipboardSelectionRegion[] clipboardSelectionRegions = 33;

  // Tracks the byte offset to NodeChanges within the payload, helps improve performance
  // for decoding large files by enabling parallelization.
  //
  // See: https://paper.dropbox.com/doc/EncodedOffsetsIndex-One-Pager--CEn6w9TLp5l~~PURO8wFEP_lAg-BdjD2a5P2FXKLBwlndz9C
  EncodedOffsetsIndex encodedOffsetsIndex = 34;
}

message EncodedOffsetsIndex {
  // Offset from the start of the Message (after the encoded offsets index) 
  // to the start of the nodeChanges field.
  uint nodeChangesFieldOffset = 1;
  uint nodeChangesFieldLength = 2;
  // Offset from the start of the Message (after the encoded offsets index) 
  // to the start of the blobs field.
  uint blobsFieldOffset = 3;
  GUIDAndEncodedOffset[] nodeChangeOffsets = 4;
}

struct GUIDAndEncodedOffset {
  GUID guid;
  // Offset from the start of the nodeChanges field to the specified node change.
  uint offset;
}

// Uses the word "DiffChunk" instead of "MergeChunk" to indicate that it's
// appropriate to use for features beyond merging (e.g. version history).
// A good high-level explanation:
// https://paper.dropbox.com/doc/Sub-Spec-M2.5-Visualization--Bh3xREZiEPBaTpCWYMk4Pqv7Ag-PZ7rFvdL0QLRvSVECLuFK
message DiffChunk {

  // References DiffPayload.nodeChanges with indices (as opposed to GUIDs)
  // so that we have the future option of multiple changes per node GUID.
  // (e.g. if we wanted to separate each property change).
  uint[] nodeChanges = 1;

  NodePhase phase = 2 [deprecated];

  // Includes a complete copy of NodeChange for the display node to
  // separate the concern of identifying the display node vs selecting
  // which properties are necessary for display. This avoids updating
  // the schema for display-specific changes. (e.g. if a new property
  // type becomes necessary to select the correct icon) This means storing
  // more properties than may ultimately get used, but we\u2019re okay with
  // that trade-off to avoid error-prone maintenance.
  NodeChange displayNode = 3;

  // Containing canvas
  // Inlined because these properties are very unlikely to change and
  // small enough that duplication is not concerning.
  // The fields canvasId, canvasName, canvasIsInternal should be deprecated
  // but are still being used in web.
  GUID canvasId = 4;
  string canvasName = 5;
  bool canvasIsInternal = 6;

  // If present, this chunk is "affected by/downstream of" the referenced chunks
  // Using back-references here avoids duplicating "downstream" chunks,
  // and matches the direction of the underlying node dependencies.
  // Using array indexes instead of GUIDS allows for the unlikely future
  // possibilities of more than one chunk with the same display node but
  // different changes, or a chunk with multiple display nodes.
  // NOTE: Variants are a special case of dependency, eg:
  // isVariant(c) => c.isState && c.chunksAffectingThisChunk().filter(dc => dc.isStateGroup)
  uint[] chunksAffectingThisChunk = 7;

  // basisParentHierarchy is the hierarchy from the 'from' of the diff, and
  // parentHierarchy is the hierarchy from the 'to' of the diff.

  // Parent hierarchy is a bottom-ups array of parents that qualify as a chunk.
  // For example, if we have a variant in a state group in the internal canvas,
  // then that variant's parent hierarchy would be:
  // [<StateGroup NodeChanges>, <InternalCanvas NodeChanges>].
  // This information is used for a variety of purposes like doing special
  // grouping for removed nodes, grouping variants into their state groups,
  // and for determining information about that chunk's containing canvas.
  // NOTE: these fields should be deprecated once basisParentHierarchyGuids
  // and parentHierarchyGuids are rolled out.
  NodeChange[] basisParentHierarchy = 8;
  NodeChange[] parentHierarchy = 9;

  // basisParentHierarchyGuids is the hierarchy from the 'from' of the diff, and
  // parentHierarchyGuids is the hierarchy from the 'to' of the diff.

  // Parent hierarchy is a bottom-ups array of GUIDs corresponding to parent node changes that qualify as a chunk.
  // For example, if we have a variant in a state group in the internal canvas,
  // then that variant's parent hierarchy would be:
  // [<StateGroup NodeChange GUID>, <InternalCanvas NodeChange GUID>].
  // This information is used for a variety of purposes like doing special
  // grouping for removed nodes, grouping variants into their state groups,
  // and for determining information about that chunk's containing canvas.
  // The GUIDs reference to NodeChanges in the DiffPayload's basisParentNodeChanges and parentNodeChanges fields
  GUID[] basisParentHierarchyGuids = 10;
  GUID[] parentHierarchyGuids = 11;
}

message DiffPayload {
  // A list of changes for each node. Each NodeChange is guaranteed to have GUID
  // and at least one property.
  NodeChange[] nodeChanges = 1;

  // For fields that have potentially large and repetitive binary data,
  // we store references to external blob data. This allows de-duplication.
  // Blob data is serialized as a separate top-level array.
  Blob[] blobs = 2;

  // Metadata that groups every nodeChange from above into related changes based
  // on a heuristic. See rust/fig-diff/src/chunks.rs for the implementation.
  DiffChunk[] diffChunks = 3;

  // One for every item in nodeChanges above.
  NodeChange[] diffBasis = 4;

  // Distinct node changes corresponding to the superset of GUIDs from every DiffChunk's basisParentHierarchyGuids.
  NodeChange[] basisParentNodeChanges = 5;

  // Distinct node changes corresponding to the superset of GUIDs from every DiffChunk's parentHierarchyGuids.
  NodeChange[] parentNodeChanges = 6;
}

enum RichMediaType {
  // GIF1
  ANIMATED_IMAGE = 0;
  // Video
  VIDEO = 1;
}

message RichMediaData {
  string mediaHash = 1;
  RichMediaType richMediaType = 2;
}

// Each variable can be only one specific type.
// This informs what type this variable holds.
enum VariableDataType {
  BOOLEAN = 0;
  FLOAT = 1;
  STRING = 2;
  ALIAS = 3;
  COLOR = 4;
  EXPRESSION = 5;
  MAP = 6;
  SYMBOL_ID = 7;
  FONT_STYLE = 8;
  TEXT_DATA = 9;
}

// The resolved type of the variable.
// This is used to determine which variables can
// be bound to what field.
// KEEP_IN_SYNC(sinatra/lib/models/variable.rb)
enum VariableResolvedDataType {
  BOOLEAN = 0;
  FLOAT = 1;
  STRING = 2;
  COLOR = 4;
  MAP = 5;
  SYMBOL_ID = 6;
  FONT_STYLE = 7;
  TEXT_DATA = 8;
}

// This holds the value of a variable. Since we don't support Any we can use
// VariableAnyValue with one and only one of the fields populated.
message VariableAnyValue {
  bool boolValue = 1;
  string textValue = 2;
  float floatValue = 3;
  VariableID alias = 4;
  Color colorValue = 5;
  Expression expressionValue = 6;
  VariableMap mapValue = 7;
  SymbolId symbolIdValue = 8;
  VariableFontStyle fontStyleValue = 9;
  TextData textDataValue = 10;
}

enum ExpressionFunction {
  ADDITION = 0;
  SUBTRACTION = 1;
  RESOLVE_VARIANT = 2;
  MULTIPLY = 3;
  DIVIDE = 4;
  EQUALS = 5;
  NOT_EQUAL = 6;
  LESS_THAN = 7;
  LESS_THAN_OR_EQUAL = 8;
  GREATER_THAN = 9;
  GREATER_THAN_OR_EQUAL = 10;
  AND = 11;
  OR = 12;
  NOT = 13;
  STRINGIFY = 14;
  TERNARY = 15;
  VAR_MODE_LOOKUP = 16;
  NEGATE = 17;
  IS_TRUTHY = 18;
}

message Expression {
  ExpressionFunction expressionFunction = 1;
  VariableData[] expressionArguments = 2;
}

// Most expressions will use a simple VariableData[] of args,
// but some functions like RESOLVE_VARIANT need it stored as a map
message VariableMapValue {
  string key = 1;
  VariableData value = 2;
}

message VariableMap {
  VariableMapValue[] values = 1;
}

message VariableFontStyle {
  VariableData asString = 1;
  VariableData asFloat = 2;
}

message VariableData {
  VariableAnyValue value = 1;
  VariableDataType dataType = 2;
  VariableResolvedDataType resolvedDataType = 3;
}

message VariableSetMode {
  GUID id = 1;
  string name = 2;
  string sortPosition = 3;
}

message VariableDataValues {
  VariableDataValuesEntry[] entries = 1;
}

message VariableDataValuesEntry {
  GUID modeID = 1;
  VariableData variableData = 2;
}

// KEEP_IN_SYNC(sinatra/lib/models/variable.rb)
// KEEP_IN_SYNC(plugin-docs/docs/api/api.ts:VariableScope)
enum VariableScope {
  // A special value that means that this variable will be shown
  // in all available scopes (including future ones)
  ALL_SCOPES = 0;

  // Currently only used by number variables, but will eventually
  // be shared by multiple variable types
  TEXT_CONTENT = 1;

  // Used by number variables
  CORNER_RADIUS = 2;
  WIDTH_HEIGHT = 3;
  GAP = 4;
  // Used by color variables
  // A special value that means that this variable will be shown
  // in all available fill scopes (including future ones)
  ALL_FILLS = 5;
  FRAME_FILL = 6;
  SHAPE_FILL = 7;
  TEXT_FILL = 8;
  STROKE = 9; // stroke fills

  STROKE_FLOAT = 10; // this is just stroke_weight for now
  EFFECT_FLOAT = 11;
  EFFECT_COLOR = 12;
  OPACITY = 13;

}

enum CodeSyntaxPlatform {
  WEB = 0;
  ANDROID = 1;
  iOS = 2;
  // more options for code syntax platforms may be added in the future
}

message OptionalVector {
  Vector value = 1;
}

enum HTMLTag {
  // Use heuristics to determine the HTML tag.
  AUTO = 0;
  // Sectioning content https://html.spec.whatwg.org/dev/sections.html#sections
  ARTICLE = 1;
  SECTION = 2;
  NAV = 3;
  ASIDE = 4;
  H1 = 5;
  H2 = 6;
  H3 = 7;
  H4 = 8;
  H5 = 9;
  H6 = 10;
  HGROUP = 11;
  HEADER = 12;
  FOOTER = 13;
  ADDRESS = 14;
  // Grouping content https://html.spec.whatwg.org/dev/grouping-content.html
  P = 15;
  HR = 16;
  PRE = 17;
  BLOCKQUOTE = 18;
  OL = 19;
  UL = 20;
  MENU = 21;
  LI = 22;
  DL = 23;
  DT = 24;
  DD = 25;
  FIGURE = 26;
  FIGCAPTION = 27;
  MAIN = 28;
  DIV = 29;
  // Text-level semantics https://html.spec.whatwg.org/dev/text-level-semantics.html
  A = 30;
  EM = 31;
  STRONG = 32;
  SMALL = 33;
  S = 34;
  CITE = 35;
  Q = 36;
  DFN = 37;
  ABBR = 38;
  RUBY = 39;
  RT = 40;
  RP = 41;
  DATA = 42;
  TIME = 43;
  CODE = 44;
  VAR = 45;
  SAMP = 46;
  KBD = 47;
  SUB = 48;
  SUP = 49;
  I = 50;
  B = 51;
  U = 52;
  MARK = 53;
  BDI = 54;
  BDO = 55;
  SPAN = 56;
  BR = 57;
  WBR = 58;
  // Images https://html.spec.whatwg.org/dev/embedded-content.html
  PICTURE = 59;
  SOURCE = 60;
  IMG = 61;
  // Forms and inputs https://html.spec.whatwg.org/dev/forms.html
  FORM = 62;
  LABEL = 63;
  INPUT = 64;
  BUTTON = 65;
  SELECT = 66;
  DATALIST = 67;
  OPTGROUP = 68;
  OPTION = 69;
  TEXTAREA = 70;
  OUTPUT = 71;
  PROGRESS = 72;
  METER = 73;
  FIELDSET = 74;
  LEGEND = 75;
}

enum ARIARole {
  // This enum is quite messy. It has gone through a few iterations and
  // some values got deprecated and then brought back and some other abstracted
  // roles got added and then deprecated

  AUTO = 0; // Use heuristics to determine the role.
  NONE = 52;

  // Landmark roles
  APPLICATION = 30;
  BANNER = 67;
  COMPLEMENTARY = 68;
  CONTENTINFO = 69;
  FORM = 70;
  MAIN = 71;
  NAVIGATION = 72;
  REGION = 73;
  SEARCH = 74;

	// Document roles
  SEPARATOR = 13;
  ARTICLE = 31;
  COLUMNHEADER = 35;
  DEFINITION = 36;
  DIRECTORY = 38;
  DOCUMENT = 39;
  GROUP = 44;
  HEADING = 45;
  IMG = 46;
  LIST = 48;
  LISTITEM = 49;
  MATH = 50;
  NOTE = 53;
  PRESENTATION = 55;
  ROW = 56;
  ROWGROUP = 57;
  ROWHEADER = 58;
  TABLE = 62;
  TOOLBAR = 65;


	// Widget roles
  BUTTON = 1;
  CHECKBOX = 2;
  GRIDCELL = 3;
  LINK = 4;
  MENUITEM = 5;
  MENUITEMCHECKBOX = 6;
  MENUITEMRADIO = 7;
  OPTION = 8;
  PROGRESSBAR = 9;
  RADIO = 10;
  SCROLLBAR = 11;
  SLIDER = 14;
  SPINBUTTON = 15;
  TAB = 17;
  TABPANEL = 18;
  TEXTBOX = 19;
  TREEITEM = 20;
  COMBOBOX = 21;
  GRID = 22;
  LISTBOX = 23;
  MENU = 24;
  MENUBAR = 25;
  RADIOGROUP = 26;
  TABLIST = 27;
  TREE = 28;
  TREEGRID = 29;
  TOOLTIP = 66;
  ALERT = 75;
  LOG = 76;
  MARQUEE = 77;
  STATUS = 78;
  TIMER = 79;
  ALERTDIALOG = 80;
  DIALOG = 81;


  //========================================
	// These values are deprecated. DO NOT USE.
  // They only remain here for backwards compatibility
  SEARCHBOX = 12; // Deprecated
  SWITCH = 16; // Deprecated
  BLOCKQUOTE = 32; // Deprecated
  CAPTION = 33; // Deprecated
  CELL = 34; // Deprecated
  DELETION = 37; // Deprecated
  EMPHASIS = 40; // Deprecated
  FEED = 41; // Deprecated
  FIGURE = 42; // Deprecated
  GENERIC = 43; // Deprecated
  INSERTION = 47; // Deprecated
  METER = 51; // Deprecated
  PARAGRAPH = 54; // Deprecated
  STRONG = 59; // Deprecated
  SUBSCRIPT = 60; // Deprecated
  SUPERSCRIPT = 61; // Deprecated
  TERM = 63; // Deprecated
  TIME = 64; // Deprecated
  IMAGE = 82; // Deprecated
  HEADING_1 = 83; // Deprecated
  HEADING_2 = 84; // Deprecated
  HEADING_3 = 85; // Deprecated
  HEADING_4 = 86; // Deprecated
  HEADING_5 = 87; // Deprecated
  HEADING_6 = 88; // Deprecated
  HEADER = 89; // Deprecated
  FOOTER = 90; // Deprecated
  SIDEBAR = 91; // Deprecated
  SECTION = 92; // Deprecated
  MAINCONTENT = 93; // Deprecated
  TABLE_CELL = 94; // Deprecated
  WIDGET = 95; // Deprecated
}


message MigrationStatus {
  bool dsdCleanup = 1;
}

message NodeFieldMap {
  NodeFieldMapEntry[] entries = 1;
}

message NodeFieldMapEntry {
  GUID guid = 1;
  uint field = 2;
  uint lastModifiedSequenceNumber = 3;
}

enum ColorProfile {
  SRGB = 0;
  DISPLAY_P3 = 1;
}

// This is only meant to be used on the root DOCUMENT node
enum DocumentColorProfile {
  // In Figma Design, all files that were created before color management was released are considered "legacy"
  // In FigmJam, all files are considered "legacy"
  LEGACY = 0;
  SRGB = 1;
  DISPLAY_P3 = 2;
}

enum ChildReadingDirection {
  NONE = 0;
  LEFT_TO_RIGHT = 1;
  RIGHT_TO_LEFT = 2;
}

// This holds the value of an aria attribute. Since we don't support Any we can use
// ARIAAttributeAnyValue with one and only one of the fields populated.
message ARIAAttributeAnyValue {
  bool boolValue = 1;
  string stringValue = 2;
  float floatValue = 3;
  int intValue = 4;
  string[] stringArrayValue = 5;
}
// Each variable can be only one specific type.
// This informs what type this variable holds.
enum ARIAAttributeDataType {
  BOOLEAN = 0;
  STRING = 1;
  FLOAT = 2;
  INT = 3;
  STRING_LIST = 4;
}
message ARIAAttributeData {
  ARIAAttributeDataType type = 1;
  ARIAAttributeAnyValue value = 2;
}

message ARIAAttributesMap {
  ARIAAttributesMapEntry[] entries = 1;
}

message ARIAAttributesMapEntry {
  string attribute = 1; // There are too many aria attributes to enumerate them all here
  ARIAAttributeData value = 2;
}

message HandoffStatusMapEntry {
  GUID guid = 1;
  SectionStatusInfo handoffStatus = 2;
}

message HandoffStatusMap {
  HandoffStatusMapEntry[] entries = 1;
}

// All the edit scope stacks that apply to the fields in a NodeChange.
message EditScopeInfo {
  EditScopeStack[] editScopeStacks = 1;
}

// The stack of edit scopes for a single field change.
message EditScopeStack {
  EditScope[] stack = 1;
}

// The tuple of a given edit scope. A change can exist under one or more of these scopes.
message EditScope {
  EditScopeType type = 1;
  string label = 2;
}

// KEEP_IN_SYNC(fullscreen/lib/scenegraph/FGEditScopeData.h)
enum EditScopeType {
  INVALID = 0;
  TEST_SETUP = 1;
  USER = 2;
  PLUGIN = 3;
  SYSTEM = 4;
  REST_API = 5;
}

enum SectionPresetState {
  INSERTED = 0;
  USER_EDITED = 1;
}

enum EmojiImageSet {
  APPLE = 0;
  NOTO = 1;
}

// The selected preset information for a section node.
message SectionPresetInfo {
  uint64 shelfId = 1;
  uint64 templateId = 2;
  string templateName = 3;
  SectionPresetState state = 4;
}

// Selection region that was copied onto the clipboard.
message ClipboardSelectionRegion {
  // We store the parent so that we can paste back into the same parent,
  // if it exists, when there is no selection
  GUID parent = 1;
  GUID[] nodes = 2;

  // This is to determine offsets for pasting
  Vector enclosingFrameOffset = 3;
  bool pasteIsPartiallyOutsideEnclosingFrame = 4;
}

///////////////////////////////////////////////////////////////
// Deprecated
// !!! EVERYTHING BELOW THIS SECTION IS DEPRECATED !!!
//
// Because we cannot remove certain type for backwards
// compatibility and checkpointing, we need to keep the definitions
// around. To avoid cluster and to prevent accidental reuse
// we'll move the deprecated types below this section
////////////////////////////////////////////////////////////////

message VariableIdOrVariableOverrideId {
  VariableID variableId = 1;
  VariableOverrideId variableOverrideId = 2;
}
`))}),this.app=this.viewer.app,this.app.window().dangerouslyDisableOnFrameCallbackForTesting(),this.testMode==0)this.resize(600,600),this.readFile(s,0).then(c=>{this.commandQueue=JSON.parse(c.text).commands,this._mockTime=new la,ke.dangerouslyPushMockTime(this._mockTime),this.runNextCommand()});else{this.app.canvasView().dangerouslyAccessProtoRenderManager().internalInitPerfTracking(),this.resizeToFit();let c=30;this.readFile(s,0).then(p=>{let u=JSON.parse(p.text).commands,h=u.tests,f=u.outFile;for(let g=0,A=h.length;g<A;g=g+1){let T=h[g];for(let b=0;b<c;b=b+1)for(let _=0,m=T.length;_<m;_=_+1){let S=T[_];this.commandQueue.push(S)}}let y=new Map([["runCount",c],["deviceMode",a[2]],["flags",Object.keys(d).join(" ")]]);this.writePerformanceResultsWhenFinished(f,y),this.runNextCommand()})}})}};Li._instance=null;var Cf=Li,AT;(e=>{function i(t){return ST[t]}e.TestMode_toString=i})(AT||(AT={}));var IT=(n=>(n[n.NONE=0]="NONE",n[n.RECORD=1]="RECORD",n[n.PLAYBACK=2]="PLAYBACK",n))(IT||{}),Nf;(r=>{function i(){return r._instance}r.instance=i;function e(o,a){r._instance=new t(o,a)}r.create=e;class t extends Yp{constructor(s,l){super(d=>{this._emitter.trigger("topLevelFrameChange",null)});this._dirtyNodes=null,this._emitter=null,this._scene=null,s.addFrameObserver(this),s.addAppObserver(this),s.prototypeState().addObserver(this),this._emitter=l,this._clearDirtySet()}_clearDirtySet(){this._dirtyNodes=new zi(s=>s)}handleSceneGraphEvent(s){switch(s.property){case 62:case 25:case 24:case 88:case 49:case 78:case 4:case 19:case 8:{this._dirtyNodes.add(s.node.id());break}}}handleSceneChange(s,l){s!=null&&s.removeObserver(this),l!=null&&l.addObserver(this)}handleActiveCanvasChange(s,l){}handleActivePrototypeStartingPointChange(s,l){}onFrame(){this._dirtyNodes.each(s=>{this._emitter.trigger("accessibilityNodeInvalidated",s)}),this._clearDirtySet()}}r._AccessibilityObserver=t,r._instance=null})(Nf||(Nf={}));var yT;(e=>{function i(t){return IT[t]}e.InteractionTestState_toString=i})(yT||(yT={}));function Rf(i){return{x:i.x(),y:i.y(),width:i.width(),height:i.height()}}function bT(i){let e=i.state().getActiveCanvas();if(e==null)return null;let t=e.backgroundColor();return t==E.TRANSPARENT?null:E.asFloattoJSON(t)}function TT(i){if(i.state().scene()==null)return null;let t=i.state().getActiveCanvas();if(t==null)return null;let n=Y.prototypeBackgroundColorOverride!=null?Y.prototypeBackgroundColorOverride.value:t.prototypeBackgroundColor();return n==E.TRANSPARENT?null:E.asInttoJSON(n)}function M1(i){let e=[];for(let t of i)e.push(ee.fromString(t));return e}function B1(i){return{trigger:i.event().interactionType(),to:i.action().value.connectionType(),type:i.action().value.navigationType()}}function ET(i){return t=>{let n=t.subtract1(i.canvasView().absoluteBounds().topLeft()),r=i.canvasView().canvasSpaceToWindowSpace().clone();return r.invert()?(r.transformPoint(n),n):null}}function CT(i,e){e.window().setAfterNotify(t=>{let n=Ll.serialize(t,i);n!==null&&qt.getEventEmitter().trigger("recordInteraction",n)})}function V1(i){let e=ET(i);CT(e,i)}function k1(i){Hi.detect(),Rt.initialize(i),mn.initialize(),Br.initialize(),Y.initialize(i),ye.schema=i.kiwiSchema,Ah.initialize(i.statsigConfigCallback);let e=new Dl(Rt.getContainerElement(),Y.gameControllerListener(),new Pp,0),t=e.multiplayerSession(),n=e.multiplayerCoupler(),r=qt.getEventEmitter();new Sh(t);let o=new Ed(e.state()),a=new yh(e.state()),s={requestedEmbedAPIOrigin:null};Y.getFeatureFlags().embed_api_limit_origins&&(s={requestedEmbedAPIOrigin:new URLSearchParams(window.location.search).get("embed_origin")||null}),aa.init(e.state(),e.canvasView(),s);let l=null;Y.getViewerMode()==Y.ViewerMode.MIRROR&&(l=new Cd(e,t)),r.on("documentSyncingMessage",_=>{Pe.trackEventJSON1("Viewer Document Syncing Message",{..._,hasPendingMirrorSelectionChange:(l==null?void 0:l.hasPendingSelectionChange())??!1,hasPendingPrototypeStateChange:e.state().prototypeState().hasRequestedStateChange()})});let d=i.deviceName;if(typeof d=="string"){if(["viewer","prototype","editor"].indexOf(d)==-1)throw new Error(`Invalid device name ${d}`);t.setRole(d)}r.on("sceneDidCompleteInitialLoad",_=>{let m=S=>{window.figmaPerfTesting&&window.postMessage({name:S,value:0},"*")};m("DOCUMENT_IS_LOADED"),window.DebuggingHelpers&&(window.DebuggingHelpers.documentIsLoaded=!0),e.canvasView().afterFrame=()=>{e.canvasView().afterFrame=null,m("AFTER_FIRST_RENDER"),r.trigger("documentIsLoaded",null)},e.canvasView().afterFirstRenderOfScreenStack=()=>{e.canvasView().afterFirstRenderOfScreenStack=null,m("AFTER_FIRST_RENDER_OF_TLF")}});let c=0,p=i.interactionTestState;if(typeof p!="string"||p==="NONE")c=0;else if(p==="RECORD")c=1;else if(p==="PLAYBACK")c=2,f_();else throw new Error(`Invalid interactionTestState ${p}`);let u=null,h=null,f=null,y=null;c!=0&&(u=_=>{let m=_.clone();return e.canvasView().canvasSpaceToWindowSpace().transformPoint(m),m.add1(e.canvasView().absoluteBounds().topLeft())},h=ET(e),f=_=>e.window().root().viewFromPoint(_),y=()=>e.window().focusedView()),c==1&&CT(h,e),e.state().addActionObserver(new qt.ActionHandler);let g=new qt.AppHandler(e.state());e.state().addFrameObserver(g),Nf.create(e.state(),r),qn.addUpdate(Kt.windowFrame(e.window().events()),_=>{t.maybeFlushNextUserChange(0)}),e.canvasView().onBaseScreenIdChanged=(_,m,S,v)=>{_!=null&&r.trigger("baseScreenChanged",{nodeId:_,userInitiated:m==1,updateURL:S,repairsInvalidState:v})},e.canvasView().disengageObservationMode=()=>{r.trigger("disengageObservationMode",{})},e.canvasView().viewportTracker().onChange=(_,m)=>{r.trigger("viewportChanged",{offset:{x:_.x(),y:_.y()},zoomScale:m})},e.canvasView().onResize=()=>{r.trigger("canvasResize",null)},e.canvasView().onURLClicked=(_,m)=>{r.trigger("urlClicked",{url:_,openInNewWindow:m})},e.canvasView().onNavigateToPrototype=(_,m)=>{r.trigger("navigateToPrototype",{fileKey:_,guid:m})},io.instance().startLibLoad=()=>{r.trigger("loadVideoJsLib",{})},a.onChange=_=>{r.trigger("pagesChange",_)},o.notifyCommentPositionsChange=()=>{r.trigger("watchedNodeBoundsChange",null)},new Ns(e.state(),64,_=>{let m="backgroundColorChange";r.trigger(m,bT(e))}),new Ns(e.state(),65,_=>{let m="prototypeBackgroundColorChange";r.trigger(m,TT(e))}),new Ns(e.state(),66,_=>{r.trigger("prototypeDeviceChanged",_!=null?_.toJSON():null)});let A=[],T={appState:()=>e.state(),multiplayer:()=>t,prototypeState:()=>e.state().prototypeState(),logAndGetDocument:()=>{var m;let _=(m=e.state().scene())==null?void 0:m.root();return _!=null?console.log(_.debugString()):console.log("Document root not found \u{1F630}"),_},logAndGetBaseScreen:()=>{let _=e.state().baseScreenNode();return _!=null?console.log(_.debugString()):console.log("Base screen not found \u{1F630}"),_},logAndGetNode:_=>{var S;let m=(S=e.state().scene())==null?void 0:S.findNode2(_);return m!=null?console.log(m.debugString()):console.log(`Node with id ${_??"null"} not found!`),m},logAndGetNodeByStablePath:_=>{var S;let m=(S=e.state().scene())==null?void 0:S.findNode3(Mt.fromString(_));return m!=null?console.log(m.debugString()):console.log(`Node with stablePath ${_??"null"} not found!`),m},logAndGetRenderTree:_=>{var S,v;let m=(S=e.state().scene())==null?void 0:S.findNode2(_);return m!=null?console.log(((v=m.renderTree1())==null?void 0:v.debugString1())??"null"):console.log(`Node with id ${_??"null"} not found!`),m.renderTree1()},logFakeError:_=>{y_(_)},setDebugUserChanges:_=>{ra.debugUserChanges=_},fulfilledMultiplayerQueries:()=>t.fulfilledMultiplayerQueries(),ICSemanticStorageTrie:()=>{console.log(e.state().prototypeState().componentStateSyncer.debugString())},VideoSemanticStorageTrie:()=>{console.log(e.state().videoManager().runtimeStorage().toString1())}};Y.getFeatureFlags().internal_only_debug_tools&&(window.DebuggingHelpers=T);let b={setObservingSessionID:_=>{if(!Ps(_))throw new Error("Missing sessionID");let m=_|0;m!=t.observingSessionID()&&(t.setObservingSessionID(m),n.setPreviewToObservedFrameOrOverlay(!1),n.performSetVariableActions(!0),n.performVideoStateChanges(!0),r.trigger("multiplayerUserInfoChange",n.userInfoJSON()),e.canvasView().viewport().invalidate())},nominatePresenter:_=>{if(!Ps(_))throw new Error("Missing sessionID");t.nominatePresenter(_|0)},cancelPresenterNomination:_=>{if(!Ps(_))throw new Error("Missing sessionID");t.cancelPresenterNomination(_|0)},startPresenting:()=>{t.startPresenting()},stopPresenting:()=>{t.stopPresenting()},setInteractiveSlideConfigData:(_,m,S)=>{t.setInteractiveSlideConfigData(_,m,S)},setInteractiveSlideParticipantData:(_,m,S)=>{t.setInteractiveSlideParticipantData(_,m,S)},adjustZoom:(_,m)=>{e.canvasView().viewport().adjustCameraZoom2(1,_,m)},setZoom:(_,m)=>{e.canvasView().viewport().setCameraZoom(1,_)},zoomToNode:(_,m)=>{var v;let S=(v=e.state().scene())==null?void 0:v.findNode1(ee.fromString(_));S!=null&&(e.state().setActiveCanvas(S.canvas()),e.canvasView().viewport().zoomToFit1(1,S.canvasSpaceBoundingBox(),m))},getZoomBounds:()=>({min:$o.ZOOM_MIN,max:$o.ZOOM_MAX}),setCanvasSpaceCenter:(_,m)=>{let S=new I(-1*_.x,-1*_.y);e.canvasView().viewport().setCameraOffset2(1,S,m)},setCanvasSpaceCenterWithScroll:_=>{var z;let m=new I(_.x,_.y),S=(z=e.state().baseScreenNode())==null?void 0:z.canvasSpaceBoundingBox();if(S==null)return;let v=Math.max(m.x()-S.x(),0),C=Math.max(m.y()-S.y(),0),N=Math.max(v-S.width()/2,0),x=Math.max(C-S.height()/2,0);if(v!=0||C!=0){let $=new I(N,x);e.canvasView().updateScrollOffsetForNode(e.state().prototypeState().getTopmostScreen(),$)}},setScrollPadding:_=>{e.canvasView().setScrollPadding(+_.left,+_.top,+_.right,+_.bottom)},setScrollToPan:_=>{Y.setScrollToPan(_)},setDragToPan:_=>{Y.setDragToPan(_)},injectVideoJsLib:_=>{io.instance().onLoadComplete(_)},connectTo:(_,m)=>{let S=new Ks(hr.instance,La.instance,hr.instance);m(S).then(v=>{let C=v.cppModules;e.state().setFontListPromise(v.fontListPromise),Y.getFeatureFlags().internal_only_debug_tools&&(T.fullscreen=C==null?void 0:C.sharedDebuggingHelpers,window.DebuggingHelpers=T);let N=_.fileKey,x=ee.fromString(_.nodeId);ee.isRoot(x)&&(x=null),Y.getViewerMode()==Y.ViewerMode.MIRROR&&l!=null?l.connectToFileAndShowNode(N,x,ee.fromString(_.startingPointNodeId),_.oauthToken,_.interactiveComponentsEnabled?0:1,!!_.renderDots,C):e.connectTo(N,x,ee.fromString(_.startingPointNodeId),_.oauthToken,_.interactiveComponentsEnabled?0:1,!!_.renderDots,C)})},openFileKey:()=>t.fileKey()??e.state().currentFileKey(),isConnected:()=>t.isConnected(),hasActiveScene:()=>e.state().scene()!=null,unloadSceneForTesting:()=>{t.disconnect(),e.state().prototypeState().resetPrototype(),e.state().setScene(null)},disconnectForTesting:()=>{t.disconnect()},reconnectForTesting:()=>{t.attemptReconnect()},enforceValidPrototypeStateForTesting:()=>{e.state().prototypeState().enforceValidPrototypeStateForTesting()},deleteNodeForTesting:_=>{let m=e.state().scene();if(m==null)throw new Error("No current scene");m.removeNode(ee.fromString(_))},translateNodeForTesting:(_,m,S)=>{let v=e.state().scene();if(v==null)throw new Error("No current scene");let C=v.findNode2(_);if(C==null)throw new Error("Node not found");let N=C.relativeTransform().clone();N.translate2(m,S),C.setRelativeTransform(N)},addCanvasViewObserverForTesting:(_,m)=>{let S=new nh((v,C,N,x)=>{_()},v=>{m(v.scrollOffset().x(),v.scrollOffset().y())});A.push(S),e.canvasView().addObserver(S)},clearCanvasViewObserversForTesting:()=>{for(let _ of A)e.canvasView().removeObserver(_);A=[]},sendMultiplayerNodeChangesForTesting:_=>{let m=e.state().scene();if(m==null)throw new Error("No current scene");let S=ye.schema.encodeMessage(_);m.applyMessageToScene(S)},setMockEmbedListener:_=>{aa.setMockListener(_)},setMaximumDrawingBufferSizeForTesting:_=>{e.canvasView().setMaximumDrawingBufferSizeForTesting(_)},clearMaximumDrawingBufferSizeForTesting:()=>{e.canvasView().clearMaximumDrawingBufferSizeForTesting()},triggerResizeForTesting:()=>{e.canvasView().triggerResizeForTesting()},reset:()=>{e.state().prototypeState().resetState(),e.unloadSceneAndResetPrototypeLib()},loadFile:(_,m)=>{let S=new Ks(hr.instance,La.instance,hr.instance);m(S).then(v=>{let C=v.cppModules;e.state().setFontListPromise(v.fontListPromise),e.initializePrototypeLib(C),Y.getFeatureFlags().internal_only_debug_tools&&(T.fullscreen=C==null?void 0:C.debuggingHelpers,window.DebuggingHelpers=T);let N=_.bytes,x=ee.fromString(_.nodeId);ee.isRoot(x)&&(x=null);let z=_.startingPointNodeId,$=_.imagePrefixURL,q=_.videoPrefixURL,K=_.interactiveComponentsEnabled,F=_.renderDots;typeof $=="string"&&Rt.setImagePrefixURL($),typeof q=="string"&&Rt.setVideoPrefixUrl(q),e.state().serialization().decodeSceneForViewerAndPrototypeLib2(N,K?0:1,"DUMMY_FILE_KEY").then(P=>{if(t.disconnect(),e.state().prototypeState().resetPrototype(),e.state().setScene(P),e.state().setRenderDots(!!F),e.canvasView().setBackgroundEnabled(!F),P.setAllTlfsLoaded(),Y.getViewerMode()==Y.ViewerMode.PROTOTYPE){let k=e.state().scene().findNode1(x);if(k==null){let Q=e.state().scene().findNode1(ee.fromString(z));if(Q!=null&&Q.isTopLevel()&&td(Q)&&(k=Q),k==null){let X=e.state().prototypeStructure().topLevelPrototypeStartingPointNodeIdsSorted();X.length>0&&(k=e.state().scene().findNode1(ee.fromString(X[0])))}}e.state().setActivePrototypeStartingPointNodeId(ee.fromString(z));let H=e.state().prototypeStructure().nodeToRestartPrototypeOn(e.state().getActiveCanvas()),L=k==null?void 0:k.topLevelAncestor();if(L!=null)e.state().prototypeState().navigateToFrameAndCloseOverlays(L.id());else if(H!=null)e.state().prototypeState().navigateToFrameAndCloseOverlays(H.id());else if(!mi)throw new Error("Calling loadFile in PROTOTYPE mode but with a file that isn't a valid prototype")}e.state().fontListPromise().then(k=>{r.trigger("sceneDidCompleteInitialLoad",null)})})})},navigateForward:()=>{e.canvasView().navigateForward(19)},navigateBackward:()=>{e.canvasView().navigateBackward(18)},navigateToFrameAndCloseOverlays:_=>{let m=ee.fromString(_);m!=null&&e.state().prototypeState().navigateToFrameAndCloseOverlays(m)},navigateToFrameAtIndex:_=>{e.canvasView().navigateToFrameAtIndex(_)},restartPrototype:()=>{e.state().prototypeState().restartPrototype(1)},forceFrame:()=>{e.window().forceFrame!=null&&Qd(()=>{e.window().forceFrame()})},setScalingMode:_=>{if(typeof _!="string")throw new Error("Expected string");_=="free"&&console.warn("setScalingMode('free') called "),e.state().prototypeState().setFitModeFromParameter(_),e.state().prototypeState().getCurrentFitMode()==3&&e.canvasView().viewport().setCameraZoom(0,1)},setTransitionOnClick:_=>{e.state().prototypeState().setTransitionOnClick(_)},setShowHotspots:_=>{e.canvasView().setShowHotspots(_)},toggleInteractionRecording:_=>{_?V1(e):e.window().clearAfterNotify()},getBackgroundColor:()=>bT(e),getPrototypeBackgroundColor:()=>TT(e),getPrototypeStartNodeId:()=>{let _=null,m=e.state().prototypeStructure().topLevelPrototypeStartingPointNodeIdsSorted();return m.length>0&&(_=ee.fromString(m[0])),_==null||!ee.isValid(_)?null:_},getActivePrototypeStartingPointNodeId:()=>{let _=e.state().activePrototypeStartingPointNodeId();return _==null||!ee.isValid(_)?null:_},setActivePrototypeStartingPointNodeId:_=>{let m=ee.fromString(_);e.state().activePrototypeStartingPointNodeId()!=m&&e.state().setActivePrototypeStartingPointNodeId(m)},prototypeStartingPointsData:()=>{let _=e.state().prototypeStructure();return _==null?null:_.prototypeStartingPointsData()},getBaseScreenId:()=>e.state().baseScreenId(),getCurrentOverlayIdsForTesting:()=>e.state().prototypeState().getCurrentOverlayIds().map(_=>_),getOnscreenStatesForTesting:()=>e.state().prototypeState().getOnscreenStates().map(_=>({stablePath:_.a.guids.map(m=>m),stateId:_.b})),pageIdForNodeId:_=>{var v;let m=e.state().scene();if(m==null)return null;let S=m.findNode2(_);return(v=S==null?void 0:S.findContainingCanvasOrSelf())==null?void 0:v.id()},prototypeType:()=>{let _=e.state().prototypeStructure();return _==null||_.currentType()==1?"FRAME_LIST":"NONLINEAR"},requestPage:_=>{var C;let m,S=ee.fromString(_),v=(C=e.state().scene())==null?void 0:C.findNode1(S);v!=null&&v.type()=="CANVAS"&&e.state().requestSetActiveCanvas(v)},setCurrentPageId:_=>{var C;let m,S=ee.fromString(_),v=(C=e.state().scene())==null?void 0:C.findNode1(S);v!=null&&v.type()=="CANVAS"&&e.state().setActiveCanvas(v)},getCurrentPageId:()=>{var m;let _=e.state().getActiveCanvas();return(m=_==null?void 0:_.findContainingCanvasOrSelf())==null?void 0:m.id()},getNodesToShowInPrototype:()=>e.state().prototypeStructure().topLevelPrototypeNodesInOrder(),getStatsForAnalytics:()=>{let _=e.state().getActiveCanvas();if(_==null)throw new Error("Asking for stats without an active canvas");let m=_.prototypeDevice();return{pageId:_.id(),deviceType:m.type,presetIdentifier:m.presetIdentifier,graphicsCardName:e.canvasView().graphicsCardName(),isHardwareAccelerationDisabled:w.isUsingSoftwareRenderer(e.canvasView().getContext()),isHighDPR:Y.isHighDPR(),fastImageDecode:Un.browserSupportsFastImageDecoding()}},getPrototypeDeviceType:()=>{let _=e.state().getActiveCanvas();return _==null?(Ve("Asking for prototype device type without a playback canvas"),"NONE"):_.prototypeDevice().type},getCurrentTlfBounds:()=>{var S;let _=(S=e.state().baseScreenNode())==null?void 0:S.canvasSpaceBoundingBox(),m=G.new2();return _==null?null:(_.transformInto2(m,e.canvasView().canvasSpaceToWindowSpace()),Rf(m))},setUserDidAttemptZoom:_=>{e.canvasView().userDidAttemptZoom=m=>{_(oh[m])}},getCanvasSpaceBoundsByNodeId:_=>{let m={},S=e.state().scene();if(S==null)throw new Error("No current scene");for(let v of _){let C=ee.fromString(v);if(C==null)continue;let N=S.findNode1(C);if(N==null)continue;let x=N.canvasSpaceBoundingBox();m[v]=new Map([["x",x.x()],["y",x.y()],["width",x.width()],["height",x.height()]])}return m},watchBoundsForNodes:_=>{let m=M1(_);o.setNodesWithComments(m)},getPrototypeStateCurrentIndex:()=>e.state().prototypeState().getCurrentBaseScreenIndex(),getNavigateForwardEnabled:()=>e.state().prototypeStructure().currentType()==1?e.state().prototypeState().getNextBaseScreenIdForFrameList()!=null:e.state().prototypeState().getNextBaseScreenIdForPrototype()!=null,getNavigateBackwardEnabled:()=>e.state().prototypeState().getPreviousBaseScreenId()!=null,getPages:()=>a.pages(),viewport:()=>{let _=e.canvasView().viewport(),m=_.offset(),S=_.zoomScale();return{offset:{x:m.x(),y:m.y()},zoomScale:S}},getStatsForDebugging:()=>wn.getStatsForDebugging(),on:r.on,off:r.off,trigger:r.trigger,playbackInteraction:_=>{if(c==2){let m=Ll.deserialize(_,f,y,u);e.window().notify(m)}},setNewContainerElement:_=>{e.window().setNewContainerElement(_)},canvasViewCursorForTesting:()=>pc[e.canvasView().cursor()],lastTopLevelTransitionPropertiesForTesting:()=>{let _=e.state().prototypeState().lastInitiatedTopLevelStateChange();return _==null||_.transitionParameters==null?null:{type:_.transitionParameters.transitionType,durationSeconds:_.transitionParameters.transitionDuration}},lastICTransitionPropertiesForTesting:()=>{let _=e.state().prototypeState().lastInitiatedInstanceStateChange();return _==null||_.transitionParameters==null?null:{type:_.transitionParameters.transitionType,durationSeconds:_.transitionParameters.transitionDuration}},scrollOffsetForNodeInBaseScreenForTesting:_=>{let m=e.state().scene();if(m==null)return{};let S=m.findNode2(_);return S!=null?S.scrollOffset().toJSON():I.new2().toJSON()},scrollOffsetForNodeInOverlayAtForTesting:(_,m)=>{let S=e.state().scene();if(S==null)return{};let v=S.findNode2(_);return v!=null?v.scrollOffset().toJSON():I.new2().toJSON()},getCanvasSpaceCommentLocations:_=>{let m=e.state().scene();if(m==null)return{};let S=new Map;for(let v in _)S.set(v,Os.fromJSON(_[v]));return o.getCanvasSpaceCommentLocations(m,S)},getCommentDestinationAtPosition:_=>{let m=new I(_.x,_.y),S=o.getCommentDestinationAtPosition(m);return S==null?null:S.toJSON()},onChange:_=>{var m;(m=e.state().scene())==null||m.onChange(_)},getRevisionNumber:()=>{var _;return(_=e.state().scene())==null?void 0:_.getRevisionNumber()},isWaitingForDeviceFrameToLoadForTesting:()=>{var m;let _=e.state().getActiveCanvas();return _==null?!1:(m=e.canvasView().deviceRenderer())==null?void 0:m.isWaitingForDeviceFrameToLoad(_.prototypeDevice())},prototypeViewHitTest:_=>{let m=new I(_.x,_.y),S=e.state().baseScreenNode();return S==null?{type:"NONE"}:e.canvasView().hitTestDeviceFrame(m)?{type:"DEVICE_FRAME"}:S.canvasSpaceBoundingBox().contains2(m)?{type:"CURRENT_TLF"}:{type:"PROTOTYPE_BACKGROUND"}},getPrototypeNode:_=>{var m;return(m=e.state().scene())==null?void 0:m.findNode2(_)},getTopmostFrameNode:_=>e.state().prototypeState().getTopmostScreen(),mapChildren:(_,m)=>{let S=[];if(_.isStack())for(let v=0,C=_.childCount();v<C;v=v+1)S.push(m(_.childAt1(v)));else for(let v=0,C=_.childCount();v<C;v=v+1)S.push(m(_.childAt1(_.childCount()-v-1)));return S},nodeId:_=>_.id(),nodeName:_=>_.name(),nodeParent:_=>_.parent(),nodeType:_=>_.type(),nodeCanvasSpaceBounds:_=>Rf(_.canvasSpacePreviewBounds()),nodeDisplayBounds:_=>{let m=null;if(_.parent().type()=="CANVAS"){let S=e.state().prototypeState().getOpenOverlayData(_.id());S!=null?m=S.renderedBounds(e.state().prototypeState().getCurrentBaseScreenNode()):m=_.canvasSpaceScrolledBounds(1),m=e.canvasView().viewport().canvasSpaceToViewSpace1().transformRect(m.clone())}else{let S=_.fullSize(),v=new G(0,0,S.x(),S.y()),C=_.relativeTransform().clone(),N=ne.new2();N.scale2(e.canvasView().viewport().canvasSpaceToViewSpace1().scale()),C.leftMultiply(N),m=C.transformRect(v)}return Rf(m)},nodeFillTypes:_=>_.fillPaints().map(m=>m.type()),nodeInteractions:_=>_.prototypeInteractions().filter(m=>m.action()!=null&&m.action().value.connectionType()!="NONE").map(m=>B1(m)),nodeScrollBounds:_=>{let m=null;if(_.hasOverflowingContentInScrollDirection()){let S=_.canvasSpaceContentBounds(),v=_.scrollOffset();m={x:v.x(),y:v.y(),width:S.width(),height:S.height()}}return m},nodeScrollTo:(_,m,S)=>{_.setScrollOffset(new I(m,S))},nodeText:_=>{var m;return(m=_==null?void 0:_.textData())==null?void 0:m.characters()},nodeVisible:_=>_==null?!1:_.visible(),nodeAccessibilityProperties:_=>({label:_.accessibleLabel()}),nodeCharacterStyles:_=>{var S,v,C;let m=(S=_==null?void 0:_.textData())==null?void 0:S.characters();if(m!=null){let N=pn._new();pn.set(N,6,_.get2(6));let x=(v=_==null?void 0:_.textData())==null?void 0:v.characterStyleIds(),z=((C=_==null?void 0:_.textData())==null?void 0:C.styleOverrideTable())??new zn,$=x!=null?x.length:0,q=0,K=0,F=[],P=(k,H,L)=>{let Q=new Map;pn.each(N,(M,te)=>{Q.set(Ct[M],te)});let X=z==null?void 0:z.styleByID2();if(X!=null){let M=Ht.IntMap_get(X,L,null);M!=null&&pn.each(M,(te,J)=>{Q.set(Ct[te],J)})}F.push({start:k,end:H,props:Q})};for(let k=0,H=m.length;k<H;k=k+1){let L=$>k?x[k]:0;z._in(L)||(L=0),q!=L&&(P(K,k,q),q=L,K=k)}return P(K,m.length,q),F}else return[]},nodeLineData:_=>{var S;let m=(S=_==null?void 0:_.textData())==null?void 0:S.lines();return m!=null?m.map(v=>({indentLevel:v.indentationLevel,lineType:v.lineType})):null},nodeTriggerInteraction:(_,m)=>{let S=0;m=="ON_CLICK"&&(S=4);let v=e.state().prototypeStructure().findHotspotsWithInteractionType(_,0,m);for(let C of v){let N=e.state().prototypeStructure().findPrototypeInteractionsWithInteractionType(C.node,m);for(let x of N){e.canvasView().triggerHotspot(C,x,S,null);return}}},nodeHover:_=>{let m=new Do(_);e.canvasView().handleHoverAtHotspot(m)},nodeReverseHover:_=>{let m=new Do(_);e.canvasView().handleReverseHoverAtHotspot(m)},nodeTableCells:_=>{if(_.type()!="TABLE")return null;let m=[];for(let S=0,v=_.childCount();S<v;S=S+1)m.push(_.childAt1(_.childCount()-S-1));return m},nodeTableCellContent:_=>{var m,S;return _.type()!="TABLE_CELL"?null:(S=(m=_.childAt1(0))==null?void 0:m.textData())==null?void 0:S.characters()},nodeInteractiveSlideConfigData:_=>_.interactiveSlideConfigData(),nodeInteractiveSlideParticipantData:_=>_.interactiveSlideParticipantData(),nodeSlideSpeakerNotes:_=>_.slideSpeakerNotes(),getCurrentOverlayStack:()=>e.state().prototypeState().getCurrentOverlays().map(_=>_.node()),setFeatureFlagsForTesting:_=>{Y.setFeatureFlags(_)},setPrototypeBackgroundColorOverride:_=>{let m=E.new2(_>>16&255,_>>8&255,_&255,255);Y.setPrototypeBackgroundColorOverride(new _e(m))},resetStateForTests:()=>{e.canvasView().resetStateForTests()},takeSpectorSnapshot:()=>{e.canvasView().viewport().invalidate(),e.canvasView().getContext().takeSpectorSnapshot()},clearTileCachesAndTakeSpectorSnapshot:()=>{e.canvasView().viewport().invalidate(),e.canvasView().clearTileCaches(),e.canvasView().getContext().takeSpectorSnapshot()},renderLayerByLayerActivate:()=>{Y.internalDebugTools()&&(e.canvasView().viewport().invalidate(),e.canvasView().clearTileCaches(),e.canvasView().renderLayerByLayerActivate())},renderLayerByLayerDeactivate:()=>{Y.internalDebugTools()&&e.canvasView().renderLayerByLayerDeactivate()},renderLayerByLayerPlay:()=>{Y.internalDebugTools()&&e.canvasView().renderLayerByLayerPlay()},renderLayerByLayerPause:()=>{Y.internalDebugTools()&&e.canvasView().renderLayerByLayerPause()},renderLayerByLayerForward:()=>{Y.internalDebugTools()&&e.canvasView().renderLayerByLayerForward()},renderLayerByLayerBackward:()=>{Y.internalDebugTools()&&e.canvasView().renderLayerByLayerBackward()},renderLayerByLayerRewind:()=>{Y.internalDebugTools()&&e.canvasView().renderLayerByLayerRewind()},renderLayerByLayerIncreaseSpeed:()=>{Y.internalDebugTools()&&e.canvasView().renderLayerByLayerIncreaseSpeed()},renderLayerByLayerDecreaseSpeed:()=>{Y.internalDebugTools()&&e.canvasView().renderLayerByLayerDecreaseSpeed()},toggleRenderTreePrinting:()=>{Y.internalDebugTools()&&e.canvasView().toggleRenderTreePrinting()}};return 3==0&&(b.app=e),hr.instance.setViewer(b),b}function U1(){return new Ks(hr.instance,La.instance,hr.instance)}function RT(){let i=window,e=i.Fig;e||(i.Fig=e={}),e.createViewer=t=>{if(delete e.createViewer,!(t instanceof Object))throw new Error("Missing parameters");return k1(t)},e.getPrototypeAppBindingsForTest=()=>(delete e.getPrototypeAppBindingsForTest,U1())}function G1(){console.debug("viewer build: sk"),RT()}G1();})();
//!!!!!!!!!!!!!!!!!!!!!!
/*! Bundled license information:

diff/dist/diff.js:
  (*!
  
   diff v3.5.0
  
  Software License Agreement (BSD License)
  
  Copyright (c) 2009-2015, Kevin Decker <kpdecker@gmail.com>
  
  All rights reserved.
  
  Redistribution and use of this software in source and binary forms, with or without modification,
  are permitted provided that the following conditions are met:
  
  * Redistributions of source code must retain the above
    copyright notice, this list of conditions and the
    following disclaimer.
  
  * Redistributions in binary form must reproduce the above
    copyright notice, this list of conditions and the
    following disclaimer in the documentation and/or other
    materials provided with the distribution.
  
  * Neither the name of Kevin Decker nor the names of its
    contributors may be used to endorse or promote products
    derived from this software without specific prior
    written permission.
  
  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR
  IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND
  FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
  CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
  DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
  DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER
  IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
  OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
  @license
  *)

pako/dist/pako.esm.mjs:
  (*! pako 2.1.0 https://github.com/nodeca/pako @license (MIT AND Zlib) *)
*/
//# sourceMappingURL=https://admin.figma.com/admin/viewerbuild-artifacts/cd7f8cca6d4a5de7f88dd4e9c59b286a0714fd52/ts-viewer.js.map

//# debugId=a074ac05-2feb-5137-b5d5-df3fdc3d86aa
